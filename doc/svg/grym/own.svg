<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3134pt" height="1946pt"
 viewBox="0.00 0.00 3133.50 1946.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1942.0028)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1942.0028 3129.5,-1942.0028 3129.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1225.5" cy="-1920.0028" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1225.5" y="-1915.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 144</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1225.5" cy="-1848.0028" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1225.5" y="-1843.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;48</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1225.5,-1901.8342C1225.5,-1894.1338 1225.5,-1884.9772 1225.5,-1876.4194"/>
<polygon fill="#000000" stroke="#000000" points="1229.0001,-1876.416 1225.5,-1866.4161 1222.0001,-1876.4161 1229.0001,-1876.416"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="896.5" cy="-1776.0028" rx="98.1935" ry="18"/>
<text text-anchor="middle" x="896.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Ownership function</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1176.6006,-1837.3014C1121.8888,-1825.328 1032.6794,-1805.805 969.6582,-1792.0131"/>
<polygon fill="#000000" stroke="#000000" points="970.2949,-1788.5697 959.7778,-1789.8508 968.7983,-1795.4079 970.2949,-1788.5697"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1058.5" cy="-1776.0028" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1058.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;5</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1190.8975,-1833.0844C1164.2335,-1821.5885 1127.2983,-1805.6644 1099.2127,-1793.5556"/>
<polygon fill="#000000" stroke="#000000" points="1100.2474,-1790.1903 1089.6788,-1789.4452 1097.476,-1796.6183 1100.2474,-1790.1903"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1168.5" cy="-1776.0028" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1168.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1211.4101,-1830.2051C1204.5256,-1821.5088 1196.1187,-1810.8895 1188.5765,-1801.3626"/>
<polygon fill="#000000" stroke="#000000" points="1191.1824,-1799.0154 1182.2311,-1793.3474 1185.694,-1803.3603 1191.1824,-1799.0154"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1283.5" cy="-1776.0028" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1283.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1239.8371,-1830.2051C1246.8424,-1821.5088 1255.3968,-1810.8895 1263.0713,-1801.3626"/>
<polygon fill="#000000" stroke="#000000" points="1265.9803,-1803.3306 1269.528,-1793.3474 1260.529,-1798.9393 1265.9803,-1803.3306"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1642.5" cy="-1776.0028" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1642.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;48</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1278.3133,-1838.884C1356.181,-1825.4392 1501.3571,-1800.3728 1582.9253,-1786.2891"/>
<polygon fill="#000000" stroke="#000000" points="1583.7733,-1789.6946 1593.0319,-1784.5441 1582.5822,-1782.7966 1583.7733,-1789.6946"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2292.5" cy="-1776.0028" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2292.5" y="-1771.8028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 49&#45;144</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1284.7691,-1844.0034C1465.5184,-1831.8066 2009.8282,-1795.0772 2214,-1781.2999"/>
<polygon fill="#000000" stroke="#000000" points="2214.3045,-1784.7874 2224.0461,-1780.622 2213.8331,-1777.8033 2214.3045,-1784.7874"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-1714.5032 0,-1714.5032 0,-1659.9023 527,-1659.9023 527,-1714.5032"/>
<text text-anchor="middle" x="263.5" y="-1683.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Taking a multi&#45;pass approach to this Grimoire instance will benefit us </text>
<text text-anchor="middle" x="263.5" y="-1668.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">in a few ways. </text>
</g>
<!-- block_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1024.8057,-1763.5707C1017.842,-1761.4005 1010.496,-1759.3957 1003.5,-1758.0028 798.9013,-1717.2674 743.03,-1743.2469 535.5,-1722.0028 516.9483,-1720.1037 497.7055,-1717.9711 478.4175,-1715.7207"/>
<polygon fill="#000000" stroke="#000000" points="478.6709,-1712.2265 468.3303,-1714.5338 477.8528,-1719.1785 478.6709,-1712.2265"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1002,-1706.5033 545,-1706.5033 545,-1667.9022 1002,-1667.9022 1002,-1706.5033"/>
<text text-anchor="middle" x="773.5" y="-1691.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">First, Grimoire itself is structured in a certain fashion. The </text>
<text text-anchor="middle" x="773.5" y="-1676.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">straightforward thing is to mirror that fashion in code.</text>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1133.76,-1763.9883C1127.0757,-1761.8602 1120.1009,-1759.7644 1113.5,-1758.0028 1040.4964,-1738.5202 957.4923,-1721.1461 891.7723,-1708.4847"/>
<polygon fill="#000000" stroke="#000000" points="892.2715,-1705.0168 881.7915,-1706.5724 890.9542,-1711.8917 892.2715,-1705.0168"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1547,-1721.804 1020,-1721.804 1020,-1652.6015 1547,-1652.6015 1547,-1721.804"/>
<text text-anchor="middle" x="1283.5" y="-1706.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">Second, the critical path right now is simple code generation from </text>
<text text-anchor="middle" x="1283.5" y="-1691.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">Grimoire documents. Parsing prose gets useful later, for now I simply</text>
<text text-anchor="middle" x="1283.5" y="-1676.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">wish to unravel some existing code into Grimoire format and start working</text>
<text text-anchor="middle" x="1283.5" y="-1660.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">on it accordingly. </text>
</g>
<!-- block_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1283.5,-1757.6034C1283.5,-1750.1475 1283.5,-1741.1814 1283.5,-1732.1835"/>
<polygon fill="#000000" stroke="#000000" points="1287.0001,-1732.0898 1283.5,-1722.0898 1280.0001,-1732.0898 1287.0001,-1732.0898"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="1642.5" cy="-1687.2027" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1642.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;46</text>
</g>
<!-- block_6&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>block_6&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.5,-1757.6034C1642.5,-1745.4977 1642.5,-1729.4104 1642.5,-1715.6701"/>
<polygon fill="#000000" stroke="#000000" points="1646.0001,-1715.2747 1642.5,-1705.2748 1639.0001,-1715.2748 1646.0001,-1715.2747"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1791.5,-1705.2027 1737.5,-1705.2027 1737.5,-1669.2027 1791.5,-1669.2027 1791.5,-1705.2027"/>
</g>
<!-- block_6&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_6&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1670.5912,-1760.3698C1687.8889,-1750.2632 1710.1811,-1736.3548 1728.5,-1722.0028 1732.3191,-1719.0107 1736.1841,-1715.6691 1739.8935,-1712.2727"/>
<polygon fill="#000000" stroke="#000000" points="1742.3781,-1714.7401 1747.2242,-1705.3185 1737.5604,-1709.6616 1742.3781,-1714.7401"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="2011.5" cy="-1687.2027" rx="142.1715" ry="18"/>
<text text-anchor="middle" x="2011.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Helper functions for own.parse</text>
</g>
<!-- section_7&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_7&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2247.9747,-1761.9322C2201.0635,-1747.1076 2126.8088,-1723.642 2074.0322,-1706.9638"/>
<polygon fill="#000000" stroke="#000000" points="2075.0289,-1703.6083 2064.4391,-1703.9323 2072.9196,-1710.2829 2075.0289,-1703.6083"/>
</g>
<!-- block_15 -->
<g id="node16" class="node">
<title>block_15</title>
<ellipse fill="none" stroke="#000000" cx="2227.5" cy="-1687.2027" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2227.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 49&#45;54</text>
</g>
<!-- section_7&#45;&gt;block_15 -->
<g id="edge15" class="edge">
<title>section_7&#45;&gt;block_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2279.3463,-1758.0328C2269.8572,-1745.0693 2256.9087,-1727.3796 2246.3259,-1712.9218"/>
<polygon fill="#000000" stroke="#000000" points="2249.1432,-1710.845 2240.4123,-1704.843 2243.4947,-1714.9796 2249.1432,-1710.845"/>
</g>
<!-- block_16 -->
<g id="node17" class="node">
<title>block_16</title>
<ellipse fill="none" stroke="#000000" cx="2357.5" cy="-1687.2027" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2357.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 55&#45;67</text>
</g>
<!-- section_7&#45;&gt;block_16 -->
<g id="edge16" class="edge">
<title>section_7&#45;&gt;block_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2305.6537,-1758.0328C2315.1428,-1745.0693 2328.0913,-1727.3796 2338.6741,-1712.9218"/>
<polygon fill="#000000" stroke="#000000" points="2341.5053,-1714.9796 2344.5877,-1704.843 2335.8568,-1710.845 2341.5053,-1714.9796"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="2529.5" cy="-1687.2027" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2529.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 68&#45;71</text>
</g>
<!-- section_7&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_7&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.4358,-1761.0395C2374.135,-1745.4155 2439.4568,-1720.9405 2483.3399,-1704.4982"/>
<polygon fill="#000000" stroke="#000000" points="2484.773,-1707.6989 2492.9092,-1700.9127 2482.3169,-1701.1439 2484.773,-1707.6989"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2844.5" cy="-1687.2027" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2844.5" y="-1683.0027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 72&#45;144</text>
</g>
<!-- section_7&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_7&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2352.3611,-1766.373C2457.2691,-1749.4964 2673.3821,-1714.7304 2780.882,-1697.437"/>
<polygon fill="#000000" stroke="#000000" points="2781.6216,-1700.8631 2790.9388,-1695.8191 2780.5098,-1693.9519 2781.6216,-1700.8631"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1780.5,-1616.403 1470.5,-1616.403 1470.5,-1124.4017 1780.5,-1124.4017 1780.5,-1616.403"/>
<text text-anchor="middle" x="1625.5" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1569.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1538.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1523.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="1625.5" y="-1491.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1625.5" y="-1460.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;../lib/ansi&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1444.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1397.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1366.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1334.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1303.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1287.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1272.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1257.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="1625.5" y="-1225.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = {}</text>
<text text-anchor="middle" x="1625.5" y="-1194.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local blue = tostring(a.blue)</text>
<text text-anchor="middle" x="1625.5" y="-1178.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local red = tostring(a.red)</text>
<text text-anchor="middle" x="1625.5" y="-1163.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local dim = tostring(a.dim)</text>
<text text-anchor="middle" x="1625.5" y="-1148.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local green = tostring(a.green)</text>
<text text-anchor="middle" x="1625.5" y="-1132.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local cl &#160;&#160;= tostring(a.clear)</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1641.5125,-1668.8009C1640.9468,-1658.2585 1640.1682,-1643.7492 1639.2569,-1626.7663"/>
<polygon fill="#000000" stroke="#000000" points="1642.7365,-1626.2905 1638.7056,-1616.4924 1635.7465,-1626.6656 1642.7365,-1626.2905"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="2220.5,-1405.6028 1798.5,-1405.6028 1798.5,-1335.202 2220.5,-1335.202 2220.5,-1405.6028"/>
<text text-anchor="middle" x="2009.5" y="-1374.3024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Trims leading whitespace, returning the amount taken and</text>
<text text-anchor="middle" x="2009.5" y="-1358.9024" font-family="Inconsolata" font-size="14.00" fill="#000000">the trimmed string.</text>
<text text-anchor="middle" x="2009.5" y="-1343.5024" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_15&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_15&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2215.1548,-1669.2625C2181.5722,-1620.4599 2087.8432,-1484.2518 2039.3748,-1413.8169"/>
<polygon fill="#000000" stroke="#000000" points="2042.2477,-1411.8175 2033.6955,-1405.5636 2036.4811,-1415.7857 2042.2477,-1411.8175"/>
</g>
<!-- codeblock_20 -->
<g id="node21" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="2315.5" cy="-1370.4024" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2315.5" y="-1366.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 55&#45;65</text>
</g>
<!-- block_16&#45;&gt;codeblock_20 -->
<g id="edge20" class="edge">
<title>block_16&#45;&gt;codeblock_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2355.0604,-1668.8009C2348.0266,-1615.7461 2327.673,-1462.2215 2319.2341,-1398.5683"/>
<polygon fill="#000000" stroke="#000000" points="2322.678,-1397.9135 2317.894,-1388.4602 2315.7387,-1398.8335 2322.678,-1397.9135"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2464.5,-1388.4024 2410.5,-1388.4024 2410.5,-1352.4024 2464.5,-1352.4024 2464.5,-1388.4024"/>
</g>
<!-- block_16&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_16&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2371.2855,-1669.6439C2381.3138,-1655.9292 2394.3408,-1635.974 2401.5,-1616.4027 2429.0241,-1541.1596 2435.5606,-1445.6996 2437.0742,-1398.8981"/>
<polygon fill="#000000" stroke="#000000" points="2440.5805,-1398.7059 2437.3497,-1388.6157 2433.5831,-1398.5184 2440.5805,-1398.7059"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2744,-1397.7028 2483,-1397.7028 2483,-1343.1019 2744,-1343.1019 2744,-1397.7028"/>
<text text-anchor="middle" x="2613.5" y="-1382.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes a string, parsing ownership.</text>
<text text-anchor="middle" x="2613.5" y="-1367.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> Returns a Doc.</text>
</g>
<!-- block_17&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_17&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2534.2569,-1669.2625C2547.5606,-1619.0884 2585.361,-1476.5267 2603.521,-1408.0376"/>
<polygon fill="#000000" stroke="#000000" points="2606.9765,-1408.6611 2606.1564,-1398.0981 2600.2103,-1406.867 2606.9765,-1408.6611"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2844.5" cy="-1370.4024" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2844.5" y="-1366.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 72&#45;143</text>
</g>
<!-- block_18&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>block_18&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2844.5,-1668.8009C2844.5,-1615.7461 2844.5,-1462.2215 2844.5,-1398.5683"/>
<polygon fill="#000000" stroke="#000000" points="2848.0001,-1398.4602 2844.5,-1388.4602 2841.0001,-1398.4603 2848.0001,-1398.4602"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2998.5,-1388.4024 2944.5,-1388.4024 2944.5,-1352.4024 2998.5,-1352.4024 2998.5,-1388.4024"/>
</g>
<!-- block_18&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_18&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2875.3734,-1671.4204C2895.8707,-1659.2517 2921.4953,-1640.4449 2935.5,-1616.4027 2976.3001,-1546.3601 2976.6129,-1446.6983 2973.8836,-1398.5664"/>
<polygon fill="#000000" stroke="#000000" points="2977.3747,-1398.3148 2973.2284,-1388.5651 2970.3897,-1398.7725 2977.3747,-1398.3148"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2516,-617.3019 2115,-617.3019 2115,-471.1002 2516,-471.1002 2516,-617.3019"/>
<text text-anchor="middle" x="2315.5" y="-602.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function lead_whitespace(str)</text>
<text text-anchor="middle" x="2315.5" y="-586.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_ws = L.match(m.WS, str)</text>
<text text-anchor="middle" x="2315.5" y="-571.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lead_ws &gt; 1 then</text>
<text text-anchor="middle" x="2315.5" y="-556.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; &#160;io.write(green..(&quot;%&quot;):rep(lead_ws &#45; 1)..cl)</text>
<text text-anchor="middle" x="2315.5" y="-540.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return lead_ws, str:sub(lead_ws)</text>
<text text-anchor="middle" x="2315.5" y="-525.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2315.5" y="-509.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0, str</text>
<text text-anchor="middle" x="2315.5" y="-494.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2315.5" y="-479.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2315.5,-1352.3776C2315.5,-1257.6039 2315.5,-814.2577 2315.5,-627.489"/>
<polygon fill="#000000" stroke="#000000" points="2319.0001,-627.4443 2315.5,-617.4444 2312.0001,-627.4444 2319.0001,-627.4443"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3125.5,-1088.6032 2563.5,-1088.6032 2563.5,.2011 3125.5,.2011 3125.5,-1088.6032"/>
<text text-anchor="middle" x="2844.5" y="-1073.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">function own(doc, str)</text>
<text text-anchor="middle" x="2844.5" y="-1057.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 1</text>
<text text-anchor="middle" x="2844.5" y="-1042.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc_level = 0</text>
<text text-anchor="middle" x="2844.5" y="-1027.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local start = 1</text>
<text text-anchor="middle" x="2844.5" y="-1011.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local num_lines = #(epeg.split(str,&quot;\n&quot;))</text>
<text text-anchor="middle" x="2844.5" y="-996.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks separately to avoid `* A` type collisions in code</text>
<text text-anchor="middle" x="2844.5" y="-980.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="2844.5" y="-965.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="2844.5" y="-950.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local finish = start + #line</text>
<text text-anchor="middle" x="2844.5" y="-934.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; tab and return filtration</text>
<text text-anchor="middle" x="2844.5" y="-919.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l, err = line:gsub(&quot;\t&quot;, &quot; &#160;&quot;):gsub(&quot;\r&quot;, &quot;&quot;) </text>
<text text-anchor="middle" x="2844.5" y="-903.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We should always have a string but..</text>
<text text-anchor="middle" x="2844.5" y="-888.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if l then</text>
<text text-anchor="middle" x="2844.5" y="-873.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="2844.5" y="-857.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local indent, l_trim = lead_whitespace(l)</text>
<text text-anchor="middle" x="2844.5" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_head = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="2844.5" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_head then </text>
<text text-anchor="middle" x="2844.5" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true </text>
<text text-anchor="middle" x="2844.5" y="-796.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-780.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isHeader, level, bareline = Header.match(l_trim) </text>
<text text-anchor="middle" x="2844.5" y="-749.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isHeader then &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="2844.5" y="-733.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local header = Header(bareline, level, start, finish, doc)</text>
<text text-anchor="middle" x="2844.5" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; make new block and append to doc</text>
<text text-anchor="middle" x="2844.5" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addSection(Section(header, linum), linum)</text>
<text text-anchor="middle" x="2844.5" y="-655.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2844.5" y="-640.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum)</text>
<text text-anchor="middle" x="2844.5" y="-624.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-609.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2844.5" y="-594.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code block logic, including restarts</text>
<text text-anchor="middle" x="2844.5" y="-578.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;</text>
<text text-anchor="middle" x="2844.5" y="-563.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; NOTE that this will choke on unmatched code headers,</text>
<text text-anchor="middle" x="2844.5" y="-547.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; which I intend to fix. But it&#39;s fiddly.</text>
<text text-anchor="middle" x="2844.5" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_foot = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="2844.5" y="-517.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_foot then </text>
<text text-anchor="middle" x="2844.5" y="-501.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="2844.5" y="-486.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-470.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum)</text>
<text text-anchor="middle" x="2844.5" y="-455.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-440.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif ER then</text>
<text text-anchor="middle" x="2844.5" y="-424.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;HUH?&quot;)</text>
<text text-anchor="middle" x="2844.5" y="-409.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-393.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="2844.5" y="-378.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;start = finish</text>
<text text-anchor="middle" x="2844.5" y="-363.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &lt; num_lines then start = start + 1 end</text>
<text text-anchor="middle" x="2844.5" y="-347.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (doc.latest) then</text>
<text text-anchor="middle" x="2844.5" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="2844.5" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sections = doc:select(&quot;section&quot;)</text>
<text text-anchor="middle" x="2844.5" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, s in ipairs(sections) do</text>
<text text-anchor="middle" x="2844.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:check()</text>
<text text-anchor="middle" x="2844.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:block()</text>
<text text-anchor="middle" x="2844.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = doc:select(&quot;block&quot;)</text>
<text text-anchor="middle" x="2844.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, block in ipairs(blocks) do</text>
<text text-anchor="middle" x="2844.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block:toValue()</text>
<text text-anchor="middle" x="2844.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block:parseProse()</text>
<text text-anchor="middle" x="2844.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local cbs = doc:select(&quot;codeblock&quot;)</text>
<text text-anchor="middle" x="2844.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, cb in ipairs(cbs) do</text>
<text text-anchor="middle" x="2844.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;cb:toValue()</text>
<text text-anchor="middle" x="2844.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2844.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.linum = linum &#45; 1</text>
<text text-anchor="middle" x="2844.5" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="2844.5" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2844.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return own</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2844.5,-1352.3776C2844.5,-1313.1672 2844.5,-1214.2916 2844.5,-1098.6062"/>
<polygon fill="#000000" stroke="#000000" points="2848.0001,-1098.4491 2844.5,-1088.4492 2841.0001,-1098.4492 2848.0001,-1098.4491"/>
</g>
</g>
</svg>