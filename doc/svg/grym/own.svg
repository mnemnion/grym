<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3328pt" height="4244pt"
 viewBox="0.00 0.00 3328.00 4244.21" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4240.2066)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-4240.2066 3324,-4240.2066 3324,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1400.5" cy="-4218.2066" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1400.5" y="-4214.0066" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 149</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1400.5" cy="-4146.2066" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1400.5" y="-4142.0066" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;48</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1400.5,-4200.038C1400.5,-4192.3376 1400.5,-4183.181 1400.5,-4174.6233"/>
<polygon fill="#000000" stroke="#000000" points="1404.0001,-4174.6199 1400.5,-4164.6199 1397.0001,-4174.6199 1404.0001,-4174.6199"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1013.5" cy="-3705.8061" rx="98.1935" ry="18"/>
<text text-anchor="middle" x="1013.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Ownership function</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1341.2082,-4142.0198C1268.7716,-4135.7055 1151.962,-4121.2581 1120.5,-4092.2066 1015.6737,-3995.4119 1010.1161,-3805.8977 1012.0648,-3734.1999"/>
<polygon fill="#000000" stroke="#000000" points="1015.5656,-3734.2326 1012.4118,-3724.1181 1008.5698,-3733.9917 1015.5656,-3734.2326"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1175.5" cy="-3705.8061" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1175.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;5</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1349.6622,-4136.2716C1305.4352,-4126.5611 1246.0533,-4110.5858 1230.5,-4092.2066 1141.1703,-3986.6464 1159.3134,-3803.825 1170.3465,-3734.0126"/>
<polygon fill="#000000" stroke="#000000" points="1173.8556,-3734.2455 1172.0387,-3723.8076 1166.9499,-3733.1003 1173.8556,-3734.2455"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1285.5" cy="-3705.8061" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1285.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1375.0021,-4129.7114C1362.5454,-4120.266 1348.5417,-4107.2947 1340.5,-4092.2066 1276.1955,-3971.5566 1279.0894,-3801.0611 1283.2015,-3734.2383"/>
<polygon fill="#000000" stroke="#000000" points="1286.7064,-3734.2817 1283.8882,-3724.0686 1279.7223,-3733.8101 1286.7064,-3734.2817"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1400.5" cy="-3705.8061" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1400.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1400.5,-4128.1214C1400.5,-4059.8939 1400.5,-3817.7616 1400.5,-3734.3167"/>
<polygon fill="#000000" stroke="#000000" points="1404.0001,-3734.2865 1400.5,-3724.2866 1397.0001,-3734.2866 1404.0001,-3734.2865"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1642.5" cy="-3705.8061" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1642.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;48</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1423.3464,-4129.3031C1435.5013,-4119.4713 1450.0513,-4106.2671 1460.5,-4092.2066 1549.9239,-3971.8716 1611.6203,-3800.5948 1633.6081,-3733.901"/>
<polygon fill="#000000" stroke="#000000" points="1637.0251,-3734.7112 1636.7942,-3724.1189 1630.3693,-3732.5433 1637.0251,-3734.7112"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2232.5" cy="-3705.8061" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2232.5" y="-3701.6061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 49&#45;149</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1456.9409,-4139.4175C1532.8302,-4129.7539 1663.3434,-4111.0999 1707.5,-4092.2066 1924.843,-3999.2123 2137.0446,-3800.7104 2207.7862,-3730.7997"/>
<polygon fill="#000000" stroke="#000000" points="2210.3233,-3733.2128 2214.9491,-3723.6811 2205.3889,-3728.2477 2210.3233,-3733.2128"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2848,-4092.1072 2321,-4092.1072 2321,-3319.5051 2848,-3319.5051 2848,-4092.1072"/>
<text text-anchor="middle" x="2584.5" y="-4077.0066" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Ownership function</text>
<text text-anchor="middle" x="2584.5" y="-4045.6066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Taking a multi&#45;pass approach to this Grimoire instance will benefit us </text>
<text text-anchor="middle" x="2584.5" y="-4030.2066" font-family="Inconsolata" font-size="14.00" fill="#000000">in a few ways. </text>
<text text-anchor="middle" x="2584.5" y="-3998.8066" font-family="Inconsolata" font-size="14.00" fill="#000000">First, Grimoire itself is structured in a certain fashion. The </text>
<text text-anchor="middle" x="2584.5" y="-3983.4065" font-family="Inconsolata" font-size="14.00" fill="#000000">straightforward thing is to mirror that fashion in code.</text>
<text text-anchor="middle" x="2584.5" y="-3952.0065" font-family="Inconsolata" font-size="14.00" fill="#000000">Second, the critical path right now is simple code generation from </text>
<text text-anchor="middle" x="2584.5" y="-3936.6065" font-family="Inconsolata" font-size="14.00" fill="#000000">Grimoire documents. Parsing prose gets useful later, for now I simply</text>
<text text-anchor="middle" x="2584.5" y="-3921.2064" font-family="Inconsolata" font-size="14.00" fill="#000000">wish to unravel some existing code into Grimoire format and start working</text>
<text text-anchor="middle" x="2584.5" y="-3905.8064" font-family="Inconsolata" font-size="14.00" fill="#000000">on it accordingly. </text>
<text text-anchor="middle" x="2584.5" y="-3874.4064" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2584.5" y="-3859.0063" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3827.6063" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3796.2063" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3780.8062" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="2584.5" y="-3749.4062" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="2584.5" y="-3718.0062" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;../lib/ansi&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3702.6061" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3655.2061" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3623.8061" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3592.4061" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3561.006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3545.606" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3530.206" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3514.8059" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="2584.5" y="-3483.4059" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = {}</text>
<text text-anchor="middle" x="2584.5" y="-3452.0059" font-family="Inconsolata" font-size="14.00" fill="#000000">local blue = tostring(a.blue)</text>
<text text-anchor="middle" x="2584.5" y="-3436.6058" font-family="Inconsolata" font-size="14.00" fill="#000000">local red = tostring(a.red)</text>
<text text-anchor="middle" x="2584.5" y="-3421.2058" font-family="Inconsolata" font-size="14.00" fill="#000000">local dim = tostring(a.dim)</text>
<text text-anchor="middle" x="2584.5" y="-3405.8058" font-family="Inconsolata" font-size="14.00" fill="#000000">local green = tostring(a.green)</text>
<text text-anchor="middle" x="2584.5" y="-3390.4057" font-family="Inconsolata" font-size="14.00" fill="#000000">local cl &#160;&#160;= tostring(a.clear)</text>
<text text-anchor="middle" x="2584.5" y="-3375.0057" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2584.5" y="-3327.6057" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_1&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>section_1&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1461.4466,-4145.6426C1647.6156,-4143.5142 2202.37,-4134.0281 2311.6122,-4091.6467"/>
<polygon fill="#000000" stroke="#000000" points="2313.1399,-4094.7967 2320.766,-4087.4418 2310.2178,-4088.4357 2313.1399,-4094.7967"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-2533.7047 0,-2533.7047 0,-2479.1038 527,-2479.1038 527,-2533.7047"/>
<text text-anchor="middle" x="263.5" y="-2502.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Taking a multi&#45;pass approach to this Grimoire instance will benefit us </text>
<text text-anchor="middle" x="263.5" y="-2487.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">in a few ways. </text>
</g>
<!-- block_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1179.7681,-3687.7245C1193.2631,-3625.5131 1228.0449,-3418.6807 1120.5,-3319.4056 1024.7961,-3231.0611 639.3627,-3361.9966 535.5,-3283.4056 289.4014,-3097.1877 264.9444,-2672.3121 263.3176,-2543.8674"/>
<polygon fill="#000000" stroke="#000000" points="266.8165,-2543.7188 263.2301,-2533.7494 259.8168,-2543.7793 266.8165,-2543.7188"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1002,-2525.7048 545,-2525.7048 545,-2487.1037 1002,-2487.1037 1002,-2525.7048"/>
<text text-anchor="middle" x="773.5" y="-2510.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">First, Grimoire itself is structured in a certain fashion. The </text>
<text text-anchor="middle" x="773.5" y="-2495.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">straightforward thing is to mirror that fashion in code.</text>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1289.4775,-3687.6863C1301.8024,-3626.2256 1332.6732,-3423.7274 1230.5,-3319.4056 1161.1738,-3248.6216 1085.0874,-3348.6223 1010.5,-3283.4056 777.0243,-3079.2627 769.7826,-2652.4946 772.3817,-2536.2116"/>
<polygon fill="#000000" stroke="#000000" points="775.8876,-2536.0357 772.6567,-2525.9455 768.8901,-2535.8482 775.8876,-2536.0357"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1547,-2541.0055 1020,-2541.0055 1020,-2471.803 1547,-2471.803 1547,-2541.0055"/>
<text text-anchor="middle" x="1283.5" y="-2526.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">Second, the critical path right now is simple code generation from </text>
<text text-anchor="middle" x="1283.5" y="-2510.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">Grimoire documents. Parsing prose gets useful later, for now I simply</text>
<text text-anchor="middle" x="1283.5" y="-2495.2042" font-family="Inconsolata" font-size="14.00" fill="#000000">wish to unravel some existing code into Grimoire format and start working</text>
<text text-anchor="middle" x="1283.5" y="-2479.8042" font-family="Inconsolata" font-size="14.00" fill="#000000">on it accordingly. </text>
</g>
<!-- block_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1398.709,-3687.4464C1385.8365,-3555.4861 1307.3737,-2751.1405 1287.8807,-2551.312"/>
<polygon fill="#000000" stroke="#000000" points="1291.3461,-2550.7865 1286.8917,-2541.1736 1284.3792,-2551.4662 1291.3461,-2550.7865"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="1642.5" cy="-2506.4042" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1642.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;46</text>
</g>
<!-- block_6&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>block_6&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.5,-3687.4464C1642.5,-3551.5364 1642.5,-2702.3889 1642.5,-2535.0279"/>
<polygon fill="#000000" stroke="#000000" points="1646.0001,-2534.7962 1642.5,-2524.7962 1639.0001,-2534.7962 1646.0001,-2534.7962"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1791.5,-2524.4042 1737.5,-2524.4042 1737.5,-2488.4042 1791.5,-2488.4042 1791.5,-2524.4042"/>
</g>
<!-- block_6&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_6&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1647.1954,-3687.8564C1662.1452,-3629.8449 1708.8054,-3441.9661 1728.5,-3283.4056 1764.6354,-2992.4814 1765.3728,-2636.2146 1764.7622,-2534.6354"/>
<polygon fill="#000000" stroke="#000000" points="1768.2617,-2534.5368 1764.6917,-2524.5616 1761.2619,-2534.5858 1768.2617,-2534.5368"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="1951.5" cy="-2506.4042" rx="142.1715" ry="18"/>
<text text-anchor="middle" x="1951.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Helper functions for own.parse</text>
</g>
<!-- section_7&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_7&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2226.0875,-3687.4764C2205.8264,-3629.0829 2142.1815,-3441.9455 2102.5,-3283.4056 2030.0658,-2994.0085 1971.8945,-2636.6788 1955.8846,-2534.7413"/>
<polygon fill="#000000" stroke="#000000" points="1959.3067,-2533.9704 1954.3038,-2524.6312 1952.3907,-2535.0519 1959.3067,-2533.9704"/>
</g>
<!-- block_15 -->
<g id="node16" class="node">
<title>block_15</title>
<ellipse fill="none" stroke="#000000" cx="2167.5" cy="-2506.4042" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2167.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 49&#45;54</text>
</g>
<!-- section_7&#45;&gt;block_15 -->
<g id="edge15" class="edge">
<title>section_7&#45;&gt;block_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2231.505,-3687.4464C2224.1396,-3551.5364 2178.1211,-2702.3889 2169.0512,-2535.0279"/>
<polygon fill="#000000" stroke="#000000" points="2172.5328,-2534.5921 2168.4967,-2524.7962 2165.5431,-2534.971 2172.5328,-2534.5921"/>
</g>
<!-- block_16 -->
<g id="node17" class="node">
<title>block_16</title>
<ellipse fill="none" stroke="#000000" cx="2297.5" cy="-2506.4042" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2297.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 55&#45;67</text>
</g>
<!-- section_7&#45;&gt;block_16 -->
<g id="edge16" class="edge">
<title>section_7&#45;&gt;block_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2233.495,-3687.4464C2240.8604,-3551.5364 2286.8789,-2702.3889 2295.9488,-2535.0279"/>
<polygon fill="#000000" stroke="#000000" points="2299.4569,-2534.971 2296.5033,-2524.7962 2292.4672,-2534.5921 2299.4569,-2534.971"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="2450.5" cy="-2506.4042" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2450.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 68&#45;71</text>
</g>
<!-- section_7&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_7&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2231.6961,-3687.5109C2229.9976,-3628.7884 2231.5209,-3441.7725 2311.5,-3319.4056 2326.6794,-3296.1814 2348.3676,-3307.2814 2362.5,-3283.4056 2513.9276,-3027.5796 2470.685,-2640.891 2455.0115,-2534.4018"/>
<polygon fill="#000000" stroke="#000000" points="2458.4607,-2533.8018 2453.5032,-2524.4383 2451.5395,-2534.8496 2458.4607,-2533.8018"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2644.5" cy="-2506.4042" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2644.5" y="-2502.2042" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 72&#45;149</text>
</g>
<!-- section_7&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_7&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2229.8669,-3687.581C2222.0632,-3625.7819 2205.7637,-3422.325 2311.5,-3319.4056 2377.4745,-3255.1888 2450.7296,-3348.8368 2515.5,-3283.4056 2727.748,-3068.9924 2669.9641,-2647.0207 2649.947,-2534.5197"/>
<polygon fill="#000000" stroke="#000000" points="2653.378,-2533.8244 2648.1381,-2524.616 2646.4919,-2535.0821 2653.378,-2533.8244"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="3320,-3283.4071 2723,-3283.4071 2723,-1729.4014 3320,-1729.4014 3320,-3283.4071"/>
<text text-anchor="middle" x="3021.5" y="-3268.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> *** Helper functions for own.parse</text>
<text text-anchor="middle" x="3021.5" y="-3236.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Trims leading whitespace, returning the amount taken and</text>
<text text-anchor="middle" x="3021.5" y="-3221.4056" font-family="Inconsolata" font-size="14.00" fill="#000000">the trimmed string.</text>
<text text-anchor="middle" x="3021.5" y="-3206.0056" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="3021.5" y="-3174.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3021.5" y="-3159.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">local function lead_whitespace(str)</text>
<text text-anchor="middle" x="3021.5" y="-3143.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_ws = L.match(m.WS, str)</text>
<text text-anchor="middle" x="3021.5" y="-3128.4054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lead_ws &gt; 1 then</text>
<text text-anchor="middle" x="3021.5" y="-3113.0054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; &#160;io.write(green..(&quot;%&quot;):rep(lead_ws &#45; 1)..cl)</text>
<text text-anchor="middle" x="3021.5" y="-3097.6054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return lead_ws, str:sub(lead_ws)</text>
<text text-anchor="middle" x="3021.5" y="-3082.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3021.5" y="-3066.8053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0, str</text>
<text text-anchor="middle" x="3021.5" y="-3051.4053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-3036.0052" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3021.5" y="-3020.6052" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3021.5" y="-2973.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes a string, parsing ownership.</text>
<text text-anchor="middle" x="3021.5" y="-2957.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> Returns a Doc.</text>
<text text-anchor="middle" x="3021.5" y="-2910.4051" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3021.5" y="-2895.0051" font-family="Inconsolata" font-size="14.00" fill="#000000">function own(doc, str)</text>
<text text-anchor="middle" x="3021.5" y="-2879.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 1</text>
<text text-anchor="middle" x="3021.5" y="-2864.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc_level = 0</text>
<text text-anchor="middle" x="3021.5" y="-2848.805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local start = 1</text>
<text text-anchor="middle" x="3021.5" y="-2833.405" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local num_lines = #(epeg.split(str,&quot;\n&quot;))</text>
<text text-anchor="middle" x="3021.5" y="-2818.0049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks separately to avoid `* A` type collisions in code</text>
<text text-anchor="middle" x="3021.5" y="-2802.6049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="3021.5" y="-2787.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="3021.5" y="-2771.8048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="3021.5" y="-2756.4048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; tab and return filtration</text>
<text text-anchor="middle" x="3021.5" y="-2741.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l, err = line:gsub(&quot;\t&quot;, &quot; &#160;&quot;):gsub(&quot;\r&quot;, &quot;&quot;) </text>
<text text-anchor="middle" x="3021.5" y="-2725.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local finish = start + #l</text>
<text text-anchor="middle" x="3021.5" y="-2710.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We should always have a string but..</text>
<text text-anchor="middle" x="3021.5" y="-2694.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if l then</text>
<text text-anchor="middle" x="3021.5" y="-2679.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="3021.5" y="-2664.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local indent, l_trim = lead_whitespace(l)</text>
<text text-anchor="middle" x="3021.5" y="-2648.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_head = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="3021.5" y="-2633.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_head then </text>
<text text-anchor="middle" x="3021.5" y="-2617.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true </text>
<text text-anchor="middle" x="3021.5" y="-2602.4045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2587.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isHeader, level, bareline = Header.match(l_trim) </text>
<text text-anchor="middle" x="3021.5" y="-2555.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isHeader then &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="3021.5" y="-2540.2044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local header = Header(bareline, level, start, finish, doc)</text>
<text text-anchor="middle" x="3021.5" y="-2508.8044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; make new block and append to doc</text>
<text text-anchor="middle" x="3021.5" y="-2493.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addSection(Section(header, linum, start, finish, doc.str), </text>
<text text-anchor="middle" x="3021.5" y="-2478.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum, start)</text>
<text text-anchor="middle" x="3021.5" y="-2446.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="3021.5" y="-2431.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum, finish)</text>
<text text-anchor="middle" x="3021.5" y="-2415.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2400.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="3021.5" y="-2385.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code block logic, including restarts</text>
<text text-anchor="middle" x="3021.5" y="-2369.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;</text>
<text text-anchor="middle" x="3021.5" y="-2354.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; NOTE that this will choke on unmatched code headers,</text>
<text text-anchor="middle" x="3021.5" y="-2338.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; which I intend to fix. But it&#39;s fiddly.</text>
<text text-anchor="middle" x="3021.5" y="-2323.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_foot = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="3021.5" y="-2308.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_foot then </text>
<text text-anchor="middle" x="3021.5" y="-2292.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="3021.5" y="-2277.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2261.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum, finish)</text>
<text text-anchor="middle" x="3021.5" y="-2246.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2231.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif ER then</text>
<text text-anchor="middle" x="3021.5" y="-2215.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;HUH?&quot;)</text>
<text text-anchor="middle" x="3021.5" y="-2200.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2184.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="3021.5" y="-2169.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;start = finish</text>
<text text-anchor="middle" x="3021.5" y="-2154.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &lt; num_lines then start = start + 1 end</text>
<text text-anchor="middle" x="3021.5" y="-2138.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2123.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (doc.latest) then</text>
<text text-anchor="middle" x="3021.5" y="-2107.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="3021.5" y="-2092.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(start) == &#39;number&#39;)</text>
<text text-anchor="middle" x="3021.5" y="-2077.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = start</text>
<text text-anchor="middle" x="3021.5" y="-2061.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3021.5" y="-2046.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(false, &quot;no doc.latest&quot;)</text>
<text text-anchor="middle" x="3021.5" y="-2030.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-2015.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sections = doc:select(&quot;section&quot;)</text>
<text text-anchor="middle" x="3021.5" y="-2000.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, s in ipairs(sections) do</text>
<text text-anchor="middle" x="3021.5" y="-1984.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:check()</text>
<text text-anchor="middle" x="3021.5" y="-1969.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:block()</text>
<text text-anchor="middle" x="3021.5" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = doc:select(&quot;block&quot;)</text>
<text text-anchor="middle" x="3021.5" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="3021.5" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="3021.5" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local cbs = doc:select(&quot;codeblock&quot;)</text>
<text text-anchor="middle" x="3021.5" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(cbs) do</text>
<text text-anchor="middle" x="3021.5" y="-1846.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="3021.5" y="-1830.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3021.5" y="-1815.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.linum = linum &#45; 1</text>
<text text-anchor="middle" x="3021.5" y="-1799.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="3021.5" y="-1784.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3021.5" y="-1753.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">return own</text>
<text text-anchor="middle" x="3021.5" y="-1737.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_7&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>section_7&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2229.605,-3687.6699C2220.7909,-3625.2803 2201.2027,-3417.9358 2311.5,-3319.4056 2378.5536,-3259.5057 2642.4788,-3337.2308 2714.5,-3283.4056 2714.5862,-3283.3412 2714.6724,-3283.2767 2714.7586,-3283.2122"/>
<polygon fill="#000000" stroke="#000000" points="2716.8881,-3285.9899 2722.7039,-3277.1339 2712.6349,-3280.4302 2716.8881,-3285.9899"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1640.5,-1693.4032 1330.5,-1693.4032 1330.5,-1201.4019 1640.5,-1201.4019 1640.5,-1693.4032"/>
<text text-anchor="middle" x="1485.5" y="-1678.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1646.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1615.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1600.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="1485.5" y="-1568.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1485.5" y="-1537.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;../lib/ansi&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1521.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1474.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1443.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1411.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1380.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1364.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1349.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1334.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="1485.5" y="-1302.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = {}</text>
<text text-anchor="middle" x="1485.5" y="-1271.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local blue = tostring(a.blue)</text>
<text text-anchor="middle" x="1485.5" y="-1255.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local red = tostring(a.red)</text>
<text text-anchor="middle" x="1485.5" y="-1240.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local dim = tostring(a.dim)</text>
<text text-anchor="middle" x="1485.5" y="-1225.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local green = tostring(a.green)</text>
<text text-anchor="middle" x="1485.5" y="-1209.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local cl &#160;&#160;= tostring(a.clear)</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1641.3528,-2488.2071C1635.759,-2402.4242 1609.3985,-2030.0221 1555.5,-1729.4028 1553.9638,-1720.8349 1552.3167,-1712.1407 1550.5806,-1703.3763"/>
<polygon fill="#000000" stroke="#000000" points="1553.988,-1702.567 1548.5838,-1693.4541 1547.1256,-1703.948 1553.988,-1702.567"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="2080.5,-1482.6029 1658.5,-1482.6029 1658.5,-1412.2021 2080.5,-1412.2021 2080.5,-1482.6029"/>
<text text-anchor="middle" x="1869.5" y="-1451.3026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Trims leading whitespace, returning the amount taken and</text>
<text text-anchor="middle" x="1869.5" y="-1435.9025" font-family="Inconsolata" font-size="14.00" fill="#000000">the trimmed string.</text>
<text text-anchor="middle" x="1869.5" y="-1420.5025" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_15&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_15&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2169.8229,-2488.275C2180.3028,-2400.505 2217.8337,-2012.3947 2102.5,-1729.4028 2062.3248,-1630.8259 1974.8723,-1540.4425 1919.2753,-1489.7829"/>
<polygon fill="#000000" stroke="#000000" points="1921.4188,-1487.0028 1911.65,-1482.9016 1916.729,-1492.1996 1921.4188,-1487.0028"/>
</g>
<!-- codeblock_20 -->
<g id="node21" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="2175.5" cy="-1447.4025" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2175.5" y="-1443.2025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 55&#45;65</text>
</g>
<!-- block_16&#45;&gt;codeblock_20 -->
<g id="edge20" class="edge">
<title>block_16&#45;&gt;codeblock_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2296.7603,-2488.2473C2293.1102,-2402.6458 2275.4389,-2030.9372 2232.5,-1729.4028 2219.1217,-1635.4553 2194.2069,-1525.6358 2182.2471,-1475.2454"/>
<polygon fill="#000000" stroke="#000000" points="2185.6282,-1474.3349 2179.9005,-1465.4217 2178.8197,-1475.9613 2185.6282,-1474.3349"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2324.5,-1465.4025 2270.5,-1465.4025 2270.5,-1429.4025 2324.5,-1429.4025 2324.5,-1465.4025"/>
</g>
<!-- block_16&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_16&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2297.5,-2488.0233C2297.5,-2362.2282 2297.5,-1628.7735 2297.5,-1475.4817"/>
<polygon fill="#000000" stroke="#000000" points="2301.0001,-1475.4636 2297.5,-1465.4636 2294.0001,-1475.4636 2301.0001,-1475.4636"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2604,-1474.703 2343,-1474.703 2343,-1420.1021 2604,-1420.1021 2604,-1474.703"/>
<text text-anchor="middle" x="2473.5" y="-1459.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes a string, parsing ownership.</text>
<text text-anchor="middle" x="2473.5" y="-1444.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> Returns a Doc.</text>
</g>
<!-- block_17&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_17&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2450.8992,-2488.0233C2453.5781,-2364.6756 2468.9461,-1657.0825 2472.6817,-1485.0787"/>
<polygon fill="#000000" stroke="#000000" points="2476.1828,-1485.0632 2472.9009,-1474.9895 2469.1844,-1484.9111 2476.1828,-1485.0632"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2704.5" cy="-1447.4025" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2704.5" y="-1443.2025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 72&#45;148</text>
</g>
<!-- block_18&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>block_18&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2645.5414,-2488.0233C2652.6686,-2362.2282 2694.224,-1628.7735 2702.9091,-1475.4817"/>
<polygon fill="#000000" stroke="#000000" points="2706.4053,-1475.6456 2703.4767,-1465.4636 2699.4166,-1475.2496 2706.4053,-1475.6456"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2858.5,-1465.4025 2804.5,-1465.4025 2804.5,-1429.4025 2858.5,-1429.4025 2858.5,-1465.4025"/>
</g>
<!-- block_18&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_18&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2640.1024,-2488.3754C2618.919,-2396.9797 2535.5557,-1979.4169 2714.5,-1729.4028 2737.4289,-1697.3675 2771.6916,-1724.7901 2795.5,-1693.4028 2844.8335,-1628.3649 2840.9233,-1525.1627 2835.5135,-1475.6805"/>
<polygon fill="#000000" stroke="#000000" points="2838.9817,-1475.2058 2834.3189,-1465.6922 2832.0313,-1476.0371 2838.9817,-1475.2058"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2376,-655.8019 1975,-655.8019 1975,-509.6003 2376,-509.6003 2376,-655.8019"/>
<text text-anchor="middle" x="2175.5" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function lead_whitespace(str)</text>
<text text-anchor="middle" x="2175.5" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_ws = L.match(m.WS, str)</text>
<text text-anchor="middle" x="2175.5" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lead_ws &gt; 1 then</text>
<text text-anchor="middle" x="2175.5" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; &#160;io.write(green..(&quot;%&quot;):rep(lead_ws &#45; 1)..cl)</text>
<text text-anchor="middle" x="2175.5" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return lead_ws, str:sub(lead_ws)</text>
<text text-anchor="middle" x="2175.5" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2175.5" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0, str</text>
<text text-anchor="middle" x="2175.5" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2175.5" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2175.5,-1429.342C2175.5,-1331.2367 2175.5,-859.6774 2175.5,-666.0057"/>
<polygon fill="#000000" stroke="#000000" points="2179.0001,-665.8803 2175.5,-655.8804 2172.0001,-665.8804 2179.0001,-665.8803"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3003,-1165.6034 2406,-1165.6034 2406,.2012 3003,.2012 3003,-1165.6034"/>
<text text-anchor="middle" x="2704.5" y="-1150.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">function own(doc, str)</text>
<text text-anchor="middle" x="2704.5" y="-1134.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 1</text>
<text text-anchor="middle" x="2704.5" y="-1119.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc_level = 0</text>
<text text-anchor="middle" x="2704.5" y="-1104.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local start = 1</text>
<text text-anchor="middle" x="2704.5" y="-1088.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local num_lines = #(epeg.split(str,&quot;\n&quot;))</text>
<text text-anchor="middle" x="2704.5" y="-1073.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks separately to avoid `* A` type collisions in code</text>
<text text-anchor="middle" x="2704.5" y="-1057.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="2704.5" y="-1042.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="2704.5" y="-1027.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="2704.5" y="-1011.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; tab and return filtration</text>
<text text-anchor="middle" x="2704.5" y="-996.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l, err = line:gsub(&quot;\t&quot;, &quot; &#160;&quot;):gsub(&quot;\r&quot;, &quot;&quot;) </text>
<text text-anchor="middle" x="2704.5" y="-980.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local finish = start + #l</text>
<text text-anchor="middle" x="2704.5" y="-965.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We should always have a string but..</text>
<text text-anchor="middle" x="2704.5" y="-950.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if l then</text>
<text text-anchor="middle" x="2704.5" y="-934.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="2704.5" y="-919.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local indent, l_trim = lead_whitespace(l)</text>
<text text-anchor="middle" x="2704.5" y="-903.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_head = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="2704.5" y="-888.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_head then </text>
<text text-anchor="middle" x="2704.5" y="-873.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true </text>
<text text-anchor="middle" x="2704.5" y="-857.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isHeader, level, bareline = Header.match(l_trim) </text>
<text text-anchor="middle" x="2704.5" y="-810.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isHeader then &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="2704.5" y="-795.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local header = Header(bareline, level, start, finish, doc)</text>
<text text-anchor="middle" x="2704.5" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; make new block and append to doc</text>
<text text-anchor="middle" x="2704.5" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addSection(Section(header, linum, start, finish, doc.str), </text>
<text text-anchor="middle" x="2704.5" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum, start)</text>
<text text-anchor="middle" x="2704.5" y="-701.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2704.5" y="-686.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum, finish)</text>
<text text-anchor="middle" x="2704.5" y="-671.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-655.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2704.5" y="-640.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code block logic, including restarts</text>
<text text-anchor="middle" x="2704.5" y="-624.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;</text>
<text text-anchor="middle" x="2704.5" y="-609.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; NOTE that this will choke on unmatched code headers,</text>
<text text-anchor="middle" x="2704.5" y="-594.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; which I intend to fix. But it&#39;s fiddly.</text>
<text text-anchor="middle" x="2704.5" y="-578.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_foot = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="2704.5" y="-563.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_foot then </text>
<text text-anchor="middle" x="2704.5" y="-547.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="2704.5" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-517.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum, finish)</text>
<text text-anchor="middle" x="2704.5" y="-501.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-486.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif ER then</text>
<text text-anchor="middle" x="2704.5" y="-470.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;HUH?&quot;)</text>
<text text-anchor="middle" x="2704.5" y="-455.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-440.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="2704.5" y="-424.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;start = finish</text>
<text text-anchor="middle" x="2704.5" y="-409.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &lt; num_lines then start = start + 1 end</text>
<text text-anchor="middle" x="2704.5" y="-393.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-378.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (doc.latest) then</text>
<text text-anchor="middle" x="2704.5" y="-363.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="2704.5" y="-347.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(start) == &#39;number&#39;)</text>
<text text-anchor="middle" x="2704.5" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = start</text>
<text text-anchor="middle" x="2704.5" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2704.5" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(false, &quot;no doc.latest&quot;)</text>
<text text-anchor="middle" x="2704.5" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sections = doc:select(&quot;section&quot;)</text>
<text text-anchor="middle" x="2704.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, s in ipairs(sections) do</text>
<text text-anchor="middle" x="2704.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:check()</text>
<text text-anchor="middle" x="2704.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:block()</text>
<text text-anchor="middle" x="2704.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = doc:select(&quot;block&quot;)</text>
<text text-anchor="middle" x="2704.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="2704.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="2704.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local cbs = doc:select(&quot;codeblock&quot;)</text>
<text text-anchor="middle" x="2704.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(cbs) do</text>
<text text-anchor="middle" x="2704.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="2704.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2704.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.linum = linum &#45; 1</text>
<text text-anchor="middle" x="2704.5" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="2704.5" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2704.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return own</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2704.5,-1429.342C2704.5,-1390.2815 2704.5,-1292.0203 2704.5,-1175.668"/>
<polygon fill="#000000" stroke="#000000" points="2708.0001,-1175.4494 2704.5,-1165.4494 2701.0001,-1175.4495 2708.0001,-1175.4494"/>
</g>
</g>
</svg>