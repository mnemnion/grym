<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2791pt" height="1947pt"
 viewBox="0.00 0.00 2790.50 1946.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1942.6028)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1942.6028 2786.5,-1942.6028 2786.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1247.5" cy="-1920.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1247.5" y="-1916.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">43 &#160;</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1247.5" cy="-1848.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1247.5" y="-1844.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">48 &#160;</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1247.5,-1902.4341C1247.5,-1894.7337 1247.5,-1885.5771 1247.5,-1877.0194"/>
<polygon fill="#000000" stroke="#000000" points="1251.0001,-1877.016 1247.5,-1867.016 1244.0001,-1877.0161 1251.0001,-1877.016"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1067.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1067.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">on &#160;</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1223.2416,-1840.3811C1194.369,-1830.3955 1144.8615,-1812.6393 1103.5,-1794.6028 1101.7226,-1793.8277 1099.9074,-1793.0091 1098.0837,-1792.1656"/>
<polygon fill="#000000" stroke="#000000" points="1099.5584,-1788.9913 1089.0278,-1787.8262 1096.5334,-1795.3039 1099.5584,-1788.9913"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1139.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1139.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;5 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1228.1918,-1835.7306C1211.1445,-1824.3658 1186.0981,-1807.6682 1166.9656,-1794.9132"/>
<polygon fill="#000000" stroke="#000000" points="1168.9031,-1791.9984 1158.6411,-1789.3635 1165.0201,-1797.8227 1168.9031,-1791.9984"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1211.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1211.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;8 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1238.7854,-1831.1736C1234.5403,-1822.6834 1229.3464,-1812.2956 1224.6337,-1802.8702"/>
<polygon fill="#000000" stroke="#000000" points="1227.737,-1801.2505 1220.1343,-1793.8715 1221.476,-1804.381 1227.737,-1801.2505"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1283.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1283.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">13 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1256.2146,-1831.1736C1260.4597,-1822.6834 1265.6536,-1812.2956 1270.3663,-1802.8702"/>
<polygon fill="#000000" stroke="#000000" points="1273.524,-1804.381 1274.8657,-1793.8715 1267.263,-1801.2505 1273.524,-1804.381"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1592.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="1592.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">48 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1273.4311,-1843.1911C1334.2454,-1830.4994 1486.1781,-1798.7917 1556.1616,-1784.1865"/>
<polygon fill="#000000" stroke="#000000" points="1557.194,-1787.5465 1566.268,-1782.0773 1555.7639,-1780.6941 1557.194,-1787.5465"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2020.5" cy="-1776.6028" rx="27" ry="18"/>
<text text-anchor="middle" x="2020.5" y="-1772.4028" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">43 &#160;</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1274.5582,-1846.0825C1390.9852,-1835.2381 1849.4423,-1792.5357 1983.4973,-1780.0493"/>
<polygon fill="#000000" stroke="#000000" points="1984.0291,-1783.515 1993.6614,-1779.1026 1983.3799,-1776.5452 1984.0291,-1783.515"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-1715.1031 0,-1715.1031 0,-1644.5024 527,-1644.5024 527,-1715.1031"/>
<text text-anchor="middle" x="263.5" y="-1684.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Taking a multi&#45;pass approach to this Grimoire instance will benefit us </text>
<text text-anchor="middle" x="263.5" y="-1668.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">in a few ways. </text>
</g>
<!-- block_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1119.1219,-1764.6563C1114.16,-1762.2478 1108.7623,-1760.0223 1103.5,-1758.6028 859.2779,-1692.7258 786.9309,-1750.292 535.5,-1722.6028 519.2146,-1720.8093 502.4145,-1718.7289 485.5294,-1716.4706"/>
<polygon fill="#000000" stroke="#000000" points="485.9608,-1712.9972 475.5811,-1715.1212 485.0199,-1719.9336 485.9608,-1712.9972"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1002,-1707.1031 545,-1707.1031 545,-1652.5023 1002,-1652.5023 1002,-1707.1031"/>
<text text-anchor="middle" x="773.5" y="-1692.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">First, Grimoire itself is structured in a certain fashion. The </text>
<text text-anchor="middle" x="773.5" y="-1676.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">straightforward thing is to mirror that fashion in code.</text>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1190.5898,-1764.9621C1185.7414,-1762.5993 1180.5265,-1760.3167 1175.5,-1758.6028 1152.0478,-1750.6063 1034.9997,-1727.9642 933.2078,-1708.9916"/>
<polygon fill="#000000" stroke="#000000" points="933.5653,-1705.4981 923.0936,-1707.1091 932.2843,-1712.3799 933.5653,-1705.4981"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1547,-1722.4038 1020,-1722.4038 1020,-1637.2017 1547,-1637.2017 1547,-1722.4038"/>
<text text-anchor="middle" x="1283.5" y="-1707.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">Second, the critical path right now is simple code generation from </text>
<text text-anchor="middle" x="1283.5" y="-1692.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">Grimoire documents. Parsing prose gets useful later, for now I simply</text>
<text text-anchor="middle" x="1283.5" y="-1676.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">wish to unravel some existing code into Grimoire format and start working</text>
<text text-anchor="middle" x="1283.5" y="-1661.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">on it accordingly. </text>
</g>
<!-- block_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1283.5,-1758.3954C1283.5,-1750.9146 1283.5,-1741.8316 1283.5,-1732.5336"/>
<polygon fill="#000000" stroke="#000000" points="1287.0001,-1732.4257 1283.5,-1722.4257 1280.0001,-1732.4257 1287.0001,-1732.4257"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="1592.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="1592.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">46 &#160;</text>
</g>
<!-- block_6&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>block_6&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1592.5,-1758.3954C1592.5,-1744.1988 1592.5,-1724.232 1592.5,-1707.9766"/>
<polygon fill="#000000" stroke="#000000" points="1596.0001,-1707.9284 1592.5,-1697.9284 1589.0001,-1707.9285 1596.0001,-1707.9284"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1691.5,-1699.8027 1637.5,-1699.8027 1637.5,-1659.8027 1691.5,-1659.8027 1691.5,-1699.8027"/>
</g>
<!-- block_6&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_6&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1604.7138,-1760.182C1615.2368,-1746.0344 1630.6676,-1725.2885 1643.2166,-1708.4171"/>
<polygon fill="#000000" stroke="#000000" points="1646.3151,-1710.1158 1649.4749,-1700.0031 1640.6984,-1705.9381 1646.3151,-1710.1158"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="1912.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="1912.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">se &#160;</text>
</g>
<!-- section_7&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_7&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2001.2243,-1763.9425C1986.1623,-1753.6369 1965.0747,-1738.2773 1948.5,-1722.6028 1942.4485,-1716.8799 1936.4104,-1710.1867 1931.0562,-1703.816"/>
<polygon fill="#000000" stroke="#000000" points="1933.7249,-1701.5505 1924.6904,-1696.0163 1928.3018,-1705.9766 1933.7249,-1701.5505"/>
</g>
<!-- block_15 -->
<g id="node16" class="node">
<title>block_15</title>
<ellipse fill="none" stroke="#000000" cx="1984.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="1984.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">54 &#160;</text>
</g>
<!-- section_7&#45;&gt;block_15 -->
<g id="edge15" class="edge">
<title>section_7&#45;&gt;block_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2013.897,-1758.8482C2008.5179,-1744.3842 2000.8319,-1723.7175 1994.6681,-1707.1435"/>
<polygon fill="#000000" stroke="#000000" points="1997.8274,-1705.5976 1991.0611,-1697.4448 1991.2664,-1708.0376 1997.8274,-1705.5976"/>
</g>
<!-- block_16 -->
<g id="node17" class="node">
<title>block_16</title>
<ellipse fill="none" stroke="#000000" cx="2056.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="2056.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">67 &#160;</text>
</g>
<!-- section_7&#45;&gt;block_16 -->
<g id="edge16" class="edge">
<title>section_7&#45;&gt;block_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2027.103,-1758.8482C2032.4821,-1744.3842 2040.1681,-1723.7175 2046.3319,-1707.1435"/>
<polygon fill="#000000" stroke="#000000" points="2049.7336,-1708.0376 2049.9389,-1697.4448 2043.1726,-1705.5976 2049.7336,-1708.0376"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="2180.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="2180.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">71 &#160;</text>
</g>
<!-- section_7&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_7&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2040.7641,-1764.343C2068.7757,-1747.3959 2119.4885,-1716.7147 2151.5054,-1697.3445"/>
<polygon fill="#000000" stroke="#000000" points="2153.6562,-1700.134 2160.4004,-1691.963 2150.0327,-1694.1448 2153.6562,-1700.134"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2482.5" cy="-1679.8027" rx="27" ry="18"/>
<text text-anchor="middle" x="2482.5" y="-1675.6027" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">43 &#160;</text>
</g>
<!-- section_7&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_7&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2046.3291,-1771.191C2124.1981,-1754.8755 2356.8118,-1706.1374 2446.5939,-1687.3259"/>
<polygon fill="#000000" stroke="#000000" points="2447.4984,-1690.7125 2456.5681,-1685.2361 2446.0629,-1683.8612 2447.4984,-1690.7125"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1535.5,-1601.003 1225.5,-1601.003 1225.5,-1109.0017 1535.5,-1109.0017 1535.5,-1601.003"/>
<text text-anchor="middle" x="1380.5" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1554.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1523.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1507.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="1380.5" y="-1476.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1380.5" y="-1444.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;../lib/ansi&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1429.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1382.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1350.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1319.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1287.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1272.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1257.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1241.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="1380.5" y="-1210.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = {}</text>
<text text-anchor="middle" x="1380.5" y="-1178.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local blue = tostring(a.blue)</text>
<text text-anchor="middle" x="1380.5" y="-1163.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local red = tostring(a.red)</text>
<text text-anchor="middle" x="1380.5" y="-1148.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local dim = tostring(a.dim)</text>
<text text-anchor="middle" x="1380.5" y="-1132.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local green = tostring(a.green)</text>
<text text-anchor="middle" x="1380.5" y="-1117.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local cl &#160;&#160;= tostring(a.clear)</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.6954,-1663.2493C1572.5208,-1649.1931 1558.169,-1627.205 1541.2528,-1601.2881"/>
<polygon fill="#000000" stroke="#000000" points="1544.0705,-1599.2015 1535.6737,-1592.7405 1538.2087,-1603.0276 1544.0705,-1599.2015"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1975.5,-1398.2027 1553.5,-1398.2027 1553.5,-1311.802 1975.5,-1311.802 1975.5,-1398.2027"/>
<text text-anchor="middle" x="1764.5" y="-1366.9024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Trims leading whitespace, returning the amount taken and</text>
<text text-anchor="middle" x="1764.5" y="-1351.5024" font-family="Inconsolata" font-size="14.00" fill="#000000">the trimmed string.</text>
<text text-anchor="middle" x="1764.5" y="-1336.1023" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_15&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_15&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1973.2877,-1663.2493C1941.544,-1616.384 1850.077,-1481.3452 1799.3772,-1406.4938"/>
<polygon fill="#000000" stroke="#000000" points="1802.2087,-1404.433 1793.7028,-1398.1163 1796.413,-1408.3586 1802.2087,-1404.433"/>
</g>
<!-- codeblock_20 -->
<g id="node21" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="2020.5" cy="-1355.0023" rx="27" ry="18"/>
<text text-anchor="middle" x="2020.5" y="-1350.8023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">65 &#160;</text>
</g>
<!-- block_16&#45;&gt;codeblock_20 -->
<g id="edge20" class="edge">
<title>block_16&#45;&gt;codeblock_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2054.4613,-1661.4094C2048.4591,-1607.2557 2030.8219,-1448.1287 2023.6185,-1383.1384"/>
<polygon fill="#000000" stroke="#000000" points="2027.0967,-1382.7474 2022.5163,-1373.1939 2020.1393,-1383.5186 2027.0967,-1382.7474"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2119.5,-1375.0023 2065.5,-1375.0023 2065.5,-1335.0023 2119.5,-1335.0023 2119.5,-1375.0023"/>
</g>
<!-- block_16&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_16&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2058.5387,-1661.4094C2064.4705,-1607.8913 2081.7657,-1451.8496 2089.1236,-1385.4653"/>
<polygon fill="#000000" stroke="#000000" points="2092.6333,-1385.57 2090.2563,-1375.2452 2085.6759,-1384.7988 2092.6333,-1385.57"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2399,-1390.3027 2138,-1390.3027 2138,-1319.702 2399,-1319.702 2399,-1390.3027"/>
<text text-anchor="middle" x="2268.5" y="-1375.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes a string, parsing ownership.</text>
<text text-anchor="middle" x="2268.5" y="-1359.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> Returns a Doc.</text>
</g>
<!-- block_17&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_17&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2185.3566,-1661.8774C2198.7605,-1612.4048 2236.5782,-1472.8229 2256.2572,-1400.1894"/>
<polygon fill="#000000" stroke="#000000" points="2259.6723,-1400.9685 2258.9092,-1390.4012 2252.9158,-1399.1379 2259.6723,-1400.9685"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2482.5" cy="-1355.0023" rx="27" ry="18"/>
<text text-anchor="middle" x="2482.5" y="-1350.8023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">42 &#160;</text>
</g>
<!-- block_18&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>block_18&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2482.5,-1661.4094C2482.5,-1607.3674 2482.5,-1448.7844 2482.5,-1383.5416"/>
<polygon fill="#000000" stroke="#000000" points="2486.0001,-1383.1939 2482.5,-1373.1939 2479.0001,-1383.1939 2486.0001,-1383.1939"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2581.5,-1373.0023 2527.5,-1373.0023 2527.5,-1337.0023 2581.5,-1337.0023 2581.5,-1373.0023"/>
</g>
<!-- block_18&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_18&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2491.9691,-1662.8226C2500.2488,-1647.2217 2511.9449,-1623.2183 2518.5,-1601.0027 2541.1175,-1524.3503 2549.8501,-1429.8918 2552.9513,-1383.4823"/>
<polygon fill="#000000" stroke="#000000" points="2556.4582,-1383.4808 2553.5928,-1373.2808 2549.472,-1383.0414 2556.4582,-1383.4808"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2202,-609.6018 1801,-609.6018 1801,-463.4002 2202,-463.4002 2202,-609.6018"/>
<text text-anchor="middle" x="2001.5" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function lead_whitespace(str)</text>
<text text-anchor="middle" x="2001.5" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_ws = L.match(m.WS, str)</text>
<text text-anchor="middle" x="2001.5" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lead_ws &gt; 1 then</text>
<text text-anchor="middle" x="2001.5" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; &#160;io.write(green..(&quot;%&quot;):rep(lead_ws &#45; 1)..cl)</text>
<text text-anchor="middle" x="2001.5" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return lead_ws, str:sub(lead_ws)</text>
<text text-anchor="middle" x="2001.5" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2001.5" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0, str</text>
<text text-anchor="middle" x="2001.5" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2001.5" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2020.0765,-1336.7592C2017.8826,-1242.2494 2007.746,-805.5716 2003.4416,-620.1446"/>
<polygon fill="#000000" stroke="#000000" points="2006.9351,-619.8173 2003.2039,-609.9012 1999.937,-619.9798 2006.9351,-619.8173"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2782.5,-1073.003 2220.5,-1073.003 2220.5,.001 2782.5,.001 2782.5,-1073.003"/>
<text text-anchor="middle" x="2501.5" y="-1057.802" font-family="Inconsolata" font-size="14.00" fill="#000000">function own(doc, str)</text>
<text text-anchor="middle" x="2501.5" y="-1042.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 1</text>
<text text-anchor="middle" x="2501.5" y="-1027.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc_level = 0</text>
<text text-anchor="middle" x="2501.5" y="-1011.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local start = 1</text>
<text text-anchor="middle" x="2501.5" y="-996.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local num_lines = #(epeg.split(str,&quot;\n&quot;))</text>
<text text-anchor="middle" x="2501.5" y="-980.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks separately to avoid `* A` type collisions in code</text>
<text text-anchor="middle" x="2501.5" y="-965.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="2501.5" y="-950.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="2501.5" y="-934.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local finish = start + #line</text>
<text text-anchor="middle" x="2501.5" y="-919.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; tab and return filtration</text>
<text text-anchor="middle" x="2501.5" y="-903.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l, err = line:gsub(&quot;\t&quot;, &quot; &#160;&quot;):gsub(&quot;\r&quot;, &quot;&quot;) </text>
<text text-anchor="middle" x="2501.5" y="-888.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We should always have a string but..</text>
<text text-anchor="middle" x="2501.5" y="-873.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if l then</text>
<text text-anchor="middle" x="2501.5" y="-857.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="2501.5" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local indent, l_trim = lead_whitespace(l)</text>
<text text-anchor="middle" x="2501.5" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_head = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="2501.5" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_head then </text>
<text text-anchor="middle" x="2501.5" y="-796.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true </text>
<text text-anchor="middle" x="2501.5" y="-780.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-765.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isHeader, level, bareline = Header.match(l_trim) </text>
<text text-anchor="middle" x="2501.5" y="-733.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isHeader then &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="2501.5" y="-718.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local header = Header(bareline, level, start, finish, doc)</text>
<text text-anchor="middle" x="2501.5" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; make new block and append to doc</text>
<text text-anchor="middle" x="2501.5" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addSection(Section(header, linum), linum)</text>
<text text-anchor="middle" x="2501.5" y="-640.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2501.5" y="-624.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum)</text>
<text text-anchor="middle" x="2501.5" y="-609.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-594.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2501.5" y="-578.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code block logic, including restarts</text>
<text text-anchor="middle" x="2501.5" y="-563.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;</text>
<text text-anchor="middle" x="2501.5" y="-547.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; NOTE that this will choke on unmatched code headers,</text>
<text text-anchor="middle" x="2501.5" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; which I intend to fix. But it&#39;s fiddly.</text>
<text text-anchor="middle" x="2501.5" y="-517.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local code_foot = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="2501.5" y="-501.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if code_foot then </text>
<text text-anchor="middle" x="2501.5" y="-486.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="2501.5" y="-470.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-455.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc:addLine(l, linum)</text>
<text text-anchor="middle" x="2501.5" y="-440.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-424.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif ER then</text>
<text text-anchor="middle" x="2501.5" y="-409.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;HUH?&quot;)</text>
<text text-anchor="middle" x="2501.5" y="-393.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-378.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="2501.5" y="-363.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;start = finish</text>
<text text-anchor="middle" x="2501.5" y="-347.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &lt; num_lines then start = start + 1 end</text>
<text text-anchor="middle" x="2501.5" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (doc.latest) then</text>
<text text-anchor="middle" x="2501.5" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="2501.5" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sections = doc:select(&quot;section&quot;)</text>
<text text-anchor="middle" x="2501.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, s in ipairs(sections) do</text>
<text text-anchor="middle" x="2501.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:check()</text>
<text text-anchor="middle" x="2501.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:block()</text>
<text text-anchor="middle" x="2501.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = doc:select(&quot;block&quot;)</text>
<text text-anchor="middle" x="2501.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="2501.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="2501.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local cbs = doc:select(&quot;codeblock&quot;)</text>
<text text-anchor="middle" x="2501.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(cbs) do</text>
<text text-anchor="middle" x="2501.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;v:toValue()</text>
<text text-anchor="middle" x="2501.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2501.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.linum = linum &#45; 1</text>
<text text-anchor="middle" x="2501.5" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="2501.5" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2501.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return own</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2482.9235,-1336.7592C2483.8379,-1297.3661 2486.1323,-1198.5264 2488.8091,-1083.2129"/>
<polygon fill="#000000" stroke="#000000" points="2492.311,-1083.1679 2489.0441,-1073.0893 2485.3129,-1083.0053 2492.311,-1083.1679"/>
</g>
</g>
</svg>