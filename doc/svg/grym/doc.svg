<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4898pt" height="1392pt"
 viewBox="0.00 0.00 4897.50 1392.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1388.2017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1388.2017 4893.5,-1388.2017 4893.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="762" cy="-1366.2017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="762" y="-1362.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 185</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="762" cy="-1294.2017" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="762" y="-1290.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;10</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M762,-1348.033C762,-1340.3326 762,-1331.176 762,-1322.6183"/>
<polygon fill="#000000" stroke="#000000" points="765.5001,-1322.6149 762,-1312.6149 758.5001,-1322.615 765.5001,-1322.6149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="150" cy="-1222.2017" rx="69.6687" ry="18"/>
<text text-anchor="middle" x="150" y="-1218.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Doc module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M705.5215,-1287.5571C594.4235,-1274.4868 347.5468,-1245.4425 223.7615,-1230.8795"/>
<polygon fill="#000000" stroke="#000000" points="223.9598,-1227.3788 213.6193,-1229.6863 223.1418,-1234.3308 223.9598,-1227.3788"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="529" cy="-1222.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="529" y="-1218.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;4</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M719.8055,-1281.163C678.891,-1268.5199 616.9912,-1249.3921 574.8729,-1236.377"/>
<polygon fill="#000000" stroke="#000000" points="575.7332,-1232.9796 565.1456,-1233.3711 573.6665,-1239.6676 575.7332,-1232.9796"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="762" cy="-1222.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="762" y="-1218.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 5&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M762,-1276.033C762,-1268.3326 762,-1259.176 762,-1250.6183"/>
<polygon fill="#000000" stroke="#000000" points="765.5001,-1250.6149 762,-1240.6149 758.5001,-1250.615 765.5001,-1250.6149"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1021" cy="-1222.2017" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1021" y="-1218.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M806.5237,-1281.8244C852.2982,-1269.0994 923.4336,-1249.3244 971.0863,-1236.0773"/>
<polygon fill="#000000" stroke="#000000" points="972.1836,-1239.405 980.8808,-1233.3545 970.3087,-1232.6608 972.1836,-1239.405"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1654" cy="-1222.2017" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="1654" y="-1218.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 11&#45;70</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M820.8716,-1289.4497C978.4136,-1276.7333 1409.3243,-1241.9513 1581.5106,-1228.0528"/>
<polygon fill="#000000" stroke="#000000" points="1581.8025,-1231.5407 1591.4885,-1227.2474 1581.2392,-1224.5634 1581.8025,-1231.5407"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1158.8016 0,-1158.8016 0,-1122.8016 54,-1122.8016 54,-1158.8016"/>
</g>
<!-- header_2&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>header_2&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M121.748,-1205.5976C104.5124,-1195.24 82.1805,-1181.4093 63,-1168.2017 61.3989,-1167.0992 59.7709,-1165.9537 58.1362,-1164.784"/>
<polygon fill="#000000" stroke="#000000" points="60.134,-1161.9088 49.9998,-1158.8187 55.9951,-1167.5541 60.134,-1161.9088"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="592,-1160.7037 72,-1160.7037 72,-1120.8995 592,-1120.8995 592,-1160.7037"/>
<text text-anchor="middle" x="332" y="-1129.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> Represents a Document, which is generally the same as a file, at first.</text>
</g>
<!-- block_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M497.3485,-1209.1233C468.3187,-1197.1282 424.6211,-1179.0725 389.4375,-1164.5347"/>
<polygon fill="#000000" stroke="#000000" points="390.3376,-1161.1197 379.7589,-1160.5355 387.6644,-1167.5891 390.3376,-1161.1197"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="913.5,-1158.8016 610.5,-1158.8016 610.5,-1122.8016 913.5,-1122.8016 913.5,-1158.8016"/>
<text text-anchor="middle" x="762" y="-1137.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> A document contains an array of blocks. </text>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M762,-1204.1363C762,-1193.8085 762,-1180.6296 762,-1168.9708"/>
<polygon fill="#000000" stroke="#000000" points="765.5001,-1168.8164 762,-1158.8164 758.5001,-1168.8165 765.5001,-1168.8164"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1396,-1168.102 932,-1168.102 932,-1113.5012 1396,-1113.5012 1396,-1168.102"/>
<text text-anchor="middle" x="1164" y="-1153.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> At some point documents can also contain documents, this is not</text>
<text text-anchor="middle" x="1164" y="-1137.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> currently supported.</text>
</g>
<!-- block_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1047.8972,-1206.8909C1064.5296,-1197.4233 1086.5234,-1184.9037 1106.8917,-1173.3094"/>
<polygon fill="#000000" stroke="#000000" points="1108.8456,-1176.2246 1115.8048,-1168.2358 1105.3826,-1170.1411 1108.8456,-1176.2246"/>
</g>
<!-- header_11 -->
<g id="node12" class="node">
<title>header_11</title>
<ellipse fill="none" stroke="#000000" cx="1460" cy="-1140.8016" rx="45.9718" ry="18"/>
<text text-anchor="middle" x="1460" y="-1136.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Fields</text>
</g>
<!-- section_6&#45;&gt;header_11 -->
<g id="edge11" class="edge">
<title>section_6&#45;&gt;header_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1614.3619,-1207.9054C1586.3368,-1197.5306 1548.0296,-1182.8081 1515,-1168.2017 1509.1095,-1165.5967 1502.9383,-1162.6965 1496.9465,-1159.7851"/>
<polygon fill="#000000" stroke="#000000" points="1498.2606,-1156.5307 1487.7444,-1155.2418 1495.1616,-1162.8073 1498.2606,-1156.5307"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="1579" cy="-1140.8016" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="1579" y="-1136.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;21</text>
</g>
<!-- section_6&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_6&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1637.7261,-1204.5391C1627.2369,-1193.1548 1613.4441,-1178.185 1601.8614,-1165.6139"/>
<polygon fill="#000000" stroke="#000000" points="1604.3345,-1163.1328 1594.9845,-1158.1501 1599.1865,-1167.876 1604.3345,-1163.1328"/>
</g>
<!-- codeblock_13 -->
<g id="node14" class="node">
<title>codeblock_13</title>
<ellipse fill="none" stroke="#000000" cx="1730" cy="-1140.8016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1730" y="-1136.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 22&#45;28</text>
</g>
<!-- section_6&#45;&gt;codeblock_13 -->
<g id="edge13" class="edge">
<title>section_6&#45;&gt;codeblock_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1670.4909,-1204.5391C1681.0476,-1193.2322 1694.9066,-1178.3885 1706.5939,-1165.8708"/>
<polygon fill="#000000" stroke="#000000" points="1709.2751,-1168.1277 1713.5413,-1158.4297 1704.1585,-1163.3506 1709.2751,-1168.1277"/>
</g>
<!-- section_14 -->
<g id="node15" class="node">
<title>section_14</title>
<ellipse fill="none" stroke="#000000" cx="2074" cy="-1140.8016" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2074" y="-1136.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;70</text>
</g>
<!-- section_6&#45;&gt;section_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;section_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1707.6199,-1211.8096C1785.0002,-1196.8126 1927.733,-1169.1496 2010.3528,-1153.1371"/>
<polygon fill="#000000" stroke="#000000" points="2011.2167,-1156.5349 2020.368,-1151.196 2009.8847,-1149.6627 2011.2167,-1156.5349"/>
</g>
<!-- section_15 -->
<g id="node16" class="node">
<title>section_15</title>
<ellipse fill="none" stroke="#000000" cx="3484" cy="-1140.8016" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3484" y="-1136.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 71&#45;185</text>
</g>
<!-- section_6&#45;&gt;section_15 -->
<g id="edge15" class="edge">
<title>section_6&#45;&gt;section_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1718.3251,-1219.3404C1996.6574,-1206.9599 3097.0281,-1158.0145 3404.0666,-1144.3571"/>
<polygon fill="#000000" stroke="#000000" points="3404.3847,-1147.8465 3414.2193,-1143.9055 3404.0736,-1140.8535 3404.3847,-1147.8465"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1075,-1021.2015 1021,-1021.2015 1021,-985.2015 1075,-985.2015 1075,-1021.2015"/>
</g>
<!-- header_11&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>header_11&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1434.4677,-1125.7546C1425.4372,-1121.0692 1415.0271,-1116.3604 1405,-1113.4016 1336.1542,-1093.0865 1142.6126,-1118.8383 1084,-1077.4016 1068.7508,-1066.6211 1059.6954,-1047.5648 1054.4807,-1031.464"/>
<polygon fill="#000000" stroke="#000000" points="1057.7193,-1030.0632 1051.5821,-1021.4269 1050.9941,-1032.0054 1057.7193,-1030.0632"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1571,-1077.6022 1093,-1077.6022 1093,-928.8008 1571,-928.8008 1571,-1077.6022"/>
<text text-anchor="middle" x="1332" y="-1030.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> In addition to the standard Node fields, a doc has:</text>
<text text-anchor="middle" x="1332" y="-1014.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1332" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: The current block. &#160;This will be in `doc[#doc]` but may</text>
<text text-anchor="middle" x="1332" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;be several layers deep.</text>
<text text-anchor="middle" x="1332" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lastOf: An array containing references to the last block of a</text>
<text text-anchor="middle" x="1332" y="-953.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;given level.</text>
</g>
<!-- block_12&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_12&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1550.666,-1125.0171C1531.0863,-1114.1096 1503.4091,-1098.6911 1474.3053,-1082.4777"/>
<polygon fill="#000000" stroke="#000000" points="1475.6739,-1079.2337 1465.2346,-1077.4246 1472.2672,-1085.3488 1475.6739,-1079.2337"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1871,-1045.8026 1589,-1045.8026 1589,-960.6004 1871,-960.6004 1871,-1045.8026"/>
<text text-anchor="middle" x="1730" y="-1030.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1730" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1730" y="-984.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="1730" y="-968.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = require &quot;grym/own&quot;</text>
</g>
<!-- codeblock_13&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>codeblock_13&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1730,-1122.5294C1730,-1105.5901 1730,-1079.5432 1730,-1056.1016"/>
<polygon fill="#000000" stroke="#000000" points="1733.5001,-1055.9039 1730,-1045.9039 1726.5001,-1055.904 1733.5001,-1055.9039"/>
</g>
<!-- header_19 -->
<g id="node20" class="node">
<title>header_19</title>
<ellipse fill="none" stroke="#000000" cx="1988" cy="-1003.2015" rx="99.1453" ry="18"/>
<text text-anchor="middle" x="1988" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Metatable for Docs.</text>
</g>
<!-- section_14&#45;&gt;header_19 -->
<g id="edge19" class="edge">
<title>section_14&#45;&gt;header_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2062.757,-1122.8128C2047.9491,-1099.1202 2021.7887,-1057.2635 2004.6737,-1029.8795"/>
<polygon fill="#000000" stroke="#000000" points="2007.5138,-1027.8197 1999.2458,-1021.1947 2001.5778,-1031.5297 2007.5138,-1027.8197"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="2161" cy="-1003.2015" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2161" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 30&#45;31</text>
</g>
<!-- section_14&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_14&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2085.3737,-1122.8128C2100.3538,-1099.1202 2126.8184,-1057.2635 2144.1324,-1029.8795"/>
<polygon fill="#000000" stroke="#000000" points="2147.2376,-1031.5175 2149.6235,-1021.1947 2141.321,-1027.7766 2147.2376,-1031.5175"/>
</g>
<!-- codeblock_21 -->
<g id="node22" class="node">
<title>codeblock_21</title>
<ellipse fill="none" stroke="#000000" cx="2317" cy="-1003.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2317" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;68</text>
</g>
<!-- section_14&#45;&gt;codeblock_21 -->
<g id="edge21" class="edge">
<title>section_14&#45;&gt;codeblock_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2116.1983,-1126.9278C2147.605,-1115.7301 2190.9225,-1098.4094 2226,-1077.4016 2249.6584,-1063.2326 2273.7245,-1043.3181 2291.1607,-1027.6872"/>
<polygon fill="#000000" stroke="#000000" points="2293.6409,-1030.1625 2298.6802,-1020.8429 2288.9289,-1024.9858 2293.6409,-1030.1625"/>
</g>
<!-- header_25 -->
<g id="node26" class="node">
<title>header_25</title>
<ellipse fill="none" stroke="#000000" cx="2602" cy="-1003.2015" rx="86.074" ry="18"/>
<text text-anchor="middle" x="2602" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Doc Constructor</text>
</g>
<!-- section_15&#45;&gt;header_25 -->
<g id="edge25" class="edge">
<title>section_15&#45;&gt;header_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3413.967,-1138.4969C3295.2318,-1133.5658 3047.3018,-1118.8346 2842,-1077.4016 2775.6079,-1064.0027 2701.4445,-1039.5536 2653.3721,-1022.3925"/>
<polygon fill="#000000" stroke="#000000" points="2654.4134,-1019.0475 2643.819,-1018.9553 2652.0436,-1025.6342 2654.4134,-1019.0475"/>
</g>
<!-- block_26 -->
<g id="node27" class="node">
<title>block_26</title>
<ellipse fill="none" stroke="#000000" cx="2907" cy="-1003.2015" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2907" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_15&#45;&gt;block_26 -->
<g id="edge26" class="edge">
<title>section_15&#45;&gt;block_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3414.0578,-1138.3013C3325.7738,-1133.4447 3170.201,-1119.187 3044,-1077.4016 3006.1647,-1064.8743 2966.4984,-1042.1871 2939.6425,-1025.1852"/>
<polygon fill="#000000" stroke="#000000" points="2941.3517,-1022.1232 2931.0471,-1019.6602 2937.5666,-1028.0117 2941.3517,-1022.1232"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="3130" cy="-1003.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3130" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 74&#45;92</text>
</g>
<!-- section_15&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>section_15&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3432.2833,-1128.4576C3374.329,-1114.3105 3284.2624,-1091.2934 3252,-1077.4016 3219.7566,-1063.518 3185.8543,-1042.2898 3161.9945,-1026.0907"/>
<polygon fill="#000000" stroke="#000000" points="3163.903,-1023.1555 3153.6801,-1020.3731 3159.9366,-1028.9234 3163.903,-1023.1555"/>
</g>
<!-- block_28 -->
<g id="node29" class="node">
<title>block_28</title>
<ellipse fill="none" stroke="#000000" cx="3322" cy="-1003.2015" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="3322" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 96&#45;101</text>
</g>
<!-- section_15&#45;&gt;block_28 -->
<g id="edge28" class="edge">
<title>section_15&#45;&gt;block_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3463.2873,-1123.3342C3448.2162,-1110.6143 3427.3253,-1092.9616 3409,-1077.4016 3389.2334,-1060.6178 3366.9875,-1041.6433 3349.9389,-1027.0836"/>
<polygon fill="#000000" stroke="#000000" points="3351.8976,-1024.1536 3342.0207,-1020.3197 3347.3509,-1029.4761 3351.8976,-1024.1536"/>
</g>
<!-- block_29 -->
<g id="node30" class="node">
<title>block_29</title>
<ellipse fill="none" stroke="#000000" cx="3484" cy="-1003.2015" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3484" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 102&#45;104</text>
</g>
<!-- section_15&#45;&gt;block_29 -->
<g id="edge29" class="edge">
<title>section_15&#45;&gt;block_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3484,-1122.5294C3484,-1099.2956 3484,-1058.9282 3484,-1031.6498"/>
<polygon fill="#000000" stroke="#000000" points="3487.5001,-1031.5493 3484,-1021.5493 3480.5001,-1031.5493 3487.5001,-1031.5493"/>
</g>
<!-- codeblock_30 -->
<g id="node31" class="node">
<title>codeblock_30</title>
<ellipse fill="none" stroke="#000000" cx="3767" cy="-1003.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3767" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 105&#45;154</text>
</g>
<!-- section_15&#45;&gt;codeblock_30 -->
<g id="edge30" class="edge">
<title>section_15&#45;&gt;codeblock_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3517.0176,-1124.7478C3568.2587,-1099.8334 3666.9334,-1051.8558 3723.7832,-1024.2143"/>
<polygon fill="#000000" stroke="#000000" points="3725.4107,-1027.3149 3732.8735,-1019.7945 3722.3497,-1021.0196 3725.4107,-1027.3149"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="4103" cy="-1003.2015" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4103" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 157&#45;158</text>
</g>
<!-- section_15&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_15&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3547.5548,-1132.8236C3623.2653,-1122.7105 3753.2965,-1103.4118 3863,-1077.4016 3929.6976,-1061.5879 4004.962,-1037.2231 4053.1331,-1020.7679"/>
<polygon fill="#000000" stroke="#000000" points="4054.3709,-1024.0435 4062.6916,-1017.485 4052.097,-1017.4231 4054.3709,-1024.0435"/>
</g>
<!-- structure_32 -->
<g id="node33" class="node">
<title>structure_32</title>
<ellipse fill="none" stroke="#000000" cx="4322" cy="-1003.2015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="4322" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_15&#45;&gt;structure_32 -->
<g id="edge32" class="edge">
<title>section_15&#45;&gt;structure_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3553.846,-1137.8191C3705.8327,-1130.7783 4062.203,-1111.1323 4178,-1077.4016 4218.9326,-1065.4783 4261.8823,-1041.6573 4290.1068,-1024.2103"/>
<polygon fill="#000000" stroke="#000000" points="4292.1255,-1027.0756 4298.732,-1018.7928 4288.4022,-1021.1479 4292.1255,-1027.0756"/>
</g>
<!-- structure_33 -->
<g id="node34" class="node">
<title>structure_33</title>
<ellipse fill="none" stroke="#000000" cx="4481" cy="-1003.2015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="4481" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_15&#45;&gt;structure_33 -->
<g id="edge33" class="edge">
<title>section_15&#45;&gt;structure_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3554.0194,-1137.9935C3750.7987,-1129.7979 4299.4253,-1104.7538 4376,-1077.4016 4406.4841,-1066.5128 4436.1255,-1044.1496 4456.0966,-1026.8064"/>
<polygon fill="#000000" stroke="#000000" points="4458.6368,-1029.231 4463.7775,-1019.9669 4453.9816,-1024.0032 4458.6368,-1029.231"/>
</g>
<!-- codeblock_34 -->
<g id="node35" class="node">
<title>codeblock_34</title>
<ellipse fill="none" stroke="#000000" cx="4714" cy="-1003.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4714" y="-999.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 165&#45;184</text>
</g>
<!-- section_15&#45;&gt;codeblock_34 -->
<g id="edge34" class="edge">
<title>section_15&#45;&gt;codeblock_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3554.7607,-1139.5875C3759.1559,-1135.5974 4347.7476,-1120.576 4535,-1077.4016 4584.5005,-1065.9884 4637.8853,-1042.2223 4673.3487,-1024.6476"/>
<polygon fill="#000000" stroke="#000000" points="4675.0446,-1027.7126 4682.411,-1020.0977 4671.9037,-1021.4568 4675.0446,-1027.7126"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2012,-536.5007 1958,-536.5007 1958,-500.5007 2012,-500.5007 2012,-536.5007"/>
</g>
<!-- header_19&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>header_19&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1987.8879,-985.0853C1987.434,-911.7516 1985.7308,-636.5793 1985.176,-546.9292"/>
<polygon fill="#000000" stroke="#000000" points="1988.6746,-546.686 1985.1127,-536.7079 1981.6747,-546.7294 1988.6746,-546.686"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2084,-536.5007 2030,-536.5007 2030,-500.5007 2084,-500.5007 2084,-536.5007"/>
</g>
<!-- block_20&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_20&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2146.6856,-985.7793C2130.5603,-965.0725 2105.0365,-928.8004 2093,-893.0014 2051.3814,-769.2197 2052.8122,-610.3574 2055.4352,-546.7099"/>
<polygon fill="#000000" stroke="#000000" points="2058.9349,-546.794 2055.8943,-536.6448 2051.9422,-546.4749 2058.9349,-546.794"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2538,-794.2016 2102,-794.2016 2102,-242.7998 2538,-242.7998 2538,-794.2016"/>
<text text-anchor="middle" x="2320" y="-778.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local D = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="2320" y="-763.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">D.id = &quot;doc&quot;</text>
<text text-anchor="middle" x="2320" y="-732.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__tostring = function (doc)</text>
<text text-anchor="middle" x="2320" y="-716.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2320" y="-701.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(doc) do</text>
<text text-anchor="middle" x="2320" y="-685.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="2320" y="-670.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if repr ~= &quot;&quot; and repr ~= &quot;\n&quot; then</text>
<text text-anchor="middle" x="2320" y="-655.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="2320" y="-639.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2320" y="-624.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2320" y="-592.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase </text>
<text text-anchor="middle" x="2320" y="-577.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2320" y="-530.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__index = D</text>
<text text-anchor="middle" x="2320" y="-498.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">D.own = own</text>
<text text-anchor="middle" x="2320" y="-467.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.dotLabel(doc)</text>
<text text-anchor="middle" x="2320" y="-451.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;doc &#45; &quot; .. tostring(doc.linum)</text>
<text text-anchor="middle" x="2320" y="-436.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">end </text>
<text text-anchor="middle" x="2320" y="-405.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.toMarkdown(doc)</text>
<text text-anchor="middle" x="2320" y="-389.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2320" y="-374.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(doc) do</text>
<text text-anchor="middle" x="2320" y="-358.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="2320" y="-343.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="2320" y="-328.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2320" y="-312.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method for &quot; .. node.id)</text>
<text text-anchor="middle" x="2320" y="-297.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2320" y="-281.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2320" y="-266.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="2320" y="-251.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_21&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>codeblock_21&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2317.1121,-985.0853C2317.3114,-952.889 2317.7515,-881.7873 2318.2295,-804.5614"/>
<polygon fill="#000000" stroke="#000000" points="2321.732,-804.147 2318.2941,-794.1255 2314.7321,-804.1036 2321.732,-804.147"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2610,-536.5007 2556,-536.5007 2556,-500.5007 2610,-500.5007 2610,-536.5007"/>
</g>
<!-- header_25&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>header_25&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2601.2899,-985.0853C2598.4152,-911.7516 2587.6286,-636.5793 2584.1144,-546.9292"/>
<polygon fill="#000000" stroke="#000000" points="2587.6028,-546.5631 2583.7137,-536.7079 2580.6082,-546.8373 2587.6028,-546.5631"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="2682,-536.5007 2628,-536.5007 2628,-500.5007 2682,-500.5007 2682,-536.5007"/>
</g>
<!-- block_26&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>block_26&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2860.2569,-993.3409C2809.4623,-979.9628 2730.311,-950.7798 2691,-893.0014 2616.6918,-783.7849 2637.3234,-613.4028 2649.2653,-546.6602"/>
<polygon fill="#000000" stroke="#000000" points="2652.7664,-546.978 2651.1611,-536.5055 2645.8852,-545.6933 2652.7664,-546.978"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2933.5,-654.1014 2700.5,-654.1014 2700.5,-382.9 2933.5,-382.9 2933.5,-654.1014"/>
<text text-anchor="middle" x="2817" y="-639.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">local d = {}</text>
<text text-anchor="middle" x="2817" y="-591.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.parentOf(doc, level)</text>
<text text-anchor="middle" x="2817" y="-576.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local i = level &#45; 1</text>
<text text-anchor="middle" x="2817" y="-560.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parent = nil</text>
<text text-anchor="middle" x="2817" y="-545.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;while i &gt; 0 do</text>
<text text-anchor="middle" x="2817" y="-530.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;parent = doc.lastOf[i]</text>
<text text-anchor="middle" x="2817" y="-514.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent then</text>
<text text-anchor="middle" x="2817" y="-499.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return parent</text>
<text text-anchor="middle" x="2817" y="-483.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2817" y="-468.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i = i &#45; 1</text>
<text text-anchor="middle" x="2817" y="-453.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2817" y="-437.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2817" y="-406.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="2817" y="-390.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_27&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3086.6006,-988.1684C3044.033,-971.3103 2980.1274,-940.0174 2942,-893.0014 2889.0096,-827.6573 2858.0976,-738.8843 2840.2741,-664.1691"/>
<polygon fill="#000000" stroke="#000000" points="2843.6282,-663.1398 2837.9517,-654.1939 2836.8105,-664.7271 2843.6282,-663.1398"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="3380.5,-561.0009 2951.5,-561.0009 2951.5,-476.0005 3380.5,-476.0005 3380.5,-561.0009"/>
<text text-anchor="middle" x="3166" y="-545.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This function looks at document level and places the block</text>
<text text-anchor="middle" x="3166" y="-530.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> accordingly.</text>
<text text-anchor="middle" x="3166" y="-515.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="3166" y="-499.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; doc : the document</text>
<text text-anchor="middle" x="3166" y="-484.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; block : block to be appended</text>
</g>
<!-- block_28&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_28&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3316.1693,-985.0853C3294.392,-917.4219 3217.3109,-677.9265 3182.8561,-570.8736"/>
<polygon fill="#000000" stroke="#000000" points="3186.1523,-569.6908 3179.7568,-561.244 3179.4889,-571.8354 3186.1523,-569.6908"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3569,-538.4028 3399,-538.4028 3399,-498.5986 3569,-498.5986 3569,-538.4028"/>
<text text-anchor="middle" x="3484" y="-523.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> returns: the document</text>
</g>
<!-- block_29&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>block_29&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3484,-985.0853C3484,-912.1725 3484,-639.731 3484,-548.4909"/>
<polygon fill="#000000" stroke="#000000" points="3487.5001,-548.2879 3484,-538.2879 3480.5001,-548.288 3487.5001,-548.2879"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="4170.5,-893.0021 3587.5,-893.0021 3587.5,-143.9993 4170.5,-143.9993 4170.5,-893.0021"/>
<text text-anchor="middle" x="3879" y="-877.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addSection(doc, section, linum, finish)</text>
<text text-anchor="middle" x="3879" y="-862.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;, &quot;type of putative section is &quot; .. section.id)</text>
<text text-anchor="middle" x="3879" y="-847.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in section at line &quot; .. tostring(linum))</text>
<text text-anchor="middle" x="3879" y="-831.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(finish) == &quot;number&quot;, &quot;finish is of type &quot; .. type(finish))</text>
<text text-anchor="middle" x="3879" y="-816.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not doc.latest then</text>
<text text-anchor="middle" x="3879" y="-800.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = &#160;section</text>
<text text-anchor="middle" x="3879" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3879" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="3879" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="3879" y="-739.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish &#160;&#160;</text>
<text text-anchor="middle" x="3879" y="-723.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-708.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local atLevel = doc.latest.level </text>
<text text-anchor="middle" x="3879" y="-693.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if atLevel &lt; section.level then</text>
<text text-anchor="middle" x="3879" y="-677.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; add the section under the latest section</text>
<text text-anchor="middle" x="3879" y="-662.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3879" y="-646.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3879" y="-631.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local parent = doc:parentOf(section.level)</text>
<text text-anchor="middle" x="3879" y="-616.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent.id == &quot;doc&quot; then</text>
<text text-anchor="middle" x="3879" y="-600.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.level == 1 and doc.latest.level == 1 then</text>
<text text-anchor="middle" x="3879" y="-585.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[#doc + 1] = section</text>
<text text-anchor="middle" x="3879" y="-569.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3879" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3879" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3879" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;parent:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3879" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = section</text>
<text text-anchor="middle" x="3879" y="-431.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf[section.level] = section</text>
<text text-anchor="middle" x="3879" y="-415.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="3879" y="-400.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3879" y="-353.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addLine(doc, line, linum, finish)</text>
<text text-anchor="middle" x="3879" y="-337.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if doc.latest then</text>
<text text-anchor="middle" x="3879" y="-322.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="3879" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="3879" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3879" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; a virtual zero block</text>
<text text-anchor="middle" x="3879" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = Section(0, linum, 1, #line, doc.str)</text>
<text text-anchor="middle" x="3879" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest = doc[1]</text>
<text text-anchor="middle" x="3879" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="3879" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="3879" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3879" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="3879" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_30&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>codeblock_30&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3771.1861,-985.0853C3775.2335,-967.5695 3781.9416,-938.539 3790.0907,-903.272"/>
<polygon fill="#000000" stroke="#000000" points="3793.5851,-903.6952 3792.4264,-893.1639 3786.7648,-902.1192 3793.5851,-903.6952"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="4345,-536.5007 4189,-536.5007 4189,-500.5007 4345,-500.5007 4345,-536.5007"/>
<text text-anchor="middle" x="4267" y="-515.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> Creates a Doc Node.</text>
</g>
<!-- block_31&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>block_31&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4118.4669,-985.3701C4135.7214,-964.5682 4163.2709,-928.4831 4179,-893.0014 4233.1162,-770.9263 4256.3792,-611.1049 4263.9731,-546.9555"/>
<polygon fill="#000000" stroke="#000000" points="4267.4746,-547.1422 4265.1367,-536.8085 4260.5202,-546.3446 4267.4746,-547.1422"/>
</g>
<!-- handleline_42 -->
<g id="node43" class="node">
<title>handleline_42</title>
<ellipse fill="none" stroke="#000000" cx="4413" cy="-518.5007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="4413" y="-514.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_32&#45;&gt;handleline_42 -->
<g id="edge42" class="edge">
<title>structure_32&#45;&gt;handleline_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4328.0361,-985.0557C4335.0729,-963.3627 4346.6711,-925.8627 4354,-893.0014 4382.5185,-765.1302 4402.3578,-609.6995 4409.7735,-546.8719"/>
<polygon fill="#000000" stroke="#000000" points="4413.2914,-546.921 4410.9741,-536.5827 4406.3386,-546.1096 4413.2914,-546.921"/>
</g>
<!-- handleline_45 -->
<g id="node46" class="node">
<title>handleline_45</title>
<ellipse fill="none" stroke="#000000" cx="4532" cy="-518.5007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="4532" y="-514.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_33&#45;&gt;handleline_45 -->
<g id="edge45" class="edge">
<title>structure_33&#45;&gt;handleline_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4482.9062,-985.0853C4490.6302,-911.677 4519.6348,-636.0193 4529.0375,-546.6562"/>
<polygon fill="#000000" stroke="#000000" points="4532.5185,-547.0193 4530.0842,-536.7079 4525.557,-546.2867 4532.5185,-547.0193"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="4889.5,-662.0012 4600.5,-662.0012 4600.5,-375.0002 4889.5,-375.0002 4889.5,-662.0012"/>
<text text-anchor="middle" x="4745" y="-646.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Doc, str)</text>
<text text-anchor="middle" x="4745" y="-631.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc = setmetatable({}, D)</text>
<text text-anchor="middle" x="4745" y="-616.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.str = str</text>
<text text-anchor="middle" x="4745" y="-600.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.first = 1</text>
<text text-anchor="middle" x="4745" y="-585.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.last = #str</text>
<text text-anchor="middle" x="4745" y="-569.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = nil</text>
<text text-anchor="middle" x="4745" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lines = {}</text>
<text text-anchor="middle" x="4745" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf = {}</text>
<text text-anchor="middle" x="4745" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; for now lets set root to &#39;false&#39;</text>
<text text-anchor="middle" x="4745" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.root = false</text>
<text text-anchor="middle" x="4745" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc:own(str)</text>
<text text-anchor="middle" x="4745" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4745" y="-446.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">setmetatable(D, Node)</text>
<text text-anchor="middle" x="4745" y="-414.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">d[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="4745" y="-383.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, d)</text>
</g>
<!-- codeblock_34&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_34&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4715.1587,-985.0853C4718.3948,-934.4861 4727.7767,-787.7953 4735.1662,-672.2569"/>
<polygon fill="#000000" stroke="#000000" points="4738.6616,-672.4401 4735.8071,-662.2371 4731.6758,-671.9933 4738.6616,-672.4401"/>
</g>
<!-- handle_43 -->
<g id="node44" class="node">
<title>handle_43</title>
<ellipse fill="none" stroke="#000000" cx="4413" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="4413" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_42&#45;&gt;handle_43 -->
<g id="edge43" class="edge">
<title>handleline_42&#45;&gt;handle_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4413,-500.3623C4413,-433.4369 4413,-200.0289 4413,-118.4271"/>
<polygon fill="#000000" stroke="#000000" points="4416.5001,-118.3826 4413,-108.3827 4409.5001,-118.3827 4416.5001,-118.3826"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="4440,-36 4386,-36 4386,0 4440,0 4440,-36"/>
</g>
<!-- handle_43&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>handle_43&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4413,-71.8314C4413,-64.131 4413,-54.9743 4413,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="4416.5001,-46.4132 4413,-36.4133 4409.5001,-46.4133 4416.5001,-46.4132"/>
</g>
<!-- handle_46 -->
<g id="node47" class="node">
<title>handle_46</title>
<ellipse fill="none" stroke="#000000" cx="4532" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="4532" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_45&#45;&gt;handle_46 -->
<g id="edge46" class="edge">
<title>handleline_45&#45;&gt;handle_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4532,-500.3623C4532,-433.4369 4532,-200.0289 4532,-118.4271"/>
<polygon fill="#000000" stroke="#000000" points="4535.5001,-118.3826 4532,-108.3827 4528.5001,-118.3827 4535.5001,-118.3826"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="4559,-36 4505,-36 4505,0 4559,0 4559,-36"/>
</g>
<!-- handle_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>handle_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4532,-71.8314C4532,-64.131 4532,-54.9743 4532,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="4535.5001,-46.4132 4532,-36.4133 4528.5001,-46.4133 4535.5001,-46.4132"/>
</g>
</g>
</svg>