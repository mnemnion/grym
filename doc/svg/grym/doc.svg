<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4889pt" height="4189pt"
 viewBox="0.00 0.00 4888.50 4188.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4184.806)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-4184.806 4884.5,-4184.806 4884.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1034" cy="-4162.806" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1034" y="-4158.606" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 185</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1034" cy="-4090.806" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1034" y="-4086.606" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;10</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1034,-4144.6374C1034,-4136.9369 1034,-4127.7803 1034,-4119.2226"/>
<polygon fill="#000000" stroke="#000000" points="1037.5001,-4119.2192 1034,-4109.2193 1030.5001,-4119.2193 1037.5001,-4119.2192"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="733" cy="-3946.6059" rx="69.6687" ry="18"/>
<text text-anchor="middle" x="733" y="-3942.4059" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Doc module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M975.1292,-4086.2746C928.1056,-4080.445 862.029,-4067.1395 812,-4036.806 785.7952,-4020.9175 763.6043,-3993.4742 749.4766,-3973.0197"/>
<polygon fill="#000000" stroke="#000000" points="752.2177,-3970.8226 743.7475,-3964.4582 746.4001,-3974.7156 752.2177,-3970.8226"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="867" cy="-3946.6059" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="867" y="-3942.4059" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;4</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M992.8184,-4077.5132C970.0372,-4068.6491 942.3142,-4055.2154 922,-4036.806 902.7,-4019.3157 887.888,-3993.4741 878.5236,-3973.9284"/>
<polygon fill="#000000" stroke="#000000" points="881.6063,-3972.2546 874.2484,-3964.6315 875.2465,-3975.1792 881.6063,-3972.2546"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="977" cy="-3946.6059" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="977" y="-3942.4059" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 5&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1026.8962,-4072.8345C1017.1255,-4048.1163 999.4481,-4003.3958 987.9712,-3974.3611"/>
<polygon fill="#000000" stroke="#000000" points="991.1244,-3972.817 984.1934,-3964.8039 984.6146,-3975.3903 991.1244,-3972.817"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1092" cy="-3946.6059" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1092" y="-3942.4059" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1041.2285,-4072.8345C1051.1706,-4048.1163 1069.158,-4003.3958 1080.8363,-3974.3611"/>
<polygon fill="#000000" stroke="#000000" points="1084.1959,-3975.3876 1084.6804,-3964.8039 1077.7015,-3972.7754 1084.1959,-3975.3876"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1571" cy="-3946.6059" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="1571" y="-3942.4059" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 11&#45;70</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1079.3215,-4078.6359C1177.0351,-4052.3969 1407.3378,-3990.5539 1514.4208,-3961.7991"/>
<polygon fill="#000000" stroke="#000000" points="1515.3315,-3965.1786 1524.0816,-3959.2048 1513.5161,-3958.4181 1515.3315,-3965.1786"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="2174,-4037.0065 1654,-4037.0065 1654,-3856.2053 2174,-3856.2053 2174,-4037.0065"/>
<text text-anchor="middle" x="1914" y="-4021.606" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Doc module</text>
<text text-anchor="middle" x="1914" y="-3990.206" font-family="Inconsolata" font-size="14.00" fill="#000000"> Represents a Document, which is generally the same as a file, at first.</text>
<text text-anchor="middle" x="1914" y="-3958.8059" font-family="Inconsolata" font-size="14.00" fill="#000000"> A document contains an array of blocks. </text>
<text text-anchor="middle" x="1914" y="-3927.4059" font-family="Inconsolata" font-size="14.00" fill="#000000"> At some point documents can also contain documents, this is not</text>
<text text-anchor="middle" x="1914" y="-3912.0059" font-family="Inconsolata" font-size="14.00" fill="#000000"> currently supported.</text>
<text text-anchor="middle" x="1914" y="-3864.6058" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_1&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>section_1&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1093.9562,-4087.3091C1222.7166,-4079.5146 1523.1025,-4059.7348 1643.6409,-4036.9327"/>
<polygon fill="#000000" stroke="#000000" points="1644.5872,-4040.3131 1653.7134,-4034.9314 1643.223,-4033.4473 1644.5872,-4040.3131"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="520,-3361.8072 0,-3361.8072 0,-3322.003 520,-3322.003 520,-3361.8072"/>
<text text-anchor="middle" x="260" y="-3330.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> Represents a Document, which is generally the same as a file, at first.</text>
</g>
<!-- block_3&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>block_3&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M861.409,-3928.6468C853.8356,-3907.573 838.1682,-3873.3596 812,-3856.4058 705.5895,-3787.4648 634.1729,-3891.2204 529,-3820.4058 362.8095,-3708.507 288.1631,-3457.6952 266.784,-3371.5899"/>
<polygon fill="#000000" stroke="#000000" points="270.1432,-3370.5904 264.3842,-3361.6974 263.3405,-3372.2407 270.1432,-3370.5904"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="841.5,-3359.9051 538.5,-3359.9051 538.5,-3323.9051 841.5,-3323.9051 841.5,-3359.9051"/>
<text text-anchor="middle" x="690" y="-3338.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> A document contains an array of blocks. </text>
</g>
<!-- block_4&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_4&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M969.6753,-3928.6636C960.8443,-3908.8658 944.3551,-3877.0757 922,-3856.4058 896.0225,-3832.3866 874.1437,-3847.1663 851,-3820.4058 731.3502,-3682.0576 699.7853,-3451.2972 692.2046,-3370.7223"/>
<polygon fill="#000000" stroke="#000000" points="695.6568,-3370.0267 691.2874,-3360.3748 688.6841,-3370.6448 695.6568,-3370.0267"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1324,-3369.2055 860,-3369.2055 860,-3314.6047 1324,-3314.6047 1324,-3369.2055"/>
<text text-anchor="middle" x="1092" y="-3354.1051" font-family="Inconsolata" font-size="14.00" fill="#000000"> At some point documents can also contain documents, this is not</text>
<text text-anchor="middle" x="1092" y="-3338.7051" font-family="Inconsolata" font-size="14.00" fill="#000000"> currently supported.</text>
</g>
<!-- block_5&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_5&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1092,-3928.5084C1092,-3844.946 1092,-3495.5684 1092,-3379.542"/>
<polygon fill="#000000" stroke="#000000" points="1095.5001,-3379.3729 1092,-3369.373 1088.5001,-3379.373 1095.5001,-3379.3729"/>
</g>
<!-- header_10 -->
<g id="node11" class="node">
<title>header_10</title>
<ellipse fill="none" stroke="#000000" cx="1388" cy="-3341.9051" rx="45.9718" ry="18"/>
<text text-anchor="middle" x="1388" y="-3337.7051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Fields</text>
</g>
<!-- section_6&#45;&gt;header_10 -->
<g id="edge10" class="edge">
<title>section_6&#45;&gt;header_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1545.7685,-3929.9717C1515.6354,-3908.5695 1466.3774,-3868.3763 1443,-3820.4058 1367.06,-3664.5767 1378.0437,-3447.3466 1384.97,-3370.3435"/>
<polygon fill="#000000" stroke="#000000" points="1388.4888,-3370.3104 1385.9516,-3360.0238 1381.5203,-3369.6474 1388.4888,-3370.3104"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="1507" cy="-3341.9051" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="1507" y="-3337.7051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;21</text>
</g>
<!-- section_6&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_6&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1569.0846,-3928.5084C1559.9849,-3842.5306 1521.1021,-3475.1481 1509.9817,-3370.0775"/>
<polygon fill="#000000" stroke="#000000" points="1513.4411,-3369.5081 1508.9079,-3359.932 1506.4799,-3370.2449 1513.4411,-3369.5081"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="1636" cy="-3341.9051" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1636" y="-3337.7051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 22&#45;70</text>
</g>
<!-- section_6&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_6&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1572.9453,-3928.5084C1582.1872,-3842.5306 1621.6775,-3475.1481 1632.9717,-3370.0775"/>
<polygon fill="#000000" stroke="#000000" points="1636.4734,-3370.2488 1634.0623,-3359.932 1629.5135,-3369.5006 1636.4734,-3370.2488"/>
</g>
<!-- section_13 -->
<g id="node14" class="node">
<title>section_13</title>
<ellipse fill="none" stroke="#000000" cx="1864" cy="-3341.9051" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1864" y="-3337.7051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;70</text>
</g>
<!-- section_6&#45;&gt;section_13 -->
<g id="edge13" class="edge">
<title>section_6&#45;&gt;section_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1583.1902,-3928.5902C1596.7995,-3909.3023 1620.1918,-3878.4974 1645,-3856.4058 1667.0968,-3836.7287 1682.7683,-3843.7095 1701,-3820.4058 1813.8499,-3676.162 1851.0301,-3449.1179 1860.9188,-3370.1181"/>
<polygon fill="#000000" stroke="#000000" points="1864.4192,-3370.3238 1862.1381,-3359.9774 1857.4693,-3369.4881 1864.4192,-3370.3238"/>
</g>
<!-- section_14 -->
<g id="node15" class="node">
<title>section_14</title>
<ellipse fill="none" stroke="#000000" cx="3177" cy="-3341.9051" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3177" y="-3337.7051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 71&#45;185</text>
</g>
<!-- section_6&#45;&gt;section_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;section_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1580.2274,-3928.5246C1592.0954,-3907.3305 1614.8275,-3872.9987 1645,-3856.4058 1760.3506,-3792.9707 1811.2992,-3852.3791 1939,-3820.4058 2426.147,-3698.4355 2981.0892,-3437.3474 3135.3415,-3362.4048"/>
<polygon fill="#000000" stroke="#000000" points="3137.0409,-3365.4702 3144.4991,-3357.9453 3133.9761,-3359.1768 3137.0409,-3365.4702"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="3744,-3820.4065 3266,-3820.4065 3266,-2863.4037 3744,-2863.4037 3744,-3820.4065"/>
<text text-anchor="middle" x="3505" y="-3805.2058" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Fields</text>
<text text-anchor="middle" x="3505" y="-3757.8058" font-family="Inconsolata" font-size="14.00" fill="#000000"> In addition to the standard Node fields, a doc has:</text>
<text text-anchor="middle" x="3505" y="-3742.4057" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="3505" y="-3727.0057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: The current block. &#160;This will be in `doc[#doc]` but may</text>
<text text-anchor="middle" x="3505" y="-3711.6057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;be several layers deep.</text>
<text text-anchor="middle" x="3505" y="-3696.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lastOf: An array containing references to the last block of a</text>
<text text-anchor="middle" x="3505" y="-3680.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;given level.</text>
<text text-anchor="middle" x="3505" y="-3633.4056" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3505" y="-3618.0056" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="3505" y="-3586.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="3505" y="-3571.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="3505" y="-3555.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = require &quot;grym/own&quot;</text>
<text text-anchor="middle" x="3505" y="-3540.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3505" y="-3509.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Metatable for Docs.</text>
<text text-anchor="middle" x="3505" y="-3477.6054" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3505" y="-3462.2053" font-family="Inconsolata" font-size="14.00" fill="#000000">local D = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="3505" y="-3446.8053" font-family="Inconsolata" font-size="14.00" fill="#000000">D.id = &quot;doc&quot;</text>
<text text-anchor="middle" x="3505" y="-3415.4053" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__tostring = function (doc)</text>
<text text-anchor="middle" x="3505" y="-3400.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3505" y="-3384.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(doc) do</text>
<text text-anchor="middle" x="3505" y="-3369.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="3505" y="-3353.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if repr ~= &quot;&quot; and repr ~= &quot;\n&quot; then</text>
<text text-anchor="middle" x="3505" y="-3338.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="3505" y="-3323.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3505" y="-3307.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3505" y="-3276.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase </text>
<text text-anchor="middle" x="3505" y="-3260.805" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3505" y="-3213.405" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__index = D</text>
<text text-anchor="middle" x="3505" y="-3182.0049" font-family="Inconsolata" font-size="14.00" fill="#000000">D.own = own</text>
<text text-anchor="middle" x="3505" y="-3150.6049" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.dotLabel(doc)</text>
<text text-anchor="middle" x="3505" y="-3135.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;doc &#45; &quot; .. tostring(doc.linum)</text>
<text text-anchor="middle" x="3505" y="-3119.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">end </text>
<text text-anchor="middle" x="3505" y="-3088.4048" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.toMarkdown(doc)</text>
<text text-anchor="middle" x="3505" y="-3073.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3505" y="-3057.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(doc) do</text>
<text text-anchor="middle" x="3505" y="-3042.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="3505" y="-3026.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="3505" y="-3011.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="3505" y="-2996.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method for &quot; .. node.id)</text>
<text text-anchor="middle" x="3505" y="-2980.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3505" y="-2965.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3505" y="-2949.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3505" y="-2934.4045" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3505" y="-2919.0045" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3505" y="-2871.6044" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_6&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>section_6&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1579.7569,-3928.3912C1591.3019,-3906.7189 1613.8574,-3871.5661 1645,-3856.4058 1806.0831,-3777.99 3104.9698,-3915.1878 3257,-3820.4058 3257.093,-3820.3478 3257.1861,-3820.2897 3257.279,-3820.2316"/>
<polygon fill="#000000" stroke="#000000" points="3259.3395,-3823.0671 3265.8309,-3814.6938 3255.5347,-3817.1915 3259.3395,-3823.0671"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1330,-2013.4037 852,-2013.4037 852,-1864.6022 1330,-1864.6022 1330,-2013.4037"/>
<text text-anchor="middle" x="1091" y="-1966.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> In addition to the standard Node fields, a doc has:</text>
<text text-anchor="middle" x="1091" y="-1950.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1091" y="-1935.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: The current block. &#160;This will be in `doc[#doc]` but may</text>
<text text-anchor="middle" x="1091" y="-1919.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;be several layers deep.</text>
<text text-anchor="middle" x="1091" y="-1904.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lastOf: An array containing references to the last block of a</text>
<text text-anchor="middle" x="1091" y="-1889.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;given level.</text>
</g>
<!-- block_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1510.6554,-3323.7139C1523.4155,-3254.6641 1559.1637,-3005.5192 1443,-2863.4044 1412.0443,-2825.5331 1372.5156,-2863.0302 1339,-2827.4044 1123.434,-2598.266 1092.6722,-2197.6023 1090.0235,-2023.6297"/>
<polygon fill="#000000" stroke="#000000" points="1093.5217,-2023.4615 1089.8974,-2013.5059 1086.5223,-2023.5487 1093.5217,-2023.4615"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="1425" cy="-1939.003" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1425" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 22&#45;28</text>
</g>
<!-- block_12&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_12&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1638.7764,-3323.4929C1647.992,-3255.6975 1671.5699,-3016.0078 1571,-2863.4044 1553.8873,-2837.4378 1527.6096,-2853.6957 1511,-2827.4044 1327.6132,-2537.1213 1397.2596,-2083.7711 1419.3012,-1967.1182"/>
<polygon fill="#000000" stroke="#000000" points="1422.7583,-1967.6748 1421.2172,-1957.1926 1415.8852,-1966.348 1422.7583,-1967.6748"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1574,-1957.003 1520,-1957.003 1520,-1921.003 1574,-1921.003 1574,-1957.003"/>
</g>
<!-- block_12&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_12&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1633.7121,-3323.7132C1625.4584,-3257.3835 1596.9671,-3022.21 1583,-2827.4044 1558.7732,-2489.5024 1549.6273,-2078.0443 1547.5101,-1967.4782"/>
<polygon fill="#000000" stroke="#000000" points="1551.0037,-1967.0989 1547.3165,-1957.1664 1544.005,-1967.2303 1551.0037,-1967.0989"/>
</g>
<!-- header_19 -->
<g id="node20" class="node">
<title>header_19</title>
<ellipse fill="none" stroke="#000000" cx="1691" cy="-1939.003" rx="99.1453" ry="18"/>
<text text-anchor="middle" x="1691" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Metatable for Docs.</text>
</g>
<!-- section_13&#45;&gt;header_19 -->
<g id="edge19" class="edge">
<title>section_13&#45;&gt;header_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1861.6662,-3323.6813C1853.1645,-3257.2418 1823.0879,-3021.7391 1799,-2827.4044 1757.0135,-2488.6686 1707.5556,-2077.0733 1694.3687,-1967.1143"/>
<polygon fill="#000000" stroke="#000000" points="1697.8392,-1966.659 1693.1736,-1957.1468 1690.889,-1967.4923 1697.8392,-1966.659"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="1864" cy="-1939.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1864" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 30&#45;31</text>
</g>
<!-- section_13&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_13&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1864,-3323.6541C1864,-3174.1496 1864,-2151.9749 1864,-1967.5031"/>
<polygon fill="#000000" stroke="#000000" points="1867.5001,-1967.261 1864,-1957.261 1860.5001,-1967.261 1867.5001,-1967.261"/>
</g>
<!-- block_21 -->
<g id="node22" class="node">
<title>block_21</title>
<ellipse fill="none" stroke="#000000" cx="1994" cy="-1939.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1994" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 32&#45;70</text>
</g>
<!-- section_13&#45;&gt;block_21 -->
<g id="edge21" class="edge">
<title>section_13&#45;&gt;block_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1866.6503,-3323.7167C1876.2385,-3257.3987 1909.5766,-3022.2606 1929,-2827.4044 1962.6645,-2489.6817 1986.3794,-2078.0955 1992.463,-1967.4891"/>
<polygon fill="#000000" stroke="#000000" points="1995.9758,-1967.3497 1993.0271,-1957.1735 1988.9862,-1966.9674 1995.9758,-1967.3497"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2504,-2269.304 2068,-2269.304 2068,-1608.7019 2504,-1608.7019 2504,-2269.304"/>
<text text-anchor="middle" x="2286" y="-2254.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Metatable for Docs.</text>
<text text-anchor="middle" x="2286" y="-2222.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2286" y="-2207.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">local D = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="2286" y="-2192.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">D.id = &quot;doc&quot;</text>
<text text-anchor="middle" x="2286" y="-2160.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__tostring = function (doc)</text>
<text text-anchor="middle" x="2286" y="-2145.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2286" y="-2129.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(doc) do</text>
<text text-anchor="middle" x="2286" y="-2114.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="2286" y="-2099.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if repr ~= &quot;&quot; and repr ~= &quot;\n&quot; then</text>
<text text-anchor="middle" x="2286" y="-2083.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="2286" y="-2068.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2286" y="-2052.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2286" y="-2021.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase </text>
<text text-anchor="middle" x="2286" y="-2006.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2286" y="-1958.603" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__index = D</text>
<text text-anchor="middle" x="2286" y="-1927.203" font-family="Inconsolata" font-size="14.00" fill="#000000">D.own = own</text>
<text text-anchor="middle" x="2286" y="-1895.803" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.dotLabel(doc)</text>
<text text-anchor="middle" x="2286" y="-1880.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;doc &#45; &quot; .. tostring(doc.linum)</text>
<text text-anchor="middle" x="2286" y="-1865.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">end </text>
<text text-anchor="middle" x="2286" y="-1833.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.toMarkdown(doc)</text>
<text text-anchor="middle" x="2286" y="-1818.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2286" y="-1802.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(doc) do</text>
<text text-anchor="middle" x="2286" y="-1787.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="2286" y="-1772.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="2286" y="-1756.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2286" y="-1741.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method for &quot; .. node.id)</text>
<text text-anchor="middle" x="2286" y="-1725.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2286" y="-1710.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2286" y="-1695.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="2286" y="-1679.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2286" y="-1664.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2286" y="-1616.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_13&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>section_13&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1871.6549,-3323.9366C1899.4035,-3258.3737 1996.3681,-3025.5024 2059,-2827.4044 2115.5804,-2648.4467 2168.1929,-2445.8903 2208.4912,-2279.4306"/>
<polygon fill="#000000" stroke="#000000" points="2211.9377,-2280.0686 2210.8848,-2269.5263 2205.1336,-2278.4243 2211.9377,-2280.0686"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="2608" cy="-1939.003" rx="86.074" ry="18"/>
<text text-anchor="middle" x="2608" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Doc Constructor</text>
</g>
<!-- section_14&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_14&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3152.7139,-3324.8431C3071.8539,-3266.4838 2810.782,-3065.2433 2703,-2827.4044 2561.5814,-2515.3409 2593.4736,-2080.4334 2604.8876,-1966.9635"/>
<polygon fill="#000000" stroke="#000000" points="2608.3705,-1967.3088 2605.9218,-1957.0009 2601.4079,-1966.586 2608.3705,-1967.3088"/>
</g>
<!-- block_28 -->
<g id="node29" class="node">
<title>block_28</title>
<ellipse fill="none" stroke="#000000" cx="2768" cy="-1939.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2768" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_14&#45;&gt;block_28 -->
<g id="edge28" class="edge">
<title>section_14&#45;&gt;block_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3159.9567,-3324.2223C3101.4824,-3262.2715 2908.4687,-3046.8821 2833,-2827.4044 2722.2839,-2505.4204 2753.9291,-2080.158 2764.9567,-1967.4205"/>
<polygon fill="#000000" stroke="#000000" points="2768.4649,-1967.5133 2765.9837,-1957.2131 2761.5001,-1966.8125 2768.4649,-1967.5133"/>
</g>
<!-- block_29 -->
<g id="node30" class="node">
<title>block_29</title>
<ellipse fill="none" stroke="#000000" cx="2898" cy="-1939.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2898" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 74&#45;95</text>
</g>
<!-- section_14&#45;&gt;block_29 -->
<g id="edge29" class="edge">
<title>section_14&#45;&gt;block_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3166.9968,-3323.9403C3131.5698,-3259.3095 3011.5951,-3031.6317 2963,-2827.4044 2884.2694,-2496.5289 2892.8397,-2078.4869 2896.8184,-1967.2426"/>
<polygon fill="#000000" stroke="#000000" points="2900.319,-1967.2889 2897.1971,-1957.1645 2893.3239,-1967.0259 2900.319,-1967.2889"/>
</g>
<!-- block_30 -->
<g id="node31" class="node">
<title>block_30</title>
<ellipse fill="none" stroke="#000000" cx="3033" cy="-1939.003" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="3033" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 96&#45;101</text>
</g>
<!-- section_14&#45;&gt;block_30 -->
<g id="edge30" class="edge">
<title>section_14&#45;&gt;block_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.8987,-3323.7345C3162.6869,-3257.4779 3123.7738,-3022.5242 3102,-2827.4044 3064.3089,-2489.647 3040.4943,-2077.3508 3034.4962,-1967.1734"/>
<polygon fill="#000000" stroke="#000000" points="3037.9911,-1966.9822 3033.9564,-1957.1857 3031.0013,-1967.36 3037.9911,-1966.9822"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="3177" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3177" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 102&#45;104</text>
</g>
<!-- section_14&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_14&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3177,-3323.6541C3177,-3174.1496 3177,-2151.9749 3177,-1967.5031"/>
<polygon fill="#000000" stroke="#000000" points="3180.5001,-1967.261 3177,-1957.261 3173.5001,-1967.261 3180.5001,-1967.261"/>
</g>
<!-- block_32 -->
<g id="node33" class="node">
<title>block_32</title>
<ellipse fill="none" stroke="#000000" cx="3346" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3346" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 105&#45;156</text>
</g>
<!-- section_14&#45;&gt;block_32 -->
<g id="edge32" class="edge">
<title>section_14&#45;&gt;block_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3179.9167,-3323.7126C3190.495,-3257.3809 3227.5061,-3022.2014 3252,-2827.4044 3294.5083,-2489.3415 3333.2827,-2077.2642 3343.4281,-1967.1549"/>
<polygon fill="#000000" stroke="#000000" points="3346.9155,-1967.4519 3344.3455,-1957.1735 3339.9448,-1966.8112 3346.9155,-1967.4519"/>
</g>
<!-- block_33 -->
<g id="node34" class="node">
<title>block_33</title>
<ellipse fill="none" stroke="#000000" cx="3548" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3548" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 157&#45;158</text>
</g>
<!-- section_14&#45;&gt;block_33 -->
<g id="edge33" class="edge">
<title>section_14&#45;&gt;block_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.6462,-3323.6682C3161.8602,-3253.3905 3129.6101,-2997.3859 3257,-2863.4044 3308.4203,-2809.3235 3370.2233,-2882.09 3421,-2827.4044 3657.1746,-2573.0489 3578.4763,-2088.6125 3554.0716,-1967.1565"/>
<polygon fill="#000000" stroke="#000000" points="3557.4605,-1966.2592 3552.0205,-1957.1676 3550.6036,-1967.6673 3557.4605,-1966.2592"/>
</g>
<!-- block_34 -->
<g id="node35" class="node">
<title>block_34</title>
<ellipse fill="none" stroke="#000000" cx="3796" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3796" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 159&#45;161</text>
</g>
<!-- section_14&#45;&gt;block_34 -->
<g id="edge34" class="edge">
<title>section_14&#45;&gt;block_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.2696,-3323.6849C3159.8427,-3252.3735 3121.6213,-2989.926 3257,-2863.4044 3316.7091,-2807.6018 3562.5522,-2882.4059 3623,-2827.4044 3882.4804,-2591.303 3820.9482,-2091.3111 3800.9666,-1967.2906"/>
<polygon fill="#000000" stroke="#000000" points="3804.367,-1966.4006 3799.2809,-1957.1064 3797.461,-1967.5437 3804.367,-1966.4006"/>
</g>
<!-- block_35 -->
<g id="node36" class="node">
<title>block_35</title>
<ellipse fill="none" stroke="#000000" cx="4029" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4029" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 162&#45;164</text>
</g>
<!-- section_14&#45;&gt;block_35 -->
<g id="edge35" class="edge">
<title>section_14&#45;&gt;block_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.1231,-3323.5249C3159.1477,-3251.615 3119.1503,-2987.2291 3257,-2863.4044 3358.6805,-2772.069 3768.8482,-2918.2124 3871,-2827.4044 4132.6645,-2594.7975 4057.8808,-2091.2528 4034.6639,-1967.098"/>
<polygon fill="#000000" stroke="#000000" points="4038.0919,-1966.3893 4032.7749,-1957.2252 4031.2166,-1967.7048 4038.0919,-1966.3893"/>
</g>
<!-- block_36 -->
<g id="node37" class="node">
<title>block_36</title>
<ellipse fill="none" stroke="#000000" cx="4214" cy="-1939.003" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4214" y="-1934.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 165&#45;185</text>
</g>
<!-- section_14&#45;&gt;block_36 -->
<g id="edge36" class="edge">
<title>section_14&#45;&gt;block_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.0642,-3323.4589C3158.8689,-3251.302 3118.1587,-2986.1163 3257,-2863.4044 3327.5801,-2801.0237 4034.7602,-2891.2696 4104,-2827.4044 4359.3079,-2591.9143 4252.6845,-2090.5205 4221.4824,-1966.9585"/>
<polygon fill="#000000" stroke="#000000" points="4224.8364,-1965.9474 4218.9573,-1957.1334 4218.0567,-1967.6899 4224.8364,-1965.9474"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="4880.5,-2827.3058 4297.5,-2827.3058 4297.5,-1050.7001 4880.5,-1050.7001 4880.5,-2827.3058"/>
<text text-anchor="middle" x="4589" y="-2812.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Doc Constructor</text>
<text text-anchor="middle" x="4589" y="-2764.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4589" y="-2749.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">local d = {}</text>
<text text-anchor="middle" x="4589" y="-2702.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.parentOf(doc, level)</text>
<text text-anchor="middle" x="4589" y="-2686.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local i = level &#45; 1</text>
<text text-anchor="middle" x="4589" y="-2671.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parent = nil</text>
<text text-anchor="middle" x="4589" y="-2655.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;while i &gt; 0 do</text>
<text text-anchor="middle" x="4589" y="-2640.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;parent = doc.lastOf[i]</text>
<text text-anchor="middle" x="4589" y="-2625.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent then</text>
<text text-anchor="middle" x="4589" y="-2609.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return parent</text>
<text text-anchor="middle" x="4589" y="-2594.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-2578.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i = i &#45; 1</text>
<text text-anchor="middle" x="4589" y="-2563.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-2548.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-2516.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="4589" y="-2501.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4589" y="-2485.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4589" y="-2454.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a block to a document.</text>
<text text-anchor="middle" x="4589" y="-2423.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> This function looks at document level and places the block</text>
<text text-anchor="middle" x="4589" y="-2407.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> accordingly.</text>
<text text-anchor="middle" x="4589" y="-2392.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="4589" y="-2376.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; doc : the document</text>
<text text-anchor="middle" x="4589" y="-2361.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; block : block to be appended</text>
<text text-anchor="middle" x="4589" y="-2330.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> returns: the document</text>
<text text-anchor="middle" x="4589" y="-2282.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4589" y="-2267.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addSection(doc, section, linum, finish)</text>
<text text-anchor="middle" x="4589" y="-2251.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;, &quot;type of putative section is &quot; .. section.id)</text>
<text text-anchor="middle" x="4589" y="-2236.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in section at line &quot; .. tostring(linum))</text>
<text text-anchor="middle" x="4589" y="-2221.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(finish) == &quot;number&quot;, &quot;finish is of type &quot; .. type(finish))</text>
<text text-anchor="middle" x="4589" y="-2205.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not doc.latest then</text>
<text text-anchor="middle" x="4589" y="-2190.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = &#160;section</text>
<text text-anchor="middle" x="4589" y="-2174.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-2159.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="4589" y="-2144.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="4589" y="-2128.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish &#160;&#160;</text>
<text text-anchor="middle" x="4589" y="-2113.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-2097.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local atLevel = doc.latest.level </text>
<text text-anchor="middle" x="4589" y="-2082.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if atLevel &lt; section.level then</text>
<text text-anchor="middle" x="4589" y="-2067.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; add the section under the latest section</text>
<text text-anchor="middle" x="4589" y="-2051.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="4589" y="-2036.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-2020.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local parent = doc:parentOf(section.level)</text>
<text text-anchor="middle" x="4589" y="-2005.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent.id == &quot;doc&quot; then</text>
<text text-anchor="middle" x="4589" y="-1990.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.level == 1 and doc.latest.level == 1 then</text>
<text text-anchor="middle" x="4589" y="-1974.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[#doc + 1] = section</text>
<text text-anchor="middle" x="4589" y="-1959.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-1943.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="4589" y="-1928.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-1913.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-1897.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;parent:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="4589" y="-1882.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-1866.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-1851.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-1836.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = section</text>
<text text-anchor="middle" x="4589" y="-1820.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf[section.level] = section</text>
<text text-anchor="middle" x="4589" y="-1805.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="4589" y="-1789.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4589" y="-1742.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addLine(doc, line, linum, finish)</text>
<text text-anchor="middle" x="4589" y="-1727.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if doc.latest then</text>
<text text-anchor="middle" x="4589" y="-1711.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="4589" y="-1696.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="4589" y="-1680.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4589" y="-1665.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; a virtual zero block</text>
<text text-anchor="middle" x="4589" y="-1650.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = Section(0, linum, 1, #line, doc.str)</text>
<text text-anchor="middle" x="4589" y="-1634.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest = doc[1]</text>
<text text-anchor="middle" x="4589" y="-1619.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="4589" y="-1603.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="4589" y="-1588.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4589" y="-1557.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="4589" y="-1541.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4589" y="-1526.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4589" y="-1478.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> Creates a Doc Node.</text>
<text text-anchor="middle" x="4589" y="-1447.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> @Doc: this is d</text>
<text text-anchor="middle" x="4589" y="-1432.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> @str: the string representing the doc</text>
<text text-anchor="middle" x="4589" y="-1400.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> @return: a Doc representing this data. </text>
<text text-anchor="middle" x="4589" y="-1353.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4589" y="-1337.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Doc, str)</text>
<text text-anchor="middle" x="4589" y="-1322.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc = setmetatable({}, D)</text>
<text text-anchor="middle" x="4589" y="-1307.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.str = str</text>
<text text-anchor="middle" x="4589" y="-1291.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.first = 1</text>
<text text-anchor="middle" x="4589" y="-1276.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.last = #str</text>
<text text-anchor="middle" x="4589" y="-1260.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = nil</text>
<text text-anchor="middle" x="4589" y="-1245.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lines = {}</text>
<text text-anchor="middle" x="4589" y="-1230.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf = {}</text>
<text text-anchor="middle" x="4589" y="-1214.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; for now lets set root to &#39;false&#39;</text>
<text text-anchor="middle" x="4589" y="-1199.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.root = false</text>
<text text-anchor="middle" x="4589" y="-1183.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc:own(str)</text>
<text text-anchor="middle" x="4589" y="-1168.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4589" y="-1137.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">setmetatable(D, Node)</text>
<text text-anchor="middle" x="4589" y="-1105.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">d[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="4589" y="-1074.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, d)</text>
<text text-anchor="middle" x="4589" y="-1058.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_14&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>section_14&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3173.1337,-3323.9172C3158.9254,-3252.3611 3117.3763,-2985.865 3257,-2863.4044 3343.2591,-2787.7486 4196.9705,-2895.9246 4289,-2827.4044 4289.0867,-2827.3398 4289.1734,-2827.2753 4289.2601,-2827.2106"/>
<polygon fill="#000000" stroke="#000000" points="4291.4136,-2829.97 4297.2482,-2821.1265 4287.1722,-2824.4013 4291.4136,-2829.97"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1566,-1014.4025 1284,-1014.4025 1284,-929.2004 1566,-929.2004 1566,-1014.4025"/>
<text text-anchor="middle" x="1425" y="-999.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1425" y="-968.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1425" y="-952.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Section = require &quot;grym/section&quot;</text>
<text text-anchor="middle" x="1425" y="-937.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local own = require &quot;grym/own&quot;</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1425,-1920.9699C1425,-1809.0341 1425,-1207.9808 1425,-1024.8163"/>
<polygon fill="#000000" stroke="#000000" points="1428.5001,-1024.6282 1425,-1014.6282 1421.5001,-1024.6283 1428.5001,-1024.6282"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1877,-989.8015 1823,-989.8015 1823,-953.8015 1877,-953.8015 1877,-989.8015"/>
</g>
<!-- block_20&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_20&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1863.739,-1920.9699C1862.0371,-1803.3945 1852.524,-1146.174 1850.4144,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="1853.9093,-1000.0471 1850.2648,-990.0988 1846.91,-1000.1485 1853.9093,-1000.0471"/>
</g>
<!-- codeblock_23 -->
<g id="node24" class="node">
<title>codeblock_23</title>
<ellipse fill="none" stroke="#000000" cx="1972" cy="-971.8015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1972" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;68</text>
</g>
<!-- block_21&#45;&gt;codeblock_23 -->
<g id="edge23" class="edge">
<title>block_21&#45;&gt;codeblock_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1993.5898,-1920.9699C1990.9154,-1803.3945 1975.9663,-1146.174 1972.6512,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="1976.1428,-1000.0166 1972.4162,-990.0988 1969.1446,-1000.1759 1976.1428,-1000.0166"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2121,-989.8015 2067,-989.8015 2067,-953.8015 2121,-953.8015 2121,-989.8015"/>
</g>
<!-- block_21&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_21&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1993.0433,-1920.8039C1988.5941,-1827.2339 1973.5818,-1391.502 2059,-1050.6015 2063.4769,-1032.7346 2071.736,-1013.8383 2079.1073,-999.03"/>
<polygon fill="#000000" stroke="#000000" points="2082.3199,-1000.4355 2083.7743,-989.941 2076.0929,-997.238 2082.3199,-1000.4355"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2181,-794.2016 1745,-794.2016 1745,-242.7998 2181,-242.7998 2181,-794.2016"/>
<text text-anchor="middle" x="1963" y="-778.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local D = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="1963" y="-763.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">D.id = &quot;doc&quot;</text>
<text text-anchor="middle" x="1963" y="-732.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__tostring = function (doc)</text>
<text text-anchor="middle" x="1963" y="-716.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1963" y="-701.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(doc) do</text>
<text text-anchor="middle" x="1963" y="-685.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="1963" y="-670.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if repr ~= &quot;&quot; and repr ~= &quot;\n&quot; then</text>
<text text-anchor="middle" x="1963" y="-655.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1963" y="-639.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1963" y="-624.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1963" y="-592.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase </text>
<text text-anchor="middle" x="1963" y="-577.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1963" y="-530.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">D.__index = D</text>
<text text-anchor="middle" x="1963" y="-498.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">D.own = own</text>
<text text-anchor="middle" x="1963" y="-467.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.dotLabel(doc)</text>
<text text-anchor="middle" x="1963" y="-451.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;doc &#45; &quot; .. tostring(doc.linum)</text>
<text text-anchor="middle" x="1963" y="-436.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">end </text>
<text text-anchor="middle" x="1963" y="-405.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.toMarkdown(doc)</text>
<text text-anchor="middle" x="1963" y="-389.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1963" y="-374.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(doc) do</text>
<text text-anchor="middle" x="1963" y="-358.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="1963" y="-343.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="1963" y="-328.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="1963" y="-312.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method for &quot; .. node.id)</text>
<text text-anchor="middle" x="1963" y="-297.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1963" y="-281.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1963" y="-266.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1963" y="-251.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>codeblock_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1971.6416,-953.7518C1971.0869,-925.8126 1969.9508,-868.5915 1968.6796,-804.5643"/>
<polygon fill="#000000" stroke="#000000" points="1972.1724,-804.1618 1968.4745,-794.2333 1965.1738,-804.3008 1972.1724,-804.1618"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="2203,-989.8015 2149,-989.8015 2149,-953.8015 2203,-953.8015 2203,-989.8015"/>
</g>
<!-- block_28&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>block_28&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2769.7041,-1920.7617C2780.059,-1805.373 2829.9765,-1177.5976 2703,-1050.6015 2625.6456,-973.2353 2309.4252,-1064.3767 2212,-1014.6015 2204.4614,-1010.75 2197.882,-1004.5575 2192.4829,-998.0653"/>
<polygon fill="#000000" stroke="#000000" points="2195.1003,-995.7226 2186.2918,-989.8352 2189.5064,-999.9306 2195.1003,-995.7226"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="2298" cy="-971.8015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2298" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 74&#45;92</text>
</g>
<!-- block_29&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>block_29&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2899.6929,-1920.7728C2909.9785,-1805.4531 2959.5428,-1178.0297 2833,-1050.6015 2762.4672,-979.5753 2480.4475,-1041.3873 2384,-1014.6015 2366.8336,-1009.834 2349.0184,-1001.5924 2334.0852,-993.6063"/>
<polygon fill="#000000" stroke="#000000" points="2335.6379,-990.4656 2325.1912,-988.7002 2332.2568,-996.5949 2335.6379,-990.4656"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2605,-991.7035 2393,-991.7035 2393,-951.8994 2605,-951.8994 2605,-991.7035"/>
<text text-anchor="middle" x="2499" y="-960.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a block to a document.</text>
</g>
<!-- block_29&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>block_29&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2899.5537,-1920.9054C2908.9784,-1806.406 2954.1525,-1183.1651 2833,-1050.6015 2799.7278,-1014.1954 2661.6671,-1027.262 2614,-1014.6015 2594.5383,-1009.4324 2573.7701,-1002.2455 2555.3135,-995.2355"/>
<polygon fill="#000000" stroke="#000000" points="2556.4813,-991.9346 2545.8918,-991.5975 2553.9598,-998.4647 2556.4813,-991.9346"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3052.5,-1014.3016 2623.5,-1014.3016 2623.5,-929.3013 3052.5,-929.3013 3052.5,-1014.3016"/>
<text text-anchor="middle" x="2838" y="-999.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> This function looks at document level and places the block</text>
<text text-anchor="middle" x="2838" y="-983.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> accordingly.</text>
<text text-anchor="middle" x="2838" y="-968.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="2838" y="-952.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; doc : the document</text>
<text text-anchor="middle" x="2838" y="-937.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; block : block to be appended</text>
</g>
<!-- block_30&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>block_30&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3037.0789,-1920.9255C3058.0447,-1823.3957 3145.8117,-1353.187 2963,-1050.6015 2956.1815,-1039.3158 2947.0622,-1029.3854 2936.8408,-1020.721"/>
<polygon fill="#000000" stroke="#000000" points="2938.8322,-1017.8326 2928.8294,-1014.3405 2934.4713,-1023.3083 2938.8322,-1017.8326"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="3241,-991.7035 3071,-991.7035 3071,-951.8994 3241,-951.8994 3241,-991.7035"/>
<text text-anchor="middle" x="3156" y="-976.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> returns: the document</text>
</g>
<!-- block_31&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>block_31&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3176.6085,-1920.9699C3174.064,-1803.7812 3159.8798,-1150.4921 3156.6532,-1001.8845"/>
<polygon fill="#000000" stroke="#000000" points="3160.1482,-1001.6139 3156.4319,-991.6923 3153.1499,-1001.7659 3160.1482,-1001.6139"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3346" cy="-971.8015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3346" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 105&#45;154</text>
</g>
<!-- block_32&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>block_32&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3346,-1920.9699C3346,-1803.3945 3346,-1146.174 3346,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="3349.5001,-1000.0988 3346,-990.0988 3342.5001,-1000.0989 3349.5001,-1000.0988"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="3505,-989.8015 3451,-989.8015 3451,-953.8015 3505,-953.8015 3505,-989.8015"/>
</g>
<!-- block_32&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>block_32&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3348.4611,-1920.9699C3364.5073,-1803.3945 3454.2023,-1146.174 3474.0929,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="3477.6184,-1000.4803 3475.5028,-990.0988 3470.6827,-999.5337 3477.6184,-1000.4803"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="3679,-989.8015 3523,-989.8015 3523,-953.8015 3679,-953.8015 3679,-989.8015"/>
<text text-anchor="middle" x="3601" y="-968.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Creates a Doc Node.</text>
</g>
<!-- block_33&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>block_33&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3548.9882,-1920.9699C3555.431,-1803.3945 3591.4449,-1146.174 3599.4313,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="3602.9449,-1000.2754 3599.9974,-990.0988 3595.9554,-999.8923 3602.9449,-1000.2754"/>
</g>
<!-- structure_47 -->
<g id="node48" class="node">
<title>structure_47</title>
<ellipse fill="none" stroke="#000000" cx="3742" cy="-971.8015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="3742" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_34&#45;&gt;structure_47 -->
<g id="edge47" class="edge">
<title>block_34&#45;&gt;structure_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3794.9932,-1920.9699C3788.4288,-1803.3945 3751.7354,-1146.174 3743.5983,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="3747.0737,-999.8881 3743.0216,-990.0988 3740.0845,-1000.2784 3747.0737,-999.8881"/>
</g>
<!-- structure_48 -->
<g id="node49" class="node">
<title>structure_48</title>
<ellipse fill="none" stroke="#000000" cx="3849" cy="-971.8015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="3849" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_34&#45;&gt;structure_48 -->
<g id="edge48" class="edge">
<title>block_34&#45;&gt;structure_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3796.9882,-1920.9699C3803.431,-1803.3945 3839.4449,-1146.174 3847.4313,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="3850.9449,-1000.2754 3847.9974,-990.0988 3843.9554,-999.8923 3850.9449,-1000.2754"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3966,-989.8015 3912,-989.8015 3912,-953.8015 3966,-953.8015 3966,-989.8015"/>
</g>
<!-- block_34&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>block_34&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3798.6662,-1920.9699C3816.067,-1803.2767 3913.414,-1144.8564 3934.8319,-999.9931"/>
<polygon fill="#000000" stroke="#000000" points="3938.2944,-1000.5032 3936.2948,-990.0988 3931.3697,-999.4793 3938.2944,-1000.5032"/>
</g>
<!-- structure_56 -->
<g id="node57" class="node">
<title>structure_56</title>
<ellipse fill="none" stroke="#000000" cx="4029" cy="-971.8015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="4029" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_35&#45;&gt;structure_56 -->
<g id="edge56" class="edge">
<title>block_35&#45;&gt;structure_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4029,-1920.9699C4029,-1803.3945 4029,-1146.174 4029,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="4032.5001,-1000.0988 4029,-990.0988 4025.5001,-1000.0989 4032.5001,-1000.0988"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4146,-989.8015 4092,-989.8015 4092,-953.8015 4146,-953.8015 4146,-989.8015"/>
</g>
<!-- block_35&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>block_35&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4030.678,-1920.9699C4041.6186,-1803.3945 4102.7743,-1146.174 4116.3361,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="4119.8557,-1000.3801 4117.2974,-990.0988 4112.8858,-999.7315 4119.8557,-1000.3801"/>
</g>
<!-- codeblock_61 -->
<g id="node62" class="node">
<title>codeblock_61</title>
<ellipse fill="none" stroke="#000000" cx="4251" cy="-971.8015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4251" y="-967.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 165&#45;184</text>
</g>
<!-- block_36&#45;&gt;codeblock_61 -->
<g id="edge61" class="edge">
<title>block_36&#45;&gt;codeblock_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4214.6898,-1920.9699C4219.1877,-1803.3945 4244.3294,-1146.174 4249.9048,-1000.4296"/>
<polygon fill="#000000" stroke="#000000" points="4253.4151,-1000.2253 4250.3,-990.0988 4246.4202,-999.9577 4253.4151,-1000.2253"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="4410,-989.8015 4356,-989.8015 4356,-953.8015 4410,-953.8015 4410,-989.8015"/>
</g>
<!-- block_36&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>block_36&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4209.9477,-1920.8684C4189.1356,-1823.0415 4102.2422,-1351.538 4288,-1050.6015 4304.135,-1024.4621 4323.698,-1034.617 4347,-1014.6015 4352.7727,-1009.643 4358.385,-1003.7091 4363.394,-997.8616"/>
<polygon fill="#000000" stroke="#000000" points="4366.1729,-999.9926 4369.809,-990.0412 4360.7608,-995.553 4366.1729,-999.9926"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2432.5,-654.1014 2199.5,-654.1014 2199.5,-382.9 2432.5,-382.9 2432.5,-654.1014"/>
<text text-anchor="middle" x="2316" y="-639.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">local d = {}</text>
<text text-anchor="middle" x="2316" y="-591.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.parentOf(doc, level)</text>
<text text-anchor="middle" x="2316" y="-576.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local i = level &#45; 1</text>
<text text-anchor="middle" x="2316" y="-560.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parent = nil</text>
<text text-anchor="middle" x="2316" y="-545.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;while i &gt; 0 do</text>
<text text-anchor="middle" x="2316" y="-530.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;parent = doc.lastOf[i]</text>
<text text-anchor="middle" x="2316" y="-514.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent then</text>
<text text-anchor="middle" x="2316" y="-499.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return parent</text>
<text text-anchor="middle" x="2316" y="-483.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2316" y="-468.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i = i &#45; 1</text>
<text text-anchor="middle" x="2316" y="-453.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2316" y="-437.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2316" y="-406.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="2316" y="-390.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2298.7167,-953.7518C2300.6218,-905.7764 2305.9553,-771.4613 2310.1984,-664.6041"/>
<polygon fill="#000000" stroke="#000000" points="2313.7059,-664.4836 2310.6055,-654.3526 2306.7114,-664.2058 2313.7059,-664.4836"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="3637.5,-893.0021 3054.5,-893.0021 3054.5,-143.9993 3637.5,-143.9993 3637.5,-893.0021"/>
<text text-anchor="middle" x="3346" y="-877.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addSection(doc, section, linum, finish)</text>
<text text-anchor="middle" x="3346" y="-862.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;, &quot;type of putative section is &quot; .. section.id)</text>
<text text-anchor="middle" x="3346" y="-847.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in section at line &quot; .. tostring(linum))</text>
<text text-anchor="middle" x="3346" y="-831.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(finish) == &quot;number&quot;, &quot;finish is of type &quot; .. type(finish))</text>
<text text-anchor="middle" x="3346" y="-816.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not doc.latest then</text>
<text text-anchor="middle" x="3346" y="-800.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = &#160;section</text>
<text text-anchor="middle" x="3346" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3346" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="3346" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="3346" y="-739.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish &#160;&#160;</text>
<text text-anchor="middle" x="3346" y="-723.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-708.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local atLevel = doc.latest.level </text>
<text text-anchor="middle" x="3346" y="-693.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if atLevel &lt; section.level then</text>
<text text-anchor="middle" x="3346" y="-677.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; add the section under the latest section</text>
<text text-anchor="middle" x="3346" y="-662.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3346" y="-646.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3346" y="-631.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local parent = doc:parentOf(section.level)</text>
<text text-anchor="middle" x="3346" y="-616.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if parent.id == &quot;doc&quot; then</text>
<text text-anchor="middle" x="3346" y="-600.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.level == 1 and doc.latest.level == 1 then</text>
<text text-anchor="middle" x="3346" y="-585.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[#doc + 1] = section</text>
<text text-anchor="middle" x="3346" y="-569.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3346" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3346" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3346" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;parent:addSection(section, linum, finish)</text>
<text text-anchor="middle" x="3346" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = section</text>
<text text-anchor="middle" x="3346" y="-431.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf[section.level] = section</text>
<text text-anchor="middle" x="3346" y="-415.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="3346" y="-400.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3346" y="-353.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">function D.addLine(doc, line, linum, finish)</text>
<text text-anchor="middle" x="3346" y="-337.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if doc.latest then</text>
<text text-anchor="middle" x="3346" y="-322.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="3346" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="3346" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3346" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; a virtual zero block</text>
<text text-anchor="middle" x="3346" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc[1] = Section(0, linum, 1, #line, doc.str)</text>
<text text-anchor="middle" x="3346" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest = doc[1]</text>
<text text-anchor="middle" x="3346" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest:addLine(line)</text>
<text text-anchor="middle" x="3346" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;doc.latest.last = finish</text>
<text text-anchor="middle" x="3346" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3346" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc</text>
<text text-anchor="middle" x="3346" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_43&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3346,-953.7518C3346,-941.811 3346,-924.5217 3346,-903.6383"/>
<polygon fill="#000000" stroke="#000000" points="3349.5001,-903.4528 3346,-893.4529 3342.5001,-903.4529 3349.5001,-903.4528"/>
</g>
<!-- handleline_49 -->
<g id="node50" class="node">
<title>handleline_49</title>
<ellipse fill="none" stroke="#000000" cx="3736" cy="-518.5007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="3736" y="-514.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_47&#45;&gt;handleline_49 -->
<g id="edge49" class="edge">
<title>structure_47&#45;&gt;handleline_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3741.7611,-953.7518C3740.8382,-884.0262 3737.5014,-631.9284 3736.3746,-546.8038"/>
<polygon fill="#000000" stroke="#000000" points="3739.8717,-546.5547 3736.2396,-536.6019 3732.8723,-546.6474 3739.8717,-546.5547"/>
</g>
<!-- handleline_52 -->
<g id="node53" class="node">
<title>handleline_52</title>
<ellipse fill="none" stroke="#000000" cx="3855" cy="-518.5007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="3855" y="-514.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_48&#45;&gt;handleline_52 -->
<g id="edge52" class="edge">
<title>structure_48&#45;&gt;handleline_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3849.2389,-953.7518C3850.1618,-884.0262 3853.4986,-631.9284 3854.6254,-546.8038"/>
<polygon fill="#000000" stroke="#000000" points="3858.1277,-546.6474 3854.7604,-536.6019 3851.1283,-546.5547 3858.1277,-546.6474"/>
</g>
<!-- handle_50 -->
<g id="node51" class="node">
<title>handle_50</title>
<ellipse fill="none" stroke="#000000" cx="3736" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="3736" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_49&#45;&gt;handle_50 -->
<g id="edge50" class="edge">
<title>handleline_49&#45;&gt;handle_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3736,-500.3623C3736,-433.4369 3736,-200.0289 3736,-118.4271"/>
<polygon fill="#000000" stroke="#000000" points="3739.5001,-118.3826 3736,-108.3827 3732.5001,-118.3827 3739.5001,-118.3826"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="3763,-36 3709,-36 3709,0 3763,0 3763,-36"/>
</g>
<!-- handle_50&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>handle_50&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3736,-71.8314C3736,-64.131 3736,-54.9743 3736,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="3739.5001,-46.4132 3736,-36.4133 3732.5001,-46.4133 3739.5001,-46.4132"/>
</g>
<!-- handle_53 -->
<g id="node54" class="node">
<title>handle_53</title>
<ellipse fill="none" stroke="#000000" cx="3855" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="3855" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_52&#45;&gt;handle_53 -->
<g id="edge53" class="edge">
<title>handleline_52&#45;&gt;handle_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3855,-500.3623C3855,-433.4369 3855,-200.0289 3855,-118.4271"/>
<polygon fill="#000000" stroke="#000000" points="3858.5001,-118.3826 3855,-108.3827 3851.5001,-118.3827 3858.5001,-118.3826"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="3882,-36 3828,-36 3828,0 3882,0 3882,-36"/>
</g>
<!-- handle_53&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>handle_53&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3855,-71.8314C3855,-64.131 3855,-54.9743 3855,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="3858.5001,-46.4132 3855,-36.4133 3851.5001,-46.4133 3858.5001,-46.4132"/>
</g>
<!-- handleline_57 -->
<g id="node58" class="node">
<title>handleline_57</title>
<ellipse fill="none" stroke="#000000" cx="4029" cy="-518.5007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="4029" y="-514.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_56&#45;&gt;handleline_57 -->
<g id="edge57" class="edge">
<title>structure_56&#45;&gt;handleline_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4029,-953.7518C4029,-884.0262 4029,-631.9284 4029,-546.8038"/>
<polygon fill="#000000" stroke="#000000" points="4032.5001,-546.6019 4029,-536.6019 4025.5001,-546.602 4032.5001,-546.6019"/>
</g>
<!-- handle_58 -->
<g id="node59" class="node">
<title>handle_58</title>
<ellipse fill="none" stroke="#000000" cx="4029" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="4029" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_57&#45;&gt;handle_58 -->
<g id="edge58" class="edge">
<title>handleline_57&#45;&gt;handle_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4029,-500.3623C4029,-433.4369 4029,-200.0289 4029,-118.4271"/>
<polygon fill="#000000" stroke="#000000" points="4032.5001,-118.3826 4029,-108.3827 4025.5001,-118.3827 4032.5001,-118.3826"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4056,-36 4002,-36 4002,0 4056,0 4056,-36"/>
</g>
<!-- handle_58&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>handle_58&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4029,-71.8314C4029,-64.131 4029,-54.9743 4029,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="4032.5001,-46.4132 4029,-36.4133 4025.5001,-46.4133 4032.5001,-46.4132"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="4395.5,-662.0012 4106.5,-662.0012 4106.5,-375.0002 4395.5,-375.0002 4395.5,-662.0012"/>
<text text-anchor="middle" x="4251" y="-646.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Doc, str)</text>
<text text-anchor="middle" x="4251" y="-631.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local doc = setmetatable({}, D)</text>
<text text-anchor="middle" x="4251" y="-616.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.str = str</text>
<text text-anchor="middle" x="4251" y="-600.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.first = 1</text>
<text text-anchor="middle" x="4251" y="-585.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.last = #str</text>
<text text-anchor="middle" x="4251" y="-569.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.latest = nil</text>
<text text-anchor="middle" x="4251" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lines = {}</text>
<text text-anchor="middle" x="4251" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.lastOf = {}</text>
<text text-anchor="middle" x="4251" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; for now lets set root to &#39;false&#39;</text>
<text text-anchor="middle" x="4251" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;doc.root = false</text>
<text text-anchor="middle" x="4251" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return doc:own(str)</text>
<text text-anchor="middle" x="4251" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4251" y="-446.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">setmetatable(D, Node)</text>
<text text-anchor="middle" x="4251" y="-414.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">d[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="4251" y="-383.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, d)</text>
</g>
<!-- codeblock_61&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>codeblock_61&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4251,-953.7518C4251,-906.9329 4251,-777.8868 4251,-672.3782"/>
<polygon fill="#000000" stroke="#000000" points="4254.5001,-672.2447 4251,-662.2447 4247.5001,-672.2447 4254.5001,-672.2447"/>
</g>
</g>
</svg>