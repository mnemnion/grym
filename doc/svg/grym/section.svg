<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="16350pt" height="12013pt"
 viewBox="0.00 0.00 16349.50 12012.82" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 12008.8191)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-12008.8191 16345.5,-12008.8191 16345.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="2705.5" cy="-11986.8191" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="2705.5" y="-11982.6191" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 424</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="2705.5" cy="-11914.8191" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2705.5" y="-11910.6191" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;385</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2705.5,-11968.6505C2705.5,-11960.9501 2705.5,-11951.7934 2705.5,-11943.2357"/>
<polygon fill="#000000" stroke="#000000" points="2709.0001,-11943.2323 2705.5,-11933.2324 2702.0001,-11943.2324 2709.0001,-11943.2323"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1547.5" cy="-8858.2144" rx="93.3745" ry="18"/>
<text text-anchor="middle" x="1547.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Section metatable</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2639.5426,-11913.8772C2413.8252,-11910.3409 1684.2862,-11896.2065 1649.5,-11860.8191 777.622,-10973.8725 1441.4632,-9134.1793 1536.5796,-8886.1088"/>
<polygon fill="#000000" stroke="#000000" points="1539.9866,-8887.0015 1540.32,-8876.4119 1533.4556,-8884.4822 1539.9866,-8887.0015"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1704.5" cy="-8858.2144" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1704.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2639.9295,-11913.4963C2430.5672,-11908.9594 1790.008,-11892.5314 1759.5,-11860.8191 1650.5976,-11747.6179 1698.006,-9185.9617 1703.9247,-8886.6704"/>
<polygon fill="#000000" stroke="#000000" points="1707.4322,-8886.325 1704.132,-8876.2573 1700.4336,-8886.1856 1707.4322,-8886.325"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1814.5" cy="-8858.2144" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1814.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;9</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2639.8845,-11912.982C2447.3914,-11907.2791 1896.0068,-11888.5794 1869.5,-11860.8191 1761.0219,-11747.2112 1808.0556,-9185.9142 1813.9291,-8886.6663"/>
<polygon fill="#000000" stroke="#000000" points="1817.4365,-8886.3219 1814.1348,-8876.2546 1810.4378,-8886.1835 1817.4365,-8886.3219"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1934.5" cy="-8858.2144" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1934.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 10&#45;12</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2640.5182,-11912.1931C2470.0123,-11904.9932 2021.3811,-11883.9309 1999.5,-11860.8191 1783.7189,-11632.9011 1916.3401,-9177.5505 1932.8736,-8886.3792"/>
<polygon fill="#000000" stroke="#000000" points="1936.3772,-8886.4131 1933.4528,-8876.2299 1929.3886,-8886.0142 1936.3772,-8886.4131"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="2069.5" cy="-8858.2144" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2069.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 13&#45;385</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2640.0117,-11913.3723C2498.0786,-11909.5663 2172.1167,-11896.9469 2138.5,-11860.8191 1924.69,-11631.0383 2052.036,-9177.329 2067.9352,-8886.3594"/>
<polygon fill="#000000" stroke="#000000" points="2071.4385,-8886.3941 2068.4923,-8876.2172 2064.449,-8886.0101 2071.4385,-8886.3941"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2213.5" cy="-8858.2144" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2213.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;21</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2672.5191,-11899.0262C2657.2545,-11889.9902 2640.3555,-11877.172 2630.5,-11860.8191 1985.6954,-10790.9169 2178.11,-9123.78 2209.5537,-8886.6434"/>
<polygon fill="#000000" stroke="#000000" points="2213.0617,-8886.8174 2210.9253,-8876.4402 2206.1241,-8885.8847 2213.0617,-8886.8174"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2705.5" cy="-8858.2144" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2705.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 22&#45;29</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2705.5,-11896.4826C2705.5,-11658.5607 2705.5,-9180.4757 2705.5,-8886.6363"/>
<polygon fill="#000000" stroke="#000000" points="2709.0001,-8886.3941 2705.5,-8876.3941 2702.0001,-8886.3942 2709.0001,-8886.3941"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="3783.5" cy="-8858.2144" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3783.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 47&#45;80</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2736.0963,-11898.8793C2751.3181,-11889.5858 2768.8954,-11876.5829 2780.5,-11860.8191 3554.2714,-10809.7207 3755.5834,-9124.8522 3780.6606,-8886.5797"/>
<polygon fill="#000000" stroke="#000000" points="3784.1727,-8886.6429 3781.7231,-8876.3351 3777.21,-8885.9207 3784.1727,-8886.6429"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="6620.5" cy="-8858.2144" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6620.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 129&#45;172</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2770.902,-11913.1304C3007.7037,-11906.8381 3809.0236,-11883.9279 3858.5,-11860.8191 5394.9634,-11143.1871 6473.3515,-9141.5725 6606.581,-8885.3322"/>
<polygon fill="#000000" stroke="#000000" points="6609.7578,-8886.8089 6611.2506,-8876.3197 6603.5425,-8883.5886 6609.7578,-8886.8089"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="12518.5" cy="-8858.2144" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="12518.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 210&#45;223</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2771.2717,-11914.7919C3274.8879,-11914.4775 6505.7936,-11910.5233 6704.5,-11860.8191 9359.0174,-11196.8213 12165.2212,-9124.254 12487.7699,-8881.4981"/>
<polygon fill="#000000" stroke="#000000" points="12489.883,-8884.2883 12495.7624,-8875.4745 12485.6699,-8878.6982 12489.883,-8884.2883"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="14025.5" cy="-8858.2144" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="14025.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 367&#45;385</text>
</g>
<!-- section_1&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2771.2664,-11914.7008C3627.0162,-11913.1334 12547.3007,-11895.9547 12602.5,-11860.8191 13765.2982,-11120.6722 13997.1433,-9146.3759 14022.8764,-8886.5703"/>
<polygon fill="#000000" stroke="#000000" points="14026.3766,-8886.7366 14023.8598,-8876.445 14019.4094,-8886.0598 14026.3766,-8886.7366"/>
</g>
<!-- section_13 -->
<g id="node14" class="node">
<title>section_13</title>
<ellipse fill="none" stroke="#000000" cx="15196.5" cy="-8858.2144" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="15196.5" y="-8854.0144" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 386&#45;424</text>
</g>
<!-- section_1&#45;&gt;section_13 -->
<g id="edge13" class="edge">
<title>section_1&#45;&gt;section_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2771.3862,-11914.7664C3696.221,-11913.9971 14047.6658,-11904.4141 14109.5,-11860.8191 15192.158,-11097.5111 15200.7471,-9143.2895 15197.0852,-8886.2618"/>
<polygon fill="#000000" stroke="#000000" points="15200.5846,-8886.1873 15196.923,-8876.2454 15193.5855,-8886.3008 15200.5846,-8886.1873"/>
</g>
<!-- leaf_181 -->
<g id="node182" class="node">
<title>leaf_181</title>
<polygon fill="none" stroke="#c0c0c0" points="15873,-11860.9238 15290,-11860.9238 15290,-5855.5051 15873,-5855.5051 15873,-11860.9238"/>
<text text-anchor="middle" x="15581.5" y="-11845.6191" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Section metatable</text>
<text text-anchor="middle" x="15581.5" y="-11798.2191" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Sections consist of a header and body. &#160;The body may contain</text>
<text text-anchor="middle" x="15581.5" y="-11782.819" font-family="Inconsolata" font-size="14.00" fill="#000000"> one or more blocks, followed by zero or more child sections.</text>
<text text-anchor="middle" x="15581.5" y="-11751.419" font-family="Inconsolata" font-size="14.00" fill="#000000"> The header and block may both be virtual, but will always be</text>
<text text-anchor="middle" x="15581.5" y="-11736.019" font-family="Inconsolata" font-size="14.00" fill="#000000"> present.</text>
<text text-anchor="middle" x="15581.5" y="-11704.6189" font-family="Inconsolata" font-size="14.00" fill="#000000"> In the first pass, we fill a lines array with the raw</text>
<text text-anchor="middle" x="15581.5" y="-11689.2189" font-family="Inconsolata" font-size="14.00" fill="#000000"> contents of the section. </text>
<text text-anchor="middle" x="15581.5" y="-11657.8189" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is subsequently refined into various blocks. </text>
<text text-anchor="middle" x="15581.5" y="-11610.4189" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Array</text>
<text text-anchor="middle" x="15581.5" y="-11579.0188" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;The array portion of a section starts at [1] with a header. The</text>
<text text-anchor="middle" x="15581.5" y="-11563.6188" font-family="Inconsolata" font-size="14.00" fill="#000000"> rest consists, optionally, of nodes of types Block and Section.</text>
<text text-anchor="middle" x="15581.5" y="-11516.2188" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Fields</text>
<text text-anchor="middle" x="15581.5" y="-11484.8187" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; header : The header for the section.</text>
<text text-anchor="middle" x="15581.5" y="-11469.4187" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; level : The header level, lifted from the header for ease of use</text>
<text text-anchor="middle" x="15581.5" y="-11454.0187" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lines : An array of the lines owned by the section. Note that </text>
<text text-anchor="middle" x="15581.5" y="-11438.6186" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;this doesn&#39;t include the header. </text>
<text text-anchor="middle" x="15581.5" y="-11391.2186" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Includes</text>
<text text-anchor="middle" x="15581.5" y="-11359.8186" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-11344.4185" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11313.0185" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11297.6185" font-family="Inconsolata" font-size="14.00" fill="#000000">local status = require &quot;status&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11266.2184" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11234.8184" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11219.4184" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11204.0184" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11188.6183" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11173.2183" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-11125.8183" font-family="Inconsolata" font-size="14.00" fill="#000000">** Metatable for sections</text>
<text text-anchor="middle" x="15581.5" y="-11094.4182" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-11079.0182" font-family="Inconsolata" font-size="14.00" fill="#000000">local Sec, sec = u.inherit(Node)</text>
<text text-anchor="middle" x="15581.5" y="-11063.6182" font-family="Inconsolata" font-size="14.00" fill="#000000">Sec.id = &quot;section&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11032.2181" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.__tostring(section)</text>
<text text-anchor="middle" x="15581.5" y="-11016.8181" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="15581.5" y="-11001.4181" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(section) do</text>
<text text-anchor="middle" x="15581.5" y="-10986.018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="15581.5" y="-10970.618" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (repr ~= &quot;&quot; and repr ~= &quot;\n&quot;) then</text>
<text text-anchor="middle" x="15581.5" y="-10955.218" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="15581.5" y="-10939.8179" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10924.4179" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10893.0179" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="15581.5" y="-10877.6179" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-10862.2178" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-10814.8178" font-family="Inconsolata" font-size="14.00" fill="#000000">*** dotLabel(section)</text>
<text text-anchor="middle" x="15581.5" y="-10783.4178" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Produces a label for a dotfile.</text>
<text text-anchor="middle" x="15581.5" y="-10752.0177" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return : string in dot format.</text>
<text text-anchor="middle" x="15581.5" y="-10720.6177" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-10705.2177" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.dotLabel(section)</text>
<text text-anchor="middle" x="15581.5" y="-10689.8176" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;section: &quot; .. tostring(section.line_first) </text>
<text text-anchor="middle" x="15581.5" y="-10674.4176" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(section.line_last)</text>
<text text-anchor="middle" x="15581.5" y="-10659.0176" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-10643.6175" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-10596.2175" font-family="Inconsolata" font-size="14.00" fill="#000000">*** toMarkdown(section)</text>
<text text-anchor="middle" x="15581.5" y="-10564.8175" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Translates the Section to markdown.</text>
<text text-anchor="middle" x="15581.5" y="-10533.4174" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the Section.</text>
<text text-anchor="middle" x="15581.5" y="-10502.0174" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: A Markdown string. &#160;</text>
<text text-anchor="middle" x="15581.5" y="-10470.6174" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-10455.2174" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.toMarkdown(section)</text>
<text text-anchor="middle" x="15581.5" y="-10439.8173" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="15581.5" y="-10424.4173" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(section) do</text>
<text text-anchor="middle" x="15581.5" y="-10409.0173" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="15581.5" y="-10393.6172" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="15581.5" y="-10378.2172" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="15581.5" y="-10362.8172" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method in &quot; .. node.id)</text>
<text text-anchor="middle" x="15581.5" y="-10347.4171" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10332.0171" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10300.6171" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="15581.5" y="-10285.217" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-10269.817" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-10238.417" font-family="Inconsolata" font-size="14.00" fill="#000000">**** asserts</text>
<text text-anchor="middle" x="15581.5" y="-10207.0169" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-10191.6169" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.check(section)</text>
<text text-anchor="middle" x="15581.5" y="-10176.2169" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="15581.5" y="-10160.8169" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (i == 1) then</text>
<text text-anchor="middle" x="15581.5" y="-10145.4168" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.header then</text>
<text text-anchor="middle" x="15581.5" y="-10130.0168" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;header&quot;)</text>
<text text-anchor="middle" x="15581.5" y="-10114.6168" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10099.2167" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-10083.8167" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;section&quot; or v.id == &quot;block&quot;)</text>
<text text-anchor="middle" x="15581.5" y="-10068.4167" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10053.0166" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-10037.6166" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.level)</text>
<text text-anchor="middle" x="15581.5" y="-10022.2166" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;)</text>
<text text-anchor="middle" x="15581.5" y="-10006.8165" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="15581.5" y="-9991.4165" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.last, &quot;no last in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="15581.5" y="-9976.0165" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.str, &quot;no str in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="15581.5" y="-9960.6164" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.lines)</text>
<text text-anchor="middle" x="15581.5" y="-9945.2164" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_first)</text>
<text text-anchor="middle" x="15581.5" y="-9929.8164" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_last)</text>
<text text-anchor="middle" x="15581.5" y="-9914.4164" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-9899.0163" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-9851.6163" font-family="Inconsolata" font-size="14.00" fill="#000000">** addLine(section, line) </text>
<text text-anchor="middle" x="15581.5" y="-9820.2163" font-family="Inconsolata" font-size="14.00" fill="#000000">Add a line to a section.</text>
<text text-anchor="middle" x="15581.5" y="-9788.8162" font-family="Inconsolata" font-size="14.00" fill="#000000">These lines are later translated into blocks, and when the</text>
<text text-anchor="middle" x="15581.5" y="-9773.4162" font-family="Inconsolata" font-size="14.00" fill="#000000">parser is mature, =section.line= will be set to nil before</text>
<text text-anchor="middle" x="15581.5" y="-9758.0162" font-family="Inconsolata" font-size="14.00" fill="#000000">the Doc is returned. &#160;</text>
<text text-anchor="middle" x="15581.5" y="-9742.6161" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="15581.5" y="-9727.2161" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the section</text>
<text text-anchor="middle" x="15581.5" y="-9711.8161" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; line: the line</text>
<text text-anchor="middle" x="15581.5" y="-9680.416" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; return : the section</text>
<text text-anchor="middle" x="15581.5" y="-9649.016" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-9633.616" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addLine(section, line)</text>
<text text-anchor="middle" x="15581.5" y="-9618.2159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.lines[#section.lines + 1] = line</text>
<text text-anchor="middle" x="15581.5" y="-9602.8159" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="15581.5" y="-9587.4159" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-9572.0159" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-9524.6158" font-family="Inconsolata" font-size="14.00" fill="#000000">*** addSection(section, newsection, linum)</text>
<text text-anchor="middle" x="15581.5" y="-9493.2158" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Adds a section to the host section</text>
<text text-anchor="middle" x="15581.5" y="-9461.8158" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: &#160;Section to contain the new section.</text>
<text text-anchor="middle" x="15581.5" y="-9446.4157" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; newsection: &#160;The new section.</text>
<text text-anchor="middle" x="15581.5" y="-9431.0157" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: &#160;The line number.</text>
<text text-anchor="middle" x="15581.5" y="-9399.6157" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: the parent section.</text>
<text text-anchor="middle" x="15581.5" y="-9368.2156" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-9352.8156" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addSection(section, newsection, linum, finish)</text>
<text text-anchor="middle" x="15581.5" y="-9337.4156" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="15581.5" y="-9322.0155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="15581.5" y="-9306.6155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(finish) == &quot;number&quot;)</text>
<text text-anchor="middle" x="15581.5" y="-9291.2155" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.last = finish</text>
<text text-anchor="middle" x="15581.5" y="-9275.8154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-9260.4154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[#section + 1] = newsection</text>
<text text-anchor="middle" x="15581.5" y="-9245.0154" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="15581.5" y="-9229.6154" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-9214.2153" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-9166.8153" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Helper Functions for Blocking</text>
<text text-anchor="middle" x="15581.5" y="-9135.4153" font-family="Inconsolata" font-size="14.00" fill="#000000">Boolean match for a tagline</text>
<text text-anchor="middle" x="15581.5" y="-9104.0152" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-9088.6152" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isTagline(line)</text>
<text text-anchor="middle" x="15581.5" y="-9073.2152" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return L.match(m.tagline_p, line)</text>
<text text-anchor="middle" x="15581.5" y="-9057.8151" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-9042.4151" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-8995.0151" font-family="Inconsolata" font-size="14.00" fill="#000000">Lookahead, counting blank lines, return the number.</text>
<text text-anchor="middle" x="15581.5" y="-8963.615" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; lines: the full lines array of the section</text>
<text text-anchor="middle" x="15581.5" y="-8948.215" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: current index into lines</text>
<text text-anchor="middle" x="15581.5" y="-8916.815" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns: number of blank lines forward of index</text>
<text text-anchor="middle" x="15581.5" y="-8885.4149" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-8870.0149" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fwdBlanks(lines, linum)</text>
<text text-anchor="middle" x="15581.5" y="-8854.6149" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local fwd = 0</text>
<text text-anchor="middle" x="15581.5" y="-8839.2149" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local index = linum + 1</text>
<text text-anchor="middle" x="15581.5" y="-8823.8148" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if index &gt; #lines then </text>
<text text-anchor="middle" x="15581.5" y="-8808.4148" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0</text>
<text text-anchor="middle" x="15581.5" y="-8793.0148" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="15581.5" y="-8777.6147" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = index, #lines do</text>
<text text-anchor="middle" x="15581.5" y="-8762.2147" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if lines[i] == &quot;&quot; then</text>
<text text-anchor="middle" x="15581.5" y="-8746.8147" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fwd = fwd + 1</text>
<text text-anchor="middle" x="15581.5" y="-8731.4146" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-8716.0146" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="15581.5" y="-8700.6146" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-8685.2145" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-8669.8145" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-8654.4145" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return fwd</text>
<text text-anchor="middle" x="15581.5" y="-8639.0144" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-8623.6144" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-8592.2144" font-family="Inconsolata" font-size="14.00" fill="#000000">** Blocking</text>
<text text-anchor="middle" x="15581.5" y="-8560.8144" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Blocks a Section.</text>
<text text-anchor="middle" x="15581.5" y="-8529.4143" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a moderately complex state machine, which</text>
<text text-anchor="middle" x="15581.5" y="-8514.0143" font-family="Inconsolata" font-size="14.00" fill="#000000">works on a line&#45;by&#45;line basis with some lookahead.</text>
<text text-anchor="middle" x="15581.5" y="-8482.6143" font-family="Inconsolata" font-size="14.00" fill="#000000">First off, we have a Header at [1], and may have one or </text>
<text text-anchor="middle" x="15581.5" y="-8467.2142" font-family="Inconsolata" font-size="14.00" fill="#000000">more Sections The blocks go between the Header and the remaining</text>
<text text-anchor="middle" x="15581.5" y="-8451.8142" font-family="Inconsolata" font-size="14.00" fill="#000000">Sections, so we have to lift them and append after blocking.</text>
<text text-anchor="middle" x="15581.5" y="-8436.4142" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="15581.5" y="-8421.0141" font-family="Inconsolata" font-size="14.00" fill="#000000">Next, we parse the lines, thus:</text>
<text text-anchor="middle" x="15581.5" y="-8373.6141" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Prose line</text>
<text text-anchor="middle" x="15581.5" y="-8342.2141" font-family="Inconsolata" font-size="14.00" fill="#000000">If preceded by at least one blank line,</text>
<text text-anchor="middle" x="15581.5" y="-8326.814" font-family="Inconsolata" font-size="14.00" fill="#000000">make a new block, otherwise append to existing block.</text>
<text text-anchor="middle" x="15581.5" y="-8279.414" font-family="Inconsolata" font-size="14.00" fill="#000000">**** List line</text>
<text text-anchor="middle" x="15581.5" y="-8248.014" font-family="Inconsolata" font-size="14.00" fill="#000000">New block unless previous line is also list,</text>
<text text-anchor="middle" x="15581.5" y="-8232.614" font-family="Inconsolata" font-size="14.00" fill="#000000">in which case append. </text>
<text text-anchor="middle" x="15581.5" y="-8185.2139" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Table line</text>
<text text-anchor="middle" x="15581.5" y="-8153.8139" font-family="Inconsolata" font-size="14.00" fill="#000000">Same as list.</text>
<text text-anchor="middle" x="15581.5" y="-8106.4139" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Tag line </text>
<text text-anchor="middle" x="15581.5" y="-8075.0138" font-family="Inconsolata" font-size="14.00" fill="#000000">A tag needs to cling, so we need to check the</text>
<text text-anchor="middle" x="15581.5" y="-8059.6138" font-family="Inconsolata" font-size="14.00" fill="#000000">number of blank lines before and after a tag line, if any.</text>
<text text-anchor="middle" x="15581.5" y="-8044.2138" font-family="Inconsolata" font-size="14.00" fill="#000000">If even, a tag line clings down.</text>
<text text-anchor="middle" x="15581.5" y="-7996.8137" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Code block</text>
<text text-anchor="middle" x="15581.5" y="-7965.4137" font-family="Inconsolata" font-size="14.00" fill="#000000">A code block is anything between a code header and</text>
<text text-anchor="middle" x="15581.5" y="-7950.0137" font-family="Inconsolata" font-size="14.00" fill="#000000">either a code footer or the end of a file. </text>
<text text-anchor="middle" x="15581.5" y="-7918.6136" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section : the Section to be blocked</text>
<text text-anchor="middle" x="15581.5" y="-7887.2136" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns : the same Section, filled in with blocks</text>
<text text-anchor="middle" x="15581.5" y="-7855.8136" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-7840.4135" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.block(section)</text>
<text text-anchor="middle" x="15581.5" y="-7825.0135" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; There is always a header at [1], though it may be nil</text>
<text text-anchor="middle" x="15581.5" y="-7809.6135" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; If there are other Nodes, they are sections and must be appended</text>
<text text-anchor="middle" x="15581.5" y="-7794.2135" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; after the blocks.</text>
<text text-anchor="middle" x="15581.5" y="-7778.8134" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sub_sections = {}</text>
<text text-anchor="middle" x="15581.5" y="-7763.4134" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #section do</text>
<text text-anchor="middle" x="15581.5" y="-7748.0134" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;sub_sections[#sub_sections + 1] = section[i]</text>
<text text-anchor="middle" x="15581.5" y="-7732.6133" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = nil</text>
<text text-anchor="middle" x="15581.5" y="-7717.2133" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-7685.8133" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Every section gets at least one block, at [2], which may be empty.</text>
<text text-anchor="middle" x="15581.5" y="-7670.4132" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = Block(nil, section.line_first) &#45;&#45; current block</text>
<text text-anchor="middle" x="15581.5" y="-7655.0132" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[2] = latest</text>
<text text-anchor="middle" x="15581.5" y="-7623.6132" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; State machine for blocking a section</text>
<text text-anchor="middle" x="15581.5" y="-7608.2131" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local back_blanks = 0</text>
<text text-anchor="middle" x="15581.5" y="-7592.8131" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; first set of blank lines in a section belong to the first block</text>
<text text-anchor="middle" x="15581.5" y="-7577.4131" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_blanks = true</text>
<text text-anchor="middle" x="15581.5" y="-7562.013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks in own logic</text>
<text text-anchor="middle" x="15581.5" y="-7546.613" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="15581.5" y="-7531.213" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Tags also</text>
<text text-anchor="middle" x="15581.5" y="-7515.813" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local tagging = false</text>
<text text-anchor="middle" x="15581.5" y="-7500.4129" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 1, #section.lines do</text>
<text text-anchor="middle" x="15581.5" y="-7485.0129" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local inset = i + section.line_first</text>
<text text-anchor="middle" x="15581.5" y="-7469.6129" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l = section.lines[i]</text>
<text text-anchor="middle" x="15581.5" y="-7454.2128" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="15581.5" y="-7438.8128" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if l == &quot;&quot; then </text>
<text text-anchor="middle" x="15581.5" y="-7423.4128" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; increment back blanks for clinging subsequent lines</text>
<text text-anchor="middle" x="15581.5" y="-7408.0127" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = back_blanks + 1</text>
<text text-anchor="middle" x="15581.5" y="-7392.6127" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank lines attach to the preceding block</text>
<text text-anchor="middle" x="15581.5" y="-7377.2127" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="15581.5" y="-7361.8126" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-7346.4126" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeHeader, level, l_trim = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="15581.5" y="-7331.0126" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isCodeHeader then</text>
<text text-anchor="middle" x="15581.5" y="-7315.6125" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true</text>
<text text-anchor="middle" x="15581.5" y="-7300.2125" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="15581.5" y="-7284.8125" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; create a new block for the codeblock</text>
<text text-anchor="middle" x="15581.5" y="-7269.4125" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="15581.5" y="-7254.0124" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(nil, inset)</text>
<text text-anchor="middle" x="15581.5" y="-7238.6124" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="15581.5" y="-7223.2124" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="15581.5" y="-7207.8123" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-7192.4123" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; preserve existing block and add codeblock</text>
<text text-anchor="middle" x="15581.5" y="-7177.0123" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="15581.5" y="-7161.6122" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="15581.5" y="-7146.2122" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-7130.8122" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif isTagline(l) then</text>
<text text-anchor="middle" x="15581.5" y="-7115.4121" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = true</text>
<text text-anchor="middle" x="15581.5" y="-7100.0121" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; apply cling rule</text>
<text text-anchor="middle" x="15581.5" y="-7084.6121" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local fwd_blanks = fwdBlanks(section.lines, i)</text>
<text text-anchor="middle" x="15581.5" y="-7069.212" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if fwd_blanks &gt; back_blanks then</text>
<text text-anchor="middle" x="15581.5" y="-7053.812" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="15581.5" y="-7038.412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-7023.012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="15581.5" y="-7007.6119" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="15581.5" y="-6992.2119" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="15581.5" y="-6976.8119" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="15581.5" y="-6961.4118" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="15581.5" y="-6946.0118" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="15581.5" y="-6930.6118" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-6915.2117" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if back_blanks &gt; 0 and lead_blanks == false then</text>
<text text-anchor="middle" x="15581.5" y="-6899.8117" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="15581.5" y="-6884.4117" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="15581.5" y="-6869.0116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="15581.5" y="-6853.6116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="15581.5" y="-6838.2116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="15581.5" y="-6822.8115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="15581.5" y="-6807.4115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-6792.0115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="15581.5" y="-6776.6115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="15581.5" y="-6761.2114" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="15581.5" y="-6745.8114" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-6730.4114" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; continuing a block</text>
<text text-anchor="middle" x="15581.5" y="-6715.0113" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lead_blanks = false</text>
<text text-anchor="middle" x="15581.5" y="-6699.6113" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="15581.5" y="-6684.2113" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="15581.5" y="-6668.8112" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6653.4112" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6638.0112" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6622.6111" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-6607.2111" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Collecting a code block</text>
<text text-anchor="middle" x="15581.5" y="-6591.8111" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeFoot, level, l_trim = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="15581.5" y="-6576.411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (isCodeFoot and level == latest[1].level) then</text>
<text text-anchor="middle" x="15581.5" y="-6561.011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="15581.5" y="-6545.611" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].footer = l_trim</text>
<text text-anchor="middle" x="15581.5" y="-6530.211" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = inset</text>
<text text-anchor="middle" x="15581.5" y="-6514.8109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15581.5" y="-6499.4109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].lines[#latest[1].lines + 1] = l</text>
<text text-anchor="middle" x="15581.5" y="-6484.0109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6468.6108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Continue in normal parse mode</text>
<text text-anchor="middle" x="15581.5" y="-6453.2108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; This may add more lines to the code block</text>
<text text-anchor="middle" x="15581.5" y="-6437.8108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6422.4107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6407.0107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Auto&#45;close a code block with no footer.</text>
<text text-anchor="middle" x="15581.5" y="-6391.6107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if latest[1] and latest[1].id == &quot;codeblock&quot; and not latest[1].line_last then</text>
<text text-anchor="middle" x="15581.5" y="-6376.2106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = #section.lines</text>
<text text-anchor="middle" x="15581.5" y="-6360.8106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6329.4106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Close last block</text>
<text text-anchor="middle" x="15581.5" y="-6314.0105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;latest.line_last = section.line_last</text>
<text text-anchor="middle" x="15581.5" y="-6282.6105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Append sections, if any, which follow our blocks</text>
<text text-anchor="middle" x="15581.5" y="-6267.2105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(sub_sections) do</text>
<text text-anchor="middle" x="15581.5" y="-6251.8105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = v</text>
<text text-anchor="middle" x="15581.5" y="-6236.4104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-6221.0104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="15581.5" y="-6205.6104" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-6190.2103" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-6158.8103" font-family="Inconsolata" font-size="14.00" fill="#000000">** Section:weed()</text>
<text text-anchor="middle" x="15581.5" y="-6127.4103" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is a kludgy thing we&#39;re going to do to remove &#39;blocks&#39; once they&#39;ve</text>
<text text-anchor="middle" x="15581.5" y="-6112.0102" font-family="Inconsolata" font-size="14.00" fill="#000000">become either codeblocks or prose.</text>
<text text-anchor="middle" x="15581.5" y="-6080.6102" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15581.5" y="-6065.2102" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.weed(section)</text>
<text text-anchor="middle" x="15581.5" y="-6049.8101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="15581.5" y="-6034.4101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.id == &quot;block&quot; then</text>
<text text-anchor="middle" x="15581.5" y="-6019.0101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v[1] and v[1].id == &quot;codeblock&quot; </text>
<text text-anchor="middle" x="15581.5" y="-6003.61" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or v[1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="15581.5" y="-5988.21" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = v[1] &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="15581.5" y="-5972.81" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-5957.41" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-5942.0099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15581.5" y="-5926.6099" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15581.5" y="-5911.2099" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="15581.5" y="-5863.8098" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_1&#45;&gt;leaf_181 -->
<g id="edge181" class="edge">
<title>section_1&#45;&gt;leaf_181</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2771.4827,-11914.6873C3748.5622,-11912.7175 15249.5577,-11888.9357 15280.5,-11860.8191 15281.0907,-11860.2824 15281.6808,-11859.7452 15282.2703,-11859.2076"/>
<polygon fill="#000000" stroke="#000000" points="15284.9059,-11861.539 15289.9002,-11852.1951 15280.169,-11856.3851 15284.9059,-11861.539"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="457,-5500.8096 0,-5500.8096 0,-5430.2089 457,-5430.2089 457,-5500.8096"/>
<text text-anchor="middle" x="228.5" y="-5453.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Sections consist of a header and body. &#160;The body may contain</text>
<text text-anchor="middle" x="228.5" y="-5438.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> one or more blocks, followed by zero or more child sections.</text>
</g>
<!-- block_3&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_3&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1704.8778,-8840.1621C1709.8897,-8596.6132 1761.3193,-5968.7881 1649.5,-5855.6098 1603.2485,-5808.7962 523.0718,-5851.4877 465.5,-5819.6098 342.6175,-5751.569 271.6392,-5589.6569 243.1715,-5510.5569"/>
<polygon fill="#000000" stroke="#000000" points="246.3826,-5509.1389 239.7514,-5500.8759 239.7824,-5511.4707 246.3826,-5509.1389"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="918,-5484.8099 475,-5484.8099 475,-5446.2087 918,-5446.2087 918,-5484.8099"/>
<text text-anchor="middle" x="696.5" y="-5469.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> The header and block may both be virtual, but will always be</text>
<text text-anchor="middle" x="696.5" y="-5454.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> present.</text>
</g>
<!-- block_4&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_4&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1814.8731,-8840.1667C1819.822,-8596.6796 1870.59,-5969.504 1759.5,-5855.6098 1694.8913,-5789.3702 1007.8917,-5865.4262 927.5,-5819.6098 797.7311,-5745.6526 728.3087,-5565.5321 705.2897,-5494.7549"/>
<polygon fill="#000000" stroke="#000000" points="708.5952,-5493.5999 702.2285,-5485.1314 701.9246,-5495.7218 708.5952,-5493.5999"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1330.5,-5484.8099 936.5,-5484.8099 936.5,-5446.2087 1330.5,-5446.2087 1330.5,-5484.8099"/>
<text text-anchor="middle" x="1133.5" y="-5469.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> In the first pass, we fill a lines array with the raw</text>
<text text-anchor="middle" x="1133.5" y="-5454.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> contents of the section. </text>
</g>
<!-- block_5&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_5&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1935.5538,-8840.1927C1949.2846,-8602.3028 2089.0369,-6085.5255 1869.5,-5855.6098 1787.9759,-5770.2316 1439.7765,-5881.9013 1339.5,-5819.6098 1216.8135,-5743.3973 1159.1435,-5565.2747 1140.5421,-5494.8827"/>
<polygon fill="#000000" stroke="#000000" points="1143.8614,-5493.7365 1137.9828,-5484.9221 1137.0816,-5495.4786 1143.8614,-5493.7365"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1722,-5485.4114 1349,-5485.4114 1349,-5445.6072 1722,-5445.6072 1722,-5485.4114"/>
<text text-anchor="middle" x="1535.5" y="-5470.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is subsequently refined into various blocks. </text>
</g>
<!-- block_6&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_6&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2070.4905,-8839.8727C2083.2465,-8600.3854 2211.4625,-6092.324 1999.5,-5855.6098 1919.3292,-5766.0771 1830.7307,-5887.4089 1731.5,-5819.6098 1614.2353,-5739.489 1559.9592,-5565.1457 1542.3078,-5495.3122"/>
<polygon fill="#000000" stroke="#000000" points="1545.6601,-5494.2869 1539.8754,-5485.4106 1538.8622,-5495.9569 1545.6601,-5494.2869"/>
</g>
<!-- header_18 -->
<g id="node19" class="node">
<title>header_18</title>
<ellipse fill="none" stroke="#000000" cx="1783.5" cy="-5465.5093" rx="43.082" ry="18"/>
<text text-anchor="middle" x="1783.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Array</text>
</g>
<!-- section_7&#45;&gt;header_18 -->
<g id="edge18" class="edge">
<title>section_7&#45;&gt;header_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2220.6058,-8840.316C2299.2815,-8638.9077 2988.8056,-6788.0325 2139.5,-5855.6098 2047.8821,-5755.0257 1933.0399,-5914.4622 1835.5,-5819.6098 1745.0133,-5731.6164 1765.3864,-5560.3167 1777.66,-5493.3183"/>
<polygon fill="#000000" stroke="#000000" points="1781.0988,-5493.9696 1779.5421,-5483.4898 1774.2237,-5492.653 1781.0988,-5493.9696"/>
</g>
<!-- block_19 -->
<g id="node20" class="node">
<title>block_19</title>
<ellipse fill="none" stroke="#000000" cx="1900.5" cy="-5465.5093" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1900.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 16&#45;21</text>
</g>
<!-- section_7&#45;&gt;block_19 -->
<g id="edge19" class="edge">
<title>section_7&#45;&gt;block_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2220.4649,-8840.0236C2296.1125,-8639.0883 2947.0325,-6822.7378 2139.5,-5855.6098 2088.885,-5794.9916 2020.71,-5876.0748 1965.5,-5819.6098 1877.127,-5729.228 1887.8172,-5560.6535 1896.204,-5493.8395"/>
<polygon fill="#000000" stroke="#000000" points="1899.7091,-5494.0338 1897.5658,-5483.658 1892.7709,-5493.1057 1899.7091,-5494.0338"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2452.5,-5524.1101 1974.5,-5524.1101 1974.5,-5406.9085 2452.5,-5406.9085 2452.5,-5524.1101"/>
<text text-anchor="middle" x="2213.5" y="-5509.1093" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Array</text>
<text text-anchor="middle" x="2213.5" y="-5477.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;The array portion of a section starts at [1] with a header. The</text>
<text text-anchor="middle" x="2213.5" y="-5462.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> rest consists, optionally, of nodes of types Block and Section.</text>
<text text-anchor="middle" x="2213.5" y="-5414.9093" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_7&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>section_7&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.5,-8839.9608C2213.5,-8596.5496 2213.5,-5993.2409 2213.5,-5534.3918"/>
<polygon fill="#000000" stroke="#000000" points="2217.0001,-5534.2702 2213.5,-5524.2703 2210.0001,-5534.2703 2217.0001,-5534.2702"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="2516.5" cy="-5465.5093" rx="45.9718" ry="18"/>
<text text-anchor="middle" x="2516.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Fields</text>
</g>
<!-- section_8&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_8&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2704.4831,-8839.9608C2690.4415,-8587.9027 2535.4293,-5805.305 2518.0767,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="2521.5688,-5493.5719 2517.5179,-5483.7821 2514.5797,-5493.9614 2521.5688,-5493.5719"/>
</g>
<!-- block_23 -->
<g id="node24" class="node">
<title>block_23</title>
<ellipse fill="none" stroke="#000000" cx="2636.5" cy="-5465.5093" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2636.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 22&#45;29</text>
</g>
<!-- section_8&#45;&gt;block_23 -->
<g id="edge23" class="edge">
<title>section_8&#45;&gt;block_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2705.1288,-8839.9608C2700.0025,-8587.9027 2643.4107,-5805.305 2637.0756,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="2640.5743,-5493.7089 2636.8716,-5483.7821 2633.5758,-5493.8513 2640.5743,-5493.7089"/>
</g>
<!-- section_24 -->
<g id="node25" class="node">
<title>section_24</title>
<ellipse fill="none" stroke="#000000" cx="2775.5" cy="-5465.5093" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2775.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;46</text>
</g>
<!-- section_8&#45;&gt;section_24 -->
<g id="edge24" class="edge">
<title>section_8&#45;&gt;section_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2705.8766,-8839.9608C2711.0772,-8587.9027 2768.4892,-5805.305 2774.916,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="2778.4159,-5493.8522 2775.123,-5483.7821 2771.4174,-5493.7078 2778.4159,-5493.8522"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3344,-5539.91 2859,-5539.91 2859,-5391.1086 3344,-5391.1086 3344,-5539.91"/>
<text text-anchor="middle" x="3101.5" y="-5524.5094" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Fields</text>
<text text-anchor="middle" x="3101.5" y="-5493.1093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; header : The header for the section.</text>
<text text-anchor="middle" x="3101.5" y="-5477.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; level : The header level, lifted from the header for ease of use</text>
<text text-anchor="middle" x="3101.5" y="-5462.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lines : An array of the lines owned by the section. Note that </text>
<text text-anchor="middle" x="3101.5" y="-5446.9093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;this doesn&#39;t include the header. </text>
<text text-anchor="middle" x="3101.5" y="-5399.5092" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_8&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>section_8&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2707.6306,-8839.9608C2735.7378,-8599.1542 3033.4312,-6048.6842 3091.6554,-5549.8527"/>
<polygon fill="#000000" stroke="#000000" points="3095.1404,-5550.1837 3092.8234,-5539.8453 3088.1876,-5549.3721 3095.1404,-5550.1837"/>
</g>
<!-- header_35 -->
<g id="node36" class="node">
<title>header_35</title>
<ellipse fill="none" stroke="#000000" cx="3470.5" cy="-5465.5093" rx="108.8185" ry="18"/>
<text text-anchor="middle" x="3470.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Metatable for sections</text>
</g>
<!-- section_9&#45;&gt;header_35 -->
<g id="edge35" class="edge">
<title>section_9&#45;&gt;header_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3781.816,-8839.9608C3758.5619,-8587.9027 3501.8485,-5805.305 3473.1111,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="3476.5897,-5493.4183 3472.1858,-5483.7821 3469.6194,-5494.0614 3476.5897,-5493.4183"/>
</g>
<!-- block_36 -->
<g id="node37" class="node">
<title>block_36</title>
<ellipse fill="none" stroke="#000000" cx="3653.5" cy="-5465.5093" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3653.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 47&#45;48</text>
</g>
<!-- section_9&#45;&gt;block_36 -->
<g id="edge36" class="edge">
<title>section_9&#45;&gt;block_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3782.8006,-8839.9608C3773.1423,-8587.9027 3666.5201,-5805.305 3654.5845,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="3658.0806,-5493.6407 3654.2002,-5483.7821 3651.0857,-5493.9088 3658.0806,-5493.6407"/>
</g>
<!-- block_37 -->
<g id="node38" class="node">
<title>block_37</title>
<ellipse fill="none" stroke="#000000" cx="3783.5" cy="-5465.5093" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3783.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 49&#45;80</text>
</g>
<!-- section_9&#45;&gt;block_37 -->
<g id="edge37" class="edge">
<title>section_9&#45;&gt;block_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3783.5,-8839.9608C3783.5,-8587.9027 3783.5,-5805.305 3783.5,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="3787.0001,-5493.7821 3783.5,-5483.7821 3780.0001,-5493.7822 3787.0001,-5493.7821"/>
</g>
<!-- section_38 -->
<g id="node39" class="node">
<title>section_38</title>
<ellipse fill="none" stroke="#000000" cx="3922.5" cy="-5465.5093" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3922.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 67&#45;80</text>
</g>
<!-- section_9&#45;&gt;section_38 -->
<g id="edge38" class="edge">
<title>section_9&#45;&gt;section_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3784.2479,-8839.9608C3794.5747,-8587.9027 3908.5785,-5805.305 3921.3404,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="3924.839,-5493.9171 3921.7514,-5483.7821 3917.8448,-5493.6304 3924.839,-5493.9171"/>
</g>
<!-- section_39 -->
<g id="node40" class="node">
<title>section_39</title>
<ellipse fill="none" stroke="#000000" cx="4912.5" cy="-5465.5093" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4912.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 81&#45;103</text>
</g>
<!-- section_9&#45;&gt;section_39 -->
<g id="edge39" class="edge">
<title>section_9&#45;&gt;section_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3789.5743,-8839.9608C3873.4938,-8587.7782 4800.3404,-5802.5548 4903.2346,-5493.3523"/>
<polygon fill="#000000" stroke="#000000" points="4906.5827,-5494.3757 4906.4193,-5483.7821 4899.9408,-5492.1654 4906.5827,-5494.3757"/>
</g>
<!-- leaf_75 -->
<g id="node76" class="node">
<title>leaf_75</title>
<polygon fill="none" stroke="#c0c0c0" points="5402,-5742.0101 5001,-5742.0101 5001,-5189.0085 5402,-5189.0085 5402,-5742.0101"/>
<text text-anchor="middle" x="5201.5" y="-5726.8097" font-family="Inconsolata" font-size="14.00" fill="#000000">** Metatable for sections</text>
<text text-anchor="middle" x="5201.5" y="-5695.4096" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5201.5" y="-5680.0096" font-family="Inconsolata" font-size="14.00" fill="#000000">local Sec, sec = u.inherit(Node)</text>
<text text-anchor="middle" x="5201.5" y="-5664.6096" font-family="Inconsolata" font-size="14.00" fill="#000000">Sec.id = &quot;section&quot;</text>
<text text-anchor="middle" x="5201.5" y="-5633.2095" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.__tostring(section)</text>
<text text-anchor="middle" x="5201.5" y="-5617.8095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5201.5" y="-5602.4095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(section) do</text>
<text text-anchor="middle" x="5201.5" y="-5587.0095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="5201.5" y="-5571.6094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (repr ~= &quot;&quot; and repr ~= &quot;\n&quot;) then</text>
<text text-anchor="middle" x="5201.5" y="-5556.2094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5201.5" y="-5540.8094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5201.5" y="-5525.4093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5201.5" y="-5494.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5201.5" y="-5478.6093" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5201.5" y="-5463.2092" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5201.5" y="-5415.8092" font-family="Inconsolata" font-size="14.00" fill="#000000">*** dotLabel(section)</text>
<text text-anchor="middle" x="5201.5" y="-5384.4092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Produces a label for a dotfile.</text>
<text text-anchor="middle" x="5201.5" y="-5353.0091" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return : string in dot format.</text>
<text text-anchor="middle" x="5201.5" y="-5321.6091" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5201.5" y="-5306.2091" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.dotLabel(section)</text>
<text text-anchor="middle" x="5201.5" y="-5290.8091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;section: &quot; .. tostring(section.line_first) </text>
<text text-anchor="middle" x="5201.5" y="-5275.409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(section.line_last)</text>
<text text-anchor="middle" x="5201.5" y="-5260.009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5201.5" y="-5244.609" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5201.5" y="-5197.2089" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_9&#45;&gt;leaf_75 -->
<g id="edge75" class="edge">
<title>section_9&#45;&gt;leaf_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3791.1292,-8839.9608C3881.9101,-8622.7586 4758.0544,-6526.4967 5081.9381,-5751.5729"/>
<polygon fill="#000000" stroke="#000000" points="5085.2138,-5752.8114 5085.8409,-5742.2351 5078.7553,-5750.1119 5085.2138,-5752.8114"/>
</g>
<!-- header_76 -->
<g id="node77" class="node">
<title>header_76</title>
<ellipse fill="none" stroke="#000000" cx="6129.5" cy="-5465.5093" rx="108.8358" ry="18"/>
<text text-anchor="middle" x="6129.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : addLine(section, line) </text>
</g>
<!-- section_10&#45;&gt;header_76 -->
<g id="edge76" class="edge">
<title>section_10&#45;&gt;header_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6617.8583,-8839.9608C6581.3799,-8587.9027 6178.676,-5805.305 6133.5961,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="6137.0408,-5493.1777 6132.1445,-5483.7821 6130.113,-5494.1804 6137.0408,-5493.1777"/>
</g>
<!-- block_77 -->
<g id="node78" class="node">
<title>block_77</title>
<ellipse fill="none" stroke="#000000" cx="6322.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6322.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 129&#45;132</text>
</g>
<!-- section_10&#45;&gt;block_77 -->
<g id="edge77" class="edge">
<title>section_10&#45;&gt;block_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6618.8967,-8839.9608C6596.757,-8587.9027 6352.3461,-5805.305 6324.986,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="6328.4667,-5493.4375 6324.105,-5483.7821 6321.4935,-5494.0501 6328.4667,-5493.4375"/>
</g>
<!-- block_78 -->
<g id="node79" class="node">
<title>block_78</title>
<ellipse fill="none" stroke="#000000" cx="6471.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6471.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 133&#45;139</text>
</g>
<!-- section_10&#45;&gt;block_78 -->
<g id="edge78" class="edge">
<title>section_10&#45;&gt;block_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6619.6983,-8839.9608C6608.6285,-8587.9027 6486.4231,-5805.305 6472.743,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="6476.238,-5493.6189 6472.3025,-5483.7821 6469.2447,-5493.9261 6476.238,-5493.6189"/>
</g>
<!-- block_79 -->
<g id="node80" class="node">
<title>block_79</title>
<ellipse fill="none" stroke="#000000" cx="6620.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6620.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 140&#45;141</text>
</g>
<!-- section_10&#45;&gt;block_79 -->
<g id="edge79" class="edge">
<title>section_10&#45;&gt;block_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6620.5,-8839.9608C6620.5,-8587.9027 6620.5,-5805.305 6620.5,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="6624.0001,-5493.7821 6620.5,-5483.7821 6617.0001,-5493.7822 6624.0001,-5493.7821"/>
</g>
<!-- block_80 -->
<g id="node81" class="node">
<title>block_80</title>
<ellipse fill="none" stroke="#000000" cx="6789.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6789.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 142&#45;172</text>
</g>
<!-- section_10&#45;&gt;block_80 -->
<g id="edge80" class="edge">
<title>section_10&#45;&gt;block_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6621.4093,-8839.9608C6633.965,-8587.9027 6772.5738,-5805.305 6788.0902,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="6791.5878,-5493.9439 6788.5898,-5483.7821 6784.5965,-5493.5956 6791.5878,-5493.9439"/>
</g>
<!-- section_81 -->
<g id="node82" class="node">
<title>section_81</title>
<ellipse fill="none" stroke="#000000" cx="7550.5" cy="-5465.5093" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7550.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 150&#45;172</text>
</g>
<!-- section_10&#45;&gt;section_81 -->
<g id="edge81" class="edge">
<title>section_10&#45;&gt;section_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6625.5037,-8839.9608C6694.5972,-8587.9027 7457.356,-5805.305 7542.7417,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="7546.2229,-5494.3517 7545.4911,-5483.7821 7539.4719,-5492.5011 7546.2229,-5494.3517"/>
</g>
<!-- section_82 -->
<g id="node83" class="node">
<title>section_82</title>
<ellipse fill="none" stroke="#000000" cx="9260.5" cy="-5465.5093" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9260.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 173&#45;247</text>
</g>
<!-- section_10&#45;&gt;section_82 -->
<g id="edge82" class="edge">
<title>section_10&#45;&gt;section_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6634.3876,-8840.3673C6828.9762,-8590.2985 9006.6281,-5791.764 9240.2298,-5491.5588"/>
<polygon fill="#000000" stroke="#000000" points="9243.1912,-5493.4524 9246.5701,-5483.4108 9237.6667,-5489.1535 9243.1912,-5493.4524"/>
</g>
<!-- leaf_147 -->
<g id="node148" class="node">
<title>leaf_147</title>
<polygon fill="none" stroke="#c0c0c0" points="9783,-5819.7103 9354,-5819.7103 9354,-5111.3082 9783,-5111.3082 9783,-5819.7103"/>
<text text-anchor="middle" x="9568.5" y="-5804.4098" font-family="Inconsolata" font-size="14.00" fill="#000000">** addLine(section, line) </text>
<text text-anchor="middle" x="9568.5" y="-5773.0098" font-family="Inconsolata" font-size="14.00" fill="#000000">Add a line to a section.</text>
<text text-anchor="middle" x="9568.5" y="-5741.6097" font-family="Inconsolata" font-size="14.00" fill="#000000">These lines are later translated into blocks, and when the</text>
<text text-anchor="middle" x="9568.5" y="-5726.2097" font-family="Inconsolata" font-size="14.00" fill="#000000">parser is mature, =section.line= will be set to nil before</text>
<text text-anchor="middle" x="9568.5" y="-5710.8097" font-family="Inconsolata" font-size="14.00" fill="#000000">the Doc is returned. &#160;</text>
<text text-anchor="middle" x="9568.5" y="-5695.4096" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="9568.5" y="-5680.0096" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the section</text>
<text text-anchor="middle" x="9568.5" y="-5664.6096" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; line: the line</text>
<text text-anchor="middle" x="9568.5" y="-5633.2095" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; return : the section</text>
<text text-anchor="middle" x="9568.5" y="-5601.8095" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="9568.5" y="-5586.4095" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addLine(section, line)</text>
<text text-anchor="middle" x="9568.5" y="-5571.0095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.lines[#section.lines + 1] = line</text>
<text text-anchor="middle" x="9568.5" y="-5555.6094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="9568.5" y="-5540.2094" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9568.5" y="-5524.8094" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="9568.5" y="-5477.4093" font-family="Inconsolata" font-size="14.00" fill="#000000">*** addSection(section, newsection, linum)</text>
<text text-anchor="middle" x="9568.5" y="-5446.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Adds a section to the host section</text>
<text text-anchor="middle" x="9568.5" y="-5414.6093" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: &#160;Section to contain the new section.</text>
<text text-anchor="middle" x="9568.5" y="-5399.2092" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; newsection: &#160;The new section.</text>
<text text-anchor="middle" x="9568.5" y="-5383.8092" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: &#160;The line number.</text>
<text text-anchor="middle" x="9568.5" y="-5352.4092" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: the parent section.</text>
<text text-anchor="middle" x="9568.5" y="-5321.0091" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="9568.5" y="-5305.6091" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addSection(section, newsection, linum, finish)</text>
<text text-anchor="middle" x="9568.5" y="-5290.2091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="9568.5" y="-5274.8091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="9568.5" y="-5259.409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(finish) == &quot;number&quot;)</text>
<text text-anchor="middle" x="9568.5" y="-5244.009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.last = finish</text>
<text text-anchor="middle" x="9568.5" y="-5228.609" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9568.5" y="-5213.2089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[#section + 1] = newsection</text>
<text text-anchor="middle" x="9568.5" y="-5197.8089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="9568.5" y="-5182.4089" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="9568.5" y="-5167.0088" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="9568.5" y="-5119.6088" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_10&#45;&gt;leaf_147 -->
<g id="edge147" class="edge">
<title>section_10&#45;&gt;leaf_147</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6638.5055,-8840.5418C6819.0441,-8662.8806 8317.8596,-7177.2669 9344.5,-5819.6098 9345.5558,-5818.2136 9346.6114,-5816.8124 9347.667,-5815.4064"/>
<polygon fill="#000000" stroke="#000000" points="9350.5379,-5817.4114 9353.7101,-5807.3026 9344.9263,-5813.2268 9350.5379,-5817.4114"/>
</g>
<!-- header_148 -->
<g id="node149" class="node">
<title>header_148</title>
<ellipse fill="none" stroke="#000000" cx="12230.5" cy="-5465.5093" rx="55.6456" ry="18"/>
<text text-anchor="middle" x="12230.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Blocking</text>
</g>
<!-- section_11&#45;&gt;header_148 -->
<g id="edge148" class="edge">
<title>section_11&#45;&gt;header_148</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12516.9505,-8839.9608C12495.5538,-8587.9027 12259.3446,-5805.305 12232.9026,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="12236.3845,-5493.4502 12232.0511,-5483.7821 12229.4096,-5494.0424 12236.3845,-5493.4502"/>
</g>
<!-- block_149 -->
<g id="node150" class="node">
<title>block_149</title>
<ellipse fill="none" stroke="#000000" cx="12369.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12369.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 210&#45;213</text>
</g>
<!-- section_11&#45;&gt;block_149 -->
<g id="edge149" class="edge">
<title>section_11&#45;&gt;block_149</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12517.6983,-8839.9608C12506.6285,-8587.9027 12384.4231,-5805.305 12370.743,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="12374.238,-5493.6189 12370.3025,-5483.7821 12367.2447,-5493.9261 12374.238,-5493.6189"/>
</g>
<!-- block_150 -->
<g id="node151" class="node">
<title>block_150</title>
<ellipse fill="none" stroke="#000000" cx="12518.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12518.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 214&#45;216</text>
</g>
<!-- section_11&#45;&gt;block_150 -->
<g id="edge150" class="edge">
<title>section_11&#45;&gt;block_150</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12518.5,-8839.9608C12518.5,-8587.9027 12518.5,-5805.305 12518.5,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="12522.0001,-5493.7821 12518.5,-5483.7821 12515.0001,-5493.7822 12522.0001,-5493.7821"/>
</g>
<!-- block_151 -->
<g id="node152" class="node">
<title>block_151</title>
<ellipse fill="none" stroke="#000000" cx="12738.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12738.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 217&#45;223</text>
</g>
<!-- section_11&#45;&gt;block_151 -->
<g id="edge151" class="edge">
<title>section_11&#45;&gt;block_151</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12519.6837,-8839.9608C12536.0284,-8587.9027 12716.4659,-5805.305 12736.6647,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="12740.1606,-5493.9877 12737.3151,-5483.7821 12733.1752,-5493.5347 12740.1606,-5493.9877"/>
</g>
<!-- section_152 -->
<g id="node153" class="node">
<title>section_152</title>
<ellipse fill="none" stroke="#000000" cx="13121.5" cy="-5465.5093" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="13121.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 224&#45;229</text>
</g>
<!-- section_11&#45;&gt;section_152 -->
<g id="edge152" class="edge">
<title>section_11&#45;&gt;section_152</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12521.7443,-8839.9608C12566.5437,-8587.9027 13061.1067,-5805.305 13116.4696,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="13119.9483,-5494.2403 13118.2523,-5483.7821 13113.0563,-5493.0153 13119.9483,-5494.2403"/>
</g>
<!-- leaf_160 -->
<g id="node161" class="node">
<title>leaf_160</title>
<polygon fill="none" stroke="#c0c0c0" points="13678.5,-5586.5096 13214.5,-5586.5096 13214.5,-5344.509 13678.5,-5344.509 13678.5,-5586.5096"/>
<text text-anchor="middle" x="13446.5" y="-5571.3094" font-family="Inconsolata" font-size="14.00" fill="#000000">** Blocking</text>
<text text-anchor="middle" x="13446.5" y="-5539.9094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Blocks a Section.</text>
<text text-anchor="middle" x="13446.5" y="-5508.5094" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a moderately complex state machine, which</text>
<text text-anchor="middle" x="13446.5" y="-5493.1093" font-family="Inconsolata" font-size="14.00" fill="#000000">works on a line&#45;by&#45;line basis with some lookahead.</text>
<text text-anchor="middle" x="13446.5" y="-5461.7093" font-family="Inconsolata" font-size="14.00" fill="#000000">First off, we have a Header at [1], and may have one or </text>
<text text-anchor="middle" x="13446.5" y="-5446.3093" font-family="Inconsolata" font-size="14.00" fill="#000000">more Sections The blocks go between the Header and the remaining</text>
<text text-anchor="middle" x="13446.5" y="-5430.9093" font-family="Inconsolata" font-size="14.00" fill="#000000">Sections, so we have to lift them and append after blocking.</text>
<text text-anchor="middle" x="13446.5" y="-5415.5092" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="13446.5" y="-5400.1092" font-family="Inconsolata" font-size="14.00" fill="#000000">Next, we parse the lines, thus:</text>
<text text-anchor="middle" x="13446.5" y="-5352.7092" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_11&#45;&gt;leaf_160 -->
<g id="edge160" class="edge">
<title>section_11&#45;&gt;leaf_160</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12523.4929,-8839.9608C12587.5083,-8605.9247 13248.256,-6190.2758 13410.6166,-5596.6965"/>
<polygon fill="#000000" stroke="#000000" points="13414.0568,-5597.3849 13413.3193,-5586.8158 13407.3049,-5595.538 13414.0568,-5597.3849"/>
</g>
<!-- header_161 -->
<g id="node162" class="node">
<title>header_161</title>
<ellipse fill="none" stroke="#000000" cx="13860.5" cy="-5465.5093" rx="81.2629" ry="18"/>
<text text-anchor="middle" x="13860.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Section:weed()</text>
</g>
<!-- section_12&#45;&gt;header_161 -->
<g id="edge161" class="edge">
<title>section_12&#45;&gt;header_161</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14024.6123,-8839.9608C14012.3537,-8587.9027 13877.0255,-5805.305 13861.8765,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="13865.3704,-5493.6003 13861.3887,-5483.7821 13858.3787,-5493.9404 13865.3704,-5493.6003"/>
</g>
<!-- block_162 -->
<g id="node163" class="node">
<title>block_162</title>
<ellipse fill="none" stroke="#000000" cx="14025.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="14025.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 367&#45;371</text>
</g>
<!-- section_12&#45;&gt;block_162 -->
<g id="edge162" class="edge">
<title>section_12&#45;&gt;block_162</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14025.5,-8839.9608C14025.5,-8587.9027 14025.5,-5805.305 14025.5,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="14029.0001,-5493.7821 14025.5,-5483.7821 14022.0001,-5493.7822 14029.0001,-5493.7821"/>
</g>
<!-- block_163 -->
<g id="node164" class="node">
<title>block_163</title>
<ellipse fill="none" stroke="#000000" cx="14178.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="14178.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 372&#45;385</text>
</g>
<!-- section_12&#45;&gt;block_163 -->
<g id="edge163" class="edge">
<title>section_12&#45;&gt;block_163</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14026.3232,-8839.9608C14037.6902,-8587.9027 14163.1763,-5805.305 14177.2236,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="14180.7218,-5493.9297 14177.676,-5483.7821 14173.7289,-5493.6143 14180.7218,-5493.9297"/>
</g>
<!-- leaf_168 -->
<g id="node169" class="node">
<title>leaf_168</title>
<polygon fill="none" stroke="#c0c0c0" points="14796.5,-5624.91 14262.5,-5624.91 14262.5,-5306.1085 14796.5,-5306.1085 14796.5,-5624.91"/>
<text text-anchor="middle" x="14529.5" y="-5609.5095" font-family="Inconsolata" font-size="14.00" fill="#000000">** Section:weed()</text>
<text text-anchor="middle" x="14529.5" y="-5578.1095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is a kludgy thing we&#39;re going to do to remove &#39;blocks&#39; once they&#39;ve</text>
<text text-anchor="middle" x="14529.5" y="-5562.7095" font-family="Inconsolata" font-size="14.00" fill="#000000">become either codeblocks or prose.</text>
<text text-anchor="middle" x="14529.5" y="-5531.3094" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="14529.5" y="-5515.9094" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.weed(section)</text>
<text text-anchor="middle" x="14529.5" y="-5500.5094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="14529.5" y="-5485.1093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.id == &quot;block&quot; then</text>
<text text-anchor="middle" x="14529.5" y="-5469.7093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v[1] and v[1].id == &quot;codeblock&quot; </text>
<text text-anchor="middle" x="14529.5" y="-5454.3093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or v[1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="14529.5" y="-5438.9093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = v[1] &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="14529.5" y="-5423.5092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14529.5" y="-5408.1092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14529.5" y="-5392.7092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14529.5" y="-5377.3091" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="14529.5" y="-5361.9091" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="14529.5" y="-5314.5091" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_12&#45;&gt;leaf_168 -->
<g id="edge168" class="edge">
<title>section_12&#45;&gt;leaf_168</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14028.2117,-8839.9608C14062.2779,-8610.642 14407.4984,-6286.7701 14504.3545,-5634.7774"/>
<polygon fill="#000000" stroke="#000000" points="14507.8246,-5635.237 14505.8321,-5624.8312 14500.9006,-5634.2083 14507.8246,-5635.237"/>
</g>
<!-- header_169 -->
<g id="node170" class="node">
<title>header_169</title>
<ellipse fill="none" stroke="#000000" cx="14927.5" cy="-5465.5093" rx="110.7653" ry="18"/>
<text text-anchor="middle" x="14927.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Section(header, linum)</text>
</g>
<!-- section_13&#45;&gt;header_169 -->
<g id="edge169" class="edge">
<title>section_13&#45;&gt;header_169</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15195.0527,-8839.9608C15175.0676,-8587.9027 14954.4416,-5805.305 14929.7441,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="14933.2284,-5493.4742 14928.9488,-5483.7821 14926.2503,-5494.0275 14933.2284,-5493.4742"/>
</g>
<!-- block_170 -->
<g id="node171" class="node">
<title>block_170</title>
<ellipse fill="none" stroke="#000000" cx="15122.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="15122.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 386&#45;389</text>
</g>
<!-- section_13&#45;&gt;block_170 -->
<g id="edge170" class="edge">
<title>section_13&#45;&gt;block_170</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15196.1019,-8839.9608C15190.6041,-8587.9027 15129.9115,-5805.305 15123.1173,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="15126.6159,-5493.7034 15122.8986,-5483.7821 15119.6176,-5493.8561 15126.6159,-5493.7034"/>
</g>
<!-- block_171 -->
<g id="node172" class="node">
<title>block_171</title>
<ellipse fill="none" stroke="#000000" cx="15271.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="15271.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 390&#45;394</text>
</g>
<!-- section_13&#45;&gt;block_171 -->
<g id="edge171" class="edge">
<title>section_13&#45;&gt;block_171</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15196.9035,-8839.9608C15202.4756,-8587.9027 15263.9884,-5805.305 15270.8743,-5493.8122"/>
<polygon fill="#000000" stroke="#000000" points="15274.3741,-5493.8571 15271.0961,-5483.7821 15267.3758,-5493.7023 15274.3741,-5493.8571"/>
</g>
<!-- block_172 -->
<g id="node173" class="node">
<title>block_172</title>
<ellipse fill="none" stroke="#000000" cx="15530.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="15530.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 395&#45;396</text>
</g>
<!-- section_13&#45;&gt;block_172 -->
<g id="edge172" class="edge">
<title>section_13&#45;&gt;block_172</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15190.8007,-8840.1633C15130.6492,-8646.0284 14627.4979,-6930.3702 15281.5,-5855.6098 15298.6668,-5827.3986 15323.4609,-5843.2692 15346.5,-5819.6098 15443.7921,-5719.6981 15501.8443,-5557.977 15522.2124,-5493.4214"/>
<polygon fill="#000000" stroke="#000000" points="15525.6481,-5494.1587 15525.264,-5483.5708 15518.9615,-5492.0873 15525.6481,-5494.1587"/>
</g>
<!-- block_173 -->
<g id="node174" class="node">
<title>block_173</title>
<ellipse fill="none" stroke="#000000" cx="15765.5" cy="-5465.5093" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="15765.5" y="-5461.3093" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 397&#45;424</text>
</g>
<!-- section_13&#45;&gt;block_173 -->
<g id="edge173" class="edge">
<title>section_13&#45;&gt;block_173</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15189.444,-8840.2745C15111.3316,-8638.4064 14427.0538,-6783.4902 15281.5,-5855.6098 15330.5728,-5802.3195 15546.9014,-5862.2033 15605.5,-5819.6098 15716.6045,-5738.8515 15752.1878,-5562.5614 15762.0991,-5493.7854"/>
<polygon fill="#000000" stroke="#000000" points="15765.5908,-5494.0833 15763.477,-5483.7015 15758.6553,-5493.1355 15765.5908,-5494.0833"/>
</g>
<!-- leaf_180 -->
<g id="node181" class="node">
<title>leaf_180</title>
<polygon fill="none" stroke="#c0c0c0" points="16341.5,-5763.7103 15849.5,-5763.7103 15849.5,-5167.3082 16341.5,-5167.3082 16341.5,-5763.7103"/>
<text text-anchor="middle" x="16095.5" y="-5748.4098" font-family="Inconsolata" font-size="14.00" fill="#000000">** Section(header, linum)</text>
<text text-anchor="middle" x="16095.5" y="-5717.0098" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Creates a new section, given a header and the line number.</text>
<text text-anchor="middle" x="16095.5" y="-5685.6097" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; header : &#160;Header for the section, which may be of type Header or </text>
<text text-anchor="middle" x="16095.5" y="-5670.2097" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a number. &#160;A number means the header is virtual.</text>
<text text-anchor="middle" x="16095.5" y="-5654.8097" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum &#160;: &#160;The line number of the header, which is the first of the</text>
<text text-anchor="middle" x="16095.5" y="-5639.4096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Section.</text>
<text text-anchor="middle" x="16095.5" y="-5608.0096" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; return : &#160;The new Section.</text>
<text text-anchor="middle" x="16095.5" y="-5576.6096" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="16095.5" y="-5561.2095" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Section, header, linum, first, last, str)</text>
<text text-anchor="middle" x="16095.5" y="-5545.8095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(first) == &quot;number&quot;)</text>
<text text-anchor="middle" x="16095.5" y="-5530.4095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(last) == &quot;number&quot;, &quot;type of last is &quot; .. type(last))</text>
<text text-anchor="middle" x="16095.5" y="-5515.0095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local section = setmetatable({}, Sec)</text>
<text text-anchor="middle" x="16095.5" y="-5499.6094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if type(header) == &quot;number&quot; then</text>
<text text-anchor="middle" x="16095.5" y="-5484.2094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We have a virtual header</text>
<text text-anchor="middle" x="16095.5" y="-5468.8094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[1] = Header(&quot;&quot;, header)</text>
<text text-anchor="middle" x="16095.5" y="-5453.4093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.header = nil</text>
<text text-anchor="middle" x="16095.5" y="-5438.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.level = header</text>
<text text-anchor="middle" x="16095.5" y="-5422.6093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="16095.5" y="-5407.2092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[1] = header</text>
<text text-anchor="middle" x="16095.5" y="-5391.8092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.header = header</text>
<text text-anchor="middle" x="16095.5" y="-5376.4092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.level = header.level</text>
<text text-anchor="middle" x="16095.5" y="-5361.0091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="16095.5" y="-5345.6091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.str = str</text>
<text text-anchor="middle" x="16095.5" y="-5330.2091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.first = first</text>
<text text-anchor="middle" x="16095.5" y="-5314.8091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.last = last</text>
<text text-anchor="middle" x="16095.5" y="-5299.409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.line_first = linum</text>
<text text-anchor="middle" x="16095.5" y="-5284.009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.line_last = &#45;1 &#160;</text>
<text text-anchor="middle" x="16095.5" y="-5268.609" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.lines = {}</text>
<text text-anchor="middle" x="16095.5" y="-5253.2089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;Sec.check(section)</text>
<text text-anchor="middle" x="16095.5" y="-5237.8089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="16095.5" y="-5222.4089" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="16095.5" y="-5191.0088" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(sec, new)</text>
<text text-anchor="middle" x="16095.5" y="-5175.6088" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_13&#45;&gt;leaf_180 -->
<g id="edge180" class="edge">
<title>section_13&#45;&gt;leaf_180</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15189.2498,-8840.0914C15108.9844,-8636.1942 14405.7836,-6763.4431 15281.5,-5855.6098 15367.9213,-5766.019 15731.5887,-5879.8882 15840.5,-5819.6098 15864.5559,-5806.2957 15886.9162,-5789.6398 15907.5781,-5770.8571"/>
<polygon fill="#000000" stroke="#000000" points="15910.1783,-5773.2184 15915.1136,-5763.8432 15905.4091,-5768.0945 15910.1783,-5773.2184"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1939.5,-4514.0083 1461.5,-4514.0083 1461.5,-4443.4076 1939.5,-4443.4076 1939.5,-4514.0083"/>
<text text-anchor="middle" x="1700.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;The array portion of a section starts at [1] with a header. The</text>
<text text-anchor="middle" x="1700.5" y="-4467.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> rest consists, optionally, of nodes of types Block and Section.</text>
</g>
<!-- block_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1897.3679,-5447.4176C1888.2897,-5395.2138 1860.9856,-5239.8483 1835.5,-5111.4088 1791.7076,-4890.7089 1733.7846,-4627.9782 1710.6631,-4524.1461"/>
<polygon fill="#000000" stroke="#000000" points="1714.0624,-4523.3085 1708.4709,-4514.3093 1707.2301,-4524.8312 1714.0624,-4523.3085"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2443,-4529.3089 1958,-4529.3089 1958,-4428.1071 2443,-4428.1071 2443,-4529.3089"/>
<text text-anchor="middle" x="2200.5" y="-4498.308" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; header : The header for the section.</text>
<text text-anchor="middle" x="2200.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; level : The header level, lifted from the header for ease of use</text>
<text text-anchor="middle" x="2200.5" y="-4467.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; lines : An array of the lines owned by the section. Note that </text>
<text text-anchor="middle" x="2200.5" y="-4452.1079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;this doesn&#39;t include the header. </text>
</g>
<!-- block_23&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_23&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2639.1229,-5447.2964C2646.2991,-5389.8924 2660.2103,-5210.6782 2571.5,-5111.4088 2534.6808,-5070.207 2493.5838,-5112.3595 2452.5,-5075.4088 2289.6076,-4928.9038 2228.6976,-4659.8036 2208.8882,-4539.5527"/>
<polygon fill="#000000" stroke="#000000" points="2212.3029,-4538.7417 2207.2594,-4529.4244 2205.3917,-4539.8533 2212.3029,-4538.7417"/>
</g>
<!-- header_26 -->
<g id="node27" class="node">
<title>header_26</title>
<ellipse fill="none" stroke="#000000" cx="2516.5" cy="-4478.708" rx="55.1697" ry="18"/>
<text text-anchor="middle" x="2516.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Includes</text>
</g>
<!-- section_24&#45;&gt;header_26 -->
<g id="edge26" class="edge">
<title>section_24&#45;&gt;header_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2777.6045,-5447.2263C2783.1567,-5389.6143 2792.0772,-5209.8504 2701.5,-5111.4088 2663.5096,-5070.1198 2616.3973,-5118.5299 2580.5,-5075.4088 2437.2062,-4903.279 2489.4354,-4599.4871 2509.8609,-4506.5191"/>
<polygon fill="#000000" stroke="#000000" points="2513.2829,-4507.2542 2512.0677,-4496.7292 2506.4543,-4505.7148 2513.2829,-4507.2542"/>
</g>
<!-- block_27 -->
<g id="node28" class="node">
<title>block_27</title>
<ellipse fill="none" stroke="#000000" cx="2645.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2645.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 30&#45;31</text>
</g>
<!-- section_24&#45;&gt;block_27 -->
<g id="edge27" class="edge">
<title>section_24&#45;&gt;block_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2772.0859,-5447.2857C2761.7515,-5391.6889 2730.3043,-5219.2668 2710.5,-5075.4088 2680.4486,-4857.1162 2655.6942,-4592.3282 2647.9895,-4506.7911"/>
<polygon fill="#000000" stroke="#000000" points="2651.4743,-4506.4648 2647.0954,-4496.8172 2644.5023,-4507.0898 2651.4743,-4506.4648"/>
</g>
<!-- block_28 -->
<g id="node29" class="node">
<title>block_28</title>
<ellipse fill="none" stroke="#000000" cx="2775.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2775.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 32&#45;46</text>
</g>
<!-- section_24&#45;&gt;block_28 -->
<g id="edge28" class="edge">
<title>section_24&#45;&gt;block_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2775.5,-5447.1108C2775.5,-5326.9039 2775.5,-4653.8291 2775.5,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="2779.0001,-4506.9796 2775.5,-4496.9796 2772.0001,-4506.9797 2779.0001,-4506.9796"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3159.5,-4623.0084 2849.5,-4623.0084 2849.5,-4334.4075 3159.5,-4334.4075 3159.5,-4623.0084"/>
<text text-anchor="middle" x="3004.5" y="-4607.9082" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Includes</text>
<text text-anchor="middle" x="3004.5" y="-4576.5081" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3004.5" y="-4561.1081" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4529.7081" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4514.308" font-family="Inconsolata" font-size="14.00" fill="#000000">local status = require &quot;status&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4451.508" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4436.1079" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4420.7079" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4405.3079" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="3004.5" y="-4389.9078" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3004.5" y="-4342.5078" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_24&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>section_24&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2779.0557,-5447.405C2789.3642,-5395.1676 2820.3846,-5239.721 2849.5,-5111.4088 2886.6646,-4947.6238 2932.871,-4760.9474 2965.1223,-4633.0549"/>
<polygon fill="#000000" stroke="#000000" points="2968.5609,-4633.7329 2967.6142,-4623.1805 2961.7737,-4632.0201 2968.5609,-4633.7329"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2672.5,-2933.3054 2618.5,-2933.3054 2618.5,-2897.3054 2672.5,-2897.3054 2672.5,-2933.3054"/>
</g>
<!-- block_27&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_27&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2645.5,-4460.6096C2645.5,-4301.3544 2645.5,-3140.1866 2645.5,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="2649.0001,-2943.452 2645.5,-2933.452 2642.0001,-2943.452 2649.0001,-2943.452"/>
</g>
<!-- codeblock_30 -->
<g id="node31" class="node">
<title>codeblock_30</title>
<ellipse fill="none" stroke="#000000" cx="2771.5" cy="-2915.3054" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2771.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 32&#45;44</text>
</g>
<!-- block_28&#45;&gt;codeblock_30 -->
<g id="edge30" class="edge">
<title>block_28&#45;&gt;codeblock_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2775.4537,-4460.6096C2775.0462,-4301.3544 2772.0754,-3140.1866 2771.5723,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="2775.0721,-2943.443 2771.5464,-2933.452 2768.0721,-2943.461 2775.0721,-2943.443"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2920.5,-2933.3054 2866.5,-2933.3054 2866.5,-2897.3054 2920.5,-2897.3054 2920.5,-2933.3054"/>
</g>
<!-- block_28&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>block_28&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2775.3068,-4460.4766C2774.9752,-4386.6678 2778.0693,-4103.4098 2840.5,-3882.0072 2845.3021,-3864.977 2853.2954,-3863.1946 2857.5,-3846.0072 2942.3695,-3499.0802 2907.5882,-3057.9803 2896.446,-2943.4674"/>
<polygon fill="#000000" stroke="#000000" points="2899.9192,-2943.0235 2895.4463,-2933.4192 2892.9536,-2943.7166 2899.9192,-2943.0235"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2926.5,-1911.1038 2616.5,-1911.1038 2616.5,-1731.7031 2926.5,-1731.7031 2926.5,-1911.1038"/>
<text text-anchor="middle" x="2771.5" y="-1895.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1864.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1849.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">local status = require &quot;status&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1817.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1786.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local Header = require &quot;grym/header&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1770.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">local Block = require &quot;grym/block&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1755.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="2771.5" y="-1740.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
</g>
<!-- codeblock_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>codeblock_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2771.5,-2897.2314C2771.5,-2783.7182 2771.5,-2166.1216 2771.5,-1921.3712"/>
<polygon fill="#000000" stroke="#000000" points="2775.0001,-1921.0581 2771.5,-1911.0581 2768.0001,-1921.0582 2775.0001,-1921.0581"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="3231.5,-4496.708 3177.5,-4496.708 3177.5,-4460.708 3231.5,-4460.708 3231.5,-4496.708"/>
</g>
<!-- block_36&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>block_36&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3656.7563,-5447.3751C3666.1488,-5388.6442 3686.7167,-5202.2065 3588.5,-5111.4088 3531.4114,-5058.6325 3294.2851,-5131.5479 3240.5,-5075.4088 3161.8027,-4993.2672 3191.4885,-4614.2425 3201.6426,-4507.0311"/>
<polygon fill="#000000" stroke="#000000" points="3205.1367,-4507.2601 3202.6145,-4496.9699 3198.1692,-4506.587 3205.1367,-4507.2601"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="3326.5" cy="-4478.708" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3326.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 49&#45;64</text>
</g>
<!-- block_37&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>block_37&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3786.7047,-5447.4306C3795.939,-5388.8695 3816.0774,-5202.8931 3718.5,-5111.4088 3618.6015,-5017.7483 3510.5818,-5170.97 3412.5,-5075.4088 3250.8248,-4917.8883 3300.5187,-4602.2876 3320.1915,-4506.7474"/>
<polygon fill="#000000" stroke="#000000" points="3323.6185,-4507.4584 3322.2647,-4496.9504 3316.7701,-4506.0091 3323.6185,-4507.4584"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="3475.5,-4496.708 3421.5,-4496.708 3421.5,-4460.708 3475.5,-4460.708 3475.5,-4496.708"/>
</g>
<!-- block_37&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>block_37&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3786.6342,-5447.1598C3795.4889,-5388.5705 3814.2123,-5204.3948 3718.5,-5111.4088 3643.0286,-5038.0871 3555.389,-5153.1696 3484.5,-5075.4088 3407.8625,-4991.3422 3436.0804,-4613.6894 3445.7702,-4506.9119"/>
<polygon fill="#000000" stroke="#000000" points="3449.261,-4507.172 3446.698,-4496.8919 3442.2908,-4506.5266 3449.261,-4507.172"/>
</g>
<!-- header_44 -->
<g id="node45" class="node">
<title>header_44</title>
<ellipse fill="none" stroke="#000000" cx="3583.5" cy="-4478.708" rx="90.4762" ry="18"/>
<text text-anchor="middle" x="3583.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : dotLabel(section)</text>
</g>
<!-- section_38&#45;&gt;header_44 -->
<g id="edge44" class="edge">
<title>section_38&#45;&gt;header_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3924.8685,-5447.3404C3931.3312,-5389.2958 3942.9549,-5206.5791 3848.5,-5111.4088 3795.3203,-5057.8263 3734.5537,-5130.0857 3682.5,-5075.4088 3526.677,-4911.7331 3562.8764,-4601.5623 3578.3701,-4506.8662"/>
<polygon fill="#000000" stroke="#000000" points="3581.8392,-4507.3423 3580.057,-4496.8985 3574.9374,-4506.1742 3581.8392,-4507.3423"/>
</g>
<!-- block_45 -->
<g id="node46" class="node">
<title>block_45</title>
<ellipse fill="none" stroke="#000000" cx="3747.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3747.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 67&#45;70</text>
</g>
<!-- section_38&#45;&gt;block_45 -->
<g id="edge45" class="edge">
<title>section_38&#45;&gt;block_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3922.2871,-5447.337C3920.9305,-5392.9423 3911.5317,-5227.9743 3848.5,-5111.4088 3837.7372,-5091.505 3822.28,-5095.8135 3812.5,-5075.4088 3716.6226,-4875.3728 3735.2512,-4595.4254 3744.2492,-4506.7767"/>
<polygon fill="#000000" stroke="#000000" points="3747.7435,-4507.0153 3745.3159,-4496.7024 3740.7824,-4506.2782 3747.7435,-4507.0153"/>
</g>
<!-- block_46 -->
<g id="node47" class="node">
<title>block_46</title>
<ellipse fill="none" stroke="#000000" cx="3877.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3877.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;72</text>
</g>
<!-- section_38&#45;&gt;block_46 -->
<g id="edge46" class="edge">
<title>section_38&#45;&gt;block_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3921.661,-5447.1108C3916.1793,-5326.9039 3885.4859,-4653.8291 3878.7901,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="3882.2852,-4506.8098 3878.3332,-4496.9796 3875.2925,-4507.1287 3882.2852,-4506.8098"/>
</g>
<!-- block_47 -->
<g id="node48" class="node">
<title>block_47</title>
<ellipse fill="none" stroke="#000000" cx="4007.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4007.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 73&#45;80</text>
</g>
<!-- section_38&#45;&gt;block_47 -->
<g id="edge47" class="edge">
<title>section_38&#45;&gt;block_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3924.0848,-5447.1108C3934.439,-5326.9039 3992.4156,-4653.8291 4005.0632,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="4008.5549,-4507.2431 4005.9261,-4496.9796 4001.5808,-4506.6423 4008.5549,-4507.2431"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="4482,-4599.7083 4081,-4599.7083 4081,-4357.7077 4482,-4357.7077 4482,-4599.7083"/>
<text text-anchor="middle" x="4281.5" y="-4584.5081" font-family="Inconsolata" font-size="14.00" fill="#000000">*** dotLabel(section)</text>
<text text-anchor="middle" x="4281.5" y="-4553.1081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Produces a label for a dotfile.</text>
<text text-anchor="middle" x="4281.5" y="-4521.7081" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return : string in dot format.</text>
<text text-anchor="middle" x="4281.5" y="-4490.308" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4281.5" y="-4474.908" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.dotLabel(section)</text>
<text text-anchor="middle" x="4281.5" y="-4459.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;section: &quot; .. tostring(section.line_first) </text>
<text text-anchor="middle" x="4281.5" y="-4444.1079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(section.line_last)</text>
<text text-anchor="middle" x="4281.5" y="-4428.7079" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4281.5" y="-4413.3079" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4281.5" y="-4365.9078" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_38&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>section_38&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3929.7253,-5447.3035C3951.7214,-5391.7573 4019.5897,-5219.4636 4072.5,-5075.4088 4131.1312,-4915.778 4195.344,-4730.8155 4236.9084,-4609.6484"/>
<polygon fill="#000000" stroke="#000000" points="4240.3023,-4610.5411 4240.2348,-4599.9465 4233.6807,-4608.2707 4240.3023,-4610.5411"/>
</g>
<!-- header_54 -->
<g id="node55" class="node">
<title>header_54</title>
<ellipse fill="none" stroke="#000000" cx="4604.5" cy="-4478.708" rx="104.4491" ry="18"/>
<text text-anchor="middle" x="4604.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : toMarkdown(section)</text>
</g>
<!-- section_39&#45;&gt;header_54 -->
<g id="edge54" class="edge">
<title>section_39&#45;&gt;header_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4901.276,-5447.6181C4867.9236,-5393.6375 4768.5661,-5226.7879 4717.5,-5075.4088 4646.0746,-4863.6771 4615.4643,-4593.5561 4607.0427,-4506.8391"/>
<polygon fill="#000000" stroke="#000000" points="4610.5132,-4506.3618 4606.0825,-4496.7379 4603.5446,-4507.0243 4610.5132,-4506.3618"/>
</g>
<!-- block_55 -->
<g id="node56" class="node">
<title>block_55</title>
<ellipse fill="none" stroke="#000000" cx="4782.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4782.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 81&#45;84</text>
</g>
<!-- section_39&#45;&gt;block_55 -->
<g id="edge55" class="edge">
<title>section_39&#45;&gt;block_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4909.0859,-5447.2857C4898.7515,-5391.6889 4867.3043,-5219.2668 4847.5,-5075.4088 4817.4486,-4857.1162 4792.6942,-4592.3282 4784.9895,-4506.7911"/>
<polygon fill="#000000" stroke="#000000" points="4788.4743,-4506.4648 4784.0954,-4496.8172 4781.5023,-4507.0898 4788.4743,-4506.4648"/>
</g>
<!-- block_56 -->
<g id="node57" class="node">
<title>block_56</title>
<ellipse fill="none" stroke="#000000" cx="4912.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4912.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 85&#45;86</text>
</g>
<!-- section_39&#45;&gt;block_56 -->
<g id="edge56" class="edge">
<title>section_39&#45;&gt;block_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4912.5,-5447.1108C4912.5,-5326.9039 4912.5,-4653.8291 4912.5,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="4916.0001,-4506.9796 4912.5,-4496.9796 4909.0001,-4506.9797 4916.0001,-4506.9796"/>
</g>
<!-- block_57 -->
<g id="node58" class="node">
<title>block_57</title>
<ellipse fill="none" stroke="#000000" cx="5042.5" cy="-4478.708" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="5042.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 87&#45;88</text>
</g>
<!-- section_39&#45;&gt;block_57 -->
<g id="edge57" class="edge">
<title>section_39&#45;&gt;block_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4915.9141,-5447.2857C4926.2485,-5391.6889 4957.6957,-5219.2668 4977.5,-5075.4088 5007.5514,-4857.1162 5032.3058,-4592.3282 5040.0105,-4506.7911"/>
<polygon fill="#000000" stroke="#000000" points="5043.4977,-4507.0898 5040.9046,-4496.8172 5036.5257,-4506.4648 5043.4977,-4507.0898"/>
</g>
<!-- block_58 -->
<g id="node59" class="node">
<title>block_58</title>
<ellipse fill="none" stroke="#000000" cx="5177.5" cy="-4478.708" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="5177.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 89&#45;103</text>
</g>
<!-- section_39&#45;&gt;block_58 -->
<g id="edge58" class="edge">
<title>section_39&#45;&gt;block_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4910.7416,-5447.2439C4906.2641,-5389.6841 4900.572,-5210.0582 4991.5,-5111.4088 5028.0855,-5071.7165 5073.0006,-5116.927 5107.5,-5075.4088 5250.6523,-4903.1322 5202.8937,-4599.9996 5183.7845,-4506.7775"/>
<polygon fill="#000000" stroke="#000000" points="5187.1504,-4505.7759 5181.663,-4496.7128 5180.3009,-4507.2197 5187.1504,-4505.7759"/>
</g>
<!-- section_59 -->
<g id="node60" class="node">
<title>section_59</title>
<ellipse fill="none" stroke="#000000" cx="5331.5" cy="-4478.708" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5331.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 104&#45;128</text>
</g>
<!-- section_39&#45;&gt;section_59 -->
<g id="edge59" class="edge">
<title>section_39&#45;&gt;section_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4910.1842,-5447.4266C4903.7984,-5388.8533 4892.4613,-5202.8438 4991.5,-5111.4088 5075.9207,-5033.4695 5166.2494,-5156.6475 5247.5,-5075.4088 5406.8867,-4916.0454 5357.4921,-4602.2925 5337.8431,-4506.8877"/>
<polygon fill="#000000" stroke="#000000" points="5341.2136,-4505.9092 5335.7175,-4496.8514 5334.3655,-4507.3596 5341.2136,-4505.9092"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="5854,-4669.4086 5425,-4669.4086 5425,-4288.0074 5854,-4288.0074 5854,-4669.4086"/>
<text text-anchor="middle" x="5639.5" y="-4654.1083" font-family="Inconsolata" font-size="14.00" fill="#000000">*** toMarkdown(section)</text>
<text text-anchor="middle" x="5639.5" y="-4622.7082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Translates the Section to markdown.</text>
<text text-anchor="middle" x="5639.5" y="-4591.3082" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the Section.</text>
<text text-anchor="middle" x="5639.5" y="-4559.9082" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: A Markdown string. &#160;</text>
<text text-anchor="middle" x="5639.5" y="-4528.5081" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5639.5" y="-4513.1081" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.toMarkdown(section)</text>
<text text-anchor="middle" x="5639.5" y="-4497.7081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5639.5" y="-4482.308" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(section) do</text>
<text text-anchor="middle" x="5639.5" y="-4466.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="5639.5" y="-4451.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="5639.5" y="-4436.1079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="5639.5" y="-4420.7079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method in &quot; .. node.id)</text>
<text text-anchor="middle" x="5639.5" y="-4405.3079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5639.5" y="-4389.9078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5639.5" y="-4358.5078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5639.5" y="-4343.1078" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5639.5" y="-4327.7078" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5639.5" y="-4296.3077" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_39&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>section_39&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4909.9841,-5447.2039C4902.9857,-5387.9483 4889.9844,-5200.0857 4991.5,-5111.4088 5062.7165,-5049.1991 5340.1179,-5132.4996 5415.5,-5075.4088 5538.4531,-4982.29 5593.9219,-4813.6769 5618.9436,-4679.3856"/>
<polygon fill="#000000" stroke="#000000" points="5622.4192,-4679.8348 5620.7655,-4669.3699 5615.5322,-4678.582 5622.4192,-4679.8348"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="3471,-3027.6059 3140,-3027.6059 3140,-2803.005 3471,-2803.005 3471,-3027.6059"/>
<text text-anchor="middle" x="3305.5" y="-3012.5056" font-family="Inconsolata" font-size="14.00" fill="#000000">local Sec, sec = u.inherit(Node)</text>
<text text-anchor="middle" x="3305.5" y="-2997.1056" font-family="Inconsolata" font-size="14.00" fill="#000000">Sec.id = &quot;section&quot;</text>
<text text-anchor="middle" x="3305.5" y="-2965.7056" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.__tostring(section)</text>
<text text-anchor="middle" x="3305.5" y="-2950.3055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3305.5" y="-2934.9055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(section) do</text>
<text text-anchor="middle" x="3305.5" y="-2919.5055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local repr = tostring(v)</text>
<text text-anchor="middle" x="3305.5" y="-2904.1054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (repr ~= &quot;&quot; and repr ~= &quot;\n&quot;) then</text>
<text text-anchor="middle" x="3305.5" y="-2888.7054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. repr .. &quot;\n&quot;</text>
<text text-anchor="middle" x="3305.5" y="-2873.3054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3305.5" y="-2857.9054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3305.5" y="-2826.5053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3305.5" y="-2811.1053" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>codeblock_41&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3326.2569,-4460.6096C3324.3478,-4318.4808 3311.7197,-3378.3446 3307.1482,-3038.0125"/>
<polygon fill="#000000" stroke="#000000" points="3310.6461,-3037.8267 3307.0121,-3027.8747 3303.6468,-3037.9208 3310.6461,-3037.8267"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="3736,-2935.2075 3489,-2935.2075 3489,-2895.4034 3736,-2895.4034 3736,-2935.2075"/>
<text text-anchor="middle" x="3612.5" y="-2903.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Produces a label for a dotfile.</text>
</g>
<!-- block_45&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>block_45&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3745.9372,-4460.6096C3732.2219,-4301.7759 3632.4487,-3146.3269 3615.0761,-2945.1384"/>
<polygon fill="#000000" stroke="#000000" points="3618.5493,-2944.6765 3614.2019,-2935.0147 3611.5753,-2945.2788 3618.5493,-2944.6765"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4001,-2933.3054 3754,-2933.3054 3754,-2897.3054 4001,-2897.3054 4001,-2933.3054"/>
<text text-anchor="middle" x="3877.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return : string in dot format.</text>
</g>
<!-- block_46&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>block_46&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3877.5,-4460.6096C3877.5,-4301.3544 3877.5,-3140.1866 3877.5,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="3881.0001,-2943.452 3877.5,-2933.452 3874.0001,-2943.452 3881.0001,-2943.452"/>
</g>
<!-- codeblock_50 -->
<g id="node51" class="node">
<title>codeblock_50</title>
<ellipse fill="none" stroke="#000000" cx="4096.5" cy="-2915.3054" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="4096.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 73&#45;78</text>
</g>
<!-- block_47&#45;&gt;codeblock_50 -->
<g id="edge50" class="edge">
<title>block_47&#45;&gt;codeblock_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4008.5303,-4460.6096C4017.5962,-4301.3544 4083.6982,-3140.1866 4094.8917,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="4098.3929,-2943.6348 4095.467,-2933.452 4091.4042,-2943.2369 4098.3929,-2943.6348"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="4245.5,-2933.3054 4191.5,-2933.3054 4191.5,-2897.3054 4245.5,-2897.3054 4245.5,-2933.3054"/>
</g>
<!-- block_47&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>block_47&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4003.1153,-4460.5098C3985.1782,-4381.2871 3925.0435,-4062.3736 4071.5,-3882.0072 4104.1922,-3841.7456 4151.1992,-3887.3598 4182.5,-3846.0072 4292.9583,-3700.0769 4236.2184,-3084.5018 4221.6041,-2943.959"/>
<polygon fill="#000000" stroke="#000000" points="4225.0418,-2943.1831 4220.5136,-2933.6047 4218.0803,-2943.9163 4225.0418,-2943.1831"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="4297,-1856.0047 3896,-1856.0047 3896,-1786.8022 4297,-1786.8022 4297,-1856.0047"/>
<text text-anchor="middle" x="4096.5" y="-1841.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.dotLabel(section)</text>
<text text-anchor="middle" x="4096.5" y="-1825.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;section: &quot; .. tostring(section.line_first) </text>
<text text-anchor="middle" x="4096.5" y="-1810.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(section.line_last)</text>
<text text-anchor="middle" x="4096.5" y="-1794.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_50&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>codeblock_50&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4096.5,-2897.2314C4096.5,-2773.7959 4096.5,-2054.3008 4096.5,-1866.3217"/>
<polygon fill="#000000" stroke="#000000" points="4100.0001,-1866.2378 4096.5,-1856.2378 4093.0001,-1866.2378 4100.0001,-1866.2378"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="4562,-2935.2075 4287,-2935.2075 4287,-2895.4034 4562,-2895.4034 4562,-2935.2075"/>
<text text-anchor="middle" x="4424.5" y="-2903.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Translates the Section to markdown.</text>
</g>
<!-- block_55&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>block_55&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4787.1087,-4460.5003C4806.1623,-4380.5693 4870.8241,-4056.9751 4717.5,-3882.0072 4673.1692,-3831.4184 4616.0098,-3895.538 4570.5,-3846.0072 4324.2879,-3578.0405 4395.7679,-3072.8388 4418.6957,-2945.1888"/>
<polygon fill="#000000" stroke="#000000" points="4422.142,-2945.7997 4420.5062,-2935.3319 4415.2572,-2944.5351 4422.142,-2945.7997"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="4757,-2933.3054 4580,-2933.3054 4580,-2897.3054 4757,-2897.3054 4757,-2933.3054"/>
<text text-anchor="middle" x="4668.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the Section.</text>
</g>
<!-- block_56&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>block_56&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4916.4427,-4460.5973C4932.3719,-4382.3934 4984.7783,-4069.1824 4847.5,-3882.0072 4823.9607,-3849.912 4788.9645,-3878.1571 4765.5,-3846.0072 4552.1418,-3553.674 4636.6644,-3065.3245 4662.1966,-2943.4924"/>
<polygon fill="#000000" stroke="#000000" points="4665.6694,-2943.9892 4664.3373,-2933.4784 4658.824,-2942.5257 4665.6694,-2943.9892"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="5008,-2933.3054 4775,-2933.3054 4775,-2897.3054 5008,-2897.3054 5008,-2933.3054"/>
<text text-anchor="middle" x="4891.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: A Markdown string. &#160;</text>
</g>
<!-- block_57&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>block_57&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5040.752,-4460.6096C5025.3704,-4301.3544 4913.22,-3140.1866 4894.2286,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="4897.6979,-2943.0692 4893.2527,-2933.452 4890.7303,-2943.7422 4897.6979,-2943.0692"/>
</g>
<!-- codeblock_63 -->
<g id="node64" class="node">
<title>codeblock_63</title>
<ellipse fill="none" stroke="#000000" cx="5108.5" cy="-2915.3054" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="5108.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 89&#45;102</text>
</g>
<!-- block_58&#45;&gt;codeblock_63 -->
<g id="edge63" class="edge">
<title>block_58&#45;&gt;codeblock_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5176.7012,-4460.6096C5169.6726,-4301.3544 5118.425,-3140.1866 5109.7469,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="5113.2385,-2943.2879 5109.3009,-2933.452 5106.2453,-2943.5966 5113.2385,-2943.2879"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="5262.5,-2933.3054 5208.5,-2933.3054 5208.5,-2897.3054 5262.5,-2897.3054 5262.5,-2933.3054"/>
</g>
<!-- block_58&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>block_58&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5178.1714,-4460.6096C5184.0796,-4301.3544 5227.1572,-3140.1866 5234.4519,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="5237.9536,-2943.5749 5234.8268,-2933.452 5230.9584,-2943.3153 5237.9536,-2943.5749"/>
</g>
<!-- header_66 -->
<g id="node67" class="node">
<title>header_66</title>
<ellipse fill="none" stroke="#000000" cx="5331.5" cy="-2915.3054" rx="50.8" ry="18"/>
<text text-anchor="middle" x="5331.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : asserts</text>
</g>
<!-- section_59&#45;&gt;header_66 -->
<g id="edge66" class="edge">
<title>section_59&#45;&gt;header_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5331.5,-4460.6096C5331.5,-4301.3544 5331.5,-3140.1866 5331.5,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="5335.0001,-2943.452 5331.5,-2933.452 5328.0001,-2943.452 5335.0001,-2943.452"/>
</g>
<!-- block_67 -->
<g id="node68" class="node">
<title>block_67</title>
<ellipse fill="none" stroke="#000000" cx="5466.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5466.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 104&#45;105</text>
</g>
<!-- section_59&#45;&gt;block_67 -->
<g id="edge67" class="edge">
<title>section_59&#45;&gt;block_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5333.312,-4460.5973C5340.827,-4385.2867 5370.1476,-4089.4684 5391.5,-3846.0072 5422.7161,-3490.0795 5455.7757,-3057.13 5464.3644,-2943.6302"/>
<polygon fill="#000000" stroke="#000000" points="5467.8762,-2943.6044 5465.14,-2933.369 5460.8961,-2943.0767 5467.8762,-2943.6044"/>
</g>
<!-- block_68 -->
<g id="node69" class="node">
<title>block_68</title>
<ellipse fill="none" stroke="#000000" cx="5615.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5615.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 106&#45;128</text>
</g>
<!-- section_59&#45;&gt;block_68 -->
<g id="edge68" class="edge">
<title>section_59&#45;&gt;block_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5327.7443,-4460.5596C5312.3867,-4380.878 5262.1708,-4058.1818 5415.5,-3882.0072 5453.7354,-3838.0748 5504.6111,-3891.0761 5541.5,-3846.0072 5770.6938,-3565.9901 5656.4274,-3066.5847 5623.4328,-2943.3661"/>
<polygon fill="#000000" stroke="#000000" points="5626.7688,-2942.2955 5620.7655,-2933.5656 5620.0145,-2944.1338 5626.7688,-2942.2955"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="6149.5,-3120.5062 5699.5,-3120.5062 5699.5,-2710.1047 6149.5,-2710.1047 6149.5,-3120.5062"/>
<text text-anchor="middle" x="5924.5" y="-3105.2058" font-family="Inconsolata" font-size="14.00" fill="#000000">**** asserts</text>
<text text-anchor="middle" x="5924.5" y="-3073.8058" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5924.5" y="-3058.4057" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.check(section)</text>
<text text-anchor="middle" x="5924.5" y="-3043.0057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="5924.5" y="-3027.6057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (i == 1) then</text>
<text text-anchor="middle" x="5924.5" y="-3012.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.header then</text>
<text text-anchor="middle" x="5924.5" y="-2996.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;header&quot;)</text>
<text text-anchor="middle" x="5924.5" y="-2981.4056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5924.5" y="-2966.0056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5924.5" y="-2950.6055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;section&quot; or v.id == &quot;block&quot;)</text>
<text text-anchor="middle" x="5924.5" y="-2935.2055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5924.5" y="-2919.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5924.5" y="-2904.4054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.level)</text>
<text text-anchor="middle" x="5924.5" y="-2889.0054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;)</text>
<text text-anchor="middle" x="5924.5" y="-2873.6054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5924.5" y="-2858.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.last, &quot;no last in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5924.5" y="-2842.8053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.str, &quot;no str in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5924.5" y="-2827.4053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.lines)</text>
<text text-anchor="middle" x="5924.5" y="-2812.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_first)</text>
<text text-anchor="middle" x="5924.5" y="-2796.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_last)</text>
<text text-anchor="middle" x="5924.5" y="-2781.2052" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5924.5" y="-2765.8051" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5924.5" y="-2718.4051" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_59&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>section_59&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5327.245,-4460.5269C5309.4269,-4379.3372 5249.183,-4046.7209 5415.5,-3882.0072 5503.0827,-3795.2688 5598.4264,-3927.9628 5690.5,-3846.0072 5890.949,-3667.5857 5931.7947,-3345.2536 5934.5238,-3130.7301"/>
<polygon fill="#000000" stroke="#000000" points="5938.0249,-3130.6318 5934.6254,-3120.5971 5931.0252,-3130.5615 5938.0249,-3130.6318"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="5323,-1918.3042 4894,-1918.3042 4894,-1724.5027 5323,-1724.5027 5323,-1918.3042"/>
<text text-anchor="middle" x="5108.5" y="-1902.9036" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.toMarkdown(section)</text>
<text text-anchor="middle" x="5108.5" y="-1887.5036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5108.5" y="-1872.1036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, node in ipairs(section) do</text>
<text text-anchor="middle" x="5108.5" y="-1856.7035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="5108.5" y="-1841.3035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="5108.5" y="-1825.9035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="5108.5" y="-1810.5034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;no toMarkdown method in &quot; .. node.id)</text>
<text text-anchor="middle" x="5108.5" y="-1795.1034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5108.5" y="-1779.7034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5108.5" y="-1748.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5108.5" y="-1732.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_63&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>codeblock_63&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5108.5,-2897.2314C5108.5,-2784.8264 5108.5,-2178.1329 5108.5,-1928.6456"/>
<polygon fill="#000000" stroke="#000000" points="5112.0001,-1928.479 5108.5,-1918.479 5105.0001,-1928.4791 5112.0001,-1928.479"/>
</g>
<!-- leaf_69 -->
<g id="node70" class="node">
<title>leaf_69</title>
<polygon fill="none" stroke="#c0c0c0" points="5493.5,-1839.4035 5439.5,-1839.4035 5439.5,-1803.4035 5493.5,-1803.4035 5493.5,-1839.4035"/>
</g>
<!-- block_67&#45;&gt;leaf_69 -->
<g id="edge69" class="edge">
<title>block_67&#45;&gt;leaf_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5466.5,-2897.2314C5466.5,-2769.8661 5466.5,-2007.8835 5466.5,-1850.0203"/>
<polygon fill="#000000" stroke="#000000" points="5470.0001,-1849.7152 5466.5,-1839.7152 5463.0001,-1849.7152 5470.0001,-1849.7152"/>
</g>
<!-- codeblock_70 -->
<g id="node71" class="node">
<title>codeblock_70</title>
<ellipse fill="none" stroke="#000000" cx="5607.5" cy="-1821.4035" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5607.5" y="-1817.2035" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 106&#45;126</text>
</g>
<!-- block_68&#45;&gt;codeblock_70 -->
<g id="edge70" class="edge">
<title>block_68&#45;&gt;codeblock_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5615.3678,-2897.2314C5614.4364,-2769.8661 5608.8638,-2007.8835 5607.7093,-1850.0203"/>
<polygon fill="#000000" stroke="#000000" points="5611.2071,-1849.6893 5607.6339,-1839.7152 5604.2072,-1849.7406 5611.2071,-1849.6893"/>
</g>
<!-- leaf_72 -->
<g id="node73" class="node">
<title>leaf_72</title>
<polygon fill="none" stroke="#c0c0c0" points="5766.5,-1839.4035 5712.5,-1839.4035 5712.5,-1803.4035 5766.5,-1803.4035 5766.5,-1839.4035"/>
</g>
<!-- block_68&#45;&gt;leaf_72 -->
<g id="edge72" class="edge">
<title>block_68&#45;&gt;leaf_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5615.1852,-2897.3026C5613.8805,-2801.8624 5612.1983,-2345.8111 5690.5,-1984.6037 5694.104,-1967.9786 5698.2916,-1964.798 5703.5,-1948.6037 5714.3698,-1914.8067 5725.2477,-1875.4104 5732.1551,-1849.5214"/>
<polygon fill="#000000" stroke="#000000" points="5735.5953,-1850.2027 5734.7737,-1839.6398 5728.8288,-1848.4096 5735.5953,-1850.2027"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5832.5,-979.2025 5382.5,-979.2025 5382.5,-679.0007 5832.5,-679.0007 5832.5,-979.2025"/>
<text text-anchor="middle" x="5607.5" y="-964.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.check(section)</text>
<text text-anchor="middle" x="5607.5" y="-948.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="5607.5" y="-933.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if (i == 1) then</text>
<text text-anchor="middle" x="5607.5" y="-918.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if section.header then</text>
<text text-anchor="middle" x="5607.5" y="-902.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;header&quot;)</text>
<text text-anchor="middle" x="5607.5" y="-887.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5607.5" y="-871.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5607.5" y="-856.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(v.id == &quot;section&quot; or v.id == &quot;block&quot;)</text>
<text text-anchor="middle" x="5607.5" y="-841.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5607.5" y="-825.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5607.5" y="-810.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.level)</text>
<text text-anchor="middle" x="5607.5" y="-794.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.id == &quot;section&quot;)</text>
<text text-anchor="middle" x="5607.5" y="-779.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.first, &quot;no first in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5607.5" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.last, &quot;no last in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5607.5" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.str, &quot;no str in &quot; .. tostring(section))</text>
<text text-anchor="middle" x="5607.5" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.lines)</text>
<text text-anchor="middle" x="5607.5" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_first)</text>
<text text-anchor="middle" x="5607.5" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(section.line_last)</text>
<text text-anchor="middle" x="5607.5" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_70&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>codeblock_70&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5607.5,-1803.3331C5607.5,-1706.1118 5607.5,-1240.3471 5607.5,-989.6766"/>
<polygon fill="#000000" stroke="#000000" points="5611.0001,-989.3781 5607.5,-979.3782 5604.0001,-989.3782 5611.0001,-989.3781"/>
</g>
<!-- leaf_83 -->
<g id="node84" class="node">
<title>leaf_83</title>
<polygon fill="none" stroke="#c0c0c0" points="6056.5,-4498.6101 5872.5,-4498.6101 5872.5,-4458.8059 6056.5,-4458.8059 6056.5,-4498.6101"/>
<text text-anchor="middle" x="5964.5" y="-4467.208" font-family="Inconsolata" font-size="14.00" fill="#000000">Add a line to a section.</text>
</g>
<!-- block_77&#45;&gt;leaf_83 -->
<g id="edge83" class="edge">
<title>block_77&#45;&gt;leaf_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6324.8816,-5447.2625C6331.3746,-5388.9828 6343.0025,-5205.6364 6247.5,-5111.4088 6188.8043,-5053.4966 6122.995,-5134.5133 6065.5,-5075.4088 5908.7365,-4914.2567 5943.4719,-4605.618 5959.0991,-4508.6362"/>
<polygon fill="#000000" stroke="#000000" points="5962.5733,-4509.08 5960.7649,-4498.6406 5955.6686,-4507.9292 5962.5733,-4509.08"/>
</g>
<!-- leaf_84 -->
<g id="node85" class="node">
<title>leaf_84</title>
<polygon fill="none" stroke="#c0c0c0" points="6496.5,-4529.109 6074.5,-4529.109 6074.5,-4428.307 6496.5,-4428.307 6496.5,-4529.109"/>
<text text-anchor="middle" x="6285.5" y="-4513.7081" font-family="Inconsolata" font-size="14.00" fill="#000000">These lines are later translated into blocks, and when the</text>
<text text-anchor="middle" x="6285.5" y="-4498.308" font-family="Inconsolata" font-size="14.00" fill="#000000">parser is mature, =section.line= will be set to nil before</text>
<text text-anchor="middle" x="6285.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000">the Doc is returned. &#160;</text>
<text text-anchor="middle" x="6285.5" y="-4467.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6285.5" y="-4452.1079" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: the section</text>
<text text-anchor="middle" x="6285.5" y="-4436.7079" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; line: the line</text>
</g>
<!-- block_78&#45;&gt;leaf_84 -->
<g id="edge84" class="edge">
<title>block_78&#45;&gt;leaf_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6468.0321,-5447.1108C6446.7426,-5334.1618 6333.4483,-4733.0919 6296.8853,-4539.1116"/>
<polygon fill="#000000" stroke="#000000" points="6300.2892,-4538.2739 6294.9974,-4529.0953 6293.4103,-4539.5705 6300.2892,-4538.2739"/>
</g>
<!-- leaf_85 -->
<g id="node86" class="node">
<title>leaf_85</title>
<polygon fill="none" stroke="#c0c0c0" points="6684.5,-4496.708 6514.5,-4496.708 6514.5,-4460.708 6684.5,-4460.708 6684.5,-4496.708"/>
<text text-anchor="middle" x="6599.5" y="-4475.208" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; return : the section</text>
</g>
<!-- block_79&#45;&gt;leaf_85 -->
<g id="edge85" class="edge">
<title>block_79&#45;&gt;leaf_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6620.1085,-5447.1108C6617.5504,-5326.9039 6603.2267,-4653.8291 6600.102,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="6603.6009,-4506.9029 6599.8888,-4496.9796 6596.6025,-4507.0519 6603.6009,-4506.9029"/>
</g>
<!-- codeblock_86 -->
<g id="node87" class="node">
<title>codeblock_86</title>
<ellipse fill="none" stroke="#000000" cx="6789.5" cy="-4478.708" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6789.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 142&#45;147</text>
</g>
<!-- block_80&#45;&gt;codeblock_86 -->
<g id="edge86" class="edge">
<title>block_80&#45;&gt;codeblock_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6789.5,-5447.1108C6789.5,-5326.9039 6789.5,-4653.8291 6789.5,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="6793.0001,-4506.9796 6789.5,-4496.9796 6786.0001,-4506.9797 6793.0001,-4506.9796"/>
</g>
<!-- leaf_88 -->
<g id="node89" class="node">
<title>leaf_88</title>
<polygon fill="none" stroke="#c0c0c0" points="6948.5,-4496.708 6894.5,-4496.708 6894.5,-4460.708 6948.5,-4460.708 6948.5,-4496.708"/>
</g>
<!-- block_80&#45;&gt;leaf_88 -->
<g id="edge88" class="edge">
<title>block_80&#45;&gt;leaf_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6795.1853,-5447.4654C6812.271,-5392.378 6863.3425,-5221.2488 6885.5,-5075.4088 6918.4634,-4858.4447 6921.5332,-4592.7905 6921.6035,-4506.9118"/>
<polygon fill="#000000" stroke="#000000" points="6925.1036,-4506.8952 6921.5982,-4496.8971 6918.1036,-4506.899 6925.1036,-4506.8952"/>
</g>
<!-- header_89 -->
<g id="node90" class="node">
<title>header_89</title>
<ellipse fill="none" stroke="#000000" cx="7142.5" cy="-4478.708" rx="175.5244" ry="18"/>
<text text-anchor="middle" x="7142.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : addSection(section, newsection, linum)</text>
</g>
<!-- section_81&#45;&gt;header_89 -->
<g id="edge89" class="edge">
<title>section_81&#45;&gt;header_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7538.2604,-5447.5937C7501.773,-5393.5449 7392.2112,-5226.5245 7326.5,-5075.4088 7234.7877,-4864.4985 7168.7165,-4593.3612 7148.7734,-4506.6661"/>
<polygon fill="#000000" stroke="#000000" points="7152.1586,-4505.7684 7146.5202,-4496.7985 7145.3342,-4507.3267 7152.1586,-4505.7684"/>
</g>
<!-- block_90 -->
<g id="node91" class="node">
<title>block_90</title>
<ellipse fill="none" stroke="#000000" cx="7401.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7401.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 150&#45;153</text>
</g>
<!-- section_81&#45;&gt;block_90 -->
<g id="edge90" class="edge">
<title>section_81&#45;&gt;block_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7546.5522,-5447.3055C7534.604,-5391.765 7498.258,-5219.4858 7475.5,-5075.4088 7441.0605,-4857.3784 7413.0266,-4592.4194 7404.3135,-4506.8149"/>
<polygon fill="#000000" stroke="#000000" points="7407.7925,-4506.4294 7403.3026,-4496.833 7400.8281,-4507.1348 7407.7925,-4506.4294"/>
</g>
<!-- block_91 -->
<g id="node92" class="node">
<title>block_91</title>
<ellipse fill="none" stroke="#000000" cx="7550.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7550.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 154&#45;157</text>
</g>
<!-- section_81&#45;&gt;block_91 -->
<g id="edge91" class="edge">
<title>section_81&#45;&gt;block_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7550.5,-5447.1108C7550.5,-5326.9039 7550.5,-4653.8291 7550.5,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="7554.0001,-4506.9796 7550.5,-4496.9796 7547.0001,-4506.9797 7554.0001,-4506.9796"/>
</g>
<!-- block_92 -->
<g id="node93" class="node">
<title>block_92</title>
<ellipse fill="none" stroke="#000000" cx="7699.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7699.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 158&#45;159</text>
</g>
<!-- section_81&#45;&gt;block_92 -->
<g id="edge92" class="edge">
<title>section_81&#45;&gt;block_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7554.4478,-5447.3055C7566.396,-5391.765 7602.742,-5219.4858 7625.5,-5075.4088 7659.9395,-4857.3784 7687.9734,-4592.4194 7696.6865,-4506.8149"/>
<polygon fill="#000000" stroke="#000000" points="7700.1719,-4507.1348 7697.6974,-4496.833 7693.2075,-4506.4294 7700.1719,-4507.1348"/>
</g>
<!-- block_93 -->
<g id="node94" class="node">
<title>block_93</title>
<ellipse fill="none" stroke="#000000" cx="7848.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7848.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 160&#45;172</text>
</g>
<!-- section_81&#45;&gt;block_93 -->
<g id="edge93" class="edge">
<title>section_81&#45;&gt;block_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7564.2779,-5447.6976C7604.5384,-5394.5916 7722.4263,-5231.3373 7774.5,-5075.4088 7844.5785,-4865.567 7849.3424,-4594.2067 7848.9062,-4507.0071"/>
<polygon fill="#000000" stroke="#000000" points="7852.4049,-4506.8206 7848.8264,-4496.8484 7845.4052,-4506.8756 7852.4049,-4506.8206"/>
</g>
<!-- leaf_100 -->
<g id="node101" class="node">
<title>leaf_100</title>
<polygon fill="none" stroke="#c0c0c0" points="8361,-4669.4086 7932,-4669.4086 7932,-4288.0074 8361,-4288.0074 8361,-4669.4086"/>
<text text-anchor="middle" x="8146.5" y="-4654.1083" font-family="Inconsolata" font-size="14.00" fill="#000000">*** addSection(section, newsection, linum)</text>
<text text-anchor="middle" x="8146.5" y="-4622.7082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Adds a section to the host section</text>
<text text-anchor="middle" x="8146.5" y="-4591.3082" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: &#160;Section to contain the new section.</text>
<text text-anchor="middle" x="8146.5" y="-4575.9082" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; newsection: &#160;The new section.</text>
<text text-anchor="middle" x="8146.5" y="-4560.5081" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: &#160;The line number.</text>
<text text-anchor="middle" x="8146.5" y="-4529.1081" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: the parent section.</text>
<text text-anchor="middle" x="8146.5" y="-4497.7081" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="8146.5" y="-4482.308" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addSection(section, newsection, linum, finish)</text>
<text text-anchor="middle" x="8146.5" y="-4466.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="8146.5" y="-4451.508" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="8146.5" y="-4436.1079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(finish) == &quot;number&quot;)</text>
<text text-anchor="middle" x="8146.5" y="-4420.7079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.last = finish</text>
<text text-anchor="middle" x="8146.5" y="-4405.3079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8146.5" y="-4389.9078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[#section + 1] = newsection</text>
<text text-anchor="middle" x="8146.5" y="-4374.5078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="8146.5" y="-4359.1078" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="8146.5" y="-4343.7078" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="8146.5" y="-4296.3077" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_81&#45;&gt;leaf_100 -->
<g id="edge100" class="edge">
<title>section_81&#45;&gt;leaf_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7572.6223,-5448.0321C7635.7965,-5397.0735 7819.1707,-5241.698 7923.5,-5075.4088 8000.3964,-4952.8445 8056.9393,-4799.7072 8093.8483,-4679.2581"/>
<polygon fill="#000000" stroke="#000000" points="8097.241,-4680.1314 8096.8037,-4669.5456 8090.5441,-4678.0935 8097.241,-4680.1314"/>
</g>
<!-- header_101 -->
<g id="node102" class="node">
<title>header_101</title>
<ellipse fill="none" stroke="#000000" cx="8516.5" cy="-4478.708" rx="137.8106" ry="18"/>
<text text-anchor="middle" x="8516.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Helper Functions for Blocking</text>
</g>
<!-- section_82&#45;&gt;header_101 -->
<g id="edge101" class="edge">
<title>section_82&#45;&gt;header_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9217.9576,-5450.489C9107.6972,-5409.2798 8811.0241,-5283.466 8663.5,-5075.4088 8531.5562,-4889.3248 8517.47,-4597.8478 8516.4108,-4506.8256"/>
<polygon fill="#000000" stroke="#000000" points="8519.9102,-4506.7144 8516.3391,-4496.7396 8512.9103,-4506.7642 8519.9102,-4506.7144"/>
</g>
<!-- block_102 -->
<g id="node103" class="node">
<title>block_102</title>
<ellipse fill="none" stroke="#000000" cx="8738.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8738.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 173&#45;176</text>
</g>
<!-- section_82&#45;&gt;block_102 -->
<g id="edge102" class="edge">
<title>section_82&#45;&gt;block_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9228.8698,-5448.987C9144.3518,-5402.9516 8912.8804,-5264.1118 8812.5,-5075.4088 8708.1416,-4879.2276 8726.1706,-4596.7242 8735.2074,-4507.1049"/>
<polygon fill="#000000" stroke="#000000" points="8738.7135,-4507.2299 8736.2816,-4496.918 8731.7521,-4506.4958 8738.7135,-4507.2299"/>
</g>
<!-- block_103 -->
<g id="node104" class="node">
<title>block_103</title>
<ellipse fill="none" stroke="#000000" cx="8887.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8887.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 177&#45;183</text>
</g>
<!-- section_82&#45;&gt;block_103 -->
<g id="edge103" class="edge">
<title>section_82&#45;&gt;block_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9241.1943,-5447.9476C9186.3548,-5396.7632 9029.2461,-5240.8437 8961.5,-5075.4088 8877.4809,-4870.2354 8881.9392,-4594.7835 8885.8962,-4506.8927"/>
<polygon fill="#000000" stroke="#000000" points="8889.3926,-4507.051 8886.3823,-4496.8928 8882.4008,-4506.7111 8889.3926,-4507.051"/>
</g>
<!-- block_104 -->
<g id="node105" class="node">
<title>block_104</title>
<ellipse fill="none" stroke="#000000" cx="9036.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9036.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 184&#45;185</text>
</g>
<!-- section_82&#45;&gt;block_104 -->
<g id="edge104" class="edge">
<title>section_82&#45;&gt;block_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9251.6705,-5447.3532C9225.4684,-5392.6326 9147.6709,-5223.9295 9110.5,-5075.4088 9056.909,-4861.2795 9041.3619,-4593.777 9037.574,-4507.1692"/>
<polygon fill="#000000" stroke="#000000" points="9041.0664,-4506.9122 9037.1505,-4497.0677 9034.0726,-4507.2056 9041.0664,-4506.9122"/>
</g>
<!-- block_105 -->
<g id="node106" class="node">
<title>block_105</title>
<ellipse fill="none" stroke="#000000" cx="9185.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9185.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 186&#45;188</text>
</g>
<!-- section_82&#45;&gt;block_105 -->
<g id="edge105" class="edge">
<title>section_82&#45;&gt;block_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9259.1017,-5447.1108C9249.9656,-5326.9039 9198.8098,-4653.8291 9187.6501,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="9191.1366,-4506.6856 9186.8887,-4496.9796 9184.1567,-4507.2162 9191.1366,-4506.6856"/>
</g>
<!-- block_106 -->
<g id="node107" class="node">
<title>block_106</title>
<ellipse fill="none" stroke="#000000" cx="9334.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9334.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 189&#45;190</text>
</g>
<!-- section_82&#45;&gt;block_106 -->
<g id="edge106" class="edge">
<title>section_82&#45;&gt;block_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9261.8797,-5447.1108C9270.894,-5326.9039 9321.3677,-4653.8291 9332.3786,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="9335.8721,-4507.2134 9333.1298,-4496.9796 9328.8917,-4506.6899 9335.8721,-4507.2134"/>
</g>
<!-- block_107 -->
<g id="node108" class="node">
<title>block_107</title>
<ellipse fill="none" stroke="#000000" cx="9599.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9599.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 191&#45;247</text>
</g>
<!-- section_82&#45;&gt;block_107 -->
<g id="edge107" class="edge">
<title>section_82&#45;&gt;block_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9259.9172,-5447.1811C9259.0666,-5390.9314 9263.5489,-5218.1248 9344.5,-5111.4088 9364.4582,-5085.0983 9388.565,-5100.9488 9409.5,-5075.4088 9557.0248,-4895.4338 9590.6813,-4599.2634 9597.7503,-4507.0285"/>
<polygon fill="#000000" stroke="#000000" points="9601.2586,-4507.0386 9598.4865,-4496.8128 9594.2767,-4506.5354 9601.2586,-4507.0386"/>
</g>
<!-- section_108 -->
<g id="node109" class="node">
<title>section_108</title>
<ellipse fill="none" stroke="#000000" cx="9896.5" cy="-4478.708" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9896.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 230&#45;235</text>
</g>
<!-- section_82&#45;&gt;section_108 -->
<g id="edge108" class="edge">
<title>section_82&#45;&gt;section_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9258.3564,-5447.2693C9252.5431,-5388.2141 9243.1412,-5200.8956 9344.5,-5111.4088 9455.1002,-5013.763 9558.0955,-5166.0571 9674.5,-5075.4088 9862.8058,-4928.7684 9891.3911,-4604.984 9895.7262,-4507.2128"/>
<polygon fill="#000000" stroke="#000000" points="9899.2344,-4507.0677 9896.1271,-4496.9388 9892.2397,-4506.7946 9899.2344,-4507.0677"/>
</g>
<!-- section_109 -->
<g id="node110" class="node">
<title>section_109</title>
<ellipse fill="none" stroke="#000000" cx="10521.5" cy="-4478.708" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="10521.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 236&#45;240</text>
</g>
<!-- section_82&#45;&gt;section_109 -->
<g id="edge109" class="edge">
<title>section_82&#45;&gt;section_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9258.2155,-5447.47C9251.8411,-5388.2218 9240.6017,-5198.4271 9344.5,-5111.4088 9398.7623,-5065.9623 9916.6265,-5105.904 9980.5,-5075.4088 10255.5807,-4944.0764 10454.4623,-4603.7433 10507.4554,-4505.578"/>
<polygon fill="#000000" stroke="#000000" points="10510.6307,-4507.0622 10512.2615,-4496.5936 10504.4584,-4503.7604 10510.6307,-4507.0622"/>
</g>
<!-- section_110 -->
<g id="node111" class="node">
<title>section_110</title>
<ellipse fill="none" stroke="#000000" cx="10940.5" cy="-4478.708" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="10940.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 241&#45;247</text>
</g>
<!-- section_82&#45;&gt;section_110 -->
<g id="edge110" class="edge">
<title>section_82&#45;&gt;section_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9258.1203,-5447.3547C9251.4494,-5387.7474 9239.3936,-5196.9639 9344.5,-5111.4088 9453.2074,-5022.9225 10485.5573,-5147.9407 10605.5,-5075.4088 10826.195,-4941.9497 10913.492,-4605.7419 10934.9306,-4506.6227"/>
<polygon fill="#000000" stroke="#000000" points="10938.373,-4507.2609 10937.0151,-4496.7535 10931.5241,-4505.8143 10938.373,-4507.2609"/>
</g>
<!-- section_111 -->
<g id="node112" class="node">
<title>section_111</title>
<ellipse fill="none" stroke="#000000" cx="11450.5" cy="-4478.708" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="11450.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 248&#45;366</text>
</g>
<!-- section_82&#45;&gt;section_111 -->
<g id="edge111" class="edge">
<title>section_82&#45;&gt;section_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9258.0964,-5447.3251C9251.351,-5387.626 9239.0899,-5196.5894 9344.5,-5111.4088 9417.1105,-5052.7331 10941.9595,-5119.0228 11024.5,-5075.4088 11269.3328,-4946.0402 11405.69,-4605.6264 11441.1265,-4506.2903"/>
<polygon fill="#000000" stroke="#000000" points="11444.4939,-4507.2646 11444.5099,-4496.6698 11437.8904,-4504.9422 11444.4939,-4507.2646"/>
</g>
<!-- leaf_146 -->
<g id="node147" class="node">
<title>leaf_146</title>
<polygon fill="none" stroke="#c0c0c0" points="12007.5,-5075.6096 11543.5,-5075.6096 11543.5,-3881.8063 12007.5,-3881.8063 12007.5,-5075.6096"/>
<text text-anchor="middle" x="11775.5" y="-5060.2088" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Helper Functions for Blocking</text>
<text text-anchor="middle" x="11775.5" y="-5028.8087" font-family="Inconsolata" font-size="14.00" fill="#000000">Boolean match for a tagline</text>
<text text-anchor="middle" x="11775.5" y="-4997.4087" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="11775.5" y="-4982.0087" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isTagline(line)</text>
<text text-anchor="middle" x="11775.5" y="-4966.6086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return L.match(m.tagline_p, line)</text>
<text text-anchor="middle" x="11775.5" y="-4951.2086" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="11775.5" y="-4935.8086" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="11775.5" y="-4888.4086" font-family="Inconsolata" font-size="14.00" fill="#000000">Lookahead, counting blank lines, return the number.</text>
<text text-anchor="middle" x="11775.5" y="-4857.0085" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; lines: the full lines array of the section</text>
<text text-anchor="middle" x="11775.5" y="-4841.6085" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: current index into lines</text>
<text text-anchor="middle" x="11775.5" y="-4810.2085" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns: number of blank lines forward of index</text>
<text text-anchor="middle" x="11775.5" y="-4778.8084" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="11775.5" y="-4763.4084" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fwdBlanks(lines, linum)</text>
<text text-anchor="middle" x="11775.5" y="-4748.0084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local fwd = 0</text>
<text text-anchor="middle" x="11775.5" y="-4732.6083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local index = linum + 1</text>
<text text-anchor="middle" x="11775.5" y="-4717.2083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if index &gt; #lines then </text>
<text text-anchor="middle" x="11775.5" y="-4701.8083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0</text>
<text text-anchor="middle" x="11775.5" y="-4686.4082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="11775.5" y="-4671.0082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = index, #lines do</text>
<text text-anchor="middle" x="11775.5" y="-4655.6082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if lines[i] == &quot;&quot; then</text>
<text text-anchor="middle" x="11775.5" y="-4640.2081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fwd = fwd + 1</text>
<text text-anchor="middle" x="11775.5" y="-4624.8081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="11775.5" y="-4609.4081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="11775.5" y="-4594.0081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11775.5" y="-4578.608" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11775.5" y="-4563.208" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="11775.5" y="-4547.808" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return fwd</text>
<text text-anchor="middle" x="11775.5" y="-4532.4079" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="11775.5" y="-4517.0079" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="11775.5" y="-4485.6079" font-family="Inconsolata" font-size="14.00" fill="#000000">** Blocking</text>
<text text-anchor="middle" x="11775.5" y="-4454.2078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Blocks a Section.</text>
<text text-anchor="middle" x="11775.5" y="-4422.8078" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a moderately complex state machine, which</text>
<text text-anchor="middle" x="11775.5" y="-4407.4078" font-family="Inconsolata" font-size="14.00" fill="#000000">works on a line&#45;by&#45;line basis with some lookahead.</text>
<text text-anchor="middle" x="11775.5" y="-4376.0077" font-family="Inconsolata" font-size="14.00" fill="#000000">First off, we have a Header at [1], and may have one or </text>
<text text-anchor="middle" x="11775.5" y="-4360.6077" font-family="Inconsolata" font-size="14.00" fill="#000000">more Sections The blocks go between the Header and the remaining</text>
<text text-anchor="middle" x="11775.5" y="-4345.2077" font-family="Inconsolata" font-size="14.00" fill="#000000">Sections, so we have to lift them and append after blocking.</text>
<text text-anchor="middle" x="11775.5" y="-4329.8076" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="11775.5" y="-4314.4076" font-family="Inconsolata" font-size="14.00" fill="#000000">Next, we parse the lines, thus:</text>
<text text-anchor="middle" x="11775.5" y="-4267.0076" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Prose line</text>
<text text-anchor="middle" x="11775.5" y="-4235.6076" font-family="Inconsolata" font-size="14.00" fill="#000000">If preceded by at least one blank line,</text>
<text text-anchor="middle" x="11775.5" y="-4220.2075" font-family="Inconsolata" font-size="14.00" fill="#000000">make a new block, otherwise append to existing block.</text>
<text text-anchor="middle" x="11775.5" y="-4172.8075" font-family="Inconsolata" font-size="14.00" fill="#000000">**** List line</text>
<text text-anchor="middle" x="11775.5" y="-4141.4075" font-family="Inconsolata" font-size="14.00" fill="#000000">New block unless previous line is also list,</text>
<text text-anchor="middle" x="11775.5" y="-4126.0074" font-family="Inconsolata" font-size="14.00" fill="#000000">in which case append. </text>
<text text-anchor="middle" x="11775.5" y="-4078.6074" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Table line</text>
<text text-anchor="middle" x="11775.5" y="-4047.2074" font-family="Inconsolata" font-size="14.00" fill="#000000">Same as list.</text>
<text text-anchor="middle" x="11775.5" y="-3999.8073" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Tag line </text>
<text text-anchor="middle" x="11775.5" y="-3968.4073" font-family="Inconsolata" font-size="14.00" fill="#000000">A tag needs to cling, so we need to check the</text>
<text text-anchor="middle" x="11775.5" y="-3953.0073" font-family="Inconsolata" font-size="14.00" fill="#000000">number of blank lines before and after a tag line, if any.</text>
<text text-anchor="middle" x="11775.5" y="-3937.6072" font-family="Inconsolata" font-size="14.00" fill="#000000">If even, a tag line clings down.</text>
<text text-anchor="middle" x="11775.5" y="-3890.2072" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_82&#45;&gt;leaf_146 -->
<g id="edge146" class="edge">
<title>section_82&#45;&gt;leaf_146</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9258.0796,-5447.3044C9251.2822,-5387.5407 9238.8777,-5196.3262 9344.5,-5111.4088 9439.3345,-5035.1644 11434.1869,-5144.2858 11534.5,-5075.4088 11534.6871,-5075.2803 11534.874,-5075.1517 11535.0608,-5075.0229"/>
<polygon fill="#000000" stroke="#000000" points="11537.2495,-5077.7612 11543.369,-5069.1124 11533.1917,-5072.0573 11537.2495,-5077.7612"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6736.5,-2949.9067 6412.5,-2949.9067 6412.5,-2880.7042 6736.5,-2880.7042 6736.5,-2949.9067"/>
<text text-anchor="middle" x="6574.5" y="-2934.9055" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addLine(section, line)</text>
<text text-anchor="middle" x="6574.5" y="-2919.5055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.lines[#section.lines + 1] = line</text>
<text text-anchor="middle" x="6574.5" y="-2904.1054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="6574.5" y="-2888.7054" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_86&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>codeblock_86&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6787.0111,-4460.6096C6765.6566,-4305.3271 6613.3069,-3197.4949 6580.6522,-2960.0418"/>
<polygon fill="#000000" stroke="#000000" points="6584.1058,-2959.4647 6579.276,-2950.0348 6577.1711,-2960.4184 6584.1058,-2959.4647"/>
</g>
<!-- leaf_94 -->
<g id="node95" class="node">
<title>leaf_94</title>
<polygon fill="none" stroke="#c0c0c0" points="7022.5,-2935.2075 6754.5,-2935.2075 6754.5,-2895.4034 7022.5,-2895.4034 7022.5,-2935.2075"/>
<text text-anchor="middle" x="6888.5" y="-2903.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Adds a section to the host section</text>
</g>
<!-- block_90&#45;&gt;leaf_94 -->
<g id="edge94" class="edge">
<title>block_90&#45;&gt;leaf_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7406.1452,-4460.5387C7425.6907,-4379.3997 7492.8514,-4046.9691 7327.5,-3882.0072 7233.6803,-3788.4084 7126.6702,-3938.2324 7031.5,-3846.0072 6769.7258,-3592.3334 6855.4824,-3074.4672 6881.9587,-2945.0997"/>
<polygon fill="#000000" stroke="#000000" points="6885.4236,-2945.6292 6884.0421,-2935.1248 6878.5715,-2944.198 6885.4236,-2945.6292"/>
</g>
<!-- leaf_95 -->
<g id="node96" class="node">
<title>leaf_95</title>
<polygon fill="none" stroke="#c0c0c0" points="7386,-2942.5059 7041,-2942.5059 7041,-2888.105 7386,-2888.105 7386,-2942.5059"/>
<text text-anchor="middle" x="7213.5" y="-2927.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section: &#160;Section to contain the new section.</text>
<text text-anchor="middle" x="7213.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; newsection: &#160;The new section.</text>
<text text-anchor="middle" x="7213.5" y="-2896.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: &#160;The line number.</text>
</g>
<!-- block_91&#45;&gt;leaf_95 -->
<g id="edge95" class="edge">
<title>block_91&#45;&gt;leaf_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7554.0877,-4460.5776C7568.4992,-4382.2923 7614.9845,-4068.7933 7476.5,-3882.0072 7453.0371,-3850.3608 7420.0517,-3876.8165 7395.5,-3846.0072 7172.2222,-3565.8215 7197.0254,-3089.4918 7209.4869,-2952.9206"/>
<polygon fill="#000000" stroke="#000000" points="7213.0074,-2952.869 7210.467,-2942.5832 7206.0387,-2952.2082 7213.0074,-2952.869"/>
</g>
<!-- leaf_96 -->
<g id="node97" class="node">
<title>leaf_96</title>
<polygon fill="none" stroke="#c0c0c0" points="7630.5,-2933.3054 7404.5,-2933.3054 7404.5,-2897.3054 7630.5,-2897.3054 7630.5,-2933.3054"/>
<text text-anchor="middle" x="7517.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; #return: the parent section.</text>
</g>
<!-- block_92&#45;&gt;leaf_96 -->
<g id="edge96" class="edge">
<title>block_92&#45;&gt;leaf_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7697.3931,-4460.6096C7678.8538,-4301.3544 7543.679,-3140.1866 7520.7888,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="7524.2454,-2942.9802 7519.6125,-2933.452 7517.2924,-2943.7897 7524.2454,-2942.9802"/>
</g>
<!-- codeblock_97 -->
<g id="node98" class="node">
<title>codeblock_97</title>
<ellipse fill="none" stroke="#000000" cx="7735.5" cy="-2915.3054" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7735.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 160&#45;170</text>
</g>
<!-- block_93&#45;&gt;codeblock_97 -->
<g id="edge97" class="edge">
<title>block_93&#45;&gt;codeblock_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7847.1919,-4460.6096C7835.6812,-4301.3544 7751.754,-3140.1866 7737.5419,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="7741.0235,-2943.1736 7736.8116,-2933.452 7734.0417,-2943.6783 7741.0235,-2943.1736"/>
</g>
<!-- leaf_99 -->
<g id="node100" class="node">
<title>leaf_99</title>
<polygon fill="none" stroke="#c0c0c0" points="7894.5,-2933.3054 7840.5,-2933.3054 7840.5,-2897.3054 7894.5,-2897.3054 7894.5,-2933.3054"/>
</g>
<!-- block_93&#45;&gt;leaf_99 -->
<g id="edge99" class="edge">
<title>block_93&#45;&gt;leaf_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7848.7199,-4460.6096C7850.6554,-4301.3544 7864.767,-3140.1866 7867.1567,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="7870.6576,-2943.4938 7867.2795,-2933.452 7863.6581,-2943.4087 7870.6576,-2943.4938"/>
</g>
<!-- leaf_98 -->
<g id="node99" class="node">
<title>leaf_98</title>
<polygon fill="none" stroke="#c0c0c0" points="7950,-1894.5043 7521,-1894.5043 7521,-1748.3026 7950,-1748.3026 7950,-1894.5043"/>
<text text-anchor="middle" x="7735.5" y="-1879.5036" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.addSection(section, newsection, linum, finish)</text>
<text text-anchor="middle" x="7735.5" y="-1864.1036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if linum &gt; 0 then</text>
<text text-anchor="middle" x="7735.5" y="-1848.7035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.line_last = linum &#45; 1</text>
<text text-anchor="middle" x="7735.5" y="-1833.3035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;assert(type(finish) == &quot;number&quot;)</text>
<text text-anchor="middle" x="7735.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.last = finish</text>
<text text-anchor="middle" x="7735.5" y="-1802.5034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7735.5" y="-1787.1034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[#section + 1] = newsection</text>
<text text-anchor="middle" x="7735.5" y="-1771.7034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="7735.5" y="-1756.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_97&#45;&gt;leaf_98 -->
<g id="edge98" class="edge">
<title>codeblock_97&#45;&gt;leaf_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7735.5,-2897.2314C7735.5,-2781.0372 7735.5,-2136.6673 7735.5,-1904.665"/>
<polygon fill="#000000" stroke="#000000" points="7739.0001,-1904.5945 7735.5,-1894.5945 7732.0001,-1904.5946 7739.0001,-1904.5945"/>
</g>
<!-- leaf_112 -->
<g id="node113" class="node">
<title>leaf_112</title>
<polygon fill="none" stroke="#c0c0c0" points="8118,-2935.2075 7913,-2935.2075 7913,-2895.4034 8118,-2895.4034 8118,-2935.2075"/>
<text text-anchor="middle" x="8015.5" y="-2903.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">Boolean match for a tagline</text>
</g>
<!-- block_102&#45;&gt;leaf_112 -->
<g id="edge112" class="edge">
<title>block_102&#45;&gt;leaf_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8743.2507,-4460.5925C8763.4466,-4378.9845 8833.5988,-4042.5202 8663.5,-3882.0072 8576.6749,-3800.0751 8214.1088,-3928.1679 8127.5,-3846.0072 7864.2241,-3596.2527 7974.6141,-3075.4782 8007.4697,-2945.2953"/>
<polygon fill="#000000" stroke="#000000" points="8010.9502,-2945.813 8010.0468,-2935.2568 8004.1701,-2944.0724 8010.9502,-2945.813"/>
</g>
<!-- codeblock_113 -->
<g id="node114" class="node">
<title>codeblock_113</title>
<ellipse fill="none" stroke="#000000" cx="8223.5" cy="-2915.3054" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8223.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 177&#45;181</text>
</g>
<!-- block_103&#45;&gt;codeblock_113 -->
<g id="edge113" class="edge">
<title>block_103&#45;&gt;codeblock_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8892.2644,-4460.6202C8912.5248,-4379.1318 8982.9743,-4043.1096 8813.5,-3882.0072 8733.7241,-3806.1721 8398.4906,-3922.6599 8319.5,-3846.0072 8058.1471,-3592.3894 8180.935,-3069.1695 8215.4762,-2943.0849"/>
<polygon fill="#000000" stroke="#000000" points="8218.8601,-2943.98 8218.1696,-2933.4077 8212.1164,-2942.103 8218.8601,-2943.98"/>
</g>
<!-- leaf_115 -->
<g id="node116" class="node">
<title>leaf_115</title>
<polygon fill="none" stroke="#c0c0c0" points="8382.5,-2933.3054 8328.5,-2933.3054 8328.5,-2897.3054 8382.5,-2897.3054 8382.5,-2933.3054"/>
</g>
<!-- block_103&#45;&gt;leaf_115 -->
<g id="edge115" class="edge">
<title>block_103&#45;&gt;leaf_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8892.2176,-4460.6691C8912.2752,-4379.3928 8981.9757,-4044.1535 8813.5,-3882.0072 8745.6866,-3816.7414 8456.4886,-3914.0862 8391.5,-3846.0072 8327.845,-3779.3252 8349.0305,-3092.9185 8354.4168,-2943.7941"/>
<polygon fill="#000000" stroke="#000000" points="8357.9207,-2943.7477 8354.7899,-2933.6261 8350.9255,-2943.491 8357.9207,-2943.7477"/>
</g>
<!-- leaf_116 -->
<g id="node117" class="node">
<title>leaf_116</title>
<polygon fill="none" stroke="#c0c0c0" points="8774,-2933.3054 8401,-2933.3054 8401,-2897.3054 8774,-2897.3054 8774,-2933.3054"/>
<text text-anchor="middle" x="8587.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">Lookahead, counting blank lines, return the number.</text>
</g>
<!-- block_104&#45;&gt;leaf_116 -->
<g id="edge116" class="edge">
<title>block_104&#45;&gt;leaf_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9040.8964,-4460.5689C9059.1894,-4380.2491 9121.164,-4053.0552 8962.5,-3882.0072 8907.3134,-3822.5132 8841.1409,-3903.1264 8783.5,-3846.0072 8521.0878,-3585.9699 8567.6419,-3069.6008 8583.5488,-2943.5485"/>
<polygon fill="#000000" stroke="#000000" points="8587.0317,-2943.9059 8584.8531,-2933.5375 8580.0904,-2943.0015 8587.0317,-2943.9059"/>
</g>
<!-- leaf_117 -->
<g id="node118" class="node">
<title>leaf_117</title>
<polygon fill="none" stroke="#c0c0c0" points="9116.5,-2934.606 8792.5,-2934.606 8792.5,-2896.0049 9116.5,-2896.0049 9116.5,-2934.606"/>
<text text-anchor="middle" x="8954.5" y="-2919.5055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; lines: the full lines array of the section</text>
<text text-anchor="middle" x="8954.5" y="-2904.1054" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum: current index into lines</text>
</g>
<!-- block_105&#45;&gt;leaf_117 -->
<g id="edge117" class="edge">
<title>block_105&#45;&gt;leaf_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9183.5074,-4460.6116C9175.4463,-4387.8844 9144.1192,-4109.8585 9111.5,-3882.0072 9058.4003,-3511.095 8980.3801,-3062.4218 8959.6913,-2944.7154"/>
<polygon fill="#000000" stroke="#000000" points="8963.1041,-2943.9137 8957.9238,-2934.6717 8956.21,-2945.127 8963.1041,-2943.9137"/>
</g>
<!-- leaf_118 -->
<g id="node119" class="node">
<title>leaf_118</title>
<polygon fill="none" stroke="#c0c0c0" points="9494,-2933.3054 9135,-2933.3054 9135,-2897.3054 9494,-2897.3054 9494,-2933.3054"/>
<text text-anchor="middle" x="9314.5" y="-2911.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns: number of blank lines forward of index</text>
</g>
<!-- block_106&#45;&gt;leaf_118 -->
<g id="edge118" class="edge">
<title>block_106&#45;&gt;leaf_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9334.2685,-4460.6096C9332.2312,-4301.3544 9317.3768,-3140.1866 9314.8614,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="9318.3599,-2943.4064 9314.7321,-2933.452 9311.3604,-2943.496 9318.3599,-2943.4064"/>
</g>
<!-- codeblock_119 -->
<g id="node120" class="node">
<title>codeblock_119</title>
<ellipse fill="none" stroke="#000000" cx="9599.5" cy="-2915.3054" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="9599.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 191&#45;208</text>
</g>
<!-- block_107&#45;&gt;codeblock_119 -->
<g id="edge119" class="edge">
<title>block_107&#45;&gt;codeblock_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9599.5,-4460.6096C9599.5,-4301.3544 9599.5,-3140.1866 9599.5,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="9603.0001,-2943.452 9599.5,-2933.452 9596.0001,-2943.452 9603.0001,-2943.452"/>
</g>
<!-- leaf_121 -->
<g id="node122" class="node">
<title>leaf_121</title>
<polygon fill="none" stroke="#c0c0c0" points="9758.5,-2933.3054 9704.5,-2933.3054 9704.5,-2897.3054 9758.5,-2897.3054 9758.5,-2933.3054"/>
</g>
<!-- block_107&#45;&gt;leaf_121 -->
<g id="edge121" class="edge">
<title>block_107&#45;&gt;leaf_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9602.9938,-4460.6805C9617.3647,-4385.6983 9672.2494,-4090.9953 9695.5,-3846.0072 9729.1734,-3491.1957 9731.5489,-3057.4404 9731.5586,-2943.6949"/>
<polygon fill="#000000" stroke="#000000" points="9735.0585,-2943.4091 9731.5527,-2933.4111 9728.0585,-2943.4131 9735.0585,-2943.4091"/>
</g>
<!-- header_122 -->
<g id="node123" class="node">
<title>header_122</title>
<ellipse fill="none" stroke="#000000" cx="9828.5" cy="-2915.3054" rx="52.2623" ry="18"/>
<text text-anchor="middle" x="9828.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : List line</text>
</g>
<!-- section_108&#45;&gt;header_122 -->
<g id="edge122" class="edge">
<title>section_108&#45;&gt;header_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9895.7128,-4460.6096C9888.786,-4301.3544 9838.2812,-3140.1866 9829.7288,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="9833.2206,-2943.2904 9829.2893,-2933.452 9826.2272,-2943.5947 9833.2206,-2943.2904"/>
</g>
<!-- block_123 -->
<g id="node124" class="node">
<title>block_123</title>
<ellipse fill="none" stroke="#000000" cx="9964.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9964.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 230&#45;235</text>
</g>
<!-- section_108&#45;&gt;block_123 -->
<g id="edge123" class="edge">
<title>section_108&#45;&gt;block_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9897.2872,-4460.6096C9904.214,-4301.3544 9954.7188,-3140.1866 9963.2712,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="9966.7728,-2943.5947 9963.7107,-2933.452 9959.7794,-2943.2904 9966.7728,-2943.5947"/>
</g>
<!-- leaf_125 -->
<g id="node126" class="node">
<title>leaf_125</title>
<polygon fill="none" stroke="#c0c0c0" points="10372.5,-2973.9062 10048.5,-2973.9062 10048.5,-2856.7046 10372.5,-2856.7046 10372.5,-2973.9062"/>
<text text-anchor="middle" x="10210.5" y="-2958.9055" font-family="Inconsolata" font-size="14.00" fill="#000000">**** List line</text>
<text text-anchor="middle" x="10210.5" y="-2927.5055" font-family="Inconsolata" font-size="14.00" fill="#000000">New block unless previous line is also list,</text>
<text text-anchor="middle" x="10210.5" y="-2912.1054" font-family="Inconsolata" font-size="14.00" fill="#000000">in which case append. </text>
<text text-anchor="middle" x="10210.5" y="-2864.7054" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_108&#45;&gt;leaf_125 -->
<g id="edge125" class="edge">
<title>section_108&#45;&gt;leaf_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9900.8648,-4460.6468C9918.9576,-4385.5316 9989.4565,-4090.3769 10039.5,-3846.0072 10105.2668,-3524.8579 10172.4,-3138.9045 10198.813,-2984.2843"/>
<polygon fill="#000000" stroke="#000000" points="10202.3365,-2984.4424 10200.5687,-2973.9961 10195.4363,-2983.2649 10202.3365,-2984.4424"/>
</g>
<!-- header_126 -->
<g id="node127" class="node">
<title>header_126</title>
<ellipse fill="none" stroke="#000000" cx="10450.5" cy="-2915.3054" rx="59.7106" ry="18"/>
<text text-anchor="middle" x="10450.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : Table line</text>
</g>
<!-- section_109&#45;&gt;header_126 -->
<g id="edge126" class="edge">
<title>section_109&#45;&gt;header_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10520.6781,-4460.6096C10513.4457,-4301.3544 10460.7127,-3140.1866 10451.783,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="10455.2743,-2943.2829 10451.3241,-2933.452 10448.2815,-2943.6005 10455.2743,-2943.2829"/>
</g>
<!-- block_127 -->
<g id="node128" class="node">
<title>block_127</title>
<ellipse fill="none" stroke="#000000" cx="10593.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="10593.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 236&#45;240</text>
</g>
<!-- section_109&#45;&gt;block_127 -->
<g id="edge127" class="edge">
<title>section_109&#45;&gt;block_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10522.3335,-4460.6096C10529.6677,-4301.3544 10583.1435,-3140.1866 10592.1989,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="10595.7004,-2943.6025 10592.6643,-2933.452 10588.7079,-2943.2804 10595.7004,-2943.6025"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="10798,-2966.5057 10677,-2966.5057 10677,-2864.1052 10798,-2864.1052 10798,-2966.5057"/>
<text text-anchor="middle" x="10737.5" y="-2951.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Table line</text>
<text text-anchor="middle" x="10737.5" y="-2919.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">Same as list.</text>
<text text-anchor="middle" x="10737.5" y="-2872.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_109&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>section_109&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10526.8138,-4460.5334C10548.5006,-4385.5616 10630.9324,-4092.6655 10668.5,-3846.0072 10717.9946,-3521.0398 10732.3762,-3126.6099 10736.2134,-2976.9156"/>
<polygon fill="#000000" stroke="#000000" points="10739.7211,-2976.6491 10736.4718,-2966.5648 10732.7233,-2976.4743 10739.7211,-2976.6491"/>
</g>
<!-- header_130 -->
<g id="node131" class="node">
<title>header_130</title>
<ellipse fill="none" stroke="#000000" cx="10871.5" cy="-2915.3054" rx="55.3589" ry="18"/>
<text text-anchor="middle" x="10871.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : Tag line </text>
</g>
<!-- section_110&#45;&gt;header_130 -->
<g id="edge130" class="edge">
<title>section_110&#45;&gt;header_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10939.7012,-4460.6096C10932.6726,-4301.3544 10881.425,-3140.1866 10872.7469,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="10876.2385,-2943.2879 10872.3009,-2933.452 10869.2453,-2943.5966 10876.2385,-2943.2879"/>
</g>
<!-- block_131 -->
<g id="node132" class="node">
<title>block_131</title>
<ellipse fill="none" stroke="#000000" cx="11010.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="11010.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 241&#45;247</text>
</g>
<!-- section_110&#45;&gt;block_131 -->
<g id="edge131" class="edge">
<title>section_110&#45;&gt;block_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10941.3103,-4460.6096C10948.4409,-4301.3544 11000.4311,-3140.1866 11009.2351,-2943.5566"/>
<polygon fill="#000000" stroke="#000000" points="11012.7366,-2943.5986 11009.6875,-2933.452 11005.7436,-2943.2854 11012.7366,-2943.5986"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="11516.5,-2981.8056 11094.5,-2981.8056 11094.5,-2848.8053 11516.5,-2848.8053 11516.5,-2981.8056"/>
<text text-anchor="middle" x="11305.5" y="-2966.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Tag line </text>
<text text-anchor="middle" x="11305.5" y="-2935.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">A tag needs to cling, so we need to check the</text>
<text text-anchor="middle" x="11305.5" y="-2919.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">number of blank lines before and after a tag line, if any.</text>
<text text-anchor="middle" x="11305.5" y="-2904.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">If even, a tag line clings down.</text>
<text text-anchor="middle" x="11305.5" y="-2857.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_110&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>section_110&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10944.7253,-4460.6096C10979.5564,-4311.4177 11219.6714,-3282.9345 11287.6202,-2991.8898"/>
<polygon fill="#000000" stroke="#000000" points="11291.0989,-2992.3841 11289.9641,-2981.8502 11284.2822,-2990.7926 11291.0989,-2992.3841"/>
</g>
<!-- header_134 -->
<g id="node135" class="node">
<title>header_134</title>
<ellipse fill="none" stroke="#000000" cx="11601.5" cy="-2915.3054" rx="66.779" ry="18"/>
<text text-anchor="middle" x="11601.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : Code block</text>
</g>
<!-- section_111&#45;&gt;header_134 -->
<g id="edge134" class="edge">
<title>section_111&#45;&gt;header_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11452.8901,-4460.6152C11462.7775,-4385.3754 11501.105,-4089.7973 11525.5,-3846.0072 11561.0782,-3490.4579 11591.7298,-3057.2352 11599.5647,-2943.6521"/>
<polygon fill="#000000" stroke="#000000" points="11603.0765,-2943.5998 11600.2708,-2933.3833 11596.093,-2943.1196 11603.0765,-2943.5998"/>
</g>
<!-- block_135 -->
<g id="node136" class="node">
<title>block_135</title>
<ellipse fill="none" stroke="#000000" cx="11751.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="11751.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 248&#45;252</text>
</g>
<!-- section_111&#45;&gt;block_135 -->
<g id="edge135" class="edge">
<title>section_111&#45;&gt;block_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.6617,-4460.7078C11430.7951,-4380.9781 11378.2251,-4055.9259 11534.5,-3882.0072 11578.304,-3833.2576 11635.1908,-3896.0596 11677.5,-3846.0072 11911.3541,-3569.3544 11793.2987,-3066.4296 11759.5389,-2943.1427"/>
<polygon fill="#000000" stroke="#000000" points="11762.8654,-2942.041 11756.8126,-2933.3453 11756.1216,-2943.9176 11762.8654,-2942.041"/>
</g>
<!-- block_136 -->
<g id="node137" class="node">
<title>block_136</title>
<ellipse fill="none" stroke="#000000" cx="11900.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="11900.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 253&#45;254</text>
</g>
<!-- section_111&#45;&gt;block_136 -->
<g id="edge136" class="edge">
<title>section_111&#45;&gt;block_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.2156,-4460.4971C11428.2716,-4379.1797 11367.5665,-4046.0961 11534.5,-3882.0072 11627.7527,-3790.3436 11736.063,-3940.4498 11826.5,-3846.0072 12077.5647,-3583.8223 11945.9892,-3068.0904 11909.114,-2943.0809"/>
<polygon fill="#000000" stroke="#000000" points="11912.4604,-2942.0546 11906.2392,-2933.4786 11905.7544,-2944.0624 11912.4604,-2942.0546"/>
</g>
<!-- block_137 -->
<g id="node138" class="node">
<title>block_137</title>
<ellipse fill="none" stroke="#000000" cx="12076.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12076.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 255&#45;256</text>
</g>
<!-- section_111&#45;&gt;block_137 -->
<g id="edge137" class="edge">
<title>section_111&#45;&gt;block_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.1186,-4460.6057C11427.5701,-4379.0546 11364.0303,-4042.8007 11534.5,-3882.0072 11606.0273,-3814.5399 11905.0529,-3914.6017 11975.5,-3846.0072 12236.5689,-3591.8034 12117.8293,-3069.0239 12084.2983,-2943.0578"/>
<polygon fill="#000000" stroke="#000000" points="12087.6728,-2942.1287 12081.6827,-2933.3897 12080.9157,-2943.9568 12087.6728,-2942.1287"/>
</g>
<!-- block_138 -->
<g id="node139" class="node">
<title>block_138</title>
<ellipse fill="none" stroke="#000000" cx="12303.5" cy="-2915.3054" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12303.5" y="-2911.1054" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 257&#45;366</text>
</g>
<!-- section_111&#45;&gt;block_138 -->
<g id="edge138" class="edge">
<title>section_111&#45;&gt;block_138</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.0318,-4460.5126C11427.1072,-4378.5582 11362.1789,-4040.8149 11534.5,-3882.0072 11635.4963,-3788.9309 12049.4844,-3937.9652 12151.5,-3846.0072 12424.1621,-3600.2265 12335.8059,-3071.0374 12309.6621,-2943.4182"/>
<polygon fill="#000000" stroke="#000000" points="12313.0189,-2942.3712 12307.5452,-2933.2999 12306.1673,-2943.8047 12313.0189,-2942.3712"/>
</g>
<!-- leaf_145 -->
<g id="node146" class="node">
<title>leaf_145</title>
<polygon fill="none" stroke="#c0c0c0" points="12970,-3846.209 12387,-3846.209 12387,-1984.4019 12970,-1984.4019 12970,-3846.209"/>
<text text-anchor="middle" x="12678.5" y="-3830.8072" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Code block</text>
<text text-anchor="middle" x="12678.5" y="-3799.4071" font-family="Inconsolata" font-size="14.00" fill="#000000">A code block is anything between a code header and</text>
<text text-anchor="middle" x="12678.5" y="-3784.0071" font-family="Inconsolata" font-size="14.00" fill="#000000">either a code footer or the end of a file. </text>
<text text-anchor="middle" x="12678.5" y="-3752.6071" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section : the Section to be blocked</text>
<text text-anchor="middle" x="12678.5" y="-3721.2071" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns : the same Section, filled in with blocks</text>
<text text-anchor="middle" x="12678.5" y="-3689.807" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="12678.5" y="-3674.407" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.block(section)</text>
<text text-anchor="middle" x="12678.5" y="-3659.007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; There is always a header at [1], though it may be nil</text>
<text text-anchor="middle" x="12678.5" y="-3643.6069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; If there are other Nodes, they are sections and must be appended</text>
<text text-anchor="middle" x="12678.5" y="-3628.2069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; after the blocks.</text>
<text text-anchor="middle" x="12678.5" y="-3612.8069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sub_sections = {}</text>
<text text-anchor="middle" x="12678.5" y="-3597.4068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #section do</text>
<text text-anchor="middle" x="12678.5" y="-3582.0068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;sub_sections[#sub_sections + 1] = section[i]</text>
<text text-anchor="middle" x="12678.5" y="-3566.6068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = nil</text>
<text text-anchor="middle" x="12678.5" y="-3551.2067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-3519.8067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Every section gets at least one block, at [2], which may be empty.</text>
<text text-anchor="middle" x="12678.5" y="-3504.4067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = Block(nil, section.line_first) &#45;&#45; current block</text>
<text text-anchor="middle" x="12678.5" y="-3489.0066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[2] = latest</text>
<text text-anchor="middle" x="12678.5" y="-3457.6066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; State machine for blocking a section</text>
<text text-anchor="middle" x="12678.5" y="-3442.2066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local back_blanks = 0</text>
<text text-anchor="middle" x="12678.5" y="-3426.8066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; first set of blank lines in a section belong to the first block</text>
<text text-anchor="middle" x="12678.5" y="-3411.4065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_blanks = true</text>
<text text-anchor="middle" x="12678.5" y="-3396.0065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks in own logic</text>
<text text-anchor="middle" x="12678.5" y="-3380.6065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="12678.5" y="-3365.2064" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Tags also</text>
<text text-anchor="middle" x="12678.5" y="-3349.8064" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local tagging = false</text>
<text text-anchor="middle" x="12678.5" y="-3334.4064" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 1, #section.lines do</text>
<text text-anchor="middle" x="12678.5" y="-3319.0063" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local inset = i + section.line_first</text>
<text text-anchor="middle" x="12678.5" y="-3303.6063" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l = section.lines[i]</text>
<text text-anchor="middle" x="12678.5" y="-3288.2063" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="12678.5" y="-3272.8062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if l == &quot;&quot; then </text>
<text text-anchor="middle" x="12678.5" y="-3257.4062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; increment back blanks for clinging subsequent lines</text>
<text text-anchor="middle" x="12678.5" y="-3242.0062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = back_blanks + 1</text>
<text text-anchor="middle" x="12678.5" y="-3226.6061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank lines attach to the preceding block</text>
<text text-anchor="middle" x="12678.5" y="-3211.2061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12678.5" y="-3195.8061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-3180.4061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeHeader, level, l_trim = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="12678.5" y="-3165.006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isCodeHeader then</text>
<text text-anchor="middle" x="12678.5" y="-3149.606" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true</text>
<text text-anchor="middle" x="12678.5" y="-3134.206" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="12678.5" y="-3118.8059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; create a new block for the codeblock</text>
<text text-anchor="middle" x="12678.5" y="-3103.4059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12678.5" y="-3088.0059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(nil, inset)</text>
<text text-anchor="middle" x="12678.5" y="-3072.6058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="12678.5" y="-3057.2058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12678.5" y="-3041.8058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-3026.4057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; preserve existing block and add codeblock</text>
<text text-anchor="middle" x="12678.5" y="-3011.0057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="12678.5" y="-2995.6057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="12678.5" y="-2980.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2964.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif isTagline(l) then</text>
<text text-anchor="middle" x="12678.5" y="-2949.4056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = true</text>
<text text-anchor="middle" x="12678.5" y="-2934.0056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; apply cling rule</text>
<text text-anchor="middle" x="12678.5" y="-2918.6055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local fwd_blanks = fwdBlanks(section.lines, i)</text>
<text text-anchor="middle" x="12678.5" y="-2903.2055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if fwd_blanks &gt; back_blanks then</text>
<text text-anchor="middle" x="12678.5" y="-2887.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12678.5" y="-2872.4054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2857.0054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="12678.5" y="-2841.6054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12678.5" y="-2826.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="12678.5" y="-2810.8053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12678.5" y="-2795.4053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12678.5" y="-2780.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="12678.5" y="-2764.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2749.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if back_blanks &gt; 0 and lead_blanks == false then</text>
<text text-anchor="middle" x="12678.5" y="-2733.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="12678.5" y="-2718.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="12678.5" y="-2703.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12678.5" y="-2687.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="12678.5" y="-2672.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12678.5" y="-2656.805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12678.5" y="-2641.405" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2626.0049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12678.5" y="-2610.6049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="12678.5" y="-2595.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="12678.5" y="-2579.8048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2564.4048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; continuing a block</text>
<text text-anchor="middle" x="12678.5" y="-2549.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lead_blanks = false</text>
<text text-anchor="middle" x="12678.5" y="-2533.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12678.5" y="-2518.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12678.5" y="-2502.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2487.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2472.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2456.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2441.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Collecting a code block</text>
<text text-anchor="middle" x="12678.5" y="-2425.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeFoot, level, l_trim = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="12678.5" y="-2410.4045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (isCodeFoot and level == latest[1].level) then</text>
<text text-anchor="middle" x="12678.5" y="-2395.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="12678.5" y="-2379.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].footer = l_trim</text>
<text text-anchor="middle" x="12678.5" y="-2364.2044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = inset</text>
<text text-anchor="middle" x="12678.5" y="-2348.8044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12678.5" y="-2333.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].lines[#latest[1].lines + 1] = l</text>
<text text-anchor="middle" x="12678.5" y="-2318.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2302.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Continue in normal parse mode</text>
<text text-anchor="middle" x="12678.5" y="-2287.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; This may add more lines to the code block</text>
<text text-anchor="middle" x="12678.5" y="-2271.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2256.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2241.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Auto&#45;close a code block with no footer.</text>
<text text-anchor="middle" x="12678.5" y="-2225.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if latest[1] and latest[1].id == &quot;codeblock&quot; and not latest[1].line_last then</text>
<text text-anchor="middle" x="12678.5" y="-2210.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = #section.lines</text>
<text text-anchor="middle" x="12678.5" y="-2194.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2163.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Close last block</text>
<text text-anchor="middle" x="12678.5" y="-2148.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;latest.line_last = section.line_last</text>
<text text-anchor="middle" x="12678.5" y="-2116.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Append sections, if any, which follow our blocks</text>
<text text-anchor="middle" x="12678.5" y="-2101.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(sub_sections) do</text>
<text text-anchor="middle" x="12678.5" y="-2085.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = v</text>
<text text-anchor="middle" x="12678.5" y="-2070.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12678.5" y="-2055.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="12678.5" y="-2039.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="12678.5" y="-2024.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="12678.5" y="-1992.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_111&#45;&gt;leaf_145 -->
<g id="edge145" class="edge">
<title>section_111&#45;&gt;leaf_145</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11446.0378,-4460.7235C11426.9451,-4378.9762 11360.7476,-4039.6372 11534.5,-3882.0072 11604.018,-3818.9397 12303.8227,-3902.8717 12378.5,-3846.0072 12378.5844,-3845.9429 12378.6688,-3845.8786 12378.7532,-3845.8143"/>
<polygon fill="#000000" stroke="#000000" points="12380.7884,-3848.6654 12386.5325,-3839.7628 12376.4904,-3843.1402 12380.7884,-3848.6654"/>
</g>
<!-- leaf_114 -->
<g id="node115" class="node">
<title>leaf_114</title>
<polygon fill="none" stroke="#c0c0c0" points="8361,-1848.6039 8086,-1848.6039 8086,-1794.203 8361,-1794.203 8361,-1848.6039"/>
<text text-anchor="middle" x="8223.5" y="-1833.3035" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isTagline(line)</text>
<text text-anchor="middle" x="8223.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return L.match(m.tagline_p, line)</text>
<text text-anchor="middle" x="8223.5" y="-1802.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_113&#45;&gt;leaf_114 -->
<g id="edge114" class="edge">
<title>codeblock_113&#45;&gt;leaf_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8223.5,-2897.2314C8223.5,-2772.0746 8223.5,-2034.1175 8223.5,-1858.7705"/>
<polygon fill="#000000" stroke="#000000" points="8227.0001,-1858.7387 8223.5,-1848.7387 8220.0001,-1858.7387 8227.0001,-1858.7387"/>
</g>
<!-- leaf_120 -->
<g id="node121" class="node">
<title>leaf_120</title>
<polygon fill="none" stroke="#c0c0c0" points="9740.5,-1948.8043 9458.5,-1948.8043 9458.5,-1694.0026 9740.5,-1694.0026 9740.5,-1948.8043"/>
<text text-anchor="middle" x="9599.5" y="-1933.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">local function fwdBlanks(lines, linum)</text>
<text text-anchor="middle" x="9599.5" y="-1918.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local fwd = 0</text>
<text text-anchor="middle" x="9599.5" y="-1902.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local index = linum + 1</text>
<text text-anchor="middle" x="9599.5" y="-1887.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if index &gt; #lines then </text>
<text text-anchor="middle" x="9599.5" y="-1871.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return 0</text>
<text text-anchor="middle" x="9599.5" y="-1856.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="9599.5" y="-1841.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = index, #lines do</text>
<text text-anchor="middle" x="9599.5" y="-1825.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if lines[i] == &quot;&quot; then</text>
<text text-anchor="middle" x="9599.5" y="-1810.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;fwd = fwd + 1</text>
<text text-anchor="middle" x="9599.5" y="-1794.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="9599.5" y="-1779.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;break</text>
<text text-anchor="middle" x="9599.5" y="-1764.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9599.5" y="-1748.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9599.5" y="-1733.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="9599.5" y="-1717.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return fwd</text>
<text text-anchor="middle" x="9599.5" y="-1702.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_119&#45;&gt;leaf_120 -->
<g id="edge120" class="edge">
<title>codeblock_119&#45;&gt;leaf_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9599.5,-2897.2314C9599.5,-2789.1719 9599.5,-2224.3026 9599.5,-1959.1328"/>
<polygon fill="#000000" stroke="#000000" points="9603.0001,-1959.0539 9599.5,-1949.054 9596.0001,-1959.054 9603.0001,-1959.0539"/>
</g>
<!-- leaf_124 -->
<g id="node125" class="node">
<title>leaf_124</title>
<polygon fill="none" stroke="#c0c0c0" points="10126.5,-1856.7038 9802.5,-1856.7038 9802.5,-1786.1031 10126.5,-1786.1031 10126.5,-1856.7038"/>
<text text-anchor="middle" x="9964.5" y="-1825.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">New block unless previous line is also list,</text>
<text text-anchor="middle" x="9964.5" y="-1810.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">in which case append. </text>
</g>
<!-- block_123&#45;&gt;leaf_124 -->
<g id="edge124" class="edge">
<title>block_123&#45;&gt;leaf_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9964.5,-2897.2314C9964.5,-2773.9322 9964.5,-2055.8892 9964.5,-1866.9465"/>
<polygon fill="#000000" stroke="#000000" points="9968.0001,-1866.8052 9964.5,-1856.8052 9961.0001,-1866.8053 9968.0001,-1866.8052"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="10647,-1849.305 10540,-1849.305 10540,-1793.502 10647,-1793.502 10647,-1849.305"/>
<text text-anchor="middle" x="10593.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000">Same as list.</text>
</g>
<!-- block_127&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>block_127&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10593.5,-2897.2314C10593.5,-2772.2107 10593.5,-2035.7219 10593.5,-1859.3446"/>
<polygon fill="#000000" stroke="#000000" points="10597.0001,-1859.2465 10593.5,-1849.2465 10590.0001,-1859.2465 10597.0001,-1859.2465"/>
</g>
<!-- leaf_132 -->
<g id="node133" class="node">
<title>leaf_132</title>
<polygon fill="none" stroke="#c0c0c0" points="11207.5,-1864.6038 10785.5,-1864.6038 10785.5,-1778.2031 11207.5,-1778.2031 11207.5,-1864.6038"/>
<text text-anchor="middle" x="10996.5" y="-1833.3035" font-family="Inconsolata" font-size="14.00" fill="#000000">A tag needs to cling, so we need to check the</text>
<text text-anchor="middle" x="10996.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000">number of blank lines before and after a tag line, if any.</text>
<text text-anchor="middle" x="10996.5" y="-1802.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">If even, a tag line clings down.</text>
</g>
<!-- block_131&#45;&gt;leaf_132 -->
<g id="edge132" class="edge">
<title>block_131&#45;&gt;leaf_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11010.2687,-2897.2314C11008.7118,-2775.5834 10999.7458,-2075.0144 10997.1836,-1874.8193"/>
<polygon fill="#000000" stroke="#000000" points="11000.6801,-1874.5144 10997.0523,-1864.56 10993.6807,-1874.604 11000.6801,-1874.5144"/>
</g>
<!-- leaf_139 -->
<g id="node140" class="node">
<title>leaf_139</title>
<polygon fill="none" stroke="#c0c0c0" points="11591.5,-1848.7039 11225.5,-1848.7039 11225.5,-1794.103 11591.5,-1794.103 11591.5,-1848.7039"/>
<text text-anchor="middle" x="11408.5" y="-1817.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">A code block is anything between a code header and</text>
<text text-anchor="middle" x="11408.5" y="-1802.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">either a code footer or the end of a file. </text>
</g>
<!-- block_135&#45;&gt;leaf_139 -->
<g id="edge139" class="edge">
<title>block_135&#45;&gt;leaf_139</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11756.1006,-2897.2776C11780.8645,-2795.8776 11889.506,-2290.2752 11677.5,-1984.6037 11655.9699,-1953.5615 11633.4477,-1967.0864 11600.5,-1948.6037 11548.9512,-1919.6865 11492.9172,-1881.7534 11454.765,-1854.8579"/>
<polygon fill="#000000" stroke="#000000" points="11456.6092,-1851.8752 11446.4251,-1848.9537 11452.5645,-1857.5884 11456.6092,-1851.8752"/>
</g>
<!-- leaf_140 -->
<g id="node141" class="node">
<title>leaf_140</title>
<polygon fill="none" stroke="#c0c0c0" points="11885,-1839.4035 11610,-1839.4035 11610,-1803.4035 11885,-1803.4035 11885,-1839.4035"/>
<text text-anchor="middle" x="11747.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; section : the Section to be blocked</text>
</g>
<!-- block_136&#45;&gt;leaf_140 -->
<g id="edge140" class="edge">
<title>block_136&#45;&gt;leaf_140</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M11901.5127,-2897.1393C11906.3775,-2800.867 11923.3218,-2341.2606 11826.5,-1984.6037 11812.6889,-1933.7286 11783.1399,-1879.5752 11764.3541,-1848.2045"/>
<polygon fill="#000000" stroke="#000000" points="11767.3139,-1846.3354 11759.131,-1839.6055 11761.3311,-1849.9694 11767.3139,-1846.3354"/>
</g>
<!-- leaf_141 -->
<g id="node142" class="node">
<title>leaf_141</title>
<polygon fill="none" stroke="#c0c0c0" points="12276,-1839.4035 11903,-1839.4035 11903,-1803.4035 12276,-1803.4035 12276,-1839.4035"/>
<text text-anchor="middle" x="12089.5" y="-1817.9035" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; returns : the same Section, filled in with blocks</text>
</g>
<!-- block_137&#45;&gt;leaf_141 -->
<g id="edge141" class="edge">
<title>block_137&#45;&gt;leaf_141</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12076.7148,-2897.2314C12078.2284,-2769.8661 12087.2839,-2007.8835 12089.1599,-1850.0203"/>
<polygon fill="#000000" stroke="#000000" points="12092.6632,-1849.7561 12089.2824,-1839.7152 12085.6637,-1849.6729 12092.6632,-1849.7561"/>
</g>
<!-- codeblock_142 -->
<g id="node143" class="node">
<title>codeblock_142</title>
<ellipse fill="none" stroke="#000000" cx="12381.5" cy="-1821.4035" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="12381.5" y="-1817.2035" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 257&#45;365</text>
</g>
<!-- block_138&#45;&gt;codeblock_142 -->
<g id="edge142" class="edge">
<title>block_138&#45;&gt;codeblock_142</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12304.7888,-2897.2314C12313.8705,-2769.8661 12368.2032,-2007.8835 12379.4595,-1850.0203"/>
<polygon fill="#000000" stroke="#000000" points="12382.9741,-1849.9388 12380.1943,-1839.7152 12375.9918,-1849.4409 12382.9741,-1849.9388"/>
</g>
<!-- leaf_144 -->
<g id="node145" class="node">
<title>leaf_144</title>
<polygon fill="none" stroke="#c0c0c0" points="12540.5,-1839.4035 12486.5,-1839.4035 12486.5,-1803.4035 12540.5,-1803.4035 12540.5,-1839.4035"/>
</g>
<!-- block_138&#45;&gt;leaf_144 -->
<g id="edge144" class="edge">
<title>block_138&#45;&gt;leaf_144</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12298.5443,-2897.2903C12271.5395,-2794.9165 12151.4485,-2280.5496 12377.5,-1984.6037 12406.1731,-1947.0649 12445.2835,-1983.1495 12477.5,-1948.6037 12502.7611,-1921.5162 12510.4796,-1878.0305 12512.7343,-1849.5863"/>
<polygon fill="#000000" stroke="#000000" points="12516.2348,-1849.683 12513.3561,-1839.4868 12509.2481,-1849.2528 12516.2348,-1849.683"/>
</g>
<!-- leaf_143 -->
<g id="node144" class="node">
<title>leaf_143</title>
<polygon fill="none" stroke="#c0c0c0" points="12673,-1658.3048 12090,-1658.3048 12090,.1016 12673,.1016 12673,-1658.3048"/>
<text text-anchor="middle" x="12381.5" y="-1643.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.block(section)</text>
<text text-anchor="middle" x="12381.5" y="-1627.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; There is always a header at [1], though it may be nil</text>
<text text-anchor="middle" x="12381.5" y="-1612.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; If there are other Nodes, they are sections and must be appended</text>
<text text-anchor="middle" x="12381.5" y="-1596.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; after the blocks.</text>
<text text-anchor="middle" x="12381.5" y="-1581.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local sub_sections = {}</text>
<text text-anchor="middle" x="12381.5" y="-1566.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #section do</text>
<text text-anchor="middle" x="12381.5" y="-1550.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;sub_sections[#sub_sections + 1] = section[i]</text>
<text text-anchor="middle" x="12381.5" y="-1535.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = nil</text>
<text text-anchor="middle" x="12381.5" y="-1519.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-1488.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Every section gets at least one block, at [2], which may be empty.</text>
<text text-anchor="middle" x="12381.5" y="-1473.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = Block(nil, section.line_first) &#45;&#45; current block</text>
<text text-anchor="middle" x="12381.5" y="-1457.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section[2] = latest</text>
<text text-anchor="middle" x="12381.5" y="-1426.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; State machine for blocking a section</text>
<text text-anchor="middle" x="12381.5" y="-1410.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local back_blanks = 0</text>
<text text-anchor="middle" x="12381.5" y="-1395.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; first set of blank lines in a section belong to the first block</text>
<text text-anchor="middle" x="12381.5" y="-1380.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local lead_blanks = true</text>
<text text-anchor="middle" x="12381.5" y="-1364.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Track code blocks in own logic</text>
<text text-anchor="middle" x="12381.5" y="-1349.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local code_block = false</text>
<text text-anchor="middle" x="12381.5" y="-1333.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Tags also</text>
<text text-anchor="middle" x="12381.5" y="-1318.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local tagging = false</text>
<text text-anchor="middle" x="12381.5" y="-1303.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 1, #section.lines do</text>
<text text-anchor="middle" x="12381.5" y="-1287.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local inset = i + section.line_first</text>
<text text-anchor="middle" x="12381.5" y="-1272.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local l = section.lines[i]</text>
<text text-anchor="middle" x="12381.5" y="-1256.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not code_block then</text>
<text text-anchor="middle" x="12381.5" y="-1241.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if l == &quot;&quot; then </text>
<text text-anchor="middle" x="12381.5" y="-1226.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; increment back blanks for clinging subsequent lines</text>
<text text-anchor="middle" x="12381.5" y="-1210.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = back_blanks + 1</text>
<text text-anchor="middle" x="12381.5" y="-1195.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank lines attach to the preceding block</text>
<text text-anchor="middle" x="12381.5" y="-1179.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12381.5" y="-1164.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-1149.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeHeader, level, l_trim = Codeblock.matchHead(l)</text>
<text text-anchor="middle" x="12381.5" y="-1133.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if isCodeHeader then</text>
<text text-anchor="middle" x="12381.5" y="-1118.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = true</text>
<text text-anchor="middle" x="12381.5" y="-1102.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="12381.5" y="-1087.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; create a new block for the codeblock</text>
<text text-anchor="middle" x="12381.5" y="-1072.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12381.5" y="-1056.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(nil, inset)</text>
<text text-anchor="middle" x="12381.5" y="-1041.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="12381.5" y="-1025.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12381.5" y="-1010.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-995.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; preserve existing block and add codeblock</text>
<text text-anchor="middle" x="12381.5" y="-979.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="12381.5" y="-964.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1] = Codeblock(level, l_trim, inset)</text>
<text text-anchor="middle" x="12381.5" y="-948.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-933.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif isTagline(l) then</text>
<text text-anchor="middle" x="12381.5" y="-918.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = true</text>
<text text-anchor="middle" x="12381.5" y="-902.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; apply cling rule</text>
<text text-anchor="middle" x="12381.5" y="-887.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local fwd_blanks = fwdBlanks(section.lines, i)</text>
<text text-anchor="middle" x="12381.5" y="-871.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if fwd_blanks &gt; back_blanks then</text>
<text text-anchor="middle" x="12381.5" y="-856.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12381.5" y="-841.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-825.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="12381.5" y="-810.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12381.5" y="-794.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="12381.5" y="-779.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12381.5" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12381.5" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="12381.5" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if back_blanks &gt; 0 and lead_blanks == false then</text>
<text text-anchor="middle" x="12381.5" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if not tagging then</text>
<text text-anchor="middle" x="12381.5" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new block</text>
<text text-anchor="middle" x="12381.5" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest.line_last = inset &#45; 1</text>
<text text-anchor="middle" x="12381.5" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = Block(l, inset)</text>
<text text-anchor="middle" x="12381.5" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = latest</text>
<text text-anchor="middle" x="12381.5" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12381.5" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12381.5" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tagging = false</text>
<text text-anchor="middle" x="12381.5" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="12381.5" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; continuing a block</text>
<text text-anchor="middle" x="12381.5" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;lead_blanks = false</text>
<text text-anchor="middle" x="12381.5" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;back_blanks = 0</text>
<text text-anchor="middle" x="12381.5" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest:addLine(l)</text>
<text text-anchor="middle" x="12381.5" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Collecting a code block</text>
<text text-anchor="middle" x="12381.5" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local isCodeFoot, level, l_trim = Codeblock.matchFoot(l)</text>
<text text-anchor="middle" x="12381.5" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if (isCodeFoot and level == latest[1].level) then</text>
<text text-anchor="middle" x="12381.5" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;code_block = false</text>
<text text-anchor="middle" x="12381.5" y="-348.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].footer = l_trim</text>
<text text-anchor="middle" x="12381.5" y="-332.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = inset</text>
<text text-anchor="middle" x="12381.5" y="-317.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="12381.5" y="-302.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].lines[#latest[1].lines + 1] = l</text>
<text text-anchor="middle" x="12381.5" y="-286.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Continue in normal parse mode</text>
<text text-anchor="middle" x="12381.5" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; This may add more lines to the code block</text>
<text text-anchor="middle" x="12381.5" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-209.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Auto&#45;close a code block with no footer.</text>
<text text-anchor="middle" x="12381.5" y="-194.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if latest[1] and latest[1].id == &quot;codeblock&quot; and not latest[1].line_last then</text>
<text text-anchor="middle" x="12381.5" y="-178.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;latest[1].line_last = #section.lines</text>
<text text-anchor="middle" x="12381.5" y="-163.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Close last block</text>
<text text-anchor="middle" x="12381.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;latest.line_last = section.line_last</text>
<text text-anchor="middle" x="12381.5" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Append sections, if any, which follow our blocks</text>
<text text-anchor="middle" x="12381.5" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(sub_sections) do</text>
<text text-anchor="middle" x="12381.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[#section + 1] = v</text>
<text text-anchor="middle" x="12381.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="12381.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="12381.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_142&#45;&gt;leaf_143 -->
<g id="edge143" class="edge">
<title>codeblock_142&#45;&gt;leaf_143</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12381.5,-1803.3331C12381.5,-1778.7735 12381.5,-1730.6954 12381.5,-1668.5073"/>
<polygon fill="#000000" stroke="#000000" points="12385.0001,-1668.4068 12381.5,-1658.4068 12378.0001,-1668.4068 12385.0001,-1668.4068"/>
</g>
<!-- leaf_153 -->
<g id="node154" class="node">
<title>leaf_153</title>
<polygon fill="none" stroke="#c0c0c0" points="12175,-4498.6101 12026,-4498.6101 12026,-4458.8059 12175,-4458.8059 12175,-4498.6101"/>
<text text-anchor="middle" x="12100.5" y="-4467.208" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Blocks a Section.</text>
</g>
<!-- block_149&#45;&gt;leaf_153 -->
<g id="edge153" class="edge">
<title>block_149&#45;&gt;leaf_153</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12371.5021,-5447.3194C12376.7503,-5389.9837 12384.8675,-5210.9499 12295.5,-5111.4088 12260.8525,-5072.817 12217.8522,-5115.1254 12184.5,-5075.4088 12041.0132,-4904.541 12078.3073,-4604.2126 12094.7497,-4508.7367"/>
<polygon fill="#000000" stroke="#000000" points="12098.2421,-4509.0881 12096.5463,-4498.6299 12091.3501,-4507.8629 12098.2421,-4509.0881"/>
</g>
<!-- leaf_154 -->
<g id="node155" class="node">
<title>leaf_154</title>
<polygon fill="none" stroke="#c0c0c0" points="12559.5,-4498.0085 12193.5,-4498.0085 12193.5,-4459.4074 12559.5,-4459.4074 12559.5,-4498.0085"/>
<text text-anchor="middle" x="12376.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000">This is a moderately complex state machine, which</text>
<text text-anchor="middle" x="12376.5" y="-4467.508" font-family="Inconsolata" font-size="14.00" fill="#000000">works on a line&#45;by&#45;line basis with some lookahead.</text>
</g>
<!-- block_150&#45;&gt;leaf_154 -->
<g id="edge154" class="edge">
<title>block_150&#45;&gt;leaf_154</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12515.8525,-5447.1108C12498.6103,-5327.29 12402.3212,-4658.1472 12380.7768,-4508.4286"/>
<polygon fill="#000000" stroke="#000000" points="12384.1909,-4507.5805 12379.3022,-4498.181 12377.2622,-4508.5776 12384.1909,-4507.5805"/>
</g>
<!-- leaf_155 -->
<g id="node156" class="node">
<title>leaf_155</title>
<polygon fill="none" stroke="#c0c0c0" points="13041.5,-4529.2081 12577.5,-4529.2081 12577.5,-4428.2078 13041.5,-4428.2078 13041.5,-4529.2081"/>
<text text-anchor="middle" x="12809.5" y="-4514.0081" font-family="Inconsolata" font-size="14.00" fill="#000000">First off, we have a Header at [1], and may have one or </text>
<text text-anchor="middle" x="12809.5" y="-4498.608" font-family="Inconsolata" font-size="14.00" fill="#000000">more Sections The blocks go between the Header and the remaining</text>
<text text-anchor="middle" x="12809.5" y="-4483.208" font-family="Inconsolata" font-size="14.00" fill="#000000">Sections, so we have to lift them and append after blocking.</text>
<text text-anchor="middle" x="12809.5" y="-4467.808" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="12809.5" y="-4452.4079" font-family="Inconsolata" font-size="14.00" fill="#000000">Next, we parse the lines, thus:</text>
</g>
<!-- block_151&#45;&gt;leaf_155 -->
<g id="edge155" class="edge">
<title>block_151&#45;&gt;leaf_155</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12739.8238,-5447.1108C12747.9457,-5334.2266 12791.1476,-4733.7814 12805.1299,-4539.4459"/>
<polygon fill="#000000" stroke="#000000" points="12808.6253,-4539.6349 12805.852,-4529.4095 12801.6433,-4539.1325 12808.6253,-4539.6349"/>
</g>
<!-- header_156 -->
<g id="node157" class="node">
<title>header_156</title>
<ellipse fill="none" stroke="#000000" cx="13121.5" cy="-4478.708" rx="61.9429" ry="18"/>
<text text-anchor="middle" x="13121.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : Prose line</text>
</g>
<!-- section_152&#45;&gt;header_156 -->
<g id="edge156" class="edge">
<title>section_152&#45;&gt;header_156</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13121.5,-5447.1108C13121.5,-5326.9039 13121.5,-4653.8291 13121.5,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="13125.0001,-4506.9796 13121.5,-4496.9796 13118.0001,-4506.9797 13125.0001,-4506.9796"/>
</g>
<!-- block_157 -->
<g id="node158" class="node">
<title>block_157</title>
<ellipse fill="none" stroke="#000000" cx="13266.5" cy="-4478.708" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="13266.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 224&#45;229</text>
</g>
<!-- section_152&#45;&gt;block_157 -->
<g id="edge157" class="edge">
<title>section_152&#45;&gt;block_157</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13125.1956,-5447.2914C13136.3887,-5391.7108 13170.4968,-5219.3297 13192.5,-5075.4088 13225.8591,-4857.2104 13254.5974,-4592.361 13263.5883,-4506.7997"/>
<polygon fill="#000000" stroke="#000000" points="13267.0725,-4507.1329 13264.6324,-4496.8229 13260.1105,-4506.4043 13267.0725,-4507.1329"/>
</g>
<!-- leaf_159 -->
<g id="node160" class="node">
<title>leaf_159</title>
<polygon fill="none" stroke="#c0c0c0" points="13737,-4537.3088 13350,-4537.3088 13350,-4420.1072 13737,-4420.1072 13737,-4537.3088"/>
<text text-anchor="middle" x="13543.5" y="-4522.308" font-family="Inconsolata" font-size="14.00" fill="#000000">**** Prose line</text>
<text text-anchor="middle" x="13543.5" y="-4490.908" font-family="Inconsolata" font-size="14.00" fill="#000000">If preceded by at least one blank line,</text>
<text text-anchor="middle" x="13543.5" y="-4475.508" font-family="Inconsolata" font-size="14.00" fill="#000000">make a new block, otherwise append to existing block.</text>
<text text-anchor="middle" x="13543.5" y="-4428.1079" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_152&#45;&gt;leaf_159 -->
<g id="edge159" class="edge">
<title>section_152&#45;&gt;leaf_159</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13119.8927,-5447.4594C13115.8171,-5389.7735 13111.3571,-5208.0178 13205.5,-5111.4088 13249.1375,-5066.6282 13295.8174,-5118.1011 13341.5,-5075.4088 13493.8344,-4933.046 13531.3067,-4671.8072 13540.5112,-4547.6931"/>
<polygon fill="#000000" stroke="#000000" points="13544.0139,-4547.7769 13541.2224,-4537.5565 13537.031,-4547.287 13544.0139,-4547.7769"/>
</g>
<!-- leaf_158 -->
<g id="node159" class="node">
<title>leaf_158</title>
<polygon fill="none" stroke="#c0c0c0" points="13460,-2950.6058 13073,-2950.6058 13073,-2880.0051 13460,-2880.0051 13460,-2950.6058"/>
<text text-anchor="middle" x="13266.5" y="-2919.5055" font-family="Inconsolata" font-size="14.00" fill="#000000">If preceded by at least one blank line,</text>
<text text-anchor="middle" x="13266.5" y="-2904.1054" font-family="Inconsolata" font-size="14.00" fill="#000000">make a new block, otherwise append to existing block.</text>
</g>
<!-- block_157&#45;&gt;leaf_158 -->
<g id="edge158" class="edge">
<title>block_157&#45;&gt;leaf_158</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13266.5,-4460.6096C13266.5,-4305.4946 13266.5,-3199.8839 13266.5,-2960.8133"/>
<polygon fill="#000000" stroke="#000000" points="13270.0001,-2960.7316 13266.5,-2950.7316 13263.0001,-2960.7316 13270.0001,-2960.7316"/>
</g>
<!-- leaf_164 -->
<g id="node165" class="node">
<title>leaf_164</title>
<polygon fill="none" stroke="#c0c0c0" points="14289.5,-4506.0084 13755.5,-4506.0084 13755.5,-4451.4075 14289.5,-4451.4075 14289.5,-4506.0084"/>
<text text-anchor="middle" x="14022.5" y="-4474.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is a kludgy thing we&#39;re going to do to remove &#39;blocks&#39; once they&#39;ve</text>
<text text-anchor="middle" x="14022.5" y="-4459.508" font-family="Inconsolata" font-size="14.00" fill="#000000">become either codeblocks or prose.</text>
</g>
<!-- block_162&#45;&gt;leaf_164 -->
<g id="edge164" class="edge">
<title>block_162&#45;&gt;leaf_164</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14025.4441,-5447.1108C14025.0858,-5329.2537 14023.1117,-4679.933 14022.614,-4516.2037"/>
<polygon fill="#000000" stroke="#000000" points="14026.1139,-4516.1214 14022.5834,-4506.1321 14019.1139,-4516.1428 14026.1139,-4516.1214"/>
</g>
<!-- codeblock_165 -->
<g id="node166" class="node">
<title>codeblock_165</title>
<ellipse fill="none" stroke="#000000" cx="14394.5" cy="-4478.708" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="14394.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 372&#45;383</text>
</g>
<!-- block_163&#45;&gt;codeblock_165 -->
<g id="edge165" class="edge">
<title>block_163&#45;&gt;codeblock_165</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14178.1891,-5447.3862C14178.063,-5392.4372 14183.7616,-5224.548 14253.5,-5111.4088 14266.9394,-5089.6055 14285.601,-5097.536 14298.5,-5075.4088 14411.1146,-4882.2274 14402.7615,-4597.1664 14396.8018,-4507.0737"/>
<polygon fill="#000000" stroke="#000000" points="14400.2748,-4506.567 14396.0776,-4496.839 14393.2923,-4507.0612 14400.2748,-4506.567"/>
</g>
<!-- leaf_167 -->
<g id="node168" class="node">
<title>leaf_167</title>
<polygon fill="none" stroke="#c0c0c0" points="14553.5,-4496.708 14499.5,-4496.708 14499.5,-4460.708 14553.5,-4460.708 14553.5,-4496.708"/>
</g>
<!-- block_163&#45;&gt;leaf_167 -->
<g id="edge167" class="edge">
<title>block_163&#45;&gt;leaf_167</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14175.9961,-5447.4959C14168.9982,-5389.135 14155.6946,-5203.7023 14253.5,-5111.4088 14330.9881,-5038.2876 14418.6482,-5154.0753 14490.5,-5075.4088 14567.2175,-4991.4151 14538.9426,-4613.7103 14529.2348,-4506.9164"/>
<polygon fill="#000000" stroke="#000000" points="14532.7139,-4506.5288 14528.3053,-4496.8948 14525.7438,-4507.1754 14532.7139,-4506.5288"/>
</g>
<!-- leaf_166 -->
<g id="node167" class="node">
<title>leaf_166</title>
<polygon fill="none" stroke="#c0c0c0" points="14567,-2996.3058 14222,-2996.3058 14222,-2834.3051 14567,-2834.3051 14567,-2996.3058"/>
<text text-anchor="middle" x="14394.5" y="-2981.1056" font-family="Inconsolata" font-size="14.00" fill="#000000">function Sec.weed(section)</text>
<text text-anchor="middle" x="14394.5" y="-2965.7056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i, v in ipairs(section) do</text>
<text text-anchor="middle" x="14394.5" y="-2950.3055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.id == &quot;block&quot; then</text>
<text text-anchor="middle" x="14394.5" y="-2934.9055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v[1] and v[1].id == &quot;codeblock&quot; </text>
<text text-anchor="middle" x="14394.5" y="-2919.5055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or v[1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="14394.5" y="-2904.1054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;section[i] = v[1] &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="14394.5" y="-2888.7054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14394.5" y="-2873.3054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14394.5" y="-2857.9054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="14394.5" y="-2842.5053" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_165&#45;&gt;leaf_166 -->
<g id="edge166" class="edge">
<title>codeblock_165&#45;&gt;leaf_166</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14394.5,-4460.6096C14394.5,-4313.8654 14394.5,-3316.4448 14394.5,-3006.8029"/>
<polygon fill="#000000" stroke="#000000" points="14398.0001,-3006.5206 14394.5,-2996.5206 14391.0001,-3006.5206 14398.0001,-3006.5206"/>
</g>
<!-- leaf_174 -->
<g id="node175" class="node">
<title>leaf_174</title>
<polygon fill="none" stroke="#c0c0c0" points="15007.5,-4498.6101 14571.5,-4498.6101 14571.5,-4458.8059 15007.5,-4458.8059 15007.5,-4498.6101"/>
<text text-anchor="middle" x="14789.5" y="-4467.208" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Creates a new section, given a header and the line number.</text>
</g>
<!-- block_170&#45;&gt;leaf_174 -->
<g id="edge174" class="edge">
<title>block_170&#45;&gt;leaf_174</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15121.7977,-5447.1616C15119.0759,-5392.9602 15106.2023,-5229.9471 15047.5,-5111.4088 15038.1297,-5092.4872 15027.3053,-5093.5491 15016.5,-5075.4088 14896.6046,-4874.1233 14819.9395,-4598.4185 14796.8572,-4508.4256"/>
<polygon fill="#000000" stroke="#000000" points="14800.2222,-4507.4562 14794.3681,-4498.6256 14793.4376,-4509.1795 14800.2222,-4507.4562"/>
</g>
<!-- leaf_175 -->
<g id="node176" class="node">
<title>leaf_175</title>
<polygon fill="none" stroke="#c0c0c0" points="15517.5,-4513.3092 15025.5,-4513.3092 15025.5,-4444.1067 15517.5,-4444.1067 15517.5,-4513.3092"/>
<text text-anchor="middle" x="15271.5" y="-4498.308" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; header : &#160;Header for the section, which may be of type Header or </text>
<text text-anchor="middle" x="15271.5" y="-4482.908" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;a number. &#160;A number means the header is virtual.</text>
<text text-anchor="middle" x="15271.5" y="-4467.508" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; linum &#160;: &#160;The line number of the header, which is the first of the</text>
<text text-anchor="middle" x="15271.5" y="-4452.1079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Section.</text>
</g>
<!-- block_171&#45;&gt;leaf_175 -->
<g id="edge175" class="edge">
<title>block_171&#45;&gt;leaf_175</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15271.5,-5447.1108C15271.5,-5330.9519 15271.5,-4698.5341 15271.5,-4523.5803"/>
<polygon fill="#000000" stroke="#000000" points="15275.0001,-4523.4392 15271.5,-4513.4392 15268.0001,-4523.4393 15275.0001,-4523.4392"/>
</g>
<!-- leaf_176 -->
<g id="node177" class="node">
<title>leaf_176</title>
<polygon fill="none" stroke="#c0c0c0" points="15747.5,-4496.708 15535.5,-4496.708 15535.5,-4460.708 15747.5,-4460.708 15747.5,-4496.708"/>
<text text-anchor="middle" x="15641.5" y="-4475.208" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; return : &#160;The new Section.</text>
</g>
<!-- block_172&#45;&gt;leaf_176 -->
<g id="edge176" class="edge">
<title>block_172&#45;&gt;leaf_176</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15532.5695,-5447.1108C15546.091,-5326.9039 15621.8016,-4653.8291 15638.3179,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="15641.8049,-4507.3082 15639.4447,-4496.9796 15634.8488,-4506.5257 15641.8049,-4507.3082"/>
</g>
<!-- codeblock_177 -->
<g id="node178" class="node">
<title>codeblock_177</title>
<ellipse fill="none" stroke="#000000" cx="15852.5" cy="-4478.708" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15852.5" y="-4474.508" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 397&#45;423</text>
</g>
<!-- block_173&#45;&gt;codeblock_177 -->
<g id="edge177" class="edge">
<title>block_173&#45;&gt;codeblock_177</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15767.1221,-5447.1108C15777.72,-5326.9039 15837.0607,-4653.8291 15850.0059,-4506.9974"/>
<polygon fill="#000000" stroke="#000000" points="15853.4973,-4507.2484 15850.8891,-4496.9796 15846.5243,-4506.6336 15853.4973,-4507.2484"/>
</g>
<!-- leaf_179 -->
<g id="node180" class="node">
<title>leaf_179</title>
<polygon fill="none" stroke="#c0c0c0" points="16011.5,-4496.708 15957.5,-4496.708 15957.5,-4460.708 16011.5,-4460.708 16011.5,-4496.708"/>
</g>
<!-- block_173&#45;&gt;leaf_179 -->
<g id="edge179" class="edge">
<title>block_173&#45;&gt;leaf_179</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15763.5917,-5447.3447C15758.6312,-5390.0841 15751.3521,-5211.2488 15840.5,-5111.4088 15874.1991,-5073.6679 15917.6927,-5115.5449 15948.5,-5075.4088 16084.1873,-4898.634 16017.5814,-4598.6073 15992.5761,-4506.4549"/>
<polygon fill="#000000" stroke="#000000" points="15995.9288,-4505.447 15989.8844,-4496.7456 15989.1832,-4507.3172 15995.9288,-4505.447"/>
</g>
<!-- leaf_178 -->
<g id="node179" class="node">
<title>leaf_178</title>
<polygon fill="none" stroke="#c0c0c0" points="16098.5,-3111.9064 15606.5,-3111.9064 15606.5,-2718.7045 16098.5,-2718.7045 16098.5,-3111.9064"/>
<text text-anchor="middle" x="15852.5" y="-3096.9058" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Section, header, linum, first, last, str)</text>
<text text-anchor="middle" x="15852.5" y="-3081.5058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(first) == &quot;number&quot;)</text>
<text text-anchor="middle" x="15852.5" y="-3066.1058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(type(last) == &quot;number&quot;, &quot;type of last is &quot; .. type(last))</text>
<text text-anchor="middle" x="15852.5" y="-3050.7057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local section = setmetatable({}, Sec)</text>
<text text-anchor="middle" x="15852.5" y="-3035.3057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if type(header) == &quot;number&quot; then</text>
<text text-anchor="middle" x="15852.5" y="-3019.9057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; We have a virtual header</text>
<text text-anchor="middle" x="15852.5" y="-3004.5056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[1] = Header(&quot;&quot;, header)</text>
<text text-anchor="middle" x="15852.5" y="-2989.1056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.header = nil</text>
<text text-anchor="middle" x="15852.5" y="-2973.7056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.level = header</text>
<text text-anchor="middle" x="15852.5" y="-2958.3055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="15852.5" y="-2942.9055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section[1] = header</text>
<text text-anchor="middle" x="15852.5" y="-2927.5055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.header = header</text>
<text text-anchor="middle" x="15852.5" y="-2912.1054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;section.level = header.level</text>
<text text-anchor="middle" x="15852.5" y="-2896.7054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="15852.5" y="-2881.3054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.str = str</text>
<text text-anchor="middle" x="15852.5" y="-2865.9054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.first = first</text>
<text text-anchor="middle" x="15852.5" y="-2850.5053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.last = last</text>
<text text-anchor="middle" x="15852.5" y="-2835.1053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.line_first = linum</text>
<text text-anchor="middle" x="15852.5" y="-2819.7053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.line_last = &#45;1 &#160;</text>
<text text-anchor="middle" x="15852.5" y="-2804.3052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;section.lines = {}</text>
<text text-anchor="middle" x="15852.5" y="-2788.9052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;Sec.check(section)</text>
<text text-anchor="middle" x="15852.5" y="-2773.5052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return section</text>
<text text-anchor="middle" x="15852.5" y="-2758.1051" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="15852.5" y="-2726.7051" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(sec, new)</text>
</g>
<!-- codeblock_177&#45;&gt;leaf_178 -->
<g id="edge178" class="edge">
<title>codeblock_177&#45;&gt;leaf_178</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15852.5,-4460.6096C15852.5,-4328.9636 15852.5,-3512.6843 15852.5,-3122.5446"/>
<polygon fill="#000000" stroke="#000000" points="15856.0001,-3122.2677 15852.5,-3112.2678 15849.0001,-3122.2678 15856.0001,-3122.2677"/>
</g>
</g>
</svg>