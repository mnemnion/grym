<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="7058pt" height="4417pt"
 viewBox="0.00 0.00 7057.50 4416.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 4412.8066)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-4412.8066 7053.5,-4412.8066 7053.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="2554.5" cy="-4390.8066" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="2554.5" y="-4386.6066" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 180</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="2554.5" cy="-4318.8066" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2554.5" y="-4314.6066" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;126</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2554.5,-4372.638C2554.5,-4364.9376 2554.5,-4355.781 2554.5,-4347.2232"/>
<polygon fill="#000000" stroke="#000000" points="2558.0001,-4347.2198 2554.5,-4337.2199 2551.0001,-4347.2199 2558.0001,-4347.2198"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1912.5" cy="-3274.2051" rx="75.4657" ry="18"/>
<text text-anchor="middle" x="1912.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Block module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2488.8908,-4317.0898C2348.8349,-4312.7739 2030.5345,-4299.2478 1996.5,-4264.8066 1723.3512,-3988.3936 1865.6963,-3431.938 1903.9669,-3301.8482"/>
<polygon fill="#000000" stroke="#000000" points="1907.331,-3302.8146 1906.8369,-3292.2313 1900.6233,-3300.8128 1907.331,-3302.8146"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="2051.5" cy="-3274.2051" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="2051.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2489.7824,-4315.5386C2371.9824,-4308.9416 2132.2521,-4292.2755 2106.5,-4264.8066 1972.3204,-4121.682 2033.3879,-3448.8984 2048.4704,-3302.409"/>
<polygon fill="#000000" stroke="#000000" points="2051.9563,-3302.7258 2049.5126,-3292.4166 2044.994,-3301.9996 2051.9563,-3302.7258"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="2166.5" cy="-3274.2051" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="2166.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2492.5337,-4312.766C2402.4511,-4303.371 2244.0903,-4284.3025 2226.5,-4264.8066 2095.0388,-4119.104 2150.0277,-3448.3305 2163.738,-3302.3152"/>
<polygon fill="#000000" stroke="#000000" points="2167.2227,-3302.6421 2164.6862,-3292.3554 2160.2542,-3301.9787 2167.2227,-3302.6421"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="2290.5" cy="-3274.2051" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="2290.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;14</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2495.9247,-4310.6284C2443.5517,-4302.0163 2372.3798,-4286.6565 2354.5,-4264.8066 2230.3138,-4113.0457 2276.3434,-3448.2949 2288.0981,-3302.5257"/>
<polygon fill="#000000" stroke="#000000" points="2291.6151,-3302.4603 2288.9433,-3292.2079 2284.6384,-3301.8887 2291.6151,-3302.4603"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="2419.5" cy="-3274.2051" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2419.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 15&#45;27</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2523.1949,-4302.8127C2508.8194,-4293.7272 2493.0898,-4280.9256 2484.5,-4264.8066 2303.7329,-3925.5945 2388.5922,-3425.6029 2413.4576,-3302.4033"/>
<polygon fill="#000000" stroke="#000000" points="2416.9507,-3302.7928 2415.5361,-3292.2928 2410.0941,-3301.3832 2416.9507,-3302.7928"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="2554.5" cy="-3274.2051" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2554.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 28&#45;126</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2554.5,-4300.6756C2554.5,-4176.8473 2554.5,-3456.0953 2554.5,-3302.8465"/>
<polygon fill="#000000" stroke="#000000" points="2558.0001,-3302.4257 2554.5,-3292.4257 2551.0001,-3302.4258 2558.0001,-3302.4257"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2852.5" cy="-3274.2051" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2852.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;50</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2584.0075,-4302.6386C2598.2921,-4293.3615 2614.4785,-4280.4426 2624.5,-4264.8066 2837.1076,-3933.089 2852.2919,-3426.5258 2852.6985,-3302.3882"/>
<polygon fill="#000000" stroke="#000000" points="2856.1984,-3302.2093 2852.7,-3292.2088 2849.1984,-3302.2083 2856.1984,-3302.2093"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="3663.5" cy="-3274.2051" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3663.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 51&#45;75</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2619.0744,-4315.4039C2711.6973,-4309.534 2876.7129,-4295.0973 2927.5,-4264.8066 3343.1142,-4016.9236 3598.2716,-3435.333 3652.583,-3301.8473"/>
<polygon fill="#000000" stroke="#000000" points="3655.9226,-3302.924 3656.4181,-3292.3407 3649.431,-3300.3051 3655.9226,-3302.924"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4719.5" cy="-3274.2051" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4719.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 76&#45;91</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2620.2465,-4318.5892C2853.9889,-4317.4361 3636.3014,-4310.1913 3738.5,-4264.8066 4240.2155,-4042.0034 4622.9453,-3436.4371 4703.7113,-3301.2211"/>
<polygon fill="#000000" stroke="#000000" points="4706.9062,-3302.6956 4709.0021,-3292.3102 4700.8872,-3299.1219 4706.9062,-3302.6956"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="5782.5" cy="-3274.2051" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5782.5" y="-3270.0051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 127&#45;180</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2620.2859,-4318.5979C2979.5642,-4317.285 4692.1463,-4308.735 4794.5,-4264.8066 5301.2948,-4047.2993 5686.3021,-3436.385 5766.8969,-3300.9985"/>
<polygon fill="#000000" stroke="#000000" points="5770.0911,-3302.4731 5772.1711,-3292.0844 5764.0667,-3298.9085 5770.0911,-3302.4731"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="6417,-4264.9082 5876,-4264.9082 5876,-2283.502 6417,-2283.502 6417,-4264.9082"/>
<text text-anchor="middle" x="6146.5" y="-4249.6066" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Block module</text>
<text text-anchor="middle" x="6146.5" y="-4218.2066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A Block is the container for the next level of granularity below</text>
<text text-anchor="middle" x="6146.5" y="-4202.8066" font-family="Inconsolata" font-size="14.00" fill="#000000"> a Section. Any Section has a Header and one or more Blocks. Both the</text>
<text text-anchor="middle" x="6146.5" y="-4187.4065" font-family="Inconsolata" font-size="14.00" fill="#000000"> Header and the Block may be virtual, that is, without contents.</text>
<text text-anchor="middle" x="6146.5" y="-4156.0065" font-family="Inconsolata" font-size="14.00" fill="#000000"> The most general premise is that Blocks are delineated by blank line</text>
<text text-anchor="middle" x="6146.5" y="-4140.6065" font-family="Inconsolata" font-size="14.00" fill="#000000"> whitespace. </text>
<text text-anchor="middle" x="6146.5" y="-4093.2064" font-family="Inconsolata" font-size="14.00" fill="#000000"> A paragraph of prose is the simplest block, and the default. &#160;A list with</text>
<text text-anchor="middle" x="6146.5" y="-4077.8064" font-family="Inconsolata" font-size="14.00" fill="#000000"> a tag line is a block also, as is a table. &#160;Most importantly for our short</text>
<text text-anchor="middle" x="6146.5" y="-4062.4064" font-family="Inconsolata" font-size="14.00" fill="#000000"> path, code blocks are enclosed in blocks as well.</text>
<text text-anchor="middle" x="6146.5" y="-4031.0063" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking needs to identify when it has structure, and when prose, on a </text>
<text text-anchor="middle" x="6146.5" y="-4015.6063" font-family="Inconsolata" font-size="14.00" fill="#000000"> line&#45;by&#45;line basis. &#160;It must also apply the cling rule to make sure that</text>
<text text-anchor="middle" x="6146.5" y="-4000.2063" font-family="Inconsolata" font-size="14.00" fill="#000000"> e.g. tags are part of the block indicated by whitespacing. </text>
<text text-anchor="middle" x="6146.5" y="-3984.8062" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6146.5" y="-3969.4062" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking need not, and mostly should not, parse within structure or prose.</text>
<text text-anchor="middle" x="6146.5" y="-3954.0062" font-family="Inconsolata" font-size="14.00" fill="#000000"> These categories are determined by the beginning of a line, making this</text>
<text text-anchor="middle" x="6146.5" y="-3938.6061" font-family="Inconsolata" font-size="14.00" fill="#000000"> tractable. </text>
<text text-anchor="middle" x="6146.5" y="-3923.2061" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6146.5" y="-3907.8061" font-family="Inconsolata" font-size="14.00" fill="#000000"> The cling rule requires lookahead. LPEG is quite capable of this, as is </text>
<text text-anchor="middle" x="6146.5" y="-3892.4061" font-family="Inconsolata" font-size="14.00" fill="#000000"> packrat PEG parsing generally. &#160;In the bootstrap implementation, we will</text>
<text text-anchor="middle" x="6146.5" y="-3877.006" font-family="Inconsolata" font-size="14.00" fill="#000000"> parse once for ownership, again (in the `lines` array of each Section) for</text>
<text text-anchor="middle" x="6146.5" y="-3861.606" font-family="Inconsolata" font-size="14.00" fill="#000000"> blocking, and a final time to parse within blocks. </text>
<text text-anchor="middle" x="6146.5" y="-3830.206" font-family="Inconsolata" font-size="14.00" fill="#000000"> Grimoire is intended to work, in linear time, as a single&#45;pass PEG</text>
<text text-anchor="middle" x="6146.5" y="-3814.8059" font-family="Inconsolata" font-size="14.00" fill="#000000"> grammar. &#160;Presently (Feb 2018) I&#39;m intending to prototype that with </text>
<text text-anchor="middle" x="6146.5" y="-3799.4059" font-family="Inconsolata" font-size="14.00" fill="#000000"> PEGylator and port it to `hammer` with a `quipu` back&#45;end. </text>
<text text-anchor="middle" x="6146.5" y="-3752.0059" font-family="Inconsolata" font-size="14.00" fill="#000000">*** includes</text>
<text text-anchor="middle" x="6146.5" y="-3720.6058" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6146.5" y="-3705.2058" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3673.8058" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3658.4057" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3643.0057" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3627.6057" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3596.2056" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3564.8056" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3549.4056" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3534.0056" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="6146.5" y="-3518.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="6146.5" y="-3471.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">** Metatable for Blocks</text>
<text text-anchor="middle" x="6146.5" y="-3439.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6146.5" y="-3424.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="6146.5" y="-3409.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="6146.5" y="-3377.6054" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="6146.5" y="-3362.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="6146.5" y="-3346.8053" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-3315.4053" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="6146.5" y="-3300.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="6146.5" y="-3284.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="6146.5" y="-3269.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="6146.5" y="-3253.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="6146.5" y="-3238.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="6146.5" y="-3223.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6146.5" y="-3207.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="6146.5" y="-3192.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6146.5" y="-3160.805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="6146.5" y="-3145.405" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-3130.0049" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="6146.5" y="-3082.6049" font-family="Inconsolata" font-size="14.00" fill="#000000">** Parse the prose within a block</text>
<text text-anchor="middle" x="6146.5" y="-3051.2049" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6146.5" y="-3035.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="6146.5" y="-3020.4048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="6146.5" y="-3005.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="6146.5" y="-2989.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="6146.5" y="-2974.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6146.5" y="-2958.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6146.5" y="-2943.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="6146.5" y="-2928.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="6146.5" y="-2912.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="6146.5" y="-2897.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6146.5" y="-2881.8045" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-2866.4045" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="6146.5" y="-2835.0045" font-family="Inconsolata" font-size="14.00" fill="#000000">*** toValue</text>
<text text-anchor="middle" x="6146.5" y="-2803.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="6146.5" y="-2788.2044" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
<text text-anchor="middle" x="6146.5" y="-2756.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6146.5" y="-2741.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="6146.5" y="-2726.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="6146.5" y="-2710.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="6146.5" y="-2695.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="6146.5" y="-2679.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6146.5" y="-2664.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="6146.5" y="-2649.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-2617.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="6146.5" y="-2602.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="6146.5" y="-2586.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="6146.5" y="-2571.404" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-2540.004" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="6146.5" y="-2524.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="6146.5" y="-2509.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="6146.5" y="-2493.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="6146.5" y="-2478.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6146.5" y="-2463.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="6146.5" y="-2447.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6146.5" y="-2432.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-2400.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="6146.5" y="-2385.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="6146.5" y="-2370.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="6146.5" y="-2354.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6146.5" y="-2339.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="6146.5" y="-2291.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_1&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>section_1&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2620.3215,-4318.2687C3083.3079,-4314.421 5833.1089,-4290.4984 5866.5,-4264.8066 5866.998,-4264.4235 5867.4951,-4264.0395 5867.9914,-4263.6547"/>
<polygon fill="#000000" stroke="#000000" points="5870.288,-4266.3007 5875.9581,-4257.3508 5865.9443,-4260.8114 5870.288,-4266.3007"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="499,-1867.7033 0,-1867.7033 0,-1797.3025 499,-1797.3025 499,-1867.7033"/>
<text text-anchor="middle" x="249.5" y="-1836.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A Block is the container for the next level of granularity below</text>
<text text-anchor="middle" x="249.5" y="-1821.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> a Section. Any Section has a Header and one or more Blocks. Both the</text>
<text text-anchor="middle" x="249.5" y="-1805.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> Header and the Block may be virtual, that is, without contents.</text>
</g>
<!-- block_3&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_3&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2053.6465,-3255.837C2067.6403,-3132.3293 2140.9031,-2423.5572 1996.5,-2283.6036 1937.0812,-2226.0156 579.3322,-2288.6778 507.5,-2247.6036 363.6967,-2165.3757 289.1798,-1967.1555 261.904,-1877.6754"/>
<polygon fill="#000000" stroke="#000000" points="265.1775,-1876.4056 258.9596,-1867.8273 258.4708,-1878.4108 265.1775,-1876.4056"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1016,-1859.8033 517,-1859.8033 517,-1805.2025 1016,-1805.2025 1016,-1859.8033"/>
<text text-anchor="middle" x="766.5" y="-1844.7029" font-family="Inconsolata" font-size="14.00" fill="#000000"> The most general premise is that Blocks are delineated by blank line</text>
<text text-anchor="middle" x="766.5" y="-1829.3029" font-family="Inconsolata" font-size="14.00" fill="#000000"> whitespace. </text>
</g>
<!-- block_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2168.5318,-3255.8448C2181.7574,-3132.3879 2250.6611,-2423.8908 2106.5,-2283.6036 2020.2926,-2199.7127 1128.6504,-2307.7872 1024.5,-2247.6036 876.5974,-2162.1376 801.7632,-1954.3876 776.5414,-1869.5333"/>
<polygon fill="#000000" stroke="#000000" points="779.8666,-1868.4334 773.71,-1859.8109 773.1458,-1870.3907 779.8666,-1868.4334"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1575,-1859.7034 1034,-1859.7034 1034,-1805.3024 1575,-1805.3024 1575,-1859.7034"/>
<text text-anchor="middle" x="1304.5" y="-1844.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> A paragraph of prose is the simplest block, and the default. &#160;A list with</text>
<text text-anchor="middle" x="1304.5" y="-1829.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> a tag line is a block also, as is a table. &#160;Most importantly for our short</text>
<text text-anchor="middle" x="1304.5" y="-1813.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> path, code blocks are enclosed in blocks as well.</text>
</g>
<!-- block_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2292.415,-3255.8766C2304.8605,-3132.6294 2369.3828,-2425.2644 2226.5,-2283.6036 2175.6852,-2233.2233 1645.6875,-2283.0017 1583.5,-2247.6036 1431.5812,-2161.129 1346.0608,-1953.9567 1316.4569,-1869.3952"/>
<polygon fill="#000000" stroke="#000000" points="1319.6866,-1868.024 1313.1232,-1859.707 1313.0675,-1870.3017 1319.6866,-1868.024"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2134,-1928.8034 1593,-1928.8034 1593,-1736.2024 2134,-1736.2024 2134,-1928.8034"/>
<text text-anchor="middle" x="1863.5" y="-1913.7031" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking needs to identify when it has structure, and when prose, on a </text>
<text text-anchor="middle" x="1863.5" y="-1898.303" font-family="Inconsolata" font-size="14.00" fill="#000000"> line&#45;by&#45;line basis. &#160;It must also apply the cling rule to make sure that</text>
<text text-anchor="middle" x="1863.5" y="-1882.903" font-family="Inconsolata" font-size="14.00" fill="#000000"> e.g. tags are part of the block indicated by whitespacing. </text>
<text text-anchor="middle" x="1863.5" y="-1867.503" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-1852.1029" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking need not, and mostly should not, parse within structure or prose.</text>
<text text-anchor="middle" x="1863.5" y="-1836.7029" font-family="Inconsolata" font-size="14.00" fill="#000000"> These categories are determined by the beginning of a line, making this</text>
<text text-anchor="middle" x="1863.5" y="-1821.3029" font-family="Inconsolata" font-size="14.00" fill="#000000"> tractable. </text>
<text text-anchor="middle" x="1863.5" y="-1805.9029" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-1790.5028" font-family="Inconsolata" font-size="14.00" fill="#000000"> The cling rule requires lookahead. LPEG is quite capable of this, as is </text>
<text text-anchor="middle" x="1863.5" y="-1775.1028" font-family="Inconsolata" font-size="14.00" fill="#000000"> packrat PEG parsing generally. &#160;In the bootstrap implementation, we will</text>
<text text-anchor="middle" x="1863.5" y="-1759.7028" font-family="Inconsolata" font-size="14.00" fill="#000000"> parse once for ownership, again (in the `lines` array of each Section) for</text>
<text text-anchor="middle" x="1863.5" y="-1744.3027" font-family="Inconsolata" font-size="14.00" fill="#000000"> blocking, and a final time to parse within blocks. </text>
</g>
<!-- block_6&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_6&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2421.2057,-3256.0559C2432.2704,-3133.9892 2489.2931,-2433.0004 2354.5,-2283.6036 2290.4782,-2212.6455 2222.7744,-2299.4673 2142.5,-2247.6036 2028.2164,-2173.7671 1949.3078,-2034.8002 1905.2858,-1938.0976"/>
<polygon fill="#000000" stroke="#000000" points="1908.4307,-1936.557 1901.1345,-1928.8748 1902.0475,-1939.4302 1908.4307,-1936.557"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2651,-1867.7033 2152,-1867.7033 2152,-1797.3025 2651,-1797.3025 2651,-1867.7033"/>
<text text-anchor="middle" x="2401.5" y="-1852.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> Grimoire is intended to work, in linear time, as a single&#45;pass PEG</text>
<text text-anchor="middle" x="2401.5" y="-1837.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> grammar. &#160;Presently (Feb 2018) I&#39;m intending to prototype that with </text>
<text text-anchor="middle" x="2401.5" y="-1821.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> PEGylator and port it to `hammer` with a `quipu` back&#45;end. </text>
</g>
<!-- block_7&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_7&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2553.9675,-3255.8974C2550.9262,-3156.7762 2534.1057,-2674.4209 2484.5,-2283.6036 2465.485,-2133.7945 2429.0954,-1958.3935 2411.5071,-1877.5245"/>
<polygon fill="#000000" stroke="#000000" points="2414.9095,-1876.6994 2409.3564,-1867.6764 2408.0707,-1878.193 2414.9095,-1876.6994"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="2723.5" cy="-1832.5029" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="2723.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_8&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_8&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2850.869,-3255.9766C2837.2715,-3104.0113 2742.8301,-2048.5356 2726.0474,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="2729.5156,-1860.4594 2725.1382,-1850.8112 2722.5434,-1861.0834 2729.5156,-1860.4594"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2852.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2852.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 33&#45;34</text>
</g>
<!-- section_8&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2852.5,-3255.9766C2852.5,-3104.0113 2852.5,-2048.5356 2852.5,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="2856.0001,-1860.8112 2852.5,-1850.8112 2849.0001,-1860.8112 2856.0001,-1860.8112"/>
</g>
<!-- block_19 -->
<g id="node20" class="node">
<title>block_19</title>
<ellipse fill="none" stroke="#000000" cx="2982.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2982.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 35&#45;50</text>
</g>
<!-- section_8&#45;&gt;block_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;block_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2854.1437,-3255.9766C2867.8466,-3104.0113 2963.0201,-2048.5356 2979.9328,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="2983.4368,-1861.0851 2980.8491,-1850.8112 2976.4651,-1860.4564 2983.4368,-1861.0851"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3366.5,-1984.7034 3056.5,-1984.7034 3056.5,-1680.3024 3366.5,-1680.3024 3366.5,-1984.7034"/>
<text text-anchor="middle" x="3211.5" y="-1969.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">*** includes</text>
<text text-anchor="middle" x="3211.5" y="-1938.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3211.5" y="-1922.603" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1891.203" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1875.803" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1860.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1845.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1813.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1782.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1766.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="3211.5" y="-1751.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
<text text-anchor="middle" x="3211.5" y="-1736.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3211.5" y="-1688.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_8&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>section_8&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2856.9741,-3256.2376C2889.0485,-3127.4304 3085.1773,-2339.8003 3171.164,-1994.4874"/>
<polygon fill="#000000" stroke="#000000" points="3174.5929,-1995.2019 3173.613,-1984.6525 3167.8004,-1993.5104 3174.5929,-1995.2019"/>
</g>
<!-- header_25 -->
<g id="node26" class="node">
<title>header_25</title>
<ellipse fill="none" stroke="#000000" cx="3487.5" cy="-1832.5029" rx="102.5283" ry="18"/>
<text text-anchor="middle" x="3487.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Metatable for Blocks</text>
</g>
<!-- section_9&#45;&gt;header_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;header_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3661.2747,-3255.9766C3642.7231,-3104.0113 3513.8728,-2048.5356 3490.9756,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="3494.4211,-1860.3134 3489.735,-1850.8112 3487.4727,-1861.1617 3494.4211,-1860.3134"/>
</g>
<!-- block_26 -->
<g id="node27" class="node">
<title>block_26</title>
<ellipse fill="none" stroke="#000000" cx="3663.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3663.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 51&#45;52</text>
</g>
<!-- section_9&#45;&gt;block_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;block_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3663.5,-3255.9766C3663.5,-3104.0113 3663.5,-2048.5356 3663.5,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="3667.0001,-1860.8112 3663.5,-1850.8112 3660.0001,-1860.8112 3667.0001,-1860.8112"/>
</g>
<!-- block_27 -->
<g id="node28" class="node">
<title>block_27</title>
<ellipse fill="none" stroke="#000000" cx="3793.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3793.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 53&#45;75</text>
</g>
<!-- section_9&#45;&gt;block_27 -->
<g id="edge27" class="edge">
<title>section_9&#45;&gt;block_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3665.1437,-3255.9766C3678.8466,-3104.0113 3774.0201,-2048.5356 3790.9328,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="3794.4368,-1861.0851 3791.8491,-1850.8112 3787.4651,-1860.4564 3794.4368,-1861.0851"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="4282,-2038.5035 3867,-2038.5035 3867,-1626.5023 4282,-1626.5023 4282,-2038.5035"/>
<text text-anchor="middle" x="4074.5" y="-2023.3032" font-family="Inconsolata" font-size="14.00" fill="#000000">** Metatable for Blocks</text>
<text text-anchor="middle" x="4074.5" y="-1991.9032" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4074.5" y="-1976.5031" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="4074.5" y="-1961.1031" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="4074.5" y="-1929.7031" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="4074.5" y="-1914.303" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="4074.5" y="-1898.903" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4074.5" y="-1867.503" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="4074.5" y="-1852.1029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="4074.5" y="-1836.7029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="4074.5" y="-1821.3029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="4074.5" y="-1805.9029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="4074.5" y="-1790.5028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="4074.5" y="-1775.1028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4074.5" y="-1759.7028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="4074.5" y="-1744.3027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4074.5" y="-1712.9027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="4074.5" y="-1697.5027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4074.5" y="-1682.1026" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4074.5" y="-1634.7026" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_9&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>section_9&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3668.6222,-3256.2376C3703.5391,-3133.7562 3908.2785,-2415.5733 4012.9427,-2048.4329"/>
<polygon fill="#000000" stroke="#000000" points="4016.3274,-2049.3265 4015.7031,-2038.7501 4009.5956,-2047.4073 4016.3274,-2049.3265"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="4440.5" cy="-1832.5029" rx="140.2419" ry="18"/>
<text text-anchor="middle" x="4440.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parse the prose within a block</text>
</g>
<!-- section_10&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_10&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4715.9724,-3255.9766C4686.5492,-3103.9356 4482.1034,-2047.4841 4445.9554,-1860.6933"/>
<polygon fill="#000000" stroke="#000000" points="4449.3793,-1859.964 4444.043,-1850.8112 4442.5068,-1861.2941 4449.3793,-1859.964"/>
</g>
<!-- block_34 -->
<g id="node35" class="node">
<title>block_34</title>
<ellipse fill="none" stroke="#000000" cx="4654.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4654.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 76&#45;77</text>
</g>
<!-- section_10&#45;&gt;block_34 -->
<g id="edge34" class="edge">
<title>section_10&#45;&gt;block_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4718.6782,-3255.9766C4711.8267,-3104.0113 4664.24,-2048.5356 4655.7836,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="4659.2724,-1860.6434 4655.3254,-1850.8112 4652.2795,-1860.9587 4659.2724,-1860.6434"/>
</g>
<!-- block_35 -->
<g id="node36" class="node">
<title>block_35</title>
<ellipse fill="none" stroke="#000000" cx="4784.5" cy="-1832.5029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4784.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 78&#45;91</text>
</g>
<!-- section_10&#45;&gt;block_35 -->
<g id="edge35" class="edge">
<title>section_10&#45;&gt;block_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4720.3218,-3255.9766C4727.1733,-3104.0113 4774.76,-2048.5356 4783.2164,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="4786.7205,-1860.9587 4783.6746,-1850.8112 4779.7276,-1860.6434 4786.7205,-1860.9587"/>
</g>
<!-- section_36 -->
<g id="node37" class="node">
<title>section_36</title>
<ellipse fill="none" stroke="#000000" cx="4928.5" cy="-1832.5029" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4928.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 92&#45;126</text>
</g>
<!-- section_10&#45;&gt;section_36 -->
<g id="edge36" class="edge">
<title>section_10&#45;&gt;section_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4722.1425,-3255.9766C4744.1726,-3104.0113 4897.1823,-2048.5356 4924.3728,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="4927.8749,-1861.2099 4925.8459,-1850.8112 4920.9473,-1860.2056 4927.8749,-1861.2099"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="5327.5,-1968.0034 5017.5,-1968.0034 5017.5,-1697.0024 5327.5,-1697.0024 5327.5,-1968.0034"/>
<text text-anchor="middle" x="5172.5" y="-1952.8031" font-family="Inconsolata" font-size="14.00" fill="#000000">** Parse the prose within a block</text>
<text text-anchor="middle" x="5172.5" y="-1921.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5172.5" y="-1906.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="5172.5" y="-1890.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="5172.5" y="-1875.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="5172.5" y="-1859.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="5172.5" y="-1844.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5172.5" y="-1829.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5172.5" y="-1813.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="5172.5" y="-1798.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="5172.5" y="-1782.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="5172.5" y="-1767.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5172.5" y="-1752.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5172.5" y="-1736.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5172.5" y="-1705.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_10&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>section_10&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4725.1456,-3256.2376C4766.276,-3125.3373 5021.199,-2314.0283 5126.7804,-1978.0084"/>
<polygon fill="#000000" stroke="#000000" points="5130.2016,-1978.7961 5129.8602,-1968.2068 5123.5235,-1976.6977 5130.2016,-1978.7961"/>
</g>
<!-- header_50 -->
<g id="node51" class="node">
<title>header_50</title>
<ellipse fill="none" stroke="#000000" cx="5525.5" cy="-1832.5029" rx="99.6298" ry="18"/>
<text text-anchor="middle" x="5525.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor/module</text>
</g>
<!-- section_11&#45;&gt;header_50 -->
<g id="edge50" class="edge">
<title>section_11&#45;&gt;header_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5779.2506,-3255.9766C5752.1475,-3103.9356 5563.8229,-2047.4841 5530.5253,-1860.6933"/>
<polygon fill="#000000" stroke="#000000" points="5533.9644,-1860.0417 5528.7637,-1850.8112 5527.073,-1861.2703 5533.9644,-1860.0417"/>
</g>
<!-- block_51 -->
<g id="node52" class="node">
<title>block_51</title>
<ellipse fill="none" stroke="#000000" cx="5708.5" cy="-1832.5029" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5708.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 127&#45;128</text>
</g>
<!-- section_11&#45;&gt;block_51 -->
<g id="edge51" class="edge">
<title>section_11&#45;&gt;block_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5781.5644,-3255.9766C5773.7643,-3104.0113 5719.5886,-2048.5356 5709.9613,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="5713.4478,-1860.6186 5709.4397,-1850.8112 5706.457,-1860.9775 5713.4478,-1860.6186"/>
</g>
<!-- block_52 -->
<g id="node53" class="node">
<title>block_52</title>
<ellipse fill="none" stroke="#000000" cx="5857.5" cy="-1832.5029" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5857.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 129&#45;157</text>
</g>
<!-- section_11&#45;&gt;block_52 -->
<g id="edge52" class="edge">
<title>section_11&#45;&gt;block_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5783.4483,-3255.9766C5791.3538,-3104.0113 5846.2616,-2048.5356 5856.0189,-1860.9729"/>
<polygon fill="#000000" stroke="#000000" points="5859.5232,-1860.9796 5856.5476,-1850.8112 5852.5327,-1860.6158 5859.5232,-1860.9796"/>
</g>
<!-- block_53 -->
<g id="node54" class="node">
<title>block_53</title>
<ellipse fill="none" stroke="#000000" cx="6138.5" cy="-1832.5029" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6138.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 158&#45;162</text>
</g>
<!-- section_11&#45;&gt;block_53 -->
<g id="edge53" class="edge">
<title>section_11&#45;&gt;block_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5778.2116,-3255.9152C5754.6396,-3150.7426 5649.6069,-2616.0857 5866.5,-2283.6036 5884.7559,-2255.6185 5909.3347,-2271.6829 5932.5,-2247.6036 6047.3314,-2128.2409 6110.6959,-1932.4002 6131.1071,-1860.2849"/>
<polygon fill="#000000" stroke="#000000" points="6134.5024,-1861.1385 6133.8079,-1850.5665 6127.758,-1859.2641 6134.5024,-1861.1385"/>
</g>
<!-- block_54 -->
<g id="node55" class="node">
<title>block_54</title>
<ellipse fill="none" stroke="#000000" cx="6417.5" cy="-1832.5029" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6417.5" y="-1828.3029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 163&#45;180</text>
</g>
<!-- section_11&#45;&gt;block_54 -->
<g id="edge54" class="edge">
<title>section_11&#45;&gt;block_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5776.8644,-3256.206C5743.9006,-3147.0035 5586.9355,-2568.4688 5866.5,-2283.6036 5920.8012,-2228.2727 6149.8989,-2291.9322 6213.5,-2247.6036 6350.6595,-2152.0062 6399.6531,-1937.3321 6413.1659,-1860.5084"/>
<polygon fill="#000000" stroke="#000000" points="6416.6233,-1861.054 6414.8426,-1850.6099 6409.7216,-1859.8849 6416.6233,-1861.054"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="7049.5,-2247.7043 6501.5,-2247.7043 6501.5,-1417.3015 7049.5,-1417.3015 7049.5,-2247.7043"/>
<text text-anchor="middle" x="6775.5" y="-2232.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">** Constructor/module</text>
<text text-anchor="middle" x="6775.5" y="-2201.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6775.5" y="-2185.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local b = {}</text>
<text text-anchor="middle" x="6775.5" y="-2154.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Block, lines, linum)</text>
<text text-anchor="middle" x="6775.5" y="-2138.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = setmetatable({}, B)</text>
<text text-anchor="middle" x="6775.5" y="-2123.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.lines = {}</text>
<text text-anchor="middle" x="6775.5" y="-2108.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.line_first = linum</text>
<text text-anchor="middle" x="6775.5" y="-2092.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (lines) then </text>
<text text-anchor="middle" x="6775.5" y="-2077.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(lines) == &quot;string&quot; then</text>
<text text-anchor="middle" x="6775.5" y="-2061.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(lines)</text>
<text text-anchor="middle" x="6775.5" y="-2046.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif type(lines) == &quot;table&quot; then</text>
<text text-anchor="middle" x="6775.5" y="-2031.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, l in ipairs(lines) do</text>
<text text-anchor="middle" x="6775.5" y="-2015.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(l)</text>
<text text-anchor="middle" x="6775.5" y="-2000.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6775.5" y="-1984.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6775.5" y="-1969.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;Error: in block.new type of `lines` is &quot; .. type(lines))</text>
<text text-anchor="middle" x="6775.5" y="-1954.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6775.5" y="-1938.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6775.5" y="-1907.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.id = &quot;block&quot;</text>
<text text-anchor="middle" x="6775.5" y="-1891.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="6775.5" y="-1876.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6775.5" y="-1861.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="6775.5" y="-1813.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> Sorts lines into structure and prose.</text>
<text text-anchor="middle" x="6775.5" y="-1798.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6775.5" y="-1782.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line : taken from block.lines</text>
<text text-anchor="middle" x="6775.5" y="-1751.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; returns: </text>
<text text-anchor="middle" x="6775.5" y="-1736.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;1. true for structure, false for prose</text>
<text text-anchor="middle" x="6775.5" y="-1720.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;2. id of structure line or &quot;&quot; for prose</text>
<text text-anchor="middle" x="6775.5" y="-1673.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6775.5" y="-1657.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local function structureOrProse(line)</text>
<text text-anchor="middle" x="6775.5" y="-1642.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_p, line) then</text>
<text text-anchor="middle" x="6775.5" y="-1627.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tagline&quot;</text>
<text text-anchor="middle" x="6775.5" y="-1611.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.listline_p, line) then</text>
<text text-anchor="middle" x="6775.5" y="-1596.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;listline&quot;</text>
<text text-anchor="middle" x="6775.5" y="-1580.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tableline_p, line) then</text>
<text text-anchor="middle" x="6775.5" y="-1565.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tableline&quot;</text>
<text text-anchor="middle" x="6775.5" y="-1550.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6775.5" y="-1534.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false, &quot;&quot;</text>
<text text-anchor="middle" x="6775.5" y="-1519.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6775.5" y="-1487.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="6775.5" y="-1472.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__index&quot;] = b</text>
<text text-anchor="middle" x="6775.5" y="-1441.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, b)</text>
<text text-anchor="middle" x="6775.5" y="-1425.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_11&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>section_11&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5776.683,-3256.0238C5742.65,-3145.7476 5580.4676,-2561.9738 5866.5,-2283.6036 5916.4287,-2235.0124 6431.8639,-2281.9145 6492.5,-2247.6036 6492.5919,-2247.5515 6492.6838,-2247.4995 6492.7757,-2247.4474"/>
<polygon fill="#000000" stroke="#000000" points="6494.3956,-2250.5549 6501.252,-2242.4777 6490.8551,-2244.5162 6494.3956,-2250.5549"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2879.5,-1116.1018 2825.5,-1116.1018 2825.5,-1080.1018 2879.5,-1080.1018 2879.5,-1116.1018"/>
</g>
<!-- block_18&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_18&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2852.5,-1814.3491C2852.5,-1716.0334 2852.5,-1247.3469 2852.5,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="2856.0001,-1126.2784 2852.5,-1116.2785 2849.0001,-1126.2785 2856.0001,-1126.2784"/>
</g>
<!-- codeblock_21 -->
<g id="node22" class="node">
<title>codeblock_21</title>
<ellipse fill="none" stroke="#000000" cx="2978.5" cy="-1098.1018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2978.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 35&#45;48</text>
</g>
<!-- block_19&#45;&gt;codeblock_21 -->
<g id="edge21" class="edge">
<title>block_19&#45;&gt;codeblock_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2982.4011,-1814.3491C2981.8656,-1716.0334 2979.3129,-1247.3469 2978.655,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="2982.1535,-1126.2592 2978.599,-1116.2785 2975.1536,-1126.2974 2982.1535,-1126.2592"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="3127.5,-1116.1018 3073.5,-1116.1018 3073.5,-1080.1018 3127.5,-1080.1018 3127.5,-1116.1018"/>
</g>
<!-- block_19&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2983.4957,-1814.2879C2987.0957,-1755.5435 3001.7368,-1566.2627 3047.5,-1417.4022 3052.6995,-1400.4891 3059.5457,-1398.3887 3064.5,-1381.4022 3090.9387,-1290.7531 3097.9639,-1178.1831 3099.8281,-1126.4804"/>
<polygon fill="#000000" stroke="#000000" points="3103.3289,-1126.5088 3100.1527,-1116.4013 3096.3325,-1126.2834 3103.3289,-1126.5088"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="3133.5,-709.6017 2823.5,-709.6017 2823.5,-515.4003 3133.5,-515.4003 3133.5,-709.6017"/>
<text text-anchor="middle" x="2978.5" y="-694.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2978.5" y="-663.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="2978.5" y="-647.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="2978.5" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="2978.5" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="2978.5" y="-585.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="2978.5" y="-554.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="2978.5" y="-538.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="2978.5" y="-523.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
</g>
<!-- codeblock_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2978.5,-1079.9519C2978.5,-1022.1483 2978.5,-839.1743 2978.5,-720.0287"/>
<polygon fill="#000000" stroke="#000000" points="2982.0001,-719.7782 2978.5,-709.7783 2975.0001,-719.7783 2982.0001,-719.7782"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="3690.5,-1116.1018 3636.5,-1116.1018 3636.5,-1080.1018 3690.5,-1080.1018 3690.5,-1116.1018"/>
</g>
<!-- block_26&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_26&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3663.5,-1814.3491C3663.5,-1716.0334 3663.5,-1247.3469 3663.5,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="3667.0001,-1126.2784 3663.5,-1116.2785 3660.0001,-1126.2785 3667.0001,-1126.2784"/>
</g>
<!-- codeblock_29 -->
<g id="node30" class="node">
<title>codeblock_29</title>
<ellipse fill="none" stroke="#000000" cx="3789.5" cy="-1098.1018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3789.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 53&#45;73</text>
</g>
<!-- block_27&#45;&gt;codeblock_29 -->
<g id="edge29" class="edge">
<title>block_27&#45;&gt;codeblock_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3793.4011,-1814.3491C3792.8656,-1716.0334 3790.3129,-1247.3469 3789.655,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="3793.1535,-1126.2592 3789.599,-1116.2785 3786.1536,-1126.2974 3793.1535,-1126.2592"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="3938.5,-1116.1018 3884.5,-1116.1018 3884.5,-1080.1018 3938.5,-1080.1018 3938.5,-1116.1018"/>
</g>
<!-- block_27&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_27&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3794.3,-1814.2447C3797.3007,-1755.3702 3810.2592,-1565.7406 3857.5,-1417.4022 3862.9283,-1400.3572 3870.2987,-1398.5179 3875.5,-1381.4022 3903.0227,-1290.8344 3909.5164,-1177.7854 3911.0393,-1126.1602"/>
<polygon fill="#000000" stroke="#000000" points="3914.5395,-1126.1921 3911.2946,-1116.1064 3907.5418,-1126.0143 3914.5395,-1126.1921"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="3997,-763.9018 3582,-763.9018 3582,-461.1002 3997,-461.1002 3997,-763.9018"/>
<text text-anchor="middle" x="3789.5" y="-748.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="3789.5" y="-733.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="3789.5" y="-701.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="3789.5" y="-686.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="3789.5" y="-670.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3789.5" y="-639.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="3789.5" y="-624.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="3789.5" y="-608.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="3789.5" y="-593.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="3789.5" y="-577.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="3789.5" y="-562.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="3789.5" y="-547.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3789.5" y="-531.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="3789.5" y="-516.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3789.5" y="-484.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="3789.5" y="-469.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_29&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>codeblock_29&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3789.5,-1079.9519C3789.5,-1030.3543 3789.5,-888.6028 3789.5,-774.0899"/>
<polygon fill="#000000" stroke="#000000" points="3793.0001,-773.7992 3789.5,-763.7992 3786.0001,-773.7993 3793.0001,-773.7992"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4488.5,-1116.1018 4434.5,-1116.1018 4434.5,-1080.1018 4488.5,-1080.1018 4488.5,-1116.1018"/>
</g>
<!-- block_34&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>block_34&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4657.4606,-1814.265C4666.603,-1751.3099 4688.1513,-1540.2556 4589.5,-1417.4022 4562.0084,-1383.1661 4524.4935,-1416.0324 4497.5,-1381.4022 4438.349,-1305.5169 4448.1902,-1181.8838 4456.4148,-1126.5014"/>
<polygon fill="#000000" stroke="#000000" points="4459.912,-1126.7933 4458.0172,-1116.3693 4452.998,-1125.6998 4459.912,-1126.7933"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="4583.5" cy="-1098.1018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="4583.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;90</text>
</g>
<!-- block_35&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>block_35&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4786.3509,-1814.2531C4791.6489,-1752.987 4801.6135,-1551.0176 4719.5,-1417.4022 4705.1628,-1394.0726 4685.4271,-1403.6767 4669.5,-1381.4022 4611.8822,-1300.8224 4592.2766,-1181.0089 4586.1047,-1126.7017"/>
<polygon fill="#000000" stroke="#000000" points="4589.5517,-1126.0176 4585.0123,-1116.4445 4582.5911,-1126.7589 4589.5517,-1126.0176"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="4732.5,-1116.1018 4678.5,-1116.1018 4678.5,-1080.1018 4732.5,-1080.1018 4732.5,-1116.1018"/>
</g>
<!-- block_35&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>block_35&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4782.5472,-1814.3491C4771.9713,-1716.0334 4721.5544,-1247.3469 4708.5605,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="4712.0048,-1125.8467 4707.4553,-1116.2785 4705.045,-1126.5955 4712.0048,-1125.8467"/>
</g>
<!-- header_41 -->
<g id="node42" class="node">
<title>header_41</title>
<ellipse fill="none" stroke="#000000" cx="4802.5" cy="-1098.1018" rx="51.9763" ry="18"/>
<text text-anchor="middle" x="4802.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : toValue</text>
</g>
<!-- section_36&#45;&gt;header_41 -->
<g id="edge41" class="edge">
<title>section_36&#45;&gt;header_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4925.3854,-1814.3491C4908.5005,-1715.9344 4827.9437,-1246.4026 4807.3188,-1126.1886"/>
<polygon fill="#000000" stroke="#000000" points="4810.7592,-1125.5426 4805.6185,-1116.2785 4803.86,-1126.7263 4810.7592,-1125.5426"/>
</g>
<!-- block_42 -->
<g id="node43" class="node">
<title>block_42</title>
<ellipse fill="none" stroke="#000000" cx="4928.5" cy="-1098.1018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4928.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 92&#45;96</text>
</g>
<!-- section_36&#45;&gt;block_42 -->
<g id="edge42" class="edge">
<title>section_36&#45;&gt;block_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4928.5,-1814.3491C4928.5,-1716.0334 4928.5,-1247.3469 4928.5,-1126.5525"/>
<polygon fill="#000000" stroke="#000000" points="4932.0001,-1126.2784 4928.5,-1116.2785 4925.0001,-1126.2785 4932.0001,-1126.2784"/>
</g>
<!-- block_43 -->
<g id="node44" class="node">
<title>block_43</title>
<ellipse fill="none" stroke="#000000" cx="5063.5" cy="-1098.1018" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="5063.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 97&#45;126</text>
</g>
<!-- section_36&#45;&gt;block_43 -->
<g id="edge43" class="edge">
<title>section_36&#45;&gt;block_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4931.8371,-1814.3491C4949.928,-1715.9344 5036.2389,-1246.4026 5058.337,-1126.1886"/>
<polygon fill="#000000" stroke="#000000" points="5061.793,-1126.7465 5060.1587,-1116.2785 5054.9084,-1125.4809 5061.793,-1126.7465"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="5515,-1381.2028 5142,-1381.2028 5142,-815.0007 5515,-815.0007 5515,-1381.2028"/>
<text text-anchor="middle" x="5328.5" y="-1366.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">*** toValue</text>
<text text-anchor="middle" x="5328.5" y="-1334.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="5328.5" y="-1319.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
<text text-anchor="middle" x="5328.5" y="-1288.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5328.5" y="-1272.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="5328.5" y="-1257.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5328.5" y="-1241.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="5328.5" y="-1226.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5328.5" y="-1211.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5328.5" y="-1195.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5328.5" y="-1180.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5328.5" y="-1148.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="5328.5" y="-1133.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="5328.5" y="-1118.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="5328.5" y="-1102.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5328.5" y="-1071.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="5328.5" y="-1055.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="5328.5" y="-1040.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="5328.5" y="-1025.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="5328.5" y="-1009.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5328.5" y="-994.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="5328.5" y="-978.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5328.5" y="-963.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5328.5" y="-932.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="5328.5" y="-916.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="5328.5" y="-901.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="5328.5" y="-885.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5328.5" y="-870.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5328.5" y="-823.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_36&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>section_36&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4925.9706,-1814.2827C4918.206,-1750.485 4901.3141,-1534.6991 5008.5,-1417.4022 5047.4996,-1374.7237 5086.5877,-1415.1905 5133.5,-1381.4022 5133.5871,-1381.3395 5133.6741,-1381.2768 5133.7611,-1381.2139"/>
<polygon fill="#000000" stroke="#000000" points="5135.8591,-1384.0155 5141.7772,-1375.2277 5131.6706,-1378.4069 5135.8591,-1384.0155"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="4647.5,-701.4018 4337.5,-701.4018 4337.5,-523.6002 4647.5,-523.6002 4647.5,-701.4018"/>
<text text-anchor="middle" x="4492.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="4492.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="4492.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="4492.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="4492.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4492.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4492.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="4492.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="4492.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="4492.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4492.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4580.0988,-1079.9519C4568.9968,-1020.7086 4533.2552,-829.9818 4511.0048,-711.2475"/>
<polygon fill="#000000" stroke="#000000" points="4514.4432,-710.5932 4509.1611,-701.409 4507.5629,-711.8826 4514.4432,-710.5932"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="5039,-639.8014 4666,-639.8014 4666,-585.2006 5039,-585.2006 5039,-639.8014"/>
<text text-anchor="middle" x="4852.5" y="-608.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="4852.5" y="-593.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
</g>
<!-- block_42&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>block_42&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4925.6594,-1079.9519C4914.5184,-1008.7664 4873.6669,-747.7465 4858.3512,-649.8875"/>
<polygon fill="#000000" stroke="#000000" points="4861.7857,-649.1958 4856.7814,-639.8573 4854.8699,-650.2782 4861.7857,-649.1958"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="5139.5" cy="-612.501" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="5139.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 97&#45;124</text>
</g>
<!-- block_43&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>block_43&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5066.3406,-1079.9519C5077.8508,-1006.4073 5121.0734,-730.2378 5135.0853,-640.7088"/>
<polygon fill="#000000" stroke="#000000" points="5138.5567,-641.163 5136.6452,-630.742 5131.6409,-640.0805 5138.5567,-641.163"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="5293.5,-630.501 5239.5,-630.501 5239.5,-594.501 5293.5,-594.501 5293.5,-630.501"/>
</g>
<!-- block_43&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>block_43&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5062.4586,-1079.8867C5060.661,-1030.6152 5062.5434,-893.1567 5132.5,-814.8013 5163.4032,-780.188 5200.0445,-813.8092 5230.5,-778.8013 5264.1486,-740.1231 5268.7198,-677.4592 5268.1739,-641.1056"/>
<polygon fill="#000000" stroke="#000000" points="5271.661,-640.6159 5267.8667,-630.7239 5264.6641,-640.823 5271.661,-640.6159"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="5322.5,-410.3011 4956.5,-410.3011 4956.5,.1004 5322.5,.1004 5322.5,-410.3011"/>
<text text-anchor="middle" x="5139.5" y="-395.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="5139.5" y="-379.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5139.5" y="-364.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="5139.5" y="-348.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5139.5" y="-333.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5139.5" y="-318.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5139.5" y="-302.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5139.5" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="5139.5" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="5139.5" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="5139.5" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5139.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="5139.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="5139.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="5139.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="5139.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5139.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="5139.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5139.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5139.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="5139.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="5139.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="5139.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>codeblock_45&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5139.5,-594.4698C5139.5,-562.5178 5139.5,-492.5163 5139.5,-420.5525"/>
<polygon fill="#000000" stroke="#000000" points="5143.0001,-420.3887 5139.5,-410.3888 5136.0001,-420.3888 5143.0001,-420.3887"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="5587.5,-1116.1018 5533.5,-1116.1018 5533.5,-1080.1018 5587.5,-1080.1018 5587.5,-1116.1018"/>
</g>
<!-- block_51&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>block_51&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5709.1706,-1814.2105C5710.6095,-1753.64 5709.0085,-1555.6173 5634.5,-1417.4022 5623.4606,-1396.9238 5607.0239,-1402.1503 5596.5,-1381.4022 5553.3816,-1296.393 5554.7229,-1179.287 5558.0643,-1126.238"/>
<polygon fill="#000000" stroke="#000000" points="5561.5588,-1126.4385 5558.7695,-1116.2174 5554.576,-1125.947 5561.5588,-1126.4385"/>
</g>
<!-- codeblock_56 -->
<g id="node57" class="node">
<title>codeblock_56</title>
<ellipse fill="none" stroke="#000000" cx="5692.5" cy="-1098.1018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5692.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 129&#45;151</text>
</g>
<!-- block_52&#45;&gt;codeblock_56 -->
<g id="edge56" class="edge">
<title>block_52&#45;&gt;codeblock_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5854.9084,-1814.1614C5846.5181,-1755.802 5818.5949,-1569.3221 5783.5,-1417.4022 5758.3307,-1308.4489 5719.0502,-1181.2632 5701.4992,-1126.046"/>
<polygon fill="#000000" stroke="#000000" points="5704.7607,-1124.7534 5698.3861,-1116.2908 5698.092,-1126.8816 5704.7607,-1124.7534"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="6079.5,-1141.3021 5797.5,-1141.3021 5797.5,-1054.9014 6079.5,-1054.9014 6079.5,-1141.3021"/>
<text text-anchor="middle" x="5938.5" y="-1094.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> Sorts lines into structure and prose.</text>
<text text-anchor="middle" x="5938.5" y="-1078.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="5938.5" y="-1063.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line : taken from block.lines</text>
</g>
<!-- block_52&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>block_52&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5859.5023,-1814.3491C5869.6967,-1721.9193 5915.996,-1302.138 5932.5736,-1151.8342"/>
<polygon fill="#000000" stroke="#000000" points="5936.0975,-1151.8097 5933.715,-1141.4862 5929.1397,-1151.0422 5936.0975,-1151.8097"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="6443,-1133.3021 6098,-1133.3021 6098,-1062.9014 6443,-1062.9014 6443,-1133.3021"/>
<text text-anchor="middle" x="6270.5" y="-1118.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; returns: </text>
<text text-anchor="middle" x="6270.5" y="-1102.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;1. true for structure, false for prose</text>
<text text-anchor="middle" x="6270.5" y="-1087.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;2. id of structure line or &quot;&quot; for prose</text>
</g>
<!-- block_53&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>block_53&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6141.7629,-1814.3491C6158.6887,-1720.1801 6236.6872,-1286.2242 6262.3151,-1143.6397"/>
<polygon fill="#000000" stroke="#000000" points="6265.8146,-1143.954 6264.1389,-1133.4925 6258.925,-1142.7156 6265.8146,-1143.954"/>
</g>
<!-- codeblock_60 -->
<g id="node61" class="node">
<title>codeblock_60</title>
<ellipse fill="none" stroke="#000000" cx="6548.5" cy="-1098.1018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6548.5" y="-1093.9018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 163&#45;179</text>
</g>
<!-- block_54&#45;&gt;codeblock_60 -->
<g id="edge60" class="edge">
<title>block_54&#45;&gt;codeblock_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6420.7382,-1814.3491C6438.2931,-1715.9344 6522.0466,-1246.4026 6543.49,-1126.1886"/>
<polygon fill="#000000" stroke="#000000" points="6546.9472,-1126.7377 6545.2577,-1116.2785 6540.056,-1125.5084 6546.9472,-1126.7377"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="6707.5,-1116.1018 6653.5,-1116.1018 6653.5,-1080.1018 6707.5,-1080.1018 6707.5,-1116.1018"/>
</g>
<!-- block_54&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>block_54&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6414.5167,-1814.1248C6405.2053,-1749.8029 6383.4451,-1532.4887 6492.5,-1417.4022 6540.2522,-1367.009 6598.0832,-1433.0281 6644.5,-1381.4022 6709.2746,-1309.3584 6696.1384,-1182.2366 6686.291,-1126.0947"/>
<polygon fill="#000000" stroke="#000000" points="6689.7132,-1125.353 6684.4497,-1116.1581 6682.8304,-1126.6285 6689.7132,-1125.353"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="5966.5,-778.6018 5418.5,-778.6018 5418.5,-446.4002 5966.5,-446.4002 5966.5,-778.6018"/>
<text text-anchor="middle" x="5692.5" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local b = {}</text>
<text text-anchor="middle" x="5692.5" y="-732.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Block, lines, linum)</text>
<text text-anchor="middle" x="5692.5" y="-716.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = setmetatable({}, B)</text>
<text text-anchor="middle" x="5692.5" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.lines = {}</text>
<text text-anchor="middle" x="5692.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.line_first = linum</text>
<text text-anchor="middle" x="5692.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (lines) then </text>
<text text-anchor="middle" x="5692.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(lines) == &quot;string&quot; then</text>
<text text-anchor="middle" x="5692.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(lines)</text>
<text text-anchor="middle" x="5692.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif type(lines) == &quot;table&quot; then</text>
<text text-anchor="middle" x="5692.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, l in ipairs(lines) do</text>
<text text-anchor="middle" x="5692.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(l)</text>
<text text-anchor="middle" x="5692.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5692.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5692.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;Error: in block.new type of `lines` is &quot; .. type(lines))</text>
<text text-anchor="middle" x="5692.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5692.5" y="-516.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5692.5" y="-485.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.id = &quot;block&quot;</text>
<text text-anchor="middle" x="5692.5" y="-469.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="5692.5" y="-454.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_56&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>codeblock_56&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5692.5,-1079.9519C5692.5,-1032.4435 5692.5,-900.3813 5692.5,-788.6968"/>
<polygon fill="#000000" stroke="#000000" points="5696.0001,-788.6431 5692.5,-778.6431 5689.0001,-788.6432 5696.0001,-788.6431"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="6710.5,-732.7015 6386.5,-732.7015 6386.5,-492.3005 6710.5,-492.3005 6710.5,-732.7015"/>
<text text-anchor="middle" x="6548.5" y="-717.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function structureOrProse(line)</text>
<text text-anchor="middle" x="6548.5" y="-702.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_p, line) then</text>
<text text-anchor="middle" x="6548.5" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tagline&quot;</text>
<text text-anchor="middle" x="6548.5" y="-671.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.listline_p, line) then</text>
<text text-anchor="middle" x="6548.5" y="-655.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;listline&quot;</text>
<text text-anchor="middle" x="6548.5" y="-640.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tableline_p, line) then</text>
<text text-anchor="middle" x="6548.5" y="-625.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tableline&quot;</text>
<text text-anchor="middle" x="6548.5" y="-609.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6548.5" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false, &quot;&quot;</text>
<text text-anchor="middle" x="6548.5" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6548.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="6548.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__index&quot;] = b</text>
<text text-anchor="middle" x="6548.5" y="-500.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, b)</text>
</g>
<!-- codeblock_60&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>codeblock_60&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6548.5,-1079.9519C6548.5,-1025.7454 6548.5,-861.4621 6548.5,-742.9675"/>
<polygon fill="#000000" stroke="#000000" points="6552.0001,-742.7271 6548.5,-732.7272 6545.0001,-742.7272 6552.0001,-742.7271"/>
</g>
</g>
</svg>