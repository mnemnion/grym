<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="6177pt" height="1232pt"
 viewBox="0.00 0.00 6177.00 1231.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1227.6017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1227.6017 6173,-1227.6017 6173,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="2272" cy="-1205.6017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="2272" y="-1201.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 180</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="2272" cy="-1133.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2272" y="-1129.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;126</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2272,-1187.433C2272,-1179.7326 2272,-1170.576 2272,-1162.0183"/>
<polygon fill="#000000" stroke="#000000" points="2275.5001,-1162.0149 2272,-1152.015 2268.5001,-1162.015 2275.5001,-1162.0149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="182" cy="-1061.6017" rx="75.4657" ry="18"/>
<text text-anchor="middle" x="182" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Block module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2206.5798,-1131.348C1900.6866,-1120.81 611.8451,-1076.4097 267.1031,-1064.5335"/>
<polygon fill="#000000" stroke="#000000" points="267.0522,-1061.0297 256.9376,-1064.1833 266.8111,-1068.0256 267.0522,-1061.0297"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1022" cy="-1061.6017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1022" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2207.4268,-1129.8823C1989.3733,-1117.3224 1282.5551,-1076.6097 1077.9614,-1064.8251"/>
<polygon fill="#000000" stroke="#000000" points="1077.935,-1061.3178 1067.7503,-1064.2369 1077.5324,-1068.3062 1077.935,-1061.3178"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1487" cy="-1061.6017" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1487" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2209.417,-1127.8616C2061.5,-1114.2947 1691.8746,-1080.3927 1546.7917,-1067.0858"/>
<polygon fill="#000000" stroke="#000000" points="1547.0178,-1063.5919 1536.7399,-1066.1638 1546.3784,-1070.5626 1547.0178,-1063.5919"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1786" cy="-1061.6017" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="1786" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;14</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.8598,-1124.9883C2121.1189,-1111.2489 1940.5862,-1084.5033 1846.4256,-1070.5536"/>
<polygon fill="#000000" stroke="#000000" points="1846.8902,-1067.0843 1836.4852,-1069.081 1845.8643,-1074.0088 1846.8902,-1067.0843"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="2003" cy="-1061.6017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2003" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 15&#45;27</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2224.836,-1120.9779C2177.6117,-1108.3379 2105.0804,-1088.9243 2055.919,-1075.7659"/>
<polygon fill="#000000" stroke="#000000" points="2056.6719,-1072.3443 2046.107,-1073.1396 2054.862,-1079.1062 2056.6719,-1072.3443"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="2340" cy="-1061.6017" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2340" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 28&#45;126</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2288.4609,-1116.1725C2296.835,-1107.3058 2307.1638,-1096.3695 2316.3706,-1086.621"/>
<polygon fill="#000000" stroke="#000000" points="2319.1333,-1088.7933 2323.455,-1079.1199 2314.0442,-1083.9869 2319.1333,-1088.7933"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2860" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2860" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;50</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.163,-1126.2348C2441.6924,-1112.823 2673.0742,-1084.4906 2789.6839,-1070.2118"/>
<polygon fill="#000000" stroke="#000000" points="2790.4215,-1073.6477 2799.922,-1068.9582 2789.5707,-1066.6996 2790.4215,-1073.6477"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="3362" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3362" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 51&#45;75</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2336.1151,-1129.3666C2526.0739,-1116.8188 3085.254,-1079.8822 3287.7315,-1066.5075"/>
<polygon fill="#000000" stroke="#000000" points="3288.2181,-1069.9831 3297.9656,-1065.8315 3287.7567,-1062.9983 3288.2181,-1069.9831"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="4051" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4051" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 76&#45;91</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2337.1599,-1130.9645C2612.7232,-1119.8119 3681.6832,-1076.5487 3975.7548,-1064.647"/>
<polygon fill="#000000" stroke="#000000" points="3976.0362,-1068.1386 3985.8864,-1064.237 3975.753,-1061.1443 3976.0362,-1068.1386"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="5098" cy="-1061.6017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5098" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 127&#45;180</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2337.6953,-1131.9279C2713.4778,-1122.3538 4588.6669,-1074.5783 5012.6855,-1063.7753"/>
<polygon fill="#000000" stroke="#000000" points="5012.8208,-1067.2731 5022.7284,-1063.5194 5012.6425,-1060.2754 5012.8208,-1067.2731"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-929.2015 0,-929.2015 0,-893.2015 54,-893.2015 54,-929.2015"/>
</g>
<!-- header_2&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>header_2&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M130.8706,-1048.2899C107.5281,-1039.9505 81.115,-1027.0038 63,-1007.6017 45.3736,-988.7229 36.1743,-960.422 31.5055,-939.3623"/>
<polygon fill="#000000" stroke="#000000" points="34.9038,-938.5068 29.5083,-929.3887 28.04,-939.8813 34.9038,-938.5068"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="571.5,-946.4019 72.5,-946.4019 72.5,-876.0011 571.5,-876.0011 571.5,-946.4019"/>
<text text-anchor="middle" x="322" y="-915.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A Block is the container for the next level of granularity below</text>
<text text-anchor="middle" x="322" y="-899.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a Section. Any Section has a Header and one or more Blocks. Both the</text>
<text text-anchor="middle" x="322" y="-884.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Header and the Block may be virtual, that is, without contents.</text>
</g>
<!-- block_3&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_3&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M976.1873,-1059.5657C895.2111,-1055.1827 721.9365,-1042.2721 580,-1007.6017 522.1795,-993.4781 459.5895,-970.2975 410.5387,-950.207"/>
<polygon fill="#000000" stroke="#000000" points="411.8074,-946.9443 401.2284,-946.3643 409.1367,-953.4148 411.8074,-946.9443"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1088.5,-938.5019 589.5,-938.5019 589.5,-883.9011 1088.5,-883.9011 1088.5,-938.5019"/>
<text text-anchor="middle" x="839" y="-923.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> The most general premise is that Blocks are delineated by blank line</text>
<text text-anchor="middle" x="839" y="-908.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> whitespace. </text>
</g>
<!-- block_4&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_4&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1436.7671,-1058.1955C1361.8395,-1052.3213 1216.783,-1037.8792 1097,-1007.6017 1032.0827,-991.1925 960.9877,-963.8906 909.898,-942.5226"/>
<polygon fill="#000000" stroke="#000000" points="911.1717,-939.2614 900.5972,-938.6058 908.4549,-945.7127 911.1717,-939.2614"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1647.5,-938.402 1106.5,-938.402 1106.5,-884.001 1647.5,-884.001 1647.5,-938.402"/>
<text text-anchor="middle" x="1377" y="-923.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> A paragraph of prose is the simplest block, and the default. &#160;A list with</text>
<text text-anchor="middle" x="1377" y="-907.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a tag line is a block also, as is a table. &#160;Most importantly for our short</text>
<text text-anchor="middle" x="1377" y="-892.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> path, code blocks are enclosed in blocks as well.</text>
</g>
<!-- block_5&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1749.344,-1048.1223C1684.6445,-1024.3306 1548.6834,-974.334 1460.1885,-941.7921"/>
<polygon fill="#000000" stroke="#000000" points="1461.3033,-938.473 1450.7098,-938.3065 1458.8874,-945.0429 1461.3033,-938.473"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2206.5,-1007.502 1665.5,-1007.502 1665.5,-814.901 2206.5,-814.901 2206.5,-1007.502"/>
<text text-anchor="middle" x="1936" y="-992.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking needs to identify when it has structure, and when prose, on a </text>
<text text-anchor="middle" x="1936" y="-977.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> line&#45;by&#45;line basis. &#160;It must also apply the cling rule to make sure that</text>
<text text-anchor="middle" x="1936" y="-961.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> e.g. tags are part of the block indicated by whitespacing. </text>
<text text-anchor="middle" x="1936" y="-946.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1936" y="-930.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking need not, and mostly should not, parse within structure or prose.</text>
<text text-anchor="middle" x="1936" y="-915.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> These categories are determined by the beginning of a line, making this</text>
<text text-anchor="middle" x="1936" y="-900.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> tractable. </text>
<text text-anchor="middle" x="1936" y="-884.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1936" y="-869.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> The cling rule requires lookahead. LPEG is quite capable of this, as is </text>
<text text-anchor="middle" x="1936" y="-853.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> packrat PEG parsing generally. &#160;In the bootstrap implementation, we will</text>
<text text-anchor="middle" x="1936" y="-838.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> parse once for ownership, again (in the `lines` array of each Section) for</text>
<text text-anchor="middle" x="1936" y="-823.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> blocking, and a final time to parse within blocks. </text>
</g>
<!-- block_6&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_6&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1995.0511,-1043.7582C1991.7267,-1036.2956 1987.5757,-1026.9776 1983.0246,-1016.7612"/>
<polygon fill="#000000" stroke="#000000" points="1986.1992,-1015.2863 1978.9327,-1007.576 1979.8049,-1018.1349 1986.1992,-1015.2863"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="2723.5,-946.4019 2224.5,-946.4019 2224.5,-876.0011 2723.5,-876.0011 2723.5,-946.4019"/>
<text text-anchor="middle" x="2474" y="-931.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Grimoire is intended to work, in linear time, as a single&#45;pass PEG</text>
<text text-anchor="middle" x="2474" y="-915.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> grammar. &#160;Presently (Feb 2018) I&#39;m intending to prototype that with </text>
<text text-anchor="middle" x="2474" y="-900.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> PEGylator and port it to `hammer` with a `quipu` back&#45;end. </text>
</g>
<!-- block_7&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_7&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2355.6338,-1044.0545C2375.0899,-1022.2171 2408.9887,-984.1695 2435.5365,-954.3725"/>
<polygon fill="#000000" stroke="#000000" points="2438.4229,-956.3943 2442.4619,-946.5995 2433.1963,-951.7377 2438.4229,-956.3943"/>
</g>
<!-- header_18 -->
<g id="node19" class="node">
<title>header_18</title>
<ellipse fill="none" stroke="#000000" cx="2796" cy="-911.2015" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="2796" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_8&#45;&gt;header_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;header_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2852.2801,-1043.4599C2841.1803,-1017.3753 2820.6254,-969.0713 2807.6663,-938.6173"/>
<polygon fill="#000000" stroke="#000000" points="2810.8834,-937.2387 2803.7473,-929.4076 2804.4423,-939.9796 2810.8834,-937.2387"/>
</g>
<!-- block_19 -->
<g id="node20" class="node">
<title>block_19</title>
<ellipse fill="none" stroke="#000000" cx="2925" cy="-911.2015" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2925" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 33&#45;34</text>
</g>
<!-- section_8&#45;&gt;block_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;block_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2867.8405,-1043.4599C2879.1138,-1017.3753 2899.9898,-969.0713 2913.1514,-938.6173"/>
<polygon fill="#000000" stroke="#000000" points="2916.3773,-939.9756 2917.1317,-929.4076 2909.9517,-937.1985 2916.3773,-939.9756"/>
</g>
<!-- codeblock_20 -->
<g id="node21" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="3076" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3076" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 35&#45;48</text>
</g>
<!-- section_8&#45;&gt;codeblock_20 -->
<g id="edge20" class="edge">
<title>section_8&#45;&gt;codeblock_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2905.2671,-1048.4053C2931.4961,-1039.438 2964.3052,-1025.869 2990,-1007.6017 3017.312,-988.1846 3042.0383,-958.5947 3057.8935,-937.3211"/>
<polygon fill="#000000" stroke="#000000" points="3060.861,-939.1919 3063.9253,-929.0499 3055.2052,-935.0673 3060.861,-939.1919"/>
</g>
<!-- header_24 -->
<g id="node25" class="node">
<title>header_24</title>
<ellipse fill="none" stroke="#000000" cx="3274" cy="-911.2015" rx="102.5283" ry="18"/>
<text text-anchor="middle" x="3274" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Metatable for Blocks</text>
</g>
<!-- section_9&#45;&gt;header_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;header_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3351.5597,-1043.7582C3336.2936,-1017.6671 3307.7576,-968.8964 3289.8805,-938.3428"/>
<polygon fill="#000000" stroke="#000000" points="3292.7722,-936.3544 3284.7012,-929.4908 3286.7304,-939.8895 3292.7722,-936.3544"/>
</g>
<!-- block_25 -->
<g id="node26" class="node">
<title>block_25</title>
<ellipse fill="none" stroke="#000000" cx="3450" cy="-911.2015" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3450" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 51&#45;52</text>
</g>
<!-- section_9&#45;&gt;block_25 -->
<g id="edge25" class="edge">
<title>section_9&#45;&gt;block_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3372.4403,-1043.7582C3387.7889,-1017.526 3416.5512,-968.3685 3434.4084,-937.849"/>
<polygon fill="#000000" stroke="#000000" points="3437.544,-939.4205 3439.5733,-929.0218 3431.5022,-935.8853 3437.544,-939.4205"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="3601" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3601" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 53&#45;73</text>
</g>
<!-- section_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>section_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3413.5359,-1050.3494C3444.7085,-1041.9196 3484.2378,-1028.2354 3515,-1007.6017 3542.8301,-988.9347 3567.4697,-959.2193 3583.1629,-937.7111"/>
<polygon fill="#000000" stroke="#000000" points="3586.1752,-939.5148 3589.1249,-929.3388 3580.4732,-935.4543 3586.1752,-939.5148"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="3837" cy="-911.2015" rx="140.2419" ry="18"/>
<text text-anchor="middle" x="3837" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parse the prose within a block</text>
</g>
<!-- section_10&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_10&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4026.8675,-1044.6412C3988.6433,-1017.7771 3914.0653,-965.3634 3870.6219,-934.8311"/>
<polygon fill="#000000" stroke="#000000" points="3872.5624,-931.917 3862.3683,-929.0305 3868.5373,-937.6441 3872.5624,-931.917"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="4051" cy="-911.2015" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4051" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 76&#45;77</text>
</g>
<!-- section_10&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_10&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4051,-1043.4599C4051,-1017.6012 4051,-969.9061 4051,-939.4123"/>
<polygon fill="#000000" stroke="#000000" points="4054.5001,-939.4076 4051,-929.4076 4047.5001,-939.4077 4054.5001,-939.4076"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="4202" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="4202" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;90</text>
</g>
<!-- section_10&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_10&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4073.0662,-1044.6231C4085.9856,-1034.3554 4102.3841,-1020.7463 4116,-1007.6017 4139.542,-984.8746 4164.1832,-956.7414 4181.0242,-936.746"/>
<polygon fill="#000000" stroke="#000000" points="4183.7881,-938.8968 4187.5177,-928.9801 4178.418,-934.4065 4183.7881,-938.8968"/>
</g>
<!-- section_33 -->
<g id="node34" class="node">
<title>section_33</title>
<ellipse fill="none" stroke="#000000" cx="4452" cy="-911.2015" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4452" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 92&#45;126</text>
</g>
<!-- section_10&#45;&gt;section_33 -->
<g id="edge33" class="edge">
<title>section_10&#45;&gt;section_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4109.9682,-1053.34C4158.8564,-1045.2796 4229.5538,-1030.7911 4288,-1007.6017 4336.685,-988.2852 4387.9884,-955.906 4419.9821,-934.0617"/>
<polygon fill="#000000" stroke="#000000" points="4422.2338,-936.7604 4428.4758,-928.1995 4418.2576,-930.9993 4422.2338,-936.7604"/>
</g>
<!-- header_43 -->
<g id="node44" class="node">
<title>header_43</title>
<ellipse fill="none" stroke="#000000" cx="4807" cy="-911.2015" rx="99.6298" ry="18"/>
<text text-anchor="middle" x="4807" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor/module</text>
</g>
<!-- section_11&#45;&gt;header_43 -->
<g id="edge43" class="edge">
<title>section_11&#45;&gt;header_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5044.1442,-1048.9146C5010.9718,-1039.9168 4968.2035,-1026.1392 4933,-1007.6017 4895.7777,-988.0012 4858.1203,-957.4747 4833.7963,-936.0364"/>
<polygon fill="#000000" stroke="#000000" points="4835.8683,-933.1942 4826.0784,-929.1434 4831.2054,-938.4151 4835.8683,-933.1942"/>
</g>
<!-- block_44 -->
<g id="node45" class="node">
<title>block_44</title>
<ellipse fill="none" stroke="#000000" cx="5008" cy="-911.2015" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5008" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 127&#45;128</text>
</g>
<!-- section_11&#45;&gt;block_44 -->
<g id="edge44" class="edge">
<title>section_11&#45;&gt;block_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5087.3224,-1043.7582C5071.625,-1017.526 5042.209,-968.3685 5023.9459,-937.849"/>
<polygon fill="#000000" stroke="#000000" points="5026.802,-935.8055 5018.6637,-929.0218 5020.7953,-939.4 5026.802,-935.8055"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="5184" cy="-911.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5184" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 129&#45;151</text>
</g>
<!-- section_11&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_11&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5108.203,-1043.7582C5123.1222,-1017.6671 5151.0096,-968.8964 5168.4804,-938.3428"/>
<polygon fill="#000000" stroke="#000000" points="5171.6165,-939.9092 5173.542,-929.4908 5165.5398,-936.4345 5171.6165,-939.9092"/>
</g>
<!-- block_46 -->
<g id="node47" class="node">
<title>block_46</title>
<ellipse fill="none" stroke="#000000" cx="5505" cy="-911.2015" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5505" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 158&#45;162</text>
</g>
<!-- section_11&#45;&gt;block_46 -->
<g id="edge46" class="edge">
<title>section_11&#45;&gt;block_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5148.7238,-1048.2581C5185.5195,-1038.1666 5236.2919,-1023.3886 5280,-1007.6017 5344.9286,-984.1502 5418.0537,-951.645 5462.8292,-931.019"/>
<polygon fill="#000000" stroke="#000000" points="5464.3331,-934.1797 5471.9404,-926.8055 5461.3948,-927.8262 5464.3331,-934.1797"/>
</g>
<!-- codeblock_47 -->
<g id="node48" class="node">
<title>codeblock_47</title>
<ellipse fill="none" stroke="#000000" cx="5916" cy="-911.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5916" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 163&#45;179</text>
</g>
<!-- section_11&#45;&gt;codeblock_47 -->
<g id="edge47" class="edge">
<title>section_11&#45;&gt;codeblock_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5171.2596,-1057.2333C5266.2371,-1050.6954 5436.6885,-1035.9792 5580,-1007.6017 5680.9324,-987.6158 5795.5509,-951.8189 5861.4553,-929.9204"/>
<polygon fill="#000000" stroke="#000000" points="5862.8352,-933.1496 5871.2113,-926.6618 5860.6176,-926.5102 5862.8352,-933.1496"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2823,-630.501 2769,-630.501 2769,-594.501 2823,-594.501 2823,-630.501"/>
</g>
<!-- header_18&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>header_18&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2796,-892.9661C2796,-842.6607 2796,-701.643 2796,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="2799.5001,-640.8773 2796,-630.8773 2792.5001,-640.8773 2799.5001,-640.8773"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2903,-630.501 2849,-630.501 2849,-594.501 2903,-594.501 2903,-630.501"/>
</g>
<!-- block_19&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_19&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2922.0086,-892.9661C2913.7563,-842.6607 2890.6232,-701.643 2880.6605,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="2884.0872,-640.1788 2879.0145,-630.8773 2877.1796,-641.312 2884.0872,-640.1788"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="3231,-709.6017 2921,-709.6017 2921,-515.4003 3231,-515.4003 3231,-709.6017"/>
<text text-anchor="middle" x="3076" y="-694.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="3076" y="-663.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="3076" y="-647.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="3076" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="3076" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="3076" y="-585.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="3076" y="-554.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="3076" y="-538.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="3076" y="-523.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_20&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3076,-892.9661C3076,-859.0605 3076,-783.9473 3076,-719.9816"/>
<polygon fill="#000000" stroke="#000000" points="3079.5001,-719.8192 3076,-709.8192 3072.5001,-719.8192 3079.5001,-719.8192"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="3303,-630.501 3249,-630.501 3249,-594.501 3303,-594.501 3303,-630.501"/>
</g>
<!-- header_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3274.1221,-892.9661C3274.4589,-842.6607 3275.4031,-701.643 3275.8098,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="3279.3098,-640.9005 3275.877,-630.8773 3272.31,-640.8536 3279.3098,-640.9005"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="3375,-630.501 3321,-630.501 3321,-594.501 3375,-594.501 3375,-630.501"/>
</g>
<!-- block_25&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_25&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3439.328,-893.4114C3424.8497,-868.566 3399.0666,-821.6923 3384,-778.8013 3367.4357,-731.6469 3357.0418,-674.1836 3351.8973,-640.6338"/>
<polygon fill="#000000" stroke="#000000" points="3355.3419,-640.0018 3350.4102,-630.6247 3348.4179,-641.0305 3355.3419,-640.0018"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="3808.5,-763.9018 3393.5,-763.9018 3393.5,-461.1002 3808.5,-461.1002 3808.5,-763.9018"/>
<text text-anchor="middle" x="3601" y="-748.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="3601" y="-733.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="3601" y="-701.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="3601" y="-686.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="3601" y="-670.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3601" y="-639.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="3601" y="-624.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="3601" y="-608.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="3601" y="-593.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="3601" y="-577.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="3601" y="-562.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="3601" y="-547.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3601" y="-531.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="3601" y="-516.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3601" y="-484.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="3601" y="-469.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>codeblock_26&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3601,-892.9661C3601,-868.3694 3601,-822.0862 3601,-774.1048"/>
<polygon fill="#000000" stroke="#000000" points="3604.5001,-773.8475 3601,-763.8475 3597.5001,-773.8476 3604.5001,-773.8475"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3881,-630.501 3827,-630.501 3827,-594.501 3881,-594.501 3881,-630.501"/>
</g>
<!-- header_30&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>header_30&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3838.0378,-892.9661C3840.9009,-842.6607 3848.9266,-701.643 3852.3831,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="3855.8802,-641.0601 3852.9541,-630.8773 3848.8915,-640.6622 3855.8802,-641.0601"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3991,-630.501 3937,-630.501 3937,-594.501 3991,-594.501 3991,-630.501"/>
</g>
<!-- block_31&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_31&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4042.9943,-893.0921C4032.086,-867.8763 4012.4855,-820.5749 4000,-778.8013 3985.7258,-731.043 3974.6283,-673.9925 3968.7214,-640.6484"/>
<polygon fill="#000000" stroke="#000000" points="3972.1522,-639.9485 3966.9885,-630.6972 3965.256,-641.1494 3972.1522,-639.9485"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4319,-701.4018 4009,-701.4018 4009,-523.6002 4319,-523.6002 4319,-701.4018"/>
<text text-anchor="middle" x="4164" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="4164" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="4164" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="4164" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="4164" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4164" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4164" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="4164" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="4164" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="4164" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4164" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>codeblock_32&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4199.6801,-892.9661C4195.1739,-857.545 4184.9463,-777.1501 4176.5913,-711.4756"/>
<polygon fill="#000000" stroke="#000000" points="4180.0546,-710.9642 4175.3205,-701.4859 4173.1105,-711.8477 4180.0546,-710.9642"/>
</g>
<!-- header_37 -->
<g id="node38" class="node">
<title>header_37</title>
<ellipse fill="none" stroke="#000000" cx="4389" cy="-612.501" rx="51.9763" ry="18"/>
<text text-anchor="middle" x="4389" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : toValue</text>
</g>
<!-- section_33&#45;&gt;header_37 -->
<g id="edge37" class="edge">
<title>section_33&#45;&gt;header_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4448.1539,-892.9661C4437.5186,-842.5412 4407.6599,-700.9726 4394.9011,-640.4799"/>
<polygon fill="#000000" stroke="#000000" points="4398.2842,-639.5602 4392.7958,-630.4978 4391.4349,-641.0048 4398.2842,-639.5602"/>
</g>
<!-- block_38 -->
<g id="node39" class="node">
<title>block_38</title>
<ellipse fill="none" stroke="#000000" cx="4515" cy="-612.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4515" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 92&#45;96</text>
</g>
<!-- section_33&#45;&gt;block_38 -->
<g id="edge38" class="edge">
<title>section_33&#45;&gt;block_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4455.8461,-892.9661C4466.4814,-842.5412 4496.3401,-700.9726 4509.0989,-640.4799"/>
<polygon fill="#000000" stroke="#000000" points="4512.5651,-641.0048 4511.2042,-630.4978 4505.7158,-639.5602 4512.5651,-641.0048"/>
</g>
<!-- codeblock_39 -->
<g id="node40" class="node">
<title>codeblock_39</title>
<ellipse fill="none" stroke="#000000" cx="4671" cy="-612.501" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="4671" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 97&#45;124</text>
</g>
<!-- section_33&#45;&gt;codeblock_39 -->
<g id="edge39" class="edge">
<title>section_33&#45;&gt;codeblock_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4471.9141,-893.7693C4498.65,-869.7029 4546.64,-824.1163 4580,-778.8013 4613.3863,-733.4506 4642.7966,-674.4292 4658.6306,-640.2725"/>
<polygon fill="#000000" stroke="#000000" points="4661.9314,-641.4706 4662.9135,-630.9214 4655.5672,-638.5557 4661.9314,-641.4706"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="4310,-223.1004 4256,-223.1004 4256,-187.1004 4310,-187.1004 4310,-223.1004"/>
</g>
<!-- header_37&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>header_37&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4381.7445,-594.663C4367.797,-559.772 4337.0313,-479.8172 4319,-410.2007 4302.8501,-347.8479 4291.7426,-272.9432 4286.4813,-233.1587"/>
<polygon fill="#000000" stroke="#000000" points="4289.9389,-232.6053 4285.1822,-223.1383 4282.997,-233.5053 4289.9389,-232.6053"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="4701.5,-232.4008 4328.5,-232.4008 4328.5,-177.7999 4701.5,-177.7999 4701.5,-232.4008"/>
<text text-anchor="middle" x="4515" y="-201.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="4515" y="-185.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
</g>
<!-- block_38&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>block_38&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4515,-594.4698C4515,-532.5933 4515,-328.0242 4515,-242.8409"/>
<polygon fill="#000000" stroke="#000000" points="4518.5001,-242.5867 4515,-232.5867 4511.5001,-242.5868 4518.5001,-242.5867"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="5086,-410.3011 4720,-410.3011 4720,.1004 5086,.1004 5086,-410.3011"/>
<text text-anchor="middle" x="4903" y="-395.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="4903" y="-379.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4903" y="-364.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="4903" y="-348.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4903" y="-333.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4903" y="-318.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4903" y="-302.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4903" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="4903" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="4903" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="4903" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4903" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="4903" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="4903" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4903" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="4903" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4903" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="4903" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4903" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4903" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="4903" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="4903" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="4903" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_39&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>codeblock_39&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4680.6633,-594.4436C4697.1051,-563.8101 4731.6906,-499.7643 4762,-446.2007 4767.0219,-437.3259 4772.1702,-428.2822 4777.3902,-419.1573"/>
<polygon fill="#000000" stroke="#000000" points="4780.4808,-420.8034 4782.4152,-410.3866 4774.4071,-417.3235 4780.4808,-420.8034"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="4825,-630.501 4771,-630.501 4771,-594.501 4825,-594.501 4825,-630.501"/>
</g>
<!-- header_43&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>header_43&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4806.4506,-892.9661C4804.9348,-842.6607 4800.6859,-701.643 4798.856,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="4802.3534,-640.7673 4798.5537,-630.8773 4795.3565,-640.9782 4802.3534,-640.7673"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4897,-630.501 4843,-630.501 4843,-594.501 4897,-594.501 4897,-630.501"/>
</g>
<!-- block_44&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>block_44&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4990.2516,-893.6562C4967.2003,-869.8154 4927.3897,-824.8551 4906,-778.8013 4884.891,-733.3518 4875.9499,-675.1121 4872.3197,-640.9909"/>
<polygon fill="#000000" stroke="#000000" points="4875.7802,-640.4166 4871.319,-630.8069 4868.8138,-641.1012 4875.7802,-640.4166"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="5463,-778.6018 4915,-778.6018 4915,-446.4002 5463,-446.4002 5463,-778.6018"/>
<text text-anchor="middle" x="5189" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local b = {}</text>
<text text-anchor="middle" x="5189" y="-732.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Block, lines, linum)</text>
<text text-anchor="middle" x="5189" y="-716.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = setmetatable({}, B)</text>
<text text-anchor="middle" x="5189" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.lines = {}</text>
<text text-anchor="middle" x="5189" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.line_first = linum</text>
<text text-anchor="middle" x="5189" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (lines) then </text>
<text text-anchor="middle" x="5189" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(lines) == &quot;string&quot; then</text>
<text text-anchor="middle" x="5189" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(lines)</text>
<text text-anchor="middle" x="5189" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif type(lines) == &quot;table&quot; then</text>
<text text-anchor="middle" x="5189" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, l in ipairs(lines) do</text>
<text text-anchor="middle" x="5189" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(l)</text>
<text text-anchor="middle" x="5189" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5189" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5189" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;Error: in block.new type of `lines` is &quot; .. type(lines))</text>
<text text-anchor="middle" x="5189" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5189" y="-516.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5189" y="-485.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.id = &quot;block&quot;</text>
<text text-anchor="middle" x="5189" y="-469.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="5189" y="-454.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_45&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5184.3052,-892.9661C5184.675,-870.874 5185.3377,-831.287 5186.0508,-788.6882"/>
<polygon fill="#000000" stroke="#000000" points="5189.5503,-788.7428 5186.2182,-778.6856 5182.5512,-788.6255 5189.5503,-788.7428"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="5826.5,-647.7014 5481.5,-647.7014 5481.5,-577.3006 5826.5,-577.3006 5826.5,-647.7014"/>
<text text-anchor="middle" x="5654" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; returns: </text>
<text text-anchor="middle" x="5654" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;1. true for structure, false for prose</text>
<text text-anchor="middle" x="5654" y="-601.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;2. id of structure line or &quot;&quot; for prose</text>
</g>
<!-- block_46&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>block_46&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5514.0963,-892.9661C5537.2086,-846.6328 5598.707,-723.347 5631.9449,-656.7149"/>
<polygon fill="#000000" stroke="#000000" points="5635.1086,-658.2136 5636.4404,-647.7028 5628.8446,-655.0889 5635.1086,-658.2136"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="6169,-732.7015 5845,-732.7015 5845,-492.3005 6169,-492.3005 6169,-732.7015"/>
<text text-anchor="middle" x="6007" y="-717.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function structureOrProse(line)</text>
<text text-anchor="middle" x="6007" y="-702.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_p, line) then</text>
<text text-anchor="middle" x="6007" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tagline&quot;</text>
<text text-anchor="middle" x="6007" y="-671.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.listline_p, line) then</text>
<text text-anchor="middle" x="6007" y="-655.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;listline&quot;</text>
<text text-anchor="middle" x="6007" y="-640.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tableline_p, line) then</text>
<text text-anchor="middle" x="6007" y="-625.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tableline&quot;</text>
<text text-anchor="middle" x="6007" y="-609.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6007" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false, &quot;&quot;</text>
<text text-anchor="middle" x="6007" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6007" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="6007" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__index&quot;] = b</text>
<text text-anchor="middle" x="6007" y="-500.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, b)</text>
</g>
<!-- codeblock_47&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>codeblock_47&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5921.5555,-892.9661C5930.6939,-862.9698 5949.6584,-800.7205 5967.4041,-742.4715"/>
<polygon fill="#000000" stroke="#000000" points="5970.7883,-743.3727 5970.3546,-732.7868 5964.0921,-741.3327 5970.7883,-743.3727"/>
</g>
</g>
</svg>