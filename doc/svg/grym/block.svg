<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5859pt" height="1232pt"
 viewBox="0.00 0.00 5858.50 1231.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1227.6017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1227.6017 5854.5,-1227.6017 5854.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="2360.5" cy="-1205.6017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="2360.5" y="-1201.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 180</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="2360.5" cy="-1133.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2360.5" y="-1129.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;126</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2360.5,-1187.433C2360.5,-1179.7326 2360.5,-1170.576 2360.5,-1162.0183"/>
<polygon fill="#000000" stroke="#000000" points="2364.0001,-1162.0149 2360.5,-1152.015 2357.0001,-1162.015 2364.0001,-1162.0149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1947.5" cy="-1061.6017" rx="75.4657" ry="18"/>
<text text-anchor="middle" x="1947.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Block module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2302.8875,-1124.9292C2237.2758,-1114.8641 2126.9328,-1097.3644 2032.5,-1079.6017 2026.2738,-1078.4306 2019.8027,-1077.1592 2013.3346,-1075.852"/>
<polygon fill="#000000" stroke="#000000" points="2013.7076,-1072.3558 2003.2086,-1073.7777 2012.3027,-1079.2134 2013.7076,-1072.3558"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="2073.5" cy="-1061.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2073.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.4736,-1124.3859C2253.0628,-1115.4631 2177.9023,-1100.2534 2114.5,-1079.6017 2112.2548,-1078.8704 2109.9652,-1078.0592 2107.6733,-1077.1974"/>
<polygon fill="#000000" stroke="#000000" points="2108.9305,-1073.9306 2098.3468,-1073.4445 2106.3174,-1080.4246 2108.9305,-1073.9306"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="2155.5" cy="-1061.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2155.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2316.2453,-1120.2905C2283.0098,-1109.9903 2236.5282,-1094.9381 2196.5,-1079.6017 2194.295,-1078.7569 2192.0361,-1077.8591 2189.767,-1076.9329"/>
<polygon fill="#000000" stroke="#000000" points="2191.069,-1073.6835 2180.4945,-1073.0276 2188.3519,-1080.1347 2191.069,-1073.6835"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="2237.5" cy="-1061.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2237.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.5894,-1117.2638C2313.6209,-1106.1603 2288.5028,-1091.457 2268.8461,-1079.9506"/>
<polygon fill="#000000" stroke="#000000" points="2270.3623,-1076.7826 2259.964,-1074.7513 2266.826,-1082.8237 2270.3623,-1076.7826"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="2319.5" cy="-1061.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2319.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2350.3652,-1115.8039C2345.5632,-1107.3712 2339.7315,-1097.1302 2334.4358,-1087.8305"/>
<polygon fill="#000000" stroke="#000000" points="2337.3667,-1085.9042 2329.3768,-1078.9463 2331.2838,-1089.3681 2337.3667,-1085.9042"/>
</g>
<!-- prose_7 -->
<g id="node8" class="node">
<title>prose_7</title>
<ellipse fill="none" stroke="#000000" cx="2401.5" cy="-1061.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2401.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;prose_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2370.6348,-1115.8039C2375.4368,-1107.3712 2381.2685,-1097.1302 2386.5642,-1087.8305"/>
<polygon fill="#000000" stroke="#000000" points="2389.7162,-1089.3681 2391.6232,-1078.9463 2383.6333,-1085.9042 2389.7162,-1089.3681"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2775.5" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2775.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;50</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2416.0381,-1123.9662C2492.183,-1110.7555 2628.7634,-1087.0596 2709.8669,-1072.9886"/>
<polygon fill="#000000" stroke="#000000" points="2710.7053,-1076.3956 2719.9598,-1071.2376 2709.5086,-1069.4986 2710.7053,-1076.3956"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="3230.5" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3230.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 51&#45;75</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2423.4182,-1128.3947C2580.5493,-1115.3907 2989.542,-1081.543 3157.1906,-1067.6687"/>
<polygon fill="#000000" stroke="#000000" points="3157.7217,-1071.1368 3167.3989,-1066.8238 3157.1443,-1064.1606 3157.7217,-1071.1368"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="3862.5" cy="-1061.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3862.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 76&#45;91</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2425.5212,-1130.4848C2669.1734,-1118.8051 3527.3917,-1077.6655 3787.3325,-1065.2049"/>
<polygon fill="#000000" stroke="#000000" points="3787.6065,-1068.6959 3797.4274,-1064.721 3787.2713,-1061.7039 3787.6065,-1068.6959"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="4801.5" cy="-1061.6017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4801.5" y="-1057.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 127&#45;180</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2425.7909,-1131.6759C2765.674,-1121.6506 4331.625,-1075.4612 4716.0845,-1064.1211"/>
<polygon fill="#000000" stroke="#000000" points="4716.4094,-1067.6131 4726.3018,-1063.8197 4716.203,-1060.6162 4716.4094,-1067.6131"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="499,-946.4019 0,-946.4019 0,-876.0011 499,-876.0011 499,-946.4019"/>
<text text-anchor="middle" x="249.5" y="-915.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A Block is the container for the next level of granularity below</text>
<text text-anchor="middle" x="249.5" y="-899.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a Section. Any Section has a Header and one or more Blocks. Both the</text>
<text text-anchor="middle" x="249.5" y="-884.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Header and the Block may be virtual, that is, without contents.</text>
</g>
<!-- prose_3&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2049.5906,-1049.5047C2043.8072,-1047.1023 2037.5463,-1044.9173 2031.5,-1043.6017 1700.4846,-971.5745 840.1265,-1071.7792 507.5,-1007.6017 447.1828,-995.964 382.4296,-971.7293 332.883,-950.4717"/>
<polygon fill="#000000" stroke="#000000" points="334.0652,-947.1695 323.4981,-946.4029 331.2807,-953.5919 334.0652,-947.1695"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1016,-938.5019 517,-938.5019 517,-883.9011 1016,-883.9011 1016,-938.5019"/>
<text text-anchor="middle" x="766.5" y="-923.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> The most general premise is that Blocks are delineated by blank line</text>
<text text-anchor="middle" x="766.5" y="-908.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> whitespace. </text>
</g>
<!-- prose_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2131.74,-1049.3599C2126.2154,-1047.0284 2120.2614,-1044.9103 2114.5,-1043.6017 1878.1657,-989.9202 1262.2471,-1054.6328 1024.5,-1007.6017 956.9371,-994.2364 883.7283,-965.3942 832.6146,-942.7218"/>
<polygon fill="#000000" stroke="#000000" points="833.8912,-939.4586 823.334,-938.5653 831.0299,-945.8471 833.8912,-939.4586"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1575,-938.402 1034,-938.402 1034,-884.001 1575,-884.001 1575,-938.402"/>
<text text-anchor="middle" x="1304.5" y="-923.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> A paragraph of prose is the simplest block, and the default. &#160;A list with</text>
<text text-anchor="middle" x="1304.5" y="-907.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a tag line is a block also, as is a table. &#160;Most importantly for our short</text>
<text text-anchor="middle" x="1304.5" y="-892.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> path, code blocks are enclosed in blocks as well.</text>
</g>
<!-- prose_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>prose_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.2775,-1049.2852C2207.8783,-1047.0196 2202.0929,-1044.9477 2196.5,-1043.6017 1931.1622,-979.7439 1851.2061,-1060.6625 1583.5,-1007.6017 1511.1503,-993.2616 1431.967,-964.5762 1376.5015,-942.2079"/>
<polygon fill="#000000" stroke="#000000" points="1377.7012,-938.9175 1367.1193,-938.3933 1375.0646,-945.402 1377.7012,-938.9175"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2134,-1007.502 1593,-1007.502 1593,-814.901 2134,-814.901 2134,-1007.502"/>
<text text-anchor="middle" x="1863.5" y="-992.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking needs to identify when it has structure, and when prose, on a </text>
<text text-anchor="middle" x="1863.5" y="-977.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> line&#45;by&#45;line basis. &#160;It must also apply the cling rule to make sure that</text>
<text text-anchor="middle" x="1863.5" y="-961.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> e.g. tags are part of the block indicated by whitespacing. </text>
<text text-anchor="middle" x="1863.5" y="-946.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-930.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking need not, and mostly should not, parse within structure or prose.</text>
<text text-anchor="middle" x="1863.5" y="-915.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> These categories are determined by the beginning of a line, making this</text>
<text text-anchor="middle" x="1863.5" y="-900.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> tractable. </text>
<text text-anchor="middle" x="1863.5" y="-884.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-869.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> The cling rule requires lookahead. LPEG is quite capable of this, as is </text>
<text text-anchor="middle" x="1863.5" y="-853.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> packrat PEG parsing generally. &#160;In the bootstrap implementation, we will</text>
<text text-anchor="middle" x="1863.5" y="-838.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> parse once for ownership, again (in the `lines` array of each Section) for</text>
<text text-anchor="middle" x="1863.5" y="-823.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> blocking, and a final time to parse within blocks. </text>
</g>
<!-- prose_6&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>prose_6&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2294.594,-1049.9342C2289.3385,-1047.6801 2283.7837,-1045.4484 2278.5,-1043.6017 2222.357,-1023.9797 2204.0879,-1025.6014 2143.6544,-1007.8832"/>
<polygon fill="#000000" stroke="#000000" points="2144.5869,-1004.5089 2134.0032,-1004.9961 2142.5807,-1011.2153 2144.5869,-1004.5089"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2651,-946.4019 2152,-946.4019 2152,-876.0011 2651,-876.0011 2651,-946.4019"/>
<text text-anchor="middle" x="2401.5" y="-931.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Grimoire is intended to work, in linear time, as a single&#45;pass PEG</text>
<text text-anchor="middle" x="2401.5" y="-915.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> grammar. &#160;Presently (Feb 2018) I&#39;m intending to prototype that with </text>
<text text-anchor="middle" x="2401.5" y="-900.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> PEGylator and port it to `hammer` with a `quipu` back&#45;end. </text>
</g>
<!-- prose_7&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>prose_7&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2401.5,-1043.4599C2401.5,-1022.1674 2401.5,-986.0696 2401.5,-956.9606"/>
<polygon fill="#000000" stroke="#000000" points="2405.0001,-956.5928 2401.5,-946.5929 2398.0001,-956.5929 2405.0001,-956.5928"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="2723.5" cy="-911.2015" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="2723.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_8&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_8&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2769.2276,-1043.4599C2760.248,-1017.4882 2743.6526,-969.4891 2733.1159,-939.0138"/>
<polygon fill="#000000" stroke="#000000" points="2736.3702,-937.715 2729.7947,-929.4076 2729.7545,-940.0024 2736.3702,-937.715"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="2828.5" cy="-911.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2828.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_8&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2781.893,-1043.4599C2791.0947,-1017.3479 2808.1429,-968.9696 2818.8727,-938.5211"/>
<polygon fill="#000000" stroke="#000000" points="2822.2262,-939.5354 2822.2489,-928.9406 2815.6242,-937.2088 2822.2262,-939.5354"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2956.5" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2956.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 35&#45;48</text>
</g>
<!-- section_8&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2808.4399,-1045.9488C2827.2532,-1036.2312 2850.7532,-1022.7312 2869.5,-1007.6017 2895.4041,-986.6959 2920.3691,-957.8361 2936.8606,-937.1526"/>
<polygon fill="#000000" stroke="#000000" points="2939.7518,-939.1379 2943.1748,-929.1113 2934.2462,-934.8148 2939.7518,-939.1379"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="3154.5" cy="-911.2015" rx="102.5283" ry="18"/>
<text text-anchor="middle" x="3154.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Metatable for Blocks</text>
</g>
<!-- section_9&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_9&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3221.4834,-1043.7582C3208.3558,-1017.7795 3183.8666,-969.3165 3168.4152,-938.7389"/>
<polygon fill="#000000" stroke="#000000" points="3171.3759,-936.8375 3163.7419,-929.4908 3165.1282,-939.9946 3171.3759,-936.8375"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="3307.5" cy="-911.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3307.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3243.7039,-1043.6332C3250.9289,-1033.3706 3259.7552,-1020.094 3266.5,-1007.6017 3278.6405,-985.1157 3289.8053,-958.2728 3297.4081,-938.6295"/>
<polygon fill="#000000" stroke="#000000" points="3300.7586,-939.6657 3301.0455,-929.0748 3294.2166,-937.1752 3300.7586,-939.6657"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="3435.5" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3435.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 53&#45;73</text>
</g>
<!-- section_9&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3271.7835,-1047.5024C3295.5171,-1038.2639 3325.1569,-1024.7252 3348.5,-1007.6017 3375.5003,-987.7955 3400.4572,-958.5199 3416.6522,-937.4312"/>
<polygon fill="#000000" stroke="#000000" points="3419.6105,-939.321 3422.8296,-929.227 3414.0184,-935.1104 3419.6105,-939.321"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="3671.5" cy="-911.2015" rx="140.2419" ry="18"/>
<text text-anchor="middle" x="3671.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parse the prose within a block</text>
</g>
<!-- section_10&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_10&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3840.5899,-1044.3489C3806.7016,-1017.664 3741.4445,-966.2782 3702.6584,-935.7368"/>
<polygon fill="#000000" stroke="#000000" points="3704.3595,-932.6214 3694.3375,-929.1846 3700.0288,-938.121 3704.3595,-932.6214"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="3862.5" cy="-911.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3862.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_10&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3862.5,-1043.4599C3862.5,-1017.6012 3862.5,-969.9061 3862.5,-939.4123"/>
<polygon fill="#000000" stroke="#000000" points="3866.0001,-939.4076 3862.5,-929.4076 3859.0001,-939.4077 3866.0001,-939.4076"/>
</g>
<!-- codeblock_29 -->
<g id="node30" class="node">
<title>codeblock_29</title>
<ellipse fill="none" stroke="#000000" cx="3990.5" cy="-911.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3990.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;90</text>
</g>
<!-- section_10&#45;&gt;codeblock_29 -->
<g id="edge29" class="edge">
<title>section_10&#45;&gt;codeblock_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3877.4337,-1044.0545C3899.9537,-1017.5935 3942.7299,-967.3314 3968.7244,-936.7879"/>
<polygon fill="#000000" stroke="#000000" points="3971.4488,-938.9869 3975.2646,-929.1031 3966.118,-934.4501 3971.4488,-938.9869"/>
</g>
<!-- section_30 -->
<g id="node31" class="node">
<title>section_30</title>
<ellipse fill="none" stroke="#000000" cx="4240.5" cy="-911.2015" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4240.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 92&#45;126</text>
</g>
<!-- section_10&#45;&gt;section_30 -->
<g id="edge30" class="edge">
<title>section_10&#45;&gt;section_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3918.4103,-1052.0199C3962.416,-1043.412 4024.7424,-1028.834 4076.5,-1007.6017 4124.8185,-987.7802 4176.0197,-955.6639 4208.1059,-934.005"/>
<polygon fill="#000000" stroke="#000000" points="4210.3403,-936.7177 4216.6306,-928.1923 4206.3967,-930.9342 4210.3403,-936.7177"/>
</g>
<!-- header_38 -->
<g id="node39" class="node">
<title>header_38</title>
<ellipse fill="none" stroke="#000000" cx="4582.5" cy="-911.2015" rx="99.6298" ry="18"/>
<text text-anchor="middle" x="4582.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor/module</text>
</g>
<!-- section_11&#45;&gt;header_38 -->
<g id="edge38" class="edge">
<title>section_11&#45;&gt;header_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4763.4678,-1045.9685C4741.6238,-1036.2574 4714.1238,-1022.7574 4691.5,-1007.6017 4660.0961,-986.5641 4628.1664,-957.1872 4607.0533,-936.4058"/>
<polygon fill="#000000" stroke="#000000" points="4609.3413,-933.7449 4599.7852,-929.1698 4604.4025,-938.7056 4609.3413,-933.7449"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="4732.5" cy="-911.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4732.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_11&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4792.261,-1043.7173C4786.9314,-1033.2558 4780.1814,-1019.7558 4774.5,-1007.6017 4763.6379,-984.3645 4752.047,-957.5951 4743.7995,-938.1708"/>
<polygon fill="#000000" stroke="#000000" points="4746.9304,-936.5884 4739.8129,-928.7404 4740.4829,-939.314 4746.9304,-936.5884"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="4870.5" cy="-911.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4870.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 129&#45;151</text>
</g>
<!-- section_11&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_11&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4809.823,-1043.4599C4821.79,-1017.3753 4843.9507,-969.0713 4857.9223,-938.6173"/>
<polygon fill="#000000" stroke="#000000" points="4861.1587,-939.9562 4862.1475,-929.4076 4854.7963,-937.0373 4861.1587,-939.9562"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="5172.5" cy="-911.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5172.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_11&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4849.3411,-1047.6286C4882.5751,-1037.5141 4927.6863,-1022.969 4966.5,-1007.6017 5029.0388,-982.841 5099.5598,-948.3496 5139.7502,-928.0403"/>
<polygon fill="#000000" stroke="#000000" points="5141.4783,-931.0883 5148.8117,-923.4415 5138.3103,-924.8461 5141.4783,-931.0883"/>
</g>
<!-- codeblock_42 -->
<g id="node43" class="node">
<title>codeblock_42</title>
<ellipse fill="none" stroke="#000000" cx="5581.5" cy="-911.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5581.5" y="-907.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 163&#45;179</text>
</g>
<!-- section_11&#45;&gt;codeblock_42 -->
<g id="edge42" class="edge">
<title>section_11&#45;&gt;codeblock_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4871.9182,-1055.0974C4954.2964,-1046.8604 5094.5619,-1030.8785 5213.5,-1007.6017 5323.9976,-985.9767 5450.5257,-950.4022 5522.73,-929.0475"/>
<polygon fill="#000000" stroke="#000000" points="5523.9604,-932.3333 5532.5505,-926.1316 5521.9679,-925.6229 5523.9604,-932.3333"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2796.5,-630.501 2742.5,-630.501 2742.5,-594.501 2796.5,-594.501 2796.5,-630.501"/>
</g>
<!-- prose_18&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_18&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2824.8981,-892.9661C2814.9617,-842.6607 2787.1075,-701.643 2775.1117,-640.9113"/>
<polygon fill="#000000" stroke="#000000" points="2778.5012,-640.0095 2773.1297,-630.8773 2771.6339,-641.366 2778.5012,-640.0095"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="3124.5,-709.6017 2814.5,-709.6017 2814.5,-515.4003 3124.5,-515.4003 3124.5,-709.6017"/>
<text text-anchor="middle" x="2969.5" y="-694.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2969.5" y="-663.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="2969.5" y="-647.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="2969.5" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="2969.5" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="2969.5" y="-585.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="2969.5" y="-554.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="2969.5" y="-538.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="2969.5" y="-523.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_19&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2957.2936,-892.9661C2958.7693,-859.0605 2962.0383,-783.9473 2964.8222,-719.9816"/>
<polygon fill="#000000" stroke="#000000" points="2968.3263,-719.9619 2965.2645,-709.8192 2961.3329,-719.6575 2968.3263,-719.9619"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3234.5,-630.501 3180.5,-630.501 3180.5,-594.501 3234.5,-594.501 3234.5,-630.501"/>
</g>
<!-- prose_23&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>prose_23&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3300.9477,-893.3804C3293.4846,-873.7184 3280.4989,-841.3444 3266.5,-814.8013 3257.6427,-798.0072 3250.7335,-796.3561 3243.5,-778.8013 3224.4082,-732.4682 3214.8109,-674.516 3210.5084,-640.6893"/>
<polygon fill="#000000" stroke="#000000" points="3213.9639,-640.1088 3209.2922,-630.5996 3207.0142,-640.9466 3213.9639,-640.1088"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3668,-763.9018 3253,-763.9018 3253,-461.1002 3668,-461.1002 3668,-763.9018"/>
<text text-anchor="middle" x="3460.5" y="-748.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="3460.5" y="-733.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="3460.5" y="-701.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="3460.5" y="-686.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="3460.5" y="-670.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3460.5" y="-639.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="3460.5" y="-624.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="3460.5" y="-608.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="3460.5" y="-593.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="3460.5" y="-577.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="3460.5" y="-562.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="3460.5" y="-547.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3460.5" y="-531.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="3460.5" y="-516.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3460.5" y="-484.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="3460.5" y="-469.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_24&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3437.0262,-892.9661C3439.0849,-868.3694 3442.9586,-822.0862 3446.9744,-774.1048"/>
<polygon fill="#000000" stroke="#000000" points="3450.4866,-774.1046 3447.8329,-763.8475 3443.511,-773.5207 3450.4866,-774.1046"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="3791.5,-630.501 3737.5,-630.501 3737.5,-594.501 3791.5,-594.501 3791.5,-630.501"/>
</g>
<!-- prose_28&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>prose_28&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3855.4107,-893.5551C3847.4353,-874.0462 3833.8453,-841.8054 3820.5,-814.8013 3812.3908,-798.3924 3806.9502,-795.9304 3800.5,-778.8013 3782.887,-732.0285 3772.8305,-674.4424 3768.0355,-640.7655"/>
<polygon fill="#000000" stroke="#000000" points="3771.4838,-640.1488 3766.6606,-630.7156 3764.5484,-641.0977 3771.4838,-640.1488"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="4119.5,-701.4018 3809.5,-701.4018 3809.5,-523.6002 4119.5,-523.6002 4119.5,-701.4018"/>
<text text-anchor="middle" x="3964.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="3964.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="3964.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="3964.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="3964.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3964.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3964.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="3964.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="3964.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="3964.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3964.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_29&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>codeblock_29&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3988.9127,-892.9661C3985.8295,-857.545 3978.8317,-777.1501 3973.1151,-711.4756"/>
<polygon fill="#000000" stroke="#000000" points="3976.5996,-711.1447 3972.2456,-701.4859 3969.626,-711.7517 3976.5996,-711.1447"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="4189.5" cy="-612.501" rx="51.9763" ry="18"/>
<text text-anchor="middle" x="4189.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : toValue</text>
</g>
<!-- section_30&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_30&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4237.3865,-892.9661C4228.777,-842.5412 4204.6056,-700.9726 4194.2771,-640.4799"/>
<polygon fill="#000000" stroke="#000000" points="4197.706,-639.766 4192.5728,-630.4978 4190.8058,-640.9442 4197.706,-639.766"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="4291.5" cy="-612.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4291.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_30&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_30&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4243.6135,-892.9661C4252.223,-842.5412 4276.3944,-700.9726 4286.7229,-640.4799"/>
<polygon fill="#000000" stroke="#000000" points="4290.1942,-640.9442 4288.4272,-630.4978 4283.294,-639.766 4290.1942,-640.9442"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="4424.5" cy="-612.501" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="4424.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 97&#45;124</text>
</g>
<!-- section_30&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_30&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4253.9023,-893.1778C4272.3739,-868.0613 4306.3392,-820.8746 4332.5,-778.8013 4362.2326,-730.9837 4393.2076,-673.0178 4410.556,-639.6828"/>
<polygon fill="#000000" stroke="#000000" points="4413.7876,-641.0536 4415.2808,-630.5646 4407.5724,-637.8331 4413.7876,-641.0536"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4351,-232.4008 3978,-232.4008 3978,-177.7999 4351,-177.7999 4351,-232.4008"/>
<text text-anchor="middle" x="4164.5" y="-201.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="4164.5" y="-185.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
</g>
<!-- prose_34&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>prose_34&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4287.6607,-594.3752C4281.011,-563.641 4266.5167,-499.4506 4250.5,-446.2007 4228.4513,-372.8964 4197.1394,-289.0861 4179.0116,-242.0939"/>
<polygon fill="#000000" stroke="#000000" points="4182.2265,-240.7034 4175.3515,-232.6421 4175.6988,-243.2312 4182.2265,-240.7034"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4735.5,-410.3011 4369.5,-410.3011 4369.5,.1004 4735.5,.1004 4735.5,-410.3011"/>
<text text-anchor="middle" x="4552.5" y="-395.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="4552.5" y="-379.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4552.5" y="-364.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="4552.5" y="-348.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4552.5" y="-333.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4552.5" y="-318.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4552.5" y="-302.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="4552.5" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="4552.5" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="4552.5" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="4552.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="4552.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4552.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="4552.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4552.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="4552.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4552.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="4552.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="4552.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="4552.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_35&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4430.1652,-594.4698C4440.2246,-562.4524 4462.2876,-492.2299 4484.9465,-420.1109"/>
<polygon fill="#000000" stroke="#000000" points="4488.3426,-420.9781 4488.001,-410.3888 4481.6645,-418.8799 4488.3426,-420.9781"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="4578.5,-630.501 4524.5,-630.501 4524.5,-594.501 4578.5,-594.501 4578.5,-630.501"/>
</g>
<!-- prose_39&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>prose_39&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4729.38,-893.0159C4724.7659,-871.4859 4714.1021,-835.8977 4691.5,-814.8013 4655.7426,-781.4261 4619.9495,-815.4008 4587.5,-778.8013 4553.4005,-740.3409 4549.0239,-677.336 4549.7188,-640.9196"/>
<polygon fill="#000000" stroke="#000000" points="4553.2301,-640.6406 4550.0699,-630.5281 4546.2341,-640.4042 4553.2301,-640.6406"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="5144.5,-778.6018 4596.5,-778.6018 4596.5,-446.4002 5144.5,-446.4002 5144.5,-778.6018"/>
<text text-anchor="middle" x="4870.5" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local b = {}</text>
<text text-anchor="middle" x="4870.5" y="-732.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Block, lines, linum)</text>
<text text-anchor="middle" x="4870.5" y="-716.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = setmetatable({}, B)</text>
<text text-anchor="middle" x="4870.5" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.lines = {}</text>
<text text-anchor="middle" x="4870.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.line_first = linum</text>
<text text-anchor="middle" x="4870.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (lines) then </text>
<text text-anchor="middle" x="4870.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(lines) == &quot;string&quot; then</text>
<text text-anchor="middle" x="4870.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(lines)</text>
<text text-anchor="middle" x="4870.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif type(lines) == &quot;table&quot; then</text>
<text text-anchor="middle" x="4870.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, l in ipairs(lines) do</text>
<text text-anchor="middle" x="4870.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(l)</text>
<text text-anchor="middle" x="4870.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4870.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;Error: in block.new type of `lines` is &quot; .. type(lines))</text>
<text text-anchor="middle" x="4870.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-516.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-485.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.id = &quot;block&quot;</text>
<text text-anchor="middle" x="4870.5" y="-469.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="4870.5" y="-454.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4870.5,-892.9661C4870.5,-870.874 4870.5,-831.287 4870.5,-788.6882"/>
<polygon fill="#000000" stroke="#000000" points="4874.0001,-788.6855 4870.5,-778.6856 4867.0001,-788.6856 4874.0001,-788.6855"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="5508,-647.7014 5163,-647.7014 5163,-577.3006 5508,-577.3006 5508,-647.7014"/>
<text text-anchor="middle" x="5335.5" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; returns: </text>
<text text-anchor="middle" x="5335.5" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;1. true for structure, false for prose</text>
<text text-anchor="middle" x="5335.5" y="-601.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;2. id of structure line or &quot;&quot; for prose</text>
</g>
<!-- prose_41&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5181.9681,-893.851C5206.8547,-848.2458 5274.7067,-723.9059 5311.3152,-656.8202"/>
<polygon fill="#000000" stroke="#000000" points="5314.5478,-658.2028 5316.2657,-647.7482 5308.4032,-654.8497 5314.5478,-658.2028"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="5850.5,-732.7015 5526.5,-732.7015 5526.5,-492.3005 5850.5,-492.3005 5850.5,-732.7015"/>
<text text-anchor="middle" x="5688.5" y="-717.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function structureOrProse(line)</text>
<text text-anchor="middle" x="5688.5" y="-702.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tagline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-671.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.listline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-655.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;listline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-640.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tableline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-625.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tableline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-609.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5688.5" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false, &quot;&quot;</text>
<text text-anchor="middle" x="5688.5" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5688.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="5688.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__index&quot;] = b</text>
<text text-anchor="middle" x="5688.5" y="-500.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, b)</text>
</g>
<!-- codeblock_42&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>codeblock_42&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5588.0323,-892.9661C5598.7775,-862.9698 5621.0763,-800.7205 5641.9422,-742.4715"/>
<polygon fill="#000000" stroke="#000000" points="5645.334,-743.3813 5645.4114,-732.7868 5638.7441,-741.0206 5645.334,-743.3813"/>
</g>
</g>
</svg>