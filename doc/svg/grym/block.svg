<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5859pt" height="1248pt"
 viewBox="0.00 0.00 5858.50 1247.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1243.6017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1243.6017 5854.5,-1243.6017 5854.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="2360.5" cy="-1221.6017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="2360.5" y="-1217.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 180</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="2360.5" cy="-1149.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2360.5" y="-1145.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;126</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2360.5,-1203.433C2360.5,-1195.7326 2360.5,-1186.576 2360.5,-1178.0183"/>
<polygon fill="#000000" stroke="#000000" points="2364.0001,-1178.0149 2360.5,-1168.015 2357.0001,-1178.015 2364.0001,-1178.0149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1947.5" cy="-1077.6017" rx="75.4657" ry="18"/>
<text text-anchor="middle" x="1947.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Block module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2302.8875,-1140.9292C2237.2758,-1130.8641 2126.9328,-1113.3644 2032.5,-1095.6017 2026.2738,-1094.4306 2019.8027,-1093.1592 2013.3346,-1091.852"/>
<polygon fill="#000000" stroke="#000000" points="2013.7076,-1088.3558 2003.2086,-1089.7777 2012.3027,-1095.2134 2013.7076,-1088.3558"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="2073.5" cy="-1077.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2073.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.4736,-1140.3859C2253.0628,-1131.4631 2177.9023,-1116.2534 2114.5,-1095.6017 2112.2548,-1094.8704 2109.9652,-1094.0592 2107.6733,-1093.1974"/>
<polygon fill="#000000" stroke="#000000" points="2108.9305,-1089.9306 2098.3468,-1089.4445 2106.3174,-1096.4246 2108.9305,-1089.9306"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="2155.5" cy="-1077.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2155.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2316.2453,-1136.2905C2283.0098,-1125.9903 2236.5282,-1110.9381 2196.5,-1095.6017 2194.295,-1094.7569 2192.0361,-1093.8591 2189.767,-1092.9329"/>
<polygon fill="#000000" stroke="#000000" points="2191.069,-1089.6835 2180.4945,-1089.0276 2188.3519,-1096.1347 2191.069,-1089.6835"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="2237.5" cy="-1077.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2237.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.5894,-1133.2638C2313.6209,-1122.1603 2288.5028,-1107.457 2268.8461,-1095.9506"/>
<polygon fill="#000000" stroke="#000000" points="2270.3623,-1092.7826 2259.964,-1090.7513 2266.826,-1098.8237 2270.3623,-1092.7826"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="2319.5" cy="-1077.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2319.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2350.3652,-1131.8039C2345.5632,-1123.3712 2339.7315,-1113.1302 2334.4358,-1103.8305"/>
<polygon fill="#000000" stroke="#000000" points="2337.3667,-1101.9042 2329.3768,-1094.9463 2331.2838,-1105.3681 2337.3667,-1101.9042"/>
</g>
<!-- prose_7 -->
<g id="node8" class="node">
<title>prose_7</title>
<ellipse fill="none" stroke="#000000" cx="2401.5" cy="-1077.6017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2401.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;prose_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2370.6348,-1131.8039C2375.4368,-1123.3712 2381.2685,-1113.1302 2386.5642,-1103.8305"/>
<polygon fill="#000000" stroke="#000000" points="2389.7162,-1105.3681 2391.6232,-1094.9463 2383.6333,-1101.9042 2389.7162,-1105.3681"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2775.5" cy="-1077.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2775.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 33&#45;50</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2416.0381,-1139.9662C2492.183,-1126.7555 2628.7634,-1103.0596 2709.8669,-1088.9886"/>
<polygon fill="#000000" stroke="#000000" points="2710.7053,-1092.3956 2719.9598,-1087.2376 2709.5086,-1085.4986 2710.7053,-1092.3956"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="3230.5" cy="-1077.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3230.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 51&#45;75</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2423.4182,-1144.3947C2580.5493,-1131.3907 2989.542,-1097.543 3157.1906,-1083.6687"/>
<polygon fill="#000000" stroke="#000000" points="3157.7217,-1087.1368 3167.3989,-1082.8238 3157.1443,-1080.1606 3157.7217,-1087.1368"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="3862.5" cy="-1077.6017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="3862.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 76&#45;91</text>
</g>
<!-- section_1&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2425.5212,-1146.4848C2669.1734,-1134.8051 3527.3917,-1093.6655 3787.3325,-1081.2049"/>
<polygon fill="#000000" stroke="#000000" points="3787.6065,-1084.6959 3797.4274,-1080.721 3787.2713,-1077.7039 3787.6065,-1084.6959"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="4801.5" cy="-1077.6017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4801.5" y="-1073.4017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 127&#45;180</text>
</g>
<!-- section_1&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2425.7909,-1147.6759C2765.674,-1137.6506 4331.625,-1091.4612 4716.0845,-1080.1211"/>
<polygon fill="#000000" stroke="#000000" points="4716.4094,-1083.6131 4726.3018,-1079.8197 4716.203,-1076.6162 4716.4094,-1083.6131"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="499,-962.4018 0,-962.4018 0,-876.0012 499,-876.0012 499,-962.4018"/>
<text text-anchor="middle" x="249.5" y="-915.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A Block is the container for the next level of granularity below</text>
<text text-anchor="middle" x="249.5" y="-899.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a Section. Any Section has a Header and one or more Blocks. Both the</text>
<text text-anchor="middle" x="249.5" y="-884.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Header and the Block may be virtual, that is, without contents.</text>
</g>
<!-- prose_3&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2049.5906,-1065.5047C2043.8072,-1063.1023 2037.5463,-1060.9173 2031.5,-1059.6017 1700.4846,-987.5745 839.2322,-1092.2518 507.5,-1023.6017 450.9344,-1011.8957 390.9373,-988.3565 343.0487,-966.5884"/>
<polygon fill="#000000" stroke="#000000" points="344.4926,-963.4001 333.9446,-962.4053 341.57,-969.7608 344.4926,-963.4001"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1016,-954.5018 517,-954.5018 517,-883.9012 1016,-883.9012 1016,-954.5018"/>
<text text-anchor="middle" x="766.5" y="-923.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> The most general premise is that Blocks are delineated by blank line</text>
<text text-anchor="middle" x="766.5" y="-908.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> whitespace. </text>
</g>
<!-- prose_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2131.74,-1065.3599C2126.2154,-1063.0284 2120.2614,-1060.9103 2114.5,-1059.6017 1878.1657,-1005.9202 1261.5923,-1073.8296 1024.5,-1023.6017 961.4199,-1010.2382 893.9993,-982.4391 843.9035,-958.885"/>
<polygon fill="#000000" stroke="#000000" points="845.2907,-955.6692 834.7561,-954.5408 842.2877,-961.9924 845.2907,-955.6692"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1575,-954.4019 1034,-954.4019 1034,-884.0011 1575,-884.0011 1575,-954.4019"/>
<text text-anchor="middle" x="1304.5" y="-923.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> A paragraph of prose is the simplest block, and the default. &#160;A list with</text>
<text text-anchor="middle" x="1304.5" y="-907.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> a tag line is a block also, as is a table. &#160;Most importantly for our short</text>
<text text-anchor="middle" x="1304.5" y="-892.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> path, code blocks are enclosed in blocks as well.</text>
</g>
<!-- prose_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>prose_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.2775,-1065.2852C2207.8783,-1063.0196 2202.0929,-1060.9477 2196.5,-1059.6017 1931.1622,-995.7439 1850.511,-1080.056 1583.5,-1023.6017 1516.0571,-1009.3422 1443.2105,-981.6298 1388.8702,-958.3389"/>
<polygon fill="#000000" stroke="#000000" points="1390.1975,-955.0998 1379.6297,-954.3446 1387.42,-961.5252 1390.1975,-955.0998"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2134,-1023.502 1593,-1023.502 1593,-814.901 2134,-814.901 2134,-1023.502"/>
<text text-anchor="middle" x="1863.5" y="-992.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking needs to identify when it has structure, and when prose, on a </text>
<text text-anchor="middle" x="1863.5" y="-977.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> line&#45;by&#45;line basis. &#160;It must also apply the cling rule to make sure that</text>
<text text-anchor="middle" x="1863.5" y="-961.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> e.g. tags are part of the block indicated by whitespacing. </text>
<text text-anchor="middle" x="1863.5" y="-946.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-930.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> Blocking need not, and mostly should not, parse within structure or prose.</text>
<text text-anchor="middle" x="1863.5" y="-915.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> These categories are determined by the beginning of a line, making this</text>
<text text-anchor="middle" x="1863.5" y="-900.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> tractable. </text>
<text text-anchor="middle" x="1863.5" y="-884.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1863.5" y="-869.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> The cling rule requires lookahead. LPEG is quite capable of this, as is </text>
<text text-anchor="middle" x="1863.5" y="-853.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> packrat PEG parsing generally. &#160;In the bootstrap implementation, we will</text>
<text text-anchor="middle" x="1863.5" y="-838.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> parse once for ownership, again (in the `lines` array of each Section) for</text>
<text text-anchor="middle" x="1863.5" y="-823.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> blocking, and a final time to parse within blocks. </text>
</g>
<!-- prose_6&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>prose_6&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2294.594,-1065.9342C2289.3385,-1063.6801 2283.7837,-1061.4484 2278.5,-1059.6017 2222.357,-1039.9797 2203.8743,-1042.2869 2143.9078,-1023.9688"/>
<polygon fill="#000000" stroke="#000000" points="2144.9228,-1020.6192 2134.3341,-1020.979 2142.836,-1027.3009 2144.9228,-1020.6192"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2651,-962.4018 2152,-962.4018 2152,-876.0012 2651,-876.0012 2651,-962.4018"/>
<text text-anchor="middle" x="2401.5" y="-931.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Grimoire is intended to work, in linear time, as a single&#45;pass PEG</text>
<text text-anchor="middle" x="2401.5" y="-915.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> grammar. &#160;Presently (Feb 2018) I&#39;m intending to prototype that with </text>
<text text-anchor="middle" x="2401.5" y="-900.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> PEGylator and port it to `hammer` with a `quipu` back&#45;end. </text>
</g>
<!-- prose_7&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>prose_7&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2401.5,-1059.4312C2401.5,-1038.4231 2401.5,-1002.879 2401.5,-972.8338"/>
<polygon fill="#000000" stroke="#000000" points="2405.0001,-972.4687 2401.5,-962.4687 2398.0001,-972.4687 2405.0001,-972.4687"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="2723.5" cy="-919.2015" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="2723.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_8&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_8&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2769.5349,-1059.4312C2760.4839,-1031.8602 2743.2136,-979.2523 2732.5917,-946.8963"/>
<polygon fill="#000000" stroke="#000000" points="2735.84,-945.5695 2729.3955,-937.1601 2729.1892,-947.7529 2735.84,-945.5695"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="2828.5" cy="-919.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2828.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_8&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2781.5798,-1059.4312C2790.8049,-1031.8602 2808.4073,-979.2523 2819.2334,-946.8963"/>
<polygon fill="#000000" stroke="#000000" points="2822.6372,-947.7539 2822.4911,-937.1601 2815.9989,-945.5328 2822.6372,-947.7539"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2956.5" cy="-919.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2956.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 35&#45;48</text>
</g>
<!-- section_8&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2809.11,-1061.9976C2827.9221,-1052.387 2851.1993,-1038.977 2869.5,-1023.6017 2896.9296,-1000.5568 2922.4279,-968.1201 2938.6358,-945.5404"/>
<polygon fill="#000000" stroke="#000000" points="2941.6757,-947.303 2944.582,-937.1145 2935.9564,-943.2668 2941.6757,-947.303"/>
</g>
<!-- header_22 -->
<g id="node23" class="node">
<title>header_22</title>
<ellipse fill="none" stroke="#000000" cx="3154.5" cy="-919.2015" rx="102.5283" ry="18"/>
<text text-anchor="middle" x="3154.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Metatable for Blocks</text>
</g>
<!-- section_9&#45;&gt;header_22 -->
<g id="edge22" class="edge">
<title>section_9&#45;&gt;header_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3221.9296,-1059.7391C3208.7016,-1032.1692 3183.2144,-979.0485 3167.6447,-946.5979"/>
<polygon fill="#000000" stroke="#000000" points="3170.6372,-944.7438 3163.1557,-937.2419 3164.326,-947.7719 3170.6372,-944.7438"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="3307.5" cy="-919.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3307.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3243.8393,-1059.7051C3251.1066,-1049.465 3259.9302,-1036.187 3266.5,-1023.6017 3279.6468,-998.4172 3291.1252,-968.0302 3298.5668,-946.5501"/>
<polygon fill="#000000" stroke="#000000" points="3301.8844,-947.6653 3301.7893,-937.0709 3295.2568,-945.4122 3301.8844,-947.6653"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="3435.5" cy="-919.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3435.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 53&#45;73</text>
</g>
<!-- section_9&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_9&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3272.5953,-1063.6287C3296.319,-1054.5083 3325.6782,-1041.0454 3348.5,-1023.6017 3377.1285,-1001.7196 3402.563,-968.7889 3418.4251,-945.7807"/>
<polygon fill="#000000" stroke="#000000" points="3421.5285,-947.4388 3424.2209,-937.1917 3415.726,-943.5232 3421.5285,-947.4388"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="3671.5" cy="-919.2015" rx="140.2419" ry="18"/>
<text text-anchor="middle" x="3671.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parse the prose within a block</text>
</g>
<!-- section_10&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_10&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3841.6961,-1060.3486C3807.6661,-1032.1268 3739.9945,-976.0054 3701.0152,-943.679"/>
<polygon fill="#000000" stroke="#000000" points="3703.087,-940.8502 3693.1553,-937.1607 3698.6185,-946.2384 3703.087,-940.8502"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="3862.5" cy="-919.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3862.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_10&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3862.5,-1059.4312C3862.5,-1032.1256 3862.5,-980.2627 3862.5,-947.8362"/>
<polygon fill="#000000" stroke="#000000" points="3866.0001,-947.648 3862.5,-937.648 3859.0001,-947.648 3866.0001,-947.648"/>
</g>
<!-- codeblock_29 -->
<g id="node30" class="node">
<title>codeblock_29</title>
<ellipse fill="none" stroke="#000000" cx="3990.5" cy="-919.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3990.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;90</text>
</g>
<!-- section_10&#45;&gt;codeblock_29 -->
<g id="edge29" class="edge">
<title>section_10&#45;&gt;codeblock_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3876.9344,-1059.7391C3899.5012,-1031.8127 3943.2525,-977.6704 3969.3703,-945.3495"/>
<polygon fill="#000000" stroke="#000000" points="3972.359,-947.2196 3975.9219,-937.2419 3966.9144,-942.82 3972.359,-947.2196"/>
</g>
<!-- section_30 -->
<g id="node31" class="node">
<title>section_30</title>
<ellipse fill="none" stroke="#000000" cx="4240.5" cy="-919.2015" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4240.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 92&#45;126</text>
</g>
<!-- section_10&#45;&gt;section_30 -->
<g id="edge30" class="edge">
<title>section_10&#45;&gt;section_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3919.0774,-1068.4409C3963.1738,-1060.0992 4025.3032,-1045.673 4076.5,-1023.6017 4126.5037,-1002.0447 4178.616,-966.1951 4210.32,-942.6289"/>
<polygon fill="#000000" stroke="#000000" points="4212.8105,-945.1354 4218.7022,-936.3298 4208.6052,-939.5394 4212.8105,-945.1354"/>
</g>
<!-- header_38 -->
<g id="node39" class="node">
<title>header_38</title>
<ellipse fill="none" stroke="#000000" cx="4582.5" cy="-919.2015" rx="99.6298" ry="18"/>
<text text-anchor="middle" x="4582.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor/module</text>
</g>
<!-- section_11&#45;&gt;header_38 -->
<g id="edge38" class="edge">
<title>section_11&#45;&gt;header_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4762.724,-1062.0775C4740.889,-1052.4926 4713.644,-1039.0818 4691.5,-1023.6017 4658.457,-1000.5025 4625.7599,-967.458 4604.9286,-944.7666"/>
<polygon fill="#000000" stroke="#000000" points="4607.3836,-942.2635 4598.0741,-937.2054 4602.1974,-946.965 4607.3836,-942.2635"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="4732.5" cy="-919.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4732.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_11&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4791.8783,-1059.2852C4786.5476,-1048.9137 4779.9222,-1035.6441 4774.5,-1023.6017 4762.8671,-997.7654 4750.9348,-967.6954 4742.776,-946.481"/>
<polygon fill="#000000" stroke="#000000" points="4746.0382,-945.2125 4739.1998,-937.1201 4739.4992,-947.7107 4746.0382,-945.2125"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="4870.5" cy="-919.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4870.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 129&#45;151</text>
</g>
<!-- section_11&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_11&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4809.4152,-1059.4312C4821.4772,-1031.7408 4844.5401,-978.7964 4858.6185,-946.4772"/>
<polygon fill="#000000" stroke="#000000" points="4861.8923,-947.7258 4862.6771,-937.1601 4855.4747,-944.9303 4861.8923,-947.7258"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="5172.5" cy="-919.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5172.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_11&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4850.2198,-1063.7963C4883.4522,-1053.862 4928.2106,-1039.4607 4966.5,-1023.6017 5030.1146,-997.2532 5101.0826,-959.274 5140.911,-937.1257"/>
<polygon fill="#000000" stroke="#000000" points="5142.8483,-940.0525 5149.8697,-932.1183 5139.433,-933.9422 5142.8483,-940.0525"/>
</g>
<!-- codeblock_42 -->
<g id="node43" class="node">
<title>codeblock_42</title>
<ellipse fill="none" stroke="#000000" cx="5581.5" cy="-919.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5581.5" y="-915.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 163&#45;179</text>
</g>
<!-- section_11&#45;&gt;codeblock_42 -->
<g id="edge42" class="edge">
<title>section_11&#45;&gt;codeblock_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4872.7416,-1071.4533C4955.2977,-1063.5938 5095.1567,-1048.0077 5213.5,-1023.6017 5325.9365,-1000.4139 5454.3272,-960.9367 5525.8554,-937.743"/>
<polygon fill="#000000" stroke="#000000" points="5527.1386,-941.0062 5535.5634,-934.5818 5524.9711,-934.3502 5527.1386,-941.0062"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2796.5,-630.501 2742.5,-630.501 2742.5,-594.501 2796.5,-594.501 2796.5,-630.501"/>
</g>
<!-- prose_18&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_18&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2824.986,-900.9345C2815.0661,-849.3681 2786.7974,-702.4185 2774.891,-640.5252"/>
<polygon fill="#000000" stroke="#000000" points="2778.3217,-639.8311 2772.9956,-630.6723 2771.4478,-641.1535 2778.3217,-639.8311"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="3124.5,-709.6017 2814.5,-709.6017 2814.5,-515.4003 3124.5,-515.4003 3124.5,-709.6017"/>
<text text-anchor="middle" x="2969.5" y="-694.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2969.5" y="-663.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="2969.5" y="-647.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Codeblock = require &quot;grym/codeblock&quot;</text>
<text text-anchor="middle" x="2969.5" y="-632.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Structure = require &quot;grym/structure&quot;</text>
<text text-anchor="middle" x="2969.5" y="-617.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local Prose = require &quot;grym/prose&quot;</text>
<text text-anchor="middle" x="2969.5" y="-585.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="2969.5" y="-554.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="2969.5" y="-538.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;../lib/util&quot;</text>
<text text-anchor="middle" x="2969.5" y="-523.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local freeze = util.freeze</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_19&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2957.2743,-900.9345C2958.7613,-865.8531 2962.1194,-786.6259 2964.9406,-720.0673"/>
<polygon fill="#000000" stroke="#000000" points="2968.4438,-720.0641 2965.3705,-709.9248 2961.4501,-719.7676 2968.4438,-720.0641"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3234.5,-630.501 3180.5,-630.501 3180.5,-594.501 3234.5,-594.501 3234.5,-630.501"/>
</g>
<!-- prose_23&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>prose_23&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3301.6906,-901.383C3294.5254,-880.228 3281.4441,-844.1213 3266.5,-814.8013 3257.878,-797.8852 3250.7335,-796.3561 3243.5,-778.8013 3224.4082,-732.4682 3214.8109,-674.516 3210.5084,-640.6893"/>
<polygon fill="#000000" stroke="#000000" points="3213.9639,-640.1088 3209.2922,-630.5996 3207.0142,-640.9466 3213.9639,-640.1088"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3668,-763.9018 3253,-763.9018 3253,-461.1002 3668,-461.1002 3668,-763.9018"/>
<text text-anchor="middle" x="3460.5" y="-748.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = setmetatable({}, { __index = Node })</text>
<text text-anchor="middle" x="3460.5" y="-733.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__index = B</text>
<text text-anchor="middle" x="3460.5" y="-701.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">B.__tostring = function(block) </text>
<text text-anchor="middle" x="3460.5" y="-686.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;Block&quot;</text>
<text text-anchor="middle" x="3460.5" y="-670.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3460.5" y="-639.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.addLine(block, line)</text>
<text text-anchor="middle" x="3460.5" y="-624.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_hash_p, line) then</text>
<text text-anchor="middle" x="3460.5" y="-608.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;hashline&quot;)</text>
<text text-anchor="middle" x="3460.5" y="-593.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tagline_handle_p, line) then</text>
<text text-anchor="middle" x="3460.5" y="-577.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = Structure(line, &quot;handleline&quot;)</text>
<text text-anchor="middle" x="3460.5" y="-562.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Eventually Blocks won&#39;t have lines, meantime:</text>
<text text-anchor="middle" x="3460.5" y="-547.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3460.5" y="-531.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines[#block.lines + 1] = line</text>
<text text-anchor="middle" x="3460.5" y="-516.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3460.5" y="-484.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="3460.5" y="-469.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_24&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3436.989,-900.9345C3439.0979,-875.0621 3443.1641,-825.1787 3447.3297,-774.0741"/>
<polygon fill="#000000" stroke="#000000" points="3450.8396,-774.095 3448.1636,-763.8436 3443.8627,-773.5262 3450.8396,-774.095"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="3791.5,-630.501 3737.5,-630.501 3737.5,-594.501 3791.5,-594.501 3791.5,-630.501"/>
</g>
<!-- prose_28&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>prose_28&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3856.167,-901.5509C3848.4597,-880.5574 3834.7063,-844.6059 3820.5,-814.8013 3812.6246,-798.2789 3806.9502,-795.9304 3800.5,-778.8013 3782.887,-732.0285 3772.8305,-674.4424 3768.0355,-640.7655"/>
<polygon fill="#000000" stroke="#000000" points="3771.4838,-640.1488 3766.6606,-630.7156 3764.5484,-641.0977 3771.4838,-640.1488"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="4119.5,-701.4018 3809.5,-701.4018 3809.5,-523.6002 4119.5,-523.6002 4119.5,-701.4018"/>
<text text-anchor="middle" x="3964.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.parseProse(block)</text>
<text text-anchor="middle" x="3964.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] then</text>
<text text-anchor="middle" x="3964.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if block[1].id == &quot;codeblock&quot; then</text>
<text text-anchor="middle" x="3964.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="3964.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3964.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3964.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block[1] = Prose(block)</text>
<text text-anchor="middle" x="3964.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;block.lines = nil</text>
<text text-anchor="middle" x="3964.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]</text>
<text text-anchor="middle" x="3964.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3964.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_29&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>codeblock_29&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3988.9514,-900.9345C3985.8527,-864.3812 3978.6909,-779.8997 3972.9145,-711.7604"/>
<polygon fill="#000000" stroke="#000000" points="3976.3689,-711.0731 3972.0366,-701.4046 3969.3939,-711.6645 3976.3689,-711.0731"/>
</g>
<!-- header_33 -->
<g id="node34" class="node">
<title>header_33</title>
<ellipse fill="none" stroke="#000000" cx="4189.5" cy="-612.501" rx="51.9763" ry="18"/>
<text text-anchor="middle" x="4189.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : toValue</text>
</g>
<!-- section_30&#45;&gt;header_33 -->
<g id="edge33" class="edge">
<title>section_30&#45;&gt;header_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4237.4624,-900.9345C4228.9054,-849.4746 4204.5529,-703.0253 4194.224,-640.9099"/>
<polygon fill="#000000" stroke="#000000" points="4197.6146,-639.9627 4192.5216,-630.6723 4190.7095,-641.111 4197.6146,-639.9627"/>
</g>
<!-- prose_34 -->
<g id="node35" class="node">
<title>prose_34</title>
<ellipse fill="none" stroke="#000000" cx="4291.5" cy="-612.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4291.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_30&#45;&gt;prose_34 -->
<g id="edge34" class="edge">
<title>section_30&#45;&gt;prose_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4243.5376,-900.9345C4252.0946,-849.4746 4276.4471,-703.0253 4286.776,-640.9099"/>
<polygon fill="#000000" stroke="#000000" points="4290.2905,-641.111 4288.4784,-630.6723 4283.3854,-639.9627 4290.2905,-641.111"/>
</g>
<!-- codeblock_35 -->
<g id="node36" class="node">
<title>codeblock_35</title>
<ellipse fill="none" stroke="#000000" cx="4424.5" cy="-612.501" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="4424.5" y="-608.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 97&#45;124</text>
</g>
<!-- section_30&#45;&gt;codeblock_35 -->
<g id="edge35" class="edge">
<title>section_30&#45;&gt;codeblock_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4252.8481,-901.303C4270.9318,-874.8836 4305.4098,-823.7202 4332.5,-778.8013 4361.502,-730.7124 4392.6058,-673.0595 4410.1974,-639.8156"/>
<polygon fill="#000000" stroke="#000000" points="4413.4269,-641.1949 4414.9969,-630.7171 4407.2355,-637.9289 4413.4269,-641.1949"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4351,-240.4007 3978,-240.4007 3978,-169.8 4351,-169.8 4351,-240.4007"/>
<text text-anchor="middle" x="4164.5" y="-193.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Adds a .val field which is the union of all lines.</text>
<text text-anchor="middle" x="4164.5" y="-177.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> Useful in visualization. </text>
</g>
<!-- prose_34&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>prose_34&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4287.6607,-594.3752C4281.011,-563.641 4266.5167,-499.4506 4250.5,-446.2007 4229.6626,-376.9236 4200.5519,-298.2631 4182.1149,-250.1643"/>
<polygon fill="#000000" stroke="#000000" points="4185.3201,-248.7477 4178.4626,-240.6714 4178.787,-251.2613 4185.3201,-248.7477"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4735.5,-410.3011 4369.5,-410.3011 4369.5,.1004 4735.5,.1004 4735.5,-410.3011"/>
<text text-anchor="middle" x="4552.5" y="-395.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toString(block)</text>
<text text-anchor="middle" x="4552.5" y="-379.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4552.5" y="-364.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(block.lines) do</text>
<text text-anchor="middle" x="4552.5" y="-348.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4552.5" y="-333.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4552.5" y="-318.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4552.5" y="-302.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toValue(block)</text>
<text text-anchor="middle" x="4552.5" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.val = block:toString()</text>
<text text-anchor="middle" x="4552.5" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block.val</text>
<text text-anchor="middle" x="4552.5" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.toMarkdown(block)</text>
<text text-anchor="middle" x="4552.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if block[1] and (block[1].id == &quot;codeblock&quot;</text>
<text text-anchor="middle" x="4552.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;or block[1].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4552.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block[1]:toMarkdown()</text>
<text text-anchor="middle" x="4552.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4552.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return block:toString()</text>
<text text-anchor="middle" x="4552.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4552.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4552.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">function B.dotLabel(block)</text>
<text text-anchor="middle" x="4552.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;block &quot; .. tostring(block.line_first) </text>
<text text-anchor="middle" x="4552.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;&#45;&quot; .. tostring(block.line_last)</text>
<text text-anchor="middle" x="4552.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_35&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_35&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4430.1652,-594.4698C4440.2246,-562.4524 4462.2876,-492.2299 4484.9465,-420.1109"/>
<polygon fill="#000000" stroke="#000000" points="4488.3426,-420.9781 4488.001,-410.3888 4481.6645,-418.8799 4488.3426,-420.9781"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="4578.5,-630.501 4524.5,-630.501 4524.5,-594.501 4578.5,-594.501 4578.5,-630.501"/>
</g>
<!-- prose_39&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>prose_39&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4730.099,-901.1509C4726.1005,-878.0624 4715.9442,-838.264 4691.5,-814.8013 4656.212,-780.9302 4619.9495,-815.4008 4587.5,-778.8013 4553.4005,-740.3409 4549.0239,-677.336 4549.7188,-640.9196"/>
<polygon fill="#000000" stroke="#000000" points="4553.2301,-640.6406 4550.0699,-630.5281 4546.2341,-640.4042 4553.2301,-640.6406"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="5144.5,-778.6018 4596.5,-778.6018 4596.5,-446.4002 5144.5,-446.4002 5144.5,-778.6018"/>
<text text-anchor="middle" x="4870.5" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local b = {}</text>
<text text-anchor="middle" x="4870.5" y="-732.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Block, lines, linum)</text>
<text text-anchor="middle" x="4870.5" y="-716.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = setmetatable({}, B)</text>
<text text-anchor="middle" x="4870.5" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.lines = {}</text>
<text text-anchor="middle" x="4870.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.line_first = linum</text>
<text text-anchor="middle" x="4870.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if (lines) then </text>
<text text-anchor="middle" x="4870.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(lines) == &quot;string&quot; then</text>
<text text-anchor="middle" x="4870.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(lines)</text>
<text text-anchor="middle" x="4870.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif type(lines) == &quot;table&quot; then</text>
<text text-anchor="middle" x="4870.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, l in ipairs(lines) do</text>
<text text-anchor="middle" x="4870.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block:addLine(l)</text>
<text text-anchor="middle" x="4870.5" y="-578.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-562.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4870.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;freeze(&quot;Error: in block.new type of `lines` is &quot; .. type(lines))</text>
<text text-anchor="middle" x="4870.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-516.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4870.5" y="-485.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;block.id = &quot;block&quot;</text>
<text text-anchor="middle" x="4870.5" y="-469.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="4870.5" y="-454.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_40&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4870.5,-900.9345C4870.5,-877.5666 4870.5,-834.6114 4870.5,-788.8602"/>
<polygon fill="#000000" stroke="#000000" points="4874.0001,-788.7506 4870.5,-778.7506 4867.0001,-788.7507 4874.0001,-788.7506"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="5508,-655.7013 5163,-655.7013 5163,-569.3007 5508,-569.3007 5508,-655.7013"/>
<text text-anchor="middle" x="5335.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; returns: </text>
<text text-anchor="middle" x="5335.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;1. true for structure, false for prose</text>
<text text-anchor="middle" x="5335.5" y="-593.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;2. id of structure line or &quot;&quot; for prose</text>
</g>
<!-- prose_41&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>prose_41&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5181.7306,-901.8332C5205.6105,-856.9009 5270.1643,-735.4366 5307.6024,-664.9931"/>
<polygon fill="#000000" stroke="#000000" points="5310.8725,-666.2978 5312.475,-655.8249 5304.6913,-663.0127 5310.8725,-666.2978"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="5850.5,-732.7015 5526.5,-732.7015 5526.5,-492.3005 5850.5,-492.3005 5850.5,-732.7015"/>
<text text-anchor="middle" x="5688.5" y="-717.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function structureOrProse(line)</text>
<text text-anchor="middle" x="5688.5" y="-702.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if L.match(m.tagline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-686.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tagline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-671.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.listline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-655.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;listline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-640.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif L.match(m.tableline_p, line) then</text>
<text text-anchor="middle" x="5688.5" y="-625.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return true, &quot;tableline&quot;</text>
<text text-anchor="middle" x="5688.5" y="-609.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5688.5" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false, &quot;&quot;</text>
<text text-anchor="middle" x="5688.5" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5688.5" y="-547.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__call&quot;] = new</text>
<text text-anchor="middle" x="5688.5" y="-532.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">b[&quot;__index&quot;] = b</text>
<text text-anchor="middle" x="5688.5" y="-500.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return setmetatable({}, b)</text>
</g>
<!-- codeblock_42&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>codeblock_42&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5587.8729,-900.9345C5598.7629,-869.7199 5621.8462,-803.5548 5643.16,-742.4617"/>
<polygon fill="#000000" stroke="#000000" points="5646.574,-743.3012 5646.5634,-732.7063 5639.9647,-740.9953 5646.574,-743.3012"/>
</g>
</g>
</svg>