<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5828pt" height="1450pt"
 viewBox="0.00 0.00 5827.50 1449.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1445.8018)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1445.8018 5823.5,-1445.8018 5823.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1663.5" cy="-1423.8018" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1663.5" y="-1419.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 167</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1663.5" cy="-1351.8018" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1663.5" y="-1347.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;137</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1663.5,-1405.6331C1663.5,-1397.9327 1663.5,-1388.7761 1663.5,-1380.2184"/>
<polygon fill="#000000" stroke="#000000" points="1667.0001,-1380.215 1663.5,-1370.215 1660.0001,-1380.2151 1667.0001,-1380.215"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1329.5" cy="-1279.8018" rx="76.9193" ry="18"/>
<text text-anchor="middle" x="1329.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Prose module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1611.679,-1340.6308C1553.6745,-1328.1268 1459.5251,-1307.8311 1396.101,-1294.1589"/>
<polygon fill="#000000" stroke="#000000" points="1396.7089,-1290.7096 1386.1958,-1292.0236 1395.2337,-1297.5524 1396.7089,-1290.7096"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1456.5" cy="-1279.8018" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1456.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1618.694,-1338.5469C1585.0473,-1328.2754 1537.9966,-1313.2345 1497.5,-1297.8018 1495.2935,-1296.9609 1493.0334,-1296.0662 1490.7635,-1295.1422"/>
<polygon fill="#000000" stroke="#000000" points="1492.0638,-1291.8922 1481.4889,-1291.2422 1489.3504,-1298.3449 1492.0638,-1291.8922"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="1579.5" cy="-1279.8018" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1579.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 5&#45;21</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1643.1659,-1334.3726C1632.5142,-1325.2426 1619.3023,-1313.918 1607.6796,-1303.9557"/>
<polygon fill="#000000" stroke="#000000" points="1609.8083,-1301.1706 1599.9379,-1297.32 1605.2528,-1306.4854 1609.8083,-1301.1706"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="1747.5" cy="-1279.8018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1747.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;25</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1683.8341,-1334.3726C1694.4858,-1325.2426 1707.6977,-1313.918 1719.3204,-1303.9557"/>
<polygon fill="#000000" stroke="#000000" points="1721.7472,-1306.4854 1727.0621,-1297.32 1717.1917,-1301.1706 1721.7472,-1306.4854"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-1279.8018" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 27&#45;83</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1724.2866,-1344.9633C1843.2219,-1331.5831 2106.1009,-1302.0092 2232.674,-1287.7697"/>
<polygon fill="#000000" stroke="#000000" points="2233.1058,-1291.2433 2242.6518,-1286.6472 2232.3232,-1284.2872 2233.1058,-1291.2433"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="5176.5" cy="-1279.8018" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5176.5" y="-1275.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 138&#45;167</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1728.9983,-1350.4594C2161.2728,-1341.5998 4601.8669,-1291.5791 5091.109,-1281.5519"/>
<polygon fill="#000000" stroke="#000000" points="5091.3495,-1285.0478 5101.2757,-1281.3435 5091.206,-1278.0493 5091.3495,-1285.0478"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="1393.5,-1132.7031 999.5,-1132.7031 999.5,-1076.9001 1393.5,-1076.9001 1393.5,-1132.7031"/>
<text text-anchor="middle" x="1196.5" y="-1085.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Here we need a proper recursive parser. &#160;Eventually.</text>
</g>
<!-- prose_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.6626,-1265.7766C1394.9732,-1238.3895 1303.9307,-1177.1108 1246.649,-1138.5558"/>
<polygon fill="#000000" stroke="#000000" points="1248.3559,-1135.4857 1238.1056,-1132.8055 1244.4472,-1141.2928 1248.3559,-1135.4857"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1665.5,-1225.8019 1411.5,-1225.8019 1411.5,-983.8013 1665.5,-983.8013 1665.5,-1225.8019"/>
<text text-anchor="middle" x="1538.5" y="-1210.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1179.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1163.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require (&quot;status&quot;)()</text>
<text text-anchor="middle" x="1538.5" y="-1148.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1133.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1117.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1538.5" y="-1102.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1070.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1538.5" y="-1039.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Link = require &quot;grym/link&quot;</text>
<text text-anchor="middle" x="1538.5" y="-992.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Pr, pr = u.inherit(Node)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>codeblock_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1575.2667,-1261.7328C1573.6095,-1254.6592 1571.5564,-1245.896 1569.2742,-1236.1549"/>
<polygon fill="#000000" stroke="#000000" points="1572.6106,-1235.0521 1566.9218,-1226.1141 1565.7952,-1236.6489 1572.6106,-1235.0521"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1811.5,-1122.8016 1683.5,-1122.8016 1683.5,-1086.8016 1811.5,-1086.8016 1811.5,-1122.8016"/>
<text text-anchor="middle" x="1747.5" y="-1101.3016" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = false</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>codeblock_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1747.5,-1261.7328C1747.5,-1231.3425 1747.5,-1169.7657 1747.5,-1133.4361"/>
<polygon fill="#000000" stroke="#000000" points="1751.0001,-1133.0344 1747.5,-1123.0345 1744.0001,-1133.0345 1751.0001,-1133.0344"/>
</g>
<!-- header_11 -->
<g id="node12" class="node">
<title>header_11</title>
<ellipse fill="none" stroke="#000000" cx="1918.5" cy="-1104.8016" rx="88.5398" ry="18"/>
<text text-anchor="middle" x="1918.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Bookend parsing</text>
</g>
<!-- section_6&#45;&gt;header_11 -->
<g id="edge11" class="edge">
<title>section_6&#45;&gt;header_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2242.2203,-1273.2798C2169.6122,-1264.6952 2053.7796,-1248.0475 2016.5,-1225.8018 1978.5418,-1203.1512 1949.0919,-1160.0703 1932.7674,-1131.8992"/>
<polygon fill="#000000" stroke="#000000" points="1935.6958,-1129.9662 1927.7411,-1122.9681 1929.5955,-1133.3994 1935.6958,-1129.9662"/>
</g>
<!-- prose_12 -->
<g id="node13" class="node">
<title>prose_12</title>
<ellipse fill="none" stroke="#000000" cx="2057.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2057.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_12 -->
<g id="edge12" class="edge">
<title>section_6&#45;&gt;prose_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2246.2222,-1270.929C2193.3273,-1261.6596 2119.825,-1245.7011 2098.5,-1225.8018 2072.5879,-1201.622 2063.0498,-1160.4859 2059.5404,-1132.9814"/>
<polygon fill="#000000" stroke="#000000" points="2062.9963,-1132.3842 2058.4374,-1122.8204 2056.0371,-1133.1397 2062.9963,-1132.3842"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="2139.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2139.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>section_6&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2253.1745,-1268.0448C2228.3247,-1259.9148 2199.6461,-1246.6903 2180.5,-1225.8018 2156.8171,-1199.9636 2146.7497,-1159.9191 2142.5127,-1133.0519"/>
<polygon fill="#000000" stroke="#000000" points="2145.9737,-1132.5286 2141.1154,-1123.1133 2139.0418,-1133.5032 2145.9737,-1132.5286"/>
</g>
<!-- prose_14 -->
<g id="node15" class="node">
<title>prose_14</title>
<ellipse fill="none" stroke="#000000" cx="2221.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2221.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;prose_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2287.8998,-1262.3034C2279.4954,-1252.1878 2269.4546,-1238.9017 2262.5,-1225.8018 2246.4834,-1195.6323 2234.8998,-1157.9732 2228.2118,-1132.7532"/>
<polygon fill="#000000" stroke="#000000" points="2231.524,-1131.5793 2225.6466,-1122.7642 2224.744,-1133.3205 2231.524,-1131.5793"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_6&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.5,-1261.7328C2303.5,-1231.3425 2303.5,-1169.7657 2303.5,-1133.4361"/>
<polygon fill="#000000" stroke="#000000" points="2307.0001,-1133.0344 2303.5,-1123.0345 2300.0001,-1133.0345 2307.0001,-1133.0344"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="2385.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2385.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_6&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2319.1002,-1262.3034C2327.5046,-1252.1878 2337.5454,-1238.9017 2344.5,-1225.8018 2360.5166,-1195.6323 2372.1002,-1157.9732 2378.7882,-1132.7532"/>
<polygon fill="#000000" stroke="#000000" points="2382.256,-1133.3205 2381.3534,-1122.7642 2375.476,-1131.5793 2382.256,-1133.3205"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="2711.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2711.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>section_6&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2338.9936,-1264.5778C2416.4305,-1231.3634 2599.7462,-1152.7353 2676.6201,-1119.7624"/>
<polygon fill="#000000" stroke="#000000" points="2678.0724,-1122.9479 2685.883,-1115.7893 2675.313,-1116.5147 2678.0724,-1122.9479"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="3118.5" cy="-1104.8016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3118.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 53&#45;75</text>
</g>
<!-- section_6&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>section_6&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2368.1261,-1276.0919C2455.9849,-1270.1296 2617.6322,-1255.8888 2752.5,-1225.8018 2869.1586,-1199.777 3001.1826,-1151.1714 3070.3523,-1124.159"/>
<polygon fill="#000000" stroke="#000000" points="3071.6571,-1127.4069 3079.6871,-1120.4954 3069.0996,-1120.8908 3071.6571,-1127.4069"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="3682.5" cy="-1104.8016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3682.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;81</text>
</g>
<!-- section_6&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_6&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2368.695,-1277.4889C2547.524,-1270.8907 3043.1633,-1250.8287 3204.5,-1225.8018 3360.0748,-1201.6686 3538.8174,-1149.7611 3627.1465,-1122.4412"/>
<polygon fill="#000000" stroke="#000000" points="3628.4386,-1125.7048 3636.9496,-1119.395 3626.3614,-1119.0201 3628.4386,-1125.7048"/>
</g>
<!-- section_20 -->
<g id="node21" class="node">
<title>section_20</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-1104.8016" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 84&#45;99</text>
</g>
<!-- section_6&#45;&gt;section_20 -->
<g id="edge20" class="edge">
<title>section_6&#45;&gt;section_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2369.2132,-1279.4817C2616.8105,-1277.9494 3493.2541,-1269.4913 3768.5,-1225.8018 3907.7048,-1203.7059 4066.0035,-1150.8006 4143.9189,-1122.8348"/>
<polygon fill="#000000" stroke="#000000" points="4145.2499,-1126.0754 4153.4672,-1119.3877 4142.8729,-1119.4913 4145.2499,-1126.0754"/>
</g>
<!-- header_44 -->
<g id="node45" class="node">
<title>header_44</title>
<ellipse fill="none" stroke="#000000" cx="5058.5" cy="-1104.8016" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="5058.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor</text>
</g>
<!-- section_7&#45;&gt;header_44 -->
<g id="edge44" class="edge">
<title>section_7&#45;&gt;header_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5162.4556,-1262.0765C5154.3574,-1251.668 5144.1074,-1238.168 5135.5,-1225.8018 5113.4267,-1194.0891 5089.8214,-1156.3637 5074.6517,-1131.5668"/>
<polygon fill="#000000" stroke="#000000" points="5077.4633,-1129.4547 5069.2715,-1122.7356 5071.4853,-1133.0966 5077.4633,-1129.4547"/>
</g>
<!-- prose_45 -->
<g id="node46" class="node">
<title>prose_45</title>
<ellipse fill="none" stroke="#000000" cx="5176.5" cy="-1104.8016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5176.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_7&#45;&gt;prose_45 -->
<g id="edge45" class="edge">
<title>section_7&#45;&gt;prose_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5176.5,-1261.7328C5176.5,-1231.3425 5176.5,-1169.7657 5176.5,-1133.4361"/>
<polygon fill="#000000" stroke="#000000" points="5180.0001,-1133.0344 5176.5,-1123.0345 5173.0001,-1133.0345 5180.0001,-1133.0344"/>
</g>
<!-- codeblock_46 -->
<g id="node47" class="node">
<title>codeblock_46</title>
<ellipse fill="none" stroke="#000000" cx="5341.5" cy="-1104.8016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5341.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 140&#45;151</text>
</g>
<!-- section_7&#45;&gt;codeblock_46 -->
<g id="edge46" class="edge">
<title>section_7&#45;&gt;codeblock_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5193.2291,-1262.0588C5222.6302,-1230.8758 5283.6561,-1166.1513 5317.5318,-1130.2224"/>
<polygon fill="#000000" stroke="#000000" points="5320.413,-1132.2686 5324.7266,-1122.5916 5315.3199,-1127.4665 5320.413,-1132.2686"/>
</g>
<!-- codeblock_47 -->
<g id="node48" class="node">
<title>codeblock_47</title>
<ellipse fill="none" stroke="#000000" cx="5580.5" cy="-1104.8016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5580.5" y="-1100.6016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 153&#45;155</text>
</g>
<!-- section_7&#45;&gt;codeblock_47 -->
<g id="edge47" class="edge">
<title>section_7&#45;&gt;codeblock_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5248.8246,-1274.5237C5303.0204,-1268.3186 5377.8007,-1254.8712 5437.5,-1225.8018 5486.1423,-1202.1163 5531.953,-1158.1169 5558.071,-1130.2073"/>
<polygon fill="#000000" stroke="#000000" points="5560.7005,-1132.5188 5564.9014,-1122.7923 5555.5519,-1127.7761 5560.7005,-1132.5188"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-816.8015 0,-816.8015 0,-746.2008 527,-746.2008 527,-816.8015"/>
<text text-anchor="middle" x="263.5" y="-769.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;We need to generate parsers to match sequences of single characters, so</text>
<text text-anchor="middle" x="263.5" y="-754.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">that *bold*, **bold**, ***bold*** etc all work correctly.</text>
</g>
<!-- prose_12&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>prose_12&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2057.3758,-1086.7629C2056.0984,-1059.3493 2049.1967,-1007.8525 2016.5,-983.8015 1950.247,-935.0671 615.4121,-970.9828 536.5,-947.8015 451.0819,-922.709 365.5169,-863.7631 313.53,-823.2442"/>
<polygon fill="#000000" stroke="#000000" points="315.5024,-820.3426 305.4799,-816.9074 311.1727,-825.8429 315.5024,-820.3426"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1079.5,-816.7015 545.5,-816.7015 545.5,-746.3008 1079.5,-746.3008 1079.5,-816.7015"/>
<text text-anchor="middle" x="812.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">Bookends are a fun construct borrowed from the [[LPEG manual][httk://]]]]</text>
<text text-anchor="middle" x="812.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">model for Lua long strings. &#160;The GGG/Pegylator form of a bookend construct</text>
<text text-anchor="middle" x="812.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">is </text>
</g>
<!-- prose_13&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_13&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2139.3203,-1086.3574C2137.9437,-1058.8934 2130.8822,-1007.9045 2098.5,-983.8015 2008.4206,-916.7527 1196.138,-979.7997 1088.5,-947.8015 1002.4785,-922.2294 915.8883,-863.405 863.22,-823.0436"/>
<polygon fill="#000000" stroke="#000000" points="865.1143,-820.084 855.0636,-816.7323 860.8305,-825.6202 865.1143,-820.084"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1401,-816.7015 1098,-816.7015 1098,-746.3008 1401,-746.3008 1401,-816.7015"/>
<text text-anchor="middle" x="1249.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">~#!peg</text>
<text text-anchor="middle" x="1249.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;bookend = &quot;`&quot;:a !&quot;`&quot;:a pattern &#160;&quot;`&quot;:a</text>
<text text-anchor="middle" x="1249.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">~#/peg</text>
</g>
<!-- prose_14&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>prose_14&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2221.2867,-1086.4023C2219.8661,-1058.997 2212.7481,-1008.0837 2180.5,-983.8015 2112.0789,-932.2815 1488.5594,-983.0504 1410.5,-947.8015 1352.8862,-921.7851 1305.285,-864.947 1277.1462,-824.9906"/>
<polygon fill="#000000" stroke="#000000" points="1280.0063,-822.9729 1271.4404,-816.7378 1274.2484,-826.9537 1280.0063,-822.9729"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1967.5,-816.7015 1419.5,-816.7015 1419.5,-746.3008 1967.5,-746.3008 1967.5,-816.7015"/>
<text text-anchor="middle" x="1693.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">The =lpeg= engine doesn&#39;t model this directly but it&#39;s possible to provide</text>
<text text-anchor="middle" x="1693.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">it. &#160;We only need the subset of this where =a= is unique, that is, =pattern=</text>
<text text-anchor="middle" x="1693.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">does not contain =bookend= at any level of expansion. </text>
</g>
<!-- prose_15&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_15&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.0416,-1086.7148C2301.301,-1059.7177 2293.7705,-1009.3304 2262.5,-983.8015 2212.879,-943.2914 2037.137,-968.4524 1976.5,-947.8015 1890.8116,-918.6189 1802.5034,-861.6242 1747.8173,-822.5673"/>
<polygon fill="#000000" stroke="#000000" points="1749.8271,-819.7016 1739.6662,-816.7004 1745.7378,-825.383 1749.8271,-819.7016"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2541,-824.1022 1986,-824.1022 1986,-738.9001 2541,-738.9001 2541,-824.1022"/>
<text text-anchor="middle" x="2263.5" y="-793.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">GGG being a specification format needn&#39;t respect this limitation. &#160;Orb</text>
<text text-anchor="middle" x="2263.5" y="-777.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">does so by design. &#160;It is a simple consquence of the sort of markup we are</text>
<text text-anchor="middle" x="2263.5" y="-762.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">using; there is no need to parse ***bold **inside bold** still bold*** twice,</text>
<text text-anchor="middle" x="2263.5" y="-746.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">and this generalizes to all text styles. </text>
</g>
<!-- prose_16&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>prose_16&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2379.8223,-1087.0621C2372.1689,-1063.3866 2357.9472,-1020.213 2344.5,-983.8015 2325.5105,-932.3828 2302.0706,-874.3675 2285.3003,-833.6921"/>
<polygon fill="#000000" stroke="#000000" points="2288.4549,-832.1615 2281.4012,-824.256 2281.9855,-834.8348 2288.4549,-832.1615"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3107.5,-816.8015 2559.5,-816.8015 2559.5,-746.2008 3107.5,-746.2008 3107.5,-816.8015"/>
<text text-anchor="middle" x="2833.5" y="-785.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">We do have to wire them up so that we don&#39;t cross the streams. &#160;Sans macros.</text>
<text text-anchor="middle" x="2833.5" y="-770.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">By hand. </text>
</g>
<!-- prose_17&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>prose_17&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2718.233,-1086.9591C2736.7918,-1037.7781 2789.1103,-899.1341 2816.4219,-826.7583"/>
<polygon fill="#000000" stroke="#000000" points="2819.8475,-827.5935 2820.1036,-817.0018 2813.2983,-825.1221 2819.8475,-827.5935"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="3667,-947.602 3126,-947.602 3126,-615.4003 3667,-615.4003 3667,-947.602"/>
<text text-anchor="middle" x="3396.5" y="-932.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="3396.5" y="-917.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="3396.5" y="-901.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="3396.5" y="-886.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="3396.5" y="-871.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-839.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="3396.5" y="-824.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local Cg, C, P, Cmt, Cb = L.Cg, L.C, L.P, L.Cmt, L.Cb</text>
<text text-anchor="middle" x="3396.5" y="-808.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="3396.5" y="-793.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="3396.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="3396.5" y="-762.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-747.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="3396.5" y="-731.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="3396.5" y="-716.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-685.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-669.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-654.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-638.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-623.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>codeblock_18&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3133.8425,-1086.9591C3156.3545,-1060.7787 3200.6658,-1009.2468 3246.5762,-955.8552"/>
<polygon fill="#000000" stroke="#000000" points="3249.493,-957.8314 3253.3591,-947.9671 3244.1854,-953.2674 3249.493,-957.8314"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="3904,-808.7016 3685,-808.7016 3685,-754.3007 3904,-754.3007 3904,-808.7016"/>
<text text-anchor="middle" x="3794.5" y="-793.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.toMarkdown(prose)</text>
<text text-anchor="middle" x="3794.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return prose.val</text>
<text text-anchor="middle" x="3794.5" y="-762.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>codeblock_19&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3688.8425,-1086.4933C3706.7055,-1034.9299 3757.6912,-887.7538 3781.7011,-818.4465"/>
<polygon fill="#000000" stroke="#000000" points="3785.0744,-819.4013 3785.0407,-808.8065 3778.46,-817.1099 3785.0744,-819.4013"/>
</g>
<!-- header_29 -->
<g id="node30" class="node">
<title>header_29</title>
<ellipse fill="none" stroke="#000000" cx="3991.5" cy="-781.5012" rx="69.1756" ry="18"/>
<text text-anchor="middle" x="3991.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Link or Raw</text>
</g>
<!-- section_20&#45;&gt;header_29 -->
<g id="edge29" class="edge">
<title>section_20&#45;&gt;header_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4176.2992,-1086.9486C4151.2902,-1058.8077 4102.7046,-1001.7699 4069.5,-947.8015 4041.029,-901.5267 4015.9062,-843.1873 4002.2855,-809.3384"/>
<polygon fill="#000000" stroke="#000000" points="4005.3843,-807.659 3998.4367,-799.6602 3998.8798,-810.2458 4005.3843,-807.659"/>
</g>
<!-- prose_30 -->
<g id="node31" class="node">
<title>prose_30</title>
<ellipse fill="none" stroke="#000000" cx="4110.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4110.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_20&#45;&gt;prose_30 -->
<g id="edge30" class="edge">
<title>section_20&#45;&gt;prose_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4187.6211,-1086.453C4179.8542,-1057.1688 4164.2529,-998.043 4151.5,-947.8015 4139.1552,-899.1676 4125.2714,-842.3958 4117.2407,-809.3434"/>
<polygon fill="#000000" stroke="#000000" points="4120.6082,-808.3783 4114.8484,-799.4859 4113.8056,-810.0293 4120.6082,-808.3783"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_20&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_20&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4192.5,-1086.4933C4192.5,-1032.7008 4192.5,-874.8502 4192.5,-809.9086"/>
<polygon fill="#000000" stroke="#000000" points="4196.0001,-809.6087 4192.5,-799.6087 4189.0001,-809.6088 4196.0001,-809.6087"/>
</g>
<!-- prose_32 -->
<g id="node33" class="node">
<title>prose_32</title>
<ellipse fill="none" stroke="#000000" cx="4274.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4274.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_20&#45;&gt;prose_32 -->
<g id="edge32" class="edge">
<title>section_20&#45;&gt;prose_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4197.3789,-1086.453C4205.1458,-1057.1688 4220.7471,-998.043 4233.5,-947.8015 4245.8448,-899.1676 4259.7286,-842.3958 4267.7593,-809.3434"/>
<polygon fill="#000000" stroke="#000000" points="4271.1944,-810.0293 4270.1516,-799.4859 4264.3918,-808.3783 4271.1944,-810.0293"/>
</g>
<!-- prose_33 -->
<g id="node34" class="node">
<title>prose_33</title>
<ellipse fill="none" stroke="#000000" cx="4591.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4591.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_20&#45;&gt;prose_33 -->
<g id="edge33" class="edge">
<title>section_20&#45;&gt;prose_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4213.6703,-1087.6479C4281.1521,-1032.9689 4491.0877,-862.8629 4565.237,-802.7815"/>
<polygon fill="#000000" stroke="#000000" points="4567.6229,-805.353 4573.1891,-796.3381 4563.216,-799.9143 4567.6229,-805.353"/>
</g>
<!-- section_34 -->
<g id="node35" class="node">
<title>section_34</title>
<ellipse fill="none" stroke="#000000" cx="5042.5" cy="-781.5012" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5042.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 100&#45;137</text>
</g>
<!-- section_20&#45;&gt;section_34 -->
<g id="edge34" class="edge">
<title>section_20&#45;&gt;section_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4233.6599,-1090.7709C4311.7855,-1063.9944 4486.7917,-1003.3187 4632.5,-947.8015 4765.1799,-897.2482 4920.0121,-832.9975 4995.8335,-801.1859"/>
<polygon fill="#000000" stroke="#000000" points="4997.2558,-804.3848 5005.1206,-797.2858 4994.5454,-797.9308 4997.2558,-804.3848"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3259,-571.7012 2704,-571.7012 2704,-501.1005 3259,-501.1005 3259,-571.7012"/>
<text text-anchor="middle" x="2981.5" y="-524.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The prose parser will be a proper recursive grammar. &#160;This calls for some</text>
<text text-anchor="middle" x="2981.5" y="-509.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">enhancements to epnf to allow assignment of Node metatables to matched spans.</text>
</g>
<!-- prose_30&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>prose_30&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4112.2986,-763.4009C4114.6495,-728.4254 4114.1018,-651.7875 4069.5,-615.2009 4035.0598,-586.9498 3312.8378,-583.4917 3268.5,-579.2009 3250.4357,-577.4527 3231.7721,-575.3489 3213.0355,-573.0243"/>
<polygon fill="#000000" stroke="#000000" points="3213.2885,-569.5286 3202.9292,-571.7503 3212.4129,-576.4736 3213.2885,-569.5286"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="3853.5,-563.7012 3277.5,-563.7012 3277.5,-509.1004 3853.5,-509.1004 3853.5,-563.7012"/>
<text text-anchor="middle" x="3565.5" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ve been sloppy with the node constructor interface and will need to go through</text>
<text text-anchor="middle" x="3565.5" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">the whole =grym= directory and fix it into a consistent state. &#160;At some point.</text>
</g>
<!-- prose_31&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4194.0528,-763.4388C4195.9256,-728.8747 4194.5108,-653.4219 4151.5,-615.2009 4103.1227,-572.211 3926.6425,-587.8168 3862.5,-579.2009 3829.7226,-574.798 3794.9376,-569.9469 3761.1563,-565.1405"/>
<polygon fill="#000000" stroke="#000000" points="3761.5785,-561.6654 3751.1846,-563.7189 3760.5905,-568.5953 3761.5785,-561.6654"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4441,-579.0019 3872,-579.0019 3872,-493.7998 4441,-493.7998 4441,-579.0019"/>
<text text-anchor="middle" x="4156.5" y="-548.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">Links give me a chance to design that interface to fit grammatically. For now,</text>
<text text-anchor="middle" x="4156.5" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">we&#39;re going to handroll another Link class, and write a simple either&#45;or parser</text>
<text text-anchor="middle" x="4156.5" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">over prose strings that finds links and puts the rest in a =raw= class, which</text>
<text text-anchor="middle" x="4156.5" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">shouldn&#39;t need an intermediate Node class. </text>
</g>
<!-- prose_32&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>prose_32&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4273.1604,-763.3822C4270.1516,-731.5504 4260.8273,-664.3109 4233.5,-615.2009 4227.9611,-605.2468 4220.832,-595.6595 4213.1525,-586.807"/>
<polygon fill="#000000" stroke="#000000" points="4215.5947,-584.2896 4206.2883,-579.2259 4210.4057,-588.988 4215.5947,-584.2896"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="4958,-564.3023 4459,-564.3023 4459,-508.4993 4958,-508.4993 4958,-564.3023"/>
<text text-anchor="middle" x="4708.5" y="-532.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">This Link class needs to fit the constructor semantics of =epeg.Csp=.</text>
</g>
<!-- prose_33&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>prose_33&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4599.9144,-763.8742C4618.8456,-724.2156 4665.1316,-627.2521 4690.7378,-573.6104"/>
<polygon fill="#000000" stroke="#000000" points="4693.9667,-574.9709 4695.116,-564.4385 4687.6495,-571.9553 4693.9667,-574.9709"/>
</g>
<!-- header_39 -->
<g id="node40" class="node">
<title>header_39</title>
<ellipse fill="none" stroke="#000000" cx="5042.5" cy="-536.4008" rx="66.3205" ry="18"/>
<text text-anchor="middle" x="5042.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : epnf.define</text>
</g>
<!-- section_34&#45;&gt;header_39 -->
<g id="edge39" class="edge">
<title>section_34&#45;&gt;header_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5042.5,-763.4784C5042.5,-721.2503 5042.5,-615.644 5042.5,-564.728"/>
<polygon fill="#000000" stroke="#000000" points="5046.0001,-564.45 5042.5,-554.45 5039.0001,-564.4501 5046.0001,-564.45"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="5158.5" cy="-536.4008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5158.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_34&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_34&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5051.0298,-763.4784C5071.19,-720.8811 5121.8725,-613.7923 5145.7196,-563.405"/>
<polygon fill="#000000" stroke="#000000" points="5148.9999,-564.6556 5150.1142,-554.1195 5142.6727,-561.661 5148.9999,-564.6556"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="5485.5" cy="-536.4008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5485.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 105&#45;135</text>
</g>
<!-- section_34&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>section_34&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5046.2313,-763.4624C5054.3579,-728.9392 5077.0388,-653.5539 5126.5,-615.2009 5168.3604,-582.7416 5306.9212,-559.241 5399.1478,-546.7314"/>
<polygon fill="#000000" stroke="#000000" points="5399.8693,-550.1662 5409.3169,-545.371 5398.941,-543.228 5399.8693,-550.1662"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="5323.5,-264.1007 4803.5,-264.1007 4803.5,-193.5 5323.5,-193.5 5323.5,-264.1007"/>
<text text-anchor="middle" x="5063.5" y="-217.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;I&#39;m blindly following a function&#45;in&#45;function pattern because I vaguely</text>
<text text-anchor="middle" x="5063.5" y="-201.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">remember it mattering.</text>
</g>
<!-- prose_40&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>prose_40&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5152.9818,-518.5334C5138.4503,-471.482 5098.7846,-343.0484 5077.4767,-274.0555"/>
<polygon fill="#000000" stroke="#000000" points="5080.7664,-272.8461 5074.4713,-264.3243 5074.0781,-274.9118 5080.7664,-272.8461"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="5819.5,-457.4013 5341.5,-457.4013 5341.5,-.1995 5819.5,-.1995 5819.5,-457.4013"/>
<text text-anchor="middle" x="5580.5" y="-426.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local _prose_fn = function()</text>
<text text-anchor="middle" x="5580.5" y="-411.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function prose_parse(_ENV)</text>
<text text-anchor="middle" x="5580.5" y="-395.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;START &quot;prose&quot;</text>
<text text-anchor="middle" x="5580.5" y="-380.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local raw_patt = (P(1) &#45; m.link)^1</text>
<text text-anchor="middle" x="5580.5" y="-364.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;prose = (V&quot;raw&quot; + V&quot;link&quot;)^1</text>
<text text-anchor="middle" x="5580.5" y="-349.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;raw = Csp(raw_patt)</text>
<text text-anchor="middle" x="5580.5" y="-334.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;link = Csp(m.link)</text>
<text text-anchor="middle" x="5580.5" y="-318.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-287.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose_parse</text>
<text text-anchor="middle" x="5580.5" y="-271.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5580.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.parse(prose)</text>
<text text-anchor="middle" x="5580.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local parser = epnf.define(_prose_fn())</text>
<text text-anchor="middle" x="5580.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local parsed = L.match(parser, prose.val, 1, &quot;truth&quot;, prose.val)</text>
<text text-anchor="middle" x="5580.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if parsed then</text>
<text text-anchor="middle" x="5580.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(parsed) do</text>
<text text-anchor="middle" x="5580.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if v.id == &quot;link&quot; then</text>
<text text-anchor="middle" x="5580.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;link: &quot;..v.val)</text>
<text text-anchor="middle" x="5580.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="5580.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&#39;no parse\n&#39;)</text>
<text text-anchor="middle" x="5580.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5580.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return prose</text>
<text text-anchor="middle" x="5580.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_41&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5491.1582,-518.0802C5494.9685,-505.7426 5500.4603,-487.961 5506.8746,-467.1921"/>
<polygon fill="#000000" stroke="#000000" points="5510.2771,-468.0358 5509.8839,-457.4483 5503.5888,-465.9701 5510.2771,-468.0358"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="5189.5,-799.5012 5135.5,-799.5012 5135.5,-763.5012 5189.5,-763.5012 5189.5,-799.5012"/>
</g>
<!-- prose_45&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>prose_45&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5175.7072,-1086.4933C5173.3778,-1032.7008 5166.5423,-874.8502 5163.7301,-809.9086"/>
<polygon fill="#000000" stroke="#000000" points="5167.2136,-809.4479 5163.2841,-799.6087 5160.2201,-809.7508 5167.2136,-809.4479"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="5503.5,-862.6019 5207.5,-862.6019 5207.5,-700.4004 5503.5,-700.4004 5503.5,-862.6019"/>
<text text-anchor="middle" x="5355.5" y="-847.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Prose, block)</text>
<text text-anchor="middle" x="5355.5" y="-832.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prose = setmetatable({},Pr)</text>
<text text-anchor="middle" x="5355.5" y="-816.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.id = &quot;prose&quot;</text>
<text text-anchor="middle" x="5355.5" y="-801.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.val = &quot;\n&quot;</text>
<text text-anchor="middle" x="5355.5" y="-786.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,l in ipairs(block.lines) do</text>
<text text-anchor="middle" x="5355.5" y="-770.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose.val = prose.val .. l .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5355.5" y="-755.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5355.5" y="-723.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose:parse()</text>
<text text-anchor="middle" x="5355.5" y="-708.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_46&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_46&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5342.2928,-1086.4933C5344.0386,-1046.1787 5348.3153,-947.4176 5351.5325,-873.122"/>
<polygon fill="#000000" stroke="#000000" points="5355.0431,-872.9517 5351.9791,-862.8096 5348.0496,-872.6488 5355.0431,-872.9517"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="5705.5,-799.5012 5521.5,-799.5012 5521.5,-763.5012 5705.5,-763.5012 5705.5,-799.5012"/>
<text text-anchor="middle" x="5613.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(pr, new)</text>
</g>
<!-- codeblock_47&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_47&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5582.3688,-1086.4933C5587.8595,-1032.7008 5603.9717,-874.8502 5610.6004,-809.9086"/>
<polygon fill="#000000" stroke="#000000" points="5614.1181,-809.9125 5611.6517,-799.6087 5607.1543,-809.2016 5614.1181,-809.9125"/>
</g>
</g>
</svg>