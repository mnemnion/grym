<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4796pt" height="1249pt"
 viewBox="0.00 0.00 4795.50 1249.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1245.0014)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1245.0014 4791.5,-1245.0014 4791.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1435.5" cy="-1223.0014" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1435.5" y="-1218.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 150</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1435.5" cy="-1151.0014" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1435.5" y="-1146.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;120</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.5,-1204.8328C1435.5,-1197.1324 1435.5,-1187.9758 1435.5,-1179.418"/>
<polygon fill="#000000" stroke="#000000" points="1439.0001,-1179.4146 1435.5,-1169.4147 1432.0001,-1179.4147 1439.0001,-1179.4146"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1101.5" cy="-1079.0014" rx="76.9193" ry="18"/>
<text text-anchor="middle" x="1101.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Prose module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1383.679,-1139.8304C1325.6745,-1127.3264 1231.5251,-1107.0308 1168.101,-1093.3585"/>
<polygon fill="#000000" stroke="#000000" points="1168.7089,-1089.9092 1158.1958,-1091.2233 1167.2337,-1096.752 1168.7089,-1089.9092"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1228.5" cy="-1079.0014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1228.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390.694,-1137.7465C1357.0473,-1127.4751 1309.9966,-1112.4341 1269.5,-1097.0014 1267.2935,-1096.1605 1265.0334,-1095.2658 1262.7635,-1094.3418"/>
<polygon fill="#000000" stroke="#000000" points="1264.0638,-1091.0918 1253.4889,-1090.4418 1261.3504,-1097.5445 1264.0638,-1091.0918"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="1351.5" cy="-1079.0014" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1351.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 5&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1415.1659,-1133.5722C1404.5142,-1124.4422 1391.3023,-1113.1177 1379.6796,-1103.1553"/>
<polygon fill="#000000" stroke="#000000" points="1381.8083,-1100.3702 1371.9379,-1096.5196 1377.2528,-1105.685 1381.8083,-1100.3702"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="1519.5" cy="-1079.0014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1519.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 26&#45;28</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1455.8341,-1133.5722C1466.4858,-1124.4422 1479.6977,-1113.1177 1491.3204,-1103.1553"/>
<polygon fill="#000000" stroke="#000000" points="1493.7472,-1105.685 1499.0621,-1096.5196 1489.1917,-1100.3702 1493.7472,-1105.685"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="2082.5" cy="-1079.0014" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2082.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 30&#45;94</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1496.3682,-1144.2278C1616.4297,-1130.867 1883.1946,-1101.1807 2011.231,-1086.9324"/>
<polygon fill="#000000" stroke="#000000" points="2011.7707,-1090.3941 2021.3222,-1085.8094 2010.9964,-1083.437 2011.7707,-1090.3941"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="4275.5" cy="-1079.0014" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4275.5" y="-1074.8014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 121&#45;150</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1501.1777,-1149.3363C1878.1119,-1139.7803 3764.4149,-1091.9585 4190.0679,-1081.1673"/>
<polygon fill="#000000" stroke="#000000" points="4190.2407,-1084.6641 4200.1488,-1080.9117 4190.0633,-1077.6664 4190.2407,-1084.6641"/>
</g>
<!-- raw_8 -->
<g id="node9" class="node">
<title>raw_8</title>
<ellipse fill="none" stroke="#000000" cx="1103.5" cy="-880.9012" rx="27" ry="18"/>
<text text-anchor="middle" x="1103.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;raw_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1204.3937,-1067.05C1181.1077,-1055.052 1148.1315,-1036.7132 1139.5,-1025.0014 1114.1829,-990.6495 1106.5539,-940.4934 1104.3241,-909.321"/>
<polygon fill="#000000" stroke="#000000" points="1107.8073,-908.9269 1103.7404,-899.1437 1100.8188,-909.3278 1107.8073,-908.9269"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="1430.5,-1025.1017 1148.5,-1025.1017 1148.5,-736.7007 1430.5,-736.7007 1430.5,-1025.1017"/>
<text text-anchor="middle" x="1289.5" y="-1009.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1289.5" y="-978.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="1289.5" y="-963.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require (&quot;status&quot;)()</text>
<text text-anchor="middle" x="1289.5" y="-947.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1289.5" y="-932.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1289.5" y="-916.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1289.5" y="-901.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
<text text-anchor="middle" x="1289.5" y="-870.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1289.5" y="-838.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local Link = require &quot;grym/link&quot;</text>
<text text-anchor="middle" x="1289.5" y="-823.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">assert(type(Link) == &#39;function&#39;)</text>
<text text-anchor="middle" x="1289.5" y="-807.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Grammar = require &quot;node/grammar&quot;</text>
<text text-anchor="middle" x="1289.5" y="-760.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Pr, pr = u.inherit(Node)</text>
<text text-anchor="middle" x="1289.5" y="-745.001" font-family="Inconsolata" font-size="14.00" fill="#000000">Pr.id = &quot;prose&quot;</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>codeblock_4&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1345.7783,-1060.7197C1343.552,-1053.6062 1340.7875,-1044.7731 1337.6877,-1034.8688"/>
<polygon fill="#000000" stroke="#000000" points="1340.9468,-1033.564 1334.6197,-1025.0659 1334.2664,-1035.6549 1340.9468,-1033.564"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="1590.5,-898.9012 1448.5,-898.9012 1448.5,-862.9012 1590.5,-862.9012 1590.5,-898.9012"/>
<text text-anchor="middle" x="1519.5" y="-877.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = false &#160;</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>codeblock_5&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1519.5,-1060.7197C1519.5,-1026.0766 1519.5,-950.6466 1519.5,-909.3411"/>
<polygon fill="#000000" stroke="#000000" points="1523.0001,-909.1387 1519.5,-899.1387 1516.0001,-909.1388 1523.0001,-909.1387"/>
</g>
<!-- header_12 -->
<g id="node13" class="node">
<title>header_12</title>
<ellipse fill="none" stroke="#000000" cx="1697.5" cy="-880.9012" rx="88.5398" ry="18"/>
<text text-anchor="middle" x="1697.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Bookend parsing</text>
</g>
<!-- section_6&#45;&gt;header_12 -->
<g id="edge12" class="edge">
<title>section_6&#45;&gt;header_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2020.5846,-1072.9494C1947.6367,-1064.8654 1831.7653,-1048.7494 1795.5,-1025.0014 1752.1476,-996.6124 1722.9367,-941.7051 1708.3509,-908.4729"/>
<polygon fill="#000000" stroke="#000000" points="1711.4212,-906.7482 1704.2943,-898.9087 1704.9769,-909.4815 1711.4212,-906.7482"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="1836.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1836.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>section_6&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2024.7538,-1070.3125C1971.7151,-1061.2066 1898.2931,-1045.3902 1877.5,-1025.0014 1846.298,-994.4061 1838.3917,-941.9045 1836.6428,-909.4274"/>
<polygon fill="#000000" stroke="#000000" points="1840.1333,-909.1035 1836.2611,-899.2417 1833.1382,-909.3658 1840.1333,-909.1035"/>
</g>
<!-- prose_14 -->
<g id="node15" class="node">
<title>prose_14</title>
<ellipse fill="none" stroke="#000000" cx="1918.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1918.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;prose_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2031.4331,-1067.5322C2006.5396,-1059.4964 1978.0467,-1046.2695 1959.5,-1025.0014 1931.0567,-992.3846 1922.267,-941.2955 1919.5986,-909.5234"/>
<polygon fill="#000000" stroke="#000000" points="1923.0635,-908.89 1918.8879,-899.1527 1916.0799,-909.3687 1923.0635,-908.89"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="2000.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2000.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_6&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2066.2422,-1061.1509C2057.8463,-1051.1363 2048.023,-1038.0588 2041.5,-1025.0014 2022.5546,-987.0776 2011.114,-939.0342 2005.3014,-909.1284"/>
<polygon fill="#000000" stroke="#000000" points="2008.6838,-908.1731 2003.4111,-898.9834 2001.8022,-909.4554 2008.6838,-908.1731"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="2082.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2082.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_6&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2082.5,-1060.7197C2082.5,-1026.0766 2082.5,-950.6466 2082.5,-909.3411"/>
<polygon fill="#000000" stroke="#000000" points="2086.0001,-909.1387 2082.5,-899.1387 2079.0001,-909.1388 2086.0001,-909.1387"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="2164.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2164.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>section_6&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2098.7578,-1061.1509C2107.1537,-1051.1363 2116.977,-1038.0588 2123.5,-1025.0014 2142.4454,-987.0776 2153.886,-939.0342 2159.6986,-909.1284"/>
<polygon fill="#000000" stroke="#000000" points="2163.1978,-909.4554 2161.5889,-898.9834 2156.3162,-908.1731 2163.1978,-909.4554"/>
</g>
<!-- prose_18 -->
<g id="node19" class="node">
<title>prose_18</title>
<ellipse fill="none" stroke="#000000" cx="2246.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2246.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_18 -->
<g id="edge18" class="edge">
<title>section_6&#45;&gt;prose_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2133.5669,-1067.5322C2158.4604,-1059.4964 2186.9533,-1046.2695 2205.5,-1025.0014 2233.9433,-992.3846 2242.733,-941.2955 2245.4014,-909.5234"/>
<polygon fill="#000000" stroke="#000000" points="2248.9201,-909.3687 2246.1121,-899.1527 2241.9365,-908.89 2248.9201,-909.3687"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2466.5" cy="-880.9012" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2466.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 56&#45;78</text>
</g>
<!-- section_6&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_6&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2140.4981,-1070.4299C2182.8783,-1062.5998 2240.85,-1048.5621 2287.5,-1025.0014 2349.4797,-993.6984 2409.9211,-938.3528 2442.2675,-906.1253"/>
<polygon fill="#000000" stroke="#000000" points="2444.9327,-908.4083 2449.4916,-898.8444 2439.9636,-903.478 2444.9327,-908.4083"/>
</g>
<!-- codeblock_20 -->
<g id="node21" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="2869.5" cy="-880.9012" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2869.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 80&#45;92</text>
</g>
<!-- section_6&#45;&gt;codeblock_20 -->
<g id="edge20" class="edge">
<title>section_6&#45;&gt;codeblock_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2145.9865,-1074.173C2256.0044,-1065.3951 2477.5083,-1045.7981 2552.5,-1025.0014 2658.394,-995.6349 2773.7326,-935.3191 2831.7131,-902.812"/>
<polygon fill="#000000" stroke="#000000" points="2833.5283,-905.8065 2840.5159,-897.8425 2830.087,-899.7107 2833.5283,-905.8065"/>
</g>
<!-- section_21 -->
<g id="node22" class="node">
<title>section_21</title>
<ellipse fill="none" stroke="#000000" cx="3714.5" cy="-880.9012" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3714.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 95&#45;120</text>
</g>
<!-- section_6&#45;&gt;section_21 -->
<g id="edge21" class="edge">
<title>section_6&#45;&gt;section_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2148.1969,-1077.7585C2294.0021,-1074.3834 2655.4723,-1062.6099 2955.5,-1025.0014 3216.5919,-992.2735 3523.2667,-925.0779 3652.3194,-895.4647"/>
<polygon fill="#000000" stroke="#000000" points="3653.4486,-898.7964 3662.4089,-893.1429 3651.8787,-891.9747 3653.4486,-898.7964"/>
</g>
<!-- header_49 -->
<g id="node50" class="node">
<title>header_49</title>
<ellipse fill="none" stroke="#000000" cx="4157.5" cy="-880.9012" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="4157.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor</text>
</g>
<!-- section_7&#45;&gt;header_49 -->
<g id="edge49" class="edge">
<title>section_7&#45;&gt;header_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4260.712,-1061.0281C4252.5618,-1050.764 4242.5045,-1037.4875 4234.5,-1025.0014 4209.4683,-985.9548 4184.9993,-937.999 4170.5866,-908.4453"/>
<polygon fill="#000000" stroke="#000000" points="4173.6039,-906.6452 4166.098,-899.1677 4167.3026,-909.6939 4173.6039,-906.6452"/>
</g>
<!-- prose_50 -->
<g id="node51" class="node">
<title>prose_50</title>
<ellipse fill="none" stroke="#000000" cx="4275.5" cy="-880.9012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4275.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_7&#45;&gt;prose_50 -->
<g id="edge50" class="edge">
<title>section_7&#45;&gt;prose_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4275.5,-1060.7197C4275.5,-1026.0766 4275.5,-950.6466 4275.5,-909.3411"/>
<polygon fill="#000000" stroke="#000000" points="4279.0001,-909.1387 4275.5,-899.1387 4272.0001,-909.1388 4279.0001,-909.1387"/>
</g>
<!-- codeblock_51 -->
<g id="node52" class="node">
<title>codeblock_51</title>
<ellipse fill="none" stroke="#000000" cx="4435.5" cy="-880.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4435.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 125&#45;134</text>
</g>
<!-- section_7&#45;&gt;codeblock_51 -->
<g id="edge51" class="edge">
<title>section_7&#45;&gt;codeblock_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4289.9811,-1061.0719C4318.408,-1025.8759 4381.6063,-947.6284 4414.5742,-906.81"/>
<polygon fill="#000000" stroke="#000000" points="4417.3758,-908.9116 4420.9363,-898.9329 4411.9302,-904.5132 4417.3758,-908.9116"/>
</g>
<!-- codeblock_52 -->
<g id="node53" class="node">
<title>codeblock_52</title>
<ellipse fill="none" stroke="#000000" cx="4667.5" cy="-880.9012" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4667.5" y="-876.7012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 136&#45;138</text>
</g>
<!-- section_7&#45;&gt;codeblock_52 -->
<g id="edge52" class="edge">
<title>section_7&#45;&gt;codeblock_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4340.7195,-1069.7854C4405.418,-1059.8419 4499.4096,-1042.9978 4531.5,-1025.0014 4583.334,-995.9327 4627.1439,-940.4736 4650.1543,-907.4804"/>
<polygon fill="#000000" stroke="#000000" points="4653.327,-909.0412 4656.0822,-898.8109 4647.5487,-905.0901 4653.327,-909.0412"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="1300.5,-562.4022 906.5,-562.4022 906.5,-506.5992 1300.5,-506.5992 1300.5,-562.4022"/>
<text text-anchor="middle" x="1103.5" y="-515.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Here we need a proper recursive parser. &#160;Eventually.</text>
</g>
<!-- raw_8&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>raw_8&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1103.5,-862.7649C1103.5,-808.6304 1103.5,-647.3618 1103.5,-572.9292"/>
<polygon fill="#000000" stroke="#000000" points="1107.0001,-572.6004 1103.5,-562.6004 1100.0001,-572.6005 1107.0001,-572.6004"/>
</g>
<!-- raw_22 -->
<g id="node23" class="node">
<title>raw_22</title>
<ellipse fill="none" stroke="#000000" cx="1406.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1406.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_13&#45;&gt;raw_22 -->
<g id="edge22" class="edge">
<title>prose_13&#45;&gt;raw_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1837.2584,-862.4884C1837.4391,-831.2995 1832.8225,-768.3951 1795.5,-736.801 1685.5899,-643.7603 1588.1756,-787.9004 1473.5,-700.801 1429.7326,-667.5584 1414.4669,-601.0594 1409.2072,-562.994"/>
<polygon fill="#000000" stroke="#000000" points="1412.6243,-562.1072 1407.9243,-552.612 1405.6772,-562.9657 1412.6243,-562.1072"/>
</g>
<!-- raw_24 -->
<g id="node25" class="node">
<title>raw_24</title>
<ellipse fill="none" stroke="#000000" cx="1509.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1509.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_14&#45;&gt;raw_24 -->
<g id="edge24" class="edge">
<title>prose_14&#45;&gt;raw_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1919.2584,-862.4884C1919.4391,-831.2995 1914.8225,-768.3951 1877.5,-736.801 1767.5899,-643.7603 1665.0679,-794.2443 1555.5,-700.801 1515.3589,-666.5673 1508.6773,-600.7299 1508.416,-562.9743"/>
<polygon fill="#000000" stroke="#000000" points="1511.9183,-562.7001 1508.5003,-552.6718 1504.9185,-562.6428 1511.9183,-562.7001"/>
</g>
<!-- link_25 -->
<g id="node26" class="node">
<title>link_25</title>
<ellipse fill="none" stroke="#000000" cx="1647.5" cy="-534.5007" rx="83.1925" ry="18"/>
<text text-anchor="middle" x="1647.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">link: LPEG manual</text>
</g>
<!-- prose_14&#45;&gt;link_25 -->
<g id="edge25" class="edge">
<title>prose_14&#45;&gt;link_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1916.6592,-862.7197C1913.0556,-834.0049 1903.0554,-777.2659 1877.5,-736.801 1826.9008,-656.6814 1735.3068,-590.0835 1684.303,-557.0013"/>
<polygon fill="#000000" stroke="#000000" points="1686.1825,-554.0488 1675.8745,-551.6002 1682.4057,-559.9425 1686.1825,-554.0488"/>
</g>
<!-- raw_26 -->
<g id="node27" class="node">
<title>raw_26</title>
<ellipse fill="none" stroke="#000000" cx="1897.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1897.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_14&#45;&gt;raw_26 -->
<g id="edge26" class="edge">
<title>prose_14&#45;&gt;raw_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1917.4005,-862.7649C1913.9639,-806.0774 1903.4054,-631.9123 1899.2276,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="1902.7127,-562.6452 1898.6139,-552.8754 1895.7256,-563.0689 1902.7127,-562.6452"/>
</g>
<!-- raw_30 -->
<g id="node31" class="node">
<title>raw_30</title>
<ellipse fill="none" stroke="#000000" cx="1989.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1989.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_15&#45;&gt;raw_30 -->
<g id="edge30" class="edge">
<title>prose_15&#45;&gt;raw_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1999.9241,-862.7649C1998.124,-806.0774 1992.5933,-631.9123 1990.4049,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="1993.8992,-562.7592 1990.0835,-552.8754 1986.9027,-562.9814 1993.8992,-562.7592"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2087.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="2087.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_16&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_16&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2082.7618,-862.7649C2083.58,-806.0774 2086.0939,-631.9123 2087.0887,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="2090.59,-562.9249 2087.2348,-552.8754 2083.5907,-562.8238 2090.59,-562.9249"/>
</g>
<!-- raw_34 -->
<g id="node35" class="node">
<title>raw_34</title>
<ellipse fill="none" stroke="#000000" cx="2166.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="2166.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_17&#45;&gt;raw_34 -->
<g id="edge34" class="edge">
<title>prose_17&#45;&gt;raw_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2164.6047,-862.7649C2164.932,-806.0774 2165.9376,-631.9123 2166.3355,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="2169.836,-562.8954 2166.3939,-552.8754 2162.8361,-562.855 2169.836,-562.8954"/>
</g>
<!-- raw_36 -->
<g id="node37" class="node">
<title>raw_36</title>
<ellipse fill="none" stroke="#000000" cx="2241.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="2241.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_18&#45;&gt;raw_36 -->
<g id="edge36" class="edge">
<title>prose_18&#45;&gt;raw_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2246.2382,-862.7649C2245.42,-806.0774 2242.9061,-631.9123 2241.9113,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="2245.4093,-562.8238 2241.7652,-552.8754 2238.41,-562.9249 2245.4093,-562.8238"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="2828,-700.6015 2287,-700.6015 2287,-368.3999 2828,-368.3999 2828,-700.6015"/>
<text text-anchor="middle" x="2557.5" y="-685.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="2557.5" y="-670.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="2557.5" y="-654.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="2557.5" y="-639.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="2557.5" y="-624.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2557.5" y="-592.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="2557.5" y="-577.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local Cg, C, P, Cmt, Cb = L.Cg, L.C, L.P, L.Cmt, L.Cb</text>
<text text-anchor="middle" x="2557.5" y="-561.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="2557.5" y="-546.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="2557.5" y="-531.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="2557.5" y="-515.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="2557.5" y="-500.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="2557.5" y="-484.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="2557.5" y="-469.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2557.5" y="-438.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="2557.5" y="-422.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="2557.5" y="-407.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="2557.5" y="-391.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="2557.5" y="-376.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>codeblock_19&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2471.2644,-862.7649C2478.9881,-833.364 2495.0134,-772.3622 2511.1772,-710.8331"/>
<polygon fill="#000000" stroke="#000000" points="2514.6156,-711.5194 2513.7713,-700.9583 2507.8453,-709.7408 2514.6156,-711.5194"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3170.5,-623.4015 2846.5,-623.4015 2846.5,-445.5999 3170.5,-445.5999 3170.5,-623.4015"/>
<text text-anchor="middle" x="3008.5" y="-608.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.toMarkdown(prose)</text>
<text text-anchor="middle" x="3008.5" y="-592.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3008.5" y="-577.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _, node in ipairs(prose) do</text>
<text text-anchor="middle" x="3008.5" y="-561.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if node.toMarkdown then</text>
<text text-anchor="middle" x="3008.5" y="-546.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. node:toMarkdown()</text>
<text text-anchor="middle" x="3008.5" y="-531.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif node.id == &quot;raw&quot; then</text>
<text text-anchor="middle" x="3008.5" y="-515.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase &#160;.. node:toValue()</text>
<text text-anchor="middle" x="3008.5" y="-500.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3008.5" y="-484.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3008.5" y="-469.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="3008.5" y="-454.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_20&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2876.7775,-862.7649C2893.6861,-820.6273 2936.6415,-713.5786 2968.936,-633.0978"/>
<polygon fill="#000000" stroke="#000000" points="2972.3431,-634.0051 2972.819,-623.4209 2965.8466,-631.3982 2972.3431,-634.0051"/>
</g>
<!-- header_40 -->
<g id="node41" class="node">
<title>header_40</title>
<ellipse fill="none" stroke="#000000" cx="3581.5" cy="-534.5007" rx="82.2061" ry="18"/>
<text text-anchor="middle" x="3581.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : prose grammar</text>
</g>
<!-- section_21&#45;&gt;header_40 -->
<g id="edge40" class="edge">
<title>section_21&#45;&gt;header_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3707.5366,-862.7649C3685.6759,-805.8283 3618.3126,-630.3796 3592.0951,-562.0957"/>
<polygon fill="#000000" stroke="#000000" points="3595.2463,-560.5384 3588.3945,-552.4574 3588.7115,-563.0475 3595.2463,-560.5384"/>
</g>
<!-- prose_41 -->
<g id="node42" class="node">
<title>prose_41</title>
<ellipse fill="none" stroke="#000000" cx="3714.5" cy="-534.5007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3714.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_21&#45;&gt;prose_41 -->
<g id="edge41" class="edge">
<title>section_21&#45;&gt;prose_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3714.5,-862.7649C3714.5,-806.0774 3714.5,-631.9123 3714.5,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="3718.0001,-562.8753 3714.5,-552.8754 3711.0001,-562.8754 3718.0001,-562.8753"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="3796.5" cy="-534.5007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3796.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_21&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_21&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3718.7932,-862.7649C3732.2436,-805.9452 3773.6331,-631.0997 3789.8678,-562.5177"/>
<polygon fill="#000000" stroke="#000000" points="3793.3515,-562.9948 3792.2493,-552.4574 3786.5398,-561.3822 3793.3515,-562.9948"/>
</g>
<!-- codeblock_43 -->
<g id="node44" class="node">
<title>codeblock_43</title>
<ellipse fill="none" stroke="#000000" cx="3984.5" cy="-534.5007" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="3984.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 102&#45;118</text>
</g>
<!-- section_21&#45;&gt;codeblock_43 -->
<g id="edge43" class="edge">
<title>section_21&#45;&gt;codeblock_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3728.6362,-862.7649C3773.3797,-805.3607 3912.0204,-627.4895 3964.2857,-560.435"/>
<polygon fill="#000000" stroke="#000000" points="3967.1166,-562.4963 3970.5037,-552.4574 3961.5956,-558.1929 3967.1166,-562.4963"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-254.8006 0,-254.8006 0,-184.1999 527,-184.1999 527,-254.8006"/>
<text text-anchor="middle" x="263.5" y="-207.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;We need to generate parsers to match sequences of single characters, so</text>
<text text-anchor="middle" x="263.5" y="-192.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">that *bold*, **bold**, ***bold*** etc all work correctly.</text>
</g>
<!-- raw_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>raw_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1402.1726,-516.699C1392.4868,-481.1872 1365.3903,-402.0546 1309.5,-368.2004 1235.8626,-323.5963 619.5246,-350.9584 535.5,-332.2004 466.53,-316.8033 392.7251,-285.1674 339.4226,-259.3228"/>
<polygon fill="#000000" stroke="#000000" points="340.9032,-256.1508 330.3825,-254.8998 337.8268,-262.4385 340.9032,-256.1508"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="890,-239.4023 545,-239.4023 545,-199.5982 890,-199.5982 890,-239.4023"/>
<text text-anchor="middle" x="717.5" y="-208.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">Bookends are a fun construct borrowed from the </text>
</g>
<!-- raw_24&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>raw_24&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1508.2458,-516.4692C1504.7307,-481.2629 1491.5258,-403.7213 1442.5,-368.2004 1344.5709,-297.2474 1014.6553,-369.1286 899.5,-332.2004 841.7543,-313.6824 783.6812,-272.9845 749.1582,-245.9045"/>
<polygon fill="#000000" stroke="#000000" points="750.9072,-242.8233 740.9031,-239.3349 746.5483,-248.3005 750.9072,-242.8233"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="1092.5,-237.5002 908.5,-237.5002 908.5,-201.5002 1092.5,-201.5002 1092.5,-237.5002"/>
<text text-anchor="middle" x="1000.5" y="-216.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">[[LPEG manual][httk://]]</text>
</g>
<!-- link_25&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>link_25&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.3874,-516.2882C1631.35,-480.7607 1601.6351,-402.676 1545.5,-368.2004 1461.1477,-316.3951 1190.1787,-376.1913 1101.5,-332.2004 1063.4369,-313.3184 1033.1585,-273.3181 1016.0189,-246.416"/>
<polygon fill="#000000" stroke="#000000" points="1018.9544,-244.5082 1010.7178,-237.8442 1013.0009,-248.1901 1018.9544,-244.5082"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1644.5,-246.7007 1110.5,-246.7007 1110.5,-192.2998 1644.5,-192.2998 1644.5,-246.7007"/>
<text text-anchor="middle" x="1377.5" y="-231.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1377.5" y="-216.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">model for Lua long strings. &#160;The GGG/Pegylator form of a bookend construct</text>
<text text-anchor="middle" x="1377.5" y="-200.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">is </text>
</g>
<!-- raw_26&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>raw_26&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1885.777,-518.147C1861.711,-485.5986 1803.5776,-412.0734 1739.5,-368.2004 1736.3454,-366.0405 1558.5312,-293.3505 1453.3224,-250.418"/>
<polygon fill="#000000" stroke="#000000" points="1454.5829,-247.1522 1444.0016,-246.6149 1451.9383,-253.6335 1454.5829,-247.1522"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1966,-254.7006 1663,-254.7006 1663,-184.2999 1966,-184.2999 1966,-254.7006"/>
<text text-anchor="middle" x="1814.5" y="-223.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">~#!peg</text>
<text text-anchor="middle" x="1814.5" y="-208.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;bookend = &quot;`&quot;:a !&quot;`&quot;:a pattern &#160;&quot;`&quot;:a</text>
<text text-anchor="middle" x="1814.5" y="-192.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">~#/peg</text>
</g>
<!-- raw_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>raw_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1985.6713,-516.6742C1978.4688,-485.295 1961.0973,-418.7338 1933.5,-368.2004 1912.3502,-329.473 1880.9124,-290.7129 1855.6605,-262.4785"/>
<polygon fill="#000000" stroke="#000000" points="1858.0204,-259.8701 1848.7158,-254.8029 1852.8296,-264.5665 1858.0204,-259.8701"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2532.5,-254.7006 1984.5,-254.7006 1984.5,-184.2999 2532.5,-184.2999 2532.5,-254.7006"/>
<text text-anchor="middle" x="2258.5" y="-223.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">The =lpeg= engine doesn&#39;t model this directly but it&#39;s possible to provide</text>
<text text-anchor="middle" x="2258.5" y="-208.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">it. &#160;We only need the subset of this where =a= is unique, that is, =pattern=</text>
<text text-anchor="middle" x="2258.5" y="-192.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">does not contain =bookend= at any level of expansion. </text>
</g>
<!-- raw_32&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_32&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2089.4904,-516.0491C2093.5067,-484.2795 2104.5177,-417.8799 2130.5,-368.2004 2151.44,-328.1621 2185.0452,-289.6925 2212.5688,-261.9155"/>
<polygon fill="#000000" stroke="#000000" points="2215.1686,-264.2661 2219.7884,-254.7316 2210.2311,-259.3041 2215.1686,-264.2661"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3106,-262.1013 2551,-262.1013 2551,-176.8992 3106,-176.8992 3106,-262.1013"/>
<text text-anchor="middle" x="2828.5" y="-231.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">GGG being a specification format needn&#39;t respect this limitation. &#160;Orb</text>
<text text-anchor="middle" x="2828.5" y="-215.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">does so by design. &#160;It is a simple consquence of the sort of markup we are</text>
<text text-anchor="middle" x="2828.5" y="-200.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">using; there is no need to parse ***bold **inside bold** still bold*** twice,</text>
<text text-anchor="middle" x="2828.5" y="-184.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">and this generalizes to all text styles. </text>
</g>
<!-- raw_34&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>raw_34&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2164.6489,-516.3973C2162.2203,-481.7622 2162.4958,-406.192 2205.5,-368.2004 2261.778,-318.4822 2468.5665,-350.084 2541.5,-332.2004 2605.6368,-316.4738 2674.6061,-289.7334 2728.8568,-266.2459"/>
<polygon fill="#000000" stroke="#000000" points="2730.3541,-269.4113 2738.1207,-262.205 2727.5553,-262.9952 2730.3541,-269.4113"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3672.5,-254.8006 3124.5,-254.8006 3124.5,-184.1999 3672.5,-184.1999 3672.5,-254.8006"/>
<text text-anchor="middle" x="3398.5" y="-223.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">We do have to wire them up so that we don&#39;t cross the streams. &#160;Sans macros.</text>
<text text-anchor="middle" x="3398.5" y="-208.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">By hand. </text>
</g>
<!-- raw_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>raw_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2239.101,-516.4612C2235.6002,-481.5922 2233.6792,-405.1324 2277.5,-368.2004 2348.6783,-308.2116 3023.4664,-351.6395 3114.5,-332.2004 3186.4911,-316.8276 3263.8872,-285.0036 3319.673,-259.0819"/>
<polygon fill="#000000" stroke="#000000" points="3321.2149,-262.2247 3328.7843,-254.8115 3318.2441,-255.8863 3321.2149,-262.2247"/>
</g>
<!-- raw_44 -->
<g id="node45" class="node">
<title>raw_44</title>
<ellipse fill="none" stroke="#000000" cx="3717.5" cy="-219.5002" rx="27" ry="18"/>
<text text-anchor="middle" x="3717.5" y="-215.3002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_41&#45;&gt;raw_44 -->
<g id="edge44" class="edge">
<title>prose_41&#45;&gt;raw_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3714.6743,-516.2034C3715.1755,-463.5742 3716.6237,-311.5155 3717.229,-247.9544"/>
<polygon fill="#000000" stroke="#000000" points="3720.7298,-247.881 3717.3253,-237.848 3713.7301,-247.8142 3720.7298,-247.881"/>
</g>
<!-- raw_46 -->
<g id="node47" class="node">
<title>raw_46</title>
<ellipse fill="none" stroke="#000000" cx="3794.5" cy="-219.5002" rx="27" ry="18"/>
<text text-anchor="middle" x="3794.5" y="-215.3002" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_42&#45;&gt;raw_46 -->
<g id="edge46" class="edge">
<title>prose_42&#45;&gt;raw_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3796.3838,-516.2034C3796.0497,-463.5742 3795.0842,-311.5155 3794.6807,-247.9544"/>
<polygon fill="#000000" stroke="#000000" points="3798.18,-247.8256 3794.6165,-237.848 3791.1802,-247.8701 3798.18,-247.8256"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="4227,-332.4009 3840,-332.4009 3840,-106.5995 4227,-106.5995 4227,-332.4009"/>
<text text-anchor="middle" x="4033.5" y="-317.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function prose_gm(_ENV)</text>
<text text-anchor="middle" x="4033.5" y="-301.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;START &quot;prose&quot;</text>
<text text-anchor="middle" x="4033.5" y="-286.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;prose = (V&quot;link&quot; + V&quot;raw&quot;)^1</text>
<text text-anchor="middle" x="4033.5" y="-270.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;link = m.link</text>
<text text-anchor="middle" x="4033.5" y="-255.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;raw = (P(1) &#45; m.link)^1</text>
<text text-anchor="middle" x="4033.5" y="-240.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4033.5" y="-208.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function proseBuild(prose, str)</text>
<text text-anchor="middle" x="4033.5" y="-193.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return setmetatable(prose, {__index = Pr })</text>
<text text-anchor="middle" x="4033.5" y="-177.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4033.5" y="-146.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">local parse = Grammar(prose_gm, { prose = proseBuild,</text>
<text text-anchor="middle" x="4033.5" y="-131.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;link &#160;= Link }) &#160;</text>
</g>
<!-- codeblock_43&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_43&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3987.3462,-516.2034C3992.5821,-482.5442 4004.1443,-408.2156 4014.3857,-342.3784"/>
<polygon fill="#000000" stroke="#000000" points="4017.8726,-342.7321 4015.9514,-332.3129 4010.9558,-341.6561 4017.8726,-342.7321"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="3751.5,-70.7004 3203.5,-70.7004 3203.5,-.0997 3751.5,-.0997 3751.5,-70.7004"/>
<text text-anchor="middle" x="3477.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The Prose module is the first one to use our shiny&#45;new Node module. &#160;Which</text>
<text text-anchor="middle" x="3477.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">finally works the way I intend it to and I&#39;m pretty happy about this. </text>
</g>
<!-- raw_44&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>raw_44&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3716.5738,-201.3714C3714.3563,-176.7584 3706.8517,-132.8584 3681.5,-106.8001 3669.3605,-94.3222 3654.9209,-84.022 3639.4136,-75.5199"/>
<polygon fill="#000000" stroke="#000000" points="3640.6568,-72.2217 3630.1691,-70.719 3637.4306,-78.434 3640.6568,-72.2217"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="4297,-55.3021 3770,-55.3021 3770,-15.4979 4297,-15.4979 4297,-55.3021"/>
<text text-anchor="middle" x="4033.5" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">It&#39;s pure link&#45;or&#45;raw, but it has everything it needs to be so much more.</text>
</g>
<!-- raw_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>raw_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3795.4319,-201.377C3797.6561,-176.7704 3805.1683,-132.8778 3830.5,-106.8001 3852.286,-84.3724 3881.5237,-68.9779 3911.0124,-58.4149"/>
<polygon fill="#000000" stroke="#000000" points="3912.2498,-61.6909 3920.5863,-55.1523 3909.9918,-55.0651 3912.2498,-61.6909"/>
</g>
<!-- raw_53 -->
<g id="node54" class="node">
<title>raw_53</title>
<ellipse fill="none" stroke="#000000" cx="4264.5" cy="-534.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="4264.5" y="-530.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_50&#45;&gt;raw_53 -->
<g id="edge53" class="edge">
<title>prose_50&#45;&gt;raw_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4274.9241,-862.7649C4273.124,-806.0774 4267.5933,-631.9123 4265.4049,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="4268.8992,-562.7592 4265.0835,-552.8754 4261.9027,-562.9814 4268.8992,-562.7592"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="4585,-600.2011 4310,-600.2011 4310,-468.8003 4585,-468.8003 4585,-600.2011"/>
<text text-anchor="middle" x="4447.5" y="-584.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Prose, block)</text>
<text text-anchor="middle" x="4447.5" y="-569.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;\n&quot;</text>
<text text-anchor="middle" x="4447.5" y="-554.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,l in ipairs(block.lines) do</text>
<text text-anchor="middle" x="4447.5" y="-538.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase .. l .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4447.5" y="-523.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4447.5" y="-507.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prose = parse(phrase, 0) </text>
<text text-anchor="middle" x="4447.5" y="-492.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose</text>
<text text-anchor="middle" x="4447.5" y="-477.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_51&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>codeblock_51&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4436.1283,-862.7649C4437.7307,-816.5078 4442.043,-692.0271 4444.8728,-610.3407"/>
<polygon fill="#000000" stroke="#000000" points="4448.379,-610.2191 4445.2274,-600.1038 4441.3832,-609.9766 4448.379,-610.2191"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="4787.5,-552.5007 4603.5,-552.5007 4603.5,-516.5007 4787.5,-516.5007 4787.5,-552.5007"/>
<text text-anchor="middle" x="4695.5" y="-531.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(pr, new)</text>
</g>
<!-- codeblock_52&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_52&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4668.966,-862.7649C4673.5481,-806.0774 4687.6261,-631.9123 4693.1965,-562.9979"/>
<polygon fill="#000000" stroke="#000000" points="4696.6976,-563.1249 4694.0148,-552.8754 4689.7204,-562.5608 4696.6976,-563.1249"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="4576,-247.4017 4245,-247.4017 4245,-191.5987 4576,-191.5987 4576,-247.4017"/>
<text text-anchor="middle" x="4410.5" y="-200.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; [ ] #todo smuggle in that offset in =parse=</text>
</g>
<!-- raw_53&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>raw_53&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4265.9233,-516.2427C4268.9189,-484.7654 4277.5991,-418.7946 4300.5,-368.2004 4319.745,-325.6831 4352.592,-283.5148 4377.394,-255.0027"/>
<polygon fill="#000000" stroke="#000000" points="4380.168,-257.1489 4384.1581,-247.3341 4374.9183,-252.5184 4380.168,-257.1489"/>
</g>
</g>
</svg>