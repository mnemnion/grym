<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5828pt" height="1434pt"
 viewBox="0.00 0.00 5827.50 1434.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1430.4017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1430.4017 5823.5,-1430.4017 5823.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-1408.4017" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-1404.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 163</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-1336.4017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-1332.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;133</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1915.5,-1390.2331C1915.5,-1382.5327 1915.5,-1373.3761 1915.5,-1364.8184"/>
<polygon fill="#000000" stroke="#000000" points="1919.0001,-1364.815 1915.5,-1354.815 1912.0001,-1364.815 1919.0001,-1364.815"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1665.5" cy="-1264.4017" rx="76.9193" ry="18"/>
<text text-anchor="middle" x="1665.5" y="-1260.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Prose module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1870.2269,-1323.3631C1829.2816,-1311.5708 1768.7485,-1294.1373 1724.1187,-1281.2839"/>
<polygon fill="#000000" stroke="#000000" points="1724.859,-1277.8549 1714.2809,-1278.4506 1722.9217,-1284.5815 1724.859,-1277.8549"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1792.5" cy="-1264.4017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1792.5" y="-1260.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1887.5894,-1320.0638C1868.6209,-1308.9603 1843.5028,-1294.2571 1823.8461,-1282.7507"/>
<polygon fill="#000000" stroke="#000000" points="1825.3623,-1279.5827 1814.964,-1277.5514 1821.826,-1285.6238 1825.3623,-1279.5827"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-1264.4017" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-1260.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 5&#45;20</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1915.5,-1318.2331C1915.5,-1310.5327 1915.5,-1301.3761 1915.5,-1292.8184"/>
<polygon fill="#000000" stroke="#000000" points="1919.0001,-1292.815 1915.5,-1282.815 1912.0001,-1292.815 1919.0001,-1292.815"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-1264.4017" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-1260.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 23&#45;79</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1970.268,-1326.2386C2040.8937,-1313.1328 2163.553,-1290.3713 2238.7285,-1276.4212"/>
<polygon fill="#000000" stroke="#000000" points="2239.8171,-1279.779 2249.0106,-1274.5132 2238.5399,-1272.8965 2239.8171,-1279.779"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="5172.5" cy="-1264.4017" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5172.5" y="-1260.2017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 134&#45;163</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1981.2958,-1334.9472C2393.8662,-1325.8269 4621.8396,-1276.5748 5087.2494,-1266.2863"/>
<polygon fill="#000000" stroke="#000000" points="5087.3417,-1269.7852 5097.2619,-1266.065 5087.1869,-1262.7869 5087.3417,-1269.7852"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="1539.5,-1125.0031 1145.5,-1125.0031 1145.5,-1069.2001 1539.5,-1069.2001 1539.5,-1125.0031"/>
<text text-anchor="middle" x="1342.5" y="-1077.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Here we need a proper recursive parser. &#160;Eventually.</text>
</g>
<!-- prose_3&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>prose_3&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1768.1439,-1252.577C1762.753,-1250.2808 1757.0048,-1248.0721 1751.5,-1246.4017 1663.8177,-1219.7961 1634.9096,-1240.8883 1548.5,-1210.4017 1492.021,-1190.4752 1432.6093,-1156.1688 1392.182,-1130.5134"/>
<polygon fill="#000000" stroke="#000000" points="1393.9066,-1127.4617 1383.5982,-1125.0149 1390.1308,-1133.3561 1393.9066,-1127.4617"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="1811.5,-1210.2022 1557.5,-1210.2022 1557.5,-984.001 1811.5,-984.001 1811.5,-1210.2022"/>
<text text-anchor="middle" x="1684.5" y="-1195.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1163.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1148.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1133.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1117.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp</text>
<text text-anchor="middle" x="1684.5" y="-1102.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1070.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1684.5" y="-1039.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Link = require &quot;grym/link&quot;</text>
<text text-anchor="middle" x="1684.5" y="-992.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Pr, pr = u.inherit(Node)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_4&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1883.4109,-1248.0061C1864.5842,-1237.9388 1840.6189,-1224.3359 1820.5,-1210.4017 1820.3184,-1210.276 1820.1368,-1210.15 1819.9551,-1210.0239"/>
<polygon fill="#000000" stroke="#000000" points="1821.9384,-1207.1397 1811.7509,-1204.23 1817.9003,-1212.8576 1821.9384,-1207.1397"/>
</g>
<!-- header_9 -->
<g id="node10" class="node">
<title>header_9</title>
<ellipse fill="none" stroke="#000000" cx="1918.5" cy="-1097.1016" rx="88.5398" ry="18"/>
<text text-anchor="middle" x="1918.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Bookend parsing</text>
</g>
<!-- section_5&#45;&gt;header_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;header_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2242.337,-1257.6805C2169.8472,-1248.8939 2054.1346,-1232.0415 2016.5,-1210.4017 1980.399,-1189.6438 1951.1192,-1150.5281 1934.2509,-1124.14"/>
<polygon fill="#000000" stroke="#000000" points="1937.0627,-1122.0335 1928.8112,-1115.3879 1931.1175,-1125.7287 1937.0627,-1122.0335"/>
</g>
<!-- prose_10 -->
<g id="node11" class="node">
<title>prose_10</title>
<ellipse fill="none" stroke="#000000" cx="2057.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2057.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;prose_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2246.3105,-1255.4333C2193.4819,-1246.0922 2120.0279,-1230.0814 2098.5,-1210.4017 2074.3456,-1188.3211 2064.4015,-1150.9149 2060.3202,-1125.1607"/>
<polygon fill="#000000" stroke="#000000" points="2063.7863,-1124.674 2058.9453,-1115.2498 2056.8527,-1125.6359 2063.7863,-1124.674"/>
</g>
<!-- prose_11 -->
<g id="node12" class="node">
<title>prose_11</title>
<ellipse fill="none" stroke="#000000" cx="2139.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2139.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;prose_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2253.6571,-1252.5819C2228.785,-1244.4159 2199.939,-1231.178 2180.5,-1210.4017 2158.3655,-1186.7446 2148.0068,-1150.2437 2143.2769,-1125.098"/>
<polygon fill="#000000" stroke="#000000" points="2146.7018,-1124.3597 2141.5766,-1115.087 2139.8006,-1125.532 2146.7018,-1124.3597"/>
</g>
<!-- prose_12 -->
<g id="node13" class="node">
<title>prose_12</title>
<ellipse fill="none" stroke="#000000" cx="2221.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2221.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;prose_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2288.0034,-1246.8476C2279.6315,-1236.7146 2269.5885,-1223.4296 2262.5,-1210.4017 2247.4335,-1182.7113 2235.8976,-1148.3599 2228.9566,-1124.7852"/>
<polygon fill="#000000" stroke="#000000" points="2232.2966,-1123.7351 2226.1805,-1115.0839 2225.5667,-1125.6609 2232.2966,-1123.7351"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.5,-1246.1792C2303.5,-1217.1403 2303.5,-1160.1339 2303.5,-1125.6444"/>
<polygon fill="#000000" stroke="#000000" points="2307.0001,-1125.3016 2303.5,-1115.3017 2300.0001,-1125.3017 2307.0001,-1125.3016"/>
</g>
<!-- prose_14 -->
<g id="node15" class="node">
<title>prose_14</title>
<ellipse fill="none" stroke="#000000" cx="2385.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2385.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_14 -->
<g id="edge14" class="edge">
<title>section_5&#45;&gt;prose_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2318.9966,-1246.8476C2327.3685,-1236.7146 2337.4115,-1223.4296 2344.5,-1210.4017 2359.5665,-1182.7113 2371.1024,-1148.3599 2378.0434,-1124.7852"/>
<polygon fill="#000000" stroke="#000000" points="2381.4333,-1125.6609 2380.8195,-1115.0839 2374.7034,-1123.7351 2381.4333,-1125.6609"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="2711.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2711.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_5&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2340.0663,-1249.4077C2417.9085,-1217.4886 2599.1564,-1143.168 2676.0231,-1111.6489"/>
<polygon fill="#000000" stroke="#000000" points="2677.3723,-1114.8785 2685.2968,-1107.8462 2674.7165,-1108.4019 2677.3723,-1114.8785"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="3118.5" cy="-1097.1016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3118.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 49&#45;71</text>
</g>
<!-- section_5&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>section_5&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2367.6703,-1260.3417C2455.3504,-1253.9663 2617.1592,-1239.2415 2752.5,-1210.4017 2867.4471,-1185.9077 2998.073,-1141.2525 3067.9779,-1115.9345"/>
<polygon fill="#000000" stroke="#000000" points="3069.2306,-1119.2032 3077.4308,-1112.4944 3066.8368,-1112.6252 3069.2306,-1119.2032"/>
</g>
<!-- codeblock_17 -->
<g id="node18" class="node">
<title>codeblock_17</title>
<ellipse fill="none" stroke="#000000" cx="3682.5" cy="-1097.1016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3682.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 73&#45;77</text>
</g>
<!-- section_5&#45;&gt;codeblock_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;codeblock_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2368.6758,-1261.9616C2547.455,-1255.0343 3042.9778,-1234.2022 3204.5,-1210.4017 3358.6122,-1187.6932 3536.143,-1139.7121 3625.2215,-1114.0819"/>
<polygon fill="#000000" stroke="#000000" points="3626.2256,-1117.435 3634.8607,-1111.2962 3624.2821,-1110.7102 3626.2256,-1117.435"/>
</g>
<!-- section_18 -->
<g id="node19" class="node">
<title>section_18</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-1097.1016" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 80&#45;95</text>
</g>
<!-- section_5&#45;&gt;section_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;section_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2369.1907,-1263.9361C2616.7068,-1261.8778 3492.8953,-1251.7678 3768.5,-1210.4017 3906.1541,-1189.741 4063.266,-1140.8697 4141.9641,-1114.5726"/>
<polygon fill="#000000" stroke="#000000" points="4143.2598,-1117.8296 4151.6238,-1111.3262 4141.0298,-1111.1942 4143.2598,-1117.8296"/>
</g>
<!-- header_42 -->
<g id="node43" class="node">
<title>header_42</title>
<ellipse fill="none" stroke="#000000" cx="5054.5" cy="-1097.1016" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="5054.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor</text>
</g>
<!-- section_6&#45;&gt;header_42 -->
<g id="edge42" class="edge">
<title>section_6&#45;&gt;header_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5158.5948,-1246.578C5150.5431,-1236.1367 5140.2931,-1222.6367 5131.5,-1210.4017 5110.4246,-1181.0768 5087.2608,-1146.6788 5071.9006,-1123.5427"/>
<polygon fill="#000000" stroke="#000000" points="5074.6586,-1121.3683 5066.2194,-1114.9628 5068.8221,-1125.233 5074.6586,-1121.3683"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="5172.5" cy="-1097.1016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5172.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_6&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5172.5,-1246.1792C5172.5,-1217.1403 5172.5,-1160.1339 5172.5,-1125.6444"/>
<polygon fill="#000000" stroke="#000000" points="5176.0001,-1125.3016 5172.5,-1115.3017 5169.0001,-1125.3017 5176.0001,-1125.3016"/>
</g>
<!-- codeblock_44 -->
<g id="node45" class="node">
<title>codeblock_44</title>
<ellipse fill="none" stroke="#000000" cx="5337.5" cy="-1097.1016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5337.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 136&#45;147</text>
</g>
<!-- section_6&#45;&gt;codeblock_44 -->
<g id="edge44" class="edge">
<title>section_6&#45;&gt;codeblock_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5189.846,-1246.8139C5219.2305,-1217.0198 5278.8913,-1156.5273 5312.6894,-1122.2581"/>
<polygon fill="#000000" stroke="#000000" points="5315.3597,-1124.5349 5319.8898,-1114.9573 5310.3758,-1119.6195 5315.3597,-1124.5349"/>
</g>
<!-- codeblock_45 -->
<g id="node46" class="node">
<title>codeblock_45</title>
<ellipse fill="none" stroke="#000000" cx="5576.5" cy="-1097.1016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5576.5" y="-1092.9016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;151</text>
</g>
<!-- section_6&#45;&gt;codeblock_45 -->
<g id="edge45" class="edge">
<title>section_6&#45;&gt;codeblock_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5244.2754,-1258.5981C5298.3552,-1252.1171 5373.2353,-1238.5545 5433.5,-1210.4017 5480.2533,-1188.5609 5525.4145,-1148.6321 5552.0749,-1122.4833"/>
<polygon fill="#000000" stroke="#000000" points="5554.7986,-1124.7103 5559.4129,-1115.1731 5549.8582,-1119.7512 5554.7986,-1124.7103"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-816.8015 0,-816.8015 0,-746.2008 527,-746.2008 527,-816.8015"/>
<text text-anchor="middle" x="263.5" y="-769.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;We need to generate parsers to match sequences of single characters, so</text>
<text text-anchor="middle" x="263.5" y="-754.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">that *bold*, **bold**, ***bold*** etc all work correctly.</text>
</g>
<!-- prose_10&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_10&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2056.8847,-1078.8901C2054.9138,-1052.8771 2047.0584,-1005.8003 2016.5,-983.8015 1949.7507,-935.7491 615.4121,-970.9828 536.5,-947.8015 451.0819,-922.709 365.5169,-863.7631 313.53,-823.2442"/>
<polygon fill="#000000" stroke="#000000" points="315.5024,-820.3426 305.4799,-816.9074 311.1727,-825.8429 315.5024,-820.3426"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1079.5,-816.7015 545.5,-816.7015 545.5,-746.3008 1079.5,-746.3008 1079.5,-816.7015"/>
<text text-anchor="middle" x="812.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">Bookends are a fun construct borrowed from the [[LPEG manual][httk://]]]]</text>
<text text-anchor="middle" x="812.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">model for Lua long strings. &#160;The GGG/Pegylator form of a bookend construct</text>
<text text-anchor="middle" x="812.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">is </text>
</g>
<!-- prose_11&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_11&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2138.8517,-1078.9357C2136.8397,-1052.9795 2128.9336,-1005.9727 2098.5,-983.8015 2007.7378,-917.68 1196.138,-979.7997 1088.5,-947.8015 1002.4785,-922.2294 915.8883,-863.405 863.22,-823.0436"/>
<polygon fill="#000000" stroke="#000000" points="865.1143,-820.084 855.0636,-816.7323 860.8305,-825.6202 865.1143,-820.084"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1401,-816.7015 1098,-816.7015 1098,-746.3008 1401,-746.3008 1401,-816.7015"/>
<text text-anchor="middle" x="1249.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">~#!peg</text>
<text text-anchor="middle" x="1249.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;bookend = &quot;`&quot;:a !&quot;`&quot;:a pattern &#160;&quot;`&quot;:a</text>
<text text-anchor="middle" x="1249.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">~#/peg</text>
</g>
<!-- prose_12&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>prose_12&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2220.8191,-1078.9803C2218.7664,-1053.0795 2210.8101,-1006.1411 2180.5,-983.8015 2111.5542,-932.9859 1488.5594,-983.0504 1410.5,-947.8015 1352.8862,-921.7851 1305.285,-864.947 1277.1462,-824.9906"/>
<polygon fill="#000000" stroke="#000000" points="1280.0063,-822.9729 1271.4404,-816.7378 1274.2484,-826.9537 1280.0063,-822.9729"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1967.5,-816.7015 1419.5,-816.7015 1419.5,-746.3008 1967.5,-746.3008 1967.5,-816.7015"/>
<text text-anchor="middle" x="1693.5" y="-785.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">The =lpeg= engine doesn&#39;t model this directly but it&#39;s possible to provide</text>
<text text-anchor="middle" x="1693.5" y="-770.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">it. &#160;We only need the subset of this where =a= is unique, that is, =pattern=</text>
<text text-anchor="middle" x="1693.5" y="-754.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">does not contain =bookend= at any level of expansion. </text>
</g>
<!-- prose_13&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_13&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2302.5414,-1078.863C2300.139,-1053.2599 2291.7468,-1007.1826 2262.5,-983.8015 2162.4324,-903.8032 2097.774,-989.1033 1976.5,-947.8015 1890.8116,-918.6189 1802.5034,-861.6242 1747.8173,-822.5673"/>
<polygon fill="#000000" stroke="#000000" points="1749.8271,-819.7016 1739.6662,-816.7004 1745.7378,-825.383 1749.8271,-819.7016"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2541,-824.1022 1986,-824.1022 1986,-738.9001 2541,-738.9001 2541,-824.1022"/>
<text text-anchor="middle" x="2263.5" y="-793.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">GGG being a specification format needn&#39;t respect this limitation. &#160;Orb</text>
<text text-anchor="middle" x="2263.5" y="-777.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">does so by design. &#160;It is a simple consquence of the sort of markup we are</text>
<text text-anchor="middle" x="2263.5" y="-762.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">using; there is no need to parse ***bold **inside bold** still bold*** twice,</text>
<text text-anchor="middle" x="2263.5" y="-746.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">and this generalizes to all text styles. </text>
</g>
<!-- prose_14&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>prose_14&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2379.2917,-1079.371C2371.4148,-1057.0114 2357.3103,-1017.4235 2344.5,-983.8015 2324.9842,-932.5802 2301.6138,-874.5389 2285.0028,-833.8036"/>
<polygon fill="#000000" stroke="#000000" points="2288.1643,-832.2874 2281.1436,-824.3527 2281.6838,-834.9337 2288.1643,-832.2874"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3107.5,-816.8015 2559.5,-816.8015 2559.5,-746.2008 3107.5,-746.2008 3107.5,-816.8015"/>
<text text-anchor="middle" x="2833.5" y="-785.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">We do have to wire them up so that we don&#39;t cross the streams. &#160;Sans macros.</text>
<text text-anchor="middle" x="2833.5" y="-770.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">By hand. </text>
</g>
<!-- prose_15&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_15&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2718.4088,-1079.2293C2737.04,-1031.0326 2788.7506,-897.2628 2816.0708,-826.5887"/>
<polygon fill="#000000" stroke="#000000" points="2819.4168,-827.6398 2819.7579,-817.0505 2812.8876,-825.1158 2819.4168,-827.6398"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3667,-947.602 3126,-947.602 3126,-615.4003 3667,-615.4003 3667,-947.602"/>
<text text-anchor="middle" x="3396.5" y="-932.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="3396.5" y="-917.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="3396.5" y="-901.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="3396.5" y="-886.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="3396.5" y="-871.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-839.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="3396.5" y="-824.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local Cg, C, P, Cmt, Cb = L.Cg, L.C, L.P, L.Cmt, L.Cb</text>
<text text-anchor="middle" x="3396.5" y="-808.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="3396.5" y="-793.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="3396.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="3396.5" y="-762.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-747.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="3396.5" y="-731.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="3396.5" y="-716.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-685.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-669.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-654.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-638.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-623.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_16&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3134.243,-1079.2293C3156.3121,-1054.1752 3198.7501,-1005.9974 3243.1614,-955.5793"/>
<polygon fill="#000000" stroke="#000000" points="3246.0305,-957.6173 3250.0141,-947.7998 3240.7777,-952.9903 3246.0305,-957.6173"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3904,-808.7016 3685,-808.7016 3685,-754.3007 3904,-754.3007 3904,-808.7016"/>
<text text-anchor="middle" x="3794.5" y="-793.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.toMarkdown(prose)</text>
<text text-anchor="middle" x="3794.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return prose.val</text>
<text text-anchor="middle" x="3794.5" y="-762.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_17&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_17&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3689.0057,-1078.7695C3706.9385,-1028.2374 3757.3388,-886.2163 3781.3985,-818.4193"/>
<polygon fill="#000000" stroke="#000000" points="3784.7041,-819.5695 3784.7502,-808.9748 3778.1072,-817.2284 3784.7041,-819.5695"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="3991.5" cy="-781.5012" rx="69.1756" ry="18"/>
<text text-anchor="middle" x="3991.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Link or Raw</text>
</g>
<!-- section_18&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_18&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4175.3793,-1079.3957C4150.0218,-1052.5394 4101.9863,-999.1786 4069.5,-947.8015 4040.4631,-901.8797 4015.5277,-843.4235 4002.0956,-809.4568"/>
<polygon fill="#000000" stroke="#000000" points="4005.2007,-807.7859 3998.3045,-799.7427 3998.6796,-810.3309 4005.2007,-807.7859"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="4110.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4110.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_18&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4187.2948,-1078.7555C4179.3532,-1050.6315 4163.8337,-995.1424 4151.5,-947.8015 4138.8499,-899.2461 4125.0632,-842.4493 4117.1343,-809.3707"/>
<polygon fill="#000000" stroke="#000000" points="4120.5048,-808.4164 4114.7746,-799.5049 4113.6968,-810.0447 4120.5048,-808.4164"/>
</g>
<!-- prose_29 -->
<g id="node30" class="node">
<title>prose_29</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_29 -->
<g id="edge29" class="edge">
<title>section_18&#45;&gt;prose_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4192.5,-1078.7695C4192.5,-1026.04 4192.5,-873.6917 4192.5,-810.0095"/>
<polygon fill="#000000" stroke="#000000" points="4196.0001,-809.8839 4192.5,-799.8839 4189.0001,-809.884 4196.0001,-809.8839"/>
</g>
<!-- prose_30 -->
<g id="node31" class="node">
<title>prose_30</title>
<ellipse fill="none" stroke="#000000" cx="4274.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4274.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_30 -->
<g id="edge30" class="edge">
<title>section_18&#45;&gt;prose_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4197.7052,-1078.7555C4205.6468,-1050.6315 4221.1663,-995.1424 4233.5,-947.8015 4246.1501,-899.2461 4259.9368,-842.4493 4267.8657,-809.3707"/>
<polygon fill="#000000" stroke="#000000" points="4271.3032,-810.0447 4270.2254,-799.5049 4264.4952,-808.4164 4271.3032,-810.0447"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="4591.5" cy="-781.5012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4591.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_18&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4214.2353,-1079.9094C4282.1941,-1026.1555 4490.5442,-861.355 4564.8378,-802.5904"/>
<polygon fill="#000000" stroke="#000000" points="4567.1427,-805.2299 4572.8144,-796.281 4562.8,-799.7397 4567.1427,-805.2299"/>
</g>
<!-- section_32 -->
<g id="node33" class="node">
<title>section_32</title>
<ellipse fill="none" stroke="#000000" cx="5042.5" cy="-781.5012" rx="70.655" ry="18"/>
<text text-anchor="middle" x="5042.5" y="-777.3012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 96&#45;133</text>
</g>
<!-- section_18&#45;&gt;section_32 -->
<g id="edge32" class="edge">
<title>section_18&#45;&gt;section_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4235.5764,-1083.4065C4314.6982,-1058.0478 4488.2886,-1001.4633 4632.5,-947.8015 4766.2608,-898.0284 4921.8345,-832.9022 4997.0957,-800.9285"/>
<polygon fill="#000000" stroke="#000000" points="4998.4716,-804.1468 5006.3037,-797.0118 4995.7316,-797.7054 4998.4716,-804.1468"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3259,-571.7012 2704,-571.7012 2704,-501.1005 3259,-501.1005 3259,-571.7012"/>
<text text-anchor="middle" x="2981.5" y="-524.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The prose parser will be a proper recursive grammar. &#160;This calls for some</text>
<text text-anchor="middle" x="2981.5" y="-509.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">enhancements to epnf to allow assignment of Node metatables to matched spans.</text>
</g>
<!-- prose_28&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>prose_28&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4112.2986,-763.4009C4114.6495,-728.4254 4114.1018,-651.7875 4069.5,-615.2009 4035.0598,-586.9498 3312.8378,-583.4917 3268.5,-579.2009 3250.4357,-577.4527 3231.7721,-575.3489 3213.0355,-573.0243"/>
<polygon fill="#000000" stroke="#000000" points="3213.2885,-569.5286 3202.9292,-571.7503 3212.4129,-576.4736 3213.2885,-569.5286"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3853.5,-563.7012 3277.5,-563.7012 3277.5,-509.1004 3853.5,-509.1004 3853.5,-563.7012"/>
<text text-anchor="middle" x="3565.5" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ve been sloppy with the node constructor interface and will need to go through</text>
<text text-anchor="middle" x="3565.5" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">the whole =grym= directory and fix it into a consistent state. &#160;At some point.</text>
</g>
<!-- prose_29&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prose_29&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4194.0528,-763.4388C4195.9256,-728.8747 4194.5108,-653.4219 4151.5,-615.2009 4103.1227,-572.211 3926.6425,-587.8168 3862.5,-579.2009 3829.7226,-574.798 3794.9376,-569.9469 3761.1563,-565.1405"/>
<polygon fill="#000000" stroke="#000000" points="3761.5785,-561.6654 3751.1846,-563.7189 3760.5905,-568.5953 3761.5785,-561.6654"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="4441,-579.0019 3872,-579.0019 3872,-493.7998 4441,-493.7998 4441,-579.0019"/>
<text text-anchor="middle" x="4156.5" y="-548.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">Links give me a chance to design that interface to fit grammatically. For now,</text>
<text text-anchor="middle" x="4156.5" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">we&#39;re going to handroll another Link class, and write a simple either&#45;or parser</text>
<text text-anchor="middle" x="4156.5" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">over prose strings that finds links and puts the rest in a =raw= class, which</text>
<text text-anchor="middle" x="4156.5" y="-501.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">shouldn&#39;t need an intermediate Node class. </text>
</g>
<!-- prose_30&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>prose_30&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4273.1604,-763.3822C4270.1516,-731.5504 4260.8273,-664.3109 4233.5,-615.2009 4227.9611,-605.2468 4220.832,-595.6595 4213.1525,-586.807"/>
<polygon fill="#000000" stroke="#000000" points="4215.5947,-584.2896 4206.2883,-579.2259 4210.4057,-588.988 4215.5947,-584.2896"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4958,-564.3023 4459,-564.3023 4459,-508.4993 4958,-508.4993 4958,-564.3023"/>
<text text-anchor="middle" x="4708.5" y="-532.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">This Link class needs to fit the constructor semantics of =epeg.Csp=.</text>
</g>
<!-- prose_31&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4599.9144,-763.8742C4618.8456,-724.2156 4665.1316,-627.2521 4690.7378,-573.6104"/>
<polygon fill="#000000" stroke="#000000" points="4693.9667,-574.9709 4695.116,-564.4385 4687.6495,-571.9553 4693.9667,-574.9709"/>
</g>
<!-- header_37 -->
<g id="node38" class="node">
<title>header_37</title>
<ellipse fill="none" stroke="#000000" cx="5042.5" cy="-536.4008" rx="66.3205" ry="18"/>
<text text-anchor="middle" x="5042.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : epnf.define</text>
</g>
<!-- section_32&#45;&gt;header_37 -->
<g id="edge37" class="edge">
<title>section_32&#45;&gt;header_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5042.5,-763.4784C5042.5,-721.2503 5042.5,-615.644 5042.5,-564.728"/>
<polygon fill="#000000" stroke="#000000" points="5046.0001,-564.45 5042.5,-554.45 5039.0001,-564.4501 5046.0001,-564.45"/>
</g>
<!-- prose_38 -->
<g id="node39" class="node">
<title>prose_38</title>
<ellipse fill="none" stroke="#000000" cx="5158.5" cy="-536.4008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5158.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_32&#45;&gt;prose_38 -->
<g id="edge38" class="edge">
<title>section_32&#45;&gt;prose_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5051.0298,-763.4784C5071.19,-720.8811 5121.8725,-613.7923 5145.7196,-563.405"/>
<polygon fill="#000000" stroke="#000000" points="5148.9999,-564.6556 5150.1142,-554.1195 5142.6727,-561.661 5148.9999,-564.6556"/>
</g>
<!-- codeblock_39 -->
<g id="node40" class="node">
<title>codeblock_39</title>
<ellipse fill="none" stroke="#000000" cx="5485.5" cy="-536.4008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5485.5" y="-532.2008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 101&#45;131</text>
</g>
<!-- section_32&#45;&gt;codeblock_39 -->
<g id="edge39" class="edge">
<title>section_32&#45;&gt;codeblock_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5045.7746,-763.4717C5053.0314,-728.9645 5073.8339,-653.6058 5122.5,-615.2009 5164.6281,-581.9554 5305.411,-558.631 5398.7634,-546.3798"/>
<polygon fill="#000000" stroke="#000000" points="5399.3037,-549.8391 5408.7719,-545.0847 5398.4054,-542.897 5399.3037,-549.8391"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="5323.5,-264.1007 4803.5,-264.1007 4803.5,-193.5 5323.5,-193.5 5323.5,-264.1007"/>
<text text-anchor="middle" x="5063.5" y="-217.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;I&#39;m blindly following a function&#45;in&#45;function pattern because I vaguely</text>
<text text-anchor="middle" x="5063.5" y="-201.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">remember it mattering.</text>
</g>
<!-- prose_38&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>prose_38&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5152.9818,-518.5334C5138.4503,-471.482 5098.7846,-343.0484 5077.4767,-274.0555"/>
<polygon fill="#000000" stroke="#000000" points="5080.7664,-272.8461 5074.4713,-264.3243 5074.0781,-274.9118 5080.7664,-272.8461"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="5819.5,-457.4013 5341.5,-457.4013 5341.5,-.1995 5819.5,-.1995 5819.5,-457.4013"/>
<text text-anchor="middle" x="5580.5" y="-426.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local _prose_fn = function()</text>
<text text-anchor="middle" x="5580.5" y="-411.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function prose_parse(_ENV)</text>
<text text-anchor="middle" x="5580.5" y="-395.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;START &quot;prose&quot;</text>
<text text-anchor="middle" x="5580.5" y="-380.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local raw_patt = (P(1) &#45; m.link)^1</text>
<text text-anchor="middle" x="5580.5" y="-364.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;prose = (V&quot;raw&quot; + V&quot;link&quot;)^1</text>
<text text-anchor="middle" x="5580.5" y="-349.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;raw = Csp(raw_patt)</text>
<text text-anchor="middle" x="5580.5" y="-334.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;link = Csp(m.link)</text>
<text text-anchor="middle" x="5580.5" y="-318.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-287.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose_parse</text>
<text text-anchor="middle" x="5580.5" y="-271.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5580.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.parse(prose)</text>
<text text-anchor="middle" x="5580.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local parser = epnf.define(_prose_fn())</text>
<text text-anchor="middle" x="5580.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local parsed = L.match(parser, prose.val, 1, &quot;truth&quot;, prose.val)</text>
<text text-anchor="middle" x="5580.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if parsed then</text>
<text text-anchor="middle" x="5580.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(parsed) do</text>
<text text-anchor="middle" x="5580.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if v.id == &quot;link&quot; then</text>
<text text-anchor="middle" x="5580.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;io.write(v.val .. &quot;\n&quot;)</text>
<text text-anchor="middle" x="5580.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5580.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="5580.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;io.write(&#39;no parse\n&#39;)</text>
<text text-anchor="middle" x="5580.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5580.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return prose</text>
<text text-anchor="middle" x="5580.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_39&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>codeblock_39&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5491.1582,-518.0802C5494.9685,-505.7426 5500.4603,-487.961 5506.8746,-467.1921"/>
<polygon fill="#000000" stroke="#000000" points="5510.2771,-468.0358 5509.8839,-457.4483 5503.5888,-465.9701 5510.2771,-468.0358"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="5185.5,-799.5012 5131.5,-799.5012 5131.5,-763.5012 5185.5,-763.5012 5185.5,-799.5012"/>
</g>
<!-- prose_43&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>prose_43&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5171.6868,-1078.7695C5169.3477,-1026.04 5162.5896,-873.6917 5159.7646,-810.0095"/>
<polygon fill="#000000" stroke="#000000" points="5163.2553,-809.719 5159.3155,-799.8839 5156.2622,-810.0292 5163.2553,-809.719"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="5499.5,-862.6019 5203.5,-862.6019 5203.5,-700.4004 5499.5,-700.4004 5499.5,-862.6019"/>
<text text-anchor="middle" x="5351.5" y="-847.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Prose, block)</text>
<text text-anchor="middle" x="5351.5" y="-832.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prose = setmetatable({},Pr)</text>
<text text-anchor="middle" x="5351.5" y="-816.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.id = &quot;prose&quot;</text>
<text text-anchor="middle" x="5351.5" y="-801.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.val = &quot;\n&quot;</text>
<text text-anchor="middle" x="5351.5" y="-786.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,l in ipairs(block.lines) do</text>
<text text-anchor="middle" x="5351.5" y="-770.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose.val = prose.val .. l .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5351.5" y="-755.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5351.5" y="-723.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose:parse()</text>
<text text-anchor="middle" x="5351.5" y="-708.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_44&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>codeblock_44&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5338.3132,-1078.7695C5340.0578,-1039.4421 5344.2605,-944.6999 5347.4562,-872.6592"/>
<polygon fill="#000000" stroke="#000000" points="5350.9534,-872.7981 5347.9001,-862.6528 5343.9603,-872.4878 5350.9534,-872.7981"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="5701.5,-799.5012 5517.5,-799.5012 5517.5,-763.5012 5701.5,-763.5012 5701.5,-799.5012"/>
<text text-anchor="middle" x="5609.5" y="-778.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(pr, new)</text>
</g>
<!-- codeblock_45&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_45&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5578.4169,-1078.7695C5583.9304,-1026.04 5599.8603,-873.6917 5606.5191,-810.0095"/>
<polygon fill="#000000" stroke="#000000" points="5610.0188,-810.1937 5607.5779,-799.8839 5603.0568,-809.4657 5610.0188,-810.1937"/>
</g>
</g>
</svg>