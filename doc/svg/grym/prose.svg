<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5727pt" height="1002pt"
 viewBox="0.00 0.00 5727.00 1001.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 997.8012)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-997.8012 5723,-997.8012 5723,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-975.8012" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-971.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 137</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-903.8012" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-899.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;107</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1915.5,-957.6325C1915.5,-949.9321 1915.5,-940.7755 1915.5,-932.2178"/>
<polygon fill="#000000" stroke="#000000" points="1919.0001,-932.2144 1915.5,-922.2144 1912.0001,-932.2145 1919.0001,-932.2144"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1665.5" cy="-831.8012" rx="76.9193" ry="18"/>
<text text-anchor="middle" x="1665.5" y="-827.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Prose module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1870.2269,-890.7625C1829.2816,-878.9703 1768.7485,-861.5367 1724.1187,-848.6833"/>
<polygon fill="#000000" stroke="#000000" points="1724.859,-845.2543 1714.2809,-845.8501 1722.9217,-851.9809 1724.859,-845.2543"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1792.5" cy="-831.8012" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1792.5" y="-827.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1887.5894,-887.4632C1868.6209,-876.3597 1843.5028,-861.6565 1823.8461,-850.1501"/>
<polygon fill="#000000" stroke="#000000" points="1825.3623,-846.9821 1814.964,-844.9508 1821.826,-853.0232 1825.3623,-846.9821"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="1915.5" cy="-831.8012" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1915.5" y="-827.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 5&#45;18</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1915.5,-885.6325C1915.5,-877.9321 1915.5,-868.7755 1915.5,-860.2178"/>
<polygon fill="#000000" stroke="#000000" points="1919.0001,-860.2144 1915.5,-850.2144 1912.0001,-860.2145 1919.0001,-860.2144"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-831.8012" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-827.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 21&#45;77</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1970.268,-893.638C2040.8937,-880.5322 2163.553,-857.7707 2238.7285,-843.8206"/>
<polygon fill="#000000" stroke="#000000" points="2239.8171,-847.1784 2249.0106,-841.9126 2238.5399,-840.2959 2239.8171,-847.1784"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="4630.5" cy="-831.8012" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4630.5" y="-827.6012" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 108&#45;137</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1980.9331,-902.0659C2346.2756,-892.3773 4132.2219,-845.0152 4545.1671,-834.0641"/>
<polygon fill="#000000" stroke="#000000" points="4545.3425,-837.5608 4555.2462,-833.7968 4545.1569,-830.5633 4545.3425,-837.5608"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="1539.5,-707.8025 1145.5,-707.8025 1145.5,-651.9996 1539.5,-651.9996 1539.5,-707.8025"/>
<text text-anchor="middle" x="1342.5" y="-660.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Here we need a proper recursive parser. &#160;Eventually.</text>
</g>
<!-- prose_3&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>prose_3&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1768.1439,-819.9764C1762.753,-817.6802 1757.0048,-815.4715 1751.5,-813.8012 1663.8177,-787.1956 1635.774,-805.7171 1548.5,-777.8012 1496.4315,-761.1462 1440.6111,-733.9822 1400.2289,-712.4879"/>
<polygon fill="#000000" stroke="#000000" points="1401.8059,-709.362 1391.3398,-707.7153 1398.4946,-715.5294 1401.8059,-709.362"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="1811.5,-777.7014 1557.5,-777.7014 1557.5,-582.1007 1811.5,-582.1007 1811.5,-777.7014"/>
<text text-anchor="middle" x="1684.5" y="-762.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1684.5" y="-731.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="1684.5" y="-715.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1684.5" y="-700.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1684.5" y="-669.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1684.5" y="-637.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local Link = require &quot;grym/link&quot;</text>
<text text-anchor="middle" x="1684.5" y="-590.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local Pr, pr = u.inherit(Node)</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_4&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1884.6313,-815.3486C1865.804,-805.0464 1841.4179,-791.2207 1820.5,-777.8012 1820.4082,-777.7422 1820.3163,-777.6833 1820.2245,-777.6243"/>
<polygon fill="#000000" stroke="#000000" points="1821.9163,-774.5498 1811.6234,-772.0385 1818.1037,-780.4204 1821.9163,-774.5498"/>
</g>
<!-- header_9 -->
<g id="node10" class="node">
<title>header_9</title>
<ellipse fill="none" stroke="#000000" cx="1918.5" cy="-679.901" rx="88.5398" ry="18"/>
<text text-anchor="middle" x="1918.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Bookend parsing</text>
</g>
<!-- section_5&#45;&gt;header_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;header_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2242.9038,-824.6654C2170.6894,-815.4277 2054.9532,-798.0866 2016.5,-777.8012 1983.8703,-760.5878 1955.1566,-728.8505 1937.3822,-706.1764"/>
<polygon fill="#000000" stroke="#000000" points="1939.9722,-703.8012 1931.1203,-697.9793 1934.4095,-708.0506 1939.9722,-703.8012"/>
</g>
<!-- prose_10 -->
<g id="node11" class="node">
<title>prose_10</title>
<ellipse fill="none" stroke="#000000" cx="2057.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2057.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;prose_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2246.5191,-822.5988C2193.8471,-813.0821 2120.5073,-796.9432 2098.5,-777.8012 2077.8557,-759.8446 2067.3662,-729.7828 2062.1969,-707.6991"/>
<polygon fill="#000000" stroke="#000000" points="2065.6152,-706.9464 2060.1219,-697.8869 2058.7666,-708.3947 2065.6152,-706.9464"/>
</g>
<!-- prose_11 -->
<g id="node12" class="node">
<title>prose_11</title>
<ellipse fill="none" stroke="#000000" cx="2139.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2139.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;prose_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2254.3781,-819.6831C2229.5526,-811.4144 2200.5279,-798.1742 2180.5,-777.8012 2161.6277,-758.6036 2150.9428,-729.4337 2145.2467,-707.9257"/>
<polygon fill="#000000" stroke="#000000" points="2148.6099,-706.9441 2142.8373,-698.06 2141.8098,-708.6049 2148.6099,-706.9441"/>
</g>
<!-- prose_12 -->
<g id="node13" class="node">
<title>prose_12</title>
<ellipse fill="none" stroke="#000000" cx="2221.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2221.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;prose_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2288.2506,-814.1086C2279.956,-803.9322 2269.9081,-790.65 2262.5,-777.8012 2249.4297,-755.1316 2238.2439,-727.4874 2230.8737,-707.3633"/>
<polygon fill="#000000" stroke="#000000" points="2234.14,-706.1028 2227.4742,-697.8677 2227.5497,-708.4622 2234.14,-706.1028"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="2303.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2303.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2303.5,-813.7797C2303.5,-787.7691 2303.5,-739.4414 2303.5,-708.5193"/>
<polygon fill="#000000" stroke="#000000" points="2307.0001,-708.3727 2303.5,-698.3727 2300.0001,-708.3728 2307.0001,-708.3727"/>
</g>
<!-- prose_14 -->
<g id="node15" class="node">
<title>prose_14</title>
<ellipse fill="none" stroke="#000000" cx="2385.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2385.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_14 -->
<g id="edge14" class="edge">
<title>section_5&#45;&gt;prose_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2318.7494,-814.1086C2327.044,-803.9322 2337.0919,-790.65 2344.5,-777.8012 2357.5703,-755.1316 2368.7561,-727.4874 2376.1263,-707.3633"/>
<polygon fill="#000000" stroke="#000000" points="2379.4503,-708.4622 2379.5258,-697.8677 2372.86,-706.1028 2379.4503,-708.4622"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="2711.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2711.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_5&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2342.6208,-817.2363C2421.3593,-787.9217 2597.9787,-722.1655 2674.7268,-693.5919"/>
<polygon fill="#000000" stroke="#000000" points="2676.2921,-696.7439 2684.4425,-689.9747 2673.8497,-690.1838 2676.2921,-696.7439"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="3118.5" cy="-679.901" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3118.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 47&#45;69</text>
</g>
<!-- section_5&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>section_5&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2367.1427,-827.0051C2454.5588,-819.7694 2616.432,-804.0445 2752.5,-777.8012 2863.9938,-756.2974 2991.5503,-719.277 3062.8064,-697.4453"/>
<polygon fill="#000000" stroke="#000000" points="3063.9513,-700.755 3072.4797,-694.4688 3061.8926,-694.0646 3063.9513,-700.755"/>
</g>
<!-- codeblock_17 -->
<g id="node18" class="node">
<title>codeblock_17</title>
<ellipse fill="none" stroke="#000000" cx="3682.5" cy="-679.901" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3682.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 71&#45;75</text>
</g>
<!-- section_5&#45;&gt;codeblock_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;codeblock_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2369.3742,-831.054C2518.6308,-828.6629 2893.7743,-818.7217 3204.5,-777.8012 3355.0653,-757.9727 3529.1732,-717.9028 3620.0072,-695.6666"/>
<polygon fill="#000000" stroke="#000000" points="3620.9906,-699.0292 3629.8659,-693.2431 3619.3195,-692.2316 3620.9906,-699.0292"/>
</g>
<!-- section_18 -->
<g id="node19" class="node">
<title>section_18</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-679.901" rx="70.655" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 78&#45;107</text>
</g>
<!-- section_5&#45;&gt;section_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;section_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2369.1489,-831.0398C2616.514,-827.9133 3492.2284,-814.449 3768.5,-777.8012 3902.2649,-760.057 4055.7708,-719.4169 4136.3566,-696.4673"/>
<polygon fill="#000000" stroke="#000000" points="4137.6391,-699.7408 4146.2891,-693.6229 4135.7119,-693.0113 4137.6391,-699.7408"/>
</g>
<!-- header_38 -->
<g id="node39" class="node">
<title>header_38</title>
<ellipse fill="none" stroke="#000000" cx="4512.5" cy="-679.901" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="4512.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Constructor</text>
</g>
<!-- section_6&#45;&gt;header_38 -->
<g id="edge38" class="edge">
<title>section_6&#45;&gt;header_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4616.733,-814.079C4596.0607,-787.4678 4556.8733,-737.0223 4532.8812,-706.1375"/>
<polygon fill="#000000" stroke="#000000" points="4535.4439,-703.7312 4526.5451,-697.9812 4529.9159,-708.0255 4535.4439,-703.7312"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="4630.5" cy="-679.901" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4630.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_6&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4630.5,-813.7797C4630.5,-787.7691 4630.5,-739.4414 4630.5,-708.5193"/>
<polygon fill="#000000" stroke="#000000" points="4634.0001,-708.3727 4630.5,-698.3727 4627.0001,-708.3728 4634.0001,-708.3727"/>
</g>
<!-- codeblock_40 -->
<g id="node41" class="node">
<title>codeblock_40</title>
<ellipse fill="none" stroke="#000000" cx="4795.5" cy="-679.901" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="4795.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 110&#45;121</text>
</g>
<!-- section_6&#45;&gt;codeblock_40 -->
<g id="edge40" class="edge">
<title>section_6&#45;&gt;codeblock_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4649.7505,-814.079C4679.1846,-786.9818 4735.463,-735.1715 4768.8177,-704.4649"/>
<polygon fill="#000000" stroke="#000000" points="4771.3855,-706.8583 4776.3721,-697.5103 4766.6444,-701.7084 4771.3855,-706.8583"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="5034.5" cy="-679.901" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5034.5" y="-675.701" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 123&#45;125</text>
</g>
<!-- section_6&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>section_6&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4700.332,-824.9605C4754.2257,-817.8994 4829.7586,-804.0632 4891.5,-777.8012 4934.9073,-759.3376 4978.7815,-726.7701 5006.2701,-704.2991"/>
<polygon fill="#000000" stroke="#000000" points="5008.793,-706.7538 5014.2564,-697.6762 5004.3246,-701.3655 5008.793,-706.7538"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="527,-415.001 0,-415.001 0,-344.4003 527,-344.4003 527,-415.001"/>
<text text-anchor="middle" x="263.5" y="-367.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;We need to generate parsers to match sequences of single characters, so</text>
<text text-anchor="middle" x="263.5" y="-352.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">that *bold*, **bold**, ***bold*** etc all work correctly.</text>
</g>
<!-- prose_10&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_10&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2055.7244,-661.7685C2052.4022,-638.8136 2042.976,-600.0852 2016.5,-582.0009 1948.5845,-535.6115 615.4121,-569.1822 536.5,-546.0009 451.0819,-520.9085 365.5169,-461.9626 313.53,-421.4437"/>
<polygon fill="#000000" stroke="#000000" points="315.5024,-418.542 305.4799,-415.1069 311.1727,-424.0424 315.5024,-418.542"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1079.5,-414.901 545.5,-414.901 545.5,-344.5003 1079.5,-344.5003 1079.5,-414.901"/>
<text text-anchor="middle" x="812.5" y="-383.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">Bookends are a fun construct borrowed from the [[LPEG manual][httk://]]]]</text>
<text text-anchor="middle" x="812.5" y="-368.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">model for Lua long strings. &#160;The GGG/Pegylator form of a bookend construct</text>
<text text-anchor="middle" x="812.5" y="-352.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">is </text>
</g>
<!-- prose_11&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_11&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2137.6928,-661.8145C2134.3364,-638.9093 2124.8733,-600.2347 2098.5,-582.0009 2006.1327,-518.1409 1196.138,-577.9991 1088.5,-546.0009 1002.4785,-520.4288 915.8883,-461.6045 863.22,-421.2431"/>
<polygon fill="#000000" stroke="#000000" points="865.1143,-418.2835 855.0636,-414.9318 860.8305,-423.8196 865.1143,-418.2835"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1401,-414.901 1098,-414.901 1098,-344.5003 1401,-344.5003 1401,-414.901"/>
<text text-anchor="middle" x="1249.5" y="-383.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">~#!peg</text>
<text text-anchor="middle" x="1249.5" y="-368.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;bookend = &quot;`&quot;:a !&quot;`&quot;:a pattern &#160;&quot;`&quot;:a</text>
<text text-anchor="middle" x="1249.5" y="-352.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">~#/peg</text>
</g>
<!-- prose_12&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>prose_12&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2219.6615,-661.8594C2216.2713,-639.0028 2206.7718,-600.3806 2180.5,-582.0009 2110.3204,-532.9034 1488.5594,-581.2499 1410.5,-546.0009 1352.8862,-519.9845 1305.285,-463.1465 1277.1462,-423.1901"/>
<polygon fill="#000000" stroke="#000000" points="1280.0063,-421.1724 1271.4404,-414.9372 1274.2484,-425.1532 1280.0063,-421.1724"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1967.5,-414.901 1419.5,-414.901 1419.5,-344.5003 1967.5,-344.5003 1967.5,-414.901"/>
<text text-anchor="middle" x="1693.5" y="-383.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">The =lpeg= engine doesn&#39;t model this directly but it&#39;s possible to provide</text>
<text text-anchor="middle" x="1693.5" y="-368.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">it. &#160;We only need the subset of this where =a= is unique, that is, =pattern=</text>
<text text-anchor="middle" x="1693.5" y="-352.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">does not contain =bookend= at any level of expansion. </text>
</g>
<!-- prose_13&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_13&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2301.37,-661.7826C2297.6836,-639.2151 2287.8836,-601.2859 2262.5,-582.0009 2160.4875,-504.4981 2097.774,-587.3028 1976.5,-546.0009 1890.8116,-516.8183 1802.5034,-459.8237 1747.8173,-420.7668"/>
<polygon fill="#000000" stroke="#000000" points="1749.8271,-417.901 1739.6662,-414.8999 1745.7378,-423.5824 1749.8271,-417.901"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2541,-422.3017 1986,-422.3017 1986,-337.0996 2541,-337.0996 2541,-422.3017"/>
<text text-anchor="middle" x="2263.5" y="-391.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">GGG being a specification format needn&#39;t respect this limitation. &#160;Orb</text>
<text text-anchor="middle" x="2263.5" y="-375.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">does so by design. &#160;It is a simple consquence of the sort of markup we are</text>
<text text-anchor="middle" x="2263.5" y="-360.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">using; there is no need to parse ***bold **inside bold** still bold*** twice,</text>
<text text-anchor="middle" x="2263.5" y="-345.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">and this generalizes to all text styles. </text>
</g>
<!-- prose_14&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>prose_14&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2378.2337,-662.0212C2360.1552,-617.5362 2312.6043,-500.5296 2284.7199,-431.9155"/>
<polygon fill="#000000" stroke="#000000" points="2287.9283,-430.5139 2280.9209,-422.5675 2281.4434,-433.1494 2287.9283,-430.5139"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3107.5,-415.001 2559.5,-415.001 2559.5,-344.4003 3107.5,-344.4003 3107.5,-415.001"/>
<text text-anchor="middle" x="2833.5" y="-383.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">We do have to wire them up so that we don&#39;t cross the streams. &#160;Sans macros.</text>
<text text-anchor="middle" x="2833.5" y="-368.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">By hand. </text>
</g>
<!-- prose_15&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_15&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2718.7663,-662.0212C2737.4923,-615.9428 2787.8398,-492.0547 2815.1985,-424.7344"/>
<polygon fill="#000000" stroke="#000000" points="2818.5392,-425.8103 2819.0617,-415.2284 2812.0542,-423.1748 2818.5392,-425.8103"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3667,-545.8015 3126,-545.8015 3126,-213.5998 3667,-213.5998 3667,-545.8015"/>
<text text-anchor="middle" x="3396.5" y="-530.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="3396.5" y="-515.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="3396.5" y="-500.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="3396.5" y="-484.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="3396.5" y="-469.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-437.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="3396.5" y="-422.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local Cg, C, P, Cmt, Cb = L.Cg, L.C, L.P, L.Cmt, L.Cb</text>
<text text-anchor="middle" x="3396.5" y="-407.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="3396.5" y="-391.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="3396.5" y="-376.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="3396.5" y="-360.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-345.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="3396.5" y="-330.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="3396.5" y="-314.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3396.5" y="-283.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-267.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-252.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-237.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="3396.5" y="-221.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_16&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3135.0576,-662.0212C3156.0404,-639.3628 3194.4465,-597.8896 3235.4796,-553.5797"/>
<polygon fill="#000000" stroke="#000000" points="3238.1278,-555.8712 3242.3544,-546.1559 3232.9918,-551.115 3238.1278,-555.8712"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3904,-406.9011 3685,-406.9011 3685,-352.5002 3904,-352.5002 3904,-406.9011"/>
<text text-anchor="middle" x="3794.5" y="-391.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.toMarkdown(prose)</text>
<text text-anchor="middle" x="3794.5" y="-376.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return prose.val</text>
<text text-anchor="middle" x="3794.5" y="-360.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_17&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_17&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3689.3375,-661.5741C3707.4074,-613.1401 3756.6927,-481.0379 3780.8226,-416.361"/>
<polygon fill="#000000" stroke="#000000" points="3784.1159,-417.5466 3784.3322,-406.954 3777.5574,-415.0998 3784.1159,-417.5466"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="3991.5" cy="-379.7006" rx="69.1756" ry="18"/>
<text text-anchor="middle" x="3991.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Link or Raw</text>
</g>
<!-- section_18&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_18&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4173.0381,-662.3625C4146.9774,-638.1268 4100.4452,-592.1404 4069.5,-546.0009 4039.0757,-500.638 4014.4464,-441.5323 4001.4771,-407.3802"/>
<polygon fill="#000000" stroke="#000000" points="4004.6112,-405.7681 3997.833,-397.6253 3998.0538,-408.2178 4004.6112,-405.7681"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="4110.5" cy="-379.7006" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4110.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_18&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4186.6088,-661.8018C4178.3412,-636.1557 4163.019,-587.7149 4151.5,-546.0009 4138.1441,-497.635 4124.5821,-440.7779 4116.8883,-407.6362"/>
<polygon fill="#000000" stroke="#000000" points="4120.2655,-406.7055 4114.6042,-397.7501 4113.4452,-408.2813 4120.2655,-406.7055"/>
</g>
<!-- prose_29 -->
<g id="node30" class="node">
<title>prose_29</title>
<ellipse fill="none" stroke="#000000" cx="4192.5" cy="-379.7006" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4192.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_29 -->
<g id="edge29" class="edge">
<title>section_18&#45;&gt;prose_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4192.5,-661.5741C4192.5,-610.896 4192.5,-468.6164 4192.5,-407.82"/>
<polygon fill="#000000" stroke="#000000" points="4196.0001,-407.7877 4192.5,-397.7878 4189.0001,-407.7878 4196.0001,-407.7877"/>
</g>
<!-- prose_30 -->
<g id="node31" class="node">
<title>prose_30</title>
<ellipse fill="none" stroke="#000000" cx="4274.5" cy="-379.7006" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4274.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_30 -->
<g id="edge30" class="edge">
<title>section_18&#45;&gt;prose_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4198.3912,-661.8018C4206.6588,-636.1557 4221.981,-587.7149 4233.5,-546.0009 4246.8559,-497.635 4260.4179,-440.7779 4268.1117,-407.6362"/>
<polygon fill="#000000" stroke="#000000" points="4271.5548,-408.2813 4270.3958,-397.7501 4264.7345,-406.7055 4271.5548,-408.2813"/>
</g>
<!-- prose_31 -->
<g id="node32" class="node">
<title>prose_31</title>
<ellipse fill="none" stroke="#000000" cx="4356.5" cy="-379.7006" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="4356.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_18&#45;&gt;prose_31 -->
<g id="edge31" class="edge">
<title>section_18&#45;&gt;prose_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4214.2834,-662.3853C4242.0444,-638.8661 4289.5369,-594.4016 4315.5,-546.0009 4339.4722,-501.3118 4349.7004,-442.3608 4353.8579,-407.9831"/>
<polygon fill="#000000" stroke="#000000" points="4357.3709,-408.0613 4355.0041,-397.7342 4350.4142,-407.2832 4357.3709,-408.0613"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="4489.5" cy="-379.7006" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="4489.5" y="-375.5006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 93&#45;105</text>
</g>
<!-- section_18&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>section_18&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4227.0061,-663.9786C4270.979,-642.3271 4347.2936,-600.0288 4397.5,-546.0009 4436.4433,-504.0934 4464.8369,-442.6682 4479.1073,-407.387"/>
<polygon fill="#000000" stroke="#000000" points="4482.4966,-408.3335 4482.917,-397.747 4475.9865,-405.7607 4482.4966,-408.3335"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3377,-124.0005 2822,-124.0005 2822,-53.3998 3377,-53.3998 3377,-124.0005"/>
<text text-anchor="middle" x="3099.5" y="-76.9002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The prose parser will be a proper recursive grammar. &#160;This calls for some</text>
<text text-anchor="middle" x="3099.5" y="-61.5002" font-family="Inconsolata" font-size="14.00" fill="#000000">enhancements to epnf to allow assignment of Node metatables to matched spans.</text>
</g>
<!-- prose_28&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>prose_28&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4112.2736,-361.6308C4114.5807,-326.7085 4113.9598,-250.1595 4069.5,-213.4003 4010.9317,-164.9764 3461.3176,-190.7216 3386.5,-177.4003 3324.2596,-166.3184 3256.6115,-145.8429 3202.6329,-127.3548"/>
<polygon fill="#000000" stroke="#000000" points="3203.6567,-124.0056 3193.062,-124.0486 3201.3711,-130.622 3203.6567,-124.0056"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3971.5,-116.0006 3395.5,-116.0006 3395.5,-61.3997 3971.5,-61.3997 3971.5,-116.0006"/>
<text text-anchor="middle" x="3683.5" y="-84.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ve been sloppy with the node constructor interface and will need to go through</text>
<text text-anchor="middle" x="3683.5" y="-69.5002" font-family="Inconsolata" font-size="14.00" fill="#000000">the whole =grym= directory and fix it into a consistent state. &#160;At some point.</text>
</g>
<!-- prose_29&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prose_29&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4193.7711,-361.689C4195.1158,-327.5501 4192.7698,-253.2813 4151.5,-213.4003 4095.6502,-159.43 4055.7734,-196.5293 3980.5,-177.4003 3912.2154,-160.0474 3836.0931,-137.2437 3778.0104,-119.1034"/>
<polygon fill="#000000" stroke="#000000" points="3778.7051,-115.6534 3768.1161,-116.0039 3776.6125,-122.3333 3778.7051,-115.6534"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="4559,-131.3012 3990,-131.3012 3990,-46.0991 4559,-46.0991 4559,-131.3012"/>
<text text-anchor="middle" x="4274.5" y="-100.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">Links give me a chance to design that interface to fit grammatically. For now,</text>
<text text-anchor="middle" x="4274.5" y="-84.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">we&#39;re going to handroll another Link class, and write a simple either&#45;or parser</text>
<text text-anchor="middle" x="4274.5" y="-69.5002" font-family="Inconsolata" font-size="14.00" fill="#000000">over prose strings that finds links and puts the rest in a =raw= class, which</text>
<text text-anchor="middle" x="4274.5" y="-54.1001" font-family="Inconsolata" font-size="14.00" fill="#000000">shouldn&#39;t need an intermediate Node class. </text>
</g>
<!-- prose_30&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>prose_30&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4274.5,-361.4973C4274.5,-318.2692 4274.5,-208.1039 4274.5,-141.7441"/>
<polygon fill="#000000" stroke="#000000" points="4278.0001,-141.4868 4274.5,-131.4868 4271.0001,-141.4868 4278.0001,-141.4868"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="5076,-108.6023 4577,-108.6023 4577,-68.7981 5076,-68.7981 5076,-108.6023"/>
<text text-anchor="middle" x="4826.5" y="-77.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">This Link class needs to fit the constructor semantics of =epeg.Csp=.</text>
</g>
<!-- prose_31&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>prose_31&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4355.3583,-361.687C4354.2549,-327.5445 4357.1065,-253.2699 4398.5,-213.4003 4453.8118,-160.1248 4493.4842,-197.8782 4567.5,-177.4003 4636.0674,-158.4299 4712.9977,-131.3191 4765.0698,-112.0728"/>
<polygon fill="#000000" stroke="#000000" points="4766.3386,-115.3353 4774.4959,-108.5744 4763.9029,-108.7727 4766.3386,-115.3353"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="5719,-177.601 5094,-177.601 5094,.2006 5719,.2006 5719,-177.601"/>
<text text-anchor="middle" x="5406.5" y="-162.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">function Pr.parse(prose)</text>
<text text-anchor="middle" x="5406.5" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local P, C, Ct, Cg = L.P, L.C, L.Ct, L.Cg</text>
<text text-anchor="middle" x="5406.5" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local raw_patt = (P(1) &#45; m.link)^1</text>
<text text-anchor="middle" x="5406.5" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local link_raw = L.match(Ct((Cg(m.link, &quot;link&quot;) + Cg(raw_patt, &quot;raw&quot;))^1), prose.val)</text>
<text text-anchor="middle" x="5406.5" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for _, v in ipairs(link_raw) do</text>
<text text-anchor="middle" x="5406.5" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if v[&quot;link&quot;] then</text>
<text text-anchor="middle" x="5406.5" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;io.write(v[&quot;link&quot;])</text>
<text text-anchor="middle" x="5406.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5406.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5406.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return prose</text>
<text text-anchor="middle" x="5406.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_32&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4493.4052,-361.5058C4502.0877,-326.0096 4526.6295,-247.9779 4580.5,-213.4003 4672.5923,-154.2896 4958.3995,-194.1571 5083.4879,-177.506"/>
<polygon fill="#000000" stroke="#000000" points="5084.2869,-180.9249 5093.6486,-175.9642 5083.2367,-174.0041 5084.2869,-180.9249"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="4643.5,-397.7006 4589.5,-397.7006 4589.5,-361.7006 4643.5,-361.7006 4643.5,-397.7006"/>
</g>
<!-- prose_39&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>prose_39&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4629.6453,-661.5741C4627.2819,-610.896 4620.6466,-468.6164 4617.8114,-407.82"/>
<polygon fill="#000000" stroke="#000000" points="4621.3056,-407.6138 4617.3435,-397.7878 4614.3132,-407.94 4621.3056,-407.6138"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="4957.5,-460.8014 4661.5,-460.8014 4661.5,-298.5999 4957.5,-298.5999 4957.5,-460.8014"/>
<text text-anchor="middle" x="4809.5" y="-445.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Prose, block)</text>
<text text-anchor="middle" x="4809.5" y="-430.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local prose = setmetatable({},Pr)</text>
<text text-anchor="middle" x="4809.5" y="-415.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.id = &quot;prose&quot;</text>
<text text-anchor="middle" x="4809.5" y="-399.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;prose.val = &quot;\n&quot;</text>
<text text-anchor="middle" x="4809.5" y="-384.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,l in ipairs(block.lines) do</text>
<text text-anchor="middle" x="4809.5" y="-368.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose.val = prose.val .. l .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4809.5" y="-353.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4809.5" y="-322.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return prose:parse()</text>
<text text-anchor="middle" x="4809.5" y="-306.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_40&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>codeblock_40&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4796.3547,-661.5741C4798.0826,-624.5221 4802.0941,-538.5054 4805.2344,-471.168"/>
<polygon fill="#000000" stroke="#000000" points="4808.7409,-471.1069 4805.7107,-460.9547 4801.7485,-470.7807 4808.7409,-471.1069"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="5159.5,-397.7006 4975.5,-397.7006 4975.5,-361.7006 5159.5,-361.7006 5159.5,-397.7006"/>
<text text-anchor="middle" x="5067.5" y="-376.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(pr, new)</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>codeblock_41&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5036.5146,-661.5741C5042.0855,-610.896 5057.7258,-468.6164 5064.4089,-407.82"/>
<polygon fill="#000000" stroke="#000000" points="5067.898,-408.1103 5065.5117,-397.7878 5060.9399,-407.3454 5067.898,-408.1103"/>
</g>
</g>
</svg>