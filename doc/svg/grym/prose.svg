<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="5367pt" height="754pt"
 viewBox="0.00 0.00 5366.50 754.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 750.2007)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-750.2007 5362.5,-750.2007 5362.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="667" cy="-728.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="667" y="-724.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">89 &#160;</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="667" cy="-656.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="667" y="-652.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">13 &#160;</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M667,-710.0321C667,-702.3317 667,-693.1751 667,-684.6174"/>
<polygon fill="#000000" stroke="#000000" points="670.5001,-684.6139 667,-674.614 663.5001,-684.614 670.5001,-684.6139"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="559" cy="-584.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="559" y="-580.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">le &#160;</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M647.6918,-643.3286C630.6445,-631.9637 605.5981,-615.2661 586.4656,-602.5111"/>
<polygon fill="#000000" stroke="#000000" points="588.4031,-599.5963 578.1411,-596.9614 584.5201,-605.4207 588.4031,-599.5963"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="631" cy="-584.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="631" y="-580.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;4 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M658.2854,-638.7715C654.0403,-630.2814 648.8464,-619.8936 644.1337,-610.4681"/>
<polygon fill="#000000" stroke="#000000" points="647.237,-608.8484 639.6343,-601.4694 640.976,-611.979 647.237,-608.8484"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="703" cy="-584.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="703" y="-580.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">13 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M675.7146,-638.7715C679.9597,-630.2814 685.1536,-619.8936 689.8663,-610.4681"/>
<polygon fill="#000000" stroke="#000000" points="693.024,-611.979 694.3657,-601.4694 686.763,-608.8484 693.024,-611.979"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1616" cy="-584.2007" rx="27" ry="18"/>
<text text-anchor="middle" x="1616" y="-580.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">62 &#160;</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M693.8731,-654.1619C827.8873,-643.9943 1423.6814,-598.7918 1578.9171,-587.0142"/>
<polygon fill="#000000" stroke="#000000" points="1579.2024,-590.5027 1588.9089,-586.2561 1578.6728,-583.5227 1579.2024,-590.5027"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="621.5,-530.4022 318.5,-530.4022 318.5,-474.5992 621.5,-474.5992 621.5,-530.4022"/>
<text text-anchor="middle" x="470" y="-499.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Here we need a proper recursive parser.</text>
</g>
<!-- block_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>block_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M609.2868,-573.1823C589.931,-563.3601 560.605,-548.4785 533.8464,-534.8998"/>
<polygon fill="#000000" stroke="#000000" points="535.3896,-531.7581 524.8882,-530.3539 532.2219,-538.0004 535.3896,-531.7581"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="667" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="667" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">11 &#160;</text>
</g>
<!-- block_4&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>block_4&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M695.3653,-566.8742C690.5447,-555.9341 684.2194,-541.5793 678.7655,-529.2018"/>
<polygon fill="#000000" stroke="#000000" points="681.8588,-527.5419 674.6237,-519.8022 675.4531,-530.3645 681.8588,-527.5419"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="766,-522.5007 712,-522.5007 712,-482.5007 766,-482.5007 766,-522.5007"/>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M710.6347,-566.8742C715.0851,-556.7743 720.8179,-543.764 725.9636,-532.0861"/>
<polygon fill="#000000" stroke="#000000" points="729.2774,-533.2454 730.1069,-522.6831 722.8717,-530.4228 729.2774,-533.2454"/>
</g>
<!-- header_10 -->
<g id="node11" class="node">
<title>header_10</title>
<ellipse fill="none" stroke="#000000" cx="1302" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1302" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">ng &#160;</text>
</g>
<!-- section_5&#45;&gt;header_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;header_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1588.6961,-583.0425C1537.3979,-579.9872 1424.0458,-569.0237 1338,-530.2007 1333.8443,-528.3257 1329.7296,-525.8849 1325.8493,-523.2294"/>
<polygon fill="#000000" stroke="#000000" points="1327.9079,-520.3984 1317.8043,-517.2097 1323.7141,-526.0032 1327.9079,-520.3984"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="1374" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1374" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">18 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1589.4561,-580.7023C1549.0441,-574.6283 1470.411,-559.8383 1410,-530.2007 1406.0972,-528.286 1402.206,-525.9115 1398.5023,-523.364"/>
<polygon fill="#000000" stroke="#000000" points="1400.3936,-520.4086 1390.2834,-517.2408 1396.2115,-526.022 1400.3936,-520.4086"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="1446" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1446" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">22 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1591.3611,-576.5345C1563.7567,-567.4386 1518.1437,-550.869 1482,-530.2007 1478.2263,-528.0428 1474.4085,-525.5298 1470.7406,-522.9147"/>
<polygon fill="#000000" stroke="#000000" points="1472.6402,-519.9638 1462.5456,-516.7466 1468.4307,-525.5567 1472.6402,-519.9638"/>
</g>
<!-- block_13 -->
<g id="node14" class="node">
<title>block_13</title>
<ellipse fill="none" stroke="#000000" cx="1518" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1518" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">26 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;block_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1598.9297,-569.9697C1583.4719,-557.0829 1560.5052,-537.9362 1542.9826,-523.328"/>
<polygon fill="#000000" stroke="#000000" points="1544.7968,-520.2838 1534.8747,-516.5687 1540.3144,-525.6604 1544.7968,-520.2838"/>
</g>
<!-- block_14 -->
<g id="node15" class="node">
<title>block_14</title>
<ellipse fill="none" stroke="#000000" cx="1665" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="1665" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">30 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_14 -->
<g id="edge14" class="edge">
<title>section_5&#45;&gt;block_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1626.1528,-567.2724C1632.9199,-555.9893 1641.9418,-540.9467 1649.5878,-528.1982"/>
<polygon fill="#000000" stroke="#000000" points="1652.7183,-529.7834 1654.8602,-519.4073 1646.7152,-526.183 1652.7183,-529.7834"/>
</g>
<!-- block_15 -->
<g id="node16" class="node">
<title>block_15</title>
<ellipse fill="none" stroke="#000000" cx="2048" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="2048" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">35 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_15 -->
<g id="edge15" class="edge">
<title>section_5&#45;&gt;block_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.0507,-579.274C1715.9495,-565.2982 1927.0429,-525.3762 2011.9667,-509.3153"/>
<polygon fill="#000000" stroke="#000000" points="2012.74,-512.7312 2021.9154,-507.4338 2011.4391,-505.8531 2012.74,-512.7312"/>
</g>
<!-- block_16 -->
<g id="node17" class="node">
<title>block_16</title>
<ellipse fill="none" stroke="#000000" cx="2524" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="2524" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">38 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_16 -->
<g id="edge16" class="edge">
<title>section_5&#45;&gt;block_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1643.1746,-581.7556C1773.7122,-570.0101 2336.2499,-519.3941 2486.8143,-505.8466"/>
<polygon fill="#000000" stroke="#000000" points="2487.2853,-509.3185 2496.9313,-504.9363 2486.6579,-502.3466 2487.2853,-509.3185"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="3247" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="3247" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">62 &#160;</text>
</g>
<!-- section_5&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.9483,-582.8508C1834.3751,-573.2619 2987.2813,-515.5105 3209.8317,-504.3625"/>
<polygon fill="#000000" stroke="#000000" points="3210.1967,-507.8487 3220.009,-503.8527 3209.8464,-500.8575 3210.1967,-507.8487"/>
</g>
<!-- section_18 -->
<g id="node19" class="node">
<title>section_18</title>
<ellipse fill="none" stroke="#000000" cx="3930" cy="-502.5007" rx="27" ry="18"/>
<text text-anchor="middle" x="3930" y="-498.3007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">89 &#160;</text>
</g>
<!-- section_5&#45;&gt;section_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;section_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.9826,-583.432C1800.4579,-578.9236 2616.7554,-555.253 3283,-530.2007 3514.9762,-521.4779 3793.6394,-508.8064 3892.7734,-504.2302"/>
<polygon fill="#000000" stroke="#000000" points="3893.0562,-507.721 3902.8839,-503.7628 3892.7329,-500.7284 3893.0562,-507.721"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="254,-438.6017 0,-438.6017 0,-353.3996 254,-353.3996 254,-438.6017"/>
<text text-anchor="middle" x="127" y="-423.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="127" y="-408.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;util&quot;</text>
<text text-anchor="middle" x="127" y="-392.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="127" y="-361.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_7&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M651.2245,-487.7037C645.054,-482.761 637.6303,-477.762 630,-474.8007 480.3429,-416.7184 425.8246,-469.3247 264.4767,-438.9287"/>
<polygon fill="#000000" stroke="#000000" points="264.6872,-435.4031 254.1999,-436.9085 263.337,-442.2717 264.6872,-435.4031"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="799.5,-431.301 272.5,-431.301 272.5,-360.7003 799.5,-360.7003 799.5,-431.301"/>
<text text-anchor="middle" x="536" y="-400.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;We need to generate parsers to match sequences of single characters, so</text>
<text text-anchor="middle" x="536" y="-384.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">that *bold*, **bold**, ***bold*** etc all work correctly.</text>
</g>
<!-- block_11&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_11&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1358.758,-487.5805C1352.7659,-482.6244 1345.5227,-477.6485 1338,-474.8007 1227.8043,-433.0849 926.0928,-451.9381 809,-438.8007 793.01,-437.0067 776.524,-434.9481 759.9464,-432.7251"/>
<polygon fill="#000000" stroke="#000000" points="759.9966,-429.1998 749.6162,-431.3206 759.0535,-436.136 759.9966,-429.1998"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1352,-431.201 818,-431.201 818,-360.8002 1352,-360.8002 1352,-431.201"/>
<text text-anchor="middle" x="1085" y="-415.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">Bookends are a fun construct borrowed from the [[LPEG manual][httk://]]]]</text>
<text text-anchor="middle" x="1085" y="-400.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">model for Lua long strings. &#160;The GGG/Pegylator form of a bookend construct</text>
<text text-anchor="middle" x="1085" y="-385.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">is </text>
</g>
<!-- block_12&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_12&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1429.7522,-487.6871C1423.8786,-482.9823 1416.9695,-478.1403 1410,-474.8007 1374.7648,-457.9168 1335.5956,-444.4643 1296.9957,-433.8058"/>
<polygon fill="#000000" stroke="#000000" points="1297.7641,-430.3879 1287.1972,-431.1558 1295.9366,-437.1452 1297.7641,-430.3879"/>
</g>
<!-- codeblock_21 -->
<g id="node22" class="node">
<title>codeblock_21</title>
<ellipse fill="none" stroke="#000000" cx="1397" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="1397" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">25 &#160;</text>
</g>
<!-- block_13&#45;&gt;codeblock_21 -->
<g id="edge21" class="edge">
<title>block_13&#45;&gt;codeblock_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1500.1146,-488.6142C1494.3523,-484.1738 1487.9248,-479.2557 1482,-474.8007 1460.4011,-458.56 1452.7257,-457.2715 1433,-438.8007 1426.9203,-433.1078 1420.8729,-426.4244 1415.5188,-420.0536"/>
<polygon fill="#000000" stroke="#000000" points="1418.1885,-417.7892 1409.1575,-412.2492 1412.7625,-422.2118 1418.1885,-417.7892"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1496,-414.0006 1442,-414.0006 1442,-378.0006 1496,-378.0006 1496,-414.0006"/>
</g>
<!-- block_13&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_13&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.9086,-484.9144C1502.2349,-468.2358 1490.5866,-442.9184 1481.6795,-423.5592"/>
<polygon fill="#000000" stroke="#000000" points="1484.7915,-421.9492 1477.4321,-414.3276 1478.4323,-424.8751 1484.7915,-421.9492"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2062,-431.201 1514,-431.201 1514,-360.8002 2062,-360.8002 2062,-431.201"/>
<text text-anchor="middle" x="1788" y="-415.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">The =lpeg= engine doesn&#39;t model this directly but it&#39;s possible to provide</text>
<text text-anchor="middle" x="1788" y="-400.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">it. &#160;We only need the subset of this where =a= is unique, that is, =pattern=</text>
<text text-anchor="middle" x="1788" y="-385.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">does not contain =bookend= at any level of expansion. </text>
</g>
<!-- block_14&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_14&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1681.5883,-488.1376C1696.4736,-475.2492 1719.0769,-455.678 1739.6285,-437.8833"/>
<polygon fill="#000000" stroke="#000000" points="1742.1154,-440.3597 1747.3843,-431.1679 1737.5333,-435.0677 1742.1154,-440.3597"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2635.5,-438.6017 2080.5,-438.6017 2080.5,-353.3996 2635.5,-353.3996 2635.5,-438.6017"/>
<text text-anchor="middle" x="2358" y="-423.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">GGG being a specification format needn&#39;t respect this limitation. &#160;Orb</text>
<text text-anchor="middle" x="2358" y="-408.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">does so by design. &#160;It is a simple consquence of the sort of markup we are</text>
<text text-anchor="middle" x="2358" y="-392.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">using; there is no need to parse ***bold **inside bold** still bold*** twice,</text>
<text text-anchor="middle" x="2358" y="-377.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">and this generalizes to all text styles. </text>
</g>
<!-- block_15&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_15&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2072.0672,-494.2324C2105.015,-482.9133 2166.6638,-461.7339 2224.3056,-441.9312"/>
<polygon fill="#000000" stroke="#000000" points="2225.5692,-445.1979 2233.8894,-438.6386 2223.2948,-438.5777 2225.5692,-445.1979"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="3202,-423.3011 2654,-423.3011 2654,-368.7002 3202,-368.7002 3202,-423.3011"/>
<text text-anchor="middle" x="2928" y="-408.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">We do have to wire them up so that we don&#39;t cross the streams. &#160;Sans macros.</text>
<text text-anchor="middle" x="2928" y="-392.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">By hand. </text>
</g>
<!-- block_16&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_16&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2549.272,-495.8386C2601.1903,-482.1522 2722.6577,-450.1317 2814.1322,-426.0178"/>
<polygon fill="#000000" stroke="#000000" points="2815.2297,-429.3481 2824.0071,-423.4146 2813.4453,-422.5794 2815.2297,-429.3481"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="3247" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="3247" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">60 &#160;</text>
</g>
<!-- block_17&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>block_17&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3247,-484.4344C3247,-467.9869 3247,-443.4335 3247,-424.3691"/>
<polygon fill="#000000" stroke="#000000" points="3250.5001,-424.1555 3247,-414.1555 3243.5001,-424.1556 3250.5001,-424.1555"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="3346,-416.0006 3292,-416.0006 3292,-376.0006 3346,-376.0006 3346,-416.0006"/>
</g>
<!-- block_17&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_17&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3258.25,-485.8601C3269.2939,-469.5242 3286.361,-444.2792 3299.5965,-424.7016"/>
<polygon fill="#000000" stroke="#000000" points="3302.6715,-426.4024 3305.3727,-416.1577 3296.8724,-422.4819 3302.6715,-426.4024"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="3822" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="3822" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">aw &#160;</text>
</g>
<!-- section_18&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_18&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3912.7762,-488.4954C3897.7744,-476.0133 3875.7128,-456.9618 3858,-438.8007 3852.407,-433.0661 3846.6801,-426.5827 3841.4864,-420.4286"/>
<polygon fill="#000000" stroke="#000000" points="3843.8682,-417.8166 3834.7974,-412.342 3838.4743,-422.2783 3843.8682,-417.8166"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="3894" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="3894" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">67 &#160;</text>
</g>
<!-- section_18&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_18&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3924.0553,-484.9144C3918.3752,-468.1107 3909.731,-442.5381 3903.1687,-423.1246"/>
<polygon fill="#000000" stroke="#000000" points="3906.4715,-421.9657 3899.9535,-413.6131 3899.8401,-424.2073 3906.4715,-421.9657"/>
</g>
<!-- block_32 -->
<g id="node33" class="node">
<title>block_32</title>
<ellipse fill="none" stroke="#000000" cx="3966" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="3966" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">70 &#160;</text>
</g>
<!-- section_18&#45;&gt;block_32 -->
<g id="edge32" class="edge">
<title>section_18&#45;&gt;block_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3935.9447,-484.9144C3941.6248,-468.1107 3950.269,-442.5381 3956.8313,-423.1246"/>
<polygon fill="#000000" stroke="#000000" points="3960.1599,-424.2073 3960.0465,-413.6131 3953.5285,-421.9657 3960.1599,-424.2073"/>
</g>
<!-- block_33 -->
<g id="node34" class="node">
<title>block_33</title>
<ellipse fill="none" stroke="#000000" cx="4298" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="4298" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">75 &#160;</text>
</g>
<!-- section_18&#45;&gt;block_33 -->
<g id="edge33" class="edge">
<title>section_18&#45;&gt;block_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3955.0048,-495.2642C4019.1241,-476.708 4189.5215,-427.3945 4263.2239,-406.0649"/>
<polygon fill="#000000" stroke="#000000" points="4264.328,-409.3891 4272.9608,-403.247 4262.382,-402.665 4264.328,-409.3891"/>
</g>
<!-- block_34 -->
<g id="node35" class="node">
<title>block_34</title>
<ellipse fill="none" stroke="#000000" cx="4869" cy="-396.0006" rx="27" ry="18"/>
<text text-anchor="middle" x="4869" y="-391.8006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">89 &#160;</text>
</g>
<!-- section_18&#45;&gt;block_34 -->
<g id="edge34" class="edge">
<title>section_18&#45;&gt;block_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3957.0898,-499.4282C4090.5552,-484.2908 4677.9198,-417.6727 4831.9233,-400.2058"/>
<polygon fill="#000000" stroke="#000000" points="4832.7086,-403.6393 4842.2505,-399.0345 4831.9197,-396.6839 4832.7086,-403.6393"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1548.5,-176.6003 1245.5,-176.6003 1245.5,-140.6003 1548.5,-140.6003 1548.5,-176.6003"/>
<text text-anchor="middle" x="1397" y="-155.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;bookend = &quot;`&quot;:a !&quot;`&quot;:a pattern &#160;&quot;`&quot;:a</text>
</g>
<!-- codeblock_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1397,-377.7664C1397,-336.6836 1397,-236.623 1397,-187.1951"/>
<polygon fill="#000000" stroke="#000000" points="1400.5001,-186.8966 1397,-176.8966 1393.5001,-186.8967 1400.5001,-186.8966"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="3086.5,-317.3009 2545.5,-317.3009 2545.5,.1003 3086.5,.1003 3086.5,-317.3009"/>
<text text-anchor="middle" x="2816" y="-302.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="2816" y="-286.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="2816" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="2816" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="2816" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2816" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="2816" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="2816" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="2816" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="2816" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="2816" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="2816" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="2816" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2816" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="2816" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="2816" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="2816" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="2816" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>codeblock_27&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3236.4626,-379.3348C3230.0718,-370.4424 3221.1916,-359.9684 3211,-353.2006 3168.5781,-325.0296 3147.0416,-337.073 3096.0556,-317.3885"/>
<polygon fill="#000000" stroke="#000000" points="3097.1225,-314.0431 3086.5424,-313.4841 3094.4647,-320.5189 3097.1225,-314.0431"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3659.5,-193.9006 3104.5,-193.9006 3104.5,-123.2999 3659.5,-123.2999 3659.5,-193.9006"/>
<text text-anchor="middle" x="3382" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The prose parser will be a proper recursive grammar. &#160;This calls for some</text>
<text text-anchor="middle" x="3382" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">enhancements to epnf to allow assignment of Node metatables to matched spans.</text>
</g>
<!-- block_31&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_31&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3883.7449,-378.8825C3877.4425,-369.8486 3868.5566,-359.3837 3858,-353.2006 3784.2147,-309.9833 3749.4271,-346.2433 3669,-317.2006 3586.2391,-287.3151 3498.7926,-235.7015 3442.4882,-199.4918"/>
<polygon fill="#000000" stroke="#000000" points="3444.365,-196.5374 3434.0682,-194.0422 3440.5615,-202.414 3444.365,-196.5374"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4254,-185.9007 3678,-185.9007 3678,-131.2999 4254,-131.2999 4254,-185.9007"/>
<text text-anchor="middle" x="3966" y="-170.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;ve been sloppy with the node constructor interface and will need to go through</text>
<text text-anchor="middle" x="3966" y="-155.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">the whole =grym= directory and fix it into a consistent state. &#160;At some point.</text>
</g>
<!-- block_32&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>block_32&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3966,-377.7664C3966,-339.0657 3966,-248.0282 3966,-196.2822"/>
<polygon fill="#000000" stroke="#000000" points="3969.5001,-196.1767 3966,-186.1767 3962.5001,-196.1768 3969.5001,-196.1767"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4841.5,-201.2013 4272.5,-201.2013 4272.5,-115.9992 4841.5,-115.9992 4841.5,-201.2013"/>
<text text-anchor="middle" x="4557" y="-186.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">Links give me a chance to design that interface to fit grammatically. For now,</text>
<text text-anchor="middle" x="4557" y="-170.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">we&#39;re going to handroll another Link class, and write a simple either&#45;or parser</text>
<text text-anchor="middle" x="4557" y="-155.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">over prose strings that finds links and puts the rest in a =raw= class, which</text>
<text text-anchor="middle" x="4557" y="-140.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">shouldn&#39;t need an intermediate Node class. </text>
</g>
<!-- block_33&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>block_33&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4314.2016,-381.1502C4351.2132,-347.2252 4443.3574,-262.7655 4502.8892,-208.1984"/>
<polygon fill="#000000" stroke="#000000" points="4505.335,-210.7044 4510.3419,-201.3673 4500.6051,-205.5442 4505.335,-210.7044"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="5358.5,-274.5007 4859.5,-274.5007 4859.5,-42.6999 5358.5,-42.6999 5358.5,-274.5007"/>
<text text-anchor="middle" x="5109" y="-259.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">This Link class needs to fit the constructor semantics of =epeg.Csp=.</text>
</g>
<!-- block_34&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_34&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4884.3782,-380.789C4905.2209,-360.172 4944.4385,-321.3793 4984.3436,-281.9064"/>
<polygon fill="#000000" stroke="#000000" points="4987.1504,-284.053 4991.7985,-274.5322 4982.2277,-279.0764 4987.1504,-284.053"/>
</g>
</g>
</svg>