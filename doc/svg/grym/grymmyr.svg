<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3080pt" height="1134pt"
 viewBox="0.00 0.00 3079.78 1133.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1129.6014)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1129.6014 3075.7848,-1129.6014 3075.7848,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1056.2848" cy="-1107.6014" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1056.2848" y="-1103.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 125</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1056.2848" cy="-1035.6014" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1056.2848" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;125</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1056.2848,-1089.4327C1056.2848,-1081.7323 1056.2848,-1072.5757 1056.2848,-1064.018"/>
<polygon fill="#000000" stroke="#000000" points="1059.7849,-1064.0146 1056.2848,-1054.0146 1052.7849,-1064.0147 1059.7849,-1064.0146"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="555.2848" cy="-963.6014" rx="96.1863" ry="18"/>
<text text-anchor="middle" x="555.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grimoire Grammar</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M996.484,-1028.095C918.8667,-1018.2036 779.27,-999.9072 660.2848,-981.6014 652.1388,-980.3481 643.6471,-978.9857 635.177,-977.5902"/>
<polygon fill="#000000" stroke="#000000" points="635.7045,-974.13 625.2657,-975.9413 634.5557,-981.0351 635.7045,-974.13"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="701.2848" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="701.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M994.485,-1029.4715C930.4123,-1022.078 827.8357,-1007.3172 742.2848,-981.6014 739.8745,-980.8769 737.4182,-980.0477 734.966,-979.152"/>
<polygon fill="#000000" stroke="#000000" points="736.2202,-975.8843 725.6344,-975.4478 733.6375,-982.3905 736.2202,-975.8843"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="824.2848" cy="-963.6014" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="824.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1012.6474,-1022.0587C974.9352,-1010.3549 920.2336,-993.3786 879.4852,-980.7325"/>
<polygon fill="#000000" stroke="#000000" points="880.2957,-977.3195 869.7077,-977.6981 878.2209,-984.0049 880.2957,-977.3195"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="992.2848" cy="-963.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="992.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 29&#45;31</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1040.4646,-1017.8036C1032.7722,-1009.1497 1023.387,-998.5913 1014.9504,-989.1002"/>
<polygon fill="#000000" stroke="#000000" points="1017.4044,-986.5928 1008.1448,-981.4439 1012.1726,-991.2433 1017.4044,-986.5928"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1120.2848" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1120.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1072.105,-1017.8036C1080.1664,-1008.7345 1090.0869,-997.574 1098.8264,-987.7421"/>
<polygon fill="#000000" stroke="#000000" points="1101.4963,-990.0066 1105.524,-980.2072 1096.2644,-985.356 1101.4963,-990.0066"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1442.2848" cy="-963.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1442.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 36&#45;57</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1110.7705,-1025.4382C1179.187,-1012.6766 1296.6857,-990.7598 1371.8591,-976.7378"/>
<polygon fill="#000000" stroke="#000000" points="1372.5317,-980.1728 1381.7203,-974.8984 1371.248,-973.2915 1372.5317,-980.1728"/>
</g>
<!-- prose_8 -->
<g id="node9" class="node">
<title>prose_8</title>
<ellipse fill="none" stroke="#000000" cx="1883.2848" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1883.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;prose_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1119.123,-1030.1306C1280.3976,-1016.0897 1705.7578,-979.0572 1841.2164,-967.2639"/>
<polygon fill="#000000" stroke="#000000" points="1841.5446,-970.7487 1851.2033,-966.3944 1840.9374,-963.7751 1841.5446,-970.7487"/>
</g>
<!-- codeblock_9 -->
<g id="node10" class="node">
<title>codeblock_9</title>
<ellipse fill="none" stroke="#000000" cx="2394.2848" cy="-963.6014" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2394.2848" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 65&#45;124</text>
</g>
<!-- section_1&#45;&gt;codeblock_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;codeblock_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1120.8193,-1032.1287C1339.1267,-1020.3812 2050.4201,-982.1053 2303.7071,-968.4755"/>
<polygon fill="#000000" stroke="#000000" points="2304.1759,-971.9554 2313.9733,-967.9231 2303.7997,-964.9656 2304.1759,-971.9554"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="66.2848,-474.8007 12.2848,-474.8007 12.2848,-434.8007 66.2848,-434.8007 66.2848,-474.8007"/>
</g>
<!-- prose_3&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M677.0594,-951.2968C671.6604,-949.0304 665.8758,-946.9552 660.2848,-945.6014 596.991,-930.2749 121.7355,-955.2449 75.2848,-909.6014 -42.282,-794.0777 7.5003,-565.8427 30.246,-484.4768"/>
<polygon fill="#000000" stroke="#000000" points="33.6107,-485.4403 33.001,-474.8631 26.8816,-483.512 33.6107,-485.4403"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="611.7848,-605.6013 84.7848,-605.6013 84.7848,-304.0001 611.7848,-304.0001 611.7848,-605.6013"/>
<text text-anchor="middle" x="348.2848" y="-590.501" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="348.2848" y="-575.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;../peg/epeg&quot;</text>
<text text-anchor="middle" x="348.2848" y="-559.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;../peg/epnf&quot;</text>
<text text-anchor="middle" x="348.2848" y="-528.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="348.2848" y="-512.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="348.2848" y="-497.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="348.2848" y="-482.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="348.2848" y="-466.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B &#160;&#45;&#45; match iff the pattern precedes the use of B</text>
<text text-anchor="middle" x="348.2848" y="-451.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="348.2848" y="-435.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="348.2848" y="-420.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cg = lpeg.Cg &#45;&#45; named capture group (for **balanced highlighting**)</text>
<text text-anchor="middle" x="348.2848" y="-405.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cb = lpeg.Cb &#45;&#45; Back capture</text>
<text text-anchor="middle" x="348.2848" y="-389.7006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cmt = lpeg.Cmt &#45;&#45; match&#45;time capture</text>
<text text-anchor="middle" x="348.2848" y="-374.3005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="348.2848" y="-358.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="348.2848" y="-327.5005" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;AZ&quot; + R&quot;az&quot; &#160;&#160;</text>
<text text-anchor="middle" x="348.2848" y="-312.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>codeblock_4&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M770.3796,-951.4699C714.406,-938.5246 633.3233,-918.6601 621.2848,-909.6014 522.4544,-835.2335 452.1826,-713.7167 407.706,-614.9924"/>
<polygon fill="#000000" stroke="#000000" points="410.8836,-613.5243 403.6158,-605.8151 404.4898,-616.3739 410.8836,-613.5243"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="884.2848,-472.8007 630.2848,-472.8007 630.2848,-436.8007 884.2848,-436.8007 884.2848,-472.8007"/>
<text text-anchor="middle" x="757.2848" y="-451.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local punctuation = S&quot;!?,.:;\\^%~&quot;</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_5&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M948.6727,-948.6467C929.2502,-939.9877 907.5828,-927.2461 893.2848,-909.6014 785.7239,-776.8645 763.1831,-560.8684 758.4997,-483.4993"/>
<polygon fill="#000000" stroke="#000000" points="761.9727,-482.9098 757.9303,-473.1165 754.9833,-483.2932 761.9727,-482.9098"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1338.2848,-482.1011 902.2848,-482.1011 902.2848,-427.5003 1338.2848,-427.5003 1338.2848,-482.1011"/>
<text text-anchor="middle" x="1120.2848" y="-451.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> Interior symbols are valid within a prose word, but not if </text>
<text text-anchor="middle" x="1120.2848" y="-435.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> preceded by whitespace</text>
</g>
<!-- prose_6&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_6&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1120.2848,-945.4929C1120.2848,-871.8879 1120.2848,-594.2296 1120.2848,-492.4745"/>
<polygon fill="#000000" stroke="#000000" points="1123.7849,-492.3491 1120.2848,-482.3491 1116.7849,-492.3492 1123.7849,-492.3491"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1918.2848,-613.5013 1356.2848,-613.5013 1356.2848,-296.1001 1918.2848,-296.1001 1918.2848,-613.5013"/>
<text text-anchor="middle" x="1637.2848" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local interior = S&quot;*_&#45;/@#&quot;</text>
<text text-anchor="middle" x="1637.2848" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local sym = letter + digit + punctuation + interior</text>
<text text-anchor="middle" x="1637.2848" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local first_letter = letter + digit + punctuation</text>
<text text-anchor="middle" x="1637.2848" y="-552.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;,&#39; + P&#39;\09&#39; &#45;&#45; Not accurate, refine (needs Unicode spaces)</text>
<text text-anchor="middle" x="1637.2848" y="-536.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1637.2848" y="-505.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="1637.2848" y="-489.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="1637.2848" y="-474.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="1637.2848" y="-459.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="1637.2848" y="-443.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1637.2848" y="-412.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="1637.2848" y="-396.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="1637.2848" y="-381.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="1637.2848" y="-366.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="1637.2848" y="-350.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="1637.2848" y="-335.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="1637.2848" y="-319.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="1637.2848" y="-304.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_7&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1449.2249,-945.4929C1468.8801,-894.2079 1526.5014,-743.8604 1572.8317,-622.9738"/>
<polygon fill="#000000" stroke="#000000" points="1576.1183,-624.1783 1576.4289,-613.588 1569.5819,-621.6732 1576.1183,-624.1783"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2456.2848,-505.3008 1936.2848,-505.3008 1936.2848,-404.3005 2456.2848,-404.3005 2456.2848,-505.3008"/>
<text text-anchor="middle" x="2196.2848" y="-474.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> The Grimoire grammar is a specially&#45;massaged closure to be executed</text>
<text text-anchor="middle" x="2196.2848" y="-458.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> in the epnf context. </text>
<text text-anchor="middle" x="2196.2848" y="-443.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="2196.2848" y="-427.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> The advantage of this approach is that we can make it look much like an</text>
<text text-anchor="middle" x="2196.2848" y="-412.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> actual grammar. This should aid in porting to target languages. </text>
</g>
<!-- prose_8&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>prose_8&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1897.8273,-947.0828C1906.7414,-936.643 1918.1544,-922.6952 1927.2848,-909.6014 2022.1475,-773.5597 2117.1842,-602.8403 2164.8374,-514.2724"/>
<polygon fill="#000000" stroke="#000000" points="2167.9313,-515.9088 2169.5775,-505.4426 2161.7638,-512.5978 2167.9313,-515.9088"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="3071.7848,-909.4021 2474.7848,-909.4021 2474.7848,-.1992 3071.7848,-.1992 3071.7848,-909.4021"/>
<text text-anchor="middle" x="2773.2848" y="-894.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local _grym_fn = function ()</text>
<text text-anchor="middle" x="2773.2848" y="-879.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function grymmyr (_ENV)</text>
<text text-anchor="middle" x="2773.2848" y="-863.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;START &quot;grym&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-848.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;SUPPRESS (&quot;structure&quot;, &quot;structured&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-816.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local prose_word = first_letter * (sym^1)^0</text>
<text text-anchor="middle" x="2773.2848" y="-801.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local prose_span = (prose_word + WS^1)^1</text>
<text text-anchor="middle" x="2773.2848" y="-786.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local NEOL = NL + &#45;P(1)</text>
<text text-anchor="middle" x="2773.2848" y="-770.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local LS = B(&quot;\n&quot;) + &#45;B(1)</text>
<text text-anchor="middle" x="2773.2848" y="-739.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;grym &#160;&#160;&#160;&#160;&#160;= &#160;V&quot;section&quot;^1 * V&quot;unparsed&quot;^0</text>
<text text-anchor="middle" x="2773.2848" y="-707.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;section &#160;&#160;= &#160;(V&quot;header&quot; * V&quot;block&quot;^0) + V&quot;block&quot;^1</text>
<text text-anchor="middle" x="2773.2848" y="-676.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;structure = &#160;V&quot;blank_line&quot; &#45;&#45; list, table, json, comment...</text>
<text text-anchor="middle" x="2773.2848" y="-645.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;header &#160;&#160;&#160;&#160;= &#160;LS * V&quot;lead_ws&quot; * V&quot;lead_tar&quot; * V&quot;prose_line&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-629.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;lead_ws &#160;&#160;&#160;= &#160;Csp(P&quot; &quot;^0)</text>
<text text-anchor="middle" x="2773.2848" y="-614.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;lead_tar &#160;&#160;= &#160;Csp(P&quot;*&quot;^&#45;6 * P&quot; &quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-598.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose_line = &#160;Csp(prose_span * NEOL)</text>
<text text-anchor="middle" x="2773.2848" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;block = &#160;(V&quot;structure&quot;^1 + V&quot;prose&quot;^1)^1 * #V&quot;block_end&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-536.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose &#160;&#160;&#160;&#160;&#160;&#160;&#160;= &#160;(V&quot;structured&quot; + V&quot;unstructured&quot;)^1</text>
<text text-anchor="middle" x="2773.2848" y="-520.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;unstructured = &#160;Csp(V&quot;prose_line&quot;^1 * prose_span + V&quot;prose_line&quot;^1</text>
<text text-anchor="middle" x="2773.2848" y="-505.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ prose_span &#45;V&quot;header&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-489.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;structured &#160;&#160;= &#160;V&quot;bold&quot; + V&quot;italic&quot; + V&quot;underscore&quot; + V&quot;strikethrough&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-474.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ V&quot;literal&quot; + V&quot;quoted&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-443.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;unparsed = Csp(P(1)^1)</text>
<text text-anchor="middle" x="2773.2848" y="-411.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Highlighting</text>
<text text-anchor="middle" x="2773.2848" y="-396.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; These inner blocks will need to be re&#45;parsed to render, e.g., links</text>
<text text-anchor="middle" x="2773.2848" y="-380.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; or multiple layers of highlight. </text>
<text text-anchor="middle" x="2773.2848" y="-365.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-350.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-334.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-319.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-303.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-288.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bold &#160;&#160;= &#160;Csp(bold_open * (P(1) &#45; bold_close)^0 * bold_close / 1) &#45; V&quot;header&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-273.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;italic = &#160;Csp(italic_open * (P(1) &#45; italic_close)^0 * italic_close / 1)</text>
<text text-anchor="middle" x="2773.2848" y="-257.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;underscore = Csp(under_open * (P(1) &#45; under_close)^0 * under_close / 1)</text>
<text text-anchor="middle" x="2773.2848" y="-242.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;strikethrough = Csp(strike_open * (P(1) &#45; strike_close)^0 * strike_close / 1)</text>
<text text-anchor="middle" x="2773.2848" y="-226.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;literal = Csp(lit_open * (P(1) &#45; lit_close)^0 * lit_close / 1)</text>
<text text-anchor="middle" x="2773.2848" y="-195.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local quoted_open = Cg(C(P(&quot;\&quot;&quot;)^2), &quot;quoted_init&quot;)</text>
<text text-anchor="middle" x="2773.2848" y="-180.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local quoted_close = Cmt(C(P(&quot;\&quot;&quot;)^1) * Cb(&quot;quoted_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="2773.2848" y="-164.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;quoted = Csp(quoted_open * (P(1) &#45; quoted_close)^0 * quoted_close / 1)</text>
<text text-anchor="middle" x="2773.2848" y="-133.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;block_end = V&quot;blank_line&quot;^1 + &#45;P(1) + #V&quot;header&quot;</text>
<text text-anchor="middle" x="2773.2848" y="-101.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;blank_line = Csp((WS^0 * NL)^1)</text>
<text text-anchor="middle" x="2773.2848" y="-86.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2773.2848" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return grymmyr</text>
<text text-anchor="middle" x="2773.2848" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2773.2848" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return epnf.define(_grym_fn(), nil, false)</text>
</g>
<!-- codeblock_9&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_9&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2420.9195,-946.4601C2435.0138,-936.6533 2452.0842,-923.548 2465.2848,-909.6014 2466.0632,-908.7789 2466.8411,-907.9544 2467.6183,-907.1276"/>
<polygon fill="#000000" stroke="#000000" points="2470.3449,-909.3354 2474.5967,-899.6311 2465.2213,-904.5658 2470.3449,-909.3354"/>
</g>
</g>
</svg>