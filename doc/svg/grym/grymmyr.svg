<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3072pt" height="1206pt"
 viewBox="0.00 0.00 3072.14 1205.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1201.6014)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1201.6014 3068.1446,-1201.6014 3068.1446,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1047.6446" cy="-1179.6014" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1047.6446" y="-1175.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 125</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1047.6446" cy="-1107.6014" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1047.6446" y="-1103.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;125</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1047.6446,-1161.4327C1047.6446,-1153.7323 1047.6446,-1144.5757 1047.6446,-1136.018"/>
<polygon fill="#000000" stroke="#000000" points="1051.1447,-1136.0146 1047.6446,-1126.0146 1044.1447,-1136.0147 1051.1447,-1136.0146"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="582.6446" cy="-1035.6014" rx="96.1863" ry="18"/>
<text text-anchor="middle" x="582.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grimoire Grammar</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M989.287,-1099.2302C918.0326,-1088.9208 793.8784,-1070.6727 687.6446,-1053.6014 679.7254,-1052.3288 671.4761,-1050.9708 663.2357,-1049.5929"/>
<polygon fill="#000000" stroke="#000000" points="663.6535,-1046.1141 653.2115,-1047.9066 662.4923,-1053.0171 663.6535,-1046.1141"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="742.6446" cy="-1035.6014" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="742.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M993.1222,-1097.5148C942.2128,-1087.6986 864.291,-1071.6529 797.6446,-1053.6014 794.2444,-1052.6804 790.7439,-1051.6741 787.2343,-1050.623"/>
<polygon fill="#000000" stroke="#000000" points="787.9831,-1047.191 777.3953,-1047.5762 785.9124,-1053.8777 787.9831,-1047.191"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="857.6446" cy="-1035.6014" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="857.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 4&#45;28</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1008.7368,-1092.8574C977.8423,-1081.15 934.6172,-1064.7699 902.3111,-1052.5276"/>
<polygon fill="#000000" stroke="#000000" points="903.2527,-1049.1416 892.6613,-1048.8709 900.7721,-1055.6874 903.2527,-1049.1416"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="982.6446" cy="-1035.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="982.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 29&#45;32</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1031.5772,-1089.8036C1023.5678,-1080.9317 1013.7515,-1070.0582 1005.0188,-1060.3851"/>
<polygon fill="#000000" stroke="#000000" points="1007.6019,-1058.0233 998.3029,-1052.946 1002.406,-1062.714 1007.6019,-1058.0233"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1112.6446" cy="-1035.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1112.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 33&#45;35</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1063.712,-1089.8036C1071.7214,-1080.9317 1081.5377,-1070.0582 1090.2704,-1060.3851"/>
<polygon fill="#000000" stroke="#000000" points="1092.8832,-1062.714 1096.9863,-1052.946 1087.6873,-1058.0233 1092.8832,-1062.714"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1435.6446" cy="-1035.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1435.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 36&#45;58</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1102.4126,-1097.4382C1174.9337,-1083.9807 1302.3185,-1060.3423 1376.8209,-1046.5171"/>
<polygon fill="#000000" stroke="#000000" points="1377.7778,-1049.8994 1386.9713,-1044.6335 1376.5006,-1043.0169 1377.7778,-1049.8994"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1661.6446" cy="-1035.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1661.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 59&#45;64</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1108.1977,-1100.5007C1225.0533,-1086.7977 1480.5627,-1056.8357 1599.0292,-1042.9439"/>
<polygon fill="#000000" stroke="#000000" points="1599.5072,-1046.4119 1609.0315,-1041.771 1598.6919,-1039.4596 1599.5072,-1046.4119"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1844.6446" cy="-1035.6014" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="1844.6446" y="-1031.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 65&#45;125</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1112.3942,-1104.0093C1233.3394,-1096.9542 1501.6933,-1079.6694 1726.6446,-1053.6014 1744.455,-1051.5375 1763.7048,-1048.8126 1781.3869,-1046.1093"/>
<polygon fill="#000000" stroke="#000000" points="1782.249,-1049.5175 1791.5939,-1044.5254 1781.1754,-1042.6003 1782.249,-1049.5175"/>
</g>
<!-- prose_10 -->
<g id="node11" class="node">
<title>prose_10</title>
<ellipse fill="none" stroke="#000000" cx="244.6446" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="244.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_3&#45;&gt;prose_10 -->
<g id="edge10" class="edge">
<title>block_3&#45;&gt;prose_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M708.6112,-1023.2914C701.7387,-1021.1389 694.5139,-1019.1096 687.6446,-1017.6014 552.5992,-987.9503 515.8323,-998.8056 378.6446,-981.6014 347.5974,-977.7078 312.5499,-972.9885 286.0866,-969.3591"/>
<polygon fill="#000000" stroke="#000000" points="286.4151,-965.8714 276.0314,-967.9759 285.4611,-972.8061 286.4151,-965.8714"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="460.6446" cy="-963.6014" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="460.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;24</text>
</g>
<!-- block_4&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M819.7587,-1023.4082C812.4656,-1021.2965 804.8532,-1019.2525 797.6446,-1017.6014 708.7835,-997.2472 605.0122,-981.8543 536.3474,-972.8109"/>
<polygon fill="#000000" stroke="#000000" points="536.4258,-969.2915 526.0571,-971.4685 535.5203,-976.2327 536.4258,-969.2915"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="865.6446" cy="-963.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="865.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 29&#45;31</text>
</g>
<!-- block_5&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M956.6785,-1019.6222C940.6263,-1009.7439 919.7821,-996.9167 902.0905,-986.0296"/>
<polygon fill="#000000" stroke="#000000" points="903.5193,-982.7993 893.1683,-980.539 899.8506,-988.7609 903.5193,-982.7993"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="1112.6446" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1112.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_6&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>block_6&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1112.6446,-1017.4327C1112.6446,-1009.7323 1112.6446,-1000.5757 1112.6446,-992.018"/>
<polygon fill="#000000" stroke="#000000" points="1116.1447,-992.0146 1112.6446,-982.0146 1109.1447,-992.0147 1116.1447,-992.0146"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="1604.6446" cy="-963.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1604.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 36&#45;57</text>
</g>
<!-- block_7&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>block_7&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1469.4381,-1021.2041C1494.8815,-1010.3644 1530.058,-995.3779 1558.1531,-983.4084"/>
<polygon fill="#000000" stroke="#000000" points="1559.5572,-986.6147 1567.3853,-979.4752 1556.8135,-980.1748 1559.5572,-986.6147"/>
</g>
<!-- prose_20 -->
<g id="node21" class="node">
<title>prose_20</title>
<ellipse fill="none" stroke="#000000" cx="1734.6446" cy="-963.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1734.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_8&#45;&gt;prose_20 -->
<g id="edge20" class="edge">
<title>block_8&#45;&gt;prose_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1679.3159,-1018.1722C1688.9591,-1008.6611 1701.0169,-996.7685 1711.4125,-986.5152"/>
<polygon fill="#000000" stroke="#000000" points="1713.9682,-988.9106 1718.6301,-979.3965 1709.0527,-983.9268 1713.9682,-988.9106"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="1868.6446" cy="-963.6014" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1868.6446" y="-959.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 65&#45;124</text>
</g>
<!-- block_9&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>block_9&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1850.7008,-1017.4327C1853.2958,-1009.6477 1856.387,-1000.3743 1859.2664,-991.7361"/>
<polygon fill="#000000" stroke="#000000" points="1862.6649,-992.6083 1862.5069,-982.0146 1856.0241,-990.3947 1862.6649,-992.6083"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="58.6446,-472.8007 4.6446,-472.8007 4.6446,-436.8007 58.6446,-436.8007 58.6446,-472.8007"/>
</g>
<!-- prose_10&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>prose_10&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M213.4162,-958.3868C167.6924,-950.0708 85.956,-932.3925 67.6446,-909.6014 -35.6442,-781.0434 5.2654,-560.7626 24.1404,-482.9943"/>
<polygon fill="#000000" stroke="#000000" points="27.6112,-483.5413 26.6401,-472.991 20.8201,-481.8441 27.6112,-483.5413"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="604.1446,-605.6013 77.1446,-605.6013 77.1446,-304.0001 604.1446,-304.0001 604.1446,-605.6013"/>
<text text-anchor="middle" x="340.6446" y="-590.501" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="340.6446" y="-575.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;../peg/epeg&quot;</text>
<text text-anchor="middle" x="340.6446" y="-559.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;../peg/epnf&quot;</text>
<text text-anchor="middle" x="340.6446" y="-528.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="340.6446" y="-512.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="340.6446" y="-497.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="340.6446" y="-482.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="340.6446" y="-466.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B &#160;&#45;&#45; match iff the pattern precedes the use of B</text>
<text text-anchor="middle" x="340.6446" y="-451.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="340.6446" y="-435.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="340.6446" y="-420.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cg = lpeg.Cg &#45;&#45; named capture group (for **balanced highlighting**)</text>
<text text-anchor="middle" x="340.6446" y="-405.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cb = lpeg.Cb &#45;&#45; Back capture</text>
<text text-anchor="middle" x="340.6446" y="-389.7006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cmt = lpeg.Cmt &#45;&#45; match&#45;time capture</text>
<text text-anchor="middle" x="340.6446" y="-374.3005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="340.6446" y="-358.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="340.6446" y="-327.5005" font-family="Inconsolata" font-size="14.00" fill="#000000">local letter = R&quot;AZ&quot; + R&quot;az&quot; &#160;&#160;</text>
<text text-anchor="middle" x="340.6446" y="-312.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">local digit = R&quot;09&quot;</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M456.3738,-945.4929C444.0262,-893.139 407.3307,-737.5499 378.5346,-615.4544"/>
<polygon fill="#000000" stroke="#000000" points="381.9152,-614.5408 376.2131,-605.6113 375.1022,-616.1477 381.9152,-614.5408"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="876.6446,-472.8007 622.6446,-472.8007 622.6446,-436.8007 876.6446,-436.8007 876.6446,-472.8007"/>
<text text-anchor="middle" x="749.6446" y="-451.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local punctuation = S&quot;!?,.:;\\^%~&quot;</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M861.5161,-945.4929C844.1643,-869.3839 777.0717,-575.1016 756.0088,-482.7151"/>
<polygon fill="#000000" stroke="#000000" points="759.4194,-481.929 753.7841,-472.9572 752.5945,-483.485 759.4194,-481.929"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1330.6446,-474.1013 894.6446,-474.1013 894.6446,-435.5001 1330.6446,-435.5001 1330.6446,-474.1013"/>
<text text-anchor="middle" x="1112.6446" y="-459.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> Interior symbols are valid within a prose word, but not if </text>
<text text-anchor="middle" x="1112.6446" y="-443.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> preceded by whitespace</text>
</g>
<!-- prose_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>prose_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1112.6446,-945.4929C1112.6446,-869.8868 1112.6446,-578.9811 1112.6446,-484.5728"/>
<polygon fill="#000000" stroke="#000000" points="1116.1447,-484.3085 1112.6446,-474.3085 1109.1447,-484.3085 1116.1447,-484.3085"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1910.6446,-613.5013 1348.6446,-613.5013 1348.6446,-296.1001 1910.6446,-296.1001 1910.6446,-613.5013"/>
<text text-anchor="middle" x="1629.6446" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local interior = S&quot;*_&#45;/@#&quot;</text>
<text text-anchor="middle" x="1629.6446" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local sym = letter + digit + punctuation + interior</text>
<text text-anchor="middle" x="1629.6446" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local first_letter = letter + digit + punctuation</text>
<text text-anchor="middle" x="1629.6446" y="-552.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;,&#39; + P&#39;\09&#39; &#45;&#45; Not accurate, refine (needs Unicode spaces)</text>
<text text-anchor="middle" x="1629.6446" y="-536.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local NL = P&quot;\n&quot;</text>
<text text-anchor="middle" x="1629.6446" y="-505.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function equal_strings(s, i, a, b)</text>
<text text-anchor="middle" x="1629.6446" y="-489.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns true if a and b are equal.</text>
<text text-anchor="middle" x="1629.6446" y="-474.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; s and i are not used, provided because expected by Cb.</text>
<text text-anchor="middle" x="1629.6446" y="-459.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return a == b</text>
<text text-anchor="middle" x="1629.6446" y="-443.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1629.6446" y="-412.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function bookends(sigil)</text>
<text text-anchor="middle" x="1629.6446" y="-396.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns a pair of patterns, _open and _close,</text>
<text text-anchor="middle" x="1629.6446" y="-381.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; which will match a brace of sigil.</text>
<text text-anchor="middle" x="1629.6446" y="-366.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; sigil must be a string. </text>
<text text-anchor="middle" x="1629.6446" y="-350.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _open = Cg(C(P(sigil)^1), sigil .. &quot;_init&quot;)</text>
<text text-anchor="middle" x="1629.6446" y="-335.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local _close = &#160;Cmt(C(P(sigil)^1) * Cb(sigil .. &quot;_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="1629.6446" y="-319.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return _open, _close</text>
<text text-anchor="middle" x="1629.6446" y="-304.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1605.5344,-945.4929C1608.0492,-894.3107 1615.412,-744.4626 1621.3457,-623.701"/>
<polygon fill="#000000" stroke="#000000" points="1624.8475,-623.7478 1621.8426,-613.588 1617.8559,-623.4042 1624.8475,-623.7478"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2448.6446,-497.3008 1928.6446,-497.3008 1928.6446,-412.3005 2448.6446,-412.3005 2448.6446,-497.3008"/>
<text text-anchor="middle" x="2188.6446" y="-482.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> The Grimoire grammar is a specially&#45;massaged closure to be executed</text>
<text text-anchor="middle" x="2188.6446" y="-466.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> in the epnf context. </text>
<text text-anchor="middle" x="2188.6446" y="-451.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="2188.6446" y="-435.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> The advantage of this approach is that we can make it look much like an</text>
<text text-anchor="middle" x="2188.6446" y="-420.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> actual grammar. This should aid in porting to target languages. </text>
</g>
<!-- prose_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>prose_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.873,-952.3088C1765.651,-949.928 1771.8108,-947.55 1777.6446,-945.6014 1839.3985,-924.9745 1867.5187,-948.6129 1919.6446,-909.6014 2060.0947,-804.4873 2140.817,-602.63 2172.6722,-507.219"/>
<polygon fill="#000000" stroke="#000000" points="2176.0698,-508.0914 2175.8711,-497.4984 2169.4205,-505.9032 2176.0698,-508.0914"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="3064.1446,-909.4021 2467.1446,-909.4021 2467.1446,-.1992 3064.1446,-.1992 3064.1446,-909.4021"/>
<text text-anchor="middle" x="2765.6446" y="-894.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local _grym_fn = function ()</text>
<text text-anchor="middle" x="2765.6446" y="-879.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function grymmyr (_ENV)</text>
<text text-anchor="middle" x="2765.6446" y="-863.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;START &quot;grym&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-848.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;SUPPRESS (&quot;structure&quot;, &quot;structured&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-816.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local prose_word = first_letter * (sym^1)^0</text>
<text text-anchor="middle" x="2765.6446" y="-801.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local prose_span = (prose_word + WS^1)^1</text>
<text text-anchor="middle" x="2765.6446" y="-786.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local NEOL = NL + &#45;P(1)</text>
<text text-anchor="middle" x="2765.6446" y="-770.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local LS = B(&quot;\n&quot;) + &#45;B(1)</text>
<text text-anchor="middle" x="2765.6446" y="-739.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;grym &#160;&#160;&#160;&#160;&#160;= &#160;V&quot;section&quot;^1 * V&quot;unparsed&quot;^0</text>
<text text-anchor="middle" x="2765.6446" y="-707.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;section &#160;&#160;= &#160;(V&quot;header&quot; * V&quot;block&quot;^0) + V&quot;block&quot;^1</text>
<text text-anchor="middle" x="2765.6446" y="-676.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;structure = &#160;V&quot;blank_line&quot; &#45;&#45; list, table, json, comment...</text>
<text text-anchor="middle" x="2765.6446" y="-645.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;header &#160;&#160;&#160;&#160;= &#160;LS * V&quot;lead_ws&quot; * V&quot;lead_tar&quot; * V&quot;prose_line&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-629.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;lead_ws &#160;&#160;&#160;= &#160;Csp(P&quot; &quot;^0)</text>
<text text-anchor="middle" x="2765.6446" y="-614.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;lead_tar &#160;&#160;= &#160;Csp(P&quot;*&quot;^&#45;6 * P&quot; &quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-598.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose_line = &#160;Csp(prose_span * NEOL)</text>
<text text-anchor="middle" x="2765.6446" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;block = &#160;(V&quot;structure&quot;^1 + V&quot;prose&quot;^1)^1 * #V&quot;block_end&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-536.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;prose &#160;&#160;&#160;&#160;&#160;&#160;&#160;= &#160;(V&quot;structured&quot; + V&quot;unstructured&quot;)^1</text>
<text text-anchor="middle" x="2765.6446" y="-520.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;unstructured = &#160;Csp(V&quot;prose_line&quot;^1 * prose_span + V&quot;prose_line&quot;^1</text>
<text text-anchor="middle" x="2765.6446" y="-505.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ prose_span &#45;V&quot;header&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-489.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;structured &#160;&#160;= &#160;V&quot;bold&quot; + V&quot;italic&quot; + V&quot;underscore&quot; + V&quot;strikethrough&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-474.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;+ V&quot;literal&quot; + V&quot;quoted&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-443.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;unparsed = Csp(P(1)^1)</text>
<text text-anchor="middle" x="2765.6446" y="-411.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Highlighting</text>
<text text-anchor="middle" x="2765.6446" y="-396.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; These inner blocks will need to be re&#45;parsed to render, e.g., links</text>
<text text-anchor="middle" x="2765.6446" y="-380.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; or multiple layers of highlight. </text>
<text text-anchor="middle" x="2765.6446" y="-365.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local bold_open, bold_close &#160;&#160;&#160;&#160;= &#160;bookends(&quot;*&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-350.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local italic_open, italic_close = &#160;bookends(&quot;/&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-334.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local under_open, under_close &#160;&#160;= &#160;bookends(&quot;_&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-319.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local strike_open, strike_close = &#160;bookends(&quot;&#45;&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-303.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local lit_open, lit_close &#160;&#160;&#160;&#160;&#160;&#160;= &#160;bookends(&quot;=&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-288.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;bold &#160;&#160;= &#160;Csp(bold_open * (P(1) &#45; bold_close)^0 * bold_close / 1) &#45; V&quot;header&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-273.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;italic = &#160;Csp(italic_open * (P(1) &#45; italic_close)^0 * italic_close / 1)</text>
<text text-anchor="middle" x="2765.6446" y="-257.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;underscore = Csp(under_open * (P(1) &#45; under_close)^0 * under_close / 1)</text>
<text text-anchor="middle" x="2765.6446" y="-242.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;strikethrough = Csp(strike_open * (P(1) &#45; strike_close)^0 * strike_close / 1)</text>
<text text-anchor="middle" x="2765.6446" y="-226.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;literal = Csp(lit_open * (P(1) &#45; lit_close)^0 * lit_close / 1)</text>
<text text-anchor="middle" x="2765.6446" y="-195.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local quoted_open = Cg(C(P(&quot;\&quot;&quot;)^2), &quot;quoted_init&quot;)</text>
<text text-anchor="middle" x="2765.6446" y="-180.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local quoted_close = Cmt(C(P(&quot;\&quot;&quot;)^1) * Cb(&quot;quoted_init&quot;), equal_strings)</text>
<text text-anchor="middle" x="2765.6446" y="-164.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;quoted = Csp(quoted_open * (P(1) &#45; quoted_close)^0 * quoted_close / 1)</text>
<text text-anchor="middle" x="2765.6446" y="-133.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;block_end = V&quot;blank_line&quot;^1 + &#45;P(1) + #V&quot;header&quot;</text>
<text text-anchor="middle" x="2765.6446" y="-101.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;blank_line = Csp((WS^0 * NL)^1)</text>
<text text-anchor="middle" x="2765.6446" y="-86.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2765.6446" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return grymmyr</text>
<text text-anchor="middle" x="2765.6446" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2765.6446" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return epnf.define(_grym_fn(), nil, false)</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1949.4687,-960.0199C2100.6569,-952.764 2414.9005,-934.8458 2457.6446,-909.6014 2457.9429,-909.4252 2458.241,-909.2486 2458.5388,-909.0716"/>
<polygon fill="#000000" stroke="#000000" points="2460.4106,-912.0296 2467.1127,-903.8239 2456.7563,-906.0591 2460.4106,-912.0296"/>
</g>
</g>
</svg>