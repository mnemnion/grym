<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2697pt" height="1717pt"
 viewBox="0.00 0.00 2697.30 1716.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1712.6025)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1712.6025 2693.2972,-1712.6025 2693.2972,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="789" cy="-1690.6025" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="789" y="-1686.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 151</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="789" cy="-1618.6025" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="789" y="-1614.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;55</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M789,-1672.4338C789,-1664.7334 789,-1655.5768 789,-1647.0191"/>
<polygon fill="#000000" stroke="#000000" points="792.5001,-1647.0157 789,-1637.0157 785.5001,-1647.0158 792.5001,-1647.0157"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="525" cy="-1546.6025" rx="49.5296" ry="18"/>
<text text-anchor="middle" x="525" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Weave</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M742.453,-1606.8864C700.8117,-1596.2755 638.1665,-1579.9931 584,-1564.6025 580.3881,-1563.5762 576.6588,-1562.4934 572.912,-1561.3888"/>
<polygon fill="#000000" stroke="#000000" points="573.6052,-1557.9432 563.022,-1558.4378 571.6037,-1564.651 573.6052,-1557.9432"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="625" cy="-1546.6025" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="625" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M754.6202,-1603.5089C726.8097,-1591.2994 687.8158,-1574.1801 659.8739,-1561.913"/>
<polygon fill="#000000" stroke="#000000" points="661.0513,-1558.6075 650.4879,-1557.7923 658.2374,-1565.017 661.0513,-1558.6075"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="707" cy="-1546.6025" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="707" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M769.5671,-1601.5395C758.3006,-1591.6469 743.9965,-1579.0872 731.9098,-1568.4745"/>
<polygon fill="#000000" stroke="#000000" points="734.1653,-1565.7972 724.3415,-1561.8292 729.5466,-1571.0573 734.1653,-1565.7972"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="789" cy="-1546.6025" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="789" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M789,-1600.4338C789,-1592.7334 789,-1583.5768 789,-1575.0191"/>
<polygon fill="#000000" stroke="#000000" points="792.5001,-1575.0157 789,-1565.0157 785.5001,-1575.0158 792.5001,-1575.0157"/>
</g>
<!-- codeblock_6 -->
<g id="node7" class="node">
<title>codeblock_6</title>
<ellipse fill="none" stroke="#000000" cx="949" cy="-1546.6025" rx="76.6175" ry="18"/>
<text text-anchor="middle" x="949" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 11&#45;47</text>
</g>
<!-- section_1&#45;&gt;codeblock_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;codeblock_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M822.5412,-1603.5089C846.2089,-1592.8585 878.1786,-1578.4721 904.0515,-1566.8293"/>
<polygon fill="#000000" stroke="#000000" points="905.5982,-1569.9714 913.2811,-1562.676 902.7256,-1563.5879 905.5982,-1569.9714"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1216" cy="-1546.6025" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1216" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 49&#45;53</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M842.2165,-1609.6292C918.129,-1596.829 1057.7521,-1573.286 1143.1924,-1558.8792"/>
<polygon fill="#000000" stroke="#000000" points="1143.8001,-1562.3262 1153.079,-1557.2121 1142.6362,-1555.4236 1143.8001,-1562.3262"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="1755" cy="-1546.6025" rx="70.655" ry="18"/>
<text text-anchor="middle" x="1755" y="-1542.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 56&#45;151</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M847.9735,-1614.2069C1014.5989,-1601.7876 1488.9601,-1566.4315 1676.9169,-1552.4223"/>
<polygon fill="#000000" stroke="#000000" points="1677.2847,-1555.9047 1686.9969,-1551.671 1676.7644,-1548.9241 1677.2847,-1555.9047"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="450,-1252.3032 0,-1252.3032 0,-1180.5009 450,-1180.5009 450,-1252.3032"/>
<text text-anchor="middle" x="225" y="-1188.9021" font-family="Inconsolata" font-size="14.00" fill="#000000">Our weaver is currently somewhat narrowly focused on markdown.</text>
</g>
<!-- prose_3&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M600.0625,-1535.0235C594.8094,-1532.7629 589.2635,-1530.5062 584,-1528.6025 529.6332,-1508.9386 507.5429,-1524.0032 459,-1492.6025 365.1989,-1431.9259 288.8406,-1322.3443 250.9274,-1261.0286"/>
<polygon fill="#000000" stroke="#000000" points="253.8189,-1259.0481 245.6151,-1252.3438 247.8474,-1262.7008 253.8189,-1259.0481"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="659.5,-1236.3041 468.5,-1236.3041 468.5,-1196.5 659.5,-1196.5 659.5,-1236.3041"/>
<text text-anchor="middle" x="564" y="-1204.9021" font-family="Inconsolata" font-size="14.00" fill="#000000">This will change in time.</text>
</g>
<!-- prose_4&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>prose_4&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M693.5256,-1529.8002C685.6805,-1519.4834 675.9905,-1505.7639 669,-1492.6025 623.6373,-1407.1957 588.1463,-1297.802 572.5864,-1246.0602"/>
<polygon fill="#000000" stroke="#000000" points="575.8634,-1244.8008 569.6576,-1236.2138 569.154,-1246.7966 575.8634,-1244.8008"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="834,-1244.3035 678,-1244.3035 678,-1188.5006 834,-1188.5006 834,-1244.3035"/>
<text text-anchor="middle" x="756" y="-1212.9021" font-family="Inconsolata" font-size="14.00" fill="#000000">Now to activate dot!</text>
</g>
<!-- prose_5&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>prose_5&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M787.1788,-1528.3791C781.9737,-1476.2964 766.951,-1325.9787 759.8307,-1254.7321"/>
<polygon fill="#000000" stroke="#000000" points="763.2762,-1254.0113 758.799,-1244.409 756.3109,-1254.7075 763.2762,-1254.0113"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1176,-1492.803 852,-1492.803 852,-940.0011 1176,-940.0011 1176,-1492.803"/>
<text text-anchor="middle" x="1014" y="-1477.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1014" y="-1446.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_file = require &quot;pl.file&quot;</text>
<text text-anchor="middle" x="1014" y="-1430.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_dir = require &quot;pl.dir&quot;</text>
<text text-anchor="middle" x="1014" y="-1415.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_path = require &quot;pl.path&quot;</text>
<text text-anchor="middle" x="1014" y="-1399.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfiles = pl_dir.getfiles</text>
<text text-anchor="middle" x="1014" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local makepath = pl_dir.makepath</text>
<text text-anchor="middle" x="1014" y="-1369.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local getdirectories = pl_dir.getdirectories</text>
<text text-anchor="middle" x="1014" y="-1353.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local extension = pl_path.extension</text>
<text text-anchor="middle" x="1014" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local dirname = pl_path.dirname</text>
<text text-anchor="middle" x="1014" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local basename = pl_path.basename</text>
<text text-anchor="middle" x="1014" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local read = pl_file.read</text>
<text text-anchor="middle" x="1014" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local write = pl_file.write</text>
<text text-anchor="middle" x="1014" y="-1276.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local isdir = pl_path.isdir</text>
<text text-anchor="middle" x="1014" y="-1245.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1014" y="-1229.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;lib/ansi&quot;</text>
<text text-anchor="middle" x="1014" y="-1182.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;lib/status&quot;</text>
<text text-anchor="middle" x="1014" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="1014" y="-1119.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1014" y="-1104.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local walk = require &quot;walk&quot;</text>
<text text-anchor="middle" x="1014" y="-1088.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local strHas = walk.strHas</text>
<text text-anchor="middle" x="1014" y="-1073.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">local endsWith = walk.endsWith</text>
<text text-anchor="middle" x="1014" y="-1058.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">local subLastFor = walk.subLastFor</text>
<text text-anchor="middle" x="1014" y="-1042.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">local writeOnChange = walk.writeOnChange</text>
<text text-anchor="middle" x="1014" y="-1011.2017" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1014" y="-979.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">local Doc = require &quot;grym/doc&quot;</text>
<text text-anchor="middle" x="1014" y="-948.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local W, w = u.inherit(Node)</text>
</g>
<!-- codeblock_6&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_6&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M952.5873,-1528.3791C953.9487,-1521.4633 955.651,-1512.8153 957.6126,-1502.8505"/>
<polygon fill="#000000" stroke="#000000" points="961.0726,-1503.3942 959.5701,-1492.9065 954.2044,-1502.0422 961.0726,-1503.3942"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1427.5,-1243.6025 1194.5,-1243.6025 1194.5,-1189.2016 1427.5,-1189.2016 1427.5,-1243.6025"/>
<text text-anchor="middle" x="1311" y="-1228.3021" font-family="Inconsolata" font-size="14.00" fill="#000000">function W.weaveMd(weaver, doc)</text>
<text text-anchor="middle" x="1311" y="-1212.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return doc:toMarkdown()</text>
<text text-anchor="middle" x="1311" y="-1197.502" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_7&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1221.2429,-1528.3791C1236.2952,-1476.0606 1279.8665,-1324.6156 1300.2493,-1253.7693"/>
<polygon fill="#000000" stroke="#000000" points="1303.6808,-1254.5007 1303.0822,-1243.9228 1296.9537,-1252.5652 1303.6808,-1254.5007"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="1511" cy="-1216.4021" rx="65.81" ry="18"/>
<text text-anchor="middle" x="1511" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : .dot to .svg</text>
</g>
<!-- section_8&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_8&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1700.2851,-1535.08C1657.2473,-1524.9645 1601.9707,-1509.2939 1586,-1492.6025 1519.3376,-1422.9317 1510.6442,-1300.1712 1510.3398,-1244.8473"/>
<polygon fill="#000000" stroke="#000000" points="1513.8401,-1244.7299 1510.3761,-1234.7174 1506.8402,-1244.7047 1513.8401,-1244.7299"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="1627" cy="-1216.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1627" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_8&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_8&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1716.4763,-1531.3854C1699.2485,-1522.612 1680.3128,-1509.8504 1669,-1492.6025 1617.8578,-1414.6293 1619.843,-1297.9957 1624.0026,-1244.7457"/>
<polygon fill="#000000" stroke="#000000" points="1627.4987,-1244.941 1624.8766,-1234.6758 1620.5249,-1244.3357 1627.4987,-1244.941"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="1755" cy="-1216.4021" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1755" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 61&#45;75</text>
</g>
<!-- section_8&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>section_8&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1755,-1528.3791C1755,-1473.6927 1755,-1310.7041 1755,-1244.662"/>
<polygon fill="#000000" stroke="#000000" points="1758.5001,-1244.5691 1755,-1234.5691 1751.5001,-1244.5691 1758.5001,-1244.5691"/>
</g>
<!-- codeblock_17 -->
<g id="node18" class="node">
<title>codeblock_17</title>
<ellipse fill="none" stroke="#000000" cx="1933" cy="-1216.4021" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1933" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;137</text>
</g>
<!-- section_8&#45;&gt;codeblock_17 -->
<g id="edge17" class="edge">
<title>section_8&#45;&gt;codeblock_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1791.3935,-1530.9346C1808.5468,-1521.9293 1828.0408,-1509.101 1841,-1492.6025 1901.1676,-1416.0021 1922.8844,-1298.2003 1929.9442,-1244.6445"/>
<polygon fill="#000000" stroke="#000000" points="1933.4417,-1244.8803 1931.2024,-1234.5248 1926.4952,-1244.0166 1933.4417,-1244.8803"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="2265" cy="-1216.4021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2265" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 140&#45;147</text>
</g>
<!-- section_8&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1818.3777,-1538.6717C1886.5386,-1529.309 1989.752,-1512.4731 2024,-1492.6025 2132.717,-1429.5252 2217.1303,-1299.3772 2250.0305,-1243.1938"/>
<polygon fill="#000000" stroke="#000000" points="2253.0683,-1244.9321 2255.0415,-1234.5227 2247.0075,-1241.4296 2253.0683,-1244.9321"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2602" cy="-1216.4021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2602" y="-1212.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 149&#45;151</text>
</g>
<!-- section_8&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1824.5054,-1543.3246C1973.5376,-1535.8781 2314.1465,-1516.4681 2361,-1492.6025 2473.5354,-1435.2806 2556.4218,-1300.8509 2588.0001,-1243.309"/>
<polygon fill="#000000" stroke="#000000" points="2591.1177,-1244.9018 2592.7933,-1234.4403 2584.9595,-1241.5735 2591.1177,-1244.9018"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1123.5,-487.4012 610.5,-487.4012 610.5,-416.8005 1123.5,-416.8005 1123.5,-487.4012"/>
<text text-anchor="middle" x="867" y="-440.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The sh&#45;lib monkeypatches the global metatable, and all we want is one</text>
<text text-anchor="middle" x="867" y="-424.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">command, so we do something odd here:</text>
</g>
<!-- prose_15&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_15&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1630.9184,-1198.5295C1640.6082,-1149.0168 1659.8667,-1009.1924 1586,-940.2017 1512.0373,-871.1213 1217.7536,-957.95 1132,-904.2017 979.8955,-808.8662 904.8359,-591.9202 878.4146,-497.4587"/>
<polygon fill="#000000" stroke="#000000" points="881.7399,-496.3502 875.7188,-487.6326 874.9894,-498.2023 881.7399,-496.3502"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1598.5,-556.4013 1141.5,-556.4013 1141.5,-347.8004 1598.5,-347.8004 1598.5,-556.4013"/>
<text text-anchor="middle" x="1370" y="-541.301" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_sh = (require &quot;sh&quot;):clear_G().command(&#39;dot&#39;, &#39;&#45;Tsvg&#39;)</text>
<text text-anchor="middle" x="1370" y="-509.901" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dotToSvg(dotted, out_file)</text>
<text text-anchor="middle" x="1370" y="-494.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local run_dot = dot_sh({__input = dotted})</text>
<text text-anchor="middle" x="1370" y="-479.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if run_dot.__exitcode == 0 then</text>
<text text-anchor="middle" x="1370" y="-463.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return tostring(run_dot)</text>
<text text-anchor="middle" x="1370" y="-448.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="1370" y="-432.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:complain(a.red(&quot;Dot returned &quot;) </text>
<text text-anchor="middle" x="1370" y="-417.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. tostring(run_dot.__exitcode)</text>
<text text-anchor="middle" x="1370" y="-402.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. a.red(&quot; for &quot; .. out_file ))</text>
<text text-anchor="middle" x="1370" y="-386.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1370" y="-371.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1370" y="-355.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_16&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1753.6792,-1198.2154C1749.3854,-1150.813 1732.1304,-1021.5214 1668,-940.2017 1648.7429,-915.7829 1629.3673,-926.797 1608,-904.2017 1515.158,-806.0239 1448.5339,-664.6014 1409.8005,-566.1655"/>
<polygon fill="#000000" stroke="#000000" points="1413.0332,-564.8216 1406.1392,-556.7765 1406.5115,-567.3648 1413.0332,-564.8216"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2249,-904.3025 1617,-904.3025 1617,.1008 2249,.1008 2249,-904.3025"/>
<text text-anchor="middle" x="1933" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local function weave_dir(weaver, pwd, depth)</text>
<text text-anchor="middle" x="1933" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local depth = depth + 1</text>
<text text-anchor="middle" x="1933" y="-858.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1933" y="-842.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir)</text>
<text text-anchor="middle" x="1933" y="-827.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and not strHas(&quot;src/lib&quot;, dir) then</text>
<text text-anchor="middle" x="1933" y="-796.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local files = getfiles(dir)</text>
<text text-anchor="middle" x="1933" y="-780.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat((&quot; &#160;&quot;):rep(depth) .. &quot;* &quot; .. dir)</text>
<text text-anchor="middle" x="1933" y="-765.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local subdirs = getdirectories(dir)</text>
<text text-anchor="middle" x="1933" y="-749.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, f in ipairs(files) do</text>
<text text-anchor="middle" x="1933" y="-734.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if extension(f) == &quot;.orb&quot; then</text>
<text text-anchor="middle" x="1933" y="-719.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Weave and prepare out directory</text>
<text text-anchor="middle" x="1933" y="-703.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local orb_f = read(f)</text>
<text text-anchor="middle" x="1933" y="-688.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local doc = Doc(orb_f)</text>
<text text-anchor="middle" x="1933" y="-672.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local doc_md_dir = subLastFor(&quot;/orb&quot;, &quot;/doc/md&quot;, dirname(f))</text>
<text text-anchor="middle" x="1933" y="-657.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local doc_dot_dir = subLastFor(&quot;/orb&quot;, &quot;/doc/dot&quot;, dirname(f))</text>
<text text-anchor="middle" x="1933" y="-642.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local doc_svg_dir = subLastFor(&quot;/orb&quot;, &quot;/doc/svg&quot;, dirname(f))</text>
<text text-anchor="middle" x="1933" y="-626.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(doc_md_dir)</text>
<text text-anchor="middle" x="1933" y="-611.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(doc_dot_dir)</text>
<text text-anchor="middle" x="1933" y="-595.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(doc_svg_dir)</text>
<text text-anchor="middle" x="1933" y="-580.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local bare_name = basename(f):sub(1, &#45;5) &#45;&#45; &#160;== #&quot;.orb&quot;</text>
<text text-anchor="middle" x="1933" y="-565.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_md_name = doc_md_dir .. &quot;/&quot; .. bare_name .. &quot;.md&quot;</text>
<text text-anchor="middle" x="1933" y="-549.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_dot_name = doc_dot_dir .. &quot;/&quot; .. bare_name .. &quot;.dot&quot;</text>
<text text-anchor="middle" x="1933" y="-534.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_svg_name = doc_svg_dir .. &quot;/&quot; .. bare_name .. &quot;.svg&quot;</text>
<text text-anchor="middle" x="1933" y="-518.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local woven_md = weaver:weaveMd(doc) or &quot;&quot;</text>
<text text-anchor="middle" x="1933" y="-503.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="1933" y="-488.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; Compare, report, and write out if necessary</text>
<text text-anchor="middle" x="1933" y="-472.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local last_md = read(out_md_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1933" y="-457.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local changed = writeOnChange(woven_md, last_md, out_md_name, depth)</text>
<text text-anchor="middle" x="1933" y="-441.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if changed then</text>
<text text-anchor="middle" x="1933" y="-426.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local woven_dot = doc:dot() or &quot;&quot;</text>
<text text-anchor="middle" x="1933" y="-411.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local woven_svg = dotToSvg(woven_dot, out_dot_name)</text>
<text text-anchor="middle" x="1933" y="-395.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local last_dot = read(out_dot_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1933" y="-380.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local last_svg = read(out_svg_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1933" y="-364.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;writeOnChange(woven_dot, last_dot, out_dot_name, depth)</text>
<text text-anchor="middle" x="1933" y="-349.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;writeOnChange(woven_svg, last_svg, out_svg_name, depth)</text>
<text text-anchor="middle" x="1933" y="-334.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-318.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-272.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-241.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="1933" y="-225.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1933" y="-194.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function weave_all(weaver, pwd)</text>
<text text-anchor="middle" x="1933" y="-178.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1933" y="-163.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir) </text>
<text text-anchor="middle" x="1933" y="-148.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and endsWith(&quot;orb&quot;, dir) then</text>
<text text-anchor="middle" x="1933" y="-132.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot;Weave: &quot; .. dir))</text>
<text text-anchor="middle" x="1933" y="-117.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return weave_dir(weaver, dir, 0)</text>
<text text-anchor="middle" x="1933" y="-101.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-86.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1933" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="1933" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1933" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">W.weave_all = weave_all</text>
</g>
<!-- codeblock_17&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_17&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1933,-1198.263C1933,-1155.234 1933,-1041.0705 1933,-914.6106"/>
<polygon fill="#000000" stroke="#000000" points="1936.5001,-914.3106 1933,-904.3107 1929.5001,-914.3107 1936.5001,-914.3106"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2549,-502.7017 2267,-502.7017 2267,-401.4999 2549,-401.4999 2549,-502.7017"/>
<text text-anchor="middle" x="2408" y="-487.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Weaver, doc)</text>
<text text-anchor="middle" x="2408" y="-472.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local weaver = setmetatable({}, W)</text>
<text text-anchor="middle" x="2408" y="-424.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return weaver</text>
<text text-anchor="middle" x="2408" y="-409.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_18&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2268.3938,-1198.263C2285.9106,-1104.6398 2366.4357,-674.2521 2396.5727,-513.1769"/>
<polygon fill="#000000" stroke="#000000" points="2400.0849,-513.4362 2398.4837,-502.963 2393.2043,-512.1487 2400.0849,-513.4362"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2639,-470.1008 2567,-470.1008 2567,-434.1008 2639,-434.1008 2639,-470.1008"/>
<text text-anchor="middle" x="2603" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return W</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>codeblock_19&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2602.0237,-1198.263C2602.1558,-1097.3231 2602.8,-604.925 2602.9627,-480.6362"/>
<polygon fill="#000000" stroke="#000000" points="2606.4629,-480.4141 2602.976,-470.4095 2599.4629,-480.4048 2606.4629,-480.4141"/>
</g>
</g>
</svg>