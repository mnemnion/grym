<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4057pt" height="1234pt"
 viewBox="0.00 0.00 4057.00 1233.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1229.8018)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1229.8018 4053,-1229.8018 4053,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1678" cy="-1207.8018" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="1678" y="-1203.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 82</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1678" cy="-1135.8018" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1678" y="-1131.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;82</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1678,-1189.6331C1678,-1181.9327 1678,-1172.7761 1678,-1164.2184"/>
<polygon fill="#000000" stroke="#000000" points="1681.5001,-1164.215 1678,-1154.215 1674.5001,-1164.2151 1681.5001,-1164.215"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1247" cy="-1063.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1247" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1617.4586,-1133.6581C1538.7866,-1129.4956 1397.8972,-1117.3131 1283,-1081.8018 1281.0973,-1081.2137 1279.1721,-1080.5335 1277.2529,-1079.7889"/>
<polygon fill="#000000" stroke="#000000" points="1278.4036,-1076.4718 1267.84,-1075.6586 1275.5909,-1082.8818 1278.4036,-1076.4718"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1338" cy="-1063.8018" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1338" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;5</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1623.6999,-1127.6541C1566.0147,-1118.5015 1472.3761,-1102.2196 1393,-1081.8018 1389.4333,-1080.8843 1385.7603,-1079.8605 1382.0847,-1078.7797"/>
<polygon fill="#000000" stroke="#000000" points="1383.0065,-1075.4016 1372.4199,-1075.8193 1380.9563,-1082.0947 1383.0065,-1075.4016"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1448" cy="-1063.8018" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1448" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;7</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1635.5022,-1122.9088C1600.0247,-1112.0928 1548.1488,-1096.1545 1503,-1081.8018 1499.6922,-1080.7502 1496.2756,-1079.6547 1492.8397,-1078.5462"/>
<polygon fill="#000000" stroke="#000000" points="1493.7722,-1075.1692 1483.1801,-1075.4136 1491.6127,-1081.8278 1493.7722,-1075.1692"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1558" cy="-1063.8018" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1558" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 8&#45;9</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1651.0697,-1119.6436C1633.6107,-1109.1682 1610.7191,-1095.4332 1592.008,-1084.2066"/>
<polygon fill="#000000" stroke="#000000" points="1593.5762,-1081.0658 1583.2005,-1078.9221 1589.9747,-1087.0683 1593.5762,-1081.0658"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1678" cy="-1063.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1678" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 10&#45;12</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1678,-1117.6331C1678,-1109.9327 1678,-1100.7761 1678,-1092.2184"/>
<polygon fill="#000000" stroke="#000000" points="1681.5001,-1092.215 1678,-1082.215 1674.5001,-1092.2151 1681.5001,-1092.215"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1926" cy="-1063.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1926" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 13&#45;14</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1721.4821,-1123.1779C1764.1908,-1110.7786 1829.351,-1091.8612 1874.6004,-1078.7242"/>
<polygon fill="#000000" stroke="#000000" points="1875.595,-1082.0801 1884.2227,-1075.9307 1873.6433,-1075.3576 1875.595,-1082.0801"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="2411" cy="-1063.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2411" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 15&#45;19</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1735.8233,-1130.122C1870.8774,-1116.8561 2206.2425,-1083.9144 2347.0965,-1070.0788"/>
<polygon fill="#000000" stroke="#000000" points="2347.6896,-1073.5375 2357.2995,-1069.0766 2347.0052,-1066.571 2347.6896,-1073.5375"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="2986" cy="-1063.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2986" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 20&#45;22</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1738.0319,-1132.4973C1954.8094,-1120.5646 2696.1864,-1079.7548 2920.9124,-1067.3846"/>
<polygon fill="#000000" stroke="#000000" points="2921.1117,-1070.879 2930.9042,-1066.8346 2920.7269,-1063.8896 2921.1117,-1070.879"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="3838" cy="-1063.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3838" y="-1059.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 23&#45;82</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1738.594,-1133.782C2048.1427,-1123.4637 3450.8665,-1076.7062 3772.2535,-1065.9933"/>
<polygon fill="#000000" stroke="#000000" points="3772.4601,-1069.4885 3782.3379,-1065.6572 3772.2268,-1062.4924 3772.4601,-1069.4885"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="506,-1002.2022 0,-1002.2022 0,-947.8013 506,-947.8013 506,-1002.2022"/>
<text text-anchor="middle" x="253" y="-986.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> This walks an AST, making back references to the parent node.</text>
<text text-anchor="middle" x="253" y="-971.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="253" y="-956.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This shouldn&#39;t be a separate step, but that&#39;s premature optimization.</text>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1304.6313,-1051.2967C1297.5783,-1049.1033 1290.1149,-1047.108 1283,-1045.8018 946.9087,-984.1004 855.3421,-1040.3255 515,-1009.8018 494.6813,-1007.9795 473.5179,-1005.7405 452.4161,-1003.2846"/>
<polygon fill="#000000" stroke="#000000" points="452.74,-999.7987 442.3986,-1002.1023 451.9194,-1006.7504 452.74,-999.7987"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="743.5,-993.0017 524.5,-993.0017 524.5,-957.0017 743.5,-957.0017 743.5,-993.0017"/>
<text text-anchor="middle" x="634" y="-971.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is conceptually simple:</text>
</g>
<!-- block_4&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1414.6217,-1051.3482C1407.5694,-1049.1511 1400.1087,-1047.1412 1393,-1045.8018 1113.0324,-993.0497 1033.7705,-1058.0984 753,-1009.8018 734.1192,-1006.554 713.9828,-1001.3581 695.7462,-995.9612"/>
<polygon fill="#000000" stroke="#000000" points="696.7013,-992.5935 686.116,-993.042 694.6706,-999.2925 696.7013,-992.5935"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1212,-993.0017 762,-993.0017 762,-957.0017 1212,-957.0017 1212,-993.0017"/>
<text text-anchor="middle" x="987" y="-971.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take the tree, add a parent reference &#160;that points to itself.</text>
</g>
<!-- block_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1523.9532,-1051.5516C1517.0819,-1049.3941 1509.8609,-1047.3477 1503,-1045.8018 1379.74,-1018.0275 1346.1613,-1027.0958 1221,-1009.8018 1186.5622,-1005.0434 1149.3156,-999.6271 1114.8826,-994.5083"/>
<polygon fill="#000000" stroke="#000000" points="1115.18,-991.014 1104.7734,-993.002 1114.1483,-997.9376 1115.18,-991.014"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1890,-994.3023 1230,-994.3023 1230,-955.7011 1890,-955.7011 1890,-994.3023"/>
<text text-anchor="middle" x="1560" y="-979.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take all child members, if they&#39;re nodes, call the function recursively with the parent and</text>
<text text-anchor="middle" x="1560" y="-963.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> nodes as argument.</text>
</g>
<!-- block_6&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_6&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1655.8051,-1047.0992C1638.3971,-1033.9989 1613.8718,-1015.5425 1593.9935,-1000.5833"/>
<polygon fill="#000000" stroke="#000000" points="1595.8879,-997.6285 1585.793,-994.4121 1591.6787,-1003.2217 1595.8879,-997.6285"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2414,-993.0017 1908,-993.0017 1908,-957.0017 2414,-957.0017 2414,-993.0017"/>
<text text-anchor="middle" x="2161" y="-971.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is the usual recursive function wrapped in pre and post matter. </text>
</g>
<!-- block_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1962.4609,-1050.0242C2000.1746,-1035.7732 2059.6053,-1013.316 2103.625,-996.6822"/>
<polygon fill="#000000" stroke="#000000" points="2104.9341,-999.9291 2113.0513,-993.1202 2102.4597,-993.381 2104.9341,-999.9291"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="3099.5,-1009.603 2432.5,-1009.603 2432.5,-940.4004 3099.5,-940.4004 3099.5,-1009.603"/>
<text text-anchor="middle" x="2766" y="-994.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> Now that I&#39;ve added an index, I&#39;m considering a cleaner parent implementation, where the </text>
<text text-anchor="middle" x="2766" y="-979.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> parent is simply a number which must be looked up against the index. To completely eliminate</text>
<text text-anchor="middle" x="2766" y="-963.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> back references, the index might be a closure which returns the table given the argument, </text>
<text text-anchor="middle" x="2766" y="-948.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> thus `index(i)` rather than `index[i]`. </text>
</g>
<!-- block_8&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_8&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2455.2432,-1052.7347C2496.0904,-1042.5172 2559.1252,-1026.7496 2617.7749,-1012.0789"/>
<polygon fill="#000000" stroke="#000000" points="2618.6728,-1015.4622 2627.5246,-1009.6401 2616.9741,-1008.6714 2618.6728,-1015.4622"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="3742.5,-994.3023 3117.5,-994.3023 3117.5,-955.7011 3742.5,-955.7011 3742.5,-994.3023"/>
<text text-anchor="middle" x="3430" y="-979.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> It would be useful for our decorated AST to have no cycles, since we&#39;re guaranteed to </text>
<text text-anchor="middle" x="3430" y="-963.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> traverse it in linear time with no cycle checking. </text>
</g>
<!-- block_9&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_9&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3033.5158,-1054.2986C3102.2627,-1040.5492 3231.3155,-1014.7386 3323.5175,-996.2982"/>
<polygon fill="#000000" stroke="#000000" points="3324.3254,-999.706 3333.4448,-994.3128 3322.9526,-992.842 3324.3254,-999.706"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="3838" cy="-975.0017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3838" y="-970.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;82</text>
</g>
<!-- block_10&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>block_10&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3838,-1045.4023C3838,-1033.2966 3838,-1017.2094 3838,-1003.4691"/>
<polygon fill="#000000" stroke="#000000" points="3841.5001,-1003.0737 3838,-993.0737 3834.5001,-1003.0738 3841.5001,-1003.0737"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="3987,-993.0017 3933,-993.0017 3933,-957.0017 3987,-957.0017 3987,-993.0017"/>
</g>
<!-- block_10&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_10&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3866.0912,-1048.1687C3883.3889,-1038.0622 3905.6811,-1024.1537 3924,-1009.8018 3927.8191,-1006.8097 3931.6841,-1003.4681 3935.3935,-1000.0717"/>
<polygon fill="#000000" stroke="#000000" points="3937.8781,-1002.539 3942.7242,-993.1175 3933.0604,-997.4606 3937.8781,-1002.539"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="4049,-904.3025 3627,-904.3025 3627,.1008 4049,.1008 4049,-904.3025"/>
<text text-anchor="middle" x="3838" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="3838" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local backwalk = {}</text>
<text text-anchor="middle" x="3838" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_backref (ast)</text>
<text text-anchor="middle" x="3838" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function() return ast end</text>
<text text-anchor="middle" x="3838" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3838" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function index_gen ()</text>
<text text-anchor="middle" x="3838" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = {}</text>
<text text-anchor="middle" x="3838" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local last &#160;= {}</text>
<text text-anchor="middle" x="3838" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local closed = {}</text>
<text text-anchor="middle" x="3838" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = {}</text>
<text text-anchor="middle" x="3838" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local length = 0</text>
<text text-anchor="middle" x="3838" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local meta &#160;= util.F()</text>
<text text-anchor="middle" x="3838" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__call = function(_, ordinal)</text>
<text text-anchor="middle" x="3838" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return first[ordinal], last[ordinal], depth[ordinal]</text>
<text text-anchor="middle" x="3838" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This override requires 5.2</text>
<text text-anchor="middle" x="3838" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__len = function() return length end</text>
<text text-anchor="middle" x="3838" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.len = function() return length end</text>
<text text-anchor="middle" x="3838" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.add = function(table, deep)</text>
<text text-anchor="middle" x="3838" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;length = length+1</text>
<text text-anchor="middle" x="3838" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[length] = table</text>
<text text-anchor="middle" x="3838" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[table] &#160;= length &#45;&#45; Janus table!</text>
<text text-anchor="middle" x="3838" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[length] = deep</text>
<text text-anchor="middle" x="3838" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[table] &#160;= deep</text>
<text text-anchor="middle" x="3838" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.close = function(table)</text>
<text text-anchor="middle" x="3838" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[first[table]] = length</text>
<text text-anchor="middle" x="3838" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[table] = length</text>
<text text-anchor="middle" x="3838" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;setmetatable(closed,meta)</text>
<text text-anchor="middle" x="3838" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return closed</text>
<text text-anchor="middle" x="3838" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3838" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function backwalk.walk_ast (ast)</text>
<text text-anchor="middle" x="3838" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local index = index_gen()</text>
<text text-anchor="middle" x="3838" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local str = ast.str</text>
<text text-anchor="middle" x="3838" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function walker (ast, parent, deep)</text>
<text text-anchor="middle" x="3838" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;deep = deep + 1</text>
<text text-anchor="middle" x="3838" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="3838" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.add(ast,deep)</text>
<text text-anchor="middle" x="3838" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3838" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; and v.isnode then</text>
<text text-anchor="middle" x="3838" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;walker(v,ast, deep)</text>
<text text-anchor="middle" x="3838" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast.parent = make_backref(parent)</text>
<text text-anchor="middle" x="3838" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.close(ast)</text>
<text text-anchor="middle" x="3838" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3838" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;walker(ast,ast,0)</text>
<text text-anchor="middle" x="3838" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ast.index = index</text>
<text text-anchor="middle" x="3838" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return ast </text>
<text text-anchor="middle" x="3838" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3838" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return backwalk</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3838,-956.698C3838,-946.4229 3838,-932.2096 3838,-915.0592"/>
<polygon fill="#000000" stroke="#000000" points="3841.5001,-914.6295 3838,-904.6295 3834.5001,-914.6295 3841.5001,-914.6295"/>
</g>
</g>
</svg>