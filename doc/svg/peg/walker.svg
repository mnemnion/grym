<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4191pt" height="1200pt"
 viewBox="0.00 0.00 4191.00 1200.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1196.2017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1196.2017 4187,-1196.2017 4187,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1854" cy="-1174.2017" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="1854" y="-1170.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 82</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1854" cy="-1102.2017" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1854" y="-1098.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;82</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1854,-1156.033C1854,-1148.3326 1854,-1139.176 1854,-1130.6183"/>
<polygon fill="#000000" stroke="#000000" points="1857.5001,-1130.6149 1854,-1120.6149 1850.5001,-1130.615 1857.5001,-1130.6149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1423" cy="-1030.2017" rx="27" ry="18"/>
<text text-anchor="middle" x="1423" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1793.4586,-1100.058C1714.7866,-1095.8954 1573.8972,-1083.7129 1459,-1048.2017 1457.0973,-1047.6136 1455.1721,-1046.9334 1453.2529,-1046.1888"/>
<polygon fill="#000000" stroke="#000000" points="1454.4036,-1042.8716 1443.84,-1042.0585 1451.5909,-1049.2817 1454.4036,-1042.8716"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1514" cy="-1030.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1514" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;5</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1799.6999,-1094.054C1742.0147,-1084.9014 1648.3761,-1068.6194 1569,-1048.2017 1565.4333,-1047.2842 1561.7603,-1046.2604 1558.0847,-1045.1796"/>
<polygon fill="#000000" stroke="#000000" points="1559.0065,-1041.8015 1548.4199,-1042.2191 1556.9563,-1048.4945 1559.0065,-1041.8015"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1624" cy="-1030.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1624" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;7</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1811.5022,-1089.3087C1776.0247,-1078.4927 1724.1488,-1062.5543 1679,-1048.2017 1675.6922,-1047.1501 1672.2756,-1046.0546 1668.8397,-1044.9461"/>
<polygon fill="#000000" stroke="#000000" points="1669.7722,-1041.5691 1659.1801,-1041.8135 1667.6127,-1048.2277 1669.7722,-1041.5691"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1734" cy="-1030.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1734" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 8&#45;9</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1827.0697,-1086.0434C1809.6107,-1075.5681 1786.7191,-1061.8331 1768.008,-1050.6065"/>
<polygon fill="#000000" stroke="#000000" points="1769.5762,-1047.4657 1759.2005,-1045.322 1765.9747,-1053.4682 1769.5762,-1047.4657"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1854" cy="-1030.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1854" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 10&#45;12</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1854,-1084.033C1854,-1076.3326 1854,-1067.176 1854,-1058.6183"/>
<polygon fill="#000000" stroke="#000000" points="1857.5001,-1058.6149 1854,-1048.6149 1850.5001,-1058.615 1857.5001,-1058.6149"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="2102" cy="-1030.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2102" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 13&#45;14</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1897.4821,-1089.5778C1940.1908,-1077.1785 2005.351,-1058.261 2050.6004,-1045.1241"/>
<polygon fill="#000000" stroke="#000000" points="2051.595,-1048.4799 2060.2227,-1042.3306 2049.6433,-1041.7575 2051.595,-1048.4799"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="2528" cy="-1030.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2528" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 15&#45;19</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1911.1741,-1096.094C2036.3571,-1082.7214 2333.9207,-1050.9342 2464.6034,-1036.974"/>
<polygon fill="#000000" stroke="#000000" points="2465.275,-1040.4222 2474.8467,-1035.8798 2464.5314,-1033.4618 2465.275,-1040.4222"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="3073" cy="-1030.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3073" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 20&#45;22</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1913.6201,-1098.6802C2118.7893,-1086.5619 2794.7553,-1046.6361 3007.9706,-1034.0426"/>
<polygon fill="#000000" stroke="#000000" points="3008.2936,-1037.5297 3018.0698,-1033.4461 3007.8808,-1030.5419 3008.2936,-1037.5297"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="3617" cy="-1030.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3617" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 23&#45;82</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1914.1764,-1099.7441C2182.745,-1088.7759 3270.9186,-1044.3354 3551.0015,-1032.897"/>
<polygon fill="#000000" stroke="#000000" points="3551.5528,-1036.3775 3561.4016,-1032.4723 3551.2671,-1029.3833 3551.5528,-1036.3775"/>
</g>
<!-- prose_11 -->
<g id="node12" class="node">
<title>prose_11</title>
<ellipse fill="none" stroke="#000000" cx="538" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="538" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_3&#45;&gt;prose_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;prose_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1480.6289,-1017.7096C1473.576,-1015.5152 1466.1134,-1013.5163 1459,-1012.2017 1139.1339,-953.0876 1052.4438,-999.5471 728,-976.2017 677.0991,-972.5391 618.6719,-966.7681 580.1993,-962.7515"/>
<polygon fill="#000000" stroke="#000000" points="580.2112,-959.2336 569.9,-961.6684 579.479,-966.1952 580.2112,-959.2336"/>
</g>
<!-- prose_13 -->
<g id="node14" class="node">
<title>prose_13</title>
<ellipse fill="none" stroke="#000000" cx="769" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="769" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_4&#45;&gt;prose_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;prose_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1590.6099,-1017.8098C1583.5584,-1015.6082 1576.1011,-1013.5809 1569,-1012.2017 1421.687,-983.589 955.062,-964.8691 811.4679,-959.6737"/>
<polygon fill="#000000" stroke="#000000" points="811.4236,-956.17 801.3045,-959.3091 811.1726,-963.1655 811.4236,-956.17"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="1232" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1232" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_5&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1699.9614,-1017.9148C1693.0895,-1015.7603 1685.866,-1013.7245 1679,-1012.2017 1532.5651,-979.7242 1354.5149,-965.5952 1274.5147,-960.5551"/>
<polygon fill="#000000" stroke="#000000" points="1274.5397,-957.0501 1264.3439,-959.9303 1274.1105,-964.0369 1274.5397,-957.0501"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="1619" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1619" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_6&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>block_6&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1813.3344,-1017.7424C1769.4305,-1004.291 1700.041,-983.0312 1657.1438,-969.8883"/>
<polygon fill="#000000" stroke="#000000" points="1657.9509,-966.475 1647.3643,-966.892 1655.9003,-973.1679 1657.9509,-966.475"/>
</g>
<!-- prose_19 -->
<g id="node20" class="node">
<title>prose_19</title>
<ellipse fill="none" stroke="#000000" cx="2131" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2131" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_7&#45;&gt;prose_19 -->
<g id="edge19" class="edge">
<title>block_7&#45;&gt;prose_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2109.3179,-1012.033C2112.5364,-1004.0423 2116.3865,-994.4835 2119.9432,-985.6531"/>
<polygon fill="#000000" stroke="#000000" points="2123.2953,-986.6986 2123.7849,-976.1151 2116.8022,-984.0833 2123.2953,-986.6986"/>
</g>
<!-- prose_21 -->
<g id="node22" class="node">
<title>prose_21</title>
<ellipse fill="none" stroke="#000000" cx="2647" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2647" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_8&#45;&gt;prose_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;prose_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2554.41,-1014.2225C2572.7346,-1003.1353 2597.1991,-988.3333 2616.3785,-976.7289"/>
<polygon fill="#000000" stroke="#000000" points="2618.3039,-979.6548 2625.0479,-971.4836 2614.6802,-973.6657 2618.3039,-979.6548"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="3251" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3251" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>block_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3108.1671,-1015.9768C3139.1596,-1003.4405 3184.1029,-985.2612 3215.2645,-972.6565"/>
<polygon fill="#000000" stroke="#000000" points="3216.9046,-975.7686 3224.8625,-968.7741 3214.2797,-969.2794 3216.9046,-975.7686"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="3794" cy="-958.2017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3794" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;82</text>
</g>
<!-- block_10&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>block_10&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3651.9695,-1015.9768C3678.8788,-1005.0306 3716.3644,-989.7822 3746.0687,-977.6991"/>
<polygon fill="#000000" stroke="#000000" points="3747.4721,-980.9068 3755.4163,-973.8967 3744.8345,-974.4227 3747.4721,-980.9068"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="506,-479.3013 0,-479.3013 0,-424.9004 506,-424.9004 506,-479.3013"/>
<text text-anchor="middle" x="253" y="-464.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> This walks an AST, making back references to the parent node.</text>
<text text-anchor="middle" x="253" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="253" y="-433.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This shouldn&#39;t be a separate step, but that&#39;s premature optimization.</text>
</g>
<!-- prose_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M528.1897,-940.7805C487.2806,-868.1346 329.7835,-588.4524 273.3034,-488.1555"/>
<polygon fill="#000000" stroke="#000000" points="276.2723,-486.2944 268.3157,-479.2984 270.1729,-489.7292 276.2723,-486.2944"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="743.5,-470.1008 524.5,-470.1008 524.5,-434.1008 743.5,-434.1008 743.5,-470.1008"/>
<text text-anchor="middle" x="634" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is conceptually simple:</text>
</g>
<!-- prose_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>prose_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M763.5283,-940.2415C760.3711,-929.7548 756.3711,-916.2548 753,-904.2017 708.2934,-744.3555 659.0748,-551.388 641.0819,-480.2202"/>
<polygon fill="#000000" stroke="#000000" points="644.4045,-479.0826 638.5626,-470.244 637.6176,-480.7966 644.4045,-479.0826"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1212,-470.1008 762,-470.1008 762,-434.1008 1212,-434.1008 1212,-470.1008"/>
<text text-anchor="middle" x="987" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take the tree, add a parent reference &#160;that points to itself.</text>
</g>
<!-- prose_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>prose_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1223.5665,-940.7805C1187.3179,-865.901 1044.5865,-571.0582 1000.227,-479.4242"/>
<polygon fill="#000000" stroke="#000000" points="1003.2873,-477.7131 995.7798,-470.2373 996.9868,-480.7632 1003.2873,-477.7131"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1890,-471.4014 1230,-471.4014 1230,-432.8003 1890,-432.8003 1890,-471.4014"/>
<text text-anchor="middle" x="1560" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take all child members, if they&#39;re nodes, call the function recursively with the parent and</text>
<text text-anchor="middle" x="1560" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> nodes as argument.</text>
</g>
<!-- prose_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>prose_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.9002,-940.1893C1608.133,-864.9844 1574.3998,-575.6223 1563.4523,-481.7149"/>
<polygon fill="#000000" stroke="#000000" points="1566.8966,-481.0325 1562.2621,-471.5051 1559.9437,-481.8432 1566.8966,-481.0325"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="2414,-470.1008 1908,-470.1008 1908,-434.1008 2414,-434.1008 2414,-470.1008"/>
<text text-anchor="middle" x="2161" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is the usual recursive function wrapped in pre and post matter. </text>
</g>
<!-- prose_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2132.0677,-940.1893C2136.5507,-864.5609 2153.8716,-572.3569 2159.3375,-480.1473"/>
<polygon fill="#000000" stroke="#000000" points="2162.8315,-480.3506 2159.9295,-470.161 2155.8438,-479.9363 2162.8315,-480.3506"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="3099.5,-486.7021 2432.5,-486.7021 2432.5,-417.4996 3099.5,-417.4996 3099.5,-486.7021"/>
<text text-anchor="middle" x="2766" y="-471.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Now that I&#39;ve added an index, I&#39;m considering a cleaner parent implementation, where the </text>
<text text-anchor="middle" x="2766" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> parent is simply a number which must be looked up against the index. To completely eliminate</text>
<text text-anchor="middle" x="2766" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> back references, the index might be a closure which returns the table given the argument, </text>
<text text-anchor="middle" x="2766" y="-425.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> thus `index(i)` rather than `index[i]`. </text>
</g>
<!-- prose_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2651.2353,-940.1893C2668.0613,-868.6292 2730.4795,-603.1675 2755.5135,-496.6995"/>
<polygon fill="#000000" stroke="#000000" points="2758.9347,-497.44 2757.8166,-486.9043 2752.1206,-495.8377 2758.9347,-497.44"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3742.5,-471.4014 3117.5,-471.4014 3117.5,-432.8003 3742.5,-432.8003 3742.5,-471.4014"/>
<text text-anchor="middle" x="3430" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> It would be useful for our decorated AST to have no cycles, since we&#39;re guaranteed to </text>
<text text-anchor="middle" x="3430" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> traverse it in linear time with no cycle checking. </text>
</g>
<!-- prose_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3257.2657,-940.486C3283.747,-865.6134 3386.6404,-574.695 3419.706,-481.2059"/>
<polygon fill="#000000" stroke="#000000" points="3423.0877,-482.1408 3423.1225,-471.5461 3416.4883,-479.8067 3423.0877,-482.1408"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="4183,-904.3025 3761,-904.3025 3761,.1008 4183,.1008 4183,-904.3025"/>
<text text-anchor="middle" x="3972" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="3972" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local backwalk = {}</text>
<text text-anchor="middle" x="3972" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_backref (ast)</text>
<text text-anchor="middle" x="3972" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function() return ast end</text>
<text text-anchor="middle" x="3972" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function index_gen ()</text>
<text text-anchor="middle" x="3972" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = {}</text>
<text text-anchor="middle" x="3972" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local last &#160;= {}</text>
<text text-anchor="middle" x="3972" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local closed = {}</text>
<text text-anchor="middle" x="3972" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = {}</text>
<text text-anchor="middle" x="3972" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local length = 0</text>
<text text-anchor="middle" x="3972" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local meta &#160;= util.F()</text>
<text text-anchor="middle" x="3972" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__call = function(_, ordinal)</text>
<text text-anchor="middle" x="3972" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return first[ordinal], last[ordinal], depth[ordinal]</text>
<text text-anchor="middle" x="3972" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This override requires 5.2</text>
<text text-anchor="middle" x="3972" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__len = function() return length end</text>
<text text-anchor="middle" x="3972" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.len = function() return length end</text>
<text text-anchor="middle" x="3972" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.add = function(table, deep)</text>
<text text-anchor="middle" x="3972" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;length = length+1</text>
<text text-anchor="middle" x="3972" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[length] = table</text>
<text text-anchor="middle" x="3972" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[table] &#160;= length &#45;&#45; Janus table!</text>
<text text-anchor="middle" x="3972" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[length] = deep</text>
<text text-anchor="middle" x="3972" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[table] &#160;= deep</text>
<text text-anchor="middle" x="3972" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.close = function(table)</text>
<text text-anchor="middle" x="3972" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[first[table]] = length</text>
<text text-anchor="middle" x="3972" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[table] = length</text>
<text text-anchor="middle" x="3972" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;setmetatable(closed,meta)</text>
<text text-anchor="middle" x="3972" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return closed</text>
<text text-anchor="middle" x="3972" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function backwalk.walk_ast (ast)</text>
<text text-anchor="middle" x="3972" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local index = index_gen()</text>
<text text-anchor="middle" x="3972" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local str = ast.str</text>
<text text-anchor="middle" x="3972" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function walker (ast, parent, deep)</text>
<text text-anchor="middle" x="3972" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;deep = deep + 1</text>
<text text-anchor="middle" x="3972" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="3972" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.add(ast,deep)</text>
<text text-anchor="middle" x="3972" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3972" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; and v.isnode then</text>
<text text-anchor="middle" x="3972" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;walker(v,ast, deep)</text>
<text text-anchor="middle" x="3972" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast.parent = make_backref(parent)</text>
<text text-anchor="middle" x="3972" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.close(ast)</text>
<text text-anchor="middle" x="3972" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;walker(ast,ast,0)</text>
<text text-anchor="middle" x="3972" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ast.index = index</text>
<text text-anchor="middle" x="3972" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return ast </text>
<text text-anchor="middle" x="3972" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return backwalk</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_25&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3800.3351,-940.1893C3802.802,-933.1754 3805.924,-924.2987 3809.5842,-913.8915"/>
<polygon fill="#000000" stroke="#000000" points="3812.9203,-914.9551 3812.9365,-904.3602 3806.3168,-912.6325 3812.9203,-914.9551"/>
</g>
</g>
</svg>