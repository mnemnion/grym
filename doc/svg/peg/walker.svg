<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4191pt" height="1128pt"
 viewBox="0.00 0.00 4191.00 1128.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1124.2017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1124.2017 4187,-1124.2017 4187,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1690" cy="-1102.2017" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="1690" y="-1098.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 82</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1690" cy="-1030.2017" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1690" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;82</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1690,-1084.033C1690,-1076.3326 1690,-1067.176 1690,-1058.6183"/>
<polygon fill="#000000" stroke="#000000" points="1693.5001,-1058.6149 1690,-1048.6149 1686.5001,-1058.615 1693.5001,-1058.6149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1367" cy="-958.2017" rx="27" ry="18"/>
<text text-anchor="middle" x="1367" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1632.7244,-1024.1739C1573.9306,-1016.894 1480.3598,-1002.2518 1403,-976.2017 1401.1126,-975.5661 1399.1993,-974.849 1397.2892,-974.0763"/>
<polygon fill="#000000" stroke="#000000" points="1398.4577,-970.7647 1387.9007,-969.8707 1395.596,-977.153 1398.4577,-970.7647"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="1444" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1444" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1640.895,-1019.5426C1598.9578,-1009.9015 1537.3,-994.4451 1485,-976.2017 1482.7705,-975.4239 1480.4928,-974.5774 1478.2098,-973.6892"/>
<polygon fill="#000000" stroke="#000000" points="1479.4846,-970.4292 1468.9043,-969.874 1476.8291,-976.906 1479.4846,-970.4292"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="1526" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1526" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1655.6202,-1015.1081C1627.8097,-1002.8986 1588.8158,-985.7793 1560.8739,-973.5122"/>
<polygon fill="#000000" stroke="#000000" points="1562.0513,-970.2067 1551.4879,-969.3915 1559.2374,-976.6162 1562.0513,-970.2067"/>
</g>
<!-- prose_5 -->
<g id="node6" class="node">
<title>prose_5</title>
<ellipse fill="none" stroke="#000000" cx="1608" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1608" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;prose_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1670.5671,-1013.1387C1659.3006,-1003.246 1644.9965,-990.6864 1632.9098,-980.0737"/>
<polygon fill="#000000" stroke="#000000" points="1635.1653,-977.3964 1625.3415,-973.4284 1630.5466,-982.6565 1635.1653,-977.3964"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1690" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1690" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1690,-1012.033C1690,-1004.3326 1690,-995.176 1690,-986.6183"/>
<polygon fill="#000000" stroke="#000000" points="1693.5001,-986.6149 1690,-976.6149 1686.5001,-986.615 1693.5001,-986.6149"/>
</g>
<!-- prose_7 -->
<g id="node8" class="node">
<title>prose_7</title>
<ellipse fill="none" stroke="#000000" cx="2031" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2031" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;prose_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1739.5843,-1019.7322C1807.4753,-1005.3975 1928.0642,-979.9359 1990.7078,-966.7091"/>
<polygon fill="#000000" stroke="#000000" points="1991.5509,-970.1083 2000.6121,-964.6179 1990.1047,-963.2593 1991.5509,-970.1083"/>
</g>
<!-- prose_8 -->
<g id="node9" class="node">
<title>prose_8</title>
<ellipse fill="none" stroke="#000000" cx="2504" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2504" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;prose_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1748.2142,-1025.0525C1903.7441,-1011.2955 2326.315,-973.9183 2461.6767,-961.9452"/>
<polygon fill="#000000" stroke="#000000" points="2462.3784,-965.3969 2472.0311,-961.0294 2461.7615,-958.4242 2462.3784,-965.3969"/>
</g>
<!-- prose_9 -->
<g id="node10" class="node">
<title>prose_9</title>
<ellipse fill="none" stroke="#000000" cx="3073" cy="-958.2017" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="3073" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;prose_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1749.8697,-1027.0848C1983.5331,-1014.9201 2831.0393,-970.7983 3030.6726,-960.4053"/>
<polygon fill="#000000" stroke="#000000" points="3030.9545,-963.8954 3040.759,-959.8801 3030.5905,-956.9049 3030.9545,-963.8954"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="3651" cy="-958.2017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3651" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;82</text>
</g>
<!-- section_1&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1750.2983,-1027.9877C2033.384,-1017.594 3230.7193,-973.6327 3564.3706,-961.3823"/>
<polygon fill="#000000" stroke="#000000" points="3564.5958,-964.8765 3574.4606,-961.0119 3564.3389,-957.8812 3564.5958,-964.8765"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="506,-487.3012 0,-487.3012 0,-416.9004 506,-416.9004 506,-487.3012"/>
<text text-anchor="middle" x="253" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> This walks an AST, making back references to the parent node.</text>
<text text-anchor="middle" x="253" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="253" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This shouldn&#39;t be a separate step, but that&#39;s premature optimization.</text>
</g>
<!-- prose_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1420.2327,-945.992C1414.7085,-943.6587 1408.7564,-941.5319 1403,-940.2017 1306.7879,-917.968 599.5417,-955.2292 515,-904.2017 361.381,-811.4806 288.7407,-592.1535 263.6497,-497.2096"/>
<polygon fill="#000000" stroke="#000000" points="266.989,-496.1426 261.0948,-487.3387 260.2123,-497.8967 266.989,-496.1426"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="743.5,-472.0029 524.5,-472.0029 524.5,-432.1987 743.5,-432.1987 743.5,-472.0029"/>
<text text-anchor="middle" x="634" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is conceptually simple:</text>
</g>
<!-- prose_4&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_4&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1502.2241,-946.0287C1496.7003,-943.6936 1490.7506,-941.5567 1485,-940.2017 1405.7391,-921.5249 816.2534,-955.4863 753,-904.2017 621.4844,-797.5714 625.2873,-564.5209 631.203,-481.8853"/>
<polygon fill="#000000" stroke="#000000" points="634.6928,-482.1513 631.9818,-471.9092 627.714,-481.6064 634.6928,-482.1513"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1212,-472.0029 762,-472.0029 762,-432.1987 1212,-432.1987 1212,-472.0029"/>
<text text-anchor="middle" x="987" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take the tree, add a parent reference &#160;that points to itself.</text>
</g>
<!-- prose_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1583.7294,-946.0755C1578.3332,-943.7981 1572.5612,-941.6732 1567,-940.2017 1492.2681,-920.4268 1284.8703,-947.7503 1221,-904.2017 1068.4976,-800.2209 1009.0839,-565.0068 992.3705,-481.8834"/>
<polygon fill="#000000" stroke="#000000" points="995.7639,-480.9986 990.4146,-471.8534 988.8933,-482.3384 995.7639,-480.9986"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1890,-479.4013 1230,-479.4013 1230,-424.8004 1890,-424.8004 1890,-479.4013"/>
<text text-anchor="middle" x="1560" y="-448.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take all child members, if they&#39;re nodes, call the function recursively with the parent and</text>
<text text-anchor="middle" x="1560" y="-432.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> nodes as argument.</text>
</g>
<!-- prose_6&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>prose_6&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1685.3732,-940.1893C1666.5479,-866.9008 1595.481,-590.2312 1569.547,-489.2683"/>
<polygon fill="#000000" stroke="#000000" points="1572.9166,-488.3179 1567.0387,-479.5031 1566.1367,-490.0595 1572.9166,-488.3179"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2414,-472.0029 1908,-472.0029 1908,-432.1987 2414,-432.1987 2414,-472.0029"/>
<text text-anchor="middle" x="2161" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is the usual recursive function wrapped in pre and post matter. </text>
</g>
<!-- prose_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>prose_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2035.6268,-940.1893C2054.94,-865.0014 2129.2379,-575.7533 2153.3768,-481.7787"/>
<polygon fill="#000000" stroke="#000000" points="2156.7764,-482.6114 2155.8745,-472.055 2149.9965,-480.8698 2156.7764,-482.6114"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="3099.5,-494.7019 2432.5,-494.7019 2432.5,-409.4998 3099.5,-409.4998 3099.5,-494.7019"/>
<text text-anchor="middle" x="2766" y="-463.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Now that I&#39;ve added an index, I&#39;m considering a cleaner parent implementation, where the </text>
<text text-anchor="middle" x="2766" y="-448.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> parent is simply a number which must be looked up against the index. To completely eliminate</text>
<text text-anchor="middle" x="2766" y="-432.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> back references, the index might be a closure which returns the table given the argument, </text>
<text text-anchor="middle" x="2766" y="-417.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> thus `index(i)` rather than `index[i]`. </text>
</g>
<!-- prose_8&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>prose_8&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2513.0186,-940.7805C2548.8144,-871.6344 2681.711,-614.9205 2739.2065,-503.8575"/>
<polygon fill="#000000" stroke="#000000" points="2742.3837,-505.3331 2743.8729,-494.8434 2736.1673,-502.1149 2742.3837,-505.3331"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="3742.5,-479.4013 3117.5,-479.4013 3117.5,-424.8004 3742.5,-424.8004 3742.5,-479.4013"/>
<text text-anchor="middle" x="3430" y="-448.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> It would be useful for our decorated AST to have no cycles, since we&#39;re guaranteed to </text>
<text text-anchor="middle" x="3430" y="-432.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> traverse it in linear time with no cycle checking. </text>
</g>
<!-- prose_9&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>prose_9&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3084.878,-941.3628C3135.5463,-869.5329 3334.2307,-587.8681 3404.8898,-487.6982"/>
<polygon fill="#000000" stroke="#000000" points="3407.8308,-489.6009 3410.735,-479.4119 3402.1107,-485.566 3407.8308,-489.6009"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="4183,-904.3025 3761,-904.3025 3761,.1008 4183,.1008 4183,-904.3025"/>
<text text-anchor="middle" x="3972" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="3972" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local backwalk = {}</text>
<text text-anchor="middle" x="3972" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_backref (ast)</text>
<text text-anchor="middle" x="3972" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function() return ast end</text>
<text text-anchor="middle" x="3972" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function index_gen ()</text>
<text text-anchor="middle" x="3972" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = {}</text>
<text text-anchor="middle" x="3972" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local last &#160;= {}</text>
<text text-anchor="middle" x="3972" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local closed = {}</text>
<text text-anchor="middle" x="3972" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = {}</text>
<text text-anchor="middle" x="3972" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local length = 0</text>
<text text-anchor="middle" x="3972" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local meta &#160;= util.F()</text>
<text text-anchor="middle" x="3972" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__call = function(_, ordinal)</text>
<text text-anchor="middle" x="3972" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return first[ordinal], last[ordinal], depth[ordinal]</text>
<text text-anchor="middle" x="3972" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This override requires 5.2</text>
<text text-anchor="middle" x="3972" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__len = function() return length end</text>
<text text-anchor="middle" x="3972" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.len = function() return length end</text>
<text text-anchor="middle" x="3972" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.add = function(table, deep)</text>
<text text-anchor="middle" x="3972" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;length = length+1</text>
<text text-anchor="middle" x="3972" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[length] = table</text>
<text text-anchor="middle" x="3972" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[table] &#160;= length &#45;&#45; Janus table!</text>
<text text-anchor="middle" x="3972" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[length] = deep</text>
<text text-anchor="middle" x="3972" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[table] &#160;= deep</text>
<text text-anchor="middle" x="3972" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.close = function(table)</text>
<text text-anchor="middle" x="3972" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[first[table]] = length</text>
<text text-anchor="middle" x="3972" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[table] = length</text>
<text text-anchor="middle" x="3972" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;setmetatable(closed,meta)</text>
<text text-anchor="middle" x="3972" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return closed</text>
<text text-anchor="middle" x="3972" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function backwalk.walk_ast (ast)</text>
<text text-anchor="middle" x="3972" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local index = index_gen()</text>
<text text-anchor="middle" x="3972" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local str = ast.str</text>
<text text-anchor="middle" x="3972" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function walker (ast, parent, deep)</text>
<text text-anchor="middle" x="3972" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;deep = deep + 1</text>
<text text-anchor="middle" x="3972" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="3972" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.add(ast,deep)</text>
<text text-anchor="middle" x="3972" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3972" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; and v.isnode then</text>
<text text-anchor="middle" x="3972" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;walker(v,ast, deep)</text>
<text text-anchor="middle" x="3972" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast.parent = make_backref(parent)</text>
<text text-anchor="middle" x="3972" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.close(ast)</text>
<text text-anchor="middle" x="3972" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3972" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;walker(ast,ast,0)</text>
<text text-anchor="middle" x="3972" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ast.index = index</text>
<text text-anchor="middle" x="3972" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return ast </text>
<text text-anchor="middle" x="3972" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3972" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return backwalk</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>codeblock_10&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3692.7188,-943.005C3712.6127,-934.1154 3735.5906,-921.2485 3752,-904.2017 3752.6621,-903.5138 3753.3226,-902.8236 3753.9814,-902.1311"/>
<polygon fill="#000000" stroke="#000000" points="3756.7211,-904.325 3760.9777,-894.6228 3751.5998,-899.5529 3756.7211,-904.325"/>
</g>
</g>
</svg>