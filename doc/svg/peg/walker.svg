<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4269pt" height="1128pt"
 viewBox="0.00 0.00 4268.52 1128.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1124.2017)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1124.2017 4264.5207,-1124.2017 4264.5207,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1637.5207" cy="-1102.2017" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="1637.5207" y="-1098.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 82</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1637.5207" cy="-1030.2017" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1637.5207" y="-1026.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;82</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1637.5207,-1084.033C1637.5207,-1076.3326 1637.5207,-1067.176 1637.5207,-1058.6183"/>
<polygon fill="#000000" stroke="#000000" points="1641.0208,-1058.6149 1637.5207,-1048.6149 1634.0208,-1058.615 1641.0208,-1058.6149"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="271.5207" cy="-958.2017" rx="27" ry="18"/>
<text text-anchor="middle" x="271.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1576.7585,-1029.3499C1397.7898,-1026.4496 857.159,-1014.8788 410.5207,-976.2017 375.5889,-973.1767 335.9439,-967.8544 307.9581,-963.7793"/>
<polygon fill="#000000" stroke="#000000" points="308.2411,-960.2832 297.8373,-962.2859 307.2192,-967.2082 308.2411,-960.2832"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="465.5207" cy="-958.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="465.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;5</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1577.7898,-1026.5322C1375.3504,-1014.0956 716.964,-973.6487 521.0231,-961.6114"/>
<polygon fill="#000000" stroke="#000000" points="521.1506,-958.1127 510.9548,-960.9928 520.7213,-965.0995 521.1506,-958.1127"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="832.5207" cy="-958.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="832.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;7</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1579.3032,-1024.9946C1429.7617,-1011.6195 1033.6817,-976.1937 887.6257,-963.1303"/>
<polygon fill="#000000" stroke="#000000" points="887.8206,-959.6339 877.5486,-962.229 887.197,-966.606 887.8206,-959.6339"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1290.5207" cy="-958.2017" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1290.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 8&#45;9</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1587.4345,-1019.8091C1521.8736,-1006.2057 1407.5673,-982.488 1341.5452,-968.7889"/>
<polygon fill="#000000" stroke="#000000" points="1341.881,-965.2841 1331.3784,-966.6793 1340.4588,-972.1381 1341.881,-965.2841"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1637.5207" cy="-958.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1637.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 10&#45;12</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1637.5207,-1012.033C1637.5207,-1004.3326 1637.5207,-995.176 1637.5207,-986.6183"/>
<polygon fill="#000000" stroke="#000000" points="1641.0208,-986.6149 1637.5207,-976.6149 1634.0208,-986.615 1641.0208,-986.6149"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="2002.5207" cy="-958.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2002.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 13&#45;14</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1688.2724,-1020.1904C1755.578,-1006.9136 1874.0748,-983.5389 1944.7417,-969.5991"/>
<polygon fill="#000000" stroke="#000000" points="1945.6756,-972.9825 1954.8092,-967.6132 1944.3208,-966.1148 1945.6756,-972.9825"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="2487.5207" cy="-958.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2487.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 15&#45;19</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1695.9446,-1025.2528C1849.45,-1012.25 2263.3264,-977.1922 2423.2394,-963.6467"/>
<polygon fill="#000000" stroke="#000000" points="2423.731,-967.1176 2433.3998,-962.786 2423.1401,-960.1426 2423.731,-967.1176"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="3062.5207" cy="-958.2017" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3062.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 20&#45;22</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1697.841,-1027.1539C1928.9481,-1015.4769 2757.0222,-973.6374 2996.9447,-961.515"/>
<polygon fill="#000000" stroke="#000000" points="2997.4404,-964.9945 3007.251,-960.9942 2997.0871,-958.0034 2997.4404,-964.9945"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="3631.5207" cy="-958.2017" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3631.5207" y="-954.0017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 23&#45;82</text>
</g>
<!-- section_1&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1698.0129,-1028.0174C1984.7252,-1017.6647 3206.949,-973.5322 3544.7256,-961.3357"/>
<polygon fill="#000000" stroke="#000000" points="3545.0699,-964.8256 3554.937,-960.967 3544.8172,-957.8302 3545.0699,-964.8256"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="59.5207,-470.1008 5.5207,-470.1008 5.5207,-434.1008 59.5207,-434.1008 59.5207,-470.1008"/>
</g>
<!-- header_2&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>header_2&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M244.7846,-954.9106C194.9948,-948.196 91.0609,-931.2282 68.5207,-904.2017 -36.4799,-778.3022 5.5023,-558.1414 24.8374,-480.3252"/>
<polygon fill="#000000" stroke="#000000" points="28.3107,-480.8698 27.3977,-470.3144 21.529,-479.1353 28.3107,-480.8698"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="583.5207,-479.3013 77.5207,-479.3013 77.5207,-424.9004 583.5207,-424.9004 583.5207,-479.3013"/>
<text text-anchor="middle" x="330.5207" y="-464.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> This walks an AST, making back references to the parent node.</text>
<text text-anchor="middle" x="330.5207" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="330.5207" y="-433.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This shouldn&#39;t be a separate step, but that&#39;s premature optimization.</text>
</g>
<!-- block_3&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_3&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M460.716,-940.1893C441.1666,-866.9008 367.3663,-590.2312 340.4349,-489.2683"/>
<polygon fill="#000000" stroke="#000000" points="343.7893,-488.2632 337.8301,-479.5031 337.0258,-490.0673 343.7893,-488.2632"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="821.0207,-470.1008 602.0207,-470.1008 602.0207,-434.1008 821.0207,-434.1008 821.0207,-470.1008"/>
<text text-anchor="middle" x="711.5207" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is conceptually simple:</text>
</g>
<!-- block_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M828.2142,-940.1893C810.1328,-864.5609 740.2718,-572.3569 718.2261,-480.1473"/>
<polygon fill="#000000" stroke="#000000" points="721.568,-479.073 715.8386,-470.161 714.7599,-480.7007 721.568,-479.073"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1289.5207,-470.1008 839.5207,-470.1008 839.5207,-434.1008 1289.5207,-434.1008 1289.5207,-470.1008"/>
<text text-anchor="middle" x="1064.5207" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take the tree, add a parent reference &#160;that points to itself.</text>
</g>
<!-- block_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1282.4772,-940.1893C1248.6024,-864.3306 1117.4255,-570.575 1076.6712,-479.3104"/>
<polygon fill="#000000" stroke="#000000" points="1079.8588,-477.8648 1072.5855,-470.161 1073.4671,-480.7191 1079.8588,-477.8648"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1967.5207,-471.4014 1307.5207,-471.4014 1307.5207,-432.8003 1967.5207,-432.8003 1967.5207,-471.4014"/>
<text text-anchor="middle" x="1637.5207" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take all child members, if they&#39;re nodes, call the function recursively with the parent and</text>
<text text-anchor="middle" x="1637.5207" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> nodes as argument.</text>
</g>
<!-- block_6&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_6&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1637.5207,-940.1893C1637.5207,-864.9844 1637.5207,-575.6223 1637.5207,-481.7149"/>
<polygon fill="#000000" stroke="#000000" points="1641.0208,-481.5051 1637.5207,-471.5051 1634.0208,-481.5052 1641.0208,-481.5051"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2491.5207,-470.1008 1985.5207,-470.1008 1985.5207,-434.1008 2491.5207,-434.1008 2491.5207,-470.1008"/>
<text text-anchor="middle" x="2238.5207" y="-448.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is the usual recursive function wrapped in pre and post matter. </text>
</g>
<!-- block_7&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_7&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2010.9201,-940.1893C2046.2937,-864.3306 2183.275,-570.575 2225.8326,-479.3104"/>
<polygon fill="#000000" stroke="#000000" points="2229.0449,-480.7032 2230.0991,-470.161 2222.7007,-477.7448 2229.0449,-480.7032"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="3177.0207,-486.7021 2510.0207,-486.7021 2510.0207,-417.4996 3177.0207,-417.4996 3177.0207,-486.7021"/>
<text text-anchor="middle" x="2843.5207" y="-471.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Now that I&#39;ve added an index, I&#39;m considering a cleaner parent implementation, where the </text>
<text text-anchor="middle" x="2843.5207" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> parent is simply a number which must be looked up against the index. To completely eliminate</text>
<text text-anchor="middle" x="2843.5207" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> back references, the index might be a closure which returns the table given the argument, </text>
<text text-anchor="middle" x="2843.5207" y="-425.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> thus `index(i)` rather than `index[i]`. </text>
</g>
<!-- block_8&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_8&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2499.9822,-940.486C2550.2469,-869.0282 2738.936,-600.7817 2813.211,-495.1901"/>
<polygon fill="#000000" stroke="#000000" points="2816.0979,-497.1693 2818.9886,-486.9764 2810.3725,-493.1419 2816.0979,-497.1693"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="3820.0207,-471.4014 3195.0207,-471.4014 3195.0207,-432.8003 3820.0207,-432.8003 3820.0207,-471.4014"/>
<text text-anchor="middle" x="3507.5207" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> It would be useful for our decorated AST to have no cycles, since we&#39;re guaranteed to </text>
<text text-anchor="middle" x="3507.5207" y="-440.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> traverse it in linear time with no cycle checking. </text>
</g>
<!-- block_9&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_9&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3104.3287,-946.1385C3129.6823,-937.3755 3161.6379,-923.6256 3185.5207,-904.2017 3340.7355,-777.9652 3455.9815,-559.1203 3493.9972,-480.9125"/>
<polygon fill="#000000" stroke="#000000" points="3497.2637,-482.1962 3498.4483,-471.6678 3490.9567,-479.1595 3497.2637,-482.1962"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="4260.5207,-904.3025 3838.5207,-904.3025 3838.5207,.1008 4260.5207,.1008 4260.5207,-904.3025"/>
<text text-anchor="middle" x="4049.5207" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="4049.5207" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local backwalk = {}</text>
<text text-anchor="middle" x="4049.5207" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_backref (ast)</text>
<text text-anchor="middle" x="4049.5207" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function() return ast end</text>
<text text-anchor="middle" x="4049.5207" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4049.5207" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function index_gen ()</text>
<text text-anchor="middle" x="4049.5207" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = {}</text>
<text text-anchor="middle" x="4049.5207" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local last &#160;= {}</text>
<text text-anchor="middle" x="4049.5207" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local closed = {}</text>
<text text-anchor="middle" x="4049.5207" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = {}</text>
<text text-anchor="middle" x="4049.5207" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local length = 0</text>
<text text-anchor="middle" x="4049.5207" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local meta &#160;= util.F()</text>
<text text-anchor="middle" x="4049.5207" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__call = function(_, ordinal)</text>
<text text-anchor="middle" x="4049.5207" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return first[ordinal], last[ordinal], depth[ordinal]</text>
<text text-anchor="middle" x="4049.5207" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This override requires 5.2</text>
<text text-anchor="middle" x="4049.5207" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__len = function() return length end</text>
<text text-anchor="middle" x="4049.5207" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.len = function() return length end</text>
<text text-anchor="middle" x="4049.5207" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.add = function(table, deep)</text>
<text text-anchor="middle" x="4049.5207" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;length = length+1</text>
<text text-anchor="middle" x="4049.5207" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[length] = table</text>
<text text-anchor="middle" x="4049.5207" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[table] &#160;= length &#45;&#45; Janus table!</text>
<text text-anchor="middle" x="4049.5207" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[length] = deep</text>
<text text-anchor="middle" x="4049.5207" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[table] &#160;= deep</text>
<text text-anchor="middle" x="4049.5207" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.close = function(table)</text>
<text text-anchor="middle" x="4049.5207" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[first[table]] = length</text>
<text text-anchor="middle" x="4049.5207" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[table] = length</text>
<text text-anchor="middle" x="4049.5207" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;setmetatable(closed,meta)</text>
<text text-anchor="middle" x="4049.5207" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return closed</text>
<text text-anchor="middle" x="4049.5207" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4049.5207" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function backwalk.walk_ast (ast)</text>
<text text-anchor="middle" x="4049.5207" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local index = index_gen()</text>
<text text-anchor="middle" x="4049.5207" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local str = ast.str</text>
<text text-anchor="middle" x="4049.5207" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function walker (ast, parent, deep)</text>
<text text-anchor="middle" x="4049.5207" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;deep = deep + 1</text>
<text text-anchor="middle" x="4049.5207" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="4049.5207" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.add(ast,deep)</text>
<text text-anchor="middle" x="4049.5207" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, v in ipairs(ast) do</text>
<text text-anchor="middle" x="4049.5207" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; and v.isnode then</text>
<text text-anchor="middle" x="4049.5207" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;walker(v,ast, deep)</text>
<text text-anchor="middle" x="4049.5207" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast.parent = make_backref(parent)</text>
<text text-anchor="middle" x="4049.5207" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.close(ast)</text>
<text text-anchor="middle" x="4049.5207" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4049.5207" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;walker(ast,ast,0)</text>
<text text-anchor="middle" x="4049.5207" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ast.index = index</text>
<text text-anchor="middle" x="4049.5207" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return ast </text>
<text text-anchor="middle" x="4049.5207" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4049.5207" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return backwalk</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_10&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3693.1755,-947.1635C3743.2114,-937.1751 3808.7405,-921.4252 3829.5207,-904.2017 3829.8987,-903.8883 3830.2762,-903.5742 3830.653,-903.2593"/>
<polygon fill="#000000" stroke="#000000" points="3833.1787,-905.7035 3838.4789,-896.5296 3828.6147,-900.3959 3833.1787,-905.7035"/>
</g>
</g>
</svg>