<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="4007pt" height="1250pt"
 viewBox="0.00 0.00 4007.00 1249.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1245.8018)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1245.8018 4003,-1245.8018 4003,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1692" cy="-1223.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1692" y="-1219.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">82 &#160;</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1692" cy="-1151.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1692" y="-1147.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">82 &#160;</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1692,-1205.6331C1692,-1197.9327 1692,-1188.7761 1692,-1180.2184"/>
<polygon fill="#000000" stroke="#000000" points="1695.5001,-1180.215 1692,-1170.215 1688.5001,-1180.2151 1695.5001,-1180.215"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1404" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1404" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">: &#160;&#160;</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1665.2789,-1148.3415C1618.5986,-1141.8015 1519.5865,-1125.7192 1440,-1097.8018 1438.1208,-1097.1426 1436.2138,-1096.4071 1434.3085,-1095.6204"/>
<polygon fill="#000000" stroke="#000000" points="1435.4864,-1092.3118 1424.9328,-1091.3773 1432.6002,-1098.6891 1435.4864,-1092.3118"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1476" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1476" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;5 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1666.4913,-1145.6303C1631.1788,-1136.7551 1565.6807,-1119.0903 1512,-1097.8018 1510.1488,-1097.0676 1508.2635,-1096.2738 1506.3748,-1095.4428"/>
<polygon fill="#000000" stroke="#000000" points="1507.5848,-1092.1449 1497.0435,-1091.0808 1504.6204,-1098.4863 1507.5848,-1092.1449"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1548" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1548" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;7 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1670.1295,-1140.8665C1645.7778,-1128.6907 1606.238,-1108.9208 1578.7715,-1095.1875"/>
<polygon fill="#000000" stroke="#000000" points="1580.114,-1091.9457 1569.6045,-1090.604 1576.9835,-1098.2067 1580.114,-1091.9457"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1620" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1620" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;9 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1676.7307,-1136.5324C1666.803,-1126.6048 1653.6847,-1113.4865 1642.5637,-1102.3654"/>
<polygon fill="#000000" stroke="#000000" points="1644.7933,-1099.6453 1635.2473,-1095.0491 1639.8436,-1104.5951 1644.7933,-1099.6453"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1692" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1692" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">12 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1692,-1133.6331C1692,-1125.9327 1692,-1116.7761 1692,-1108.2184"/>
<polygon fill="#000000" stroke="#000000" points="1695.5001,-1108.215 1692,-1098.215 1688.5001,-1108.2151 1695.5001,-1108.215"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1897" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="1897" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">14 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1715.9173,-1143.4016C1752.3122,-1130.619 1821.7412,-1106.2342 1863.2533,-1091.6543"/>
<polygon fill="#000000" stroke="#000000" points="1864.643,-1094.8759 1872.9181,-1088.2598 1862.3233,-1088.2714 1864.643,-1094.8759"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="2368" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="2368" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">19 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1718.9172,-1148.9349C1824.2758,-1137.7132 2208.859,-1096.7517 2330.7064,-1083.7739"/>
<polygon fill="#000000" stroke="#000000" points="2331.4329,-1087.2164 2341.0059,-1082.6769 2330.6915,-1080.2558 2331.4329,-1087.2164"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="2935" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="2935" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">22 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1719.1178,-1150.231C1880.2803,-1140.8958 2711.4205,-1092.7525 2897.8549,-1081.9534"/>
<polygon fill="#000000" stroke="#000000" points="2898.1931,-1085.4398 2907.9739,-1081.3672 2897.7882,-1078.4515 2898.1931,-1085.4398"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="3788" cy="-1079.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="3788" y="-1075.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">82 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1719.2678,-1150.8651C1944.0812,-1143.1425 3489.6489,-1090.0505 3750.6169,-1081.0859"/>
<polygon fill="#000000" stroke="#000000" points="3750.8478,-1084.5802 3760.7217,-1080.7388 3750.6074,-1077.5843 3750.8478,-1084.5802"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="506,-1018.2021 0,-1018.2021 0,-947.8013 506,-947.8013 506,-1018.2021"/>
<text text-anchor="middle" x="253" y="-1002.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> This walks an AST, making back references to the parent node.</text>
<text text-anchor="middle" x="253" y="-987.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="253" y="-972.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This shouldn&#39;t be a separate step, but that&#39;s premature optimization.</text>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1455.6465,-1067.7621C1450.6835,-1065.3573 1445.2793,-1063.157 1440,-1061.8018 1240.7489,-1010.6542 719.675,-1046.4234 515,-1025.8018 497.6854,-1024.0573 479.7789,-1021.8963 461.8317,-1019.4797"/>
<polygon fill="#000000" stroke="#000000" points="462.2432,-1016.0035 451.8603,-1018.1119 461.2918,-1022.9385 462.2432,-1016.0035"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="743.5,-1002.9038 524.5,-1002.9038 524.5,-963.0996 743.5,-963.0996 743.5,-1002.9038"/>
<text text-anchor="middle" x="634" y="-987.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is conceptually simple:</text>
</g>
<!-- block_4&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1527.6381,-1067.7946C1522.6754,-1065.3885 1517.2734,-1063.1794 1512,-1061.8018 1185.2524,-976.4449 1084.225,-1091.6787 753,-1025.8018 731.3487,-1021.4956 708.3478,-1013.9696 688.3975,-1006.4173"/>
<polygon fill="#000000" stroke="#000000" points="689.457,-1003.0743 678.8681,-1002.7217 686.926,-1009.6007 689.457,-1003.0743"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1212,-1002.9038 762,-1002.9038 762,-963.0996 1212,-963.0996 1212,-1002.9038"/>
<text text-anchor="middle" x="987" y="-987.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take the tree, add a parent reference &#160;that points to itself.</text>
</g>
<!-- block_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1599.5841,-1067.9907C1594.6237,-1065.5765 1589.2363,-1063.3146 1584,-1061.8018 1428.2452,-1016.8031 1381.5413,-1048.4057 1221,-1025.8018 1179.5293,-1019.9628 1134.1964,-1012.0339 1094.5681,-1004.587"/>
<polygon fill="#000000" stroke="#000000" points="1095.0982,-1001.1253 1084.6219,-1002.7057 1093.7971,-1008.0034 1095.0982,-1001.1253"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1890,-1010.3021 1230,-1010.3021 1230,-955.7013 1890,-955.7013 1890,-1010.3021"/>
<text text-anchor="middle" x="1560" y="-995.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Take all child members, if they&#39;re nodes, call the function recursively with the parent and</text>
<text text-anchor="middle" x="1560" y="-979.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> nodes as argument.</text>
</g>
<!-- block_6&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_6&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1673.646,-1066.3421C1656.0929,-1053.4699 1628.9123,-1033.5374 1605.5339,-1016.3933"/>
<polygon fill="#000000" stroke="#000000" points="1607.5791,-1013.5529 1597.4453,-1010.4616 1603.4396,-1019.1977 1607.5791,-1013.5529"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2414,-1002.9038 1908,-1002.9038 1908,-963.0996 2414,-963.0996 2414,-1002.9038"/>
<text text-anchor="middle" x="2161" y="-987.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This is the usual recursive function wrapped in pre and post matter. </text>
</g>
<!-- block_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1920.8939,-1071.0407C1960.4288,-1056.5446 2040.7246,-1027.1027 2097.5547,-1006.265"/>
<polygon fill="#000000" stroke="#000000" points="2098.9859,-1009.4682 2107.1697,-1002.7395 2096.576,-1002.896 2098.9859,-1009.4682"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="3099.5,-1025.6028 2432.5,-1025.6028 2432.5,-940.4007 3099.5,-940.4007 3099.5,-1025.6028"/>
<text text-anchor="middle" x="2766" y="-1010.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> Now that I&#39;ve added an index, I&#39;m considering a cleaner parent implementation, where the </text>
<text text-anchor="middle" x="2766" y="-995.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> parent is simply a number which must be looked up against the index. To completely eliminate</text>
<text text-anchor="middle" x="2766" y="-979.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> back references, the index might be a closure which returns the table given the argument, </text>
<text text-anchor="middle" x="2766" y="-964.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> thus `index(i)` rather than `index[i]`. </text>
</g>
<!-- block_8&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_8&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2393.5021,-1073.5992C2431.8419,-1064.2744 2507.6736,-1045.8309 2580.9663,-1028.0049"/>
<polygon fill="#000000" stroke="#000000" points="2581.9298,-1031.3727 2590.8194,-1025.6085 2580.2755,-1024.571 2581.9298,-1031.3727"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="3742.5,-1010.3021 3117.5,-1010.3021 3117.5,-955.7013 3742.5,-955.7013 3742.5,-1010.3021"/>
<text text-anchor="middle" x="3430" y="-995.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> It would be useful for our decorated AST to have no cycles, since we&#39;re guaranteed to </text>
<text text-anchor="middle" x="3430" y="-979.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> traverse it in linear time with no cycle checking. </text>
</g>
<!-- block_9&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_9&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2960.9164,-1074.7337C3019.6289,-1063.2521 3166.5301,-1034.5248 3280.4348,-1012.25"/>
<polygon fill="#000000" stroke="#000000" points="3281.1649,-1015.6736 3290.3073,-1010.3194 3279.8214,-1008.8038 3281.1649,-1015.6736"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="3788" cy="-983.0017" rx="27" ry="18"/>
<text text-anchor="middle" x="3788" y="-978.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">82 &#160;</text>
</g>
<!-- block_10&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>block_10&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3788,-1061.5944C3788,-1047.3978 3788,-1027.431 3788,-1011.1756"/>
<polygon fill="#000000" stroke="#000000" points="3791.5001,-1011.1274 3788,-1001.1274 3784.5001,-1011.1275 3791.5001,-1011.1274"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="3887,-1001.0017 3833,-1001.0017 3833,-965.0017 3887,-965.0017 3887,-1001.0017"/>
</g>
<!-- block_10&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_10&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3800.2138,-1063.381C3811.2471,-1048.5474 3827.6757,-1026.46 3840.521,-1009.1902"/>
<polygon fill="#000000" stroke="#000000" points="3843.3398,-1011.2649 3846.4996,-1001.1523 3837.7231,-1007.0872 3843.3398,-1011.2649"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="3999,-904.3025 3577,-904.3025 3577,.1008 3999,.1008 3999,-904.3025"/>
<text text-anchor="middle" x="3788" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="3788" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">local backwalk = {}</text>
<text text-anchor="middle" x="3788" y="-842.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_backref (ast)</text>
<text text-anchor="middle" x="3788" y="-826.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return function() return ast end</text>
<text text-anchor="middle" x="3788" y="-811.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3788" y="-764.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function index_gen ()</text>
<text text-anchor="middle" x="3788" y="-748.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local first = {}</text>
<text text-anchor="middle" x="3788" y="-733.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local last &#160;= {}</text>
<text text-anchor="middle" x="3788" y="-717.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local closed = {}</text>
<text text-anchor="middle" x="3788" y="-702.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = {}</text>
<text text-anchor="middle" x="3788" y="-687.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local length = 0</text>
<text text-anchor="middle" x="3788" y="-671.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local meta &#160;= util.F()</text>
<text text-anchor="middle" x="3788" y="-656.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__call = function(_, ordinal)</text>
<text text-anchor="middle" x="3788" y="-640.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return first[ordinal], last[ordinal], depth[ordinal]</text>
<text text-anchor="middle" x="3788" y="-625.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-610.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; This override requires 5.2</text>
<text text-anchor="middle" x="3788" y="-594.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;meta.__len = function() return length end</text>
<text text-anchor="middle" x="3788" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.len = function() return length end</text>
<text text-anchor="middle" x="3788" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.add = function(table, deep)</text>
<text text-anchor="middle" x="3788" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;length = length+1</text>
<text text-anchor="middle" x="3788" y="-533.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[length] = table</text>
<text text-anchor="middle" x="3788" y="-517.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;first[table] &#160;= length &#45;&#45; Janus table!</text>
<text text-anchor="middle" x="3788" y="-502.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[length] = deep</text>
<text text-anchor="middle" x="3788" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;depth[table] &#160;= deep</text>
<text text-anchor="middle" x="3788" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;closed.close = function(table)</text>
<text text-anchor="middle" x="3788" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[first[table]] = length</text>
<text text-anchor="middle" x="3788" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;last[table] = length</text>
<text text-anchor="middle" x="3788" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;setmetatable(closed,meta)</text>
<text text-anchor="middle" x="3788" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return closed</text>
<text text-anchor="middle" x="3788" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3788" y="-332.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">function backwalk.walk_ast (ast)</text>
<text text-anchor="middle" x="3788" y="-316.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local index = index_gen()</text>
<text text-anchor="middle" x="3788" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local str = ast.str</text>
<text text-anchor="middle" x="3788" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function walker (ast, parent, deep)</text>
<text text-anchor="middle" x="3788" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;deep = deep + 1</text>
<text text-anchor="middle" x="3788" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="3788" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.add(ast,deep)</text>
<text text-anchor="middle" x="3788" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3788" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; and v.isnode then</text>
<text text-anchor="middle" x="3788" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;walker(v,ast, deep)</text>
<text text-anchor="middle" x="3788" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast.parent = make_backref(parent)</text>
<text text-anchor="middle" x="3788" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;index.close(ast)</text>
<text text-anchor="middle" x="3788" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3788" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;walker(ast,ast,0)</text>
<text text-anchor="middle" x="3788" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;ast.index = index</text>
<text text-anchor="middle" x="3788" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return ast </text>
<text text-anchor="middle" x="3788" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3788" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return backwalk</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3788,-964.7269C3788,-952.8036 3788,-935.5637 3788,-914.5596"/>
<polygon fill="#000000" stroke="#000000" points="3791.5001,-914.3033 3788,-904.3033 3784.5001,-914.3033 3791.5001,-914.3033"/>
</g>
</g>
</svg>