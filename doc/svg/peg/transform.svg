<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3477pt" height="1393pt"
 viewBox="0.00 0.00 3476.83 1393.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1389.4016)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1389.4016 3472.8256,-1389.4016 3472.8256,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1190.3256" cy="-1367.4016" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1190.3256" y="-1363.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 151</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1190.3256" cy="-1295.4016" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1190.3256" y="-1291.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;151</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1190.3256,-1349.233C1190.3256,-1341.5325 1190.3256,-1332.3759 1190.3256,-1323.8182"/>
<polygon fill="#000000" stroke="#000000" points="1193.8257,-1323.8148 1190.3256,-1313.8149 1186.8257,-1323.8149 1193.8257,-1323.8148"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="631.3256" cy="-1223.4016" rx="27" ry="18"/>
<text text-anchor="middle" x="631.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1125.7923,-1291.6442C1005.5542,-1284.1642 751.792,-1265.9893 667.3256,-1241.4016 665.1996,-1240.7827 663.0483,-1240.0413 660.9107,-1239.2171"/>
<polygon fill="#000000" stroke="#000000" points="662.3096,-1236.0089 651.7459,-1235.1974 659.4979,-1242.4194 662.3096,-1236.0089"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="708.3256" cy="-1223.4016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="708.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1124.9113,-1293.3307C1037.7813,-1289.2361 879.5004,-1277.1156 749.3256,-1241.4016 746.8985,-1240.7357 744.4296,-1239.9504 741.9682,-1239.0864"/>
<polygon fill="#000000" stroke="#000000" points="743.2055,-1235.8123 732.6168,-1235.4512 740.6692,-1242.3367 743.2055,-1235.8123"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="826.3256" cy="-1223.4016" rx="67.748" ry="18"/>
<text text-anchor="middle" x="826.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1134.8956,-1285.713C1076.9866,-1275.4178 983.5695,-1258.3214 903.3256,-1241.4016 897.9524,-1240.2686 892.3784,-1239.0502 886.7976,-1237.8008"/>
<polygon fill="#000000" stroke="#000000" points="887.3131,-1234.3289 876.7866,-1235.5301 885.7646,-1241.1555 887.3131,-1234.3289"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="962.3256" cy="-1223.4016" rx="50.0142" ry="18"/>
<text text-anchor="middle" x="962.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;11</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1147.1725,-1281.7743C1108.0529,-1269.4208 1050.493,-1251.2439 1010.0218,-1238.4635"/>
<polygon fill="#000000" stroke="#000000" points="1010.9692,-1235.0924 1000.3793,-1235.4186 1008.8612,-1241.7675 1010.9692,-1235.0924"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1062.3256" cy="-1223.4016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1062.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1161.2804,-1279.0637C1141.3236,-1267.838 1114.8256,-1252.9328 1094.2726,-1241.3718"/>
<polygon fill="#000000" stroke="#000000" points="1095.7242,-1238.1726 1085.2925,-1236.3205 1092.2924,-1244.2737 1095.7242,-1238.1726"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1190.3256" cy="-1223.4016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1190.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;69</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1190.3256,-1277.233C1190.3256,-1269.5325 1190.3256,-1260.3759 1190.3256,-1251.8182"/>
<polygon fill="#000000" stroke="#000000" points="1193.8257,-1251.8148 1190.3256,-1241.8149 1186.8257,-1251.8149 1193.8257,-1251.8148"/>
</g>
<!-- prose_8 -->
<g id="node9" class="node">
<title>prose_8</title>
<ellipse fill="none" stroke="#000000" cx="1497.3256" cy="-1223.4016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1497.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;prose_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1240.3337,-1283.6733C1300.9551,-1269.4559 1401.8864,-1245.7847 1457.508,-1232.7399"/>
<polygon fill="#000000" stroke="#000000" points="1458.41,-1236.1234 1467.3466,-1230.4325 1456.8116,-1229.3084 1458.41,-1236.1234"/>
</g>
<!-- prose_9 -->
<g id="node10" class="node">
<title>prose_9</title>
<ellipse fill="none" stroke="#000000" cx="1839.3256" cy="-1223.4016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1839.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;prose_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1251.3819,-1288.628C1382.0624,-1274.1303 1686.009,-1240.4105 1797.4227,-1228.0503"/>
<polygon fill="#000000" stroke="#000000" points="1798.0383,-1231.5036 1807.5914,-1226.9222 1797.2664,-1224.5462 1798.0383,-1231.5036"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="2292.3256" cy="-1223.4016" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2292.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;139</text>
</g>
<!-- section_1&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1254.337,-1291.2194C1441.4287,-1278.9956 1987.6906,-1243.3051 2203.3091,-1229.2176"/>
<polygon fill="#000000" stroke="#000000" points="2203.5734,-1232.7078 2213.3239,-1228.5632 2203.117,-1225.7227 2203.5734,-1232.7078"/>
</g>
<!-- prose_11 -->
<g id="node12" class="node">
<title>prose_11</title>
<ellipse fill="none" stroke="#000000" cx="2742.3256" cy="-1223.4016" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2742.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;prose_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1255.3139,-1292.5712C1434.8483,-1284.728 1952.8276,-1261.9369 2383.3256,-1241.4016 2497.8165,-1235.9402 2632.8215,-1229.0498 2699.9672,-1225.5922"/>
<polygon fill="#000000" stroke="#000000" points="2700.3409,-1229.0777 2710.1475,-1225.0676 2699.9805,-1222.087 2700.3409,-1229.0777"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="3132.3256" cy="-1223.4016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3132.3256" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 143&#45;151</text>
</g>
<!-- section_1&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1255.9691,-1293.5917C1473.5091,-1287.5051 2190.6451,-1266.7291 2783.3256,-1241.4016 2869.5535,-1237.7167 2967.7153,-1232.5691 3037.9228,-1228.7221"/>
<polygon fill="#000000" stroke="#000000" points="3038.2808,-1232.2078 3048.0737,-1228.1642 3037.8967,-1225.2183 3038.2808,-1232.2078"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="69.3256,-710.7008 15.3256,-710.7008 15.3256,-674.7008 69.3256,-674.7008 69.3256,-710.7008"/>
</g>
<!-- prose_3&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_3&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M684.1007,-1211.0953C678.7016,-1208.829 672.9169,-1206.7543 667.3256,-1205.4016 603.5975,-1189.984 125.0192,-1215.4308 78.3256,-1169.4016 -46.3747,-1046.4758 10.0121,-802.3946 33.7031,-720.3424"/>
<polygon fill="#000000" stroke="#000000" points="37.0674,-721.3077 36.5467,-710.7257 30.3547,-719.3228 37.0674,-721.3077"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="243.3256,-710.7008 87.3256,-710.7008 87.3256,-674.7008 243.3256,-674.7008 243.3256,-710.7008"/>
<text text-anchor="middle" x="165.3256" y="-689.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_4&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M777.67,-1210.8086C768.3138,-1208.7338 758.5547,-1206.8057 749.3256,-1205.4016 694.5885,-1197.0743 293.5358,-1206.3774 252.3256,-1169.4016 120.3528,-1050.989 146.7143,-804.4425 160.1523,-721.0047"/>
<polygon fill="#000000" stroke="#000000" points="163.6283,-721.4386 161.8305,-710.9974 156.7247,-720.2808 163.6283,-721.4386"/>
</g>
<!-- structure_15 -->
<g id="node16" class="node">
<title>structure_15</title>
<ellipse fill="none" stroke="#000000" cx="306.3256" cy="-692.7008" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="306.3256" y="-688.5008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_5&#45;&gt;structure_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;structure_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.8247,-1210.842C918.4519,-1208.71 910.6993,-1206.7522 903.3256,-1205.4016 843.8493,-1194.5075 404.0658,-1211.1497 360.3256,-1169.4016 233.3398,-1048.1992 278.8444,-803.4565 298.8922,-720.7433"/>
<polygon fill="#000000" stroke="#000000" points="302.342,-721.3743 301.3651,-710.8246 295.5499,-719.6809 302.342,-721.3743"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="819.3256,-712.6029 369.3256,-712.6029 369.3256,-672.7987 819.3256,-672.7987 819.3256,-712.6029"/>
<text text-anchor="middle" x="594.3256" y="-681.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
</g>
<!-- prose_6&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_6&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1037.9581,-1211.614C1032.5679,-1209.3154 1026.8229,-1207.0964 1021.3256,-1205.4016 937.9411,-1179.6946 897.8191,-1222.1698 828.3256,-1169.4016 674.4721,-1052.5767 615.7097,-807.6277 599.4477,-722.5633"/>
<polygon fill="#000000" stroke="#000000" points="602.8553,-721.7427 597.5902,-712.5487 595.9726,-723.0193 602.8553,-721.7427"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1364.8256,-1115.9022 837.8256,-1115.9022 837.8256,-269.4994 1364.8256,-269.4994 1364.8256,-1115.9022"/>
<text text-anchor="middle" x="1101.3256" y="-1100.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="1101.3256" y="-1069.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="1101.3256" y="-1053.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="1101.3256" y="-1022.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="1101.3256" y="-1007.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="1101.3256" y="-975.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1101.3256" y="-944.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="1101.3256" y="-912.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1101.3256" y="-897.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1101.3256" y="-866.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-850.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-819.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="1101.3256" y="-803.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="1101.3256" y="-788.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="1101.3256" y="-773.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="1101.3256" y="-757.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="1101.3256" y="-742.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1101.3256" y="-726.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1101.3256" y="-711.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1101.3256" y="-696.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1101.3256" y="-664.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="1101.3256" y="-649.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="1101.3256" y="-633.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="1101.3256" y="-618.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-603.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-587.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="1101.3256" y="-572.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1101.3256" y="-540.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="1101.3256" y="-525.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-510.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="1101.3256" y="-494.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="1101.3256" y="-479.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1101.3256" y="-463.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="1101.3256" y="-448.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1101.3256" y="-417.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="1101.3256" y="-401.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="1101.3256" y="-386.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="1101.3256" y="-370.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="1101.3256" y="-355.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="1101.3256" y="-340.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-324.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1101.3256" y="-293.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="1101.3256" y="-277.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1187.262,-1205.1337C1184.4105,-1188.1302 1179.745,-1160.3103 1174.0213,-1126.1801"/>
<polygon fill="#000000" stroke="#000000" points="1177.4019,-1125.1761 1172.2961,-1115.8928 1170.4983,-1126.334 1177.4019,-1125.1761"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1791.3256,-720.0012 1383.3256,-720.0012 1383.3256,-665.4004 1791.3256,-665.4004 1791.3256,-720.0012"/>
<text text-anchor="middle" x="1587.3256" y="-688.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="1587.3256" y="-673.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
</g>
<!-- prose_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>prose_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1500.3716,-1205.4401C1513.2109,-1129.7313 1563.0742,-835.7031 1580.9248,-730.4443"/>
<polygon fill="#000000" stroke="#000000" points="1584.4265,-730.7284 1582.6478,-720.2839 1577.525,-729.5579 1584.4265,-730.7284"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2210.8256,-720.0012 1809.8256,-720.0012 1809.8256,-665.4004 2210.8256,-665.4004 2210.8256,-720.0012"/>
<text text-anchor="middle" x="2010.3256" y="-688.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="2010.3256" y="-673.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
</g>
<!-- prose_9&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_9&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1845.113,-1205.4401C1869.5569,-1129.5784 1964.6311,-834.5142 1998.3688,-729.8087"/>
<polygon fill="#000000" stroke="#000000" points="2001.7023,-730.8755 2001.4379,-720.2839 1995.0396,-728.7286 2001.7023,-730.8755"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2819.3256,-1169.6025 2229.3256,-1169.6025 2229.3256,-215.7991 2819.3256,-215.7991 2819.3256,-1169.6025"/>
<text text-anchor="middle" x="2524.3256" y="-1154.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="2524.3256" y="-1138.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="2524.3256" y="-1107.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="2524.3256" y="-1092.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isnode then</text>
<text text-anchor="middle" x="2524.3256" y="-1076.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-1061.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-1045.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="2524.3256" y="-1030.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="2524.3256" y="-999.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="2524.3256" y="-983.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="2524.3256" y="-968.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="2524.3256" y="-952.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-937.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2524.3256" y="-922.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="2524.3256" y="-906.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-875.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="2524.3256" y="-859.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2524.3256" y="-844.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="2524.3256" y="-829.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode then</text>
<text text-anchor="middle" x="2524.3256" y="-813.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="2524.3256" y="-798.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="2524.3256" y="-782.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-767.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-736.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="2524.3256" y="-704.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2524.3256" y="-689.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-673.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-658.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-627.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="2524.3256" y="-611.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="2524.3256" y="-596.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-580.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-549.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2524.3256" y="-534.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-518.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-487.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="2524.3256" y="-471.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2524.3256" y="-456.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode then</text>
<text text-anchor="middle" x="2524.3256" y="-441.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="2524.3256" y="-425.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-410.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-378.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of Node (aka span)</text>
<text text-anchor="middle" x="2524.3256" y="-363.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.val then</text>
<text text-anchor="middle" x="2524.3256" y="-348.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-332.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(ast.val, leaf_count)</text>
<text text-anchor="middle" x="2524.3256" y="-317.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="2524.3256" y="-301.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="2524.3256" y="-286.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-271.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2524.3256" y="-239.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="2524.3256" y="-224.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_10&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2300.1776,-1205.4401C2303.2695,-1198.3674 2307.1943,-1189.3894 2311.8069,-1178.838"/>
<polygon fill="#000000" stroke="#000000" points="2315.0415,-1180.1766 2315.8402,-1169.6119 2308.6276,-1177.3727 2315.0415,-1180.1766"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3105.3256,-712.6029 2837.3256,-712.6029 2837.3256,-672.7987 3105.3256,-672.7987 3105.3256,-712.6029"/>
<text text-anchor="middle" x="2971.3256" y="-681.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
</g>
<!-- prose_11&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_11&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2768.8744,-1212.8502C2788.0083,-1203.9585 2813.0529,-1189.4596 2828.3256,-1169.4016 2936.559,-1027.2557 2963.2426,-803.7365 2969.5025,-723.0323"/>
<polygon fill="#000000" stroke="#000000" points="2973.0254,-722.8425 2970.2567,-712.6158 2966.0436,-722.3369 2973.0254,-722.8425"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3468.8256,-751.201 3123.8256,-751.201 3123.8256,-634.2006 3468.8256,-634.2006 3468.8256,-751.201"/>
<text text-anchor="middle" x="3296.3256" y="-736.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3296.3256" y="-720.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3296.3256" y="-689.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3296.3256" y="-673.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3296.3256" y="-642.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_12&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3137.9708,-1205.1337C3159.5224,-1135.3931 3237.305,-883.6903 3275.2344,-760.9516"/>
<polygon fill="#000000" stroke="#000000" points="3278.6177,-761.8573 3278.2263,-751.2697 3271.9298,-759.7905 3278.6177,-761.8573"/>
</g>
<!-- hashline_16 -->
<g id="node17" class="node">
<title>hashline_16</title>
<ellipse fill="none" stroke="#000000" cx="306.3256" cy="-162" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="306.3256" y="-157.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_15&#45;&gt;hashline_16 -->
<g id="edge16" class="edge">
<title>structure_15&#45;&gt;hashline_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M306.3256,-674.4329C306.3256,-595.8093 306.3256,-285.9177 306.3256,-190.2696"/>
<polygon fill="#000000" stroke="#000000" points="309.8257,-190.1911 306.3256,-180.1911 302.8257,-190.1911 309.8257,-190.1911"/>
</g>
<!-- hashtag_17 -->
<g id="node18" class="node">
<title>hashtag_17</title>
<ellipse fill="none" stroke="#000000" cx="306.3256" cy="-90" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="306.3256" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_16&#45;&gt;hashtag_17 -->
<g id="edge17" class="edge">
<title>hashline_16&#45;&gt;hashtag_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M306.3256,-143.8314C306.3256,-136.131 306.3256,-126.9743 306.3256,-118.4166"/>
<polygon fill="#000000" stroke="#000000" points="309.8257,-118.4132 306.3256,-108.4133 302.8257,-118.4133 309.8257,-118.4132"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="333.3256,-36 279.3256,-36 279.3256,0 333.3256,0 333.3256,-36"/>
</g>
<!-- hashtag_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>hashtag_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M306.3256,-71.8314C306.3256,-64.131 306.3256,-54.9743 306.3256,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="309.8257,-46.4132 306.3256,-36.4133 302.8257,-46.4133 309.8257,-46.4132"/>
</g>
</g>
</svg>