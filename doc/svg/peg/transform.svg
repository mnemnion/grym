<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3713pt" height="3979pt"
 viewBox="0.00 0.00 3713.00 3978.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3974.8057)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-3974.8057 3709,-3974.8057 3709,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1694" cy="-3952.8057" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1694" y="-3948.6057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 160</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1694" cy="-3880.8057" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1694" y="-3876.6057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;160</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1694,-3934.637C1694,-3926.9366 1694,-3917.78 1694,-3909.2223"/>
<polygon fill="#000000" stroke="#000000" points="1697.5001,-3909.2189 1694,-3899.2189 1690.5001,-3909.219 1697.5001,-3909.2189"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="159" cy="-2588.0037" rx="27" ry="18"/>
<text text-anchor="middle" x="159" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.4163,-3879.655C1342.806,-3874.4942 220.618,-3852.6025 195,-3826.8057 -151.8259,-3477.5587 92.4442,-2763.2875 148.3553,-2615.2347"/>
<polygon fill="#000000" stroke="#000000" points="151.7495,-2616.1569 152.0446,-2605.5662 145.2094,-2613.6613 151.7495,-2616.1569"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="250" cy="-2588.0037" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="250" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.262,-3879.4506C1355.8542,-3873.6863 328.7421,-3850.4173 305,-3826.8057 128.7475,-3651.5219 225.7238,-2784.4257 246.4081,-2616.2757"/>
<polygon fill="#000000" stroke="#000000" points="249.897,-2616.5807 247.6565,-2606.2255 242.9504,-2615.7177 249.897,-2616.5807"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="360" cy="-2588.0037" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="360" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 2&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.1226,-3879.5438C1405.282,-3874.9964 691.4767,-3858.042 654,-3826.8057 265.5715,-3503.0557 336.5754,-2768.7136 356.0841,-2616.1007"/>
<polygon fill="#000000" stroke="#000000" points="359.5613,-2616.502 357.3927,-2606.1315 352.6209,-2615.591 359.5613,-2616.502"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="713" cy="-2588.0037" rx="50.0142" ry="18"/>
<text text-anchor="middle" x="713" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;11</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1629.9353,-3876.5704C1513.8693,-3868.3867 1277.9885,-3849.2177 1248,-3826.8057 818.7246,-3505.9847 729.4422,-2769.3369 715.3021,-2616.2002"/>
<polygon fill="#000000" stroke="#000000" points="718.7845,-2615.8461 714.4102,-2606.1965 711.8121,-2616.4678 718.7845,-2615.8461"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1313" cy="-2588.0037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1313" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 12&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.6198,-3869.4696C1601.5146,-3859.3519 1548.4434,-3843.5783 1534,-3826.8057 1209.2594,-3449.6962 1287.4623,-2762.8171 1308.6325,-2616.0616"/>
<polygon fill="#000000" stroke="#000000" points="1312.1091,-2616.476 1310.1075,-2606.072 1305.1842,-2615.4535 1312.1091,-2616.476"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1599" cy="-2588.0037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1599" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;70</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1692.6571,-3862.5302C1682.2028,-3720.2636 1613.9057,-2790.8469 1601.0757,-2616.2513"/>
<polygon fill="#000000" stroke="#000000" points="1604.5515,-2615.7913 1600.3279,-2606.0747 1597.5703,-2616.3044 1604.5515,-2615.7913"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1789" cy="-2588.0037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1789" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1695.3429,-3862.5302C1705.7972,-3720.2636 1774.0943,-2790.8469 1786.9243,-2616.2513"/>
<polygon fill="#000000" stroke="#000000" points="1790.4297,-2616.3044 1787.6721,-2606.0747 1783.4485,-2615.7913 1790.4297,-2616.3044"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="2095" cy="-2588.0037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2095" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 74&#45;76</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1745.3144,-3869.4125C1786.3784,-3859.2591 1839.4262,-3843.4651 1854,-3826.8057 2182.6272,-3451.1496 2117.2304,-2763.1373 2098.8344,-2616.1145"/>
<polygon fill="#000000" stroke="#000000" points="2102.2944,-2615.579 2097.5485,-2606.1065 2095.3515,-2616.4711 2102.2944,-2615.579"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="2572" cy="-2588.0037" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2572" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 77&#45;149</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1758.766,-3877.1365C1879.4827,-3869.7448 2129.4674,-3851.625 2160,-3826.8057 2561.9297,-3500.0854 2574.5824,-2769.475 2572.6701,-2616.4465"/>
<polygon fill="#000000" stroke="#000000" points="2576.1636,-2616.0015 2572.5051,-2606.0584 2569.1645,-2616.1128 2576.1636,-2616.0015"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="2797" cy="-2588.0037" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="2797" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 150&#45;151</text>
</g>
<!-- section_1&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.5763,-3879.3535C1968.9744,-3874.4204 2609.7829,-3856.9161 2642,-3826.8057 3003.8611,-3488.6064 2843.2041,-2767.1038 2804.5367,-2616.0797"/>
<polygon fill="#000000" stroke="#000000" points="2807.8735,-2615.0042 2801.9723,-2606.205 2801.0983,-2616.7637 2807.8735,-2615.0042"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="3031" cy="-2588.0037" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3031" y="-2583.8037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 152&#45;160</text>
</g>
<!-- section_1&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.7788,-3880.108C2001.7922,-3877.2442 2830.8766,-3864.694 2872,-3826.8057 3056.1307,-3657.1602 3037.447,-2785.53 3032.0217,-2616.4379"/>
<polygon fill="#000000" stroke="#000000" points="3035.5161,-2616.2092 3031.6858,-2606.331 3028.52,-2616.4417 3035.5161,-2616.2092"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3705,-3826.6076 3115,-3826.6076 3115,-1349.3998 3705,-1349.3998 3705,-3826.6076"/>
<text text-anchor="middle" x="3410" y="-3811.6057" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-3796.2056" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
<text text-anchor="middle" x="3410" y="-3780.8056" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-3749.4056" font-family="Inconsolata" font-size="14.00" fill="#000000"> @module transform</text>
<text text-anchor="middle" x="3410" y="-3702.0056" font-family="Inconsolata" font-size="14.00" fill="#000000"> #TODO: </text>
<text text-anchor="middle" x="3410" y="-3670.6055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make header and footer configurable values of t</text>
<text text-anchor="middle" x="3410" y="-3655.2055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
<text text-anchor="middle" x="3410" y="-3623.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-3608.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="3410" y="-3577.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="3410" y="-3561.6054" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="3410" y="-3530.2053" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="3410" y="-3514.8053" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="3410" y="-3483.4053" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="3410" y="-3452.0052" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="3410" y="-3420.6052" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="3410" y="-3405.2052" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="3410" y="-3373.8051" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="3410" y="-3358.4051" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="3410" y="-3327.0051" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="3410" y="-3311.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="3410" y="-3296.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="3410" y="-3280.805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="3410" y="-3265.405" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="3410" y="-3250.0049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3410" y="-3234.6049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3410" y="-3219.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-3203.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-3172.4048" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-3157.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="3410" y="-3141.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="3410" y="-3126.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-3110.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="3410" y="-3095.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="3410" y="-3080.0046" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-3048.6046" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="3410" y="-3033.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-3017.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="3410" y="-3002.4045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="3410" y="-2987.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2971.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="3410" y="-2956.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2924.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2909.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="3410" y="-2894.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="3410" y="-2878.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="3410" y="-2863.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="3410" y="-2847.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="3410" y="-2832.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2801.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="3410" y="-2785.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2770.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-2738.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="3410" y="-2723.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
<text text-anchor="middle" x="3410" y="-2692.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="3410" y="-2676.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
<text text-anchor="middle" x="3410" y="-2645.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-2629.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="3410" y="-2614.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="3410" y="-2583.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="3410" y="-2567.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isnode or ast.isNode then</text>
<text text-anchor="middle" x="3410" y="-2552.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2536.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2521.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="3410" y="-2506.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="3410" y="-2474.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="3410" y="-2459.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="3410" y="-2443.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2428.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2413.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="3410" y="-2397.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="3410" y="-2382.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2350.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="3410" y="-2335.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="3410" y="-2320.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="3410" y="-2304.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="3410" y="-2289.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="3410" y="-2273.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2258.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2243.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2227.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="3410" y="-2196.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="3410" y="-2164.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="3410" y="-2149.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2134.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2118.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2087.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="3410" y="-2071.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="3410" y="-2056.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2041.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2009.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="3410" y="-1994.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1978.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1947.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="3410" y="-1932.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="3410" y="-1916.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="3410" y="-1901.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="3410" y="-1885.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1870.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1839.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of Node (aka span)</text>
<text text-anchor="middle" x="3410" y="-1823.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local leaf_val = nil</text>
<text text-anchor="middle" x="3410" y="-1792.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.val then</text>
<text text-anchor="middle" x="3410" y="-1776.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast.val</text>
<text text-anchor="middle" x="3410" y="-1761.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif ast.toValue then</text>
<text text-anchor="middle" x="3410" y="-1746.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast:toValue()</text>
<text text-anchor="middle" x="3410" y="-1730.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1699.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if leaf_val &#160;then</text>
<text text-anchor="middle" x="3410" y="-1683.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-1668.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(leaf_val, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-1653.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1637.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="3410" y="-1622.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1606.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1575.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="3410" y="-1560.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-1544.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-1513.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
<text text-anchor="middle" x="3410" y="-1481.802" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-1466.402" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3410" y="-1451.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3410" y="-1419.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3410" y="-1404.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-1372.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
<text text-anchor="middle" x="3410" y="-1357.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_1&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>section_1&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.7703,-3880.4753C2031.295,-3878.8333 3053.2756,-3869.8084 3106,-3826.8057 3106.3754,-3826.4995 3106.7504,-3826.1929 3107.1249,-3825.886"/>
<polygon fill="#000000" stroke="#000000" points="3109.4861,-3828.4744 3114.9292,-3819.3847 3105.0057,-3823.0961 3109.4861,-3828.4744"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1311.2018 0,-1311.2018 0,-1275.2018 54,-1275.2018 54,-1311.2018"/>
</g>
<!-- block_3&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_3&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M251.9967,-2569.6967C266.7131,-2431.1287 353.4683,-1547.4027 195,-1349.2018 158.9546,-1304.1187 123.1499,-1332.8485 63.8957,-1312.8401"/>
<polygon fill="#000000" stroke="#000000" points="64.7729,-1309.4309 54.1807,-1309.1917 62.3118,-1315.9841 64.7729,-1309.4309"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="140" cy="-1293.2018" rx="67.748" ry="18"/>
<text text-anchor="middle" x="140" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- block_4&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>block_4&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M365.9169,-2569.9068C404.2425,-2448.9821 606.481,-1750.7716 305,-1349.2018 298.126,-1340.0457 241.678,-1322.1345 196.6935,-1309.0254"/>
<polygon fill="#000000" stroke="#000000" points="197.5792,-1305.6381 187.0005,-1306.2226 195.6347,-1312.3627 197.5792,-1305.6381"/>
</g>
<!-- structure_15 -->
<g id="node16" class="node">
<title>structure_15</title>
<ellipse fill="none" stroke="#000000" cx="270" cy="-1293.2018" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="270" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_4&#45;&gt;structure_15 -->
<g id="edge15" class="edge">
<title>block_4&#45;&gt;structure_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M362.5509,-2569.9567C377.9784,-2456.04 453.3065,-1826.1283 305,-1349.2018 301.7318,-1338.6919 295.9929,-1328.1894 290.0959,-1319.1668"/>
<polygon fill="#000000" stroke="#000000" points="292.8001,-1316.9238 284.2318,-1310.6919 287.0437,-1320.9068 292.8001,-1316.9238"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="387,-1313.2018 333,-1313.2018 333,-1273.2018 387,-1273.2018 387,-1313.2018"/>
</g>
<!-- block_4&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_4&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M360,-2569.7C360,-2427.8242 360,-1504.3265 360,-1323.7839"/>
<polygon fill="#000000" stroke="#000000" points="363.5001,-1323.6624 360,-1313.6624 356.5001,-1323.6624 363.5001,-1323.6624"/>
</g>
<!-- structure_21 -->
<g id="node22" class="node">
<title>structure_21</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-1293.2018" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="450" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_5&#45;&gt;structure_21 -->
<g id="edge21" class="edge">
<title>block_5&#45;&gt;structure_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M709.2821,-2569.7C680.3258,-2427.1423 491.0766,-1495.43 455.6935,-1321.232"/>
<polygon fill="#000000" stroke="#000000" points="459.0968,-1320.4039 453.6763,-1311.3007 452.2369,-1321.7973 459.0968,-1320.4039"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="913.5,-1313.1039 512.5,-1313.1039 512.5,-1273.2997 913.5,-1273.2997 913.5,-1313.1039"/>
<text text-anchor="middle" x="713" y="-1281.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make header and footer configurable values of t</text>
</g>
<!-- block_5&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_5&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M713,-2569.7C713,-2427.6736 713,-1502.3649 713,-1323.2114"/>
<polygon fill="#000000" stroke="#000000" points="716.5001,-1323.1791 713,-1313.1791 709.5001,-1323.1792 716.5001,-1323.1791"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1382,-1311.2018 932,-1311.2018 932,-1275.2018 1382,-1275.2018 1382,-1311.2018"/>
<text text-anchor="middle" x="1157" y="-1289.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
</g>
<!-- block_6&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_6&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1310.7947,-2569.7C1293.6191,-2427.1423 1181.3648,-1495.43 1160.3771,-1321.232"/>
<polygon fill="#000000" stroke="#000000" points="1163.8517,-1320.8102 1159.1806,-1311.3007 1156.902,-1321.6476 1163.8517,-1320.8102"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="1477" cy="-1293.2018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1477" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;69</text>
</g>
<!-- block_7&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>block_7&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1597.2754,-2569.7C1583.8499,-2427.2133 1496.142,-1496.3587 1479.6657,-1321.4931"/>
<polygon fill="#000000" stroke="#000000" points="1483.1281,-1320.9283 1478.7053,-1311.3007 1476.1589,-1321.585 1483.1281,-1320.9283"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1626,-1311.2018 1572,-1311.2018 1572,-1275.2018 1626,-1275.2018 1626,-1311.2018"/>
</g>
<!-- block_7&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_7&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1599,-2569.7C1599,-2427.2133 1599,-1496.3587 1599,-1321.4931"/>
<polygon fill="#000000" stroke="#000000" points="1602.5001,-1321.3007 1599,-1311.3007 1595.5001,-1321.3008 1602.5001,-1321.3007"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2052,-1312.5024 1644,-1312.5024 1644,-1273.9012 2052,-1273.9012 2052,-1312.5024"/>
<text text-anchor="middle" x="1848" y="-1297.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="1848" y="-1282.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
</g>
<!-- block_8&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>block_8&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1789.834,-2569.7C1796.3094,-2427.5939 1838.5165,-1501.3252 1846.6463,-1322.9103"/>
<polygon fill="#000000" stroke="#000000" points="1850.1526,-1322.8503 1847.1115,-1312.7013 1843.1598,-1322.5316 1850.1526,-1322.8503"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2471.5,-1312.5024 2070.5,-1312.5024 2070.5,-1273.9012 2471.5,-1273.9012 2471.5,-1312.5024"/>
<text text-anchor="middle" x="2271" y="-1297.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="2271" y="-1282.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
</g>
<!-- block_9&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_9&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2097.488,-2569.7C2116.8138,-2427.523 2242.8357,-1500.4015 2266.998,-1322.644"/>
<polygon fill="#000000" stroke="#000000" points="2270.4706,-1323.0816 2268.3495,-1312.7013 2263.5344,-1322.1387 2270.4706,-1323.0816"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2572" cy="-1293.2018" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2572" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;148</text>
</g>
<!-- block_10&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>block_10&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572,-2569.7C2572,-2427.2133 2572,-1496.3587 2572,-1321.4931"/>
<polygon fill="#000000" stroke="#000000" points="2575.5001,-1321.3007 2572,-1311.3007 2568.5001,-1321.3008 2575.5001,-1321.3007"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2726,-1311.2018 2672,-1311.2018 2672,-1275.2018 2726,-1275.2018 2726,-1311.2018"/>
</g>
<!-- block_10&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>block_10&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2573.7953,-2569.7C2587.771,-2427.2133 2679.0735,-1496.3587 2696.2251,-1321.4931"/>
<polygon fill="#000000" stroke="#000000" points="2699.7318,-1321.5947 2697.2248,-1311.3007 2692.7652,-1320.9113 2699.7318,-1321.5947"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3012,-1311.2018 2744,-1311.2018 2744,-1275.2018 3012,-1275.2018 3012,-1311.2018"/>
<text text-anchor="middle" x="2878" y="-1289.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
</g>
<!-- block_11&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_11&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2798.145,-2569.7C2807.0587,-2427.2133 2865.2909,-1496.3587 2876.2302,-1321.4931"/>
<polygon fill="#000000" stroke="#000000" points="2879.7365,-1321.4998 2876.8678,-1311.3007 2872.7501,-1321.0627 2879.7365,-1321.4998"/>
</g>
<!-- codeblock_36 -->
<g id="node37" class="node">
<title>codeblock_36</title>
<ellipse fill="none" stroke="#000000" cx="3117" cy="-1293.2018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3117" y="-1289.0018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 152&#45;160</text>
</g>
<!-- block_12&#45;&gt;codeblock_36 -->
<g id="edge36" class="edge">
<title>block_12&#45;&gt;codeblock_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3031.1905,-2569.7315C3032.5558,-2456.9372 3042.717,-1843.9693 3106,-1349.2018 3107.1745,-1340.0188 3108.9571,-1330.079 3110.7473,-1321.1582"/>
<polygon fill="#000000" stroke="#000000" points="3114.1961,-1321.7651 3112.8165,-1311.2605 3107.3442,-1320.3326 3114.1961,-1321.7651"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="3276,-1311.2018 3222,-1311.2018 3222,-1275.2018 3276,-1275.2018 3276,-1311.2018"/>
</g>
<!-- block_12&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_12&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3025.434,-2569.8474C2989.4419,-2448.5367 2800.511,-1748.2655 3106,-1349.2018 3134.7121,-1311.6949 3163.515,-1330.864 3212.3829,-1312.8386"/>
<polygon fill="#000000" stroke="#000000" points="3213.8092,-1316.0369 3221.7456,-1309.018 3211.1644,-1309.5557 3213.8092,-1316.0369"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="210,-708.6009 54,-708.6009 54,-672.6009 210,-672.6009 210,-708.6009"/>
<text text-anchor="middle" x="132" y="-687.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_14&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M139.7606,-1275.1672C138.6244,-1189.5825 133.7735,-824.1891 132.3773,-719.0231"/>
<polygon fill="#000000" stroke="#000000" points="135.8749,-718.8122 132.2424,-708.8595 128.8755,-718.9052 135.8749,-718.8122"/>
</g>
<!-- handleline_17 -->
<g id="node18" class="node">
<title>handleline_17</title>
<ellipse fill="none" stroke="#000000" cx="278" cy="-690.6009" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="278" y="-686.4009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_15&#45;&gt;handleline_17 -->
<g id="edge17" class="edge">
<title>structure_15&#45;&gt;handleline_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M270.2394,-1275.1672C271.3756,-1189.5825 276.2265,-824.1891 277.6227,-719.0231"/>
<polygon fill="#000000" stroke="#000000" points="281.1245,-718.9052 277.7576,-708.8595 274.1251,-718.8122 281.1245,-718.9052"/>
</g>
<!-- handle_18 -->
<g id="node19" class="node">
<title>handle_18</title>
<ellipse fill="none" stroke="#000000" cx="278" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="278" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_17&#45;&gt;handle_18 -->
<g id="edge18" class="edge">
<title>handleline_17&#45;&gt;handle_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M278,-672.2982C278,-586.3803 278,-222.875 278,-118.2692"/>
<polygon fill="#000000" stroke="#000000" points="281.5001,-118.1598 278,-108.1599 274.5001,-118.1599 281.5001,-118.1598"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="305,-36 251,-36 251,0 305,0 305,-36"/>
</g>
<!-- handle_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>handle_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M278,-71.8314C278,-64.131 278,-54.9743 278,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="281.5001,-46.4132 278,-36.4133 274.5001,-46.4133 281.5001,-46.4132"/>
</g>
<!-- hashline_22 -->
<g id="node23" class="node">
<title>hashline_22</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-690.6009" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="450" y="-686.4009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_21&#45;&gt;hashline_22 -->
<g id="edge22" class="edge">
<title>structure_21&#45;&gt;hashline_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-1275.1672C450,-1189.5825 450,-824.1891 450,-719.0231"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-718.8595 450,-708.8595 446.5001,-718.8596 453.5001,-718.8595"/>
</g>
<!-- hashtag_23 -->
<g id="node24" class="node">
<title>hashtag_23</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-90" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="450" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_22&#45;&gt;hashtag_23 -->
<g id="edge23" class="edge">
<title>hashline_22&#45;&gt;hashtag_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-672.2982C450,-586.3803 450,-222.875 450,-118.2692"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-118.1598 450,-108.1599 446.5001,-118.1599 453.5001,-118.1598"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="477,-36 423,-36 423,0 477,0 477,-36"/>
</g>
<!-- hashtag_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>hashtag_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-71.8314C450,-64.131 450,-54.9743 450,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-46.4132 450,-36.4133 446.5001,-46.4133 453.5001,-46.4132"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="1740.5,-1113.8023 1213.5,-1113.8023 1213.5,-267.3995 1740.5,-267.3995 1740.5,-1113.8023"/>
<text text-anchor="middle" x="1477" y="-1098.5016" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="1477" y="-1067.1015" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="1477" y="-1051.7015" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="1477" y="-1020.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="1477" y="-1004.9015" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="1477" y="-973.5014" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1477" y="-942.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="1477" y="-910.7014" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1477" y="-895.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1477" y="-863.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="1477" y="-848.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="1477" y="-817.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="1477" y="-801.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="1477" y="-786.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="1477" y="-770.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="1477" y="-755.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="1477" y="-740.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1477" y="-724.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1477" y="-709.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1477" y="-693.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-662.501" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="1477" y="-647.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="1477" y="-631.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="1477" y="-616.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="1477" y="-600.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1477" y="-585.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="1477" y="-570.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-538.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="1477" y="-523.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="1477" y="-507.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="1477" y="-492.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="1477" y="-477.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1477" y="-461.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="1477" y="-446.3005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-414.9005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="1477" y="-399.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="1477" y="-384.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="1477" y="-368.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="1477" y="-353.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="1477" y="-337.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="1477" y="-322.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1477" y="-291.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="1477" y="-275.7003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>codeblock_27&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1477,-1275.1672C1477,-1247.6828 1477,-1191.342 1477,-1124.03"/>
<polygon fill="#000000" stroke="#000000" points="1480.5001,-1124.0212 1477,-1114.0213 1473.5001,-1124.0213 1480.5001,-1124.0212"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2867,-1237.3027 2277,-1237.3027 2277,-143.8991 2867,-143.8991 2867,-1237.3027"/>
<text text-anchor="middle" x="2572" y="-1222.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="2572" y="-1206.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="2572" y="-1175.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="2572" y="-1159.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isnode or ast.isNode then</text>
<text text-anchor="middle" x="2572" y="-1144.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-1129.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-1113.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="2572" y="-1098.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="2572" y="-1066.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="2572" y="-1051.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="2572" y="-1036.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="2572" y="-1020.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="2572" y="-1005.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2572" y="-989.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="2572" y="-974.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-943.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="2572" y="-927.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2572" y="-912.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="2572" y="-896.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="2572" y="-881.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="2572" y="-866.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="2572" y="-850.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-835.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-819.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="2572" y="-788.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="2572" y="-757.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2572" y="-741.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="2572" y="-726.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="2572" y="-710.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-679.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="2572" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="2572" y="-648.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-633.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2572" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-539.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="2572" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2572" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="2572" y="-493.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="2572" y="-478.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-462.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-431.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of Node (aka span)</text>
<text text-anchor="middle" x="2572" y="-415.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local leaf_val = nil</text>
<text text-anchor="middle" x="2572" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.val then</text>
<text text-anchor="middle" x="2572" y="-369.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast.val</text>
<text text-anchor="middle" x="2572" y="-353.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif ast.toValue then</text>
<text text-anchor="middle" x="2572" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast:toValue()</text>
<text text-anchor="middle" x="2572" y="-322.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if leaf_val &#160;then</text>
<text text-anchor="middle" x="2572" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(leaf_val, leaf_count)</text>
<text text-anchor="middle" x="2572" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="2572" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="2572" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>codeblock_32&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572,-1275.1672C2572,-1267.8969 2572,-1258.6076 2572,-1247.6301"/>
<polygon fill="#000000" stroke="#000000" points="2575.5001,-1247.557 2572,-1237.5571 2568.5001,-1247.5571 2575.5001,-1247.557"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3289.5,-749.1011 2944.5,-749.1011 2944.5,-632.1007 3289.5,-632.1007 3289.5,-749.1011"/>
<text text-anchor="middle" x="3117" y="-733.901" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3117" y="-718.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3117" y="-687.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3117" y="-671.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3117" y="-640.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
</g>
<!-- codeblock_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3117,-1275.1672C3117,-1198.4606 3117,-896.9866 3117,-759.5496"/>
<polygon fill="#000000" stroke="#000000" points="3120.5001,-759.5457 3117,-749.5458 3113.5001,-759.5458 3120.5001,-759.5457"/>
</g>
</g>
</svg>