<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3543pt" height="1462pt"
 viewBox="0.00 0.00 3542.94 1461.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1457.8018)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1457.8018 3538.94,-1457.8018 3538.94,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1167.44" cy="-1435.8018" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1167.44" y="-1431.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 160</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1167.44" cy="-1363.8018" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1167.44" y="-1359.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;160</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.44,-1417.6331C1167.44,-1409.9327 1167.44,-1400.7761 1167.44,-1392.2184"/>
<polygon fill="#000000" stroke="#000000" points="1170.9401,-1392.215 1167.44,-1382.215 1163.9401,-1392.2151 1170.9401,-1392.215"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="228.44" cy="-1291.8018" rx="27" ry="18"/>
<text text-anchor="middle" x="228.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1102.2244,-1361.7093C962.0578,-1356.7392 621.8131,-1342.1387 338.44,-1309.8018 313.656,-1306.9736 285.9406,-1302.4296 264.5302,-1298.615"/>
<polygon fill="#000000" stroke="#000000" points="265.03,-1295.1486 254.5665,-1296.8116 263.7832,-1302.0367 265.03,-1295.1486"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="393.44" cy="-1291.8018" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="393.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1102.2905,-1361.123C980.6235,-1355.5711 710.7873,-1340.6653 485.44,-1309.8018 471.8198,-1307.9364 457.1717,-1305.3423 443.6567,-1302.7035"/>
<polygon fill="#000000" stroke="#000000" points="444.0706,-1299.217 433.5784,-1300.6882 442.698,-1306.0811 444.0706,-1299.217"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="562.44" cy="-1291.8018" rx="67.748" ry="18"/>
<text text-anchor="middle" x="562.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1104.0217,-1358.7654C1007.3696,-1350.7112 817.5337,-1333.4037 657.44,-1309.8018 647.4758,-1308.3328 636.9639,-1306.5636 626.7082,-1304.7157"/>
<polygon fill="#000000" stroke="#000000" points="627.0361,-1301.2173 616.5678,-1302.8497 625.7692,-1308.1017 627.0361,-1301.2173"/>
</g>
<!-- structure_5 -->
<g id="node6" class="node">
<title>structure_5</title>
<ellipse fill="none" stroke="#000000" cx="711.44" cy="-1291.8018" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="711.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;structure_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1104.8545,-1358.08C1026.7256,-1350.2842 889.2614,-1334.4133 773.44,-1309.8018 767.9583,-1308.6369 762.2527,-1307.2404 756.6199,-1305.7473"/>
<polygon fill="#000000" stroke="#000000" points="757.1944,-1302.2749 746.6234,-1302.9842 755.3295,-1309.0219 757.1944,-1302.2749"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="838.44" cy="-1291.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="838.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 12&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1116.0338,-1352.5518C1055.9445,-1339.4015 956.8334,-1317.7116 894.7222,-1304.1188"/>
<polygon fill="#000000" stroke="#000000" points="895.2232,-1300.6457 884.7061,-1301.9269 893.7266,-1307.4839 895.2232,-1300.6457"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1167.44" cy="-1291.8018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1167.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;69</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.44,-1345.6331C1167.44,-1337.9327 1167.44,-1328.7761 1167.44,-1320.2184"/>
<polygon fill="#000000" stroke="#000000" points="1170.9401,-1320.215 1167.44,-1310.215 1163.9401,-1320.2151 1170.9401,-1320.215"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1485.44" cy="-1291.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1485.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1218.1797,-1352.3136C1275.8649,-1339.2527 1369.7553,-1317.9946 1429.5118,-1304.4648"/>
<polygon fill="#000000" stroke="#000000" points="1430.5463,-1307.8192 1439.5265,-1302.1973 1429.0004,-1300.992 1430.5463,-1307.8192"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1845.44" cy="-1291.8018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1845.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 74&#45;76</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1228.8038,-1357.2853C1357.0227,-1343.6691 1652.1819,-1312.3248 1782.098,-1298.5284"/>
<polygon fill="#000000" stroke="#000000" points="1782.7082,-1301.9833 1792.2827,-1297.4468 1781.969,-1295.0225 1782.7082,-1301.9833"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="2295.44" cy="-1291.8018" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2295.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;148</text>
</g>
<!-- section_1&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1231.7273,-1359.6983C1422.5442,-1347.5185 1986.0387,-1311.5508 2206.0282,-1297.5089"/>
<polygon fill="#000000" stroke="#000000" points="2206.4846,-1300.987 2216.2413,-1296.857 2206.0387,-1294.0012 2206.4846,-1300.987"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="2749.44" cy="-1291.8018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="2749.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 150&#45;151</text>
</g>
<!-- section_1&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1232.5273,-1361.0395C1414.7465,-1353.2802 1945.505,-1330.5003 2386.44,-1309.8018 2486.2174,-1305.118 2601.402,-1299.3439 2674.7852,-1295.619"/>
<polygon fill="#000000" stroke="#000000" points="2675.047,-1299.1103 2684.8565,-1295.1073 2674.6918,-1292.1193 2675.047,-1299.1103"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="3141.44" cy="-1291.8018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3141.44" y="-1287.6018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 152&#45;160</text>
</g>
<!-- section_1&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1232.9821,-1362.2346C1455.9344,-1356.7823 2205.5113,-1337.455 2824.44,-1309.8018 2899.4264,-1306.4515 2984.3294,-1301.5725 3047.3835,-1297.7391"/>
<polygon fill="#000000" stroke="#000000" points="3047.9375,-1301.2119 3057.7056,-1297.109 3047.5109,-1294.2249 3047.9375,-1301.2119"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="67.44,-708.9009 13.44,-708.9009 13.44,-672.9009 67.44,-672.9009 67.44,-708.9009"/>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M202.5017,-1286.1925C163.3168,-1277.1538 91.9405,-1258.2941 76.44,-1237.8018 -45.6021,-1076.4561 10.237,-805.8928 32.6732,-718.8063"/>
<polygon fill="#000000" stroke="#000000" points="36.0631,-719.6772 35.2295,-709.1152 29.2946,-717.8917 36.0631,-719.6772"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="139.44,-708.9009 85.44,-708.9009 85.44,-672.9009 139.44,-672.9009 139.44,-708.9009"/>
</g>
<!-- block_3&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_3&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M350.3867,-1285.1707C283.6687,-1274.4777 161.5677,-1253.0813 148.44,-1237.8018 81.0572,-1159.3739 102.1379,-819.9489 110.0438,-719.1976"/>
<polygon fill="#000000" stroke="#000000" points="113.5381,-719.4074 110.8506,-709.1591 106.5606,-718.8466 113.5381,-719.4074"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="313.44,-708.9009 157.44,-708.9009 157.44,-672.9009 313.44,-672.9009 313.44,-708.9009"/>
<text text-anchor="middle" x="235.44" y="-687.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_4&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M504.7661,-1282.2988C437.8202,-1270.7369 334.9335,-1251.1157 322.44,-1237.8018 182.0952,-1088.2409 215.239,-808.1683 230.1877,-718.9549"/>
<polygon fill="#000000" stroke="#000000" points="233.6464,-719.4941 231.9076,-709.043 226.7494,-718.2973 233.6464,-719.4941"/>
</g>
<!-- hashline_16 -->
<g id="node17" class="node">
<title>hashline_16</title>
<ellipse fill="none" stroke="#000000" cx="374.44" cy="-690.9009" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="374.44" y="-686.7009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_5&#45;&gt;hashline_16 -->
<g id="edge16" class="edge">
<title>structure_5&#45;&gt;hashline_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M674.1975,-1281.9067C663.0592,-1279.1057 650.7906,-1276.1761 639.44,-1273.8018 592.4524,-1263.973 459.1295,-1272.9563 426.44,-1237.8018 287.7317,-1088.6338 344.2679,-807.7235 366.8202,-718.7005"/>
<polygon fill="#000000" stroke="#000000" points="370.2608,-719.3757 369.3866,-708.817 363.4855,-717.6163 370.2608,-719.3757"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="885.44,-708.9009 435.44,-708.9009 435.44,-672.9009 885.44,-672.9009 885.44,-708.9009"/>
<text text-anchor="middle" x="660.44" y="-687.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
</g>
<!-- block_6&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_6&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M833.1129,-1273.818C807.8068,-1188.3885 699.6818,-823.3751 668.7416,-718.9256"/>
<polygon fill="#000000" stroke="#000000" points="672.0295,-717.7021 665.8334,-709.108 665.3178,-719.6903 672.0295,-717.7021"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1430.94,-1114.1023 903.94,-1114.1023 903.94,-267.6995 1430.94,-267.6995 1430.94,-1114.1023"/>
<text text-anchor="middle" x="1167.44" y="-1098.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="1167.44" y="-1067.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="1167.44" y="-1052.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="1167.44" y="-1020.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="1167.44" y="-1005.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="1167.44" y="-973.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1167.44" y="-942.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="1167.44" y="-911.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1167.44" y="-895.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1167.44" y="-864.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="1167.44" y="-848.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="1167.44" y="-817.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="1167.44" y="-802.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="1167.44" y="-786.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="1167.44" y="-771.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="1167.44" y="-755.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="1167.44" y="-740.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1167.44" y="-725.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1167.44" y="-709.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1167.44" y="-694.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1167.44" y="-662.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="1167.44" y="-647.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="1167.44" y="-632.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="1167.44" y="-616.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="1167.44" y="-601.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1167.44" y="-585.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="1167.44" y="-570.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1167.44" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="1167.44" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="1167.44" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="1167.44" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="1167.44" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1167.44" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="1167.44" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1167.44" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="1167.44" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="1167.44" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="1167.44" y="-369.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="1167.44" y="-353.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="1167.44" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="1167.44" y="-322.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1167.44" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="1167.44" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1167.44,-1273.4899C1167.44,-1246.1284 1167.44,-1190.6286 1167.44,-1124.3006"/>
<polygon fill="#000000" stroke="#000000" points="1170.9401,-1124.0026 1167.44,-1114.0026 1163.9401,-1124.0026 1170.9401,-1124.0026"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1857.44,-710.2015 1449.44,-710.2015 1449.44,-671.6003 1857.44,-671.6003 1857.44,-710.2015"/>
<text text-anchor="middle" x="1653.44" y="-695.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="1653.44" y="-679.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
</g>
<!-- block_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1490.4679,-1273.818C1514.2708,-1188.6801 1615.7069,-825.8643 1645.3032,-720.0046"/>
<polygon fill="#000000" stroke="#000000" points="1648.6935,-720.8769 1648.0154,-710.3038 1641.952,-718.9921 1648.6935,-720.8769"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2276.94,-710.2015 1875.94,-710.2015 1875.94,-671.6003 2276.94,-671.6003 2276.94,-710.2015"/>
<text text-anchor="middle" x="2076.44" y="-695.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="2076.44" y="-679.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
</g>
<!-- block_9&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_9&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1852.4593,-1273.8092C1856.549,-1263.3117 1861.799,-1249.8117 1866.44,-1237.8018 1942.9071,-1039.9227 2034.1751,-801.4392 2065.3638,-719.8766"/>
<polygon fill="#000000" stroke="#000000" points="2068.7278,-720.8785 2069.0301,-710.288 2062.1894,-718.3785 2068.7278,-720.8785"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2885.44,-1237.7027 2295.44,-1237.7027 2295.44,-144.0991 2885.44,-144.0991 2885.44,-1237.7027"/>
<text text-anchor="middle" x="2590.44" y="-1222.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="2590.44" y="-1207.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="2590.44" y="-1175.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="2590.44" y="-1160.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isnode or ast.isNode then</text>
<text text-anchor="middle" x="2590.44" y="-1145.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="2590.44" y="-1129.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="2590.44" y="-1114.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="2590.44" y="-1098.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="2590.44" y="-1067.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="2590.44" y="-1052.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="2590.44" y="-1036.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="2590.44" y="-1021.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-1005.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2590.44" y="-990.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="2590.44" y="-975.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-943.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="2590.44" y="-928.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2590.44" y="-912.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="2590.44" y="-897.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="2590.44" y="-882.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="2590.44" y="-866.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="2590.44" y="-851.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-835.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-788.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="2590.44" y="-757.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2590.44" y="-741.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-726.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-710.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-679.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="2590.44" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="2590.44" y="-648.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-633.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2590.44" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-539.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="2590.44" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2590.44" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isnode or v.isNode then</text>
<text text-anchor="middle" x="2590.44" y="-493.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="2590.44" y="-478.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-462.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-431.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of Node (aka span)</text>
<text text-anchor="middle" x="2590.44" y="-415.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local leaf_val = &quot;&quot;</text>
<text text-anchor="middle" x="2590.44" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.val then</text>
<text text-anchor="middle" x="2590.44" y="-369.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast.val</text>
<text text-anchor="middle" x="2590.44" y="-353.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif ast.toValue then</text>
<text text-anchor="middle" x="2590.44" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;leaf_val = ast:toValue()</text>
<text text-anchor="middle" x="2590.44" y="-322.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast[1] then</text>
<text text-anchor="middle" x="2590.44" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="2590.44" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(leaf_val, leaf_count)</text>
<text text-anchor="middle" x="2590.44" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="2590.44" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="2590.44" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2590.44" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="2590.44" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_10&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2304.2688,-1273.818C2307.7863,-1266.653 2312.2694,-1257.5213 2317.5614,-1246.7415"/>
<polygon fill="#000000" stroke="#000000" points="2320.7109,-1248.2682 2321.9761,-1237.7492 2314.4273,-1245.1834 2320.7109,-1248.2682"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3171.44,-708.9009 2903.44,-708.9009 2903.44,-672.9009 3171.44,-672.9009 3171.44,-708.9009"/>
<text text-anchor="middle" x="3037.44" y="-687.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
</g>
<!-- block_11&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_11&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2807.5208,-1283.2452C2837.3846,-1275.9531 2872.1025,-1262.5114 2894.44,-1237.8018 3034.5372,-1082.8273 3040.5207,-807.4351 3038.5604,-719.0424"/>
<polygon fill="#000000" stroke="#000000" points="3042.0574,-718.8799 3038.2828,-708.9803 3035.06,-719.073 3042.0574,-718.8799"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3534.94,-749.401 3189.94,-749.401 3189.94,-632.4007 3534.94,-632.4007 3534.94,-749.401"/>
<text text-anchor="middle" x="3362.44" y="-734.201" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3362.44" y="-718.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3362.44" y="-687.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3362.44" y="-672.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3362.44" y="-640.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_12&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3156.6395,-1273.7164C3164.5482,-1263.633 3173.9027,-1250.5648 3180.44,-1237.8018 3263.8564,-1074.9472 3320.9616,-865.7209 3346.7852,-759.4501"/>
<polygon fill="#000000" stroke="#000000" points="3350.2446,-760.0341 3349.1864,-749.4923 3343.4396,-758.3932 3350.2446,-760.0341"/>
</g>
<!-- hashtag_17 -->
<g id="node18" class="node">
<title>hashtag_17</title>
<ellipse fill="none" stroke="#000000" cx="374.44" cy="-90" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="374.44" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_16&#45;&gt;hashtag_17 -->
<g id="edge17" class="edge">
<title>hashline_16&#45;&gt;hashtag_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M374.44,-672.589C374.44,-586.6282 374.44,-222.9414 374.44,-118.2833"/>
<polygon fill="#000000" stroke="#000000" points="377.9401,-118.1689 374.44,-108.169 370.9401,-118.169 377.9401,-118.1689"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="401.44,-36 347.44,-36 347.44,0 401.44,0 401.44,-36"/>
</g>
<!-- hashtag_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>hashtag_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M374.44,-71.8314C374.44,-64.131 374.44,-54.9743 374.44,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="377.9401,-46.4132 374.44,-36.4133 370.9401,-46.4133 377.9401,-46.4132"/>
</g>
</g>
</svg>