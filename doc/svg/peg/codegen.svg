<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1963pt" height="1182pt"
 viewBox="0.00 0.00 1963.00 1181.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1177.6014)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1177.6014 1959,-1177.6014 1959,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="586" cy="-1155.6014" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="586" y="-1151.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 117</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="586" cy="-1083.6014" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="586" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;117</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M586,-1137.4327C586,-1129.7323 586,-1120.5757 586,-1112.018"/>
<polygon fill="#000000" stroke="#000000" points="589.5001,-1112.0146 586,-1102.0146 582.5001,-1112.0147 589.5001,-1112.0146"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="82" cy="-1011.6014" rx="27" ry="18"/>
<text text-anchor="middle" x="82" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M522.7425,-1079.2038C436.297,-1072.4437 276.7218,-1057.2819 143,-1029.6014 134.0442,-1027.7475 124.498,-1025.209 115.681,-1022.6229"/>
<polygon fill="#000000" stroke="#000000" points="116.6919,-1019.2721 106.1064,-1019.7169 114.6588,-1025.9704 116.6919,-1019.2721"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="198" cy="-1011.6014" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="198" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M527.6898,-1075.5084C463.1214,-1066.1488 356.107,-1049.455 265,-1029.6014 258.6672,-1028.2214 252.0363,-1026.6262 245.5125,-1024.9672"/>
<polygon fill="#000000" stroke="#000000" points="245.9669,-1021.4686 235.4071,-1022.3296 244.199,-1028.2417 245.9669,-1021.4686"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="342" cy="-1011.6014" rx="67.748" ry="18"/>
<text text-anchor="middle" x="342" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M541.2466,-1070.3955C500.658,-1058.4185 440.691,-1040.7233 397.1539,-1027.8763"/>
<polygon fill="#000000" stroke="#000000" points="397.8777,-1024.4407 387.2959,-1024.9674 395.8965,-1031.1545 397.8777,-1024.4407"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="511" cy="-1011.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="511" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M567.8446,-1066.1722C558.517,-1057.2177 546.9906,-1046.1524 536.7606,-1036.3315"/>
<polygon fill="#000000" stroke="#000000" points="538.8859,-1033.5201 529.2482,-1029.1196 534.0382,-1038.5698 538.8859,-1033.5201"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="757" cy="-1011.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="757" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 26&#45;29</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M621.8472,-1068.5078C648.5957,-1057.2453 685.2662,-1041.8051 713.6614,-1029.8492"/>
<polygon fill="#000000" stroke="#000000" points="715.0893,-1033.0456 722.9475,-1025.9393 712.3729,-1026.5942 715.0893,-1033.0456"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1088" cy="-1011.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1088" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 30&#45;59</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M644.0762,-1075.2717C734.9016,-1062.245 910.5935,-1037.0461 1011.5807,-1022.5619"/>
<polygon fill="#000000" stroke="#000000" points="1012.3129,-1025.9928 1021.7146,-1021.1084 1011.319,-1019.0637 1012.3129,-1025.9928"/>
</g>
<!-- structure_8 -->
<g id="node9" class="node">
<title>structure_8</title>
<ellipse fill="none" stroke="#000000" cx="1398" cy="-1011.6014" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="1398" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;structure_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M648.0328,-1078.1009C801.9296,-1064.4549 1199.2617,-1029.2235 1344.1288,-1016.3781"/>
<polygon fill="#000000" stroke="#000000" points="1344.8708,-1019.8262 1354.5226,-1015.4565 1344.2525,-1012.8535 1344.8708,-1019.8262"/>
</g>
<!-- codeblock_9 -->
<g id="node10" class="node">
<title>codeblock_9</title>
<ellipse fill="none" stroke="#000000" cx="1681" cy="-1011.6014" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1681" y="-1007.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 64&#45;117</text>
</g>
<!-- section_1&#45;&gt;codeblock_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;codeblock_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M649.8518,-1079.9742C793.3003,-1071.7477 1152.0304,-1050.7416 1452,-1029.6014 1499.0483,-1026.2857 1551.5011,-1022.1918 1594.3231,-1018.7465"/>
<polygon fill="#000000" stroke="#000000" points="1594.7426,-1022.2241 1604.4287,-1017.9311 1594.1795,-1015.2468 1594.7426,-1022.2241"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-568.8007 0,-568.8007 0,-532.8007 54,-532.8007 54,-568.8007"/>
</g>
<!-- header_2&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>header_2&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M74.5196,-993.926C70.4428,-983.5342 65.6928,-970.0342 63,-957.6014 32.7179,-817.7877 27.807,-645.664 27.0853,-579.0114"/>
<polygon fill="#000000" stroke="#000000" points="30.5842,-578.8543 27.0001,-568.8842 23.5845,-578.9133 30.5842,-578.8543"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="126,-568.8007 72,-568.8007 72,-532.8007 126,-532.8007 126,-568.8007"/>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M172.1864,-996.4546C158.6961,-987.0747 143.3047,-973.7411 135,-957.6014 69.1046,-829.5367 85.1172,-648.5766 94.541,-579.2972"/>
<polygon fill="#000000" stroke="#000000" points="98.0394,-579.5558 95.9834,-569.1624 91.1092,-578.5695 98.0394,-579.5558"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="286,-568.8007 144,-568.8007 144,-532.8007 286,-532.8007 286,-568.8007"/>
<text text-anchor="middle" x="215" y="-547.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_4&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M322.3282,-993.8986C312.6529,-984.1228 301.6661,-971.2204 295,-957.6014 230.721,-826.2783 218.0814,-647.2308 215.6022,-578.8803"/>
<polygon fill="#000000" stroke="#000000" points="219.1006,-578.7692 215.2852,-568.8852 212.1041,-578.9912 219.1006,-578.7692"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="621.5,-625.3008 304.5,-625.3008 304.5,-476.3005 621.5,-476.3005 621.5,-625.3008"/>
<text text-anchor="middle" x="463" y="-610.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="463" y="-578.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="463" y="-531.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="463" y="-515.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="463" y="-484.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M509.1183,-993.5374C503.0085,-934.8831 483.452,-747.1401 471.86,-635.8567"/>
<polygon fill="#000000" stroke="#000000" points="475.3156,-635.2477 470.7983,-625.6641 468.3532,-635.973 475.3156,-635.2477"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="970.5,-578.0012 639.5,-578.0012 639.5,-523.6002 970.5,-523.6002 970.5,-578.0012"/>
<text text-anchor="middle" x="805" y="-562.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="805" y="-547.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="805" y="-531.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
</g>
<!-- block_6&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_6&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M758.8817,-993.5374C765.9915,-925.2827 791.3102,-682.2229 801.0981,-588.2592"/>
<polygon fill="#000000" stroke="#000000" points="804.6036,-588.387 802.1586,-578.0781 797.6413,-587.6617 804.6036,-588.387"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1453,-771.4016 989,-771.4016 989,-330.1998 1453,-330.1998 1453,-771.4016"/>
<text text-anchor="middle" x="1221" y="-756.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="1221" y="-741.001" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="1221" y="-709.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1221" y="-694.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="1221" y="-678.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="1221" y="-663.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1221" y="-648.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="1221" y="-632.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="1221" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="1221" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1221" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1221" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="1221" y="-555.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="1221" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="1221" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="1221" y="-493.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="1221" y="-478.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="1221" y="-462.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="1221" y="-447.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="1221" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="1221" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="1221" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="1221" y="-369.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="1221" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1093.2138,-993.5374C1103.8377,-956.7291 1129.1346,-869.0837 1154.4426,-781.3999"/>
<polygon fill="#000000" stroke="#000000" points="1157.8777,-782.1197 1157.2881,-771.5413 1151.1522,-780.1785 1157.8777,-782.1197"/>
</g>
<!-- handleline_16 -->
<g id="node17" class="node">
<title>handleline_16</title>
<ellipse fill="none" stroke="#000000" cx="1521" cy="-550.8007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="1521" y="-546.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_8&#45;&gt;handleline_16 -->
<g id="edge16" class="edge">
<title>structure_8&#45;&gt;handleline_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1423.5461,-996.5803C1437.2144,-987.1579 1453.0354,-973.7419 1462,-957.6014 1532.5508,-830.5762 1528.1992,-648.2787 1523.4629,-578.9817"/>
<polygon fill="#000000" stroke="#000000" points="1526.942,-578.5692 1522.7109,-568.8559 1519.9613,-579.0877 1526.942,-578.5692"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1955,-957.4022 1589,-957.4022 1589,-144.1992 1955,-144.1992 1955,-957.4022"/>
<text text-anchor="middle" x="1772" y="-942.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="1772" y="-927.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="1772" y="-911.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="1772" y="-896.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1772" y="-864.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="1772" y="-849.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1772" y="-834.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="1772" y="-818.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-803.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1772" y="-771.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="1772" y="-740.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="1772" y="-725.001" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1772" y="-693.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="1772" y="-678.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="1772" y="-662.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1772" y="-647.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="1772" y="-632.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="1772" y="-616.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1772" y="-601.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1772" y="-585.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="1772" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="1772" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="1772" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="1772" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="1772" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1772" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1772" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="1772" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="1772" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-353.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="1772" y="-337.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="1772" y="-322.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="1772" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="1772" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="1772" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="1772" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="1772" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="1772" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1772" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-183.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="1772" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="1772" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
</g>
<!-- codeblock_9&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_9&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1684.5673,-993.5374C1685.951,-986.5306 1687.6986,-977.6815 1689.7407,-967.3406"/>
<polygon fill="#000000" stroke="#000000" points="1693.1932,-967.9232 1691.697,-957.4345 1686.3258,-966.5669 1693.1932,-967.9232"/>
</g>
<!-- handle_17 -->
<g id="node18" class="node">
<title>handle_17</title>
<ellipse fill="none" stroke="#000000" cx="1521" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="1521" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_16&#45;&gt;handle_17 -->
<g id="edge17" class="edge">
<title>handleline_16&#45;&gt;handle_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1521,-532.7368C1521,-462.126 1521,-204.4338 1521,-118.2743"/>
<polygon fill="#000000" stroke="#000000" points="1524.5001,-118.1886 1521,-108.1886 1517.5001,-118.1887 1524.5001,-118.1886"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1548,-36 1494,-36 1494,0 1548,0 1548,-36"/>
</g>
<!-- handle_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>handle_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1521,-71.8314C1521,-64.131 1521,-54.9743 1521,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="1524.5001,-46.4132 1521,-36.4133 1517.5001,-46.4133 1524.5001,-46.4132"/>
</g>
</g>
</svg>