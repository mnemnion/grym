<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2044pt" height="1367pt"
 viewBox="0.00 0.00 2044.00 1366.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1362.6015)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1362.6015 2040,-1362.6015 2040,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="804" cy="-1340.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="804" y="-1336.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">17 &#160;</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="804" cy="-1268.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="804" y="-1264.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">17 &#160;</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M804,-1322.4329C804,-1314.7325 804,-1305.5759 804,-1297.0182"/>
<polygon fill="#000000" stroke="#000000" points="807.5001,-1297.0148 804,-1287.0148 800.5001,-1297.0148 807.5001,-1297.0148"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="377" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="377" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">: &#160;&#160;</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M776.7969,-1267.8753C712.2256,-1265.5053 545.2224,-1255.567 413,-1214.6015 411.0977,-1214.0122 409.1728,-1213.3309 407.2539,-1212.5856"/>
<polygon fill="#000000" stroke="#000000" points="408.405,-1209.2686 397.8416,-1208.4532 405.591,-1215.678 408.405,-1209.2686"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="449" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="449" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;1 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M776.8907,-1266.7255C721.0481,-1262.2765 589.6531,-1248.7801 485,-1214.6015 483.1069,-1213.9833 481.1891,-1213.2796 479.2757,-1212.5171"/>
<polygon fill="#000000" stroke="#000000" points="480.4375,-1209.2034 469.878,-1208.3389 477.5936,-1215.5997 480.4375,-1209.2034"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="521" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="521" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">13 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M778.3865,-1262.085C727.5583,-1249.1535 613.8795,-1220.2317 556.1243,-1205.5378"/>
<polygon fill="#000000" stroke="#000000" points="556.906,-1202.1252 546.3517,-1203.0514 555.18,-1208.9091 556.906,-1202.1252"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="733" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="733" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">25 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M788.9427,-1253.3322C779.153,-1243.4045 766.2169,-1230.2862 755.2503,-1219.1652"/>
<polygon fill="#000000" stroke="#000000" points="757.5492,-1216.5117 748.0356,-1211.8489 752.5649,-1221.4268 757.5492,-1216.5117"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="875" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="875" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">29 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M819.0573,-1253.3322C828.847,-1243.4045 841.7831,-1230.2862 852.7497,-1219.1652"/>
<polygon fill="#000000" stroke="#000000" points="855.4351,-1221.4268 859.9644,-1211.8489 850.4508,-1216.5117 855.4351,-1221.4268"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1155" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="1155" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">60 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M829.8099,-1263.3072C891.6778,-1250.6163 1048.542,-1218.4391 1119.351,-1203.9141"/>
<polygon fill="#000000" stroke="#000000" points="1120.0596,-1207.3418 1129.1523,-1201.9036 1118.6529,-1200.4845 1120.0596,-1207.3418"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1299" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="1299" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">63 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M830.7793,-1265.1136C893.7058,-1256.8633 1055.8795,-1235.2849 1191,-1214.6015 1214.9504,-1210.9354 1241.8252,-1206.4576 1262.7746,-1202.8853"/>
<polygon fill="#000000" stroke="#000000" points="1263.5773,-1206.2989 1272.8428,-1201.1605 1262.3953,-1199.3994 1263.5773,-1206.2989"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1853" cy="-1196.6015" rx="27" ry="18"/>
<text text-anchor="middle" x="1853" y="-1192.4015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">17 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M830.9846,-1266.7494C974.5477,-1256.8957 1648.3913,-1210.6452 1815.4521,-1199.1787"/>
<polygon fill="#000000" stroke="#000000" points="1815.9754,-1202.6511 1825.7122,-1198.4745 1815.496,-1195.6675 1815.9754,-1202.6511"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1086.1015 0,-1086.1015 0,-1050.1015 54,-1050.1015 54,-1086.1015"/>
</g>
<!-- block_3&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_3&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M428.5801,-1184.8043C423.6199,-1182.3896 418.2335,-1180.1239 413,-1178.6015 337.9236,-1156.7631 127.0159,-1187.4941 63,-1142.6015 47.4164,-1131.6732 38.3203,-1112.0998 33.1708,-1095.7579"/>
<polygon fill="#000000" stroke="#000000" points="36.5324,-1094.7827 30.4518,-1086.1065 29.7947,-1096.6809 36.5324,-1094.7827"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-1068.1015" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-1063.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;4 &#160;</text>
</g>
<!-- block_4&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>block_4&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M500.5801,-1184.8043C495.6199,-1182.3896 490.2335,-1180.1239 485,-1178.6015 409.9236,-1156.7631 199.0159,-1187.4941 135,-1142.6015 119.4164,-1131.6732 110.3203,-1112.0998 105.1708,-1095.7579"/>
<polygon fill="#000000" stroke="#000000" points="108.5324,-1094.7827 102.4518,-1086.1065 101.7947,-1096.6809 108.5324,-1094.7827"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="615.5,-1142.6016 144.5,-1142.6016 144.5,-993.6013 615.5,-993.6013 615.5,-1142.6016"/>
<text text-anchor="middle" x="380" y="-1095.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Parsing Engine</text>
<text text-anchor="middle" x="380" y="-1080.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Use (mock):</text>
<text text-anchor="middle" x="380" y="-1064.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="380" y="-1049.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;function (works) return if works and true or false end end</text>
<text text-anchor="middle" x="380" y="-1033.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M504.8255,-1181.8609C495.5484,-1173.4063 483.0868,-1162.0494 469.6181,-1149.7748"/>
<polygon fill="#000000" stroke="#000000" points="471.7945,-1147.0227 462.0458,-1142.8737 467.0793,-1152.1965 471.7945,-1147.0227"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="661" cy="-1068.1015" rx="27" ry="18"/>
<text text-anchor="middle" x="661" y="-1063.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">24 &#160;</text>
</g>
<!-- block_5&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M721.0366,-1179.9563C713.7187,-1169.4688 704.378,-1155.5154 697,-1142.6015 688.1993,-1127.1976 679.5116,-1109.3176 672.8761,-1094.9355"/>
<polygon fill="#000000" stroke="#000000" points="675.9608,-1093.2638 668.6339,-1085.6109 669.5892,-1096.1626 675.9608,-1093.2638"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="760,-1086.1015 706,-1086.1015 706,-1050.1015 760,-1050.1015 760,-1086.1015"/>
</g>
<!-- block_5&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_5&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M733,-1178.4631C733,-1157.1297 733,-1121.461 733,-1096.4632"/>
<polygon fill="#000000" stroke="#000000" points="736.5001,-1096.1475 733,-1086.1476 729.5001,-1096.1476 736.5001,-1096.1475"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1109.5,-1103.3018 778.5,-1103.3018 778.5,-1032.9011 1109.5,-1032.9011 1109.5,-1103.3018"/>
<text text-anchor="middle" x="944" y="-1088.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="944" y="-1072.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="944" y="-1057.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
</g>
<!-- block_6&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_6&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M884.1627,-1179.5377C893.3214,-1162.4813 907.7895,-1135.537 920.2048,-1112.4158"/>
<polygon fill="#000000" stroke="#000000" points="923.3759,-1113.9085 925.0231,-1103.4424 917.2087,-1110.5969 923.3759,-1113.9085"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="1155" cy="-1068.1015" rx="27" ry="18"/>
<text text-anchor="middle" x="1155" y="-1063.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">59 &#160;</text>
</g>
<!-- block_7&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>block_7&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1155,-1178.4631C1155,-1157.1297 1155,-1121.461 1155,-1096.4632"/>
<polygon fill="#000000" stroke="#000000" points="1158.5001,-1096.1475 1155,-1086.1476 1151.5001,-1096.1476 1158.5001,-1096.1475"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1254,-1086.1015 1200,-1086.1015 1200,-1050.1015 1254,-1050.1015 1254,-1086.1015"/>
</g>
<!-- block_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1166.9634,-1179.9563C1174.2813,-1169.4688 1183.622,-1155.5154 1191,-1142.6015 1199.6849,-1127.4003 1208.2597,-1109.7877 1214.8609,-1095.505"/>
<polygon fill="#000000" stroke="#000000" points="1218.1304,-1096.7706 1219.0928,-1086.2196 1211.7608,-1093.8676 1218.1304,-1096.7706"/>
</g>
<!-- structure_21 -->
<g id="node22" class="node">
<title>structure_21</title>
<ellipse fill="none" stroke="#000000" cx="1299" cy="-1068.1015" rx="27" ry="18"/>
<text text-anchor="middle" x="1299" y="-1063.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">re &#160;</text>
</g>
<!-- block_8&#45;&gt;structure_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;structure_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1299,-1178.4631C1299,-1157.1297 1299,-1121.461 1299,-1096.4632"/>
<polygon fill="#000000" stroke="#000000" points="1302.5001,-1096.1475 1299,-1086.1476 1295.5001,-1096.1476 1302.5001,-1096.1475"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="1808,-1088.0035 1344,-1088.0035 1344,-1048.1994 1808,-1048.1994 1808,-1088.0035"/>
<text text-anchor="middle" x="1576" y="-1072.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> read from a file, or the start rule name if nothing else given.</text>
</g>
<!-- block_8&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_8&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1321.1998,-1186.303C1364.9161,-1166.0231 1463.1881,-1120.4348 1524.1114,-1092.1725"/>
<polygon fill="#000000" stroke="#000000" points="1525.5876,-1095.346 1533.1862,-1087.9627 1522.6418,-1088.996 1525.5876,-1095.346"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="1853" cy="-1068.1015" rx="27" ry="18"/>
<text text-anchor="middle" x="1853" y="-1063.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">17 &#160;</text>
</g>
<!-- block_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>block_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853,-1178.4631C1853,-1157.1297 1853,-1121.461 1853,-1096.4632"/>
<polygon fill="#000000" stroke="#000000" points="1856.5001,-1096.1475 1853,-1086.1476 1849.5001,-1096.1476 1856.5001,-1096.1475"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="1952,-1086.1015 1898,-1086.1015 1898,-1050.1015 1952,-1050.1015 1952,-1086.1015"/>
</g>
<!-- block_9&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_9&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1864.9634,-1179.9563C1872.2813,-1169.4688 1881.622,-1155.5154 1889,-1142.6015 1897.6849,-1127.4003 1906.2597,-1109.7877 1912.8609,-1095.505"/>
<polygon fill="#000000" stroke="#000000" points="1916.1304,-1096.7706 1917.0928,-1086.2196 1909.7608,-1093.8676 1916.1304,-1096.7706"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="170,-568.8007 28,-568.8007 28,-532.8007 170,-532.8007 170,-568.8007"/>
<text text-anchor="middle" x="99" y="-547.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M99,-1049.9938C99,-973.1033 99,-673.2978 99,-579.2112"/>
<polygon fill="#000000" stroke="#000000" points="102.5001,-579.0295 99,-569.0295 95.5001,-579.0296 102.5001,-579.0295"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="819.5,-625.3008 502.5,-625.3008 502.5,-476.3005 819.5,-476.3005 819.5,-625.3008"/>
<text text-anchor="middle" x="661" y="-610.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="661" y="-578.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="661" y="-531.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="661" y="-515.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="661" y="-484.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M661,-1049.9938C661,-984.9419 661,-760.3338 661,-635.7357"/>
<polygon fill="#000000" stroke="#000000" points="664.5001,-635.4703 661,-625.4703 657.5001,-635.4704 664.5001,-635.4703"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1345,-771.4016 881,-771.4016 881,-330.1998 1345,-330.1998 1345,-771.4016"/>
<text text-anchor="middle" x="1113" y="-756.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="1113" y="-741.001" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="1113" y="-709.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1113" y="-694.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="1113" y="-678.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="1113" y="-663.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1113" y="-648.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="1113" y="-632.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="1113" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="1113" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1113" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1113" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="1113" y="-555.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="1113" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="1113" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="1113" y="-493.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="1113" y="-478.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="1113" y="-462.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="1113" y="-447.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="1113" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="1113" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="1113" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="1113" y="-369.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="1113" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1153.5298,-1049.9938C1149.9853,-1006.3374 1140.6065,-890.8207 1131.7629,-781.897"/>
<polygon fill="#000000" stroke="#000000" points="1135.2342,-781.4013 1130.9364,-771.7174 1128.2572,-781.9678 1135.2342,-781.4013"/>
</g>
<!-- handleline_22 -->
<g id="node23" class="node">
<title>handleline_22</title>
<ellipse fill="none" stroke="#000000" cx="1390" cy="-550.8007" rx="27" ry="18"/>
<text text-anchor="middle" x="1390" y="-546.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">ne &#160;</text>
</g>
<!-- structure_21&#45;&gt;handleline_22 -->
<g id="edge22" class="edge">
<title>structure_21&#45;&gt;handleline_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1307.1212,-1050.8541C1314.3076,-1035.6996 1325.1527,-1013.0895 1335,-993.6014 1343.1592,-977.4541 1348.8797,-974.9533 1354,-957.6014 1394.4879,-820.3949 1393.5171,-646.7687 1391.2888,-579.3625"/>
<polygon fill="#000000" stroke="#000000" points="1394.7772,-578.9817 1390.9118,-569.1171 1387.7819,-579.2391 1394.7772,-578.9817"/>
</g>
<!-- handle_23 -->
<g id="node24" class="node">
<title>handle_23</title>
<ellipse fill="none" stroke="#000000" cx="1390" cy="-90" rx="27" ry="18"/>
<text text-anchor="middle" x="1390" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">le &#160;</text>
</g>
<!-- handleline_22&#45;&gt;handle_23 -->
<g id="edge23" class="edge">
<title>handleline_22&#45;&gt;handle_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390,-532.7368C1390,-462.126 1390,-204.4338 1390,-118.2743"/>
<polygon fill="#000000" stroke="#000000" points="1393.5001,-118.1886 1390,-108.1886 1386.5001,-118.1887 1393.5001,-118.1886"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1417,-36 1363,-36 1363,0 1417,0 1417,-36"/>
</g>
<!-- handle_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>handle_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390,-71.8314C1390,-64.131 1390,-54.9743 1390,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="1393.5001,-46.4132 1390,-36.4133 1386.5001,-46.4133 1393.5001,-46.4132"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2036,-957.4022 1670,-957.4022 1670,-144.1992 2036,-144.1992 2036,-957.4022"/>
<text text-anchor="middle" x="1853" y="-942.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="1853" y="-927.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="1853" y="-911.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="1853" y="-896.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1853" y="-864.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="1853" y="-849.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1853" y="-834.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="1853" y="-818.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1853" y="-803.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1853" y="-771.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="1853" y="-740.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="1853" y="-725.001" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1853" y="-693.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="1853" y="-678.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="1853" y="-662.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1853" y="-647.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="1853" y="-632.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="1853" y="-616.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1853" y="-601.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1853" y="-585.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1853" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="1853" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="1853" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="1853" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="1853" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="1853" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1853" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1853" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1853" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="1853" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="1853" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1853" y="-353.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="1853" y="-337.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="1853" y="-322.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="1853" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="1853" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="1853" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="1853" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="1853" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="1853" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1853" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1853" y="-183.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="1853" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="1853" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>codeblock_26&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1853,-1049.9938C1853,-1032.4629 1853,-1003.3444 1853,-967.7183"/>
<polygon fill="#000000" stroke="#000000" points="1856.5001,-967.5015 1853,-957.5015 1849.5001,-967.5016 1856.5001,-967.5015"/>
</g>
</g>
</svg>