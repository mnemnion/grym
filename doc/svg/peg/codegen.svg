<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1686pt" height="1216pt"
 viewBox="0.00 0.00 1686.00 1215.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1211.8015)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1211.8015 1682,-1211.8015 1682,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="espalier/node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="546" cy="-1189.8015" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="546" y="-1185.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 117</text>
</g>
<!-- section_1 -->
<g id="node2" class="espalier/node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="546" cy="-1117.8015" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="546" y="-1113.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;117</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M546,-1171.6328C546,-1163.9324 546,-1154.7758 546,-1146.2181"/>
<polygon fill="#000000" stroke="#000000" points="549.5001,-1146.2147 546,-1136.2147 542.5001,-1146.2148 549.5001,-1146.2147"/>
</g>
<!-- header_2 -->
<g id="node3" class="espalier/node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="56" cy="-1045.8015" rx="27" ry="18"/>
<text text-anchor="middle" x="56" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M484.5071,-1111.8623C403.2091,-1103.5401 255.6799,-1086.8076 131,-1063.8015 117.9346,-1061.3906 103.7308,-1058.1447 91.2337,-1055.0731"/>
<polygon fill="#000000" stroke="#000000" points="91.751,-1051.5945 81.1999,-1052.5562 90.0478,-1058.3842 91.751,-1051.5945"/>
</g>
<!-- prose_3 -->
<g id="node4" class="espalier/node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="172" cy="-1045.8015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="172" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M487.413,-1109.8934C424.02,-1100.8338 320.1734,-1084.5288 232,-1063.8015 224.7216,-1062.0905 217.0252,-1060.0003 209.6603,-1057.858"/>
<polygon fill="#000000" stroke="#000000" points="210.4766,-1054.449 199.893,-1054.9351 208.4697,-1061.1552 210.4766,-1054.449"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="espalier/node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="309" cy="-1045.8015" rx="67.748" ry="18"/>
<text text-anchor="middle" x="309" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M501.9775,-1104.4276C462.8159,-1092.5303 405.4042,-1075.0888 363.3832,-1062.3229"/>
<polygon fill="#000000" stroke="#000000" points="364.1765,-1058.9061 353.5909,-1059.3481 362.1417,-1065.6038 364.1765,-1058.9061"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="espalier/node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="482" cy="-1045.8015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="482" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M530.1798,-1100.0037C522.4874,-1091.3498 513.1022,-1080.7914 504.6656,-1071.3003"/>
<polygon fill="#000000" stroke="#000000" points="507.1197,-1068.7928 497.86,-1063.644 501.8878,-1073.4434 507.1197,-1068.7928"/>
</g>
<!-- prose_6 -->
<g id="node7" class="espalier/node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="648" cy="-1045.8015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="648" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M569.9145,-1100.9207C584.7199,-1090.4698 603.8155,-1076.9905 619.417,-1065.9777"/>
<polygon fill="#000000" stroke="#000000" points="621.5243,-1068.7744 627.6756,-1060.1481 617.4875,-1063.0556 621.5243,-1068.7744"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="espalier/node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="869" cy="-1045.8015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="869" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 30&#45;59</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M596.8241,-1106.4723C652.5281,-1094.0553 742.0793,-1074.0934 803.1318,-1060.4842"/>
<polygon fill="#000000" stroke="#000000" points="804.0536,-1063.8647 813.0525,-1058.2727 802.5305,-1057.0324 804.0536,-1063.8647"/>
</g>
<!-- structure_8 -->
<g id="node9" class="espalier/node">
<title>structure_8</title>
<ellipse fill="none" stroke="#000000" cx="1136" cy="-1045.8015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="1136" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;structure_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M605.5458,-1110.5349C720.9084,-1096.4567 973.1661,-1065.6727 1083.0656,-1052.2613"/>
<polygon fill="#000000" stroke="#000000" points="1083.7449,-1055.7044 1093.2473,-1051.0187 1082.8969,-1048.756 1083.7449,-1055.7044"/>
</g>
<!-- codeblock_9 -->
<g id="node10" class="espalier/node">
<title>codeblock_9</title>
<ellipse fill="none" stroke="#000000" cx="1397" cy="-1045.8015" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1397" y="-1041.6015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 64&#45;117</text>
</g>
<!-- section_1&#45;&gt;codeblock_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;codeblock_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M608.6257,-1112.6148C723.7484,-1103.0659 976.7587,-1082.013 1190,-1063.8015 1229.5884,-1060.4205 1273.4301,-1056.6167 1310.5365,-1053.3799"/>
<polygon fill="#000000" stroke="#000000" points="1311.1569,-1056.8392 1320.8147,-1052.4828 1310.5482,-1049.8657 1311.1569,-1056.8392"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="espalier/node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-603.0008 0,-603.0008 0,-567.0008 54,-567.0008 54,-603.0008"/>
<text text-anchor="middle" x="27" y="-581.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
</g>
<!-- header_2&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>header_2&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M54.8632,-1027.7375C50.4194,-957.1268 34.2018,-699.4346 28.7794,-613.2751"/>
<polygon fill="#000000" stroke="#000000" points="32.266,-612.9498 28.1447,-603.1894 25.2798,-613.3896 32.266,-612.9498"/>
</g>
<!-- raw_11 -->
<g id="node12" class="espalier/node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="99" cy="-585.0008" rx="27" ry="18"/>
<text text-anchor="middle" x="99" y="-580.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_3&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M157.5596,-1029.5403C149.4528,-1019.4153 139.9894,-1005.7074 135,-991.8015 86.5744,-856.8347 92.1938,-681.2294 96.6894,-613.4285"/>
<polygon fill="#000000" stroke="#000000" points="100.2033,-613.3558 97.4203,-603.133 93.2209,-612.8601 100.2033,-613.3558"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="espalier/node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="286,-603.0008 144,-603.0008 144,-567.0008 286,-567.0008 286,-603.0008"/>
<text text-anchor="middle" x="215" y="-581.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M303.9323,-1027.3735C301.1436,-1016.9672 297.7098,-1003.6998 295,-991.8015 262.8264,-850.5318 231.7873,-679.9095 219.9907,-613.4382"/>
<polygon fill="#000000" stroke="#000000" points="223.3908,-612.5658 218.2026,-603.3282 216.4978,-613.785 223.3908,-612.5658"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="espalier/node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="621.5,-659.5009 304.5,-659.5009 304.5,-510.5006 621.5,-510.5006 621.5,-659.5009"/>
<text text-anchor="middle" x="463" y="-644.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="463" y="-612.9008" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="463" y="-565.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="463" y="-550.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="463" y="-518.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M481.2552,-1027.7375C478.8367,-969.0832 471.0956,-781.3402 466.5071,-670.0567"/>
<polygon fill="#000000" stroke="#000000" points="469.9959,-669.7115 466.0868,-659.8642 463.0019,-670 469.9959,-669.7115"/>
</g>
<!-- raw_15 -->
<g id="node16" class="espalier/node">
<title>raw_15</title>
<ellipse fill="none" stroke="#000000" cx="667" cy="-585.0008" rx="27" ry="18"/>
<text text-anchor="middle" x="667" y="-580.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_15 -->
<g id="edge15" class="edge">
<title>prose_6&#45;&gt;raw_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M648.7448,-1027.7375C651.6563,-957.1268 662.2816,-699.4346 665.8342,-613.2751"/>
<polygon fill="#000000" stroke="#000000" points="669.335,-613.3252 666.25,-603.1894 662.3409,-613.0367 669.335,-613.3252"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="espalier/node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1176,-805.6017 712,-805.6017 712,-364.3999 1176,-364.3999 1176,-805.6017"/>
<text text-anchor="middle" x="944" y="-790.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="944" y="-775.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="944" y="-743.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="944" y="-728.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="944" y="-713.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="944" y="-697.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="944" y="-682.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="944" y="-666.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="944" y="-651.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="944" y="-636.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="944" y="-620.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="944" y="-605.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="944" y="-589.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="944" y="-558.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="944" y="-543.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="944" y="-527.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="944" y="-512.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="944" y="-496.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="944" y="-481.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="944" y="-466.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="944" y="-450.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="944" y="-435.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="944" y="-403.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="944" y="-372.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_7&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M871.9401,-1027.7375C877.9249,-990.9665 892.1673,-903.4613 906.4243,-815.8665"/>
<polygon fill="#000000" stroke="#000000" points="909.9202,-816.1738 908.0722,-805.7414 903.0111,-815.0492 909.9202,-816.1738"/>
</g>
<!-- handleline_18 -->
<g id="node19" class="espalier/node">
<title>handleline_18</title>
<ellipse fill="none" stroke="#000000" cx="1244" cy="-585.0008" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="1244" y="-580.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_8&#45;&gt;handleline_18 -->
<g id="edge18" class="edge">
<title>structure_8&#45;&gt;handleline_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1155.813,-1029.3308C1166.2228,-1019.5367 1178.1993,-1006.2298 1185,-991.8015 1246.8063,-860.6737 1247.6753,-681.5116 1245.3983,-613.1054"/>
<polygon fill="#000000" stroke="#000000" points="1248.8954,-612.9604 1245.0147,-603.1019 1241.9005,-613.2287 1248.8954,-612.9604"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="espalier/node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1678,-991.6023 1312,-991.6023 1312,-178.3993 1678,-178.3993 1678,-991.6023"/>
<text text-anchor="middle" x="1495" y="-976.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="1495" y="-961.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="1495" y="-945.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="1495" y="-930.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1495" y="-899.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="1495" y="-883.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1495" y="-868.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="1495" y="-852.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1495" y="-837.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1495" y="-806.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="1495" y="-774.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="1495" y="-759.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1495" y="-727.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="1495" y="-712.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="1495" y="-697.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1495" y="-681.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="1495" y="-666.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="1495" y="-650.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1495" y="-635.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1495" y="-620.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1495" y="-588.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="1495" y="-573.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="1495" y="-557.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="1495" y="-542.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="1495" y="-527.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="1495" y="-511.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1495" y="-496.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1495" y="-480.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1495" y="-449.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="1495" y="-434.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="1495" y="-418.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1495" y="-387.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="1495" y="-371.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="1495" y="-356.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="1495" y="-341.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="1495" y="-325.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="1495" y="-310.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="1495" y="-294.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="1495" y="-279.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="1495" y="-264.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1495" y="-248.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1495" y="-217.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="1495" y="-201.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="1495" y="-186.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
</g>
<!-- codeblock_9&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>codeblock_9&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1400.8417,-1027.7375C1402.3319,-1020.7306 1404.2139,-1011.8816 1406.4131,-1001.5407"/>
<polygon fill="#000000" stroke="#000000" points="1409.863,-1002.144 1408.5198,-991.6346 1403.0161,-1000.6878 1409.863,-1002.144"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="espalier/node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="126,-125.1 72,-125.1 72,-89.1 126,-89.1 126,-125.1"/>
</g>
<!-- raw_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M99,-566.8501C99,-494.1805 99,-223.8941 99,-135.3696"/>
<polygon fill="#000000" stroke="#000000" points="102.5001,-135.2688 99,-125.2689 95.5001,-135.2689 102.5001,-135.2688"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="espalier/node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="832.5,-142.3004 501.5,-142.3004 501.5,-71.8997 832.5,-71.8997 832.5,-142.3004"/>
<text text-anchor="middle" x="667" y="-111.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="667" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="667" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
</g>
<!-- raw_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>raw_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M667,-566.8501C667,-498.43 667,-254.8296 667,-152.6884"/>
<polygon fill="#000000" stroke="#000000" points="670.5001,-152.3897 667,-142.3898 663.5001,-152.3898 670.5001,-152.3897"/>
</g>
<!-- handle_19 -->
<g id="node20" class="espalier/node">
<title>handle_19</title>
<ellipse fill="none" stroke="#000000" cx="1244" cy="-107.1" rx="36.827" ry="18"/>
<text text-anchor="middle" x="1244" y="-102.9" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_18&#45;&gt;handle_19 -->
<g id="edge19" class="edge">
<title>handleline_18&#45;&gt;handle_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1244,-566.8501C1244,-494.1805 1244,-223.8941 1244,-135.3696"/>
<polygon fill="#000000" stroke="#000000" points="1247.5001,-135.2688 1244,-125.2689 1240.5001,-135.2689 1247.5001,-135.2688"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="espalier/node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1271,-36 1217,-36 1217,0 1271,0 1271,-36"/>
</g>
<!-- handle_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>handle_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1244,-89.0693C1244,-76.7509 1244,-60.1792 1244,-46.1369"/>
<polygon fill="#000000" stroke="#000000" points="1247.5001,-46.0039 1244,-36.0039 1240.5001,-46.0039 1247.5001,-46.0039"/>
</g>
</g>
</svg>