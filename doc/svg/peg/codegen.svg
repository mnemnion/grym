<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2550pt" height="3123pt"
 viewBox="0.00 0.00 2549.50 3123.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3119.4044)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-3119.4044 2545.5,-3119.4044 2545.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1125" cy="-3097.4044" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="1125" y="-3093.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 117</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1125" cy="-3025.4044" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="1125" y="-3021.2044" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;117</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1125,-3079.2358C1125,-3071.5354 1125,-3062.3787 1125,-3053.821"/>
<polygon fill="#000000" stroke="#000000" points="1128.5001,-3053.8176 1125,-3043.8177 1121.5001,-3053.8177 1128.5001,-3053.8176"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="419" cy="-2067.003" rx="27" ry="18"/>
<text text-anchor="middle" x="419" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1059.8753,-3024.9557C899.6625,-3023.1889 496.3462,-3014.466 455,-2971.4044 211.5084,-2717.811 366.1162,-2216.7102 408.9643,-2094.4048"/>
<polygon fill="#000000" stroke="#000000" points="412.3654,-2095.2863 412.4134,-2084.6915 405.7689,-2092.9439 412.3654,-2095.2863"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="510" cy="-2067.003" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="510" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1060.1517,-3023.7964C920.0234,-3019.6703 598.8314,-3006.4549 565,-2971.4044 441.351,-2843.2999 493.3718,-2234.5899 507.0705,-2095.3975"/>
<polygon fill="#000000" stroke="#000000" points="510.5836,-2095.4392 508.0948,-2085.1409 503.6183,-2094.7435 510.5836,-2095.4392"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="625" cy="-2067.003" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="625" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 2&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1062.0287,-3020.8454C990.2525,-3014.3543 878.9759,-2999.9297 849,-2971.4044 587.3807,-2722.445 611.7148,-2219.8531 622.2173,-2095.3778"/>
<polygon fill="#000000" stroke="#000000" points="625.7265,-2095.4278 623.1222,-2085.1581 618.7538,-2094.8104 625.7265,-2095.4278"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="914" cy="-2067.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="914" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;25</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1097.1801,-3009.0528C1083.8048,-2999.7271 1068.8022,-2986.8202 1060,-2971.4044 885.4287,-2665.6679 903.5945,-2212.4599 911.7071,-2095.4063"/>
<polygon fill="#000000" stroke="#000000" points="915.2188,-2095.3719 912.454,-2085.1442 908.2372,-2094.8637 915.2188,-2095.3719"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1125" cy="-2067.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1125" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 26&#45;29</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1125,-3007.1149C1125,-2889.4559 1125,-2239.4417 1125,-2095.3126"/>
<polygon fill="#000000" stroke="#000000" points="1128.5001,-2095.0964 1125,-2085.0964 1121.5001,-2095.0965 1128.5001,-2095.0964"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1386" cy="-2067.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1386" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 30&#45;60</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1152.4794,-3008.8523C1165.7647,-2999.4736 1180.7896,-2986.5799 1190,-2971.4044 1374.5177,-2667.3836 1386.4813,-2212.9242 1386.3405,-2095.5006"/>
<polygon fill="#000000" stroke="#000000" points="1389.8392,-2095.1897 1386.2945,-2085.2055 1382.8393,-2095.2211 1389.8392,-2095.1897"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1598" cy="-2067.003" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1598" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 61&#45;63</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1189.8082,-3023.3715C1274.2368,-3019.307 1415.3057,-3007.2069 1451,-2971.4044 1701.751,-2719.8939 1626.9402,-2219.2006 1603.7052,-2095.2527"/>
<polygon fill="#000000" stroke="#000000" points="1607.0745,-2094.2381 1601.7527,-2085.0767 1600.1999,-2095.5571 1607.0745,-2094.2381"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1978" cy="-2067.003" rx="60.1864" ry="18"/>
<text text-anchor="middle" x="1978" y="-2062.803" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 64&#45;117</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1189.4606,-3022.7876C1324.2524,-3016.7677 1626.4931,-3000.1989 1663,-2971.4044 1955.3851,-2740.7881 1977.2718,-2221.4399 1978.1718,-2095.0996"/>
<polygon fill="#000000" stroke="#000000" points="1981.6717,-2095.0821 1978.2031,-2085.0711 1974.6718,-2095.0601 1981.6717,-2095.0821"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2541.5,-2971.3058 2056.5,-2971.3058 2056.5,-1162.7001 2541.5,-1162.7001 2541.5,-2971.3058"/>
<text text-anchor="middle" x="2299" y="-2956.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2299" y="-2940.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
<text text-anchor="middle" x="2299" y="-2925.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2299" y="-2878.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> Parsing Engine</text>
<text text-anchor="middle" x="2299" y="-2862.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> Use (mock):</text>
<text text-anchor="middle" x="2299" y="-2847.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="2299" y="-2831.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;function (works) return if works and true or false end end</text>
<text text-anchor="middle" x="2299" y="-2816.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="2299" y="-2769.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2299" y="-2753.6041" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="2299" y="-2722.2041" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="2299" y="-2674.8041" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="2299" y="-2659.404" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="2299" y="-2628.004" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
<text text-anchor="middle" x="2299" y="-2612.604" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2299" y="-2581.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="2299" y="-2565.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="2299" y="-2550.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
<text text-anchor="middle" x="2299" y="-2519.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2299" y="-2503.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="2299" y="-2488.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="2299" y="-2456.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="2299" y="-2441.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="2299" y="-2426.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="2299" y="-2410.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="2299" y="-2395.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="2299" y="-2379.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="2299" y="-2364.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="2299" y="-2349.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="2299" y="-2333.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="2299" y="-2318.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="2299" y="-2302.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="2299" y="-2271.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="2299" y="-2256.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="2299" y="-2240.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="2299" y="-2225.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="2299" y="-2209.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="2299" y="-2194.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="2299" y="-2179.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="2299" y="-2163.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="2299" y="-2148.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="2299" y="-2116.8031" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="2299" y="-2085.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2299" y="-2070.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2299" y="-2038.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> @todo change to use a provided name, or default to the filename if</text>
<text text-anchor="middle" x="2299" y="-2023.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> read from a file, or the start rule name if nothing else given.</text>
<text text-anchor="middle" x="2299" y="-1991.803" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2299" y="-1976.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="2299" y="-1961.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="2299" y="-1945.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="2299" y="-1930.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2299" y="-1898.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="2299" y="-1883.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2299" y="-1868.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="2299" y="-1852.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2299" y="-1837.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2299" y="-1805.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="2299" y="-1774.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="2299" y="-1759.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2299" y="-1727.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="2299" y="-1712.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="2299" y="-1696.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2299" y="-1681.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="2299" y="-1666.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="2299" y="-1650.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2299" y="-1635.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2299" y="-1619.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2299" y="-1588.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="2299" y="-1573.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="2299" y="-1557.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="2299" y="-1542.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="2299" y="-1526.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="2299" y="-1511.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2299" y="-1496.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2299" y="-1480.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2299" y="-1449.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="2299" y="-1433.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="2299" y="-1418.402" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2299" y="-1387.002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="2299" y="-1371.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="2299" y="-1356.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="2299" y="-1340.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="2299" y="-1325.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="2299" y="-1310.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="2299" y="-1294.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="2299" y="-1279.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="2299" y="-1263.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2299" y="-1248.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2299" y="-1217.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="2299" y="-1201.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="2299" y="-1186.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
<text text-anchor="middle" x="2299" y="-1170.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_1&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>section_1&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1190.043,-3023.6551C1394.6626,-3017.8835 2013.6934,-2998.2708 2047,-2971.4044 2047.4956,-2971.0047 2047.9902,-2970.604 2048.4839,-2970.2025"/>
<polygon fill="#000000" stroke="#000000" points="2050.9486,-2972.7051 2056.4017,-2963.6214 2046.4741,-2967.3219 2050.9486,-2972.7051"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1078.1015 0,-1078.1015 0,-1042.1015 54,-1042.1015 54,-1078.1015"/>
</g>
<!-- block_3&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_3&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M511.9127,-2048.8578C523.7367,-1932.6846 582.2966,-1293.8859 455,-1162.6015 394.1051,-1099.799 136.0229,-1174.7679 63,-1126.6015 49.5076,-1117.7018 40.6664,-1101.9815 35.1234,-1088.0594"/>
<polygon fill="#000000" stroke="#000000" points="38.3175,-1086.5974 31.6507,-1078.363 31.7274,-1088.9576 38.3175,-1086.5974"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="140" cy="-1060.1015" rx="67.748" ry="18"/>
<text text-anchor="middle" x="140" y="-1055.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- block_4&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>block_4&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M631.0424,-2048.9741C664.4568,-1945.5502 816.2021,-1423.1552 565,-1162.6015 510.8854,-1106.4724 287.48,-1157.7378 216,-1126.6015 194.7841,-1117.36 175.2421,-1099.97 161.2879,-1085.2909"/>
<polygon fill="#000000" stroke="#000000" points="163.8618,-1082.9191 154.5209,-1077.9193 158.7051,-1087.6529 163.8618,-1082.9191"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="696.5,-1126.6016 225.5,-1126.6016 225.5,-993.6013 696.5,-993.6013 696.5,-1126.6016"/>
<text text-anchor="middle" x="461" y="-1079.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Parsing Engine</text>
<text text-anchor="middle" x="461" y="-1064.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Use (mock):</text>
<text text-anchor="middle" x="461" y="-1048.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="461" y="-1033.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;function (works) return if works and true or false end end</text>
<text text-anchor="middle" x="461" y="-1017.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_4&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M628.3095,-2048.9375C645.1192,-1952.3551 714.5501,-1489.1589 565,-1162.6015 560.5147,-1152.8075 554.6532,-1143.4409 547.9957,-1134.6295"/>
<polygon fill="#000000" stroke="#000000" points="550.6439,-1132.3366 541.6746,-1126.6972 545.1695,-1136.6991 550.6439,-1132.3366"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="792" cy="-1060.1015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="792" y="-1055.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;24</text>
</g>
<!-- block_5&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M911.7783,-2048.6668C897.049,-1927.1014 813.5155,-1237.6754 795.4464,-1088.546"/>
<polygon fill="#000000" stroke="#000000" points="798.8925,-1087.8889 794.215,-1078.3825 791.9433,-1088.7309 798.8925,-1087.8889"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="941,-1078.1015 887,-1078.1015 887,-1042.1015 941,-1042.1015 941,-1078.1015"/>
</g>
<!-- block_5&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_5&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M914,-2048.6668C914,-1927.1014 914,-1237.6754 914,-1088.546"/>
<polygon fill="#000000" stroke="#000000" points="917.5001,-1088.3825 914,-1078.3825 910.5001,-1088.3825 917.5001,-1088.3825"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1290.5,-1087.3019 959.5,-1087.3019 959.5,-1032.901 1290.5,-1032.901 1290.5,-1087.3019"/>
<text text-anchor="middle" x="1125" y="-1072.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="1125" y="-1056.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="1125" y="-1041.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
</g>
<!-- block_6&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_6&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1125,-2048.6668C1125,-1929.4749 1125,-1264.3801 1125,-1097.8906"/>
<polygon fill="#000000" stroke="#000000" points="1128.5001,-1097.6563 1125,-1087.6563 1121.5001,-1097.6564 1128.5001,-1097.6563"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="1386" cy="-1060.1015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1386" y="-1055.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 30&#45;59</text>
</g>
<!-- block_7&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>block_7&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1386,-2048.6668C1386,-1927.1014 1386,-1237.6754 1386,-1088.546"/>
<polygon fill="#000000" stroke="#000000" points="1389.5001,-1088.3825 1386,-1078.3825 1382.5001,-1088.3825 1389.5001,-1088.3825"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1535,-1078.1015 1481,-1078.1015 1481,-1042.1015 1535,-1042.1015 1535,-1078.1015"/>
</g>
<!-- block_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1388.2217,-2048.6668C1402.951,-1927.1014 1486.4845,-1237.6754 1504.5536,-1088.546"/>
<polygon fill="#000000" stroke="#000000" points="1508.0567,-1088.7309 1505.785,-1078.3825 1501.1075,-1087.8889 1508.0567,-1088.7309"/>
</g>
<!-- structure_21 -->
<g id="node22" class="node">
<title>structure_21</title>
<ellipse fill="none" stroke="#000000" cx="1598" cy="-1060.1015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="1598" y="-1055.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_8&#45;&gt;structure_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;structure_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1598,-2048.6668C1598,-1927.1014 1598,-1237.6754 1598,-1088.546"/>
<polygon fill="#000000" stroke="#000000" points="1601.5001,-1088.3825 1598,-1078.3825 1594.5001,-1088.3825 1601.5001,-1088.3825"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2125,-1078.1015 1661,-1078.1015 1661,-1042.1015 2125,-1042.1015 2125,-1078.1015"/>
<text text-anchor="middle" x="1893" y="-1056.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> read from a file, or the start rule name if nothing else given.</text>
</g>
<!-- block_8&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_8&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1603.3721,-2048.6668C1639.0237,-1926.9797 1841.3793,-1236.2946 1884.7971,-1088.0997"/>
<polygon fill="#000000" stroke="#000000" points="1888.1912,-1088.9632 1887.6441,-1078.3825 1881.4736,-1086.995 1888.1912,-1088.9632"/>
</g>
<!-- codeblock_26 -->
<g id="node27" class="node">
<title>codeblock_26</title>
<ellipse fill="none" stroke="#000000" cx="2225" cy="-1060.1015" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="2225" y="-1055.9015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 64&#45;117</text>
</g>
<!-- block_9&#45;&gt;codeblock_26 -->
<g id="edge26" class="edge">
<title>block_9&#45;&gt;codeblock_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1973.2062,-2049.027C1947.6701,-1949.0238 1836.5273,-1455.2156 2048,-1162.6015 2072.2709,-1129.0179 2097.9133,-1146.9655 2134,-1126.6015 2155.8209,-1114.2878 2178.5796,-1097.6551 2195.8787,-1084.1047"/>
<polygon fill="#000000" stroke="#000000" points="2198.249,-1086.6919 2203.9044,-1077.7327 2193.8963,-1081.2097 2198.249,-1086.6919"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2379,-1078.1015 2325,-1078.1015 2325,-1042.1015 2379,-1042.1015 2379,-1078.1015"/>
</g>
<!-- block_9&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_9&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1972.3199,-2049.0569C1940.9562,-1946.0935 1799.1853,-1425.8299 2048,-1162.6015 2130.5559,-1075.2632 2217.0876,-1194.8642 2316,-1126.6015 2329.3028,-1117.4208 2338.1367,-1101.6898 2343.7234,-1087.8323"/>
<polygon fill="#000000" stroke="#000000" points="2347.1004,-1088.7874 2347.2348,-1078.1934 2340.5232,-1086.3913 2347.1004,-1088.7874"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="211,-568.8007 69,-568.8007 69,-532.8007 211,-532.8007 211,-568.8007"/>
<text text-anchor="middle" x="140" y="-547.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M140,-1041.9752C140,-965.8686 140,-671.8171 140,-579.0245"/>
<polygon fill="#000000" stroke="#000000" points="143.5001,-578.975 140,-568.975 136.5001,-578.975 143.5001,-578.975"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="950.5,-625.3008 633.5,-625.3008 633.5,-476.3005 950.5,-476.3005 950.5,-625.3008"/>
<text text-anchor="middle" x="792" y="-610.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="792" y="-578.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="792" y="-531.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="792" y="-515.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="792" y="-484.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_14&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M792,-1041.9752C792,-977.773 792,-758.474 792,-635.7354"/>
<polygon fill="#000000" stroke="#000000" points="795.5001,-635.6184 792,-625.6184 788.5001,-635.6185 795.5001,-635.6184"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1574,-771.4016 1110,-771.4016 1110,-330.1998 1574,-330.1998 1574,-771.4016"/>
<text text-anchor="middle" x="1342" y="-756.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="1342" y="-741.001" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="1342" y="-709.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1342" y="-694.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="1342" y="-678.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="1342" y="-663.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1342" y="-648.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="1342" y="-632.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="1342" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="1342" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1342" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1342" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="1342" y="-555.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="1342" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="1342" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="1342" y="-493.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="1342" y="-478.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="1342" y="-462.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="1342" y="-447.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="1342" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="1342" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="1342" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="1342" y="-369.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="1342" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1384.434,-1041.9752C1380.7412,-999.2312 1371.1092,-887.7402 1361.9539,-781.7674"/>
<polygon fill="#000000" stroke="#000000" points="1365.4174,-781.1933 1361.0696,-771.5317 1358.4434,-781.7959 1365.4174,-781.1933"/>
</g>
<!-- handleline_22 -->
<g id="node23" class="node">
<title>handleline_22</title>
<ellipse fill="none" stroke="#000000" cx="1642" cy="-550.8007" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="1642" y="-546.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_21&#45;&gt;handleline_22 -->
<g id="edge22" class="edge">
<title>structure_21&#45;&gt;handleline_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1599.566,-1041.9752C1606.1411,-965.8686 1631.545,-671.8171 1639.5617,-579.0245"/>
<polygon fill="#000000" stroke="#000000" points="1643.0561,-579.2392 1640.4299,-568.975 1636.082,-578.6366 1643.0561,-579.2392"/>
</g>
<!-- handle_23 -->
<g id="node24" class="node">
<title>handle_23</title>
<ellipse fill="none" stroke="#000000" cx="1642" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="1642" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_22&#45;&gt;handle_23 -->
<g id="edge23" class="edge">
<title>handleline_22&#45;&gt;handle_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642,-532.7368C1642,-462.126 1642,-204.4338 1642,-118.2743"/>
<polygon fill="#000000" stroke="#000000" points="1645.5001,-118.1886 1642,-108.1886 1638.5001,-118.1887 1645.5001,-118.1886"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1669,-36 1615,-36 1615,0 1669,0 1669,-36"/>
</g>
<!-- handle_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>handle_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642,-71.8314C1642,-64.131 1642,-54.9743 1642,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="1645.5001,-46.4132 1642,-36.4133 1638.5001,-46.4133 1645.5001,-46.4132"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2408,-957.4022 2042,-957.4022 2042,-144.1992 2408,-144.1992 2408,-957.4022"/>
<text text-anchor="middle" x="2225" y="-942.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="2225" y="-927.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="2225" y="-911.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="2225" y="-896.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2225" y="-864.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="2225" y="-849.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2225" y="-834.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="2225" y="-818.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2225" y="-803.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2225" y="-771.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="2225" y="-740.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="2225" y="-725.001" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="2225" y="-693.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="2225" y="-678.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="2225" y="-662.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="2225" y="-647.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="2225" y="-632.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="2225" y="-616.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2225" y="-601.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2225" y="-585.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2225" y="-554.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="2225" y="-539.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="2225" y="-523.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="2225" y="-508.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="2225" y="-492.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="2225" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2225" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2225" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2225" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="2225" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="2225" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2225" y="-353.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="2225" y="-337.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="2225" y="-322.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="2225" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="2225" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="2225" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="2225" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="2225" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="2225" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="2225" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2225" y="-183.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="2225" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="2225" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
</g>
<!-- codeblock_26&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>codeblock_26&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2225,-1041.9752C2225,-1025.7558 2225,-999.6379 2225,-967.6791"/>
<polygon fill="#000000" stroke="#000000" points="2228.5001,-967.5777 2225,-957.5778 2221.5001,-967.5778 2228.5001,-967.5777"/>
</g>
</g>
</svg>