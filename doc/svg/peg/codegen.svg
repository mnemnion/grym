<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1884pt" height="1254pt"
 viewBox="0.00 0.00 1884.24 1253.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1249.6014)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1249.6014 1880.2418,-1249.6014 1880.2418,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="672.2418" cy="-1227.6014" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="672.2418" y="-1223.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 117</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="672.2418" cy="-1155.6014" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="672.2418" y="-1151.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;117</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M672.2418,-1209.4327C672.2418,-1201.7323 672.2418,-1192.5757 672.2418,-1184.018"/>
<polygon fill="#000000" stroke="#000000" points="675.7419,-1184.0146 672.2418,-1174.0146 668.7419,-1184.0147 675.7419,-1184.0146"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="250.2418" cy="-1083.6014" rx="27" ry="18"/>
<text text-anchor="middle" x="250.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M607.6725,-1152.9515C529.8707,-1148.3147 395.9305,-1135.6909 286.2418,-1101.6014 284.34,-1101.0103 282.4155,-1100.3278 280.4969,-1099.5815"/>
<polygon fill="#000000" stroke="#000000" points="281.6486,-1096.2646 271.0854,-1095.4464 278.8328,-1102.6733 281.6486,-1096.2646"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="327.2418" cy="-1083.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="327.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M611.548,-1149.1333C549.4639,-1141.5202 450.6943,-1126.6328 368.2418,-1101.6014 365.8335,-1100.8703 363.3787,-1100.0362 360.9275,-1099.1369"/>
<polygon fill="#000000" stroke="#000000" points="362.1838,-1095.8699 351.5983,-1095.4249 359.5958,-1102.374 362.1838,-1095.8699"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="445.2418" cy="-1083.6014" rx="67.748" ry="18"/>
<text text-anchor="middle" x="445.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M629.2779,-1141.9741C592.1111,-1130.1855 538.2256,-1113.0941 498.3602,-1100.4495"/>
<polygon fill="#000000" stroke="#000000" points="499.3926,-1097.1052 488.8024,-1097.418 497.2762,-1103.7776 499.3926,-1097.1052"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="608.2418" cy="-1083.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="608.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M656.4215,-1137.8036C648.7291,-1129.1497 639.344,-1118.5913 630.9074,-1109.1002"/>
<polygon fill="#000000" stroke="#000000" points="633.3614,-1106.5928 624.1018,-1101.4439 628.1295,-1111.2433 633.3614,-1106.5928"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="736.2418" cy="-1083.6014" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="736.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M688.062,-1137.8036C696.1234,-1128.7345 706.0439,-1117.574 714.7834,-1107.7421"/>
<polygon fill="#000000" stroke="#000000" points="717.4533,-1110.0066 721.481,-1100.2072 712.2214,-1105.356 717.4533,-1110.0066"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1008.2418" cy="-1083.6014" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1008.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 30&#45;59</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M724.0054,-1144.5092C782.2797,-1132.0218 877.1517,-1111.6921 941.0883,-1097.9914"/>
<polygon fill="#000000" stroke="#000000" points="942.0291,-1101.3693 951.0737,-1095.8517 940.5623,-1094.5247 942.0291,-1101.3693"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1303.2418" cy="-1083.6014" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1303.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 61&#45;63</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M732.4589,-1148.7303C852.0396,-1135.0856 1118.3974,-1104.693 1240.2279,-1090.7915"/>
<polygon fill="#000000" stroke="#000000" points="1240.9662,-1094.2301 1250.5049,-1089.6189 1240.1725,-1087.2752 1240.9662,-1094.2301"/>
</g>
<!-- codeblock_9 -->
<g id="node10" class="node">
<title>codeblock_9</title>
<ellipse fill="none" stroke="#000000" cx="1576.2418" cy="-1083.6014" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1576.2418" y="-1079.4014" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 64&#45;117</text>
</g>
<!-- section_1&#45;&gt;codeblock_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;codeblock_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M735.1189,-1150.9112C857.1933,-1141.7637 1134.8142,-1120.7566 1368.2418,-1101.6014 1408.1962,-1098.3227 1452.4515,-1094.5172 1489.8337,-1091.2521"/>
<polygon fill="#000000" stroke="#000000" points="1490.529,-1094.7048 1500.1858,-1090.3464 1489.9188,-1087.7314 1490.529,-1094.7048"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="57.2418,-640.8007 3.2418,-640.8007 3.2418,-604.8007 57.2418,-604.8007 57.2418,-640.8007"/>
</g>
<!-- prose_3&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>prose_3&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M302.9023,-1071.721C297.5104,-1069.4282 291.7576,-1067.235 286.2418,-1065.6014 191.2426,-1037.465 133.6635,-1102.2016 66.2418,-1029.6014 -33.3178,-922.3949 4.2344,-723.7061 22.5447,-650.6712"/>
<polygon fill="#000000" stroke="#000000" points="25.9736,-651.391 25.088,-640.8332 19.1964,-649.6389 25.9736,-651.391"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="217.2418,-640.8007 75.2418,-640.8007 75.2418,-604.8007 217.2418,-604.8007 217.2418,-640.8007"/>
<text text-anchor="middle" x="146.2418" y="-619.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Code Generator</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>codeblock_4&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M394.8838,-1071.5336C330.6824,-1056.099 227.7281,-1031.1601 226.2418,-1029.6014 123.9548,-922.3286 134.463,-724.4081 142.4868,-651.089"/>
<polygon fill="#000000" stroke="#000000" points="146.0033,-651.1503 143.6872,-640.8117 139.0506,-650.3381 146.0033,-651.1503"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="552.7418,-697.3008 235.7418,-697.3008 235.7418,-548.3005 552.7418,-548.3005 552.7418,-697.3008"/>
<text text-anchor="middle" x="394.2418" y="-682.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">local file = require &#39;pl.file&#39;</text>
<text text-anchor="middle" x="394.2418" y="-650.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local transform = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="394.2418" y="-603.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">local isrecursive = transform.isrecursive</text>
<text text-anchor="middle" x="394.2418" y="-587.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">local notrecursive = transform.notrecursive</text>
<text text-anchor="middle" x="394.2418" y="-556.5006" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;We start with pegylator.lua</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_5&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M590.0957,-1065.7972C580.6149,-1055.7962 569.3349,-1042.7169 561.2418,-1029.6014 496.9671,-925.4394 447.7005,-792.196 419.8524,-707.1478"/>
<polygon fill="#000000" stroke="#000000" points="423.1475,-705.9627 416.7285,-697.5338 416.4902,-708.126 423.1475,-705.9627"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="901.7418,-650.0012 570.7418,-650.0012 570.7418,-595.6002 901.7418,-595.6002 901.7418,-650.0012"/>
<text text-anchor="middle" x="736.2418" y="-634.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> Eventually all the imports are replaced with</text>
<text text-anchor="middle" x="736.2418" y="-619.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> require &quot;pegylator&quot;</text>
<text text-anchor="middle" x="736.2418" y="-603.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> but first we must write it. </text>
</g>
<!-- prose_6&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_6&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M736.2418,-1065.5374C736.2418,-997.2827 736.2418,-754.2229 736.2418,-660.2592"/>
<polygon fill="#000000" stroke="#000000" points="739.7419,-660.0781 736.2418,-650.0781 732.7419,-660.0782 739.7419,-660.0781"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1384.2418,-843.4016 920.2418,-843.4016 920.2418,-402.1998 1384.2418,-402.1998 1384.2418,-843.4016"/>
<text text-anchor="middle" x="1152.2418" y="-828.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local prefix = [[ </text>
<text text-anchor="middle" x="1152.2418" y="-813.001" font-family="Inconsolata" font-size="14.00" fill="#000000">require &#39;pl.strict&#39;</text>
<text text-anchor="middle" x="1152.2418" y="-781.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-766.201" font-family="Inconsolata" font-size="14.00" fill="#000000">local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-750.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;util&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-735.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-720.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">local core = require &quot;peg/core&#45;rules&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-704.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local dump_ast = util.dump_ast</text>
<text text-anchor="middle" x="1152.2418" y="-689.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local clear = ansi.clear()</text>
<text text-anchor="middle" x="1152.2418" y="-673.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local epnf = require &quot;peg/epnf&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-658.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-643.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local grammar = require &quot;peg/grammars&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-627.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = require &quot;peg/transform&quot;</text>
<text text-anchor="middle" x="1152.2418" y="-596.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local match = lpeg.match &#45;&#45; match a pattern against a string</text>
<text text-anchor="middle" x="1152.2418" y="-580.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local P = lpeg.P &#45;&#45; match a string literally</text>
<text text-anchor="middle" x="1152.2418" y="-565.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local S = lpeg.S &#160;&#45;&#45; match anything in a set</text>
<text text-anchor="middle" x="1152.2418" y="-550.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local R = epeg.R &#160;&#45;&#45; match anything in a range</text>
<text text-anchor="middle" x="1152.2418" y="-534.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">local B = lpeg.B</text>
<text text-anchor="middle" x="1152.2418" y="-519.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local C = lpeg.C &#160;&#45;&#45; captures a match</text>
<text text-anchor="middle" x="1152.2418" y="-503.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">local Csp = epeg.Csp &#45;&#45; captures start and end position of match</text>
<text text-anchor="middle" x="1152.2418" y="-488.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = lpeg.Ct &#45;&#45; a table with all captures from the pattern</text>
<text text-anchor="middle" x="1152.2418" y="-473.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = lpeg.V &#45;&#45; create a variable within a grammar</text>
<text text-anchor="middle" x="1152.2418" y="-441.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local WS = P&#39; &#39; + P&#39;\n&#39; + P&#39;,&#39; + P&#39;\09&#39;</text>
<text text-anchor="middle" x="1152.2418" y="-410.2003" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_7&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1013.8867,-1065.5374C1025.401,-1028.6918 1052.834,-940.906 1080.2629,-853.1333"/>
<polygon fill="#000000" stroke="#000000" points="1083.6183,-854.1301 1083.2604,-843.5413 1076.9369,-852.0421 1083.6183,-854.1301"/>
</g>
<!-- structure_15 -->
<g id="node16" class="node">
<title>structure_15</title>
<ellipse fill="none" stroke="#000000" cx="1447.2418" cy="-622.8007" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="1447.2418" y="-618.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_8&#45;&gt;structure_15 -->
<g id="edge15" class="edge">
<title>block_8&#45;&gt;structure_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1340.9136,-1070.1889C1359.6799,-1061.532 1380.9371,-1048.3343 1393.2418,-1029.6014 1473.0658,-908.0754 1459.9372,-721.7791 1451.329,-651.214"/>
<polygon fill="#000000" stroke="#000000" points="1454.7507,-650.3807 1450.0012,-640.91 1447.8081,-651.2754 1454.7507,-650.3807"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1876.2418,-1029.4022 1510.2418,-1029.4022 1510.2418,-216.1992 1876.2418,-216.1992 1876.2418,-1029.4022"/>
<text text-anchor="middle" x="1693.2418" y="-1014.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">local definer = [[</text>
<text text-anchor="middle" x="1693.2418" y="-999.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local _generator = function{}</text>
<text text-anchor="middle" x="1693.2418" y="-983.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function generated(_ENV)</text>
<text text-anchor="middle" x="1693.2418" y="-968.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1693.2418" y="-936.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">local end_definer = [[</text>
<text text-anchor="middle" x="1693.2418" y="-921.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1693.2418" y="-906.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return generated</text>
<text text-anchor="middle" x="1693.2418" y="-890.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1693.2418" y="-875.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1693.2418" y="-843.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local caller = [[</text>
<text text-anchor="middle" x="1693.2418" y="-812.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local peg = epnf.define(_generator(),nil,false)</text>
<text text-anchor="middle" x="1693.2418" y="-797.001" font-family="Inconsolata" font-size="14.00" fill="#000000">]]</text>
<text text-anchor="middle" x="1693.2418" y="-765.601" font-family="Inconsolata" font-size="14.00" fill="#000000">local function local_rules(ast)</text>
<text text-anchor="middle" x="1693.2418" y="-750.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local locals = ast:select(notrecursive)</text>
<text text-anchor="middle" x="1693.2418" y="-734.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1693.2418" y="-719.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #locals do</text>
<text text-anchor="middle" x="1693.2418" y="-704.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&#160;&#160;&quot;..locals[i]:flatten()</text>
<text text-anchor="middle" x="1693.2418" y="-688.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1693.2418" y="-673.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1693.2418" y="-657.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1693.2418" y="-626.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cursive_rules(ast)</text>
<text text-anchor="middle" x="1693.2418" y="-611.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursives = ast:select(isrecursive)</text>
<text text-anchor="middle" x="1693.2418" y="-595.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase &#160;= &quot;&quot;</text>
<text text-anchor="middle" x="1693.2418" y="-580.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #cursives do</text>
<text text-anchor="middle" x="1693.2418" y="-564.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot; &#160;&quot;..cursives[i]:flatten()</text>
<text text-anchor="middle" x="1693.2418" y="-549.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1693.2418" y="-534.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1693.2418" y="-518.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1693.2418" y="-487.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function write(str)</text>
<text text-anchor="middle" x="1693.2418" y="-471.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return file.write(&quot;gen.lua&quot;,str)</text>
<text text-anchor="middle" x="1693.2418" y="-456.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1693.2418" y="-425.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function build(ast)</text>
<text text-anchor="middle" x="1693.2418" y="-409.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = prefix..ast:root().imports..</text>
<text text-anchor="middle" x="1693.2418" y="-394.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;local_rules(ast)..&quot;\n\n&quot;..</text>
<text text-anchor="middle" x="1693.2418" y="-378.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;definer..ast:root().start_rule..</text>
<text text-anchor="middle" x="1693.2418" y="-363.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45;cursive_rules(ast)..end_definer</text>
<text text-anchor="middle" x="1693.2418" y="-348.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local_rules(ast)..end_definer..</text>
<text text-anchor="middle" x="1693.2418" y="-332.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caller</text>
<text text-anchor="middle" x="1693.2418" y="-317.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;write(phrase)</text>
<text text-anchor="middle" x="1693.2418" y="-301.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1693.2418" y="-286.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1693.2418" y="-255.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">return { local_rules = local_rules,</text>
<text text-anchor="middle" x="1693.2418" y="-239.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;cursive_rules = cursive_rules,</text>
<text text-anchor="middle" x="1693.2418" y="-224.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;build = build }</text>
</g>
<!-- codeblock_9&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>codeblock_9&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1580.8283,-1065.5374C1582.6074,-1058.5306 1584.8542,-1049.6815 1587.4798,-1039.3406"/>
<polygon fill="#000000" stroke="#000000" points="1590.9264,-1039.9883 1589.9951,-1029.4345 1584.1416,-1038.2656 1590.9264,-1039.9883"/>
</g>
<!-- handleline_16 -->
<g id="node17" class="node">
<title>handleline_16</title>
<ellipse fill="none" stroke="#000000" cx="1447.2418" cy="-162" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="1447.2418" y="-157.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_15&#45;&gt;handleline_16 -->
<g id="edge16" class="edge">
<title>structure_15&#45;&gt;handleline_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1447.2418,-604.7368C1447.2418,-534.126 1447.2418,-276.4338 1447.2418,-190.2743"/>
<polygon fill="#000000" stroke="#000000" points="1450.7419,-190.1886 1447.2418,-180.1886 1443.7419,-190.1887 1450.7419,-190.1886"/>
</g>
<!-- handle_17 -->
<g id="node18" class="node">
<title>handle_17</title>
<ellipse fill="none" stroke="#000000" cx="1447.2418" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="1447.2418" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_16&#45;&gt;handle_17 -->
<g id="edge17" class="edge">
<title>handleline_16&#45;&gt;handle_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1447.2418,-143.8314C1447.2418,-136.131 1447.2418,-126.9743 1447.2418,-118.4166"/>
<polygon fill="#000000" stroke="#000000" points="1450.7419,-118.4132 1447.2418,-108.4133 1443.7419,-118.4133 1450.7419,-118.4132"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1474.2418,-36 1420.2418,-36 1420.2418,0 1474.2418,0 1474.2418,-36"/>
</g>
<!-- handle_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>handle_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1447.2418,-71.8314C1447.2418,-64.131 1447.2418,-54.9743 1447.2418,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="1450.7419,-46.4132 1447.2418,-36.4133 1443.7419,-46.4133 1450.7419,-46.4132"/>
</g>
</g>
</svg>