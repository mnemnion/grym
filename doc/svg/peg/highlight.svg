<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2582pt" height="1151pt"
 viewBox="0.00 0.00 2582.03 1151.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1147.2015)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1147.2015 2578.0282,-1147.2015 2578.0282,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1243.0282" cy="-1125.2015" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1243.0282" y="-1121.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 196</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1243.0282" cy="-1053.2015" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1243.0282" y="-1049.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;196</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1243.0282,-1107.0329C1243.0282,-1099.3325 1243.0282,-1090.1758 1243.0282,-1081.6181"/>
<polygon fill="#000000" stroke="#000000" points="1246.5283,-1081.6147 1243.0282,-1071.6148 1239.5283,-1081.6148 1246.5283,-1081.6147"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="681.0282" cy="-981.2015" rx="27" ry="18"/>
<text text-anchor="middle" x="681.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1178.5949,-1049.494C1057.8603,-1042.0678 802.0914,-1023.9361 717.0282,-999.2015 714.902,-998.5833 712.7506,-997.8423 710.6128,-997.0184"/>
<polygon fill="#000000" stroke="#000000" points="712.0116,-993.8101 701.4478,-992.9995 709.2004,-1000.2209 712.0116,-993.8101"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="758.0282" cy="-981.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="758.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1177.5449,-1051.2036C1089.9026,-1047.1881 930.2774,-1035.1528 799.0282,-999.2015 796.6008,-998.5366 794.1317,-997.752 791.6702,-996.8886"/>
<polygon fill="#000000" stroke="#000000" points="792.9071,-993.6144 782.3184,-993.2545 790.3716,-1000.139 792.9071,-993.6144"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="881.0282" cy="-981.2015" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="881.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;10</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1188.4832,-1043.1092C1131.9946,-1032.5572 1041.2139,-1015.3195 963.0282,-999.2015 957.2669,-998.0138 951.2841,-996.7532 945.2929,-995.4723"/>
<polygon fill="#000000" stroke="#000000" points="945.7525,-991.991 935.2396,-993.3065 944.2783,-998.8341 945.7525,-991.991"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="1049.0282" cy="-981.2015" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1049.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 15&#45;61</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1203.7694,-1038.6312C1173.8687,-1027.5341 1132.4591,-1012.1656 1100.0006,-1000.1191"/>
<polygon fill="#000000" stroke="#000000" points="1100.8303,-996.6938 1090.2373,-996.4956 1098.3947,-1003.2564 1100.8303,-996.6938"/>
</g>
<!-- prose_6 -->
<g id="node7" class="node">
<title>prose_6</title>
<ellipse fill="none" stroke="#000000" cx="1177.0282" cy="-981.2015" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1177.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;prose_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1226.7136,-1035.4037C1218.2798,-1026.2032 1207.8728,-1014.8502 1198.7661,-1004.9155"/>
<polygon fill="#000000" stroke="#000000" points="1201.1412,-1002.327 1191.8039,-997.3205 1195.9811,-1007.0571 1201.1412,-1002.327"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1309.0282" cy="-981.2015" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1309.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 67&#45;117</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1259.3428,-1035.4037C1267.3549,-1026.6632 1277.1478,-1015.9801 1285.9149,-1006.4159"/>
<polygon fill="#000000" stroke="#000000" points="1288.4953,-1008.7807 1292.6725,-999.044 1283.3352,-1004.0506 1288.4953,-1008.7807"/>
</g>
<!-- structure_8 -->
<g id="node9" class="node">
<title>structure_8</title>
<ellipse fill="none" stroke="#000000" cx="1534.0282" cy="-981.2015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="1534.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;structure_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1292.0633,-1041.0691C1346.0839,-1027.7032 1432.3931,-1006.3483 1486.006,-993.0833"/>
<polygon fill="#000000" stroke="#000000" points="1487.0804,-996.4231 1495.9471,-990.6236 1485.3991,-989.628 1487.0804,-996.4231"/>
</g>
<!-- codeblock_9 -->
<g id="node10" class="node">
<title>codeblock_9</title>
<ellipse fill="none" stroke="#000000" cx="1795.0282" cy="-981.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="1795.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 128&#45;176</text>
</g>
<!-- section_1&#45;&gt;codeblock_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;codeblock_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1302.3638,-1045.4621C1400.8867,-1032.6112 1598.5165,-1006.8335 1711.2255,-992.1323"/>
<polygon fill="#000000" stroke="#000000" points="1711.7302,-995.5962 1721.1935,-990.8321 1710.8247,-988.655 1711.7302,-995.5962"/>
</g>
<!-- structure_10 -->
<g id="node11" class="node">
<title>structure_10</title>
<ellipse fill="none" stroke="#000000" cx="2070.0282" cy="-981.2015" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="2070.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;structure_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1306.525,-1048.272C1422.6156,-1039.179 1676.876,-1018.8905 1891.0282,-999.2015 1933.2065,-995.3237 1980.9295,-990.5031 2016.4864,-986.8268"/>
<polygon fill="#000000" stroke="#000000" points="2017.0578,-990.2864 2026.6434,-985.7736 2016.3357,-983.3237 2017.0578,-990.2864"/>
</g>
<!-- codeblock_11 -->
<g id="node12" class="node">
<title>codeblock_11</title>
<ellipse fill="none" stroke="#000000" cx="2319.0282" cy="-981.2015" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="2319.0282" y="-977.0015" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 183&#45;196</text>
</g>
<!-- section_1&#45;&gt;codeblock_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;codeblock_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1307.7354,-1049.92C1453.5328,-1042.3761 1818.8327,-1022.6352 2124.0282,-999.2015 2158.7422,-996.5361 2196.8871,-993.1228 2230.1631,-989.9864"/>
<polygon fill="#000000" stroke="#000000" points="2230.6996,-993.4514 2240.3246,-989.0231 2230.0389,-986.4826 2230.6996,-993.4514"/>
</g>
<!-- raw_12 -->
<g id="node13" class="node">
<title>raw_12</title>
<ellipse fill="none" stroke="#000000" cx="30.0282" cy="-545.0008" rx="27" ry="18"/>
<text text-anchor="middle" x="30.0282" y="-540.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_12 -->
<g id="edge12" class="edge">
<title>prose_3&#45;&gt;raw_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M733.8092,-968.8706C728.4097,-966.6058 722.6234,-964.538 717.0282,-963.2015 646.5665,-946.3711 118.2345,-977.427 66.0282,-927.2015 -32.6502,-832.2672 3.8732,-643.5411 22.1432,-572.7147"/>
<polygon fill="#000000" stroke="#000000" points="25.6008,-573.3318 24.7918,-562.7679 18.8365,-571.5306 25.6008,-573.3318"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="546.5282,-603.4017 75.5282,-603.4017 75.5282,-486.5999 546.5282,-486.5999 546.5282,-603.4017"/>
<text text-anchor="middle" x="311.0282" y="-588.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Generates a terminal syntax highlighter for a given grammar. </text>
<text text-anchor="middle" x="311.0282" y="-556.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;local clu = require &quot;clu/prelude&quot;</text>
<text text-anchor="middle" x="311.0282" y="-541.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="311.0282" y="-525.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">local ast = require &quot;peg/ast&quot;</text>
<text text-anchor="middle" x="311.0282" y="-510.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">local util = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="311.0282" y="-495.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local tableand = util.tableand</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_4&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M827.7646,-968.9459C818.2196,-966.9107 808.3467,-964.9096 799.0282,-963.2015 691.2061,-943.438 647.046,-986.7743 555.0282,-927.2015 439.3037,-852.2809 367.7274,-701.0147 334.0511,-612.9109"/>
<polygon fill="#000000" stroke="#000000" points="337.321,-611.6626 330.5205,-603.5384 330.7704,-614.1303 337.321,-611.6626"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="979.5282,-897.1021 564.5282,-897.1021 564.5282,-192.8995 979.5282,-192.8995 979.5282,-897.1021"/>
<text text-anchor="middle" x="772.0282" y="-882.1014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;local p = clu.env.palette</text>
<text text-anchor="middle" x="772.0282" y="-850.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> testrules = { atom &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;White&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-835.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;pattern &#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Blue&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-819.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;optional &#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-804.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;more_than_one &#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-789.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;some_number &#160;&#160;&#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-773.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;some_suffix &#160;&#160;&#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-758.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;which_suffix &#160;&#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-742.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;maybe &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Green&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-727.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;set &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Yellow&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-712.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;range &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Yellow&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-696.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;literal &#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Yellow&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-681.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PEL &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Grey&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-665.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;PER &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Grey&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-650.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hidden_rule &#160;&#160;&#160;= {&quot;Cyan&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-635.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hidden_pattern = {&quot;Cyan&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-619.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;hidden_match &#160;&#160;= {&quot;Cyan&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-604.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;repeats &#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Red&quot;,&quot;Clear&quot;},</text>
<text text-anchor="middle" x="772.0282" y="-588.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment &#160;&#160;&#160;&#160;&#160;&#160;&#160;= {&quot;Grey&quot;,&quot;Clear&quot;}}</text>
<text text-anchor="middle" x="772.0282" y="-541.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">function makerules(rules)</text>
<text text-anchor="middle" x="772.0282" y="-526.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local rule_table = {}</text>
<text text-anchor="middle" x="772.0282" y="-510.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local p = nil</text>
<text text-anchor="middle" x="772.0282" y="-495.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; this logic belongs in a palette </text>
<text text-anchor="middle" x="772.0282" y="-479.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; object which may be called. </text>
<text text-anchor="middle" x="772.0282" y="-464.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if clu.env.ansi then </text>
<text text-anchor="middle" x="772.0282" y="-449.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;p = clu.env.palette.default</text>
<text text-anchor="middle" x="772.0282" y="-433.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="772.0282" y="-418.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;p = clu.env.palette.no_color</text>
<text text-anchor="middle" x="772.0282" y="-402.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end </text>
<text text-anchor="middle" x="772.0282" y="-387.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for k,v in pairs(rules) do</text>
<text text-anchor="middle" x="772.0282" y="-372.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(v) == &quot;table&quot; then </text>
<text text-anchor="middle" x="772.0282" y="-356.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;rule_table[k] = { p[v[1]] , p[v[2]] }</text>
<text text-anchor="middle" x="772.0282" y="-341.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else &#45;&#45; string or function</text>
<text text-anchor="middle" x="772.0282" y="-325.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error &quot;error in makerules, non&#45;table values NYI&quot;</text>
<text text-anchor="middle" x="772.0282" y="-310.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="772.0282" y="-295.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="772.0282" y="-279.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return rule_table</text>
<text text-anchor="middle" x="772.0282" y="-264.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="772.0282" y="-200.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;local testrules = { atom = {&quot;&quot;,&quot;&quot;}, lhs = {&quot;&quot;,&quot;&quot;}}</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_5&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1026.3073,-963.7384C1014.3344,-953.8373 999.9169,-940.7446 989.0282,-927.2015 983.3225,-920.105 977.6773,-912.8396 972.0992,-905.4365"/>
<polygon fill="#000000" stroke="#000000" points="974.8553,-903.2774 966.0731,-897.3507 969.2425,-907.4604 974.8553,-903.2774"/>
</g>
<!-- raw_16 -->
<g id="node17" class="node">
<title>raw_16</title>
<ellipse fill="none" stroke="#000000" cx="1025.0282" cy="-545.0008" rx="27" ry="18"/>
<text text-anchor="middle" x="1025.0282" y="-540.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_6&#45;&gt;raw_16 -->
<g id="edge16" class="edge">
<title>prose_6&#45;&gt;raw_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1151.5155,-970.0953C1118.2301,-955.4942 1063.8619,-931.2172 1061.0282,-927.2015 982.971,-816.5855 1006.1222,-640.8722 1019.0132,-573.0157"/>
<polygon fill="#000000" stroke="#000000" points="1022.4719,-573.5665 1020.9769,-563.0777 1015.6047,-572.2095 1022.4719,-573.5665"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1548.0282,-927.4023 1070.0282,-927.4023 1070.0282,-162.5992 1548.0282,-162.5992 1548.0282,-927.4023"/>
<text text-anchor="middle" x="1309.0282" y="-912.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function rulewrap_value(ast,rules)</text>
<text text-anchor="middle" x="1309.0282" y="-896.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if rules[ast.id] then</text>
<text text-anchor="middle" x="1309.0282" y="-881.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;local rule = rules[ast.id]</text>
<text text-anchor="middle" x="1309.0282" y="-865.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;if type (rule) == &quot;string&quot; then &#45;&#45; pre only</text>
<text text-anchor="middle" x="1309.0282" y="-850.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return rule..ast.val..p.Clear</text>
<text text-anchor="middle" x="1309.0282" y="-835.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type (rule) == &quot;table&quot; then &#45;&#45; pre and post</text>
<text text-anchor="middle" x="1309.0282" y="-819.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return rule[1]..ast.val..rule[2]</text>
<text text-anchor="middle" x="1309.0282" y="-804.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type (rule) == &quot;function&quot; then &#45;&#45; function over value</text>
<text text-anchor="middle" x="1309.0282" y="-788.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print &quot;function reached in rulewrap_value&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-773.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-758.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-742.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1309.0282" y="-727.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;return ast.val</text>
<text text-anchor="middle" x="1309.0282" y="-711.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-696.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1309.0282" y="-665.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local function rulewrap_open(ast,rules)</text>
<text text-anchor="middle" x="1309.0282" y="-649.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if rules[ast.id] then</text>
<text text-anchor="middle" x="1309.0282" y="-634.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local rule = rules[ast.id]</text>
<text text-anchor="middle" x="1309.0282" y="-618.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(rule) == &quot;string&quot; then &#45;&#45; pre only</text>
<text text-anchor="middle" x="1309.0282" y="-603.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return rule</text>
<text text-anchor="middle" x="1309.0282" y="-588.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(rule) == &quot;table&quot; then &#45;&#45; use pre</text>
<text text-anchor="middle" x="1309.0282" y="-572.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return rule[1]</text>
<text text-anchor="middle" x="1309.0282" y="-557.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(rule) == &quot;function&quot; then &#45;&#45; fn over span</text>
<text text-anchor="middle" x="1309.0282" y="-541.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print &quot;function reached in rulewrap_start&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-526.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-511.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-495.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else </text>
<text text-anchor="middle" x="1309.0282" y="-480.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &quot;&quot; </text>
<text text-anchor="middle" x="1309.0282" y="-464.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-449.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1309.0282" y="-418.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function rulewrap_close(ast,rules)</text>
<text text-anchor="middle" x="1309.0282" y="-402.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if rules[ast.id] then</text>
<text text-anchor="middle" x="1309.0282" y="-387.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local rule = rules[ast.id]</text>
<text text-anchor="middle" x="1309.0282" y="-371.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(rule) == &quot;string&quot; then </text>
<text text-anchor="middle" x="1309.0282" y="-356.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-341.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(rule) == &quot;table&quot; then</text>
<text text-anchor="middle" x="1309.0282" y="-325.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return rule[2]</text>
<text text-anchor="middle" x="1309.0282" y="-310.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(rule) == &quot;function&quot; then</text>
<text text-anchor="middle" x="1309.0282" y="-294.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print &quot;function reached in rulewrap_close&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-279.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-264.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-248.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1309.0282" y="-233.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1309.0282" y="-217.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1309.0282" y="-202.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1309.0282" y="-171.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; highlights a Node.</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>codeblock_7&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1309.0282,-963.0138C1309.0282,-956.1102 1309.0282,-947.4379 1309.0282,-937.341"/>
<polygon fill="#000000" stroke="#000000" points="1312.5283,-937.2353 1309.0282,-927.2353 1305.5283,-937.2353 1312.5283,-937.2353"/>
</g>
<!-- handleline_19 -->
<g id="node20" class="node">
<title>handleline_19</title>
<ellipse fill="none" stroke="#000000" cx="1616.0282" cy="-545.0008" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="1616.0282" y="-540.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_8&#45;&gt;handleline_19 -->
<g id="edge19" class="edge">
<title>structure_8&#45;&gt;handleline_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1543.0727,-963.1204C1547.879,-952.8226 1553.5058,-939.5482 1557.0282,-927.2015 1593.855,-798.116 1609.1458,-637.5377 1614.0771,-573.393"/>
<polygon fill="#000000" stroke="#000000" points="1617.5798,-573.4855 1614.8311,-563.2534 1610.5991,-572.9663 1617.5798,-573.4855"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2127.5282,-911.5022 1684.5282,-911.5022 1684.5282,-178.4994 2127.5282,-178.4994 2127.5282,-911.5022"/>
<text text-anchor="middle" x="1906.0282" y="-896.3015" font-family="Inconsolata" font-size="14.00" fill="#000000">local function light(ast, rules)</text>
<text text-anchor="middle" x="1906.0282" y="-880.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if rules then </text>
<text text-anchor="middle" x="1906.0282" y="-865.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;rules = makerules(rules)</text>
<text text-anchor="middle" x="1906.0282" y="-850.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else </text>
<text text-anchor="middle" x="1906.0282" y="-834.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;rules = makerules(testrules) </text>
<text text-anchor="middle" x="1906.0282" y="-819.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-787.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local source = ast:root().str</text>
<text text-anchor="middle" x="1906.0282" y="-772.5013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local queue = {}</text>
<text text-anchor="middle" x="1906.0282" y="-757.1012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1906.0282" y="-741.7012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local cursor = 1</text>
<text text-anchor="middle" x="1906.0282" y="-726.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local gap = &quot;&quot;</text>
<text text-anchor="middle" x="1906.0282" y="-710.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local ndx, first, last = ast:range()</text>
<text text-anchor="middle" x="1906.0282" y="-695.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local new = true</text>
<text text-anchor="middle" x="1906.0282" y="-680.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = first, last do</text>
<text text-anchor="middle" x="1906.0282" y="-664.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local node, close, _ = ndx(i)</text>
<text text-anchor="middle" x="1906.0282" y="-649.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if rules[node.id] </text>
<text text-anchor="middle" x="1906.0282" y="-633.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;and node.val == nil then &#45;&#45; open regional rule</text>
<text text-anchor="middle" x="1906.0282" y="-618.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;gap = source:sub(cursor,node.first&#45;1)</text>
<text text-anchor="middle" x="1906.0282" y="-603.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursor = node.first</text>
<text text-anchor="middle" x="1906.0282" y="-587.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;queue[close] = node</text>
<text text-anchor="middle" x="1906.0282" y="-572.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..gap..rulewrap_open(node,rules)</text>
<text text-anchor="middle" x="1906.0282" y="-556.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif node.id and node.val then &#45;&#45; wrap values in rule</text>
<text text-anchor="middle" x="1906.0282" y="-541.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if new then </text>
<text text-anchor="middle" x="1906.0282" y="-526.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..source:sub(1,ndx[1].first&#45;1)</text>
<text text-anchor="middle" x="1906.0282" y="-510.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;new = false</text>
<text text-anchor="middle" x="1906.0282" y="-495.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-479.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if cursor &lt;= node.first then</text>
<text text-anchor="middle" x="1906.0282" y="-464.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;gap = source:sub(cursor,node.first&#45;1)</text>
<text text-anchor="middle" x="1906.0282" y="-449.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-433.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursor = node.last+1</text>
<text text-anchor="middle" x="1906.0282" y="-418.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..gap..rulewrap_value(node,rules)</text>
<text text-anchor="middle" x="1906.0282" y="-402.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-387.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if queue[i] then &#45;&#45; close regional rule</text>
<text text-anchor="middle" x="1906.0282" y="-372.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;gap = source:sub(cursor,queue[i].last&#45;1)</text>
<text text-anchor="middle" x="1906.0282" y="-356.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cursor = queue[i].last</text>
<text text-anchor="middle" x="1906.0282" y="-341.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase</text>
<text text-anchor="middle" x="1906.0282" y="-325.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..rulewrap_open(queue[i],rules)</text>
<text text-anchor="middle" x="1906.0282" y="-310.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..gap</text>
<text text-anchor="middle" x="1906.0282" y="-295.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..rulewrap_close(queue[i],rules)</text>
<text text-anchor="middle" x="1906.0282" y="-279.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-264.3002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1906.0282" y="-248.9002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;phrase = phrase..source:sub(cursor,&#45;1)</text>
<text text-anchor="middle" x="1906.0282" y="-233.5002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1906.0282" y="-218.1001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1906.0282" y="-186.7001" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; generates a highlighter from a rule table</text>
</g>
<!-- codeblock_9&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_9&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1799.6564,-963.0138C1802.2702,-952.7424 1805.8802,-938.5559 1810.1981,-921.5876"/>
<polygon fill="#000000" stroke="#000000" points="1813.5937,-922.4361 1812.668,-911.8818 1806.8099,-920.7098 1813.5937,-922.4361"/>
</g>
<!-- handleline_23 -->
<g id="node24" class="node">
<title>handleline_23</title>
<ellipse fill="none" stroke="#000000" cx="2196.0282" cy="-545.0008" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="2196.0282" y="-540.8008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_10&#45;&gt;handleline_23 -->
<g id="edge23" class="edge">
<title>structure_10&#45;&gt;handleline_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2096.3672,-966.6279C2110.7302,-957.27 2127.4802,-943.77 2137.0282,-927.2015 2204.6672,-809.8289 2202.3363,-640.0534 2198.3132,-573.3886"/>
<polygon fill="#000000" stroke="#000000" points="2201.7942,-572.9857 2197.6373,-563.2404 2194.8096,-573.4509 2201.7942,-572.9857"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2574.0282,-641.9015 2264.0282,-641.9015 2264.0282,-448.1 2574.0282,-448.1 2574.0282,-641.9015"/>
<text text-anchor="middle" x="2419.0282" y="-626.501" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Highlighter(parser, rules)</text>
<text text-anchor="middle" x="2419.0282" y="-611.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function lighter(source)</text>
<text text-anchor="middle" x="2419.0282" y="-595.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(source) == &quot;string&quot; then</text>
<text text-anchor="middle" x="2419.0282" y="-580.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;source = ast.parse(parser,source)</text>
<text text-anchor="middle" x="2419.0282" y="-564.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2419.0282" y="-549.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return light(source, rules)</text>
<text text-anchor="middle" x="2419.0282" y="-534.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2419.0282" y="-518.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lighter</text>
<text text-anchor="middle" x="2419.0282" y="-503.3007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2419.0282" y="-471.9007" font-family="Inconsolata" font-size="14.00" fill="#000000">return {Highlighter = Highlighter,</text>
<text text-anchor="middle" x="2419.0282" y="-456.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;light = light}</text>
</g>
<!-- codeblock_11&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_11&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2323.1977,-963.0138C2335.1701,-910.7904 2370.3442,-757.3605 2394.5744,-651.6682"/>
<polygon fill="#000000" stroke="#000000" points="2397.9876,-652.4429 2396.8107,-641.9136 2391.1646,-650.8787 2397.9876,-652.4429"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="57.0282,-117.4 3.0282,-117.4 3.0282,-81.4 57.0282,-81.4 57.0282,-117.4"/>
</g>
<!-- raw_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>raw_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M30.0282,-526.9808C30.0282,-458.1916 30.0282,-211.7921 30.0282,-127.7335"/>
<polygon fill="#000000" stroke="#000000" points="33.5283,-127.6442 30.0282,-117.6442 26.5283,-127.6443 33.5283,-127.6442"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1141.5282,-126.7005 908.5282,-126.7005 908.5282,-72.0996 1141.5282,-72.0996 1141.5282,-126.7005"/>
<text text-anchor="middle" x="1025.0282" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> wraps a value in a rule, or</text>
<text text-anchor="middle" x="1025.0282" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000"> returns it if the rule is nil.</text>
</g>
<!-- raw_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>raw_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1025.0282,-526.9808C1025.0282,-460.5736 1025.0282,-228.644 1025.0282,-137.0358"/>
<polygon fill="#000000" stroke="#000000" points="1028.5283,-136.8333 1025.0282,-126.8334 1021.5283,-136.8334 1028.5283,-136.8333"/>
</g>
<!-- handle_20 -->
<g id="node21" class="node">
<title>handle_20</title>
<ellipse fill="none" stroke="#000000" cx="1616.0282" cy="-99.4" rx="36.827" ry="18"/>
<text text-anchor="middle" x="1616.0282" y="-95.2" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_19&#45;&gt;handle_20 -->
<g id="edge20" class="edge">
<title>handleline_19&#45;&gt;handle_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.0282,-526.9808C1616.0282,-458.1916 1616.0282,-211.7921 1616.0282,-127.7335"/>
<polygon fill="#000000" stroke="#000000" points="1619.5283,-127.6442 1616.0282,-117.6442 1612.5283,-127.6443 1619.5283,-127.6442"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1643.0282,-36 1589.0282,-36 1589.0282,0 1643.0282,0 1643.0282,-36"/>
</g>
<!-- handle_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>handle_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1616.0282,-81.3347C1616.0282,-71.0069 1616.0282,-57.828 1616.0282,-46.1691"/>
<polygon fill="#000000" stroke="#000000" points="1619.5283,-46.0148 1616.0282,-36.0148 1612.5283,-46.0148 1619.5283,-46.0148"/>
</g>
<!-- handle_24 -->
<g id="node25" class="node">
<title>handle_24</title>
<ellipse fill="none" stroke="#000000" cx="2196.0282" cy="-99.4" rx="36.827" ry="18"/>
<text text-anchor="middle" x="2196.0282" y="-95.2" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_23&#45;&gt;handle_24 -->
<g id="edge24" class="edge">
<title>handleline_23&#45;&gt;handle_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2196.0282,-526.9808C2196.0282,-458.1916 2196.0282,-211.7921 2196.0282,-127.7335"/>
<polygon fill="#000000" stroke="#000000" points="2199.5283,-127.6442 2196.0282,-117.6442 2192.5283,-127.6443 2199.5283,-127.6442"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2223.0282,-36 2169.0282,-36 2169.0282,0 2223.0282,0 2223.0282,-36"/>
</g>
<!-- handle_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>handle_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2196.0282,-81.3347C2196.0282,-71.0069 2196.0282,-57.828 2196.0282,-46.1691"/>
<polygon fill="#000000" stroke="#000000" points="2199.5283,-46.0148 2196.0282,-36.0148 2192.5283,-46.0148 2199.5283,-46.0148"/>
</g>
</g>
</svg>