<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2110pt" height="1435pt"
 viewBox="0.00 0.00 2109.50 1434.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1430.6022)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1430.6022 2105.5,-1430.6022 2105.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="805" cy="-1408.6022" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="805" y="-1404.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 118</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="805" cy="-1336.6022" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="805" y="-1332.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;118</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M805,-1390.4335C805,-1382.7331 805,-1373.5765 805,-1365.0188"/>
<polygon fill="#000000" stroke="#000000" points="808.5001,-1365.0154 805,-1355.0154 801.5001,-1365.0155 808.5001,-1365.0154"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="297" cy="-1264.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="297" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M741.6,-1332.1019C631.1382,-1323.8035 408.0117,-1304.8869 333,-1282.6022 331.091,-1282.035 329.1608,-1281.3711 327.2379,-1280.6389"/>
<polygon fill="#000000" stroke="#000000" points="328.3812,-1277.3195 317.8149,-1276.5417 325.59,-1283.7389 328.3812,-1277.3195"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="388" cy="-1264.6022" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="388" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M743.5558,-1330.6236C671.0577,-1322.8383 547.1963,-1307.239 443,-1282.6022 439.364,-1281.7424 435.6238,-1280.7527 431.8864,-1279.6888"/>
<polygon fill="#000000" stroke="#000000" points="432.6575,-1276.2659 422.0732,-1276.7378 430.6417,-1282.9694 432.6575,-1276.2659"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="503" cy="-1264.6022" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="503" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 4&#45;78</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M755.469,-1324.7934C700.2184,-1311.6211 611.2346,-1290.4064 555.0017,-1276.9999"/>
<polygon fill="#000000" stroke="#000000" points="555.7805,-1273.5876 545.2414,-1274.673 554.1571,-1280.3967 555.7805,-1273.5876"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="659" cy="-1264.6022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="659" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 79&#45;80</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M772.9597,-1320.8014C751.2696,-1310.105 722.4466,-1295.8909 699.2149,-1284.4342"/>
<polygon fill="#000000" stroke="#000000" points="700.481,-1281.1561 689.9642,-1279.8722 697.3849,-1287.4342 700.481,-1281.1561"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="805" cy="-1264.6022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="805" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 81&#45;89</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M805,-1318.4335C805,-1310.7331 805,-1301.5765 805,-1293.0188"/>
<polygon fill="#000000" stroke="#000000" points="808.5001,-1293.0154 805,-1283.0154 801.5001,-1293.0155 808.5001,-1293.0154"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="980" cy="-1264.6022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="980" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 90&#45;93</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M841.6857,-1321.5086C869.15,-1310.209 906.8353,-1294.7042 935.9341,-1282.7321"/>
<polygon fill="#000000" stroke="#000000" points="937.5299,-1285.8603 945.446,-1278.8186 934.8664,-1279.3868 937.5299,-1285.8603"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1210" cy="-1264.6022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1210" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 94&#45;96</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M860.0416,-1326.817C936.1086,-1313.294 1072.8066,-1288.9921 1150.9428,-1275.1012"/>
<polygon fill="#000000" stroke="#000000" points="1151.8693,-1278.4915 1161.1023,-1273.2951 1150.644,-1271.5995 1151.8693,-1278.4915"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1479" cy="-1264.6022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1479" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 97&#45;99</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M865.7037,-1330.1175C992.8256,-1316.5377 1285.9484,-1285.2249 1415.4808,-1271.3876"/>
<polygon fill="#000000" stroke="#000000" points="1416.0664,-1274.845 1425.638,-1270.3025 1415.3228,-1267.8846 1416.0664,-1274.845"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="1929" cy="-1264.6022" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="1929" y="-1260.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 100&#45;118</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M868.6516,-1332.5248C1062.9752,-1320.0771 1647.8916,-1282.6091 1855.1799,-1269.3308"/>
<polygon fill="#000000" stroke="#000000" points="1855.5958,-1272.8115 1865.3516,-1268.6793 1855.1483,-1265.8258 1855.5958,-1272.8115"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="234,-1201.5021 78,-1201.5021 78,-1165.5021 234,-1165.5021 234,-1201.5021"/>
<text text-anchor="middle" x="156" y="-1180.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> extended PEG module</text>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M353.5178,-1252.5482C317.7256,-1240.0364 260.9966,-1220.2057 217.4992,-1205.0003"/>
<polygon fill="#000000" stroke="#000000" points="218.4667,-1201.6309 207.8718,-1201.6349 216.1567,-1208.2388 218.4667,-1201.6309"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="325" cy="-1183.5021" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="325" y="-1179.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;77</text>
</g>
<!-- block_4&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M471.5869,-1250.2898C443.0637,-1237.2941 400.7111,-1217.9975 368.8547,-1203.4831"/>
<polygon fill="#000000" stroke="#000000" points="370.3022,-1200.2965 359.751,-1199.3353 367.3998,-1206.6665 370.3022,-1200.2965"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="470,-1201.5021 416,-1201.5021 416,-1165.5021 470,-1165.5021 470,-1201.5021"/>
</g>
<!-- block_4&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_4&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M489.9809,-1247.0047C481.9159,-1236.1035 471.4096,-1221.9024 462.378,-1209.6947"/>
<polygon fill="#000000" stroke="#000000" points="465.1704,-1207.5843 456.4091,-1201.6268 459.543,-1211.7476 465.1704,-1207.5843"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="665.5,-1201.5021 488.5,-1201.5021 488.5,-1165.5021 665.5,-1165.5021 665.5,-1201.5021"/>
<text text-anchor="middle" x="577" y="-1180.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> from the lpeg tutorial</text>
</g>
<!-- block_5&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M641.6099,-1247.4029C630.2131,-1236.1312 615.1241,-1221.2078 602.3943,-1208.6177"/>
<polygon fill="#000000" stroke="#000000" points="604.7887,-1206.0632 595.2175,-1201.5197 599.8664,-1211.0402 604.7887,-1206.0632"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="761" cy="-1183.5021" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="761" y="-1179.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 81&#45;88</text>
</g>
<!-- block_6&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_6&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M795.235,-1246.6034C789.4815,-1235.9987 782.091,-1222.3767 775.6502,-1210.505"/>
<polygon fill="#000000" stroke="#000000" points="778.5829,-1208.5712 770.7377,-1201.4505 772.4301,-1211.9093 778.5829,-1208.5712"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="910,-1201.5021 856,-1201.5021 856,-1165.5021 910,-1165.5021 910,-1201.5021"/>
</g>
<!-- block_6&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_6&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M821.5418,-1247.4029C832.2814,-1236.2365 846.4676,-1221.4864 858.5044,-1208.9713"/>
<polygon fill="#000000" stroke="#000000" points="861.2617,-1211.1534 865.6711,-1201.5197 856.2165,-1206.301 861.2617,-1211.1534"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1210,-1210.7026 928,-1210.7026 928,-1156.3016 1210,-1156.3016 1210,-1210.7026"/>
<text text-anchor="middle" x="1069" y="-1195.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> Match a pattern anywhere in a string.</text>
<text text-anchor="middle" x="1069" y="-1180.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1069" y="-1164.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> Taken from the lpeg tutorial</text>
</g>
<!-- block_7&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_7&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M998.8746,-1247.4029C1008.3271,-1238.7895 1020.1197,-1228.0436 1031.3215,-1217.8361"/>
<polygon fill="#000000" stroke="#000000" points="1033.9121,-1220.2107 1038.9462,-1210.8882 1029.1973,-1215.0366 1033.9121,-1220.2107"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1391.5,-1202.8027 1228.5,-1202.8027 1228.5,-1164.2015 1391.5,-1164.2015 1391.5,-1202.8027"/>
<text text-anchor="middle" x="1310" y="-1187.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #param</text>
<text text-anchor="middle" x="1310" y="-1172.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; p : lpeg pattern</text>
</g>
<!-- block_8&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_8&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1230.7201,-1247.7982C1244.4581,-1236.6566 1262.7495,-1221.8223 1278.3008,-1209.2101"/>
<polygon fill="#000000" stroke="#000000" points="1280.5826,-1211.866 1286.1448,-1202.8487 1276.1733,-1206.4292 1280.5826,-1211.866"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1824.5,-1202.8027 1409.5,-1202.8027 1409.5,-1164.2015 1824.5,-1164.2015 1824.5,-1202.8027"/>
<text text-anchor="middle" x="1617" y="-1187.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #returns</text>
<text text-anchor="middle" x="1617" y="-1172.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; the first and last index of the first match, or nil</text>
</g>
<!-- block_9&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>block_9&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1505.9354,-1248.7727C1525.6706,-1237.1747 1552.8299,-1221.2137 1575.3511,-1207.9784"/>
<polygon fill="#000000" stroke="#000000" points="1577.1982,-1210.9526 1584.0463,-1202.8684 1573.6515,-1204.9176 1577.1982,-1210.9526"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="1929" cy="-1183.5021" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="1929" y="-1179.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 100&#45;118</text>
</g>
<!-- block_10&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>block_10&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1929,-1246.1993C1929,-1236.0704 1929,-1223.282 1929,-1211.9008"/>
<polygon fill="#000000" stroke="#000000" points="1932.5001,-1211.5527 1929,-1201.5528 1925.5001,-1211.5528 1932.5001,-1211.5527"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2088,-1201.5021 2034,-1201.5021 2034,-1165.5021 2088,-1165.5021 2088,-1201.5021"/>
</g>
<!-- block_10&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_10&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1959.8784,-1248.5865C1979.0071,-1238.336 2003.8702,-1224.4105 2025,-1210.6022 2026.4407,-1209.6607 2027.8996,-1208.6808 2029.363,-1207.6762"/>
<polygon fill="#000000" stroke="#000000" points="2031.5788,-1210.3953 2037.6975,-1201.7459 2027.5204,-1204.6918 2031.5788,-1210.3953"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="548,-1120.6032 0,-1120.6032 0,.2011 548,.2011 548,-1120.6032"/>
<text text-anchor="middle" x="274" y="-1105.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="274" y="-1089.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="274" y="-1058.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makerange(first, second)</text>
<text text-anchor="middle" x="274" y="-1043.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patts = {}</text>
<text text-anchor="middle" x="274" y="-1027.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt &#160;= {}</text>
<text text-anchor="middle" x="274" y="-1012.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (second) then</text>
<text text-anchor="middle" x="274" y="-996.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if (string.len(first) == string.len(second)) then</text>
<text text-anchor="middle" x="274" y="-981.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, string.len(first) do</text>
<text text-anchor="middle" x="274" y="-966.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patts[i] = lpeg.R(string.sub(first,i,i)..string.sub(second,i,i))</text>
<text text-anchor="middle" x="274" y="-950.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-935.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patts[1]</text>
<text text-anchor="middle" x="274" y="-919.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 2, string.len(first) do</text>
<text text-anchor="middle" x="274" y="-904.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt + patts[i]</text>
<text text-anchor="middle" x="274" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return patt</text>
<text text-anchor="middle" x="274" y="-858.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="274" y="-842.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(&quot;Ranges must be of equal byte width&quot;)</text>
<text text-anchor="middle" x="274" y="-827.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return {}</text>
<text text-anchor="middle" x="274" y="-812.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-796.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else </text>
<text text-anchor="middle" x="274" y="-781.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return lpeg.R(first)</text>
<text text-anchor="middle" x="274" y="-765.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-750.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-703.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="274" y="-687.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="274" y="-672.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="274" y="-656.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="274" y="-641.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="274" y="-626.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="274" y="-610.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="274" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="274" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="274" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="274" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="274" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Su (str)</text>
<text text-anchor="middle" x="274" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="274" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;convert a &#39;set&#39; pattern to uniquely match the characters </text>
<text text-anchor="middle" x="274" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;in the range.</text>
<text text-anchor="middle" x="274" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local catch = {}</text>
<text text-anchor="middle" x="274" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 0</text>
<text text-anchor="middle" x="274" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #str do</text>
<text text-anchor="middle" x="274" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;catch[i]</text>
<text text-anchor="middle" x="274" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-348.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="274" y="-332.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="274" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="274" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="274" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="274" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="274" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="274" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="274" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="274" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="274" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="274" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Csp (patt)</text>
<text text-anchor="middle" x="274" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="274" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="274" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="274" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="274" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="274" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M323.5013,-1165.1854C322.7827,-1156.4037 321.8266,-1144.7185 320.6787,-1130.689"/>
<polygon fill="#000000" stroke="#000000" points="324.1578,-1130.2899 319.8539,-1120.6087 317.1812,-1130.8608 324.1578,-1130.2899"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1058,-610.602 566,-610.602 566,-509.8 1058,-509.8 1058,-610.602"/>
<text text-anchor="middle" x="812" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function split (s, sep)</text>
<text text-anchor="middle" x="812" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;sep = lpeg.P(sep)</text>
<text text-anchor="middle" x="812" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local elem = lpeg.C((1 &#45; sep)^0)</text>
<text text-anchor="middle" x="812" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local p = lpeg.Ct(elem * (sep * elem)^0) &#160;&#160;&#45;&#45; make a table capture</text>
<text text-anchor="middle" x="812" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return lpeg.match(p, s)</text>
<text text-anchor="middle" x="812" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M762.4987,-1165.1854C769.1133,-1084.3442 795.8603,-757.4534 807.0453,-620.7559"/>
<polygon fill="#000000" stroke="#000000" points="810.5599,-620.7192 807.8871,-610.4671 803.5832,-620.1483 810.5599,-620.7192"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2101.5,-697.1017 1756.5,-697.1017 1756.5,-423.3004 2101.5,-423.3004 2101.5,-697.1017"/>
<text text-anchor="middle" x="1929" y="-681.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local I = lpeg.Cp()</text>
<text text-anchor="middle" x="1929" y="-650.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function &#160;anyP(p)</text>
<text text-anchor="middle" x="1929" y="-634.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;return lpeg.P{ I * p * I + 1 * lpeg.V(1) }</text>
<text text-anchor="middle" x="1929" y="-619.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1929" y="-556.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ru = makerange</text>
<text text-anchor="middle" x="1929" y="-508.701" font-family="Inconsolata" font-size="14.00" fill="#000000">return { R = Ru,</text>
<text text-anchor="middle" x="1929" y="-493.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;Csp = Csp,</text>
<text text-anchor="middle" x="1929" y="-477.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;anyP = anyP,</text>
<text text-anchor="middle" x="1929" y="-462.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;match = lpeg.match,</text>
<text text-anchor="middle" x="1929" y="-447.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;split = split,</text>
<text text-anchor="middle" x="1929" y="-431.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;spanner = spanner }</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1929,-1165.1854C1929,-1098.4332 1929,-863.9208 1929,-707.2478"/>
<polygon fill="#000000" stroke="#000000" points="1932.5001,-707.0432 1929,-697.0432 1925.5001,-707.0432 1932.5001,-707.0432"/>
</g>
</g>
</svg>