<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2714pt" height="1416pt"
 viewBox="0.00 0.00 2713.50 1416.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1412.4021)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1412.4021 2709.5,-1412.4021 2709.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1229" cy="-1390.4021" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="1229" y="-1386.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 118</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1229" cy="-1318.4021" rx="65.0143" ry="18"/>
<text text-anchor="middle" x="1229" y="-1314.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;118</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1229,-1372.2334C1229,-1364.533 1229,-1355.3764 1229,-1346.8187"/>
<polygon fill="#000000" stroke="#000000" points="1232.5001,-1346.8153 1229,-1336.8153 1225.5001,-1346.8154 1232.5001,-1346.8153"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="768" cy="-1246.4021" rx="27" ry="18"/>
<text text-anchor="middle" x="768" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1166.7089,-1313.082C1065.5943,-1304.0112 870.361,-1284.568 804,-1264.4021 802.0945,-1263.823 800.1672,-1263.1498 798.2464,-1262.4106"/>
<polygon fill="#000000" stroke="#000000" points="799.3938,-1259.0925 788.8291,-1258.2946 796.5904,-1265.5066 799.3938,-1259.0925"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="859" cy="-1246.4021" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="859" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1169.8303,-1310.8972C1106.1207,-1302.2051 1002.0524,-1286.2332 914,-1264.4021 910.4254,-1263.5158 906.7468,-1262.5143 903.0673,-1261.4487"/>
<polygon fill="#000000" stroke="#000000" points="903.9816,-1258.0686 893.3961,-1258.5135 901.9487,-1264.7669 903.9816,-1258.0686"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="974" cy="-1246.4021" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="974" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 4&#45;78</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1182.4297,-1305.8052C1142.8747,-1295.0343 1084.6286,-1279.0047 1034,-1264.4021 1030.2284,-1263.3142 1026.3277,-1262.1754 1022.4091,-1261.0214"/>
<polygon fill="#000000" stroke="#000000" points="1023.2778,-1257.6285 1012.6954,-1258.1426 1021.2887,-1264.3399 1023.2778,-1257.6285"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1099" cy="-1246.4021" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1099" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 79&#45;80</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1199.8255,-1302.2439C1180.9993,-1291.8171 1156.3423,-1278.1609 1136.1244,-1266.9632"/>
<polygon fill="#000000" stroke="#000000" points="1137.628,-1263.7951 1127.1843,-1262.0118 1134.2364,-1269.9186 1137.628,-1263.7951"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1229" cy="-1246.4021" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1229" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 81&#45;89</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1229,-1300.2334C1229,-1292.533 1229,-1283.3764 1229,-1274.8187"/>
<polygon fill="#000000" stroke="#000000" points="1232.5001,-1274.8153 1229,-1264.8153 1225.5001,-1274.8154 1232.5001,-1274.8153"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1484" cy="-1246.4021" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1484" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 90&#45;93</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1274.5889,-1305.5299C1318.7652,-1293.0566 1385.6923,-1274.1595 1431.9399,-1261.1014"/>
<polygon fill="#000000" stroke="#000000" points="1433.0964,-1264.4118 1441.769,-1258.3261 1431.1942,-1257.6752 1433.0964,-1264.4118"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1677" cy="-1246.4021" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1677" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 94&#45;96</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1285.2859,-1309.3561C1370.0571,-1295.7322 1529.8116,-1270.0573 1616.817,-1256.0743"/>
<polygon fill="#000000" stroke="#000000" points="1617.4825,-1259.5124 1626.8004,-1254.4699 1616.3717,-1252.6011 1617.4825,-1259.5124"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1994" cy="-1246.4021" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1994" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 97&#45;99</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1290.6322,-1312.6014C1433.3431,-1299.1698 1785.3275,-1266.0418 1930.165,-1252.4101"/>
<polygon fill="#000000" stroke="#000000" points="1930.6016,-1255.8845 1940.2296,-1251.4628 1929.9456,-1248.9153 1930.6016,-1255.8845"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="2356" cy="-1246.4021" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="2356" y="-1242.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 100&#45;118</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1292.4138,-1314.3508C1486.9338,-1301.9236 2074.5363,-1264.3838 2282.2696,-1251.1124"/>
<polygon fill="#000000" stroke="#000000" points="2282.7054,-1254.5918 2292.4619,-1250.4613 2282.2591,-1247.6061 2282.7054,-1254.5918"/>
</g>
<!-- prose_11 -->
<g id="node12" class="node">
<title>prose_11</title>
<ellipse fill="none" stroke="#000000" cx="331" cy="-1174.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="331" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_3&#45;&gt;prose_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;prose_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M824.9693,-1234.0795C818.0966,-1231.928 810.871,-1229.9024 804,-1228.4021 793.4779,-1226.1045 486.3641,-1191.7323 372.7374,-1179.0537"/>
<polygon fill="#000000" stroke="#000000" points="373.0027,-1175.5617 362.6762,-1177.9314 372.2265,-1182.5185 373.0027,-1175.5617"/>
</g>
<!-- codeblock_13 -->
<g id="node14" class="node">
<title>codeblock_13</title>
<ellipse fill="none" stroke="#000000" cx="577" cy="-1174.4021" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="577" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;77</text>
</g>
<!-- block_4&#45;&gt;codeblock_13 -->
<g id="edge13" class="edge">
<title>block_4&#45;&gt;codeblock_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M936.114,-1234.2089C928.8209,-1232.0972 921.2085,-1230.0532 914,-1228.4021 825.1389,-1208.0479 721.3676,-1192.6549 652.7028,-1183.6116"/>
<polygon fill="#000000" stroke="#000000" points="652.7812,-1180.0922 642.4124,-1182.2692 651.8757,-1187.0334 652.7812,-1180.0922"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="940" cy="-1174.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="940" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_5&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1066.4403,-1231.658C1039.6205,-1219.5132 1001.6963,-1202.34 974.3875,-1189.9738"/>
<polygon fill="#000000" stroke="#000000" points="975.7597,-1186.7531 965.2064,-1185.8163 972.8721,-1193.1297 975.7597,-1186.7531"/>
</g>
<!-- codeblock_17 -->
<g id="node18" class="node">
<title>codeblock_17</title>
<ellipse fill="none" stroke="#000000" cx="1198" cy="-1174.4021" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1198" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 81&#45;88</text>
</g>
<!-- block_6&#45;&gt;codeblock_17 -->
<g id="edge17" class="edge">
<title>block_6&#45;&gt;codeblock_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1221.1774,-1228.2334C1217.6999,-1220.1568 1213.5328,-1210.4782 1209.6968,-1201.5689"/>
<polygon fill="#000000" stroke="#000000" points="1212.8821,-1200.1162 1205.7127,-1192.3155 1206.4527,-1202.8844 1212.8821,-1200.1162"/>
</g>
<!-- prose_19 -->
<g id="node20" class="node">
<title>prose_19</title>
<ellipse fill="none" stroke="#000000" cx="1579" cy="-1174.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1579" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_7&#45;&gt;prose_19 -->
<g id="edge19" class="edge">
<title>block_7&#45;&gt;prose_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1506.0337,-1229.7028C1519.5963,-1219.4238 1537.0917,-1206.1641 1551.551,-1195.2055"/>
<polygon fill="#000000" stroke="#000000" points="1553.8052,-1197.8888 1559.6608,-1189.0591 1549.577,-1192.3099 1553.8052,-1197.8888"/>
</g>
<!-- prose_21 -->
<g id="node22" class="node">
<title>prose_21</title>
<ellipse fill="none" stroke="#000000" cx="1685" cy="-1174.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1685" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_8&#45;&gt;prose_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;prose_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1679.0187,-1228.2334C1679.8743,-1220.533 1680.8917,-1211.3764 1681.8426,-1202.8187"/>
<polygon fill="#000000" stroke="#000000" points="1685.3283,-1203.1407 1682.9541,-1192.8153 1678.3711,-1202.3676 1685.3283,-1203.1407"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="2064" cy="-1174.4021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2064" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- block_9&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>block_9&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2010.945,-1228.9729C2019.9732,-1219.6868 2031.2084,-1208.1305 2041.0125,-1198.0463"/>
<polygon fill="#000000" stroke="#000000" points="2043.7093,-1200.2935 2048.1706,-1190.6837 2038.6903,-1195.4139 2043.7093,-1200.2935"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="2444" cy="-1174.4021" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="2444" y="-1170.2021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 100&#45;118</text>
</g>
<!-- block_10&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>block_10&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2376.8548,-1229.3391C2388.1119,-1220.1287 2402.1946,-1208.6065 2414.5518,-1198.4961"/>
<polygon fill="#000000" stroke="#000000" points="2416.8527,-1201.1358 2422.3759,-1192.0945 2412.42,-1195.718 2416.8527,-1201.1358"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="156,-578.201 0,-578.201 0,-542.201 156,-542.201 156,-578.201"/>
<text text-anchor="middle" x="78" y="-556.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> extended PEG module</text>
</g>
<!-- prose_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M300.4701,-1168.4417C257.5649,-1159.431 182.6791,-1141.1721 165,-1120.4021 28.9073,-960.5158 59.2165,-678.0906 73.1021,-588.3798"/>
<polygon fill="#000000" stroke="#000000" points="76.5722,-588.8444 74.7018,-578.416 69.6608,-587.7347 76.5722,-588.8444"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="722,-1120.6032 174,-1120.6032 174,.2011 722,.2011 722,-1120.6032"/>
<text text-anchor="middle" x="448" y="-1105.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="448" y="-1089.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="448" y="-1058.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makerange(first, second)</text>
<text text-anchor="middle" x="448" y="-1043.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patts = {}</text>
<text text-anchor="middle" x="448" y="-1027.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt &#160;= {}</text>
<text text-anchor="middle" x="448" y="-1012.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (second) then</text>
<text text-anchor="middle" x="448" y="-996.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if (string.len(first) == string.len(second)) then</text>
<text text-anchor="middle" x="448" y="-981.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, string.len(first) do</text>
<text text-anchor="middle" x="448" y="-966.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patts[i] = lpeg.R(string.sub(first,i,i)..string.sub(second,i,i))</text>
<text text-anchor="middle" x="448" y="-950.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-935.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patts[1]</text>
<text text-anchor="middle" x="448" y="-919.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 2, string.len(first) do</text>
<text text-anchor="middle" x="448" y="-904.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt + patts[i]</text>
<text text-anchor="middle" x="448" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return patt</text>
<text text-anchor="middle" x="448" y="-858.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="448" y="-842.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(&quot;Ranges must be of equal byte width&quot;)</text>
<text text-anchor="middle" x="448" y="-827.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return {}</text>
<text text-anchor="middle" x="448" y="-812.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-796.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else </text>
<text text-anchor="middle" x="448" y="-781.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return lpeg.R(first)</text>
<text text-anchor="middle" x="448" y="-765.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-750.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="448" y="-703.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="448" y="-687.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="448" y="-672.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="448" y="-656.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="448" y="-641.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="448" y="-626.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="448" y="-610.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="448" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="448" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="448" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="448" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="448" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="448" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Su (str)</text>
<text text-anchor="middle" x="448" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="448" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;convert a &#39;set&#39; pattern to uniquely match the characters </text>
<text text-anchor="middle" x="448" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;in the range.</text>
<text text-anchor="middle" x="448" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local catch = {}</text>
<text text-anchor="middle" x="448" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 0</text>
<text text-anchor="middle" x="448" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #str do</text>
<text text-anchor="middle" x="448" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;catch[i]</text>
<text text-anchor="middle" x="448" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-348.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="448" y="-332.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="448" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="448" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="448" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="448" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="448" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="448" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="448" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="448" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="448" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="448" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="448" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="448" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="448" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Csp (patt)</text>
<text text-anchor="middle" x="448" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="448" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="448" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="448" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="448" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="448" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_13&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>codeblock_13&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M573.2091,-1156.3528C571.7594,-1149.4501 569.9273,-1140.727 567.7715,-1130.463"/>
<polygon fill="#000000" stroke="#000000" points="571.1833,-1129.6789 565.7025,-1120.6118 564.3328,-1131.1178 571.1833,-1129.6789"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="917.5,-578.201 740.5,-578.201 740.5,-542.201 917.5,-542.201 917.5,-578.201"/>
<text text-anchor="middle" x="829" y="-556.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> from the lpeg tutorial</text>
</g>
<!-- prose_15&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>prose_15&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M935.3819,-1156.4659C932.7592,-1145.9872 929.5092,-1132.4872 927,-1120.4021 884.9322,-917.7865 846.059,-671.4426 833.347,-588.7825"/>
<polygon fill="#000000" stroke="#000000" points="836.7698,-588.0116 831.795,-578.6574 829.8506,-589.0722 836.7698,-588.0116"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1428,-610.602 936,-610.602 936,-509.8 1428,-509.8 1428,-610.602"/>
<text text-anchor="middle" x="1182" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function split (s, sep)</text>
<text text-anchor="middle" x="1182" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;sep = lpeg.P(sep)</text>
<text text-anchor="middle" x="1182" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local elem = lpeg.C((1 &#45; sep)^0)</text>
<text text-anchor="middle" x="1182" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local p = lpeg.Ct(elem * (sep * elem)^0) &#160;&#160;&#45;&#45; make a table capture</text>
<text text-anchor="middle" x="1182" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return lpeg.match(p, s)</text>
<text text-anchor="middle" x="1182" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>codeblock_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1197.5298,-1156.3528C1195.4597,-1076.885 1187.1041,-756.134 1183.58,-620.8547"/>
<polygon fill="#000000" stroke="#000000" points="1187.074,-620.5724 1183.3146,-610.667 1180.0763,-620.7548 1187.074,-620.5724"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1728,-587.4015 1446,-587.4015 1446,-533.0006 1728,-533.0006 1728,-587.4015"/>
<text text-anchor="middle" x="1587" y="-572.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> Match a pattern anywhere in a string.</text>
<text text-anchor="middle" x="1587" y="-556.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1587" y="-541.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> Taken from the lpeg tutorial</text>
</g>
<!-- prose_19&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_19&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1579.2351,-1156.3528C1580.3351,-1071.9029 1584.9842,-714.968 1586.5115,-597.7037"/>
<polygon fill="#000000" stroke="#000000" points="1590.0146,-597.4824 1586.6452,-587.4376 1583.0152,-597.3911 1590.0146,-597.4824"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="1909.5,-579.5016 1746.5,-579.5016 1746.5,-540.9005 1909.5,-540.9005 1909.5,-579.5016"/>
<text text-anchor="middle" x="1828" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #param</text>
<text text-anchor="middle" x="1828" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; p : lpeg pattern</text>
</g>
<!-- prose_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>prose_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1704.1147,-1159.705C1715.5236,-1149.8541 1729.2566,-1135.8835 1737,-1120.4021 1829.6748,-935.1156 1831.5039,-676.2965 1829.1987,-589.7194"/>
<polygon fill="#000000" stroke="#000000" points="1832.6926,-589.463 1828.887,-579.5752 1825.6959,-589.678 1832.6926,-589.463"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2342.5,-579.5016 1927.5,-579.5016 1927.5,-540.9005 2342.5,-540.9005 2342.5,-579.5016"/>
<text text-anchor="middle" x="2135" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #returns</text>
<text text-anchor="middle" x="2135" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; the first and last index of the first match, or nil</text>
</g>
<!-- prose_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>prose_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2066.0864,-1156.3528C2076.0738,-1069.955 2119.0295,-698.357 2131.5578,-589.9781"/>
<polygon fill="#000000" stroke="#000000" points="2135.0668,-590.1012 2132.7384,-579.7654 2128.1131,-589.2973 2135.0668,-590.1012"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2705.5,-697.1017 2360.5,-697.1017 2360.5,-423.3004 2705.5,-423.3004 2705.5,-697.1017"/>
<text text-anchor="middle" x="2533" y="-681.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local I = lpeg.Cp()</text>
<text text-anchor="middle" x="2533" y="-650.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function &#160;anyP(p)</text>
<text text-anchor="middle" x="2533" y="-634.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;return lpeg.P{ I * p * I + 1 * lpeg.V(1) }</text>
<text text-anchor="middle" x="2533" y="-619.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2533" y="-556.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ru = makerange</text>
<text text-anchor="middle" x="2533" y="-508.701" font-family="Inconsolata" font-size="14.00" fill="#000000">return { R = Ru,</text>
<text text-anchor="middle" x="2533" y="-493.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;Csp = Csp,</text>
<text text-anchor="middle" x="2533" y="-477.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;anyP = anyP,</text>
<text text-anchor="middle" x="2533" y="-462.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;match = lpeg.match,</text>
<text text-anchor="middle" x="2533" y="-447.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;split = split,</text>
<text text-anchor="middle" x="2533" y="-431.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;spanner = spanner }</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_25&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2446.6154,-1156.3528C2456.1047,-1090.866 2489.3368,-861.5269 2511.7061,-707.1533"/>
<polygon fill="#000000" stroke="#000000" points="2515.1931,-707.4945 2513.1634,-697.0959 2508.2655,-706.4906 2515.1931,-707.4945"/>
</g>
</g>
</svg>