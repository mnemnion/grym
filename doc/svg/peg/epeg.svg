<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1953pt" height="1451pt"
 viewBox="0.00 0.00 1952.50 1450.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1446.6022)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1446.6022 1948.5,-1446.6022 1948.5,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="749" cy="-1424.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="749" y="-1420.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">18 &#160;</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="749" cy="-1352.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="749" y="-1348.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">18 &#160;</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M749,-1406.4335C749,-1398.7331 749,-1389.5765 749,-1381.0188"/>
<polygon fill="#000000" stroke="#000000" points="752.5001,-1381.0154 749,-1371.0154 745.5001,-1381.0155 752.5001,-1381.0154"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="368" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="368" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">: &#160;&#160;</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M721.9518,-1351.1998C662.9161,-1347.5318 518.6246,-1335.2507 404,-1298.6022 402.1031,-1297.9957 400.1824,-1297.3011 398.2666,-1296.5456"/>
<polygon fill="#000000" stroke="#000000" points="399.4241,-1293.2305 388.8629,-1292.3861 396.5924,-1299.6322 399.4241,-1293.2305"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="440" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="440" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">&#45;3 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M722.0253,-1349.7004C672.3076,-1343.8228 563.3168,-1328.4581 476,-1298.6022 474.1156,-1297.9578 472.2046,-1297.2339 470.2963,-1296.456"/>
<polygon fill="#000000" stroke="#000000" points="471.4682,-1293.1455 460.9124,-1292.2365 468.5974,-1299.5297 471.4682,-1293.1455"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="512" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="512" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">78 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M724.0848,-1345.033C681.4787,-1332.0894 594.5582,-1305.6831 546.2695,-1291.0131"/>
<polygon fill="#000000" stroke="#000000" points="547.167,-1287.6279 536.5814,-1288.0699 545.1322,-1294.3257 547.167,-1287.6279"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="646" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="646" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">80 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M730.1082,-1339.3962C714.1371,-1328.232 691.0584,-1312.0993 673.1146,-1299.5561"/>
<polygon fill="#000000" stroke="#000000" points="674.9734,-1296.585 664.772,-1293.7243 670.9628,-1302.3223 674.9734,-1296.585"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="749" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="749" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">89 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M749,-1334.4335C749,-1326.7331 749,-1317.5765 749,-1309.0188"/>
<polygon fill="#000000" stroke="#000000" points="752.5001,-1309.0154 749,-1299.0154 745.5001,-1309.0155 752.5001,-1309.0154"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="878" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="878" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">93 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M769.7261,-1341.0341C790.8521,-1329.2428 823.8408,-1310.8305 847.8562,-1297.4266"/>
<polygon fill="#000000" stroke="#000000" points="849.8706,-1300.3106 856.8968,-1292.3807 846.459,-1294.1982 849.8706,-1300.3106"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1081" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="1081" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">96 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M774.7752,-1347.0123C833.4895,-1334.2791 977.3095,-1303.0893 1044.8518,-1288.4415"/>
<polygon fill="#000000" stroke="#000000" points="1045.9813,-1291.778 1055.0123,-1286.238 1044.4977,-1284.937 1045.9813,-1291.778"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1336" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="1336" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">99 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M775.7475,-1349.3214C870.4933,-1337.7001 1190.2779,-1298.4761 1299.2617,-1285.1084"/>
<polygon fill="#000000" stroke="#000000" points="1299.9323,-1288.5525 1309.4318,-1283.8609 1299.08,-1281.6045 1299.9323,-1288.5525"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="1772" cy="-1280.6022" rx="27" ry="18"/>
<text text-anchor="middle" x="1772" y="-1276.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">18 &#160;</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M776.0993,-1350.6949C917.6319,-1340.7336 1571.6383,-1294.7039 1734.9621,-1283.2089"/>
<polygon fill="#000000" stroke="#000000" points="1735.2702,-1286.696 1744.9998,-1282.5025 1734.7787,-1279.7133 1735.2702,-1286.696"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="328,-1211.4042 172,-1211.4042 172,-1171.6 328,-1171.6 328,-1211.4042"/>
<text text-anchor="middle" x="250" y="-1196.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> extended PEG module</text>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M418.3517,-1269.6416C413.6346,-1267.2916 408.6604,-1264.8424 404,-1262.6022 370.5912,-1246.5425 332.8036,-1229.0859 303.0209,-1215.4889"/>
<polygon fill="#000000" stroke="#000000" points="304.1991,-1212.1796 293.6481,-1211.2166 301.2957,-1218.5491 304.1991,-1212.1796"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="373" cy="-1191.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="373" y="-1187.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">77 &#160;</text>
</g>
<!-- block_4&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M490.2172,-1269.6065C462.1772,-1255.3869 416.1898,-1231.8203 409,-1226.6022 404.0217,-1222.9891 399.0563,-1218.7055 394.4739,-1214.3943"/>
<polygon fill="#000000" stroke="#000000" points="396.772,-1211.7453 387.1891,-1207.2264 391.8624,-1216.7349 396.772,-1211.7453"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="472,-1209.5021 418,-1209.5021 418,-1173.5021 472,-1173.5021 472,-1209.5021"/>
</g>
<!-- block_4&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_4&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M499.7112,-1264.2598C489.9845,-1251.3248 476.2051,-1233.0003 464.9086,-1217.9776"/>
<polygon fill="#000000" stroke="#000000" points="467.4012,-1215.4687 458.5938,-1209.5798 461.8065,-1219.6758 467.4012,-1215.4687"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="667.5,-1211.4042 490.5,-1211.4042 490.5,-1171.6 667.5,-1171.6 667.5,-1211.4042"/>
<text text-anchor="middle" x="579" y="-1196.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> from the lpeg tutorial</text>
</g>
<!-- block_5&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_5&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M633.7112,-1264.2598C624.3635,-1251.8288 611.2727,-1234.42 600.2399,-1219.7481"/>
<polygon fill="#000000" stroke="#000000" points="602.8331,-1217.373 594.0257,-1211.484 597.2384,-1221.58 602.8331,-1217.373"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="713" cy="-1191.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="713" y="-1187.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">88 &#160;</text>
</g>
<!-- block_6&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_6&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M741.8876,-1262.9989C736.7596,-1250.3072 729.7433,-1232.9419 723.9097,-1218.5036"/>
<polygon fill="#000000" stroke="#000000" points="727.089,-1217.0295 720.0977,-1209.0688 720.5988,-1219.6518 727.089,-1217.0295"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="812,-1209.5021 758,-1209.5021 758,-1173.5021 812,-1173.5021 812,-1209.5021"/>
</g>
<!-- block_6&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_6&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M756.1124,-1262.9989C761.1738,-1250.4721 768.0747,-1233.3922 773.8624,-1219.0676"/>
<polygon fill="#000000" stroke="#000000" points="777.1541,-1220.2635 777.6552,-1209.6806 770.6638,-1217.6412 777.1541,-1220.2635"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1112,-1226.7025 830,-1226.7025 830,-1156.3017 1112,-1156.3017 1112,-1226.7025"/>
<text text-anchor="middle" x="971" y="-1211.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> Match a pattern anywhere in a string.</text>
<text text-anchor="middle" x="971" y="-1196.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="971" y="-1180.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> Taken from the lpeg tutorial</text>
</g>
<!-- block_7&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_7&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M893.7762,-1265.4875C902.9602,-1256.6887 915.0383,-1245.117 926.9069,-1233.7462"/>
<polygon fill="#000000" stroke="#000000" points="929.4423,-1236.1642 934.2419,-1226.7188 924.5996,-1231.1096 929.4423,-1236.1642"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1293.5,-1218.8025 1130.5,-1218.8025 1130.5,-1164.2017 1293.5,-1164.2017 1293.5,-1218.8025"/>
<text text-anchor="middle" x="1212" y="-1203.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #param</text>
<text text-anchor="middle" x="1212" y="-1188.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; p : lpeg pattern</text>
</g>
<!-- block_8&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_8&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1100.0485,-1267.6462C1116.6603,-1256.3477 1141.4847,-1239.4633 1163.5392,-1224.4629"/>
<polygon fill="#000000" stroke="#000000" points="1165.533,-1227.3397 1171.8333,-1218.8216 1161.5962,-1221.5516 1165.533,-1227.3397"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1726.5,-1218.8025 1311.5,-1218.8025 1311.5,-1164.2017 1726.5,-1164.2017 1726.5,-1218.8025"/>
<text text-anchor="middle" x="1519" y="-1203.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #returns</text>
<text text-anchor="middle" x="1519" y="-1188.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; the first and last index of the first match, or nil</text>
</g>
<!-- block_9&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>block_9&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1358.0741,-1269.8546C1381.6223,-1258.3893 1420.0531,-1239.6779 1453.4538,-1223.4156"/>
<polygon fill="#000000" stroke="#000000" points="1455.2658,-1226.4262 1462.7246,-1218.9018 1452.2015,-1220.1326 1455.2658,-1226.4262"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="1772" cy="-1191.5021" rx="27" ry="18"/>
<text text-anchor="middle" x="1772" y="-1187.3021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">18 &#160;</text>
</g>
<!-- block_10&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>block_10&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1772,-1262.5714C1772,-1250.253 1772,-1233.6813 1772,-1219.639"/>
<polygon fill="#000000" stroke="#000000" points="1775.5001,-1219.506 1772,-1209.506 1768.5001,-1219.506 1775.5001,-1219.506"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1871,-1209.5021 1817,-1209.5021 1817,-1173.5021 1871,-1173.5021 1871,-1209.5021"/>
</g>
<!-- block_10&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_10&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1784.8722,-1264.6729C1795.3838,-1251.6647 1810.4575,-1233.011 1822.7541,-1217.7939"/>
<polygon fill="#000000" stroke="#000000" points="1825.6903,-1219.729 1829.2533,-1209.7512 1820.2457,-1215.3293 1825.6903,-1219.729"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="548,-1120.6032 0,-1120.6032 0,.2011 548,.2011 548,-1120.6032"/>
<text text-anchor="middle" x="274" y="-1105.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="274" y="-1089.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;peg/node&quot;</text>
<text text-anchor="middle" x="274" y="-1058.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makerange(first, second)</text>
<text text-anchor="middle" x="274" y="-1043.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patts = {}</text>
<text text-anchor="middle" x="274" y="-1027.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local patt &#160;= {}</text>
<text text-anchor="middle" x="274" y="-1012.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if (second) then</text>
<text text-anchor="middle" x="274" y="-996.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if (string.len(first) == string.len(second)) then</text>
<text text-anchor="middle" x="274" y="-981.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 1, string.len(first) do</text>
<text text-anchor="middle" x="274" y="-966.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patts[i] = lpeg.R(string.sub(first,i,i)..string.sub(second,i,i))</text>
<text text-anchor="middle" x="274" y="-950.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-935.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patts[1]</text>
<text text-anchor="middle" x="274" y="-919.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for i = 2, string.len(first) do</text>
<text text-anchor="middle" x="274" y="-904.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;patt = patt + patts[i]</text>
<text text-anchor="middle" x="274" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-873.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return patt</text>
<text text-anchor="middle" x="274" y="-858.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="274" y="-842.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;error(&quot;Ranges must be of equal byte width&quot;)</text>
<text text-anchor="middle" x="274" y="-827.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return {}</text>
<text text-anchor="middle" x="274" y="-812.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-796.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else </text>
<text text-anchor="middle" x="274" y="-781.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return lpeg.R(first)</text>
<text text-anchor="middle" x="274" y="-765.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-750.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-703.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="274" y="-687.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="274" y="-672.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="274" y="-656.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="274" y="-641.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="274" y="-626.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="274" y="-610.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="274" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="274" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="274" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="274" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="274" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-486.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Su (str)</text>
<text text-anchor="middle" x="274" y="-471.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;[[</text>
<text text-anchor="middle" x="274" y="-456.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;convert a &#39;set&#39; pattern to uniquely match the characters </text>
<text text-anchor="middle" x="274" y="-440.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;in the range.</text>
<text text-anchor="middle" x="274" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local catch = {}</text>
<text text-anchor="middle" x="274" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local i = 0</text>
<text text-anchor="middle" x="274" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for i = 1, #str do</text>
<text text-anchor="middle" x="274" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;catch[i]</text>
<text text-anchor="middle" x="274" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-348.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="274" y="-332.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="274" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="274" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="274" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="274" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="274" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="274" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="274" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="274" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="274" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="274" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="274" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="274" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function Csp (patt)</text>
<text text-anchor="middle" x="274" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="274" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="274" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="274" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="274" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="274" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M370.1439,-1173.2893C368.5122,-1162.8841 366.2369,-1148.3755 363.4641,-1130.6936"/>
<polygon fill="#000000" stroke="#000000" points="366.8804,-1129.8867 361.8733,-1120.5497 359.9649,-1130.9712 366.8804,-1129.8867"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1058,-610.602 566,-610.602 566,-509.8 1058,-509.8 1058,-610.602"/>
<text text-anchor="middle" x="812" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function split (s, sep)</text>
<text text-anchor="middle" x="812" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;sep = lpeg.P(sep)</text>
<text text-anchor="middle" x="812" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local elem = lpeg.C((1 &#45; sep)^0)</text>
<text text-anchor="middle" x="812" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local p = lpeg.Ct(elem * (sep * elem)^0) &#160;&#160;&#45;&#45; make a table capture</text>
<text text-anchor="middle" x="812" y="-533.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return lpeg.match(p, s)</text>
<text text-anchor="middle" x="812" y="-518.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M715.8561,-1173.2893C728.6299,-1091.8337 780.8397,-758.9036 802.5067,-620.7377"/>
<polygon fill="#000000" stroke="#000000" points="805.9833,-621.1593 804.0749,-610.7378 799.0678,-620.0748 805.9833,-621.1593"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1944.5,-697.1017 1599.5,-697.1017 1599.5,-423.3004 1944.5,-423.3004 1944.5,-697.1017"/>
<text text-anchor="middle" x="1772" y="-681.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local I = lpeg.Cp()</text>
<text text-anchor="middle" x="1772" y="-650.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function &#160;anyP(p)</text>
<text text-anchor="middle" x="1772" y="-634.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;return lpeg.P{ I * p * I + 1 * lpeg.V(1) }</text>
<text text-anchor="middle" x="1772" y="-619.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1772" y="-556.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ru = makerange</text>
<text text-anchor="middle" x="1772" y="-508.701" font-family="Inconsolata" font-size="14.00" fill="#000000">return { R = Ru,</text>
<text text-anchor="middle" x="1772" y="-493.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;Csp = Csp,</text>
<text text-anchor="middle" x="1772" y="-477.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;anyP = anyP,</text>
<text text-anchor="middle" x="1772" y="-462.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;match = lpeg.match,</text>
<text text-anchor="middle" x="1772" y="-447.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;split = split,</text>
<text text-anchor="middle" x="1772" y="-431.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;spanner = spanner }</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1772,-1173.2893C1772,-1105.8817 1772,-866.2594 1772,-707.3124"/>
<polygon fill="#000000" stroke="#000000" points="1775.5001,-706.9621 1772,-696.9622 1768.5001,-706.9622 1775.5001,-706.9621"/>
</g>
</g>
</svg>