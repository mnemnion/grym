<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3713pt" height="3699pt"
 viewBox="0.00 0.00 3713.00 3699.21" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3695.2052)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-3695.2052 3709,-3695.2052 3709,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1694" cy="-3673.2052" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1694" y="-3669.0052" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 151</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1694" cy="-3601.2052" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1694" y="-3597.0052" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;151</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1694,-3655.0366C1694,-3647.3362 1694,-3638.1796 1694,-3629.6219"/>
<polygon fill="#000000" stroke="#000000" points="1697.5001,-3629.6185 1694,-3619.6185 1690.5001,-3629.6185 1697.5001,-3629.6185"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="159" cy="-2378.3034" rx="27" ry="18"/>
<text text-anchor="middle" x="159" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.4174,-3600.0535C1342.8117,-3594.8881 220.6403,-3572.9798 195,-3547.2052 -131.1838,-3219.3143 94.6305,-2549.4085 148.3396,-2405.7953"/>
<polygon fill="#000000" stroke="#000000" points="151.7743,-2406.6075 152.0371,-2396.0159 145.2267,-2404.1318 151.7743,-2406.6075"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="250" cy="-2378.3034" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="250" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.2637,-3599.8485C1355.8625,-3594.0775 328.7734,-3570.7854 305,-3547.2052 138.9723,-3382.5269 227.0719,-2568.7725 246.5072,-2406.4878"/>
<polygon fill="#000000" stroke="#000000" points="250.0073,-2406.697 247.7342,-2396.3489 243.058,-2405.856 250.0073,-2406.697"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="360" cy="-2378.3034" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="360" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 2&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.1379,-3599.9249C1405.3473,-3595.3171 691.685,-3578.1899 654,-3547.2052 285.7957,-3244.4669 340.0838,-2554.9501 356.5126,-2406.7109"/>
<polygon fill="#000000" stroke="#000000" points="360.0084,-2406.9464 357.6676,-2396.6134 353.0537,-2406.1508 360.0084,-2406.9464"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="713" cy="-2378.3034" rx="50.0142" ry="18"/>
<text text-anchor="middle" x="713" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;11</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1629.9803,-3596.9091C1513.9892,-3588.624 1278.2284,-3569.2927 1248,-3547.2052 837.5039,-3247.261 733.9382,-2555.5657 716.1022,-2406.8127"/>
<polygon fill="#000000" stroke="#000000" points="719.5554,-2406.2071 714.9208,-2396.6797 712.6025,-2407.0178 719.5554,-2406.2071"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1313" cy="-2378.3034" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1313" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 12&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.6634,-3589.8314C1601.5855,-3579.6902 1548.5298,-3563.9031 1534,-3547.2052 1226.4662,-3193.782 1290.4194,-2548.9118 1308.9786,-2406.5894"/>
<polygon fill="#000000" stroke="#000000" points="1312.471,-2406.8794 1310.3294,-2396.5033 1305.5329,-2405.9502 1312.471,-2406.8794"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1599" cy="-2378.3034" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1599" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;70</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1692.5833,-3582.9691C1681.923,-3445.7418 1614.3439,-2575.8205 1601.21,-2406.7523"/>
<polygon fill="#000000" stroke="#000000" points="1604.6889,-2406.3436 1600.4248,-2396.6448 1597.7099,-2406.8858 1604.6889,-2406.3436"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1789" cy="-2378.3034" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1789" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1695.4167,-3582.9691C1706.077,-3445.7418 1773.6561,-2575.8205 1786.79,-2406.7523"/>
<polygon fill="#000000" stroke="#000000" points="1790.2901,-2406.8858 1787.5752,-2396.6448 1783.3111,-2406.3436 1790.2901,-2406.8858"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="2095" cy="-2378.3034" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2095" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 74&#45;76</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1745.2675,-3589.7708C1786.3022,-3579.5916 1839.3332,-3563.7829 1854,-3547.2052 2165.445,-3195.1823 2114.1749,-2549.2308 2098.4543,-2406.6439"/>
<polygon fill="#000000" stroke="#000000" points="2101.9127,-2406.0793 2097.305,-2396.5389 2094.9575,-2406.8703 2101.9127,-2406.0793"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="2572" cy="-2378.3034" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2572" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 77&#45;140</text>
</g>
<!-- section_1&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1758.7264,-3597.4869C1879.375,-3590.0106 2129.2477,-3571.7519 2160,-3547.2052 2543.0845,-3241.4255 2570.629,-2554.28 2572.0488,-2406.6002"/>
<polygon fill="#000000" stroke="#000000" points="2575.549,-2406.5628 2572.1115,-2396.5411 2568.5492,-2406.5191 2575.549,-2406.5628"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="2797" cy="-2378.3034" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="2797" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 141&#45;142</text>
</g>
<!-- section_1&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.5674,-3599.7435C1968.9381,-3594.781 2609.6723,-3577.1969 2642,-3547.2052 2983.865,-3230.0434 2840.0506,-2551.7723 2804.2172,-2406.1859"/>
<polygon fill="#000000" stroke="#000000" points="2807.5595,-2405.1237 2801.7392,-2396.2707 2800.7684,-2406.821 2807.5595,-2405.1237"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="3031" cy="-2378.3034" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3031" y="-2374.1034" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 143&#45;151</text>
</g>
<!-- section_1&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.7696,-3600.4975C2001.7504,-3597.5982 2830.734,-3584.9382 2872,-3547.2052 3216.3035,-3232.3801 3073.7551,-2552.2871 3038.1711,-2406.2709"/>
<polygon fill="#000000" stroke="#000000" points="3041.5098,-2405.1925 3035.7099,-2396.3262 3034.7148,-2406.8742 3041.5098,-2405.1925"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="3705,-3547.1071 3115,-3547.1071 3115,-1209.4998 3705,-1209.4998 3705,-3547.1071"/>
<text text-anchor="middle" x="3410" y="-3532.0052" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-3516.6052" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
<text text-anchor="middle" x="3410" y="-3501.2052" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-3469.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> @module transform</text>
<text text-anchor="middle" x="3410" y="-3422.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> #TODO: </text>
<text text-anchor="middle" x="3410" y="-3391.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make header and footer configurable values of t</text>
<text text-anchor="middle" x="3410" y="-3375.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
<text text-anchor="middle" x="3410" y="-3344.205" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-3328.805" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="3410" y="-3297.405" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="3410" y="-3282.0049" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="3410" y="-3250.6049" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="3410" y="-3235.2049" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="3410" y="-3203.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="3410" y="-3172.4048" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="3410" y="-3141.0048" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="3410" y="-3125.6047" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="3410" y="-3094.2047" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="3410" y="-3078.8047" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="3410" y="-3047.4047" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="3410" y="-3032.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="3410" y="-3016.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="3410" y="-3001.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="3410" y="-2985.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="3410" y="-2970.4045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="3410" y="-2955.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3410" y="-2939.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2924.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2892.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2877.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="3410" y="-2862.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="3410" y="-2846.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2831.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2815.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="3410" y="-2800.4042" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2769.0042" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="3410" y="-2753.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2738.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="3410" y="-2722.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="3410" y="-2707.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2692.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="3410" y="-2676.604" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2645.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2629.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="3410" y="-2614.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="3410" y="-2599.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="3410" y="-2583.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="3410" y="-2568.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="3410" y="-2552.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2521.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="3410" y="-2506.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-2490.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-2459.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="3410" y="-2443.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
<text text-anchor="middle" x="3410" y="-2412.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="3410" y="-2397.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
<text text-anchor="middle" x="3410" y="-2365.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-2350.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="3410" y="-2334.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="3410" y="-2303.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="3410" y="-2288.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="3410" y="-2272.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2257.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-2241.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="3410" y="-2226.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="3410" y="-2195.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="3410" y="-2179.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="3410" y="-2164.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-2148.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="3410" y="-2133.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="3410" y="-2118.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="3410" y="-2102.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-2071.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="3410" y="-2055.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="3410" y="-2040.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="3410" y="-2025.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode then</text>
<text text-anchor="middle" x="3410" y="-2009.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="3410" y="-1994.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="3410" y="-1978.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1963.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1932.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="3410" y="-1900.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="3410" y="-1885.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1869.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1854.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1823.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="3410" y="-1807.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="3410" y="-1792.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1776.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1745.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="3410" y="-1730.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1714.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1683.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="3410" y="-1667.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="3410" y="-1652.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode or v.isnode then</text>
<text text-anchor="middle" x="3410" y="-1637.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="3410" y="-1621.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1606.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1574.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of leaf nodes</text>
<text text-anchor="middle" x="3410" y="-1559.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast[1] or not ast[1].isNode then</text>
<text text-anchor="middle" x="3410" y="-1544.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="3410" y="-1528.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(ast:toValue(), leaf_count)</text>
<text text-anchor="middle" x="3410" y="-1513.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="3410" y="-1497.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="3410" y="-1482.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1467.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3410" y="-1435.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="3410" y="-1420.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-1404.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3410" y="-1373.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
<text text-anchor="middle" x="3410" y="-1342.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3410" y="-1326.6018" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3410" y="-1311.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3410" y="-1279.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3410" y="-1264.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3410" y="-1233.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
<text text-anchor="middle" x="3410" y="-1217.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_1&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>section_1&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1759.7545,-3600.8554C2031.2163,-3599.1357 3052.9803,-3589.8433 3106,-3547.2052 3106.2777,-3546.982 3106.5551,-3546.7584 3106.8323,-3546.5347"/>
<polygon fill="#000000" stroke="#000000" points="3109.2992,-3549.0377 3114.8051,-3539.9859 3104.8561,-3543.6286 3109.2992,-3549.0377"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1171.4016 0,-1171.4016 0,-1135.4016 54,-1135.4016 54,-1171.4016"/>
</g>
<!-- block_3&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>block_3&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M251.9206,-2360.1845C265.6766,-2226.7175 344.4747,-1395.847 195,-1209.4016 158.8949,-1164.3663 123.1439,-1193.0531 63.8952,-1173.0403"/>
<polygon fill="#000000" stroke="#000000" points="64.7729,-1169.6312 54.1807,-1169.3915 62.3115,-1176.1842 64.7729,-1169.6312"/>
</g>
<!-- codeblock_14 -->
<g id="node15" class="node">
<title>codeblock_14</title>
<ellipse fill="none" stroke="#000000" cx="140" cy="-1153.4016" rx="67.748" ry="18"/>
<text text-anchor="middle" x="140" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- block_4&#45;&gt;codeblock_14 -->
<g id="edge14" class="edge">
<title>block_4&#45;&gt;codeblock_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M365.8765,-2360.1017C402.5229,-2242.8317 589.0895,-1586.7639 305,-1209.4016 298.1139,-1200.2546 241.6681,-1182.3417 196.6874,-1169.2297"/>
<polygon fill="#000000" stroke="#000000" points="197.574,-1165.8427 186.9953,-1166.4263 195.629,-1172.5671 197.574,-1165.8427"/>
</g>
<!-- structure_15 -->
<g id="node16" class="node">
<title>structure_15</title>
<ellipse fill="none" stroke="#000000" cx="270" cy="-1153.4016" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="270" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_4&#45;&gt;structure_15 -->
<g id="edge15" class="edge">
<title>block_4&#45;&gt;structure_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M362.4856,-2360.2133C376.9684,-2249.9191 445.0969,-1657.8316 305,-1209.4016 301.7179,-1198.896 295.9755,-1188.3946 290.0796,-1179.3716"/>
<polygon fill="#000000" stroke="#000000" points="292.7847,-1177.1299 284.2179,-1170.896 287.0274,-1181.1116 292.7847,-1177.1299"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="387,-1173.4016 333,-1173.4016 333,-1133.4016 387,-1133.4016 387,-1173.4016"/>
</g>
<!-- block_4&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_4&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M360,-2360.0375C360,-2223.0999 360,-1357.7498 360,-1183.8266"/>
<polygon fill="#000000" stroke="#000000" points="363.5001,-1183.6046 360,-1173.6046 356.5001,-1183.6046 363.5001,-1183.6046"/>
</g>
<!-- structure_21 -->
<g id="node22" class="node">
<title>structure_21</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-1153.4016" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="450" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_5&#45;&gt;structure_21 -->
<g id="edge21" class="edge">
<title>block_5&#45;&gt;structure_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M709.0781,-2360.0375C679.551,-2222.5172 492.2917,-1350.372 456.064,-1181.644"/>
<polygon fill="#000000" stroke="#000000" points="459.4659,-1180.8153 453.9445,-1171.7729 452.6219,-1182.2849 459.4659,-1180.8153"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="913.5,-1173.3037 512.5,-1173.3037 512.5,-1133.4995 913.5,-1133.4995 913.5,-1173.3037"/>
<text text-anchor="middle" x="713" y="-1141.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make header and footer configurable values of t</text>
</g>
<!-- block_5&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_5&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M713,-2360.0375C713,-2222.9542 713,-1355.9078 713,-1183.2739"/>
<polygon fill="#000000" stroke="#000000" points="716.5001,-1183.1389 713,-1173.139 709.5001,-1183.139 716.5001,-1183.1389"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1382,-1171.4016 932,-1171.4016 932,-1135.4016 1382,-1135.4016 1382,-1171.4016"/>
<text text-anchor="middle" x="1157" y="-1149.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
</g>
<!-- block_6&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_6&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1310.6737,-2360.0375C1293.1682,-2222.5858 1182.1964,-1351.2417 1160.6291,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="1164.0751,-1181.2506 1159.3397,-1171.7729 1157.1312,-1182.135 1164.0751,-1181.2506"/>
</g>
<!-- codeblock_27 -->
<g id="node28" class="node">
<title>codeblock_27</title>
<ellipse fill="none" stroke="#000000" cx="1477" cy="-1153.4016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1477" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;69</text>
</g>
<!-- block_7&#45;&gt;codeblock_27 -->
<g id="edge27" class="edge">
<title>block_7&#45;&gt;codeblock_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1597.1807,-2360.0375C1583.4905,-2222.5858 1496.7048,-1351.2417 1479.8381,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="1483.3037,-1181.3768 1478.8298,-1171.7729 1476.3382,-1182.0706 1483.3037,-1181.3768"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1626,-1171.4016 1572,-1171.4016 1572,-1135.4016 1626,-1135.4016 1626,-1171.4016"/>
</g>
<!-- block_7&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_7&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1599,-2360.0375C1599,-2222.5858 1599,-1351.2417 1599,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="1602.5001,-1181.7729 1599,-1171.7729 1595.5001,-1181.773 1602.5001,-1181.7729"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2052,-1172.7022 1644,-1172.7022 1644,-1134.101 2052,-1134.101 2052,-1172.7022"/>
<text text-anchor="middle" x="1848" y="-1157.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="1848" y="-1142.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
</g>
<!-- block_8&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>block_8&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1789.8798,-2360.0375C1796.4827,-2222.9542 1838.2459,-1355.9078 1846.5611,-1183.2739"/>
<polygon fill="#000000" stroke="#000000" points="1850.064,-1183.2958 1847.0493,-1173.139 1843.0722,-1182.959 1850.064,-1183.2958"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2471.5,-1172.7022 2070.5,-1172.7022 2070.5,-1134.101 2471.5,-1134.101 2471.5,-1172.7022"/>
<text text-anchor="middle" x="2271" y="-1157.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="2271" y="-1142.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
</g>
<!-- block_9&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_9&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2097.6245,-2360.0375C2117.3213,-2222.9542 2241.9029,-1355.9078 2266.7078,-1183.2739"/>
<polygon fill="#000000" stroke="#000000" points="2270.2061,-1183.5351 2268.164,-1173.139 2263.2773,-1182.5395 2270.2061,-1183.5351"/>
</g>
<!-- codeblock_32 -->
<g id="node33" class="node">
<title>codeblock_32</title>
<ellipse fill="none" stroke="#000000" cx="2572" cy="-1153.4016" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2572" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;139</text>
</g>
<!-- block_10&#45;&gt;codeblock_32 -->
<g id="edge32" class="edge">
<title>block_10&#45;&gt;codeblock_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572,-2360.0375C2572,-2222.5858 2572,-1351.2417 2572,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="2575.5001,-1181.7729 2572,-1171.7729 2568.5001,-1181.773 2575.5001,-1181.7729"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2726,-1171.4016 2672,-1171.4016 2672,-1135.4016 2726,-1135.4016 2726,-1171.4016"/>
</g>
<!-- block_10&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>block_10&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2573.8938,-2360.0375C2588.1451,-2222.5858 2678.4876,-1351.2417 2696.0456,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="2699.5452,-1182.0806 2697.0952,-1171.7729 2692.5825,-1181.3586 2699.5452,-1182.0806"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3012,-1171.4016 2744,-1171.4016 2744,-1135.4016 3012,-1135.4016 3012,-1171.4016"/>
<text text-anchor="middle" x="2878" y="-1149.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
</g>
<!-- block_11&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_11&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2798.2079,-2360.0375C2807.2973,-2222.5858 2864.9173,-1351.2417 2876.1157,-1181.897"/>
<polygon fill="#000000" stroke="#000000" points="2879.6176,-1181.9821 2876.7851,-1171.7729 2872.6328,-1181.5202 2879.6176,-1181.9821"/>
</g>
<!-- codeblock_36 -->
<g id="node37" class="node">
<title>codeblock_36</title>
<ellipse fill="none" stroke="#000000" cx="3117" cy="-1153.4016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3117" y="-1149.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 143&#45;151</text>
</g>
<!-- block_12&#45;&gt;codeblock_36 -->
<g id="edge36" class="edge">
<title>block_12&#45;&gt;codeblock_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3031.283,-2360.0128C3033.1561,-2250.8853 3045.6286,-1674.7356 3106,-1209.4016 3107.1911,-1200.2207 3108.9781,-1190.2815 3110.7674,-1181.3606"/>
<polygon fill="#000000" stroke="#000000" points="3114.2162,-1181.9666 3112.8332,-1171.4624 3107.3639,-1180.5364 3114.2162,-1181.9666"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="3276,-1171.4016 3222,-1171.4016 3222,-1135.4016 3276,-1135.4016 3276,-1171.4016"/>
</g>
<!-- block_12&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_12&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3025.4977,-2360.0395C2991.2504,-2242.3798 2817.9341,-1584.3027 3106,-1209.4016 3134.7797,-1171.9465 3163.5229,-1191.0698 3212.3836,-1173.0389"/>
<polygon fill="#000000" stroke="#000000" points="3213.8097,-1176.2372 3221.7456,-1169.2178 3211.1644,-1169.7563 3213.8097,-1176.2372"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="210,-638.7008 54,-638.7008 54,-602.7008 210,-602.7008 210,-638.7008"/>
<text text-anchor="middle" x="132" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
</g>
<!-- codeblock_14&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_14&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M139.7292,-1135.3724C138.5505,-1056.8854 133.8613,-744.6427 132.4222,-648.8149"/>
<polygon fill="#000000" stroke="#000000" points="135.9206,-648.6717 132.2707,-638.7255 128.9213,-648.7769 135.9206,-648.6717"/>
</g>
<!-- handleline_17 -->
<g id="node18" class="node">
<title>handleline_17</title>
<ellipse fill="none" stroke="#000000" cx="278" cy="-620.7008" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="278" y="-616.5008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_15&#45;&gt;handleline_17 -->
<g id="edge17" class="edge">
<title>structure_15&#45;&gt;handleline_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M270.2708,-1135.3724C271.4495,-1056.8854 276.1387,-744.6427 277.5778,-648.8149"/>
<polygon fill="#000000" stroke="#000000" points="281.0787,-648.7769 277.7293,-638.7255 274.0794,-648.6717 281.0787,-648.7769"/>
</g>
<!-- handle_18 -->
<g id="node19" class="node">
<title>handle_18</title>
<ellipse fill="none" stroke="#000000" cx="278" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="278" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_17&#45;&gt;handle_18 -->
<g id="edge18" class="edge">
<title>handleline_17&#45;&gt;handle_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M278,-602.4329C278,-523.8093 278,-213.9177 278,-118.2696"/>
<polygon fill="#000000" stroke="#000000" points="281.5001,-118.1911 278,-108.1911 274.5001,-118.1911 281.5001,-118.1911"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="305,-36 251,-36 251,0 305,0 305,-36"/>
</g>
<!-- handle_18&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>handle_18&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M278,-71.8314C278,-64.131 278,-54.9743 278,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="281.5001,-46.4132 278,-36.4133 274.5001,-46.4133 281.5001,-46.4132"/>
</g>
<!-- hashline_22 -->
<g id="node23" class="node">
<title>hashline_22</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-620.7008" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="450" y="-616.5008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_21&#45;&gt;hashline_22 -->
<g id="edge22" class="edge">
<title>structure_21&#45;&gt;hashline_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-1135.3724C450,-1056.8854 450,-744.6427 450,-648.8149"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-648.7254 450,-638.7255 446.5001,-648.7255 453.5001,-648.7254"/>
</g>
<!-- hashtag_23 -->
<g id="node24" class="node">
<title>hashtag_23</title>
<ellipse fill="none" stroke="#000000" cx="450" cy="-90" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="450" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_22&#45;&gt;hashtag_23 -->
<g id="edge23" class="edge">
<title>hashline_22&#45;&gt;hashtag_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-602.4329C450,-523.8093 450,-213.9177 450,-118.2696"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-118.1911 450,-108.1911 446.5001,-118.1911 453.5001,-118.1911"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="477,-36 423,-36 423,0 477,0 477,-36"/>
</g>
<!-- hashtag_23&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>hashtag_23&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M450,-71.8314C450,-64.131 450,-54.9743 450,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="453.5001,-46.4132 450,-36.4133 446.5001,-46.4133 453.5001,-46.4132"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="1740.5,-1043.9022 1213.5,-1043.9022 1213.5,-197.4994 1740.5,-197.4994 1740.5,-1043.9022"/>
<text text-anchor="middle" x="1477" y="-1028.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="1477" y="-997.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="1477" y="-981.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="1477" y="-950.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="1477" y="-935.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="1477" y="-903.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1477" y="-872.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="1477" y="-840.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1477" y="-825.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1477" y="-794.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="1477" y="-778.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="1477" y="-747.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="1477" y="-731.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="1477" y="-716.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="1477" y="-701.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="1477" y="-685.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="1477" y="-670.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1477" y="-654.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1477" y="-639.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1477" y="-624.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-592.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="1477" y="-577.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="1477" y="-561.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="1477" y="-546.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="1477" y="-531.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1477" y="-515.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="1477" y="-500.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-468.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="1477" y="-453.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="1477" y="-438.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="1477" y="-422.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="1477" y="-407.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1477" y="-391.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="1477" y="-376.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1477" y="-345.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="1477" y="-329.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="1477" y="-314.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="1477" y="-298.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="1477" y="-283.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="1477" y="-268.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="1477" y="-252.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1477" y="-221.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="1477" y="-205.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_27&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>codeblock_27&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1477,-1135.3724C1477,-1118.0539 1477,-1089.3542 1477,-1054.1097"/>
<polygon fill="#000000" stroke="#000000" points="1480.5001,-1053.9993 1477,-1043.9994 1473.5001,-1053.9994 1480.5001,-1053.9993"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2867,-1097.6025 2277,-1097.6025 2277,-143.7991 2867,-143.7991 2867,-1097.6025"/>
<text text-anchor="middle" x="2572" y="-1082.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="2572" y="-1066.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="2572" y="-1035.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="2572" y="-1020.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="2572" y="-1004.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-989.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-973.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="2572" y="-958.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="2572" y="-927.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="2572" y="-911.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="2572" y="-896.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="2572" y="-880.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="2572" y="-865.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2572" y="-850.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="2572" y="-834.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-803.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="2572" y="-787.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2572" y="-772.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="2572" y="-757.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode then</text>
<text text-anchor="middle" x="2572" y="-741.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="2572" y="-726.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="2572" y="-710.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-695.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="2572" y="-632.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2572" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="2572" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="2572" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-555.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="2572" y="-539.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="2572" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2572" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="2572" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2572" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode or v.isnode then</text>
<text text-anchor="middle" x="2572" y="-369.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="2572" y="-353.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of leaf nodes</text>
<text text-anchor="middle" x="2572" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast[1] or not ast[1].isNode then</text>
<text text-anchor="middle" x="2572" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="2572" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(ast:toValue(), leaf_count)</text>
<text text-anchor="middle" x="2572" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="2572" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="2572" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2572" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="2572" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_32&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>codeblock_32&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2572,-1135.3724C2572,-1128.0629 2572,-1118.7261 2572,-1107.7254"/>
<polygon fill="#000000" stroke="#000000" points="2575.5001,-1107.6389 2572,-1097.6389 2568.5001,-1107.639 2575.5001,-1107.6389"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3289.5,-679.201 2944.5,-679.201 2944.5,-562.2006 3289.5,-562.2006 3289.5,-679.201"/>
<text text-anchor="middle" x="3117" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3117" y="-648.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3117" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3117" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3117" y="-570.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
</g>
<!-- codeblock_36&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>codeblock_36&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3117,-1135.3724C3117,-1065.9003 3117,-813.2865 3117,-689.7179"/>
<polygon fill="#000000" stroke="#000000" points="3120.5001,-689.6094 3117,-679.6094 3113.5001,-689.6094 3120.5001,-689.6094"/>
</g>
</g>
</svg>