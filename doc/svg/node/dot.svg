<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3535pt" height="1321pt"
 viewBox="0.00 0.00 3534.94 1321.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1317.4016)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1317.4016 3530.9425,-1317.4016 3530.9425,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1159.4425" cy="-1295.4016" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1159.4425" y="-1291.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 151</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1159.4425" cy="-1223.4016" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1159.4425" y="-1219.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;151</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1159.4425,-1277.233C1159.4425,-1269.5325 1159.4425,-1260.3759 1159.4425,-1251.8182"/>
<polygon fill="#000000" stroke="#000000" points="1162.9426,-1251.8148 1159.4425,-1241.8149 1155.9426,-1251.8149 1162.9426,-1251.8148"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="220.4425" cy="-1151.4016" rx="27" ry="18"/>
<text text-anchor="middle" x="220.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">0 : </text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1094.2269,-1221.3091C954.0603,-1216.339 613.8156,-1201.7385 330.4425,-1169.4016 305.6585,-1166.5734 277.9432,-1162.0295 256.5327,-1158.2148"/>
<polygon fill="#000000" stroke="#000000" points="257.0325,-1154.7485 246.569,-1156.4114 255.7857,-1161.6365 257.0325,-1154.7485"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="385.4425" cy="-1151.4016" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="385.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;1</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1094.293,-1220.7228C972.626,-1215.1709 702.7898,-1200.2651 477.4425,-1169.4016 463.8223,-1167.5362 449.1742,-1164.9421 435.6592,-1162.3033"/>
<polygon fill="#000000" stroke="#000000" points="436.0731,-1158.8168 425.5809,-1160.288 434.7005,-1165.681 436.0731,-1158.8168"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="554.4425" cy="-1151.4016" rx="67.748" ry="18"/>
<text text-anchor="middle" x="554.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 2&#45;4</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1096.0242,-1218.3652C999.3721,-1210.311 809.5362,-1193.0035 649.4425,-1169.4016 639.4783,-1167.9326 628.9664,-1166.1634 618.7107,-1164.3155"/>
<polygon fill="#000000" stroke="#000000" points="619.0386,-1160.8171 608.5703,-1162.4495 617.7717,-1167.7016 619.0386,-1160.8171"/>
</g>
<!-- structure_5 -->
<g id="node6" class="node">
<title>structure_5</title>
<ellipse fill="none" stroke="#000000" cx="703.4425" cy="-1151.4016" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="703.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- section_1&#45;&gt;structure_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;structure_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1096.857,-1217.6798C1018.7281,-1209.884 881.2639,-1194.0131 765.4425,-1169.4016 759.9608,-1168.2367 754.2552,-1166.8403 748.6224,-1165.3471"/>
<polygon fill="#000000" stroke="#000000" points="749.1969,-1161.8747 738.6259,-1162.584 747.332,-1168.6217 749.1969,-1161.8747"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="830.4425" cy="-1151.4016" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="830.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 12&#45;13</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1108.0363,-1212.1516C1047.947,-1199.0013 948.8359,-1177.3114 886.7247,-1163.7187"/>
<polygon fill="#000000" stroke="#000000" points="887.2257,-1160.2455 876.7086,-1161.5267 885.7291,-1167.0837 887.2257,-1160.2455"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1159.4425" cy="-1151.4016" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1159.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 14&#45;69</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1159.4425,-1205.233C1159.4425,-1197.5325 1159.4425,-1188.3759 1159.4425,-1179.8182"/>
<polygon fill="#000000" stroke="#000000" points="1162.9426,-1179.8148 1159.4425,-1169.8149 1155.9426,-1179.8149 1162.9426,-1179.8148"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1477.4425" cy="-1151.4016" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1477.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;73</text>
</g>
<!-- section_1&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1210.1822,-1211.9134C1267.8674,-1198.8526 1361.7578,-1177.5944 1421.5143,-1164.0646"/>
<polygon fill="#000000" stroke="#000000" points="1422.5488,-1167.419 1431.529,-1161.7971 1421.0029,-1160.5919 1422.5488,-1167.419"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1837.4425" cy="-1151.4016" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1837.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 74&#45;76</text>
</g>
<!-- section_1&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1220.8063,-1216.8851C1349.0252,-1203.2689 1644.1844,-1171.9246 1774.1005,-1158.1282"/>
<polygon fill="#000000" stroke="#000000" points="1774.7107,-1161.5831 1784.2852,-1157.0466 1773.9715,-1154.6223 1774.7107,-1161.5831"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="2287.4425" cy="-1151.4016" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="2287.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 77&#45;139</text>
</g>
<!-- section_1&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>section_1&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1223.7298,-1219.2981C1414.5467,-1207.1183 1978.0412,-1171.1506 2198.0307,-1157.1087"/>
<polygon fill="#000000" stroke="#000000" points="2198.4871,-1160.5868 2208.2438,-1156.4568 2198.0412,-1153.601 2198.4871,-1160.5868"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="2741.4425" cy="-1151.4016" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="2741.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 141&#45;142</text>
</g>
<!-- section_1&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_1&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1224.5298,-1220.6394C1406.749,-1212.88 1937.5075,-1190.1001 2378.4425,-1169.4016 2478.2199,-1164.7178 2593.4045,-1158.9437 2666.7877,-1155.2188"/>
<polygon fill="#000000" stroke="#000000" points="2667.0495,-1158.7101 2676.859,-1154.7071 2666.6943,-1151.7191 2667.0495,-1158.7101"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="3133.4425" cy="-1151.4016" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3133.4425" y="-1147.2016" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 143&#45;151</text>
</g>
<!-- section_1&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>section_1&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1224.9846,-1221.8345C1447.9369,-1216.3821 2197.5138,-1197.0548 2816.4425,-1169.4016 2891.4289,-1166.0513 2976.3319,-1161.1724 3039.386,-1157.3389"/>
<polygon fill="#000000" stroke="#000000" points="3039.94,-1160.8117 3049.7081,-1156.7088 3039.5134,-1153.8247 3039.94,-1160.8117"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="59.4425,-638.7008 5.4425,-638.7008 5.4425,-602.7008 59.4425,-602.7008 59.4425,-638.7008"/>
</g>
<!-- header_2&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_2&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M194.5279,-1145.7743C155.3752,-1136.7112 84.0416,-1117.8189 68.4425,-1097.4016 -36.9227,-959.491 5.8251,-728.8137 25.0191,-648.939"/>
<polygon fill="#000000" stroke="#000000" points="28.4457,-649.662 27.4464,-639.1144 21.65,-647.983 28.4457,-649.662"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="131.4425,-638.7008 77.4425,-638.7008 77.4425,-602.7008 131.4425,-602.7008 131.4425,-638.7008"/>
</g>
<!-- block_3&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_3&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M342.4062,-1144.7558C275.712,-1134.0423 153.6438,-1112.6176 140.4425,-1097.4016 82.1669,-1030.2319 96.228,-741.4982 102.357,-649.1927"/>
<polygon fill="#000000" stroke="#000000" points="105.8678,-649.1537 103.0598,-638.9378 98.8842,-648.6751 105.8678,-649.1537"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="305.4425,-638.7008 149.4425,-638.7008 149.4425,-602.7008 305.4425,-602.7008 305.4425,-638.7008"/>
<text text-anchor="middle" x="227.4425" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;&#45; Transform Module</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_4&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M496.8184,-1141.8513C429.9228,-1130.2417 327.0867,-1110.5725 314.4425,-1097.4016 192.0537,-969.915 211.9429,-730.6673 223.0199,-648.9195"/>
<polygon fill="#000000" stroke="#000000" points="226.504,-649.2782 224.4449,-638.8854 219.5735,-648.2939 226.504,-649.2782"/>
</g>
<!-- hashline_16 -->
<g id="node17" class="node">
<title>hashline_16</title>
<ellipse fill="none" stroke="#000000" cx="366.4425" cy="-620.7008" rx="43.0992" ry="18"/>
<text text-anchor="middle" x="366.4425" y="-616.5008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashline</text>
</g>
<!-- structure_5&#45;&gt;hashline_16 -->
<g id="edge16" class="edge">
<title>structure_5&#45;&gt;hashline_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M666.2,-1141.5065C655.0617,-1138.7055 642.7931,-1135.7759 631.4425,-1133.4016 584.4549,-1123.5728 451.3748,-1132.3288 418.4425,-1097.4016 298.4674,-970.1588 340.3763,-730.7548 359.2771,-648.943"/>
<polygon fill="#000000" stroke="#000000" points="362.7566,-649.4396 361.6671,-638.9009 355.9468,-647.8189 362.7566,-649.4396"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="877.4425,-638.7008 427.4425,-638.7008 427.4425,-602.7008 877.4425,-602.7008 877.4425,-638.7008"/>
<text text-anchor="middle" x="652.4425" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; [ ] Make leaf_font and leaf_color configurable values of t</text>
</g>
<!-- block_6&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_6&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M824.4182,-1133.4401C798.1681,-1055.1765 693.667,-743.6102 661.7494,-648.4488"/>
<polygon fill="#000000" stroke="#000000" points="665.0552,-647.2982 658.5568,-638.9303 658.4185,-649.5242 665.0552,-647.2982"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1422.9425,-1043.9022 895.9425,-1043.9022 895.9425,-197.4994 1422.9425,-197.4994 1422.9425,-1043.9022"/>
<text text-anchor="middle" x="1159.4425" y="-1028.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local t = {}</text>
<text text-anchor="middle" x="1159.4425" y="-997.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_header = [=[</text>
<text text-anchor="middle" x="1159.4425" y="-981.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">digraph hierarchy {</text>
<text text-anchor="middle" x="1159.4425" y="-950.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">node [fontname=Helvetica]</text>
<text text-anchor="middle" x="1159.4425" y="-935.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">edge [style=dashed]</text>
<text text-anchor="middle" x="1159.4425" y="-903.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1159.4425" y="-872.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot_footer = [=[</text>
<text text-anchor="middle" x="1159.4425" y="-840.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">}</text>
<text text-anchor="middle" x="1159.4425" y="-825.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">]=]</text>
<text text-anchor="middle" x="1159.4425" y="-794.0012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_font &#160;= &quot;Inconsolata&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-778.6012" font-family="Inconsolata" font-size="14.00" fill="#000000">local leaf_color = &quot;Gray&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-747.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local function sanitize_string(str)</text>
<text text-anchor="middle" x="1159.4425" y="-731.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; filter \ and &quot;</text>
<text text-anchor="middle" x="1159.4425" y="-716.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = str:gsub(&quot;\\&quot;, &quot;\\\\&quot;):gsub(&#39;&quot;&#39;, &#39;\\&quot;&#39;)</text>
<text text-anchor="middle" x="1159.4425" y="-701.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if phrase:sub(&#45;1,&#45;1) == &quot;\n&quot; then</text>
<text text-anchor="middle" x="1159.4425" y="-685.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase:sub(1, &#45;2)</text>
<text text-anchor="middle" x="1159.4425" y="-670.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1159.4425" y="-654.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="1159.4425" y="-639.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1159.4425" y="-624.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1159.4425" y="-592.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">local function ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="1159.4425" y="-577.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; nodes need unique names, so we append a leaf_count and increment it</text>
<text text-anchor="middle" x="1159.4425" y="-561.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label &#160;&#160;&#160;&#160;&#160;= ast.id.. &quot;_&quot; .. leaf_count </text>
<text text-anchor="middle" x="1159.4425" y="-546.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label_line = label .. &quot; [label=\&quot;&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-531.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. sanitize_string(ast:dotLabel()) .. &quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-515.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return label, label_line, leaf_count + 1</text>
<text text-anchor="middle" x="1159.4425" y="-500.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1159.4425" y="-468.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function list_from_table(tab)</text>
<text text-anchor="middle" x="1159.4425" y="-453.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local table_list = &quot;&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-438.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;for _,v in ipairs(tab) do</text>
<text text-anchor="middle" x="1159.4425" y="-422.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;table_list = table_list..&quot; &quot;..v</text>
<text text-anchor="middle" x="1159.4425" y="-407.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1159.4425" y="-391.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return table_list</text>
<text text-anchor="middle" x="1159.4425" y="-376.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1159.4425" y="-345.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function value_to_label(value, leaf_count)</text>
<text text-anchor="middle" x="1159.4425" y="-329.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Generates a name and label for a leaf node.</text>
<text text-anchor="middle" x="1159.4425" y="-314.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Returns these with an incremented leaf_count.</text>
<text text-anchor="middle" x="1159.4425" y="-298.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local value = sanitize_string(value)</text>
<text text-anchor="middle" x="1159.4425" y="-283.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local name &#160;= &quot;leaf_&quot;..leaf_count</text>
<text text-anchor="middle" x="1159.4425" y="-268.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local label = &quot; [color=&quot;..leaf_color..&quot;,shape=rectangle,fontname=&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-252.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;..leaf_font..&quot;,label=\&quot;&quot;..value..&quot;\&quot;]\n&quot;</text>
<text text-anchor="middle" x="1159.4425" y="-221.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return name, label, leaf_count + 1</text>
<text text-anchor="middle" x="1159.4425" y="-205.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>codeblock_7&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1159.4425,-1133.1337C1159.4425,-1116.1302 1159.4425,-1088.3103 1159.4425,-1054.1801"/>
<polygon fill="#000000" stroke="#000000" points="1162.9426,-1053.8927 1159.4425,-1043.8928 1155.9426,-1053.8928 1162.9426,-1053.8927"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1849.4425,-640.0014 1441.4425,-640.0014 1441.4425,-601.4002 1849.4425,-601.4002 1849.4425,-640.0014"/>
<text text-anchor="middle" x="1645.4425" y="-624.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> Recursively walk an AST, concatenating dot descriptions</text>
<text text-anchor="middle" x="1645.4425" y="-609.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> to the phrase. </text>
</g>
<!-- block_8&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>block_8&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1483.1285,-1133.4401C1507.7932,-1055.5259 1605.6549,-746.3874 1636.251,-649.7362"/>
<polygon fill="#000000" stroke="#000000" points="1639.6395,-650.629 1639.3208,-640.0389 1632.9659,-648.5163 1639.6395,-650.629"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2268.9425,-640.0014 1867.9425,-640.0014 1867.9425,-601.4002 2268.9425,-601.4002 2268.9425,-640.0014"/>
<text text-anchor="middle" x="2068.4425" y="-624.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #todo allow nodes to skip themselves to collapse</text>
<text text-anchor="middle" x="2068.4425" y="-609.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;semantic intermediates</text>
</g>
<!-- block_9&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>block_9&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1845.2607,-1133.4401C1879.209,-1055.447 2014.007,-745.7614 2055.9316,-649.4434"/>
<polygon fill="#000000" stroke="#000000" points="2059.2432,-650.6049 2060.0252,-640.0389 2052.8249,-647.8111 2059.2432,-650.6049"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2877.4425,-1097.6025 2287.4425,-1097.6025 2287.4425,-143.7991 2877.4425,-143.7991 2877.4425,-1097.6025"/>
<text text-anchor="middle" x="2582.4425" y="-1082.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function dot_ranks(ast, phrase, leaf_count, ast_label)</text>
<text text-anchor="middle" x="2582.4425" y="-1066.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local leaf_count = leaf_count or 0</text>
<text text-anchor="middle" x="2582.4425" y="-1035.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; Add the node we&#39;re working on</text>
<text text-anchor="middle" x="2582.4425" y="-1020.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="2582.4425" y="-1004.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label = &quot;&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-989.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local label_line = &quot;&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-973.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_labels = {}</text>
<text text-anchor="middle" x="2582.4425" y="-958.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_label_lines = {}</text>
<text text-anchor="middle" x="2582.4425" y="-927.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Handle anonymous nodes</text>
<text text-anchor="middle" x="2582.4425" y="-911.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not ast_label then</text>
<text text-anchor="middle" x="2582.4425" y="-896.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label, label_line, leaf_count = ast_to_label(ast, leaf_count)</text>
<text text-anchor="middle" x="2582.4425" y="-880.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. label_line .. &quot;\n\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-865.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else </text>
<text text-anchor="middle" x="2582.4425" y="-850.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;label = ast_label </text>
<text text-anchor="middle" x="2582.4425" y="-834.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-803.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document child nodes</text>
<text text-anchor="middle" x="2582.4425" y="-787.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2582.4425" y="-772.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; assemble labels and label lines for all child nodes</text>
<text text-anchor="middle" x="2582.4425" y="-757.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode then</text>
<text text-anchor="middle" x="2582.4425" y="-741.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;child_labels[i], child_label_lines[i], leaf_count = </text>
<text text-anchor="middle" x="2582.4425" y="-726.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;ast_to_label(v, leaf_count)</text>
<text text-anchor="middle" x="2582.4425" y="-710.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-695.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local child_list = list_from_table(child_labels)</text>
<text text-anchor="middle" x="2582.4425" y="-632.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2582.4425" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; {&quot;..child_list..&quot;}\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;{rank=same;&quot;..list_from_table(child_labels)..&quot;}\n\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-586.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-555.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Concatenate child label lines</text>
<text text-anchor="middle" x="2582.4425" y="-539.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for _, v in ipairs(child_label_lines) do</text>
<text text-anchor="middle" x="2582.4425" y="-524.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..v..&quot;\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-508.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-477.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if next(child_labels) ~= nil then</text>
<text text-anchor="middle" x="2582.4425" y="-462.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..&quot;\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-446.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-415.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Execute recursively for all nodes</text>
<text text-anchor="middle" x="2582.4425" y="-399.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i,v in ipairs(ast) do</text>
<text text-anchor="middle" x="2582.4425" y="-384.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if v.isNode or v.isnode then</text>
<text text-anchor="middle" x="2582.4425" y="-369.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase, leaf_count = dot_ranks(v, phrase, leaf_count, child_labels[i])</text>
<text text-anchor="middle" x="2582.4425" y="-353.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-338.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-306.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#45;&#45; Document value of leaf nodes</text>
<text text-anchor="middle" x="2582.4425" y="-291.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not (ast[1] or ast[1].isNode or ast[1].isnode) then</text>
<text text-anchor="middle" x="2582.4425" y="-276.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local name = &quot;&quot; ; local val_label = &quot;&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-260.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name, val_label, leaf_count = value_to_label(ast:toValue(), leaf_count)</text>
<text text-anchor="middle" x="2582.4425" y="-245.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..label..&quot; &#45;&gt; &quot;..name..&quot;\n&quot;</text>
<text text-anchor="middle" x="2582.4425" y="-229.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase..name..&quot; &quot;..val_label</text>
<text text-anchor="middle" x="2582.4425" y="-214.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-199.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2582.4425" y="-167.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase, leaf_count</text>
<text text-anchor="middle" x="2582.4425" y="-152.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_10&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2297.4268,-1133.4401C2301.3976,-1126.2967 2306.4488,-1117.2097 2312.3903,-1106.5209"/>
<polygon fill="#000000" stroke="#000000" points="2315.5431,-1108.0529 2317.3425,-1097.6119 2309.4248,-1104.6519 2315.5431,-1108.0529"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="3163.4425,-638.7008 2895.4425,-638.7008 2895.4425,-602.7008 3163.4425,-602.7008 3163.4425,-638.7008"/>
<text text-anchor="middle" x="3029.4425" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> turn an AST into a dotfile string. </text>
</g>
<!-- block_11&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_11&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2798.8146,-1142.613C2828.6558,-1135.2459 2863.5758,-1121.8067 2886.4425,-1097.4016 3010.0099,-965.5211 3027.1186,-730.9204 3029.2427,-649.4898"/>
<polygon fill="#000000" stroke="#000000" points="3032.7509,-649.111 3029.4524,-639.0427 3025.7523,-648.9704 3032.7509,-649.111"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="3526.9425,-679.201 3181.9425,-679.201 3181.9425,-562.2006 3526.9425,-562.2006 3526.9425,-679.201"/>
<text text-anchor="middle" x="3354.4425" y="-664.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">function t.dot(ast)</text>
<text text-anchor="middle" x="3354.4425" y="-648.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = dot_header</text>
<text text-anchor="middle" x="3354.4425" y="-617.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return &#160;dot_ranks(ast, phrase) .. dot_footer</text>
<text text-anchor="middle" x="3354.4425" y="-601.8008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3354.4425" y="-570.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">return t</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>codeblock_12&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3148.4221,-1133.2005C3156.2664,-1123.0833 3165.6294,-1110.0195 3172.4425,-1097.4016 3247.0367,-959.2526 3305.5763,-783.913 3334.5393,-689.0881"/>
<polygon fill="#000000" stroke="#000000" points="3337.9462,-689.914 3337.5025,-679.3285 3331.2481,-687.8803 3337.9462,-689.914"/>
</g>
<!-- hashtag_17 -->
<g id="node18" class="node">
<title>hashtag_17</title>
<ellipse fill="none" stroke="#000000" cx="366.4425" cy="-90" rx="41.6544" ry="18"/>
<text text-anchor="middle" x="366.4425" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">hashtag</text>
</g>
<!-- hashline_16&#45;&gt;hashtag_17 -->
<g id="edge17" class="edge">
<title>hashline_16&#45;&gt;hashtag_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M366.4425,-602.4329C366.4425,-523.8093 366.4425,-213.9177 366.4425,-118.2696"/>
<polygon fill="#000000" stroke="#000000" points="369.9426,-118.1911 366.4425,-108.1911 362.9426,-118.1911 369.9426,-118.1911"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="393.4425,-36 339.4425,-36 339.4425,0 393.4425,0 393.4425,-36"/>
</g>
<!-- hashtag_17&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>hashtag_17&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M366.4425,-71.8314C366.4425,-64.131 366.4425,-54.9743 366.4425,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="369.9426,-46.4132 366.4425,-36.4133 362.9426,-46.4133 369.9426,-46.4132"/>
</g>
</g>
</svg>