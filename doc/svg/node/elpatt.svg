<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3637pt" height="2167pt"
 viewBox="0.00 0.00 3637.00 2167.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2163.0023)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2163.0023 3633,-2163.0023 3633,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1156.5" cy="-2141.0023" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="1156.5" y="-2136.8023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 85</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1156.5" cy="-2069.0023" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="1156.5" y="-2064.8023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;40</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1156.5,-2122.8337C1156.5,-2115.1333 1156.5,-2105.9767 1156.5,-2097.419"/>
<polygon fill="#000000" stroke="#000000" points="1160.0001,-2097.4156 1156.5,-2087.4156 1153.0001,-2097.4156 1160.0001,-2097.4156"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="749.5" cy="-1691.7019" rx="113.2139" ry="18"/>
<text text-anchor="middle" x="749.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Extended Lpeg module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1097.5202,-2064.5752C1024.3118,-2057.9581 905.0009,-2043.1401 871.5,-2015.0023 779.4371,-1937.6778 756.749,-1783.2889 751.2366,-1719.8803"/>
<polygon fill="#000000" stroke="#000000" points="754.7187,-1719.5149 750.4422,-1709.8216 747.7404,-1720.0661 754.7187,-1719.5149"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="926.5" cy="-1691.7019" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="926.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1105.1756,-2059.3479C1059.6541,-2049.7235 997.9055,-2033.7072 981.5,-2015.0023 906.7729,-1929.8015 915.0008,-1781.6394 922.36,-1719.9341"/>
<polygon fill="#000000" stroke="#000000" points="925.8608,-1720.1501 923.658,-1709.7868 918.9173,-1719.2619 925.8608,-1720.1501"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1036.5" cy="-1691.7019" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1036.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;9</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1129.0653,-2052.8503C1115.622,-2043.4988 1100.4406,-2030.5079 1091.5,-2015.0023 1035.5433,-1917.9574 1033.1114,-1779.1106 1034.9828,-1720.0417"/>
<polygon fill="#000000" stroke="#000000" points="1038.4832,-1720.0959 1035.3704,-1709.9687 1031.4884,-1719.8267 1038.4832,-1720.0959"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1156.5" cy="-1691.7019" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1156.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 10&#45;40</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1156.5,-2050.8044C1156.5,-1990.0383 1156.5,-1793.8192 1156.5,-1720.0716"/>
<polygon fill="#000000" stroke="#000000" points="1160.0001,-1719.7172 1156.5,-1709.7173 1153.0001,-1719.7173 1160.0001,-1719.7172"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1639.5" cy="-1691.7019" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1639.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;40</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1178.1918,-2052.0575C1255.8125,-1991.4233 1519.881,-1785.1435 1609.4782,-1715.1537"/>
<polygon fill="#000000" stroke="#000000" points="1611.8662,-1717.7297 1617.5922,-1708.8154 1607.5569,-1712.2132 1611.8662,-1717.7297"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2722.5" cy="-1691.7019" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2722.5" y="-1687.5019" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 41&#45;85</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1216.9977,-2067.3765C1320.0955,-2063.6681 1536.0118,-2051.8199 1714.5,-2015.0023 2095.0485,-1936.5049 2534.5584,-1767.1496 2676.0744,-1710.5538"/>
<polygon fill="#000000" stroke="#000000" points="2677.7648,-1713.647 2685.7437,-1706.6766 2675.1595,-1707.1498 2677.7648,-1713.647"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="3284.5,-2014.8029 2806.5,-2014.8029 2806.5,-1368.6009 3284.5,-1368.6009 3284.5,-2014.8029"/>
<text text-anchor="middle" x="3045.5" y="-1999.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">* Extended Lpeg module</text>
<text text-anchor="middle" x="3045.5" y="-1952.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is where we add extended captures a la the old =epeg= </text>
<text text-anchor="middle" x="3045.5" y="-1937.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">module.</text>
<text text-anchor="middle" x="3045.5" y="-1905.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">The difference here is that we include lpeg as a metatable __index</text>
<text text-anchor="middle" x="3045.5" y="-1890.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">and can therefore use elpeg as L everywhere we currently use lpeg.</text>
<text text-anchor="middle" x="3045.5" y="-1858.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3045.5" y="-1843.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="3045.5" y="-1828.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = setmetatable({}, {__index = lpeg})</text>
<text text-anchor="middle" x="3045.5" y="-1796.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3045.5" y="-1765.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">** Ppt &#45;&#45; Codepoint pattern</text>
<text text-anchor="middle" x="3045.5" y="-1733.802" font-family="Inconsolata" font-size="14.00" fill="#000000">Captures one Unicode point</text>
<text text-anchor="middle" x="3045.5" y="-1702.402" font-family="Inconsolata" font-size="14.00" fill="#000000">I actually have no idea how to do this yet...</text>
<text text-anchor="middle" x="3045.5" y="-1671.002" font-family="Inconsolata" font-size="14.00" fill="#000000">Looks like byte 97 is just =\97= in Lua. That&#39;s easy enough.</text>
<text text-anchor="middle" x="3045.5" y="-1639.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3045.5" y="-1624.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="3045.5" y="-1608.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="3045.5" y="-1593.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="3045.5" y="-1578.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="3045.5" y="-1562.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="3045.5" y="-1547.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="3045.5" y="-1531.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="3045.5" y="-1516.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="3045.5" y="-1501.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="3045.5" y="-1485.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="3045.5" y="-1470.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="3045.5" y="-1454.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3045.5" y="-1439.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3045.5" y="-1424.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3045.5" y="-1376.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_1&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>section_1&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1217.3055,-2068.4539C1505.8459,-2065.6675 2725.995,-2051.7457 2797.5,-2015.0023 2797.5934,-2014.9543 2797.6868,-2014.9063 2797.7801,-2014.8582"/>
<polygon fill="#000000" stroke="#000000" points="2799.2354,-2018.0495 2806.3894,-2010.2347 2795.9234,-2011.8826 2799.2354,-2018.0495"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="443,-1011.8014 0,-1011.8014 0,-941.2007 443,-941.2007 443,-1011.8014"/>
<text text-anchor="middle" x="221.5" y="-964.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is where we add extended captures a la the old =epeg= </text>
<text text-anchor="middle" x="221.5" y="-949.301" font-family="Inconsolata" font-size="14.00" fill="#000000">module.</text>
</g>
<!-- block_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>block_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M930.0547,-1673.5774C939.7464,-1618.2174 960.3086,-1450.1452 871.5,-1368.4014 802.7396,-1305.111 532.6374,-1380.4813 452.5,-1332.4014 332.8644,-1260.6239 263.8101,-1100.2468 235.9773,-1021.6579"/>
<polygon fill="#000000" stroke="#000000" points="239.2219,-1020.332 232.6315,-1012.0364 232.6102,-1022.6312 239.2219,-1020.332"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="939.5,-995.8016 461.5,-995.8016 461.5,-957.2004 939.5,-957.2004 939.5,-995.8016"/>
<text text-anchor="middle" x="700.5" y="-980.701" font-family="Inconsolata" font-size="14.00" fill="#000000">The difference here is that we include lpeg as a metatable __index</text>
<text text-anchor="middle" x="700.5" y="-965.301" font-family="Inconsolata" font-size="14.00" fill="#000000">and can therefore use elpeg as L everywhere we currently use lpeg.</text>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1036.9127,-1673.453C1037.3517,-1622.4237 1033.6925,-1475.0216 981.5,-1368.4014 971.957,-1348.9068 962.068,-1349.3431 948.5,-1332.4014 855.1377,-1215.8249 757.5942,-1066.2796 718.3779,-1004.8082"/>
<polygon fill="#000000" stroke="#000000" points="721.1291,-1002.6122 712.808,-996.0541 715.2232,-1006.37 721.1291,-1002.6122"/>
</g>
<!-- codeblock_10 -->
<g id="node11" class="node">
<title>codeblock_10</title>
<ellipse fill="none" stroke="#000000" cx="1034.5" cy="-976.501" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1034.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 10&#45;14</text>
</g>
<!-- block_5&#45;&gt;codeblock_10 -->
<g id="edge10" class="edge">
<title>block_5&#45;&gt;codeblock_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1153.4232,-1673.665C1136.9742,-1577.2359 1059.412,-1122.5429 1039.2822,-1004.5357"/>
<polygon fill="#000000" stroke="#000000" points="1042.7002,-1003.7582 1037.5684,-994.4892 1035.7999,-1004.9354 1042.7002,-1003.7582"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1183.5,-994.501 1129.5,-994.501 1129.5,-958.501 1183.5,-958.501 1183.5,-994.501"/>
</g>
<!-- block_5&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_5&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1156.5,-1673.665C1156.5,-1577.341 1156.5,-1123.5342 1156.5,-1004.9229"/>
<polygon fill="#000000" stroke="#000000" points="1160.0001,-1004.8154 1156.5,-994.8155 1153.0001,-1004.8155 1160.0001,-1004.8154"/>
</g>
<!-- header_13 -->
<g id="node14" class="node">
<title>header_13</title>
<ellipse fill="none" stroke="#000000" cx="1318.5" cy="-976.501" rx="116.5627" ry="18"/>
<text text-anchor="middle" x="1318.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Ppt &#45;&#45; Codepoint pattern</text>
</g>
<!-- section_6&#45;&gt;header_13 -->
<g id="edge13" class="edge">
<title>section_6&#45;&gt;header_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1628.5204,-1673.8905C1597.0577,-1622.378 1504.9596,-1468.2432 1444.5,-1332.4014 1391.591,-1213.5246 1344.9718,-1065.0023 1326.703,-1004.2955"/>
<polygon fill="#000000" stroke="#000000" points="1330.0409,-1003.2411 1323.8213,-994.664 1323.3346,-1005.2476 1330.0409,-1003.2411"/>
</g>
<!-- block_14 -->
<g id="node15" class="node">
<title>block_14</title>
<ellipse fill="none" stroke="#000000" cx="1509.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1509.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 16&#45;19</text>
</g>
<!-- section_6&#45;&gt;block_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;block_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1636.2215,-1673.665C1618.6938,-1577.2359 1536.0456,-1122.5429 1514.5958,-1004.5357"/>
<polygon fill="#000000" stroke="#000000" points="1518.0017,-1003.702 1512.7697,-994.4892 1511.1145,-1004.9539 1518.0017,-1003.702"/>
</g>
<!-- block_15 -->
<g id="node16" class="node">
<title>block_15</title>
<ellipse fill="none" stroke="#000000" cx="1639.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1639.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 20&#45;21</text>
</g>
<!-- section_6&#45;&gt;block_15 -->
<g id="edge15" class="edge">
<title>section_6&#45;&gt;block_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1639.5,-1673.665C1639.5,-1577.341 1639.5,-1123.5342 1639.5,-1004.9229"/>
<polygon fill="#000000" stroke="#000000" points="1643.0001,-1004.8154 1639.5,-994.8155 1636.0001,-1004.8155 1643.0001,-1004.8154"/>
</g>
<!-- block_16 -->
<g id="node17" class="node">
<title>block_16</title>
<ellipse fill="none" stroke="#000000" cx="1769.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1769.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 22&#45;23</text>
</g>
<!-- section_6&#45;&gt;block_16 -->
<g id="edge16" class="edge">
<title>section_6&#45;&gt;block_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1642.7785,-1673.665C1660.3062,-1577.2359 1742.9544,-1122.5429 1764.4042,-1004.5357"/>
<polygon fill="#000000" stroke="#000000" points="1767.8855,-1004.9539 1766.2303,-994.4892 1760.9983,-1003.702 1767.8855,-1004.9539"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="1910.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1910.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 24&#45;40</text>
</g>
<!-- section_6&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_6&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1651.608,-1673.8868C1685.6576,-1622.9747 1783.1061,-1471.5474 1834.5,-1332.4014 1877.8668,-1214.9886 1899.6269,-1066.167 1907.2511,-1004.8598"/>
<polygon fill="#000000" stroke="#000000" points="1910.7429,-1005.1379 1908.4731,-994.7891 1903.7939,-1004.2946 1910.7429,-1005.1379"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2420.5,-1182.5016 1984.5,-1182.5016 1984.5,-770.5004 2420.5,-770.5004 2420.5,-1182.5016"/>
<text text-anchor="middle" x="2202.5" y="-1167.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">** Ppt &#45;&#45; Codepoint pattern</text>
<text text-anchor="middle" x="2202.5" y="-1135.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">Captures one Unicode point</text>
<text text-anchor="middle" x="2202.5" y="-1104.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">I actually have no idea how to do this yet...</text>
<text text-anchor="middle" x="2202.5" y="-1073.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">Looks like byte 97 is just =\97= in Lua. That&#39;s easy enough.</text>
<text text-anchor="middle" x="2202.5" y="-1041.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="2202.5" y="-1026.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="2202.5" y="-1010.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="2202.5" y="-995.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="2202.5" y="-980.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="2202.5" y="-964.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="2202.5" y="-949.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="2202.5" y="-933.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="2202.5" y="-918.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="2202.5" y="-903.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="2202.5" y="-887.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="2202.5" y="-872.3009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="2202.5" y="-856.9008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2202.5" y="-841.5008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2202.5" y="-826.1008" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="2202.5" y="-778.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_6&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>section_6&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1658.2538,-1674.0771C1711.374,-1623.6657 1866.0857,-1473.4292 1975.5,-1332.4014 2009.721,-1288.2928 2043.6757,-1238.9216 2074.4925,-1191.3252"/>
<polygon fill="#000000" stroke="#000000" points="2077.5297,-1193.0734 2080.0087,-1182.7726 2071.6472,-1189.2792 2077.5297,-1193.0734"/>
</g>
<!-- header_25 -->
<g id="node26" class="node">
<title>header_25</title>
<ellipse fill="none" stroke="#000000" cx="2546.5" cy="-976.501" rx="102.0437" ry="18"/>
<text text-anchor="middle" x="2546.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Csp &#45;&#45; Capture span</text>
</g>
<!-- section_7&#45;&gt;header_25 -->
<g id="edge25" class="edge">
<title>section_7&#45;&gt;header_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2718.0614,-1673.665C2694.3317,-1577.2359 2582.4387,-1122.5429 2553.3989,-1004.5357"/>
<polygon fill="#000000" stroke="#000000" points="2556.7149,-1003.3631 2550.9266,-994.4892 2549.9176,-1005.0359 2556.7149,-1003.3631"/>
</g>
<!-- block_26 -->
<g id="node27" class="node">
<title>block_26</title>
<ellipse fill="none" stroke="#000000" cx="2722.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2722.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 41&#45;45</text>
</g>
<!-- section_7&#45;&gt;block_26 -->
<g id="edge26" class="edge">
<title>section_7&#45;&gt;block_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2722.5,-1673.665C2722.5,-1577.341 2722.5,-1123.5342 2722.5,-1004.9229"/>
<polygon fill="#000000" stroke="#000000" points="2726.0001,-1004.8154 2722.5,-994.8155 2719.0001,-1004.8155 2726.0001,-1004.8154"/>
</g>
<!-- block_27 -->
<g id="node28" class="node">
<title>block_27</title>
<ellipse fill="none" stroke="#000000" cx="2855.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2855.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 46&#45;82</text>
</g>
<!-- section_7&#45;&gt;block_27 -->
<g id="edge27" class="edge">
<title>section_7&#45;&gt;block_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2725.8542,-1673.665C2743.7863,-1577.2359 2828.3418,-1122.5429 2850.2866,-1004.5357"/>
<polygon fill="#000000" stroke="#000000" points="2853.7675,-1004.9606 2852.1549,-994.4892 2846.8855,-1003.6807 2853.7675,-1004.9606"/>
</g>
<!-- block_28 -->
<g id="node29" class="node">
<title>block_28</title>
<ellipse fill="none" stroke="#000000" cx="3042.5" cy="-976.501" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3042.5" y="-972.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 83&#45;85</text>
</g>
<!-- section_7&#45;&gt;block_28 -->
<g id="edge28" class="edge">
<title>section_7&#45;&gt;block_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2720.8981,-1673.4368C2717.1969,-1619.0999 2714.0076,-1456.7745 2797.5,-1368.4014 2836.6173,-1326.9975 2879.3172,-1371.7514 2920.5,-1332.4014 3016.0095,-1241.1425 3036.7542,-1071.9534 3041.255,-1004.92"/>
<polygon fill="#000000" stroke="#000000" points="3044.7625,-1004.8967 3041.8657,-994.7055 3037.775,-1004.4788 3044.7625,-1004.8967"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="3629,-1332.3019 3116,-1332.3019 3116,-620.7001 3629,-620.7001 3629,-1332.3019"/>
<text text-anchor="middle" x="3372.5" y="-1317.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">** Csp &#45;&#45; Capture span</text>
<text text-anchor="middle" x="3372.5" y="-1285.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">This is the old&#45;school capture that plays into making named Nodes using</text>
<text text-anchor="middle" x="3372.5" y="-1270.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">epnf.</text>
<text text-anchor="middle" x="3372.5" y="-1239.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3372.5" y="-1223.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="3372.5" y="-1208.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="3372.5" y="-1192.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="3372.5" y="-1177.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="3372.5" y="-1162.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="3372.5" y="-1146.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="3372.5" y="-1131.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="3372.5" y="-1115.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="3372.5" y="-1100.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="3372.5" y="-1085.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="3372.5" y="-1069.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="3372.5" y="-1054.201" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3372.5" y="-1022.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">function epeg.Csp (patt)</text>
<text text-anchor="middle" x="3372.5" y="-1007.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="3372.5" y="-992.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="3372.5" y="-976.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="3372.5" y="-961.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="3372.5" y="-945.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="3372.5" y="-930.4007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3372.5" y="-915.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3372.5" y="-659.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3372.5" y="-644.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">return epeg</text>
<text text-anchor="middle" x="3372.5" y="-628.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_7&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>section_7&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2720.3127,-1673.546C2714.7543,-1618.0956 2706.4123,-1449.7909 2797.5,-1368.4014 2898.5056,-1278.1499 2983.2903,-1395.9307 3106.9716,-1332.2672"/>
<polygon fill="#000000" stroke="#000000" points="3108.8473,-1335.2308 3115.9446,-1327.3645 3105.4909,-1329.0879 3108.8473,-1335.2308"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="964,-487.9012 619,-487.9012 619,-449.3 964,-449.3 964,-487.9012"/>
<text text-anchor="middle" x="791.5" y="-472.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="791.5" y="-457.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = setmetatable({}, {__index = lpeg})</text>
</g>
<!-- codeblock_10&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>codeblock_10&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1033.6328,-958.1699C1030.3254,-903.313 1015.0671,-737.0415 948.5,-620.6006 918.2564,-567.6977 864.1578,-521.3426 828.0452,-494.1451"/>
<polygon fill="#000000" stroke="#000000" points="829.846,-491.1233 819.7282,-487.9799 825.6774,-496.7467 829.846,-491.1233"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1180.5,-488.5027 982.5,-488.5027 982.5,-448.6985 1180.5,-448.6985 1180.5,-488.5027"/>
<text text-anchor="middle" x="1081.5" y="-457.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">Captures one Unicode point</text>
</g>
<!-- block_14&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_14&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1512.6536,-958.4238C1521.7316,-899.8512 1541.4452,-713.7068 1444.5,-620.6006 1361.9485,-541.3182 1290.9873,-637.5229 1189.5,-584.6006 1150.5326,-564.2804 1118.1504,-524.164 1099.304,-496.8619"/>
<polygon fill="#000000" stroke="#000000" points="1102.1563,-494.8314 1093.6694,-488.4892 1096.3489,-498.7397 1102.1563,-494.8314"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1530,-486.6006 1199,-486.6006 1199,-450.6006 1530,-450.6006 1530,-486.6006"/>
<text text-anchor="middle" x="1364.5" y="-465.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">I actually have no idea how to do this yet...</text>
</g>
<!-- block_15&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>block_15&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1640.7123,-958.1648C1643.4947,-902.5932 1645.3411,-732.9795 1574.5,-620.6006 1552.9588,-586.4287 1458.3742,-525.4441 1403.7735,-492.0505"/>
<polygon fill="#000000" stroke="#000000" points="1405.4079,-488.948 1395.0458,-486.7393 1401.7689,-494.9278 1405.4079,-488.948"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1984.5,-486.6006 1548.5,-486.6006 1548.5,-450.6006 1984.5,-450.6006 1984.5,-486.6006"/>
<text text-anchor="middle" x="1766.5" y="-465.1006" font-family="Inconsolata" font-size="14.00" fill="#000000">Looks like byte 97 is just =\97= in Lua. That&#39;s easy enough.</text>
</g>
<!-- block_16&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>block_16&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1769.3932,-958.4246C1768.9449,-882.5273 1767.2128,-589.2843 1766.6663,-496.7468"/>
<polygon fill="#000000" stroke="#000000" points="1770.1662,-496.7041 1766.6071,-486.7249 1763.1663,-496.7455 1770.1662,-496.7041"/>
</g>
<!-- codeblock_21 -->
<g id="node22" class="node">
<title>codeblock_21</title>
<ellipse fill="none" stroke="#000000" cx="2079.5" cy="-468.6006" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2079.5" y="-464.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 24&#45;38</text>
</g>
<!-- block_17&#45;&gt;codeblock_21 -->
<g id="edge21" class="edge">
<title>block_17&#45;&gt;codeblock_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1911.1623,-958.3566C1913.6688,-904.6954 1925.1907,-742.8706 1975.5,-620.6006 1986.3694,-594.1839 2032.7285,-530.5975 2059.7421,-494.5953"/>
<polygon fill="#000000" stroke="#000000" points="2062.6174,-496.5954 2065.8378,-486.5018 2057.0259,-492.384 2062.6174,-496.5954"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2228.5,-486.6006 2174.5,-486.6006 2174.5,-450.6006 2228.5,-450.6006 2228.5,-486.6006"/>
</g>
<!-- block_17&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>block_17&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1907.4653,-958.197C1898.9106,-899.7281 1880.9909,-715.7365 1975.5,-620.6006 2036.0724,-559.6265 2101.3724,-641.824 2165.5,-584.6006 2190.2522,-562.5133 2198.1776,-523.7638 2200.6099,-497.1732"/>
<polygon fill="#000000" stroke="#000000" points="2204.1186,-497.1721 2201.3321,-486.9503 2197.136,-496.6788 2204.1186,-497.1721"/>
</g>
<!-- leaf_22 -->
<g id="node23" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2290.5,-262.5008 1868.5,-262.5008 1868.5,-54.0998 2290.5,-54.0998 2290.5,-262.5008"/>
<text text-anchor="middle" x="2079.5" y="-247.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="2079.5" y="-231.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="2079.5" y="-216.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="2079.5" y="-201.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="2079.5" y="-185.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="2079.5" y="-170.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="2079.5" y="-154.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="2079.5" y="-139.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="2079.5" y="-124.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="2079.5" y="-108.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="2079.5" y="-93.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="2079.5" y="-77.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2079.5" y="-62.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_21&#45;&gt;leaf_22 -->
<g id="edge22" class="edge">
<title>codeblock_21&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2079.5,-450.5763C2079.5,-416.3121 2079.5,-339.2648 2079.5,-272.8772"/>
<polygon fill="#000000" stroke="#000000" points="2083.0001,-272.7447 2079.5,-262.7448 2076.0001,-272.7448 2083.0001,-272.7447"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2760,-495.901 2247,-495.901 2247,-441.3002 2760,-441.3002 2760,-495.901"/>
<text text-anchor="middle" x="2503.5" y="-464.8006" font-family="Inconsolata" font-size="14.00" fill="#000000">This is the old&#45;school capture that plays into making named Nodes using</text>
<text text-anchor="middle" x="2503.5" y="-449.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">epnf.</text>
</g>
<!-- block_26&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_26&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2722.9222,-958.2371C2723.4318,-903.5679 2719.4376,-737.7666 2657.5,-620.6006 2632.0635,-572.483 2586.0917,-530.1437 2550.9763,-502.4546"/>
<polygon fill="#000000" stroke="#000000" points="2552.804,-499.443 2542.7563,-496.0822 2548.5152,-504.9753 2552.804,-499.443"/>
</g>
<!-- codeblock_30 -->
<g id="node31" class="node">
<title>codeblock_30</title>
<ellipse fill="none" stroke="#000000" cx="2855.5" cy="-468.6006" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2855.5" y="-464.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 46&#45;67</text>
</g>
<!-- block_27&#45;&gt;codeblock_30 -->
<g id="edge30" class="edge">
<title>block_27&#45;&gt;codeblock_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2855.5,-958.4246C2855.5,-882.5273 2855.5,-589.2843 2855.5,-496.7468"/>
<polygon fill="#000000" stroke="#000000" points="2859.0001,-496.7249 2855.5,-486.7249 2852.0001,-496.725 2859.0001,-496.7249"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="3004.5,-584.6006 2950.5,-584.6006 2950.5,-352.6006 3004.5,-352.6006 3004.5,-584.6006"/>
</g>
<!-- block_27&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>block_27&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2859.842,-958.4246C2873.7386,-900.5716 2917.9693,-716.4339 2948.0598,-591.1637"/>
<polygon fill="#000000" stroke="#000000" points="2951.54,-591.6604 2950.4724,-581.1195 2944.7336,-590.0254 2951.54,-591.6604"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="3099.5" cy="-468.6006" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3099.5" y="-464.4006" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 83&#45;85</text>
</g>
<!-- block_28&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>block_28&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3044.5287,-958.4246C3053.0464,-882.5273 3085.9561,-589.2843 3096.3412,-496.7468"/>
<polygon fill="#000000" stroke="#000000" points="3099.8288,-497.0529 3097.466,-486.7249 3092.8724,-496.2722 3099.8288,-497.0529"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3248.5,-486.6006 3194.5,-486.6006 3194.5,-450.6006 3248.5,-450.6006 3248.5,-486.6006"/>
</g>
<!-- block_28&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_28&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3040.3255,-958.2899C3034.5847,-901.6268 3024.6464,-725.9438 3106.5,-620.6006 3130.1744,-590.1324 3159.9978,-613.5562 3185.5,-584.6006 3207.0846,-560.093 3215.7288,-522.7825 3219.1899,-497.1299"/>
<polygon fill="#000000" stroke="#000000" points="3222.6984,-497.2587 3220.3785,-486.921 3215.7454,-496.4491 3222.6984,-497.2587"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="3060.5,-316.4011 2596.5,-316.4011 2596.5,-.1995 3060.5,-.1995 3060.5,-316.4011"/>
<text text-anchor="middle" x="2828.5" y="-301.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="2828.5" y="-286.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="2828.5" y="-270.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="2828.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="2828.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="2828.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="2828.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="2828.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="2828.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2828.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="2828.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2828.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2828.5" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">function epeg.Csp (patt)</text>
<text text-anchor="middle" x="2828.5" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="2828.5" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="2828.5" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="2828.5" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="2828.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="2828.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_30&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>codeblock_30&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2853.9317,-450.5763C2851.737,-425.3536 2847.5251,-376.9478 2843.1508,-326.6765"/>
<polygon fill="#000000" stroke="#000000" points="2846.6281,-326.2626 2842.2744,-316.6036 2839.6545,-326.8694 2846.6281,-326.2626"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3172,-176.3003 3079,-176.3003 3079,-140.3003 3172,-140.3003 3172,-176.3003"/>
<text text-anchor="middle" x="3125.5" y="-154.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">return epeg</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>codeblock_33&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3101.0103,-450.5763C3105.3453,-398.8395 3117.8533,-249.5611 3123.1188,-186.7191"/>
<polygon fill="#000000" stroke="#000000" points="3126.6383,-186.6317 3123.9856,-176.3743 3119.6627,-186.0471 3126.6383,-186.6317"/>
</g>
</g>
</svg>