<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2765pt" height="722pt"
 viewBox="0.00 0.00 2765.00 722.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 718.2007)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-718.2007 2761,-718.2007 2761,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="733.5" cy="-696.2007" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="733.5" y="-692.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 85</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="733.5" cy="-624.2007" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="733.5" y="-620.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;40</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M733.5,-678.0321C733.5,-670.3317 733.5,-661.1751 733.5,-652.6174"/>
<polygon fill="#000000" stroke="#000000" points="737.0001,-652.6139 733.5,-642.614 730.0001,-652.614 737.0001,-652.6139"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="423.5" cy="-552.2007" rx="113.2139" ry="18"/>
<text text-anchor="middle" x="423.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Extended Lpeg module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M685.4026,-613.0297C635.1637,-601.3613 555.711,-582.9078 497.48,-569.3832"/>
<polygon fill="#000000" stroke="#000000" points="498.1292,-565.9409 487.5967,-567.0877 496.5455,-572.7594 498.1292,-565.9409"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="587.5" cy="-552.2007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="587.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M702.1793,-608.7549C678.3612,-597.009 645.6407,-580.8728 621.2451,-568.8421"/>
<polygon fill="#000000" stroke="#000000" points="622.5272,-565.572 612.0104,-564.288 619.4311,-571.8501 622.5272,-565.572"/>
</g>
<!-- prose_4 -->
<g id="node5" class="node">
<title>prose_4</title>
<ellipse fill="none" stroke="#000000" cx="669.5" cy="-552.2007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="669.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;prose_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M718.0074,-606.7715C709.834,-597.5765 699.6821,-586.1556 690.7811,-576.142"/>
<polygon fill="#000000" stroke="#000000" points="693.2322,-573.6312 683.9726,-568.4824 688.0003,-578.2818 693.2322,-573.6312"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="797.5" cy="-552.2007" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="797.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 10&#45;14</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M748.9926,-606.7715C756.7383,-598.0577 766.2608,-587.3449 774.8116,-577.7252"/>
<polygon fill="#000000" stroke="#000000" points="777.6777,-579.769 781.7054,-569.9696 772.4458,-575.1184 777.6777,-579.769"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="1312.5" cy="-552.2007" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1312.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;40</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M789.543,-617.2316C895.7436,-604.0253 1126.0556,-575.3855 1242.3307,-560.9264"/>
<polygon fill="#000000" stroke="#000000" points="1243.0488,-564.3642 1252.5404,-559.6568 1242.1849,-557.4177 1243.0488,-564.3642"/>
</g>
<!-- section_7 -->
<g id="node8" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="2173.5" cy="-552.2007" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2173.5" y="-548.0007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 41&#45;85</text>
</g>
<!-- section_1&#45;&gt;section_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;section_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M793.5417,-621.1986C1023.1022,-609.7206 1845.0355,-568.6239 2098.5201,-555.9497"/>
<polygon fill="#000000" stroke="#000000" points="2098.9176,-559.4343 2108.7303,-555.4392 2098.568,-552.443 2098.9176,-559.4343"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="450.5,-496.8007 396.5,-496.8007 396.5,-460.8007 450.5,-460.8007 450.5,-496.8007"/>
</g>
<!-- header_2&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>header_2&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M423.5,-534.0569C423.5,-525.9404 423.5,-516.1808 423.5,-507.1369"/>
<polygon fill="#000000" stroke="#000000" points="427.0001,-506.9901 423.5,-496.9902 420.0001,-506.9902 427.0001,-506.9901"/>
</g>
<!-- raw_9 -->
<g id="node10" class="node">
<title>raw_9</title>
<ellipse fill="none" stroke="#000000" cx="501.5" cy="-478.8007" rx="27" ry="18"/>
<text text-anchor="middle" x="501.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_3&#45;&gt;raw_9 -->
<g id="edge9" class="edge">
<title>prose_3&#45;&gt;raw_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M569.6807,-536.9922C557.0135,-526.1808 539.8449,-511.5276 525.9053,-499.6303"/>
<polygon fill="#000000" stroke="#000000" points="528.0079,-496.8234 518.1294,-492.9937 523.4636,-502.1478 528.0079,-496.8234"/>
</g>
<!-- raw_11 -->
<g id="node12" class="node">
<title>raw_11</title>
<ellipse fill="none" stroke="#000000" cx="579.5" cy="-478.8007" rx="27" ry="18"/>
<text text-anchor="middle" x="579.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_4&#45;&gt;raw_11 -->
<g id="edge11" class="edge">
<title>prose_4&#45;&gt;raw_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M651.2872,-537.3471C637.8523,-526.3903 619.4091,-511.3488 604.5809,-499.2555"/>
<polygon fill="#000000" stroke="#000000" points="606.7313,-496.493 596.7697,-492.8851 602.3072,-501.9176 606.7313,-496.493"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="970,-498.1013 625,-498.1013 625,-459.5001 970,-459.5001 970,-498.1013"/>
<text text-anchor="middle" x="797.5" y="-483.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local lpeg = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="797.5" y="-467.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = setmetatable({}, {__index = lpeg})</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M797.5,-534.0569C797.5,-526.3305 797.5,-517.115 797.5,-508.4454"/>
<polygon fill="#000000" stroke="#000000" points="801.0001,-508.2778 797.5,-498.2778 794.0001,-508.2779 801.0001,-508.2778"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="1104.5" cy="-478.8007" rx="116.5627" ry="18"/>
<text text-anchor="middle" x="1104.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Ppt &#45;&#45; Codepoint pattern</text>
</g>
<!-- section_6&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_6&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1271.9017,-537.8742C1240.3464,-526.7388 1196.1985,-511.1597 1161.1624,-498.796"/>
<polygon fill="#000000" stroke="#000000" points="1162.1348,-495.4277 1151.54,-495.4004 1159.8054,-502.0287 1162.1348,-495.4277"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="1271.5" cy="-478.8007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1271.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_6&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1302.3652,-534.0569C1297.4772,-525.3063 1291.5224,-514.6457 1286.152,-505.0313"/>
<polygon fill="#000000" stroke="#000000" points="1289.1682,-503.2539 1281.2359,-496.2304 1283.057,-506.6675 1289.1682,-503.2539"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="1353.5" cy="-478.8007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1353.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_6&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1322.6348,-534.0569C1327.5228,-525.3063 1333.4776,-514.6457 1338.848,-505.0313"/>
<polygon fill="#000000" stroke="#000000" points="1341.943,-506.6675 1343.7641,-496.2304 1335.8318,-503.2539 1341.943,-506.6675"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="1435.5" cy="-478.8007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1435.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_6&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>section_6&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1340.1036,-535.7283C1359.2673,-524.2924 1384.8167,-509.0458 1404.6515,-497.2095"/>
<polygon fill="#000000" stroke="#000000" points="1406.5254,-500.1671 1413.3191,-492.0371 1402.9383,-494.156 1406.5254,-500.1671"/>
</g>
<!-- codeblock_18 -->
<g id="node19" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="1627.5" cy="-478.8007" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1627.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 24&#45;38</text>
</g>
<!-- section_6&#45;&gt;codeblock_18 -->
<g id="edge18" class="edge">
<title>section_6&#45;&gt;codeblock_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1362.761,-540.4891C1416.9464,-527.863 1503.3814,-507.7223 1562.6526,-493.9112"/>
<polygon fill="#000000" stroke="#000000" points="1563.7103,-497.2586 1572.6551,-491.5804 1562.1217,-490.4412 1563.7103,-497.2586"/>
</g>
<!-- header_27 -->
<g id="node28" class="node">
<title>header_27</title>
<ellipse fill="none" stroke="#000000" cx="2021.5" cy="-478.8007" rx="102.0437" ry="18"/>
<text text-anchor="middle" x="2021.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Csp &#45;&#45; Capture span</text>
</g>
<!-- section_7&#45;&gt;header_27 -->
<g id="edge27" class="edge">
<title>section_7&#45;&gt;header_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2140.8922,-536.4546C2119.0216,-525.8934 2089.9412,-511.8506 2065.9564,-500.2685"/>
<polygon fill="#000000" stroke="#000000" points="2067.2301,-496.9969 2056.7031,-495.8001 2064.1861,-503.3004 2067.2301,-496.9969"/>
</g>
<!-- prose_28 -->
<g id="node29" class="node">
<title>prose_28</title>
<ellipse fill="none" stroke="#000000" cx="2173.5" cy="-478.8007" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2173.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_7&#45;&gt;prose_28 -->
<g id="edge28" class="edge">
<title>section_7&#45;&gt;prose_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2173.5,-534.0569C2173.5,-525.9404 2173.5,-516.1808 2173.5,-507.1369"/>
<polygon fill="#000000" stroke="#000000" points="2177.0001,-506.9901 2173.5,-496.9902 2170.0001,-506.9902 2177.0001,-506.9901"/>
</g>
<!-- codeblock_29 -->
<g id="node30" class="node">
<title>codeblock_29</title>
<ellipse fill="none" stroke="#000000" cx="2375.5" cy="-478.8007" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2375.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 46&#45;67</text>
</g>
<!-- section_7&#45;&gt;codeblock_29 -->
<g id="edge29" class="edge">
<title>section_7&#45;&gt;codeblock_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2213.4087,-537.6992C2245.1481,-526.1662 2289.7805,-509.9483 2324.1771,-497.4497"/>
<polygon fill="#000000" stroke="#000000" points="2325.3846,-500.7349 2333.588,-494.0301 2322.9939,-494.1558 2325.3846,-500.7349"/>
</g>
<!-- codeblock_30 -->
<g id="node31" class="node">
<title>codeblock_30</title>
<ellipse fill="none" stroke="#000000" cx="2647.5" cy="-478.8007" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2647.5" y="-474.6007" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 83&#45;85</text>
</g>
<!-- section_7&#45;&gt;codeblock_30 -->
<g id="edge30" class="edge">
<title>section_7&#45;&gt;codeblock_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2230.6755,-543.347C2316.3206,-530.0846 2477.9702,-505.0528 2572.831,-490.3634"/>
<polygon fill="#000000" stroke="#000000" points="2573.5809,-493.789 2582.9275,-488.7999 2572.5096,-486.8715 2573.5809,-493.789"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="443,-308.4007 0,-308.4007 0,-221.8001 443,-221.8001 443,-308.4007"/>
<text text-anchor="middle" x="221.5" y="-245.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is where we add extended captures a la the old =epeg= </text>
<text text-anchor="middle" x="221.5" y="-229.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">module.</text>
</g>
<!-- raw_9&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>raw_9&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M483.5588,-465.1077C444.6088,-435.3804 350.6565,-363.6746 286.507,-314.7147"/>
<polygon fill="#000000" stroke="#000000" points="288.519,-311.8474 278.4462,-308.5626 284.2721,-317.4119 288.519,-311.8474"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="939.5,-292.4008 461.5,-292.4008 461.5,-237.7999 939.5,-237.7999 939.5,-292.4008"/>
<text text-anchor="middle" x="700.5" y="-261.3004" font-family="Inconsolata" font-size="14.00" fill="#000000">The difference here is that we include lpeg as a metatable __index</text>
<text text-anchor="middle" x="700.5" y="-245.9004" font-family="Inconsolata" font-size="14.00" fill="#000000">and can therefore use elpeg as L everywhere we currently use lpeg.</text>
</g>
<!-- raw_11&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>raw_11&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M589.1974,-461.6739C608.8078,-427.0396 653.55,-348.0197 679.9471,-301.3991"/>
<polygon fill="#000000" stroke="#000000" points="683.0876,-302.9562 684.9691,-292.5298 676.9962,-299.5072 683.0876,-302.9562"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1131.5,-283.1004 1077.5,-283.1004 1077.5,-247.1004 1131.5,-247.1004 1131.5,-283.1004"/>
</g>
<!-- header_14&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>header_14&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1104.5,-460.5807C1104.5,-423.2821 1104.5,-337.9957 1104.5,-293.4203"/>
<polygon fill="#000000" stroke="#000000" points="1108.0001,-293.2742 1104.5,-283.2742 1101.0001,-293.2742 1108.0001,-293.2742"/>
</g>
<!-- raw_20 -->
<g id="node21" class="node">
<title>raw_20</title>
<ellipse fill="none" stroke="#000000" cx="1223.5" cy="-265.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="1223.5" y="-260.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_15&#45;&gt;raw_20 -->
<g id="edge20" class="edge">
<title>prose_15&#45;&gt;raw_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1267.4075,-460.5807C1258.9911,-423.1098 1239.6961,-337.2068 1229.7229,-292.8051"/>
<polygon fill="#000000" stroke="#000000" points="1233.1209,-291.9626 1227.5144,-282.9728 1226.2911,-293.4968 1233.1209,-291.9626"/>
</g>
<!-- raw_22 -->
<g id="node23" class="node">
<title>raw_22</title>
<ellipse fill="none" stroke="#000000" cx="1324.5" cy="-265.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="1324.5" y="-260.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_16&#45;&gt;raw_22 -->
<g id="edge22" class="edge">
<title>prose_16&#45;&gt;raw_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1351.0275,-460.5807C1345.9659,-423.2821 1334.3922,-337.9957 1328.3431,-293.4203"/>
<polygon fill="#000000" stroke="#000000" points="1331.7793,-292.7127 1326.9663,-283.2742 1324.8429,-293.6541 1331.7793,-292.7127"/>
</g>
<!-- raw_24 -->
<g id="node25" class="node">
<title>raw_24</title>
<ellipse fill="none" stroke="#000000" cx="1435.5" cy="-265.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="1435.5" y="-260.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_17&#45;&gt;raw_24 -->
<g id="edge24" class="edge">
<title>prose_17&#45;&gt;raw_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1435.5,-460.5807C1435.5,-423.2821 1435.5,-337.9957 1435.5,-293.4203"/>
<polygon fill="#000000" stroke="#000000" points="1439.0001,-293.2742 1435.5,-283.2742 1432.0001,-293.2742 1439.0001,-293.2742"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1902.5,-369.3009 1480.5,-369.3009 1480.5,-160.8999 1902.5,-160.8999 1902.5,-369.3009"/>
<text text-anchor="middle" x="1691.5" y="-354.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function num_bytes(str)</text>
<text text-anchor="middle" x="1691.5" y="-338.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45;returns the number of bytes in the next character in str</text>
<text text-anchor="middle" x="1691.5" y="-323.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local c = str:byte(1)</text>
<text text-anchor="middle" x="1691.5" y="-307.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if c &gt;= 0x00 and c &lt;= 0x7F then</text>
<text text-anchor="middle" x="1691.5" y="-292.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 1</text>
<text text-anchor="middle" x="1691.5" y="-277.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xC2 and c &lt;= 0xDF then</text>
<text text-anchor="middle" x="1691.5" y="-261.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 2</text>
<text text-anchor="middle" x="1691.5" y="-246.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xE0 and c &lt;= 0xEF then</text>
<text text-anchor="middle" x="1691.5" y="-230.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 3</text>
<text text-anchor="middle" x="1691.5" y="-215.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;elseif c &gt;= 0xF0 and c &lt;= 0xF4 then</text>
<text text-anchor="middle" x="1691.5" y="-200.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return 4</text>
<text text-anchor="middle" x="1691.5" y="-184.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1691.5" y="-169.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_18&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1632.9566,-460.5807C1638.5725,-441.8289 1647.8209,-410.9479 1657.3262,-379.2088"/>
<polygon fill="#000000" stroke="#000000" points="1660.7645,-379.9275 1660.2807,-369.3437 1654.0588,-377.9192 1660.7645,-379.9275"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1117.5,-63.3015 919.5,-63.3015 919.5,-7.4985 1117.5,-7.4985 1117.5,-63.3015"/>
<text text-anchor="middle" x="1018.5" y="-15.9" font-family="Inconsolata" font-size="14.00" fill="#000000">Captures one Unicode point</text>
</g>
<!-- raw_20&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>raw_20&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1217.9115,-247.4648C1207.2101,-215.9901 1181.2082,-149.4503 1140.5,-106.8001 1126.084,-91.6964 1107.7754,-78.7457 1089.7536,-68.1852"/>
<polygon fill="#000000" stroke="#000000" points="1091.3735,-65.0803 1080.9479,-63.194 1087.9217,-71.1701 1091.3735,-65.0803"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1467,-55.3021 1136,-55.3021 1136,-15.4979 1467,-15.4979 1467,-55.3021"/>
<text text-anchor="middle" x="1301.5" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">I actually have no idea how to do this yet...</text>
</g>
<!-- raw_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>raw_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1322.6952,-247.0762C1318.7571,-207.7462 1309.3583,-113.8811 1304.5088,-65.4487"/>
<polygon fill="#000000" stroke="#000000" points="1307.9699,-64.8842 1303.4909,-55.2827 1301.0047,-65.5817 1307.9699,-64.8842"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="1921.5,-55.3021 1485.5,-55.3021 1485.5,-15.4979 1921.5,-15.4979 1921.5,-55.3021"/>
<text text-anchor="middle" x="1703.5" y="-23.9" font-family="Inconsolata" font-size="14.00" fill="#000000">Looks like byte 97 is just =\97= in Lua. That&#39;s easy enough.</text>
</g>
<!-- raw_24&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>raw_24&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1434.1926,-247.0446C1432.879,-214.6 1434.9835,-146.1613 1471.5,-106.8001 1489.2377,-87.6806 1544.0559,-70.3587 1595.9524,-57.5655"/>
<polygon fill="#000000" stroke="#000000" points="1597.0428,-60.9027 1605.9393,-55.1491 1595.3966,-54.099 1597.0428,-60.9027"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2048.5,-283.1004 1994.5,-283.1004 1994.5,-247.1004 2048.5,-247.1004 2048.5,-283.1004"/>
</g>
<!-- header_27&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>header_27&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2021.5,-460.5807C2021.5,-423.2821 2021.5,-337.9957 2021.5,-293.4203"/>
<polygon fill="#000000" stroke="#000000" points="2025.0001,-293.2742 2021.5,-283.2742 2018.0001,-293.2742 2025.0001,-293.2742"/>
</g>
<!-- raw_32 -->
<g id="node33" class="node">
<title>raw_32</title>
<ellipse fill="none" stroke="#000000" cx="2136.5" cy="-265.1004" rx="27" ry="18"/>
<text text-anchor="middle" x="2136.5" y="-260.9004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">raw</text>
</g>
<!-- prose_28&#45;&gt;raw_32 -->
<g id="edge32" class="edge">
<title>prose_28&#45;&gt;raw_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2170.3454,-460.5807C2163.8739,-423.2032 2149.0586,-337.6349 2141.3544,-293.1381"/>
<polygon fill="#000000" stroke="#000000" points="2144.8014,-292.5305 2139.6466,-283.2742 2137.904,-293.7247 2144.8014,-292.5305"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="2645.5,-423.2012 2181.5,-423.2012 2181.5,-106.9995 2645.5,-106.9995 2645.5,-423.2012"/>
<text text-anchor="middle" x="2413.5" y="-408.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function spanner(first, last, str, root)</text>
<text text-anchor="middle" x="2413.5" y="-392.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local vals = {}</text>
<text text-anchor="middle" x="2413.5" y="-377.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.span = true</text>
<text text-anchor="middle" x="2413.5" y="-362.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.val = string.sub(str, first, last &#45; 1)</text>
<text text-anchor="middle" x="2413.5" y="-346.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.first = first</text>
<text text-anchor="middle" x="2413.5" y="-331.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;vals.last = last &#45; 1</text>
<text text-anchor="middle" x="2413.5" y="-315.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if vals.last &gt;= vals.first then</text>
<text text-anchor="middle" x="2413.5" y="-300.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return vals</text>
<text text-anchor="middle" x="2413.5" y="-285.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="2413.5" y="-269.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45;&#45; If a capture contains nothing, we don&#39;t want a node for it</text>
<text text-anchor="middle" x="2413.5" y="-254.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return nil</text>
<text text-anchor="middle" x="2413.5" y="-238.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2413.5" y="-207.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">function epeg.Csp (patt)</text>
<text text-anchor="middle" x="2413.5" y="-192.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return lpeg.Cp() </text>
<text text-anchor="middle" x="2413.5" y="-176.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cmt(patt, function() return true end) </text>
<text text-anchor="middle" x="2413.5" y="-161.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Cp() </text>
<text text-anchor="middle" x="2413.5" y="-145.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(1) </text>
<text text-anchor="middle" x="2413.5" y="-130.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;* lpeg.Carg(2) / spanner</text>
<text text-anchor="middle" x="2413.5" y="-115.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_29&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>codeblock_29&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2378.7399,-460.5807C2380.059,-453.162 2381.7158,-443.8448 2383.5861,-433.3271"/>
<polygon fill="#000000" stroke="#000000" points="2387.0552,-433.8089 2385.3601,-423.3505 2380.1633,-432.5833 2387.0552,-433.8089"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="2757,-283.1004 2664,-283.1004 2664,-247.1004 2757,-247.1004 2757,-283.1004"/>
<text text-anchor="middle" x="2710.5" y="-261.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">return epeg</text>
</g>
<!-- codeblock_30&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>codeblock_30&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2652.8713,-460.5807C2663.8904,-423.2032 2689.1164,-337.6349 2702.2343,-293.1381"/>
<polygon fill="#000000" stroke="#000000" points="2705.6716,-293.8558 2705.1423,-283.2742 2698.9573,-291.8764 2705.6716,-293.8558"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="2453,-70.7004 1940,-70.7004 1940,-.0997 2453,-.0997 2453,-70.7004"/>
<text text-anchor="middle" x="2196.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">This is the old&#45;school capture that plays into making named Nodes using</text>
<text text-anchor="middle" x="2196.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">epnf.</text>
</g>
<!-- raw_32&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>raw_32&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2140.0163,-246.9087C2145.8754,-217.3132 2158.3944,-156.997 2172.5,-106.8001 2174.9162,-98.2017 2177.7514,-89.1093 2180.61,-80.3984"/>
<polygon fill="#000000" stroke="#000000" points="2183.9768,-81.3662 2183.8263,-70.7725 2177.3376,-79.1478 2183.9768,-81.3662"/>
</g>
</g>
</svg>