<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="15631pt" height="7369pt"
 viewBox="0.00 0.00 15631.00 7368.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 7364.811)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-7364.811 15627,-7364.811 15627,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1154.5" cy="-7342.811" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1154.5" y="-7338.611" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 272</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1154.5" cy="-7270.811" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1154.5" y="-7266.611" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;177</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1154.5,-7324.6423C1154.5,-7316.9419 1154.5,-7307.7853 1154.5,-7299.2276"/>
<polygon fill="#000000" stroke="#000000" points="1158.0001,-7299.2242 1154.5,-7289.2243 1151.0001,-7299.2243 1158.0001,-7299.2242"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="504.5" cy="-5829.6089" rx="43.5751" ry="18"/>
<text text-anchor="middle" x="504.5" y="-5825.4089" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Node</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1088.8213,-7269.6725C941.0737,-7266.4431 592.5751,-7254.835 556.5,-7216.811 175.0676,-6814.7729 436.92,-6015.7334 494.1579,-5857.2863"/>
<polygon fill="#000000" stroke="#000000" points="497.4841,-5858.381 497.6232,-5847.7871 490.908,-5855.982 497.4841,-5858.381"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="621.5" cy="-5829.6089" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="621.5" y="-5825.4089" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;177</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1089.2653,-7267.8966C967.0673,-7261.7799 713.509,-7245.7236 686.5,-7216.811 495.3731,-7012.2135 597.5436,-6037.0537 618.141,-5857.9169"/>
<polygon fill="#000000" stroke="#000000" points="621.6217,-5858.2853 619.298,-5847.9484 614.6684,-5857.4782 621.6217,-5858.2853"/>
</g>
<!-- section_4 -->
<g id="node5" class="node">
<title>section_4</title>
<ellipse fill="none" stroke="#000000" cx="756.5" cy="-5829.6089" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="756.5" y="-5825.4089" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 6&#45;12</text>
</g>
<!-- section_1&#45;&gt;section_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;section_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1149.5399,-7252.8497C1107.832,-7101.8211 815.9077,-6044.7307 764.2902,-5857.8181"/>
<polygon fill="#000000" stroke="#000000" points="767.5951,-5856.637 761.5594,-5847.9295 760.8477,-5858.5004 767.5951,-5856.637"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="1407.5" cy="-5829.6089" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1407.5" y="-5825.4089" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 13&#45;35</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1157.6989,-7252.5889C1184.3801,-7100.6005 1369.7736,-6044.5155 1402.5529,-5857.7895"/>
<polygon fill="#000000" stroke="#000000" points="1406.0053,-5858.3654 1404.2871,-5847.9108 1399.1107,-5857.155 1406.0053,-5858.3654"/>
</g>
<!-- section_6 -->
<g id="node7" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="7121.5" cy="-5829.6089" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="7121.5" y="-5825.4089" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 178&#45;237</text>
</g>
<!-- section_1&#45;&gt;section_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;section_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1213.1138,-7262.5712C1278.9295,-7252.9921 1388.7926,-7236.0203 1482.5,-7216.811 3806.7236,-6740.3633 6622.9856,-5967.6357 7062.6084,-5845.9604"/>
<polygon fill="#000000" stroke="#000000" points="7063.5468,-5849.3323 7072.2502,-5843.2907 7061.6789,-5842.5861 7063.5468,-5849.3323"/>
</g>
<!-- leaf_137 -->
<g id="node138" class="node">
<title>leaf_137</title>
<polygon fill="none" stroke="#c0c0c0" points="7762.5,-7217.0131 7214.5,-7217.0131 7214.5,-4442.2046 7762.5,-4442.2046 7762.5,-7217.0131"/>
<text text-anchor="middle" x="7488.5" y="-7201.611" font-family="Inconsolata" font-size="14.00" fill="#000000">* Node</text>
<text text-anchor="middle" x="7488.5" y="-7154.211" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Time to stabilize this class once and for all. </text>
<text text-anchor="middle" x="7488.5" y="-7122.8109" font-family="Inconsolata" font-size="14.00" fill="#000000">*** includes</text>
<text text-anchor="middle" x="7488.5" y="-7091.4109" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-7076.0109" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="7488.5" y="-7060.6108" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot = require &quot;node/dot&quot;</text>
<text text-anchor="middle" x="7488.5" y="-7045.2108" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-7013.8108" font-family="Inconsolata" font-size="14.00" fill="#000000">** Node metatable</text>
<text text-anchor="middle" x="7488.5" y="-6982.4107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The Node metatable is the root table for any Node. &#160;I&#39;m planning to make</text>
<text text-anchor="middle" x="7488.5" y="-6967.0107" font-family="Inconsolata" font-size="14.00" fill="#000000">an intermediate class/table called Root that is in common for any instance</text>
<text text-anchor="middle" x="7488.5" y="-6951.6107" font-family="Inconsolata" font-size="14.00" fill="#000000">Node. &#160;All Root absolutely has to contain is =str=. </text>
<text text-anchor="middle" x="7488.5" y="-6920.2106" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-6888.8106" font-family="Inconsolata" font-size="14.00" fill="#000000">local N = {}</text>
<text text-anchor="middle" x="7488.5" y="-6873.4106" font-family="Inconsolata" font-size="14.00" fill="#000000">N.__index = N</text>
<text text-anchor="middle" x="7488.5" y="-6858.0105" font-family="Inconsolata" font-size="14.00" fill="#000000">N.isNode = true</text>
<text text-anchor="middle" x="7488.5" y="-6842.6105" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-6779.2105" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Fields</text>
<text text-anchor="middle" x="7488.5" y="-6747.8105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; id : &#160;A string naming the Node. </text>
<text text-anchor="middle" x="7488.5" y="-6732.4104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;This is identical to the name of the pattern that recognizes</text>
<text text-anchor="middle" x="7488.5" y="-6717.0104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or captures it.</text>
<text text-anchor="middle" x="7488.5" y="-6701.6104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_first : &#160;Always &#45;1.</text>
<text text-anchor="middle" x="7488.5" y="-6686.2103" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_last &#160;: &#160;Always &#45;1. </text>
<text text-anchor="middle" x="7488.5" y="-6654.8103" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Methods</text>
<text text-anchor="middle" x="7488.5" y="-6623.4103" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-6608.0102" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toString(node, depth)</text>
<text text-anchor="middle" x="7488.5" y="-6592.6102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = depth or 0</text>
<text text-anchor="middle" x="7488.5" y="-6577.2102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="7488.5" y="-6561.8101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;phrase = (&quot; &#160;&quot;):rep(depth) .. &quot;id: &quot; .. node.id .. &quot;, &#160;&quot;</text>
<text text-anchor="middle" x="7488.5" y="-6546.4101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. &quot;first: &quot; .. node.first .. &quot;, last: &quot; .. node.last .. &quot;\n&quot;</text>
<text text-anchor="middle" x="7488.5" y="-6531.0101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if node[1] then</text>
<text text-anchor="middle" x="7488.5" y="-6515.61" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(node) do</text>
<text text-anchor="middle" x="7488.5" y="-6500.21" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if(v.isNode) then</text>
<text text-anchor="middle" x="7488.5" y="-6484.81" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. N.toString(v, depth + 1)</text>
<text text-anchor="middle" x="7488.5" y="-6469.41" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-6454.0099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-6438.6099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end </text>
<text text-anchor="middle" x="7488.5" y="-6423.2099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="7488.5" y="-6407.8098" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-6392.4098" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-6361.0098" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-6345.6097" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dotLabel(node)</text>
<text text-anchor="middle" x="7488.5" y="-6330.2097" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.id</text>
<text text-anchor="middle" x="7488.5" y="-6314.8097" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-6283.4096" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toMarkdown(node)</text>
<text text-anchor="middle" x="7488.5" y="-6268.0096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if not node[1] then</text>
<text text-anchor="middle" x="7488.5" y="-6252.6096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return string.sub(node.str, node.first, node.last)</text>
<text text-anchor="middle" x="7488.5" y="-6237.2095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="7488.5" y="-6221.8095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no toMarkdown for &quot; .. node.id)</text>
<text text-anchor="middle" x="7488.5" y="-6206.4095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7488.5" y="-6191.0095" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-6159.6094" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dot(node)</text>
<text text-anchor="middle" x="7488.5" y="-6144.2094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return dot.dot(node)</text>
<text text-anchor="middle" x="7488.5" y="-6128.8094" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-6097.4093" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toValue(node)</text>
<text text-anchor="middle" x="7488.5" y="-6082.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.str:sub(node.first,node.last)</text>
<text text-anchor="middle" x="7488.5" y="-6066.6093" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-6035.2092" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-6003.8092" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walkDeep</text>
<text text-anchor="middle" x="7488.5" y="-5972.4092" font-family="Inconsolata" font-size="14.00" fill="#000000">Depth&#45;first iterator. </text>
<text text-anchor="middle" x="7488.5" y="-5941.0091" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-5925.6091" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walkDeep(node)</text>
<text text-anchor="middle" x="7488.5" y="-5910.2091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="7488.5" y="-5894.8091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="7488.5" y="-5863.409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="7488.5" y="-5848.009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="7488.5" y="-5832.609" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="7488.5" y="-5817.2089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5801.8089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5786.4089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="7488.5" y="-5771.0088" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5739.6088" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="7488.5" y="-5724.2088" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-5708.8087" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-5677.4087" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walk</text>
<text text-anchor="middle" x="7488.5" y="-5646.0087" font-family="Inconsolata" font-size="14.00" fill="#000000">Breadth&#45;first iterator. &#160;This is the default. </text>
<text text-anchor="middle" x="7488.5" y="-5614.6086" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-5599.2086" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walk(node)</text>
<text text-anchor="middle" x="7488.5" y="-5583.8086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="7488.5" y="-5568.4086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="7488.5" y="-5537.0085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="7488.5" y="-5521.6085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="7488.5" y="-5506.2085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="7488.5" y="-5490.8084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="7488.5" y="-5475.4084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5460.0084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5444.6083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5413.2083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="7488.5" y="-5397.8083" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-5366.4082" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-5319.0082" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.select(node, pred)</text>
<text text-anchor="middle" x="7488.5" y="-5287.6082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes the Node and walks it, yielding the Nodes which match the predicate.</text>
<text text-anchor="middle" x="7488.5" y="-5272.2081" font-family="Inconsolata" font-size="14.00" fill="#000000">=pred= is either a string, which matches to =id=, or a function, which takes</text>
<text text-anchor="middle" x="7488.5" y="-5256.8081" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node and returns true or false on some premise. </text>
<text text-anchor="middle" x="7488.5" y="-5225.4081" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-5210.0081" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.select(node, pred)</text>
<text text-anchor="middle" x="7488.5" y="-5194.608" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function qualifies(node, pred)</text>
<text text-anchor="middle" x="7488.5" y="-5179.208" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(pred) == &#39;string&#39; then</text>
<text text-anchor="middle" x="7488.5" y="-5163.808" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(node) == &#39;table&#39; and node.isNode and node.id == pred then</text>
<text text-anchor="middle" x="7488.5" y="-5148.4079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="7488.5" y="-5133.0079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7488.5" y="-5117.6079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="7488.5" y="-5102.2078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5086.8078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(pred) == &#39;function&#39; then</text>
<text text-anchor="middle" x="7488.5" y="-5071.4078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return pred(node)</text>
<text text-anchor="middle" x="7488.5" y="-5056.0077" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7488.5" y="-5040.6077" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:halt(&quot;cannot select on predicate of type &quot; .. type(pred))</text>
<text text-anchor="middle" x="7488.5" y="-5025.2077" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-5009.8076" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4978.4076" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="7488.5" y="-4963.0076" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if qualifies(ast, pred) then</text>
<text text-anchor="middle" x="7488.5" y="-4947.6076" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="7488.5" y="-4932.2075" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4916.8075" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="7488.5" y="-4901.4075" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="7488.5" y="-4886.0074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="7488.5" y="-4870.6074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4855.2074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4839.8073" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4808.4073" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="7488.5" y="-4793.0073" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7488.5" y="-4777.6072" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="7488.5" y="-4730.2072" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.tokens(node)</text>
<text text-anchor="middle" x="7488.5" y="-4698.8072" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Iterator returning all &#39;captured&#39; values as strings.</text>
<text text-anchor="middle" x="7488.5" y="-4667.4071" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="7488.5" y="-4652.0071" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.tokens(node)</text>
<text text-anchor="middle" x="7488.5" y="-4636.6071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="7488.5" y="-4621.2071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for node in N.walk(ast) do</text>
<text text-anchor="middle" x="7488.5" y="-4605.807" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not node[1] then</text>
<text text-anchor="middle" x="7488.5" y="-4590.407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(node:toValue())</text>
<text text-anchor="middle" x="7488.5" y="-4575.007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4559.6069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4544.2069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7488.5" y="-4512.8069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="7488.5" y="-4497.4068" font-family="Inconsolata" font-size="14.00" fill="#000000">end &#160;</text>
<text text-anchor="middle" x="7488.5" y="-4482.0068" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua &#160;</text>
<text text-anchor="middle" x="7488.5" y="-4450.6068" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_1&#45;&gt;leaf_137 -->
<g id="edge137" class="edge">
<title>section_1&#45;&gt;leaf_137</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1220.2095,-7270.7923C1871.4077,-7270.541 7144.6461,-7266.9579 7205.5,-7216.811 7205.8705,-7216.5057 7206.2406,-7216.2 7206.6102,-7215.8941"/>
<polygon fill="#000000" stroke="#000000" points="7208.9115,-7218.532 7214.3149,-7209.4186 7204.4076,-7213.1733 7208.9115,-7218.532"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="359,-3954.6076 0,-3954.6076 0,-3898.8046 359,-3898.8046 359,-3954.6076"/>
<text text-anchor="middle" x="179.5" y="-3907.2061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Time to stabilize this class once and for all. </text>
</g>
<!-- block_3&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>block_3&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M623.5893,-5811.3847C640.1499,-5663.3638 744.7661,-4658.1636 557.5,-4442.4067 501.1632,-4377.4989 433.6619,-4461.2653 367.5,-4406.4067 227.5782,-4290.3897 191.3346,-4056.3106 182.3365,-3964.6953"/>
<polygon fill="#000000" stroke="#000000" points="185.7995,-3964.1334 181.3911,-3954.4993 178.8294,-3964.7798 185.7995,-3964.1334"/>
</g>
<!-- header_8 -->
<g id="node9" class="node">
<title>header_8</title>
<ellipse fill="none" stroke="#000000" cx="431.5" cy="-3926.7061" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="431.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_4&#45;&gt;header_8 -->
<g id="edge8" class="edge">
<title>section_4&#45;&gt;header_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M762.8264,-5811.3377C807.1489,-5679.6799 1058.6797,-4868.9332 686.5,-4442.4067 629.7052,-4377.3186 554.9217,-4469.1059 495.5,-4406.4067 373.9664,-4278.1698 408.9098,-4036.9385 425.2664,-3954.8685"/>
<polygon fill="#000000" stroke="#000000" points="428.7062,-3955.5173 427.2954,-3945.0168 421.8501,-3954.1052 428.7062,-3955.5173"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="550.5" cy="-3926.7061" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="550.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 6&#45;7</text>
</g>
<!-- section_4&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_4&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M761.992,-5811.3558C799.4257,-5683.044 1006.1468,-4908.1373 686.5,-4442.4067 664.2071,-4409.9256 628.8166,-4438.1611 605.5,-4406.4067 501.9636,-4265.4028 530.6796,-4035.5191 544.8314,-3955.3589"/>
<polygon fill="#000000" stroke="#000000" points="548.3576,-3955.5334 546.7163,-3945.0665 541.4721,-3954.2724 548.3576,-3955.5334"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="665.5" cy="-3926.7061" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="665.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 8&#45;12</text>
</g>
<!-- section_4&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_4&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M755.6285,-5811.3854C747.0293,-5631.5678 677.465,-4176.9056 666.8549,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="670.3423,-3954.6898 666.3686,-3944.8684 663.3503,-3955.0242 670.3423,-3954.6898"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="960.5,-3993.1069 734.5,-3993.1069 734.5,-3860.3053 960.5,-3860.3053 960.5,-3993.1069"/>
<text text-anchor="middle" x="847.5" y="-3977.7062" font-family="Inconsolata" font-size="14.00" fill="#000000">*** includes</text>
<text text-anchor="middle" x="847.5" y="-3946.3062" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="847.5" y="-3930.9061" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="847.5" y="-3915.5061" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot = require &quot;node/dot&quot;</text>
<text text-anchor="middle" x="847.5" y="-3900.1061" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="847.5" y="-3868.706" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_4&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>section_4&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M757.3715,-5811.3854C765.4928,-5641.5594 827.9925,-4334.6273 843.8509,-4003.0119"/>
<polygon fill="#000000" stroke="#000000" points="847.3469,-4003.1773 844.3287,-3993.0215 840.3549,-4002.8429 847.3469,-4003.1773"/>
</g>
<!-- header_16 -->
<g id="node17" class="node">
<title>header_16</title>
<ellipse fill="none" stroke="#000000" cx="1118.5" cy="-3926.7061" rx="84.6634" ry="18"/>
<text text-anchor="middle" x="1118.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Node metatable</text>
</g>
<!-- section_5&#45;&gt;header_16 -->
<g id="edge16" class="edge">
<title>section_5&#45;&gt;header_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1404.7323,-5811.3854C1377.4229,-5631.5678 1156.4986,-4176.9056 1122.803,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="1126.2203,-3954.2295 1121.2584,-3944.8684 1119.2996,-3955.2806 1126.2203,-3954.2295"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="1277.5" cy="-3926.7061" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1277.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 13&#45;18</text>
</g>
<!-- section_5&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_5&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1406.255,-5811.3854C1393.9705,-5631.5678 1294.5928,-4176.9056 1279.4356,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="1282.9143,-3954.6066 1278.7408,-3944.8684 1275.9306,-3955.0838 1282.9143,-3954.6066"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="1407.5" cy="-3926.7061" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1407.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 19&#45;35</text>
</g>
<!-- section_5&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_5&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1407.5,-5811.3854C1407.5,-5631.5678 1407.5,-4176.9056 1407.5,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="1411.0001,-3954.8684 1407.5,-3944.8684 1404.0001,-3954.8685 1411.0001,-3954.8684"/>
</g>
<!-- section_19 -->
<g id="node20" class="node">
<title>section_19</title>
<ellipse fill="none" stroke="#000000" cx="1582.5" cy="-3926.7061" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1582.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 28&#45;35</text>
</g>
<!-- section_5&#45;&gt;section_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;section_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1409.1759,-5811.3854C1425.7128,-5631.5678 1559.4905,-4176.9056 1579.8944,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="1583.3991,-3955.147 1580.8297,-3944.8684 1576.4285,-3954.5059 1583.3991,-3955.147"/>
</g>
<!-- section_20 -->
<g id="node21" class="node">
<title>section_20</title>
<ellipse fill="none" stroke="#000000" cx="2674.5" cy="-3926.7061" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2674.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 36&#45;159</text>
</g>
<!-- section_5&#45;&gt;section_20 -->
<g id="edge20" class="edge">
<title>section_5&#45;&gt;section_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1419.4329,-5811.6869C1538.6253,-5632.6722 2513.5769,-4168.3959 2656.9266,-3953.0996"/>
<polygon fill="#000000" stroke="#000000" points="2659.955,-3954.8664 2662.5839,-3944.6029 2654.1284,-3950.9869 2659.955,-3954.8664"/>
</g>
<!-- leaf_77 -->
<g id="node78" class="node">
<title>leaf_77</title>
<polygon fill="none" stroke="#c0c0c0" points="3297.5,-4118.1068 2763.5,-4118.1068 2763.5,-3735.3054 3297.5,-3735.3054 3297.5,-4118.1068"/>
<text text-anchor="middle" x="3030.5" y="-4102.7064" font-family="Inconsolata" font-size="14.00" fill="#000000">** Node metatable</text>
<text text-anchor="middle" x="3030.5" y="-4071.3063" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The Node metatable is the root table for any Node. &#160;I&#39;m planning to make</text>
<text text-anchor="middle" x="3030.5" y="-4055.9063" font-family="Inconsolata" font-size="14.00" fill="#000000">an intermediate class/table called Root that is in common for any instance</text>
<text text-anchor="middle" x="3030.5" y="-4040.5063" font-family="Inconsolata" font-size="14.00" fill="#000000">Node. &#160;All Root absolutely has to contain is =str=. </text>
<text text-anchor="middle" x="3030.5" y="-4009.1062" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3030.5" y="-3977.7062" font-family="Inconsolata" font-size="14.00" fill="#000000">local N = {}</text>
<text text-anchor="middle" x="3030.5" y="-3962.3062" font-family="Inconsolata" font-size="14.00" fill="#000000">N.__index = N</text>
<text text-anchor="middle" x="3030.5" y="-3946.9061" font-family="Inconsolata" font-size="14.00" fill="#000000">N.isNode = true</text>
<text text-anchor="middle" x="3030.5" y="-3931.5061" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3030.5" y="-3868.1061" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Fields</text>
<text text-anchor="middle" x="3030.5" y="-3836.706" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; id : &#160;A string naming the Node. </text>
<text text-anchor="middle" x="3030.5" y="-3821.306" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;This is identical to the name of the pattern that recognizes</text>
<text text-anchor="middle" x="3030.5" y="-3805.906" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or captures it.</text>
<text text-anchor="middle" x="3030.5" y="-3790.5059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_first : &#160;Always &#45;1.</text>
<text text-anchor="middle" x="3030.5" y="-3775.1059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_last &#160;: &#160;Always &#45;1. </text>
<text text-anchor="middle" x="3030.5" y="-3743.7059" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_5&#45;&gt;leaf_77 -->
<g id="edge77" class="edge">
<title>section_5&#45;&gt;leaf_77</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1427.1121,-5812.24C1555.1664,-5698.1997 2281.6267,-5041.524 2754.5,-4406.4067 2819.4016,-4319.2373 2880.8312,-4215.4518 2929.1873,-4126.7499"/>
<polygon fill="#000000" stroke="#000000" points="2932.2752,-4128.3977 2933.9742,-4117.94 2926.1245,-4125.0557 2932.2752,-4128.3977"/>
</g>
<!-- header_78 -->
<g id="node79" class="node">
<title>header_78</title>
<ellipse fill="none" stroke="#000000" cx="6655.5" cy="-3926.7061" rx="83.6943" ry="18"/>
<text text-anchor="middle" x="6655.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Node Instances</text>
</g>
<!-- section_6&#45;&gt;header_78 -->
<g id="edge78" class="edge">
<title>section_6&#45;&gt;header_78</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7116.3206,-5811.6509C7081.6632,-5691.145 6880.7895,-4987.3217 6748.5,-4406.4067 6709.7209,-4236.1185 6673.1676,-4029.4817 6660.3399,-3955.091"/>
<polygon fill="#000000" stroke="#000000" points="6663.7653,-3954.3576 6658.622,-3945.0949 6656.8664,-3955.5433 6663.7653,-3954.3576"/>
</g>
<!-- block_79 -->
<g id="node80" class="node">
<title>block_79</title>
<ellipse fill="none" stroke="#000000" cx="6823.5" cy="-3926.7061" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6823.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 178&#45;182</text>
</g>
<!-- section_6&#45;&gt;block_79 -->
<g id="edge79" class="edge">
<title>section_6&#45;&gt;block_79</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7118.6356,-5811.5454C7099.422,-5690.3534 6987.328,-4982.8673 6897.5,-4406.4067 6870.789,-4234.9918 6839.1814,-4029.0405 6827.8279,-3954.9614"/>
<polygon fill="#000000" stroke="#000000" points="6831.2771,-3954.3628 6826.3028,-3945.0083 6824.3579,-3955.4231 6831.2771,-3954.3628"/>
</g>
<!-- block_80 -->
<g id="node81" class="node">
<title>block_80</title>
<ellipse fill="none" stroke="#000000" cx="6972.5" cy="-3926.7061" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6972.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 183&#45;186</text>
</g>
<!-- section_6&#45;&gt;block_80 -->
<g id="edge80" class="edge">
<title>section_6&#45;&gt;block_80</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7120.0731,-5811.3854C7105.9931,-5631.5678 6992.091,-4176.9056 6974.7185,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="6978.1922,-3954.5647 6973.9221,-3944.8684 6971.2135,-3955.1112 6978.1922,-3954.5647"/>
</g>
<!-- block_81 -->
<g id="node82" class="node">
<title>block_81</title>
<ellipse fill="none" stroke="#000000" cx="7121.5" cy="-3926.7061" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7121.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 187&#45;190</text>
</g>
<!-- section_6&#45;&gt;block_81 -->
<g id="edge81" class="edge">
<title>section_6&#45;&gt;block_81</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7121.5,-5811.3854C7121.5,-5631.5678 7121.5,-4176.9056 7121.5,-3955.0389"/>
<polygon fill="#000000" stroke="#000000" points="7125.0001,-3954.8684 7121.5,-3944.8684 7118.0001,-3954.8685 7125.0001,-3954.8684"/>
</g>
<!-- block_82 -->
<g id="node83" class="node">
<title>block_82</title>
<ellipse fill="none" stroke="#000000" cx="7370.5" cy="-3926.7061" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7370.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 191&#45;196</text>
</g>
<!-- section_6&#45;&gt;block_82 -->
<g id="edge82" class="edge">
<title>section_6&#45;&gt;block_82</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7120.9072,-5811.4097C7117.3274,-5690.8333 7102.052,-4994.9771 7205.5,-4442.4067 7241.4235,-4250.5203 7327.6488,-4030.5808 7358.9216,-3954.3838"/>
<polygon fill="#000000" stroke="#000000" points="7362.2124,-3955.5844 7362.792,-3945.0054 7355.7418,-3952.9139 7362.2124,-3955.5844"/>
</g>
<!-- block_83 -->
<g id="node84" class="node">
<title>block_83</title>
<ellipse fill="none" stroke="#000000" cx="7812.5" cy="-3926.7061" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7812.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 197&#45;237</text>
</g>
<!-- section_6&#45;&gt;block_83 -->
<g id="edge83" class="edge">
<title>section_6&#45;&gt;block_83</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7115.3749,-5811.5798C7071.91,-5679.9752 6822.6823,-4860.6589 7205.5,-4442.4067 7278.3237,-4362.8424 7352.6185,-4461.2411 7445.5,-4406.4067 7637.0224,-4293.3378 7763.1108,-4038.3383 7800.7216,-3954.2102"/>
<polygon fill="#000000" stroke="#000000" points="7803.933,-3955.6019 7804.7715,-3945.0403 7797.5297,-3952.7738 7803.933,-3955.6019"/>
</g>
<!-- section_84 -->
<g id="node85" class="node">
<title>section_84</title>
<ellipse fill="none" stroke="#000000" cx="8850.5" cy="-3926.7061" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="8850.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 202&#45;224</text>
</g>
<!-- section_6&#45;&gt;section_84 -->
<g id="edge84" class="edge">
<title>section_6&#45;&gt;section_84</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7115.1251,-5811.6249C7069.2508,-5678.6549 6802.5961,-4842.2031 7205.5,-4442.4067 7259.3649,-4388.9573 7814.1175,-4425.7274 7887.5,-4406.4067 8279.5814,-4303.1768 8699.1232,-4030.1179 8817.6618,-3949.4526"/>
<polygon fill="#000000" stroke="#000000" points="8819.707,-3952.2942 8825.9904,-3943.7638 8815.7587,-3946.5139 8819.707,-3952.2942"/>
</g>
<!-- section_85 -->
<g id="node86" class="node">
<title>section_85</title>
<ellipse fill="none" stroke="#000000" cx="12904.5" cy="-3926.7061" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="12904.5" y="-3922.5061" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 238&#45;272</text>
</g>
<!-- section_6&#45;&gt;section_85 -->
<g id="edge85" class="edge">
<title>section_6&#45;&gt;section_85</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7115.0003,-5811.4972C7068.2248,-5677.6043 6796.2672,-4835.7224 7205.5,-4442.4067 7240.135,-4409.1189 8886.5813,-4409.7922 8934.5,-4406.4067 10516.3072,-4294.6512 12435.8777,-4000.4384 12831.2327,-3938.3246"/>
<polygon fill="#000000" stroke="#000000" points="12832.0539,-3941.7385 12841.3887,-3936.7273 12830.9663,-3934.8235 12832.0539,-3941.7385"/>
</g>
<!-- leaf_136 -->
<g id="node137" class="node">
<title>leaf_136</title>
<polygon fill="none" stroke="#c0c0c0" points="13559.5,-4406.6075 12997.5,-4406.6075 12997.5,-3446.8047 13559.5,-3446.8047 13559.5,-4406.6075"/>
<text text-anchor="middle" x="13278.5" y="-4391.2067" font-family="Inconsolata" font-size="14.00" fill="#000000">** Node Instances</text>
<text text-anchor="middle" x="13278.5" y="-4359.8067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;To be a Node, currently, indexed elements of the Array portion must also be </text>
<text text-anchor="middle" x="13278.5" y="-4344.4067" font-family="Inconsolata" font-size="14.00" fill="#000000">Nodes. </text>
<text text-anchor="middle" x="13278.5" y="-4313.0066" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;m mostly convinced that indexed elements can also be strings, and that </text>
<text text-anchor="middle" x="13278.5" y="-4297.6066" font-family="Inconsolata" font-size="14.00" fill="#000000">this is the form leaf nodes should take. &#160;Currently, they have a &#39;val&#39; field</text>
<text text-anchor="middle" x="13278.5" y="-4282.2066" font-family="Inconsolata" font-size="14.00" fill="#000000">and no children, which we should replace with a child string at [1].</text>
<text text-anchor="middle" x="13278.5" y="-4250.8066" font-family="Inconsolata" font-size="14.00" fill="#000000">This gives us a lighter way to handle the circumstance where we have, say,</text>
<text text-anchor="middle" x="13278.5" y="-4235.4065" font-family="Inconsolata" font-size="14.00" fill="#000000">a list, =(foo bar baz)=. We currently either need a &quot;left&#45;per&quot; or &quot;pal&quot;</text>
<text text-anchor="middle" x="13278.5" y="-4220.0065" font-family="Inconsolata" font-size="14.00" fill="#000000">Node class to hold the =(=, or we would have to skip it entirely.</text>
<text text-anchor="middle" x="13278.5" y="-4188.6065" font-family="Inconsolata" font-size="14.00" fill="#000000">Quipu can&#39;t lose any information from the string, so they have to include</text>
<text text-anchor="middle" x="13278.5" y="-4173.2064" font-family="Inconsolata" font-size="14.00" fill="#000000">whitespace. &#160;We&#39;re not limited in the same way and can reconstruct less </text>
<text text-anchor="middle" x="13278.5" y="-4157.8064" font-family="Inconsolata" font-size="14.00" fill="#000000">semantically crucial parts of a document using the span and the original </text>
<text text-anchor="middle" x="13278.5" y="-4142.4064" font-family="Inconsolata" font-size="14.00" fill="#000000">string, since we&#39;re not /currently/ editing our strings once they&#39;re</text>
<text text-anchor="middle" x="13278.5" y="-4127.0063" font-family="Inconsolata" font-size="14.00" fill="#000000">entered in.</text>
<text text-anchor="middle" x="13278.5" y="-4095.6063" font-family="Inconsolata" font-size="14.00" fill="#000000">Nodes are meant to be broadly compatible with everything we intend to</text>
<text text-anchor="middle" x="13278.5" y="-4080.2063" font-family="Inconsolata" font-size="14.00" fill="#000000">do with abstract syntax trees. &#160;The more I think about this the better</text>
<text text-anchor="middle" x="13278.5" y="-4064.8062" font-family="Inconsolata" font-size="14.00" fill="#000000">it strikes me as an approach. </text>
<text text-anchor="middle" x="13278.5" y="-4017.4062" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Fields</text>
<text text-anchor="middle" x="13278.5" y="-3986.0062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;There are invariant fields a Node is also expected to have, they are:</text>
<text text-anchor="middle" x="13278.5" y="-3970.6061" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="13278.5" y="-3955.2061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;Index into =str= which begins the span.</text>
<text text-anchor="middle" x="13278.5" y="-3939.8061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Index into =str= which ends the span.</text>
<text text-anchor="middle" x="13278.5" y="-3908.4061" font-family="Inconsolata" font-size="14.00" fill="#000000">In principle, we want the Node to be localized. We could include a </text>
<text text-anchor="middle" x="13278.5" y="-3893.006" font-family="Inconsolata" font-size="14.00" fill="#000000">reference to the whole =str= and derive substrings lazily.</text>
<text text-anchor="middle" x="13278.5" y="-3861.606" font-family="Inconsolata" font-size="14.00" fill="#000000">If we included the full span as a substring on each Node, we&#39;d end up</text>
<text text-anchor="middle" x="13278.5" y="-3846.206" font-family="Inconsolata" font-size="14.00" fill="#000000">with a lot of spans, and wouldn&#39;t use most of them. Even slicing a piece</text>
<text text-anchor="middle" x="13278.5" y="-3830.8059" font-family="Inconsolata" font-size="14.00" fill="#000000">out is costly if we&#39;re not going to use it. </text>
<text text-anchor="middle" x="13278.5" y="-3799.4059" font-family="Inconsolata" font-size="14.00" fill="#000000">So our constructor for a Node class takes (Constructor, node, str) as </text>
<text text-anchor="middle" x="13278.5" y="-3784.0059" font-family="Inconsolata" font-size="14.00" fill="#000000">the standard interface. &#160;If a module needs a non&#45;standard constructor,</text>
<text text-anchor="middle" x="13278.5" y="-3768.6058" font-family="Inconsolata" font-size="14.00" fill="#000000">as our Section and Block modules currently take an array of lines, that</text>
<text text-anchor="middle" x="13278.5" y="-3753.2058" font-family="Inconsolata" font-size="14.00" fill="#000000">will need to be provided as the second return from the module. </text>
<text text-anchor="middle" x="13278.5" y="-3721.8058" font-family="Inconsolata" font-size="14.00" fill="#000000">This will allow for the kind of multi&#45;pass recursive&#45;descent that I&#39;m</text>
<text text-anchor="middle" x="13278.5" y="-3706.4057" font-family="Inconsolata" font-size="14.00" fill="#000000">aiming for. </text>
<text text-anchor="middle" x="13278.5" y="-3659.0057" font-family="Inconsolata" font-size="14.00" fill="#000000">**** line tracking (optional)</text>
<text text-anchor="middle" x="13278.5" y="-3627.6057" font-family="Inconsolata" font-size="14.00" fill="#000000">It may be wise to always track lines, in which case we will include:</text>
<text text-anchor="middle" x="13278.5" y="-3596.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_first : &#160;The line at which the match begins</text>
<text text-anchor="middle" x="13278.5" y="-3580.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_last &#160;: &#160;The line at which the match ends</text>
<text text-anchor="middle" x="13278.5" y="-3549.4056" font-family="Inconsolata" font-size="14.00" fill="#000000">This is, at least, a frequent enough pattern that the metatable should return</text>
<text text-anchor="middle" x="13278.5" y="-3534.0056" font-family="Inconsolata" font-size="14.00" fill="#000000">a negative number if these aren&#39;t assigned. </text>
<text text-anchor="middle" x="13278.5" y="-3502.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; [ ] #todo decide if line tracking is in fact optional</text>
<text text-anchor="middle" x="13278.5" y="-3455.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_6&#45;&gt;leaf_136 -->
<g id="edge136" class="edge">
<title>section_6&#45;&gt;leaf_136</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7114.944,-5811.4381C7067.7614,-5677.1185 6793.4082,-4832.7259 7205.5,-4442.4067 7263.8151,-4387.1726 12918.6619,-4446.0818 12988.5,-4406.4067 12988.5925,-4406.3542 12988.6851,-4406.3015 12988.7776,-4406.2489"/>
<polygon fill="#000000" stroke="#000000" points="12990.462,-4409.3188 12997.3045,-4401.2299 12986.9112,-4403.2862 12990.462,-4409.3188"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="404.5,-2455.0039 350.5,-2455.0039 350.5,-2419.0039 404.5,-2419.0039 404.5,-2455.0039"/>
</g>
<!-- block_9&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_9&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M554.3052,-3908.3299C567.4245,-3839.6427 604.2407,-3594.3953 495.5,-3447.0055 471.8701,-3414.9769 435.8761,-3443.9222 413.5,-3411.0055 200.8997,-3098.2564 332.0605,-2589.2594 368.8065,-2465.0123"/>
<polygon fill="#000000" stroke="#000000" points="372.246,-2465.7275 371.768,-2455.1434 365.5414,-2463.7155 372.246,-2465.7275"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="494.5" cy="-2437.0039" rx="71.7805" ry="18"/>
<text text-anchor="middle" x="494.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 8&#45;11</text>
</g>
<!-- block_10&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>block_10&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M666.7966,-3908.3307C670.7099,-3842.5829 678.0289,-3614.0696 605.5,-3447.0055 597.206,-3427.9008 583.3962,-3430.2779 575.5,-3411.0055 432.6417,-3062.3297 476.6783,-2585.6644 490.8623,-2465.427"/>
<polygon fill="#000000" stroke="#000000" points="494.3703,-2465.571 492.0968,-2455.223 487.421,-2464.7302 494.3703,-2465.571"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="638.5,-2455.0039 584.5,-2455.0039 584.5,-2419.0039 638.5,-2419.0039 638.5,-2455.0039"/>
</g>
<!-- block_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M664.8464,-3908.6742C659.2538,-3754.392 619.493,-2657.5068 612.5371,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="616.0296,-2465.3418 612.1696,-2455.4752 609.0342,-2465.5955 616.0296,-2465.3418"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="607.5,-1140.2024 381.5,-1140.2024 381.5,-1101.6013 607.5,-1101.6013 607.5,-1140.2024"/>
<text text-anchor="middle" x="494.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="494.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">local dot = require &quot;node/dot&quot;</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M494.5,-2418.8999C494.5,-2275.9404 494.5,-1329.9308 494.5,-1150.3165"/>
<polygon fill="#000000" stroke="#000000" points="498.0001,-1150.2816 494.5,-1140.2816 491.0001,-1150.2816 498.0001,-1150.2816"/>
</g>
<!-- leaf_21 -->
<g id="node22" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="1190.5,-2472.2043 656.5,-2472.2043 656.5,-2401.8035 1190.5,-2401.8035 1190.5,-2472.2043"/>
<text text-anchor="middle" x="923.5" y="-2440.9039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The Node metatable is the root table for any Node. &#160;I&#39;m planning to make</text>
<text text-anchor="middle" x="923.5" y="-2425.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">an intermediate class/table called Root that is in common for any instance</text>
<text text-anchor="middle" x="923.5" y="-2410.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">Node. &#160;All Root absolutely has to contain is =str=. </text>
</g>
<!-- block_17&#45;&gt;leaf_21 -->
<g id="edge21" class="edge">
<title>block_17&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1276.4318,-3908.59C1272.369,-3844.6257 1255.8582,-3623.7158 1212.5,-3447.0055 1208.4463,-3430.4843 1204.711,-3427.1989 1199.5,-3411.0055 1085.3906,-3056.4067 971.0448,-2621.3411 935.0694,-2482.1048"/>
<polygon fill="#000000" stroke="#000000" points="938.4046,-2481.0217 932.517,-2472.2133 931.6267,-2482.7707 938.4046,-2481.0217"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="1285.5" cy="-2437.0039" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1285.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 19&#45;24</text>
</g>
<!-- block_18&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>block_18&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1406.0233,-3908.6742C1393.3882,-3754.392 1303.5582,-2657.5068 1287.843,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="1291.3174,-2465.1562 1287.0127,-2455.4752 1284.3407,-2465.7276 1291.3174,-2465.1562"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1434.5,-2457.0039 1380.5,-2457.0039 1380.5,-2417.0039 1434.5,-2417.0039 1434.5,-2457.0039"/>
</g>
<!-- block_18&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_18&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1407.5,-3908.6742C1407.5,-3754.8016 1407.5,-2663.3248 1407.5,-2467.1616"/>
<polygon fill="#000000" stroke="#000000" points="1411.0001,-2467.0083 1407.5,-2457.0083 1404.0001,-2467.0083 1411.0001,-2467.0083"/>
</g>
<!-- header_25 -->
<g id="node26" class="node">
<title>header_25</title>
<ellipse fill="none" stroke="#000000" cx="1498.5" cy="-2437.0039" rx="45.9718" ry="18"/>
<text text-anchor="middle" x="1498.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Fields</text>
</g>
<!-- section_19&#45;&gt;header_25 -->
<g id="edge25" class="edge">
<title>section_19&#45;&gt;header_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1581.4832,-3908.6742C1572.7837,-3754.392 1510.9335,-2657.5068 1500.1132,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="1503.5991,-2465.2623 1499.5415,-2455.4752 1496.6102,-2465.6564 1503.5991,-2465.2623"/>
</g>
<!-- block_26 -->
<g id="node27" class="node">
<title>block_26</title>
<ellipse fill="none" stroke="#000000" cx="1618.5" cy="-2437.0039" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1618.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 28&#45;35</text>
</g>
<!-- section_19&#45;&gt;block_26 -->
<g id="edge26" class="edge">
<title>section_19&#45;&gt;block_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1582.9358,-3908.6742C1586.6641,-3754.392 1613.1713,-2657.5068 1617.8086,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="1621.3109,-2465.5569 1618.0536,-2455.4752 1614.313,-2465.3877 1621.3109,-2465.5569"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2205,-2510.8043 1692,-2510.8043 1692,-2363.2035 2205,-2363.2035 2205,-2510.8043"/>
<text text-anchor="middle" x="1948.5" y="-2495.704" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Fields</text>
<text text-anchor="middle" x="1948.5" y="-2464.304" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; id : &#160;A string naming the Node. </text>
<text text-anchor="middle" x="1948.5" y="-2448.9039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;This is identical to the name of the pattern that recognizes</text>
<text text-anchor="middle" x="1948.5" y="-2433.5039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or captures it.</text>
<text text-anchor="middle" x="1948.5" y="-2418.1039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_first : &#160;Always &#45;1.</text>
<text text-anchor="middle" x="1948.5" y="-2402.7039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_last &#160;: &#160;Always &#45;1. </text>
<text text-anchor="middle" x="1948.5" y="-2371.3038" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_19&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>section_19&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1586.9302,-3908.6742C1622.0697,-3765.6487 1856.2333,-2812.5499 1927.7769,-2521.3517"/>
<polygon fill="#000000" stroke="#000000" points="1931.2656,-2521.8208 1930.2527,-2511.2745 1924.4678,-2520.1506 1931.2656,-2521.8208"/>
</g>
<!-- header_29 -->
<g id="node30" class="node">
<title>header_29</title>
<ellipse fill="none" stroke="#000000" cx="2279.5" cy="-2437.0039" rx="56.1302" ry="18"/>
<text text-anchor="middle" x="2279.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Methods</text>
</g>
<!-- section_20&#45;&gt;header_29 -->
<g id="edge29" class="edge">
<title>section_20&#45;&gt;header_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2658.1046,-3908.8426C2601.8608,-3846.2918 2416.2734,-3629.0913 2344.5,-3411.0055 2226.9784,-3053.9122 2264.3187,-2584.3559 2276.3827,-2465.3517"/>
<polygon fill="#000000" stroke="#000000" points="2279.8805,-2465.5536 2277.4332,-2455.2453 2272.918,-2464.8299 2279.8805,-2465.5536"/>
</g>
<!-- block_30 -->
<g id="node31" class="node">
<title>block_30</title>
<ellipse fill="none" stroke="#000000" cx="2409.5" cy="-2437.0039" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2409.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 36&#45;37</text>
</g>
<!-- section_20&#45;&gt;block_30 -->
<g id="edge30" class="edge">
<title>section_20&#45;&gt;block_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2665.1313,-3908.6112C2631.9546,-3843.5318 2519.6294,-3614.442 2474.5,-3411.0055 2393.2545,-3044.7631 2403.9133,-2583.6476 2408.2855,-2465.5619"/>
<polygon fill="#000000" stroke="#000000" points="2411.7964,-2465.3477 2408.6857,-2455.2198 2404.8016,-2465.077 2411.7964,-2465.3477"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="2539.5" cy="-2437.0039" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2539.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 38&#45;54</text>
</g>
<!-- section_20&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_20&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2671.568,-3908.4894C2660.9751,-3842.0654 2624.2704,-3606.5249 2604.5,-3411.0055 2566.8001,-3038.1714 2545.733,-2582.7509 2540.6918,-2465.5613"/>
<polygon fill="#000000" stroke="#000000" points="2544.1767,-2465.1321 2540.2539,-2455.2903 2537.1831,-2465.4303 2544.1767,-2465.1321"/>
</g>
<!-- block_32 -->
<g id="node33" class="node">
<title>block_32</title>
<ellipse fill="none" stroke="#000000" cx="2674.5" cy="-2437.0039" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2674.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 55&#45;159</text>
</g>
<!-- section_20&#45;&gt;block_32 -->
<g id="edge32" class="edge">
<title>section_20&#45;&gt;block_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2674.5,-3908.6742C2674.5,-3754.392 2674.5,-2657.5068 2674.5,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="2678.0001,-2465.4752 2674.5,-2455.4752 2671.0001,-2465.4753 2678.0001,-2465.4752"/>
</g>
<!-- section_33 -->
<g id="node34" class="node">
<title>section_33</title>
<ellipse fill="none" stroke="#000000" cx="2818.5" cy="-2437.0039" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2818.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 78&#45;98</text>
</g>
<!-- section_20&#45;&gt;section_33 -->
<g id="edge33" class="edge">
<title>section_20&#45;&gt;section_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2677.371,-3908.4831C2687.7547,-3842.0374 2723.8311,-3606.4319 2744.5,-3411.0055 2783.9392,-3038.1041 2810.4554,-2582.7326 2816.9494,-2465.5575"/>
<polygon fill="#000000" stroke="#000000" points="2820.4597,-2465.4653 2817.5151,-2455.2879 2813.4703,-2465.0802 2820.4597,-2465.4653"/>
</g>
<!-- section_34 -->
<g id="node35" class="node">
<title>section_34</title>
<ellipse fill="none" stroke="#000000" cx="3495.5" cy="-2437.0039" rx="70.655" ry="18"/>
<text text-anchor="middle" x="3495.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 99&#45;121</text>
</g>
<!-- section_20&#45;&gt;section_34 -->
<g id="edge34" class="edge">
<title>section_20&#45;&gt;section_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2671.2832,-3908.5684C2660.0008,-3838.6473 2629.3568,-3583.6999 2754.5,-3447.0055 2797.5922,-3399.9357 2842.1352,-3448.8757 2893.5,-3411.0055 3253.3611,-3145.687 3445.5645,-2594.7746 3486.9423,-2464.8731"/>
<polygon fill="#000000" stroke="#000000" points="3490.3043,-2465.8493 3489.9725,-2455.2597 3483.6281,-2463.7449 3490.3043,-2465.8493"/>
</g>
<!-- section_35 -->
<g id="node36" class="node">
<title>section_35</title>
<ellipse fill="none" stroke="#000000" cx="4424.5" cy="-2437.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4424.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 122&#45;159</text>
</g>
<!-- section_20&#45;&gt;section_35 -->
<g id="edge35" class="edge">
<title>section_20&#45;&gt;section_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2670.6472,-3908.7104C2656.4906,-3837.1165 2615.1116,-3570.4183 2754.5,-3447.0055 2822.8645,-3386.4763 3493.2343,-3450.6268 3575.5,-3411.0055 4032.928,-3190.6963 4345.1526,-2598.5945 4411.3689,-2464.3327"/>
<polygon fill="#000000" stroke="#000000" points="4414.6225,-2465.6466 4415.8763,-2455.1262 4408.3356,-2462.5685 4414.6225,-2465.6466"/>
</g>
<!-- section_36 -->
<g id="node37" class="node">
<title>section_36</title>
<ellipse fill="none" stroke="#000000" cx="4949.5" cy="-2437.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4949.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 160&#45;177</text>
</g>
<!-- section_20&#45;&gt;section_36 -->
<g id="edge36" class="edge">
<title>section_20&#45;&gt;section_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2670.5648,-3908.6162C2656.0945,-3836.6638 2613.6834,-3568.7862 2754.5,-3447.0055 2828.2206,-3383.2505 4427.1391,-3464.6695 4508.5,-3411.0055 4857.7828,-3180.6253 4933.8787,-2600.7955 4947.0764,-2465.528"/>
<polygon fill="#000000" stroke="#000000" points="4950.5967,-2465.4745 4948.0451,-2455.1916 4943.6272,-2464.8214 4950.5967,-2465.4745"/>
</g>
<!-- leaf_76 -->
<g id="node77" class="node">
<title>leaf_76</title>
<polygon fill="none" stroke="#c0c0c0" points="5590.5,-3411.007 5042.5,-3411.007 5042.5,-1463.0008 5590.5,-1463.0008 5590.5,-3411.007"/>
<text text-anchor="middle" x="5316.5" y="-3395.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Methods</text>
<text text-anchor="middle" x="5316.5" y="-3364.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5316.5" y="-3349.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toString(node, depth)</text>
<text text-anchor="middle" x="5316.5" y="-3333.6054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = depth or 0</text>
<text text-anchor="middle" x="5316.5" y="-3318.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="5316.5" y="-3302.8053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;phrase = (&quot; &#160;&quot;):rep(depth) .. &quot;id: &quot; .. node.id .. &quot;, &#160;&quot;</text>
<text text-anchor="middle" x="5316.5" y="-3287.4053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. &quot;first: &quot; .. node.first .. &quot;, last: &quot; .. node.last .. &quot;\n&quot;</text>
<text text-anchor="middle" x="5316.5" y="-3272.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if node[1] then</text>
<text text-anchor="middle" x="5316.5" y="-3256.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(node) do</text>
<text text-anchor="middle" x="5316.5" y="-3241.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if(v.isNode) then</text>
<text text-anchor="middle" x="5316.5" y="-3225.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. N.toString(v, depth + 1)</text>
<text text-anchor="middle" x="5316.5" y="-3210.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-3195.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-3179.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end </text>
<text text-anchor="middle" x="5316.5" y="-3164.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="5316.5" y="-3148.805" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-3133.405" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5316.5" y="-3102.0049" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5316.5" y="-3086.6049" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dotLabel(node)</text>
<text text-anchor="middle" x="5316.5" y="-3071.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.id</text>
<text text-anchor="middle" x="5316.5" y="-3055.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-3024.4048" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toMarkdown(node)</text>
<text text-anchor="middle" x="5316.5" y="-3009.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if not node[1] then</text>
<text text-anchor="middle" x="5316.5" y="-2993.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return string.sub(node.str, node.first, node.last)</text>
<text text-anchor="middle" x="5316.5" y="-2978.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="5316.5" y="-2962.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no toMarkdown for &quot; .. node.id)</text>
<text text-anchor="middle" x="5316.5" y="-2947.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2932.0046" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-2900.6046" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dot(node)</text>
<text text-anchor="middle" x="5316.5" y="-2885.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return dot.dot(node)</text>
<text text-anchor="middle" x="5316.5" y="-2869.8045" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-2838.4045" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toValue(node)</text>
<text text-anchor="middle" x="5316.5" y="-2823.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.str:sub(node.first,node.last)</text>
<text text-anchor="middle" x="5316.5" y="-2807.6044" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-2776.2044" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5316.5" y="-2744.8044" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walkDeep</text>
<text text-anchor="middle" x="5316.5" y="-2713.4043" font-family="Inconsolata" font-size="14.00" fill="#000000">Depth&#45;first iterator. </text>
<text text-anchor="middle" x="5316.5" y="-2682.0043" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5316.5" y="-2666.6043" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walkDeep(node)</text>
<text text-anchor="middle" x="5316.5" y="-2651.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="5316.5" y="-2635.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="5316.5" y="-2604.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="5316.5" y="-2589.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="5316.5" y="-2573.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="5316.5" y="-2558.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2542.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2527.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="5316.5" y="-2512.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2480.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="5316.5" y="-2465.2039" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-2449.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5316.5" y="-2418.4039" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walk</text>
<text text-anchor="middle" x="5316.5" y="-2387.0038" font-family="Inconsolata" font-size="14.00" fill="#000000">Breadth&#45;first iterator. &#160;This is the default. </text>
<text text-anchor="middle" x="5316.5" y="-2355.6038" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5316.5" y="-2340.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walk(node)</text>
<text text-anchor="middle" x="5316.5" y="-2324.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="5316.5" y="-2309.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="5316.5" y="-2278.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="5316.5" y="-2262.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="5316.5" y="-2247.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="5316.5" y="-2231.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="5316.5" y="-2216.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2201.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2185.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5316.5" y="-2154.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="5316.5" y="-2138.8034" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-2107.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5316.5" y="-2060.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.select(node, pred)</text>
<text text-anchor="middle" x="5316.5" y="-2028.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes the Node and walks it, yielding the Nodes which match the predicate.</text>
<text text-anchor="middle" x="5316.5" y="-2013.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">=pred= is either a string, which matches to =id=, or a function, which takes</text>
<text text-anchor="middle" x="5316.5" y="-1997.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node and returns true or false on some premise. </text>
<text text-anchor="middle" x="5316.5" y="-1966.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5316.5" y="-1951.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.select(node, pred)</text>
<text text-anchor="middle" x="5316.5" y="-1935.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function qualifies(node, pred)</text>
<text text-anchor="middle" x="5316.5" y="-1920.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(pred) == &#39;string&#39; then</text>
<text text-anchor="middle" x="5316.5" y="-1904.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(node) == &#39;table&#39; and node.isNode and node.id == pred then</text>
<text text-anchor="middle" x="5316.5" y="-1889.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="5316.5" y="-1874.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5316.5" y="-1858.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="5316.5" y="-1843.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1827.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(pred) == &#39;function&#39; then</text>
<text text-anchor="middle" x="5316.5" y="-1812.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return pred(node)</text>
<text text-anchor="middle" x="5316.5" y="-1797.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5316.5" y="-1781.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:halt(&quot;cannot select on predicate of type &quot; .. type(pred))</text>
<text text-anchor="middle" x="5316.5" y="-1766.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1750.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1719.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="5316.5" y="-1704.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if qualifies(ast, pred) then</text>
<text text-anchor="middle" x="5316.5" y="-1688.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="5316.5" y="-1673.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1657.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="5316.5" y="-1642.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="5316.5" y="-1627.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="5316.5" y="-1611.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1596.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1580.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="5316.5" y="-1549.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="5316.5" y="-1534.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5316.5" y="-1518.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5316.5" y="-1471.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_20&#45;&gt;leaf_76 -->
<g id="edge76" class="edge">
<title>section_20&#45;&gt;leaf_76</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2670.5483,-3908.597C2656.0148,-3836.5714 2613.396,-3568.453 2754.5,-3447.0055 2850.4736,-3364.4014 4932.841,-3487.8309 5033.5,-3411.0055 5033.7789,-3410.7926 5034.0575,-3410.5795 5034.3358,-3410.3662"/>
<polygon fill="#000000" stroke="#000000" points="5036.6159,-3413.0262 5042.3343,-3404.1071 5032.302,-3407.5135 5036.6159,-3413.0262"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1345,-1156.1022 1224,-1156.1022 1224,-1085.7014 1345,-1085.7014 1345,-1156.1022"/>
<text text-anchor="middle" x="1284.5" y="-1124.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local N = {}</text>
<text text-anchor="middle" x="1284.5" y="-1109.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">N.__index = N</text>
<text text-anchor="middle" x="1284.5" y="-1094.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">N.isNode = true</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>codeblock_22&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1285.4862,-2418.8999C1285.3805,-2279.7683 1284.6969,-1380.016 1284.5345,-1166.3629"/>
<polygon fill="#000000" stroke="#000000" points="1288.0345,-1166.1332 1284.5268,-1156.1359 1281.0345,-1166.1386 1288.0345,-1166.1332"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="1876,-1171.402 1363,-1171.402 1363,-1070.4017 1876,-1070.4017 1876,-1171.402"/>
<text text-anchor="middle" x="1619.5" y="-1140.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; id : &#160;A string naming the Node. </text>
<text text-anchor="middle" x="1619.5" y="-1124.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;This is identical to the name of the pattern that recognizes</text>
<text text-anchor="middle" x="1619.5" y="-1109.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or captures it.</text>
<text text-anchor="middle" x="1619.5" y="-1094.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_first : &#160;Always &#45;1.</text>
<text text-anchor="middle" x="1619.5" y="-1078.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; line_last &#160;: &#160;Always &#45;1. </text>
</g>
<!-- block_26&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>block_26&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1618.5138,-2418.8999C1618.6171,-2282.9144 1619.2725,-1420.3185 1619.4537,-1181.8924"/>
<polygon fill="#000000" stroke="#000000" points="1622.9537,-1181.6799 1619.4614,-1171.6772 1615.9537,-1181.6745 1622.9537,-1181.6799"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="1968.5,-1138.9018 1914.5,-1138.9018 1914.5,-1102.9018 1968.5,-1102.9018 1968.5,-1138.9018"/>
</g>
<!-- block_30&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>block_30&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2411.3105,-2418.6572C2422.9107,-2296.8061 2482.0655,-1604.9203 2344.5,-1463.0023 2287.464,-1404.1618 2036.0015,-1484.386 1977.5,-1427.0023 1901.6444,-1352.5961 1921.8088,-1209.4424 1934.6715,-1148.9651"/>
<polygon fill="#000000" stroke="#000000" points="1938.1336,-1149.5198 1936.8871,-1138.9986 1931.3004,-1148.0007 1938.1336,-1149.5198"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="2063.5" cy="-1120.9018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2063.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 38&#45;53</text>
</g>
<!-- block_31&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>block_31&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2541.2893,-2418.6776C2552.7521,-2296.9589 2611.173,-1605.78 2474.5,-1463.0023 2424.2532,-1410.5113 2204.907,-1474.0142 2149.5,-1427.0023 2065.7192,-1355.9159 2060.2312,-1210.3177 2061.9358,-1149.0547"/>
<polygon fill="#000000" stroke="#000000" points="2065.4368,-1149.0876 2062.3052,-1138.9662 2058.4415,-1148.8313 2065.4368,-1149.0876"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="2212.5,-1138.9018 2158.5,-1138.9018 2158.5,-1102.9018 2212.5,-1102.9018 2212.5,-1138.9018"/>
</g>
<!-- block_31&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>block_31&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2541.2365,-2418.7274C2552.3555,-2297.3326 2608.9419,-1607.8828 2474.5,-1463.0023 2397.2441,-1379.748 2300.8305,-1508.2822 2221.5,-1427.0023 2147.4593,-1351.1423 2166.453,-1209.3846 2178.8306,-1149.1472"/>
<polygon fill="#000000" stroke="#000000" points="2182.2867,-1149.7229 2180.9669,-1139.2106 2175.4431,-1148.2515 2182.2867,-1149.7229"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="2307.5" cy="-1120.9018" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2307.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 55&#45;76</text>
</g>
<!-- block_32&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>block_32&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2676.0873,-2418.7643C2686.223,-2297.6095 2737.3479,-1609.4403 2604.5,-1463.0023 2540.5798,-1392.5432 2464.2034,-1490.6522 2393.5,-1427.0023 2312.0337,-1353.6633 2305.2069,-1209.9212 2306.2432,-1149.1262"/>
<polygon fill="#000000" stroke="#000000" points="2309.7425,-1149.1923 2306.5004,-1139.1058 2302.7448,-1149.0126 2309.7425,-1149.1923"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="2456.5,-1138.9018 2402.5,-1138.9018 2402.5,-1102.9018 2456.5,-1102.9018 2456.5,-1138.9018"/>
</g>
<!-- block_32&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>block_32&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2675.938,-2418.894C2685.1035,-2298.5828 2731.0491,-1614.9167 2604.5,-1463.0023 2563.6547,-1413.9701 2507.4459,-1475.0964 2465.5,-1427.0023 2396.1343,-1347.4695 2412.2814,-1208.8025 2423.3523,-1149.3214"/>
<polygon fill="#000000" stroke="#000000" points="2426.8534,-1149.6546 2425.3386,-1139.1686 2419.9836,-1148.3105 2426.8534,-1149.6546"/>
</g>
<!-- header_44 -->
<g id="node45" class="node">
<title>header_44</title>
<ellipse fill="none" stroke="#000000" cx="2544.5" cy="-1120.9018" rx="70.1446" ry="18"/>
<text text-anchor="middle" x="2544.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : N.walkDeep</text>
</g>
<!-- section_33&#45;&gt;header_44 -->
<g id="edge44" class="edge">
<title>section_33&#45;&gt;header_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2823.7482,-2418.9936C2853.3808,-2313.2432 2989.9024,-1767.2638 2744.5,-1463.0023 2709.2758,-1419.3297 2662.4412,-1467.3958 2623.5,-1427.0023 2548.1941,-1348.888 2542.0849,-1208.8729 2543.2083,-1149.1472"/>
<polygon fill="#000000" stroke="#000000" points="2546.712,-1149.0546 2543.4872,-1138.9625 2539.7146,-1148.8629 2546.712,-1149.0546"/>
</g>
<!-- block_45 -->
<g id="node46" class="node">
<title>block_45</title>
<ellipse fill="none" stroke="#000000" cx="2688.5" cy="-1120.9018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2688.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 78&#45;81</text>
</g>
<!-- section_33&#45;&gt;block_45 -->
<g id="edge45" class="edge">
<title>section_33&#45;&gt;block_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2817.7004,-2418.699C2813.2927,-2320.6114 2790.4699,-1847.3403 2744.5,-1463.0023 2730.4708,-1345.7094 2705.0338,-1207.1678 2693.9298,-1148.9154"/>
<polygon fill="#000000" stroke="#000000" points="2697.3486,-1148.1587 2692.0292,-1138.996 2690.4736,-1149.476 2697.3486,-1148.1587"/>
</g>
<!-- block_46 -->
<g id="node47" class="node">
<title>block_46</title>
<ellipse fill="none" stroke="#000000" cx="2818.5" cy="-1120.9018" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2818.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 82&#45;98</text>
</g>
<!-- section_33&#45;&gt;block_46 -->
<g id="edge46" class="edge">
<title>section_33&#45;&gt;block_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2818.5,-2418.8999C2818.5,-2275.7092 2818.5,-1326.8691 2818.5,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="2822.0001,-1149.3362 2818.5,-1139.3362 2815.0001,-1149.3362 2822.0001,-1149.3362"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="3300.5,-1295.7024 2892.5,-1295.7024 2892.5,-946.1012 3300.5,-946.1012 3300.5,-1295.7024"/>
<text text-anchor="middle" x="3096.5" y="-1280.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walkDeep</text>
<text text-anchor="middle" x="3096.5" y="-1249.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">Depth&#45;first iterator. </text>
<text text-anchor="middle" x="3096.5" y="-1217.802" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3096.5" y="-1202.402" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walkDeep(node)</text>
<text text-anchor="middle" x="3096.5" y="-1187.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="3096.5" y="-1171.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="3096.5" y="-1140.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3096.5" y="-1124.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="3096.5" y="-1109.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="3096.5" y="-1094.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3096.5" y="-1078.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3096.5" y="-1063.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="3096.5" y="-1047.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3096.5" y="-1016.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="3096.5" y="-1001.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3096.5" y="-985.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3096.5" y="-954.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_33&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>section_33&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2822.3241,-2418.8999C2847.2552,-2300.8716 2987.8092,-1635.4635 3057.4253,-1305.8885"/>
<polygon fill="#000000" stroke="#000000" points="3060.9236,-1306.2618 3059.5659,-1295.7543 3054.0747,-1304.8151 3060.9236,-1306.2618"/>
</g>
<!-- header_52 -->
<g id="node53" class="node">
<title>header_52</title>
<ellipse fill="none" stroke="#000000" cx="3367.5" cy="-1120.9018" rx="48.8618" ry="18"/>
<text text-anchor="middle" x="3367.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : N.walk</text>
</g>
<!-- section_34&#45;&gt;header_52 -->
<g id="edge52" class="edge">
<title>section_34&#45;&gt;header_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3493.7393,-2418.8999C3479.813,-2275.7092 3387.5317,-1326.8691 3370.2766,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="3373.7445,-1148.9504 3369.2929,-1139.3362 3366.7774,-1149.6281 3373.7445,-1148.9504"/>
</g>
<!-- block_53 -->
<g id="node54" class="node">
<title>block_53</title>
<ellipse fill="none" stroke="#000000" cx="3495.5" cy="-1120.9018" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="3495.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 99&#45;102</text>
</g>
<!-- section_34&#45;&gt;block_53 -->
<g id="edge53" class="edge">
<title>section_34&#45;&gt;block_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3495.5,-2418.8999C3495.5,-2275.7092 3495.5,-1326.8691 3495.5,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="3499.0001,-1149.3362 3495.5,-1139.3362 3492.0001,-1149.3362 3499.0001,-1149.3362"/>
</g>
<!-- block_54 -->
<g id="node55" class="node">
<title>block_54</title>
<ellipse fill="none" stroke="#000000" cx="3639.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="3639.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 103&#45;121</text>
</g>
<!-- section_34&#45;&gt;block_54 -->
<g id="edge54" class="edge">
<title>section_34&#45;&gt;block_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3497.4808,-2418.8999C3513.1479,-2275.7092 3616.9643,-1326.8691 3636.3763,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="3639.8745,-1149.6576 3637.483,-1139.3362 3632.916,-1148.8962 3639.8745,-1149.6576"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="4117.5,-1311.7024 3723.5,-1311.7024 3723.5,-930.1012 4117.5,-930.1012 4117.5,-1311.7024"/>
<text text-anchor="middle" x="3920.5" y="-1296.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.walk</text>
<text text-anchor="middle" x="3920.5" y="-1265.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">Breadth&#45;first iterator. &#160;This is the default. </text>
<text text-anchor="middle" x="3920.5" y="-1233.802" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3920.5" y="-1218.402" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walk(node)</text>
<text text-anchor="middle" x="3920.5" y="-1203.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="3920.5" y="-1187.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="3920.5" y="-1156.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="3920.5" y="-1140.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3920.5" y="-1125.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="3920.5" y="-1110.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="3920.5" y="-1094.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3920.5" y="-1079.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3920.5" y="-1063.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3920.5" y="-1032.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="3920.5" y="-1017.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3920.5" y="-985.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3920.5" y="-938.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_34&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>section_34&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3501.3462,-2418.8999C3538.8621,-2302.7242 3747.6343,-1656.217 3855.673,-1321.6522"/>
<polygon fill="#000000" stroke="#000000" points="3859.0974,-1322.4374 3858.8398,-1311.8457 3852.4361,-1320.2863 3859.0974,-1322.4374"/>
</g>
<!-- header_60 -->
<g id="node61" class="node">
<title>header_60</title>
<ellipse fill="none" stroke="#000000" cx="4238.5" cy="-1120.9018" rx="102.5369" ry="18"/>
<text text-anchor="middle" x="4238.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : N.select(node, pred)</text>
</g>
<!-- section_35&#45;&gt;header_60 -->
<g id="edge60" class="edge">
<title>section_35&#45;&gt;header_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4421.9414,-2418.8999C4401.7048,-2275.7092 4267.6086,-1326.8691 4242.5348,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="4245.9703,-1148.748 4241.1053,-1139.3362 4239.0391,-1149.7276 4245.9703,-1148.748"/>
</g>
<!-- block_61 -->
<g id="node62" class="node">
<title>block_61</title>
<ellipse fill="none" stroke="#000000" cx="4424.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4424.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 122&#45;127</text>
</g>
<!-- section_35&#45;&gt;block_61 -->
<g id="edge61" class="edge">
<title>section_35&#45;&gt;block_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4424.5,-2418.8999C4424.5,-2275.7092 4424.5,-1326.8691 4424.5,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="4428.0001,-1149.3362 4424.5,-1139.3362 4421.0001,-1149.3362 4428.0001,-1149.3362"/>
</g>
<!-- block_62 -->
<g id="node63" class="node">
<title>block_62</title>
<ellipse fill="none" stroke="#000000" cx="4573.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4573.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 128&#45;159</text>
</g>
<!-- section_35&#45;&gt;block_62 -->
<g id="edge62" class="edge">
<title>section_35&#45;&gt;block_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4426.5496,-2418.8999C4442.7607,-2275.7092 4550.1818,-1326.8691 4570.2678,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="4573.7657,-1149.6665 4571.413,-1139.3362 4566.8102,-1148.879 4573.7657,-1149.6665"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="5205.5,-1427.1029 4657.5,-1427.1029 4657.5,-814.7008 5205.5,-814.7008 5205.5,-1427.1029"/>
<text text-anchor="middle" x="4931.5" y="-1411.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.select(node, pred)</text>
<text text-anchor="middle" x="4931.5" y="-1380.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes the Node and walks it, yielding the Nodes which match the predicate.</text>
<text text-anchor="middle" x="4931.5" y="-1365.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">=pred= is either a string, which matches to =id=, or a function, which takes</text>
<text text-anchor="middle" x="4931.5" y="-1349.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node and returns true or false on some premise. </text>
<text text-anchor="middle" x="4931.5" y="-1318.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4931.5" y="-1302.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.select(node, pred)</text>
<text text-anchor="middle" x="4931.5" y="-1287.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function qualifies(node, pred)</text>
<text text-anchor="middle" x="4931.5" y="-1272.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(pred) == &#39;string&#39; then</text>
<text text-anchor="middle" x="4931.5" y="-1256.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(node) == &#39;table&#39; and node.isNode and node.id == pred then</text>
<text text-anchor="middle" x="4931.5" y="-1241.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="4931.5" y="-1225.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4931.5" y="-1210.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="4931.5" y="-1195.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-1179.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(pred) == &#39;function&#39; then</text>
<text text-anchor="middle" x="4931.5" y="-1164.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return pred(node)</text>
<text text-anchor="middle" x="4931.5" y="-1148.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4931.5" y="-1133.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:halt(&quot;cannot select on predicate of type &quot; .. type(pred))</text>
<text text-anchor="middle" x="4931.5" y="-1118.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-1102.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-1071.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="4931.5" y="-1055.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if qualifies(ast, pred) then</text>
<text text-anchor="middle" x="4931.5" y="-1040.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="4931.5" y="-1025.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-1009.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="4931.5" y="-994.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="4931.5" y="-978.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="4931.5" y="-963.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-948.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-932.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4931.5" y="-901.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="4931.5" y="-885.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4931.5" y="-870.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4931.5" y="-823.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_35&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>section_35&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4431.4742,-2418.8999C4471.5176,-2314.9528 4675.1144,-1786.4435 4809.8505,-1436.6872"/>
<polygon fill="#000000" stroke="#000000" points="4813.1889,-1437.7573 4813.5177,-1427.1675 4806.6569,-1435.2409 4813.1889,-1437.7573"/>
</g>
<!-- header_68 -->
<g id="node69" class="node">
<title>header_68</title>
<ellipse fill="none" stroke="#000000" cx="5306.5" cy="-1120.9018" rx="82.7165" ry="18"/>
<text text-anchor="middle" x="5306.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : N.tokens(node)</text>
</g>
<!-- section_36&#45;&gt;header_68 -->
<g id="edge68" class="edge">
<title>section_36&#45;&gt;header_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4944.1658,-2418.9621C4913.7184,-2311.8998 4772.2547,-1754.7787 5033.5,-1463.0023 5088.2118,-1401.8965 5153.7971,-1482.1609 5214.5,-1427.0023 5295.884,-1353.0516 5306.3988,-1210.1711 5306.9961,-1149.3879"/>
<polygon fill="#000000" stroke="#000000" points="5310.4964,-1149.0326 5307.0071,-1139.0289 5303.4964,-1149.0251 5310.4964,-1149.0326"/>
</g>
<!-- block_69 -->
<g id="node70" class="node">
<title>block_69</title>
<ellipse fill="none" stroke="#000000" cx="5473.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5473.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 160&#45;163</text>
</g>
<!-- section_36&#45;&gt;block_69 -->
<g id="edge69" class="edge">
<title>section_36&#45;&gt;block_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4943.864,-2418.9319C4911.2919,-2310.5364 4757.9759,-1741.9316 5033.5,-1463.0023 5090.7775,-1405.017 5336.925,-1480.402 5398.5,-1427.0023 5480.7779,-1355.6485 5480.45,-1210.1987 5476.2321,-1149.015"/>
<polygon fill="#000000" stroke="#000000" points="5479.7134,-1148.6379 5475.4473,-1138.9399 5472.7345,-1149.1815 5479.7134,-1148.6379"/>
</g>
<!-- block_70 -->
<g id="node71" class="node">
<title>block_70</title>
<ellipse fill="none" stroke="#000000" cx="5622.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5622.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 164&#45;177</text>
</g>
<!-- section_36&#45;&gt;block_70 -->
<g id="edge70" class="edge">
<title>section_36&#45;&gt;block_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4943.751,-2418.8187C4910.5204,-2309.7634 4754.0261,-1737.974 5033.5,-1463.0023 5115.2779,-1382.5418 5460.8797,-1501.0578 5548.5,-1427.0023 5631.6164,-1356.7535 5630.2185,-1210.6904 5625.483,-1149.179"/>
<polygon fill="#000000" stroke="#000000" points="5628.9558,-1148.7117 5624.6115,-1139.0485 5621.9816,-1149.3117 5628.9558,-1148.7117"/>
</g>
<!-- leaf_75 -->
<g id="node76" class="node">
<title>leaf_75</title>
<polygon fill="none" stroke="#c0c0c0" points="6100.5,-1272.4023 5706.5,-1272.4023 5706.5,-969.4014 6100.5,-969.4014 6100.5,-1272.4023"/>
<text text-anchor="middle" x="5903.5" y="-1257.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">**** N.tokens(node)</text>
<text text-anchor="middle" x="5903.5" y="-1225.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Iterator returning all &#39;captured&#39; values as strings.</text>
<text text-anchor="middle" x="5903.5" y="-1194.402" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5903.5" y="-1179.002" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.tokens(node)</text>
<text text-anchor="middle" x="5903.5" y="-1163.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="5903.5" y="-1148.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for node in N.walk(ast) do</text>
<text text-anchor="middle" x="5903.5" y="-1132.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not node[1] then</text>
<text text-anchor="middle" x="5903.5" y="-1117.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(node:toValue())</text>
<text text-anchor="middle" x="5903.5" y="-1102.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5903.5" y="-1086.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5903.5" y="-1071.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5903.5" y="-1039.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="5903.5" y="-1024.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">end &#160;</text>
<text text-anchor="middle" x="5903.5" y="-1009.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua &#160;</text>
<text text-anchor="middle" x="5903.5" y="-977.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_36&#45;&gt;leaf_75 -->
<g id="edge75" class="edge">
<title>section_36&#45;&gt;leaf_75</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4943.6898,-2418.756C4910.1025,-2309.3353 4751.8864,-1735.7822 5033.5,-1463.0023 5086.5711,-1411.596 5633.2448,-1463.4773 5697.5,-1427.0023 5755.5332,-1394.0593 5800.448,-1337.2376 5833.3109,-1281.427"/>
<polygon fill="#000000" stroke="#000000" points="5836.507,-1282.8914 5838.4818,-1272.4822 5830.4468,-1279.3879 5836.507,-1282.8914"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="2107,-739.2019 1622,-739.2019 1622,-516.0003 2107,-516.0003 2107,-739.2019"/>
<text text-anchor="middle" x="1864.5" y="-724.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toString(node, depth)</text>
<text text-anchor="middle" x="1864.5" y="-708.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local depth = depth or 0</text>
<text text-anchor="middle" x="1864.5" y="-693.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="1864.5" y="-678.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;phrase = (&quot; &#160;&quot;):rep(depth) .. &quot;id: &quot; .. node.id .. &quot;, &#160;&quot;</text>
<text text-anchor="middle" x="1864.5" y="-662.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;.. &quot;first: &quot; .. node.first .. &quot;, last: &quot; .. node.last .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1864.5" y="-647.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if node[1] then</text>
<text text-anchor="middle" x="1864.5" y="-631.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _,v in ipairs(node) do</text>
<text text-anchor="middle" x="1864.5" y="-616.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if(v.isNode) then</text>
<text text-anchor="middle" x="1864.5" y="-601.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. N.toString(v, depth + 1)</text>
<text text-anchor="middle" x="1864.5" y="-585.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1864.5" y="-570.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1864.5" y="-554.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end </text>
<text text-anchor="middle" x="1864.5" y="-539.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return phrase</text>
<text text-anchor="middle" x="1864.5" y="-524.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>codeblock_38&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2060.176,-1102.7276C2050.9677,-1054.4258 2022.7787,-919.4106 1977.5,-814.8013 1967.8913,-792.6019 1956.065,-769.8556 1943.7203,-748.2101"/>
<polygon fill="#000000" stroke="#000000" points="1946.6244,-746.24 1938.5928,-739.3303 1940.5624,-749.7404 1946.6244,-746.24"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="2519.5,-779.0018 2125.5,-779.0018 2125.5,-476.2003 2519.5,-476.2003 2519.5,-779.0018"/>
<text text-anchor="middle" x="2322.5" y="-763.6013" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dotLabel(node)</text>
<text text-anchor="middle" x="2322.5" y="-748.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.id</text>
<text text-anchor="middle" x="2322.5" y="-732.8012" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2322.5" y="-701.4012" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toMarkdown(node)</text>
<text text-anchor="middle" x="2322.5" y="-686.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if not node[1] then</text>
<text text-anchor="middle" x="2322.5" y="-670.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return string.sub(node.str, node.first, node.last)</text>
<text text-anchor="middle" x="2322.5" y="-655.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="2322.5" y="-639.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no toMarkdown for &quot; .. node.id)</text>
<text text-anchor="middle" x="2322.5" y="-624.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2322.5" y="-609.001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2322.5" y="-577.601" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.dot(node)</text>
<text text-anchor="middle" x="2322.5" y="-562.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return dot.dot(node)</text>
<text text-anchor="middle" x="2322.5" y="-546.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2322.5" y="-515.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.toValue(node)</text>
<text text-anchor="middle" x="2322.5" y="-500.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return node.str:sub(node.first,node.last)</text>
<text text-anchor="middle" x="2322.5" y="-484.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>codeblock_41&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2308.0516,-1102.76C2309.5873,-1052.2584 2314.0324,-906.072 2317.5906,-789.0539"/>
<polygon fill="#000000" stroke="#000000" points="2321.0938,-789.0014 2317.8994,-778.8996 2314.097,-788.7886 2321.0938,-789.0014"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="2723.5,-647.5031 2553.5,-647.5031 2553.5,-607.699 2723.5,-607.699 2723.5,-647.5031"/>
<text text-anchor="middle" x="2638.5" y="-616.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">Depth&#45;first iterator. </text>
</g>
<!-- block_45&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>block_45&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2686.6612,-1102.76C2679.1704,-1028.8558 2650.9099,-750.0376 2641.5396,-657.5895"/>
<polygon fill="#000000" stroke="#000000" points="2645.0085,-657.1052 2640.5178,-647.5092 2638.0442,-657.8112 2645.0085,-657.1052"/>
</g>
<!-- codeblock_48 -->
<g id="node49" class="node">
<title>codeblock_48</title>
<ellipse fill="none" stroke="#000000" cx="2818.5" cy="-627.6011" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="2818.5" y="-623.4011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 82&#45;97</text>
</g>
<!-- block_46&#45;&gt;codeblock_48 -->
<g id="edge48" class="edge">
<title>block_46&#45;&gt;codeblock_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2818.5,-1102.76C2818.5,-1028.3462 2818.5,-746.1828 2818.5,-655.7039"/>
<polygon fill="#000000" stroke="#000000" points="2822.0001,-655.6469 2818.5,-645.6469 2815.0001,-655.647 2822.0001,-655.6469"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="2967.5,-645.6011 2913.5,-645.6011 2913.5,-609.6011 2967.5,-609.6011 2967.5,-645.6011"/>
</g>
<!-- block_46&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>block_46&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2820.3163,-1102.732C2825.5723,-1054.441 2843.0722,-919.4498 2883.5,-814.8013 2890.1751,-797.5226 2897.6137,-795.997 2904.5,-778.8013 2921.0114,-737.5709 2931.1726,-686.8554 2936.3238,-655.8954"/>
<polygon fill="#000000" stroke="#000000" points="2939.8125,-656.2441 2937.9391,-645.8162 2932.9006,-655.1363 2939.8125,-656.2441"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="3022.5,-332.5009 2614.5,-332.5009 2614.5,-107.8999 3022.5,-107.8999 3022.5,-332.5009"/>
<text text-anchor="middle" x="2818.5" y="-317.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walkDeep(node)</text>
<text text-anchor="middle" x="2818.5" y="-302.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="2818.5" y="-286.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="2818.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="2818.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="2818.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="2818.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2818.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2818.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="2818.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2818.5" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="2818.5" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_48&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>codeblock_48&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2818.5,-609.5699C2818.5,-563.6125 2818.5,-438.9397 2818.5,-342.9304"/>
<polygon fill="#000000" stroke="#000000" points="2822.0001,-342.8497 2818.5,-332.8497 2815.0001,-342.8498 2822.0001,-342.8497"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="3534.5,-647.5031 3196.5,-647.5031 3196.5,-607.699 3534.5,-607.699 3534.5,-647.5031"/>
<text text-anchor="middle" x="3365.5" y="-616.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">Breadth&#45;first iterator. &#160;This is the default. </text>
</g>
<!-- block_53&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>block_53&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3491.9291,-1102.8273C3482.4212,-1055.315 3455.1823,-923.1071 3425.5,-814.8013 3410.0398,-758.3896 3388.388,-693.6072 3375.7642,-656.946"/>
<polygon fill="#000000" stroke="#000000" points="3379.0326,-655.688 3372.4557,-647.3817 3372.4172,-657.9765 3379.0326,-655.688"/>
</g>
<!-- codeblock_56 -->
<g id="node57" class="node">
<title>codeblock_56</title>
<ellipse fill="none" stroke="#000000" cx="3639.5" cy="-627.6011" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="3639.5" y="-623.4011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 103&#45;119</text>
</g>
<!-- block_54&#45;&gt;codeblock_56 -->
<g id="edge56" class="edge">
<title>block_54&#45;&gt;codeblock_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3639.5,-1102.76C3639.5,-1028.3462 3639.5,-746.1828 3639.5,-655.7039"/>
<polygon fill="#000000" stroke="#000000" points="3643.0001,-655.6469 3639.5,-645.6469 3636.0001,-655.647 3643.0001,-655.6469"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="3798.5,-645.6011 3744.5,-645.6011 3744.5,-609.6011 3798.5,-609.6011 3798.5,-645.6011"/>
</g>
<!-- block_54&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>block_54&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3642.0781,-1102.7433C3649.3236,-1054.48 3672.1534,-919.5506 3714.5,-814.8013 3721.4425,-797.6283 3728.6137,-795.997 3735.5,-778.8013 3752.0114,-737.5709 3762.1726,-686.8554 3767.3238,-655.8954"/>
<polygon fill="#000000" stroke="#000000" points="3770.8125,-656.2441 3768.9391,-645.8162 3763.9006,-655.1363 3770.8125,-656.2441"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="3836.5,-332.5009 3442.5,-332.5009 3442.5,-107.8999 3836.5,-107.8999 3836.5,-332.5009"/>
<text text-anchor="middle" x="3639.5" y="-317.4006" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.walk(node)</text>
<text text-anchor="middle" x="3639.5" y="-302.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="3639.5" y="-286.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not ast.isNode then return nil end</text>
<text text-anchor="middle" x="3639.5" y="-255.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="3639.5" y="-239.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="3639.5" y="-224.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(v) == &#39;table&#39; and v.isNode then</text>
<text text-anchor="middle" x="3639.5" y="-209.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="3639.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3639.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3639.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3639.5" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="3639.5" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_56&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>codeblock_56&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3639.5,-609.5699C3639.5,-563.6125 3639.5,-438.9397 3639.5,-342.9304"/>
<polygon fill="#000000" stroke="#000000" points="3643.0001,-342.8497 3639.5,-332.8497 3636.0001,-342.8498 3643.0001,-342.8497"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="4468.5,-662.8014 3920.5,-662.8014 3920.5,-592.4007 4468.5,-592.4007 4468.5,-662.8014"/>
<text text-anchor="middle" x="4194.5" y="-631.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes the Node and walks it, yielding the Nodes which match the predicate.</text>
<text text-anchor="middle" x="4194.5" y="-616.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">=pred= is either a string, which matches to =id=, or a function, which takes</text>
<text text-anchor="middle" x="4194.5" y="-600.701" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node and returns true or false on some premise. </text>
</g>
<!-- block_61&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>block_61&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4422.9932,-1102.6643C4418.3481,-1053.6425 4401.3477,-915.9093 4350.5,-814.8013 4322.5513,-759.2268 4275.2428,-705.7345 4240.0347,-670.2671"/>
<polygon fill="#000000" stroke="#000000" points="4242.2718,-667.5553 4232.7167,-662.9781 4237.3319,-672.5149 4242.2718,-667.5553"/>
</g>
<!-- codeblock_64 -->
<g id="node65" class="node">
<title>codeblock_64</title>
<ellipse fill="none" stroke="#000000" cx="4573.5" cy="-627.6011" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="4573.5" y="-623.4011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 128&#45;157</text>
</g>
<!-- block_62&#45;&gt;codeblock_64 -->
<g id="edge64" class="edge">
<title>block_62&#45;&gt;codeblock_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4573.5,-1102.76C4573.5,-1028.3462 4573.5,-746.1828 4573.5,-655.7039"/>
<polygon fill="#000000" stroke="#000000" points="4577.0001,-655.6469 4573.5,-645.6469 4570.0001,-655.647 4577.0001,-655.6469"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="4732.5,-645.6011 4678.5,-645.6011 4678.5,-609.6011 4732.5,-609.6011 4732.5,-645.6011"/>
</g>
<!-- block_62&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>block_62&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4576.0781,-1102.7433C4583.3236,-1054.48 4606.1534,-919.5506 4648.5,-814.8013 4655.4425,-797.6283 4662.6137,-795.997 4669.5,-778.8013 4686.0114,-737.5709 4696.1726,-686.8554 4701.3238,-655.8954"/>
<polygon fill="#000000" stroke="#000000" points="4704.8125,-656.2441 4702.9391,-645.8162 4697.9006,-655.1363 4704.8125,-656.2441"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="4840.5,-440.6014 4306.5,-440.6014 4306.5,.2006 4840.5,.2006 4840.5,-440.6014"/>
<text text-anchor="middle" x="4573.5" y="-425.2008" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.select(node, pred)</text>
<text text-anchor="middle" x="4573.5" y="-409.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function qualifies(node, pred)</text>
<text text-anchor="middle" x="4573.5" y="-394.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if type(pred) == &#39;string&#39; then</text>
<text text-anchor="middle" x="4573.5" y="-379.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if type(node) == &#39;table&#39; and node.isNode and node.id == pred then</text>
<text text-anchor="middle" x="4573.5" y="-363.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="4573.5" y="-348.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4573.5" y="-332.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return false</text>
<text text-anchor="middle" x="4573.5" y="-317.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-302.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;elseif type(pred) == &#39;function&#39; then</text>
<text text-anchor="middle" x="4573.5" y="-286.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return pred(node)</text>
<text text-anchor="middle" x="4573.5" y="-271.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4573.5" y="-255.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:halt(&quot;cannot select on predicate of type &quot; .. type(pred))</text>
<text text-anchor="middle" x="4573.5" y="-240.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-193.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local function traverse(ast)</text>
<text text-anchor="middle" x="4573.5" y="-178.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if qualifies(ast, pred) then</text>
<text text-anchor="middle" x="4573.5" y="-162.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(ast)</text>
<text text-anchor="middle" x="4573.5" y="-147.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-132.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if ast.isNode then</text>
<text text-anchor="middle" x="4573.5" y="-116.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, v in ipairs(ast) do</text>
<text text-anchor="middle" x="4573.5" y="-101.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;traverse(v)</text>
<text text-anchor="middle" x="4573.5" y="-85.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-70.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="4573.5" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="4573.5" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_64&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>codeblock_64&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4573.5,-609.5699C4573.5,-579.8724 4573.5,-517.3056 4573.5,-450.8439"/>
<polygon fill="#000000" stroke="#000000" points="4577.0001,-450.5816 4573.5,-440.5817 4570.0001,-450.5817 4577.0001,-450.5816"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="5517.5,-647.5031 5123.5,-647.5031 5123.5,-607.699 5517.5,-607.699 5517.5,-647.5031"/>
<text text-anchor="middle" x="5320.5" y="-616.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Iterator returning all &#39;captured&#39; values as strings.</text>
</g>
<!-- block_69&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>block_69&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5470.0619,-1102.6866C5460.8109,-1054.835 5433.6917,-921.8781 5398.5,-814.8013 5379.7096,-757.6284 5351.2381,-693.3468 5334.3906,-656.9379"/>
<polygon fill="#000000" stroke="#000000" points="5337.36,-655.0236 5329.9646,-647.4369 5331.0147,-657.9796 5337.36,-655.0236"/>
</g>
<!-- codeblock_72 -->
<g id="node73" class="node">
<title>codeblock_72</title>
<ellipse fill="none" stroke="#000000" cx="5622.5" cy="-627.6011" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5622.5" y="-623.4011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 164&#45;176</text>
</g>
<!-- block_70&#45;&gt;codeblock_72 -->
<g id="edge72" class="edge">
<title>block_70&#45;&gt;codeblock_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5622.5,-1102.76C5622.5,-1028.3462 5622.5,-746.1828 5622.5,-655.7039"/>
<polygon fill="#000000" stroke="#000000" points="5626.0001,-655.6469 5622.5,-645.6469 5619.0001,-655.647 5626.0001,-655.6469"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="5781.5,-645.6011 5727.5,-645.6011 5727.5,-609.6011 5781.5,-609.6011 5781.5,-645.6011"/>
</g>
<!-- block_70&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>block_70&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5625.0781,-1102.7433C5632.3236,-1054.48 5655.1534,-919.5506 5697.5,-814.8013 5704.4425,-797.6283 5711.6137,-795.997 5718.5,-778.8013 5735.0114,-737.5709 5745.1726,-686.8554 5750.3238,-655.8954"/>
<polygon fill="#000000" stroke="#000000" points="5753.8125,-656.2441 5751.9391,-645.8162 5746.9006,-655.1363 5753.8125,-656.2441"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="5819.5,-309.2007 5425.5,-309.2007 5425.5,-131.2001 5819.5,-131.2001 5819.5,-309.2007"/>
<text text-anchor="middle" x="5622.5" y="-294.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">function N.tokens(node)</text>
<text text-anchor="middle" x="5622.5" y="-278.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local function traverse(ast)</text>
<text text-anchor="middle" x="5622.5" y="-263.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for node in N.walk(ast) do</text>
<text text-anchor="middle" x="5622.5" y="-247.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if not node[1] then</text>
<text text-anchor="middle" x="5622.5" y="-232.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;coroutine.yield(node:toValue())</text>
<text text-anchor="middle" x="5622.5" y="-217.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5622.5" y="-201.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5622.5" y="-186.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="5622.5" y="-154.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return coroutine.wrap(function() traverse(node) end)</text>
<text text-anchor="middle" x="5622.5" y="-139.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">end &#160;</text>
</g>
<!-- codeblock_72&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_72&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5622.5,-609.5699C5622.5,-559.8199 5622.5,-417.8266 5622.5,-319.807"/>
<polygon fill="#000000" stroke="#000000" points="5626.0001,-319.5717 5622.5,-309.5718 5619.0001,-319.5718 5626.0001,-319.5717"/>
</g>
<!-- leaf_86 -->
<g id="node87" class="node">
<title>leaf_86</title>
<polygon fill="none" stroke="#c0c0c0" points="6170.5,-2464.3043 5608.5,-2464.3043 5608.5,-2409.7035 6170.5,-2409.7035 6170.5,-2464.3043"/>
<text text-anchor="middle" x="5889.5" y="-2433.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;To be a Node, currently, indexed elements of the Array portion must also be </text>
<text text-anchor="middle" x="5889.5" y="-2417.8039" font-family="Inconsolata" font-size="14.00" fill="#000000">Nodes. </text>
</g>
<!-- block_79&#45;&gt;leaf_86 -->
<g id="edge86" class="edge">
<title>block_79&#45;&gt;leaf_86</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6827.5962,-3908.3291C6842.4248,-3836.4236 6885.5146,-3571.9726 6748.5,-3447.0055 6654.8906,-3361.627 6278.6269,-3489.9108 6179.5,-3411.0055 5875.819,-3169.2744 5879.9151,-2623.7187 5887.0745,-2475.04"/>
<polygon fill="#000000" stroke="#000000" points="5890.5914,-2474.8021 5887.6129,-2464.6346 5883.6007,-2474.4403 5890.5914,-2474.8021"/>
</g>
<!-- leaf_87 -->
<g id="node88" class="node">
<title>leaf_87</title>
<polygon fill="none" stroke="#c0c0c0" points="6736.5,-2464.2044 6188.5,-2464.2044 6188.5,-2409.8034 6736.5,-2409.8034 6736.5,-2464.2044"/>
<text text-anchor="middle" x="6462.5" y="-2448.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">I&#39;m mostly convinced that indexed elements can also be strings, and that </text>
<text text-anchor="middle" x="6462.5" y="-2433.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">this is the form leaf nodes should take. &#160;Currently, they have a &#39;val&#39; field</text>
<text text-anchor="middle" x="6462.5" y="-2418.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">and no children, which we should replace with a child string at [1].</text>
</g>
<!-- block_80&#45;&gt;leaf_87 -->
<g id="edge87" class="edge">
<title>block_80&#45;&gt;leaf_87</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6976.0751,-3908.5134C6988.7151,-3838.39 7024.0886,-3582.7976 6898.5,-3447.0055 6851.0681,-3395.7199 6796.1561,-3459.1091 6745.5,-3411.0055 6465.2111,-3144.8395 6457.5221,-2619.0172 6461.0257,-2474.5126"/>
<polygon fill="#000000" stroke="#000000" points="6464.5278,-2474.4833 6461.3057,-2464.3903 6457.5304,-2474.2897 6464.5278,-2474.4833"/>
</g>
<!-- leaf_88 -->
<g id="node89" class="node">
<title>leaf_88</title>
<polygon fill="none" stroke="#c0c0c0" points="7288.5,-2464.2044 6754.5,-2464.2044 6754.5,-2409.8034 7288.5,-2409.8034 7288.5,-2464.2044"/>
<text text-anchor="middle" x="7021.5" y="-2448.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">This gives us a lighter way to handle the circumstance where we have, say,</text>
<text text-anchor="middle" x="7021.5" y="-2433.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">a list, =(foo bar baz)=. We currently either need a &quot;left&#45;per&quot; or &quot;pal&quot;</text>
<text text-anchor="middle" x="7021.5" y="-2418.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">Node class to hold the =(=, or we would have to skip it entirely.</text>
</g>
<!-- block_81&#45;&gt;leaf_88 -->
<g id="edge88" class="edge">
<title>block_81&#45;&gt;leaf_88</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7120.2896,-3908.6742C7110.0817,-3756.6074 7038.4034,-2688.8144 7024.0127,-2474.435"/>
<polygon fill="#000000" stroke="#000000" points="7027.4954,-2474.0589 7023.3334,-2464.3158 7020.5111,-2474.5278 7027.4954,-2474.0589"/>
</g>
<!-- leaf_89 -->
<g id="node90" class="node">
<title>leaf_89</title>
<polygon fill="none" stroke="#c0c0c0" points="7834,-2479.5041 7307,-2479.5041 7307,-2394.5037 7834,-2394.5037 7834,-2479.5041"/>
<text text-anchor="middle" x="7570.5" y="-2464.304" font-family="Inconsolata" font-size="14.00" fill="#000000">Quipu can&#39;t lose any information from the string, so they have to include</text>
<text text-anchor="middle" x="7570.5" y="-2448.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">whitespace. &#160;We&#39;re not limited in the same way and can reconstruct less </text>
<text text-anchor="middle" x="7570.5" y="-2433.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">semantically crucial parts of a document using the span and the original </text>
<text text-anchor="middle" x="7570.5" y="-2418.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">string, since we&#39;re not /currently/ editing our strings once they&#39;re</text>
<text text-anchor="middle" x="7570.5" y="-2402.7039" font-family="Inconsolata" font-size="14.00" fill="#000000">entered in.</text>
</g>
<!-- block_82&#45;&gt;leaf_89 -->
<g id="edge89" class="edge">
<title>block_82&#45;&gt;leaf_89</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7372.9209,-3908.6742C7392.8844,-3759.9759 7530.4025,-2735.6706 7563.396,-2489.9182"/>
<polygon fill="#000000" stroke="#000000" points="7566.8905,-2490.1921 7564.7524,-2479.8153 7559.9528,-2489.2606 7566.8905,-2490.1921"/>
</g>
<!-- leaf_90 -->
<g id="node91" class="node">
<title>leaf_90</title>
<polygon fill="none" stroke="#c0c0c0" points="8358.5,-2472.2043 7852.5,-2472.2043 7852.5,-2401.8035 8358.5,-2401.8035 8358.5,-2472.2043"/>
<text text-anchor="middle" x="8105.5" y="-2456.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">Nodes are meant to be broadly compatible with everything we intend to</text>
<text text-anchor="middle" x="8105.5" y="-2441.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">do with abstract syntax trees. &#160;The more I think about this the better</text>
<text text-anchor="middle" x="8105.5" y="-2426.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">it strikes me as an approach. </text>
</g>
<!-- block_83&#45;&gt;leaf_90 -->
<g id="edge90" class="edge">
<title>block_83&#45;&gt;leaf_90</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7816.0466,-3908.6742C7845.6001,-3758.4147 8051.0063,-2714.0666 8096.564,-2482.4374"/>
<polygon fill="#000000" stroke="#000000" points="8100.0543,-2482.827 8098.5501,-2472.3395 8093.1859,-2481.4761 8100.0543,-2482.827"/>
</g>
<!-- header_91 -->
<g id="node92" class="node">
<title>header_91</title>
<ellipse fill="none" stroke="#000000" cx="8422.5" cy="-2437.0039" rx="45.9718" ry="18"/>
<text text-anchor="middle" x="8422.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Fields</text>
</g>
<!-- section_84&#45;&gt;header_91 -->
<g id="edge91" class="edge">
<title>section_84&#45;&gt;header_91</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8831.4315,-3908.9166C8767.0337,-3847.4388 8557.2004,-3635.3896 8477.5,-3411.0055 8351.613,-3056.5903 8402.7416,-2584.1428 8418.5075,-2465.1245"/>
<polygon fill="#000000" stroke="#000000" points="8422.0015,-2465.4046 8419.8742,-2455.0255 8415.0647,-2464.4657 8422.0015,-2465.4046"/>
</g>
<!-- block_92 -->
<g id="node93" class="node">
<title>block_92</title>
<ellipse fill="none" stroke="#000000" cx="8552.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8552.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 202&#45;208</text>
</g>
<!-- section_84&#45;&gt;block_92 -->
<g id="edge92" class="edge">
<title>section_84&#45;&gt;block_92</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8840.0892,-3908.7532C8803.2166,-3844.1533 8678.3272,-3616.4818 8627.5,-3411.0055 8537.2609,-3046.201 8547.0468,-2583.2037 8551.3092,-2465.3038"/>
<polygon fill="#000000" stroke="#000000" points="8554.8076,-2465.4098 8551.689,-2455.2843 8547.8126,-2465.1445 8554.8076,-2465.4098"/>
</g>
<!-- block_93 -->
<g id="node94" class="node">
<title>block_93</title>
<ellipse fill="none" stroke="#000000" cx="8701.5" cy="-2437.0039" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="8701.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 209&#45;211</text>
</g>
<!-- section_84&#45;&gt;block_93 -->
<g id="edge93" class="edge">
<title>section_84&#45;&gt;block_93</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8847.3887,-3908.494C8836.1426,-3842.0858 8797.1266,-3606.5927 8775.5,-3411.0055 8734.2886,-3038.2958 8709.0616,-2582.7848 8702.9519,-2465.5682"/>
<polygon fill="#000000" stroke="#000000" points="8706.4325,-2465.1006 8702.4204,-2455.2948 8699.4419,-2465.4623 8706.4325,-2465.1006"/>
</g>
<!-- block_94 -->
<g id="node95" class="node">
<title>block_94</title>
<ellipse fill="none" stroke="#000000" cx="8850.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8850.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 212&#45;215</text>
</g>
<!-- section_84&#45;&gt;block_94 -->
<g id="edge94" class="edge">
<title>section_84&#45;&gt;block_94</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8850.5,-3908.6742C8850.5,-3754.392 8850.5,-2657.5068 8850.5,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="8854.0001,-2465.4752 8850.5,-2455.4752 8847.0001,-2465.4753 8854.0001,-2465.4752"/>
</g>
<!-- block_95 -->
<g id="node96" class="node">
<title>block_95</title>
<ellipse fill="none" stroke="#000000" cx="8999.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8999.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 216&#45;220</text>
</g>
<!-- section_84&#45;&gt;block_95 -->
<g id="edge95" class="edge">
<title>section_84&#45;&gt;block_95</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8853.6113,-3908.494C8864.8574,-3842.0858 8903.8734,-3606.5927 8925.5,-3411.0055 8966.7114,-3038.2958 8991.9384,-2582.7848 8998.0481,-2465.5682"/>
<polygon fill="#000000" stroke="#000000" points="9001.5581,-2465.4623 8998.5796,-2455.2948 8994.5675,-2465.1006 9001.5581,-2465.4623"/>
</g>
<!-- block_96 -->
<g id="node97" class="node">
<title>block_96</title>
<ellipse fill="none" stroke="#000000" cx="9148.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9148.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 221&#45;224</text>
</g>
<!-- section_84&#45;&gt;block_96 -->
<g id="edge96" class="edge">
<title>section_84&#45;&gt;block_96</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8860.9664,-3908.7622C8898.0347,-3844.1929 9023.5739,-3616.6117 9074.5,-3411.0055 9164.8436,-3046.2571 9154.2321,-2583.2188 9149.7459,-2465.3069"/>
<polygon fill="#000000" stroke="#000000" points="9153.2421,-2465.1391 9149.3469,-2455.2863 9146.2476,-2465.4177 9153.2421,-2465.1391"/>
</g>
<!-- section_97 -->
<g id="node98" class="node">
<title>section_97</title>
<ellipse fill="none" stroke="#000000" cx="9791.5" cy="-2437.0039" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="9791.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 225&#45;237</text>
</g>
<!-- section_84&#45;&gt;section_97 -->
<g id="edge97" class="edge">
<title>section_84&#45;&gt;section_97</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8864.3749,-3908.8892C8914.8181,-3843.8376 9092.3847,-3612.4168 9223.5,-3411.0055 9461.1132,-3045.9983 9714.7484,-2579.7285 9777.069,-2463.9315"/>
<polygon fill="#000000" stroke="#000000" points="9780.2146,-2465.4717 9781.8667,-2455.0065 9774.049,-2462.1573 9780.2146,-2465.4717"/>
</g>
<!-- leaf_113 -->
<g id="node114" class="node">
<title>leaf_113</title>
<polygon fill="none" stroke="#c0c0c0" points="10404.5,-2627.8045 9884.5,-2627.8045 9884.5,-2246.2033 10404.5,-2246.2033 10404.5,-2627.8045"/>
<text text-anchor="middle" x="10144.5" y="-2612.7042" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Fields</text>
<text text-anchor="middle" x="10144.5" y="-2581.3041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;There are invariant fields a Node is also expected to have, they are:</text>
<text text-anchor="middle" x="10144.5" y="-2565.9041" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="10144.5" y="-2550.5041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;Index into =str= which begins the span.</text>
<text text-anchor="middle" x="10144.5" y="-2535.104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Index into =str= which ends the span.</text>
<text text-anchor="middle" x="10144.5" y="-2503.704" font-family="Inconsolata" font-size="14.00" fill="#000000">In principle, we want the Node to be localized. We could include a </text>
<text text-anchor="middle" x="10144.5" y="-2488.304" font-family="Inconsolata" font-size="14.00" fill="#000000">reference to the whole =str= and derive substrings lazily.</text>
<text text-anchor="middle" x="10144.5" y="-2456.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">If we included the full span as a substring on each Node, we&#39;d end up</text>
<text text-anchor="middle" x="10144.5" y="-2441.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">with a lot of spans, and wouldn&#39;t use most of them. Even slicing a piece</text>
<text text-anchor="middle" x="10144.5" y="-2426.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">out is costly if we&#39;re not going to use it. </text>
<text text-anchor="middle" x="10144.5" y="-2394.7039" font-family="Inconsolata" font-size="14.00" fill="#000000">So our constructor for a Node class takes (Constructor, node, str) as </text>
<text text-anchor="middle" x="10144.5" y="-2379.3038" font-family="Inconsolata" font-size="14.00" fill="#000000">the standard interface. &#160;If a module needs a non&#45;standard constructor,</text>
<text text-anchor="middle" x="10144.5" y="-2363.9038" font-family="Inconsolata" font-size="14.00" fill="#000000">as our Section and Block modules currently take an array of lines, that</text>
<text text-anchor="middle" x="10144.5" y="-2348.5038" font-family="Inconsolata" font-size="14.00" fill="#000000">will need to be provided as the second return from the module. </text>
<text text-anchor="middle" x="10144.5" y="-2317.1037" font-family="Inconsolata" font-size="14.00" fill="#000000">This will allow for the kind of multi&#45;pass recursive&#45;descent that I&#39;m</text>
<text text-anchor="middle" x="10144.5" y="-2301.7037" font-family="Inconsolata" font-size="14.00" fill="#000000">aiming for. </text>
<text text-anchor="middle" x="10144.5" y="-2254.3037" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_84&#45;&gt;leaf_113 -->
<g id="edge113" class="edge">
<title>section_84&#45;&gt;leaf_113</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8908.1144,-3914.9711C9082.3516,-3876.4081 9608.1143,-3736.9254 9875.5,-3411.0055 10057.8665,-3188.7165 10116.9816,-2851.8232 10135.9128,-2638.186"/>
<polygon fill="#000000" stroke="#000000" points="10139.4097,-2638.3713 10136.7842,-2628.1069 10132.4358,-2637.7682 10139.4097,-2638.3713"/>
</g>
<!-- header_114 -->
<g id="node115" class="node">
<title>header_114</title>
<ellipse fill="none" stroke="#000000" cx="12306.5" cy="-2437.0039" rx="67.7307" ry="18"/>
<text text-anchor="middle" x="12306.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Other fields</text>
</g>
<!-- section_85&#45;&gt;header_114 -->
<g id="edge114" class="edge">
<title>section_85&#45;&gt;header_114</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12876.5485,-3909.7844C12785.6111,-3852.9613 12497.437,-3658.5624 12382.5,-3411.0055 12223.5548,-3068.6615 12283.5147,-2585.5088 12301.9079,-2465.0365"/>
<polygon fill="#000000" stroke="#000000" points="12305.3695,-2465.5534 12303.4525,-2455.1334 12298.4531,-2464.4746 12305.3695,-2465.5534"/>
</g>
<!-- block_115 -->
<g id="node116" class="node">
<title>block_115</title>
<ellipse fill="none" stroke="#000000" cx="12457.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12457.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 238&#45;243</text>
</g>
<!-- section_85&#45;&gt;block_115 -->
<g id="edge115" class="edge">
<title>section_85&#45;&gt;block_115</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12885.5948,-3908.8577C12821.7219,-3847.1906 12613.3756,-3634.6051 12531.5,-3411.0055 12402.011,-3057.3749 12441.4898,-2584.3508 12454.2306,-2465.1659"/>
<polygon fill="#000000" stroke="#000000" points="12457.7286,-2465.3745 12455.3397,-2455.0525 12450.7704,-2464.6113 12457.7286,-2465.3745"/>
</g>
<!-- block_116 -->
<g id="node117" class="node">
<title>block_116</title>
<ellipse fill="none" stroke="#000000" cx="12606.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12606.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 244&#45;246</text>
</g>
<!-- section_85&#45;&gt;block_116 -->
<g id="edge116" class="edge">
<title>section_85&#45;&gt;block_116</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12894.0336,-3908.7622C12856.9653,-3844.1929 12731.4261,-3616.6117 12680.5,-3411.0055 12590.1564,-3046.2571 12600.7679,-2583.2188 12605.2541,-2465.3069"/>
<polygon fill="#000000" stroke="#000000" points="12608.7524,-2465.4177 12605.6531,-2455.2863 12601.7579,-2465.1391 12608.7524,-2465.4177"/>
</g>
<!-- block_117 -->
<g id="node118" class="node">
<title>block_117</title>
<ellipse fill="none" stroke="#000000" cx="12755.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12755.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 247&#45;249</text>
</g>
<!-- section_85&#45;&gt;block_117 -->
<g id="edge117" class="edge">
<title>section_85&#45;&gt;block_117</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12901.3887,-3908.494C12890.1426,-3842.0858 12851.1266,-3606.5927 12829.5,-3411.0055 12788.2886,-3038.2958 12763.0616,-2582.7848 12756.9519,-2465.5682"/>
<polygon fill="#000000" stroke="#000000" points="12760.4325,-2465.1006 12756.4204,-2455.2948 12753.4419,-2465.4623 12760.4325,-2465.1006"/>
</g>
<!-- block_118 -->
<g id="node119" class="node">
<title>block_118</title>
<ellipse fill="none" stroke="#000000" cx="12904.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="12904.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 250&#45;253</text>
</g>
<!-- section_85&#45;&gt;block_118 -->
<g id="edge118" class="edge">
<title>section_85&#45;&gt;block_118</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12904.5,-3908.6742C12904.5,-3754.392 12904.5,-2657.5068 12904.5,-2465.614"/>
<polygon fill="#000000" stroke="#000000" points="12908.0001,-2465.4752 12904.5,-2455.4752 12901.0001,-2465.4753 12908.0001,-2465.4752"/>
</g>
<!-- block_119 -->
<g id="node120" class="node">
<title>block_119</title>
<ellipse fill="none" stroke="#000000" cx="13267.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="13267.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 254&#45;258</text>
</g>
<!-- section_85&#45;&gt;block_119 -->
<g id="edge119" class="edge">
<title>section_85&#45;&gt;block_119</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12907.0738,-3908.2809C12916.1649,-3844.1879 12948.3903,-3625.1713 12988.5,-3447.0055 13077.2165,-3052.9298 13221.9351,-2582.6116 13258.7609,-2464.7924"/>
<polygon fill="#000000" stroke="#000000" points="13262.1478,-2465.6887 13261.7959,-2455.0997 13255.4676,-2463.597 13262.1478,-2465.6887"/>
</g>
<!-- block_120 -->
<g id="node121" class="node">
<title>block_120</title>
<ellipse fill="none" stroke="#000000" cx="13660.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="13660.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 259&#45;260</text>
</g>
<!-- section_85&#45;&gt;block_120 -->
<g id="edge120" class="edge">
<title>section_85&#45;&gt;block_120</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12900.9374,-3908.4324C12888.1644,-3836.913 12852.3243,-3573.7126 12988.5,-3447.0055 13046.389,-3393.1416 13280.9302,-3460.62 13342.5,-3411.0055 13654.0413,-3159.9577 13663.6172,-2598.1579 13661.3519,-2465.4743"/>
<polygon fill="#000000" stroke="#000000" points="13664.8479,-2465.2424 13661.1392,-2455.3179 13657.8494,-2465.389 13664.8479,-2465.2424"/>
</g>
<!-- block_121 -->
<g id="node122" class="node">
<title>block_121</title>
<ellipse fill="none" stroke="#000000" cx="14062.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="14062.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 261&#45;263</text>
</g>
<!-- section_85&#45;&gt;block_121 -->
<g id="edge121" class="edge">
<title>section_85&#45;&gt;block_121</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12900.8321,-3908.705C12887.405,-3837.091 12848.6859,-3570.3262 12988.5,-3447.0055 13050.8186,-3392.0383 13669.224,-3461.1303 13735.5,-3411.0055 14055.8417,-3168.7297 14065.6389,-2599.121 14063.3526,-2465.4389"/>
<polygon fill="#000000" stroke="#000000" points="14066.8472,-2465.1393 14063.1378,-2455.215 14059.8487,-2465.2864 14066.8472,-2465.1393"/>
</g>
<!-- block_122 -->
<g id="node123" class="node">
<title>block_122</title>
<ellipse fill="none" stroke="#000000" cx="14541.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="14541.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 264&#45;266</text>
</g>
<!-- section_85&#45;&gt;block_122 -->
<g id="edge122" class="edge">
<title>section_85&#45;&gt;block_122</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12900.7725,-3908.6369C12887.1185,-3836.7634 12847.6529,-3569.1451 12988.5,-3447.0055 13084.9992,-3363.3234 14032.4036,-3483.5969 14137.5,-3411.0055 14477.036,-3176.4835 14531.863,-2599.8058 14540.1174,-2465.3506"/>
<polygon fill="#000000" stroke="#000000" points="14543.6282,-2465.2615 14540.7084,-2455.077 14536.6398,-2464.8594 14543.6282,-2465.2615"/>
</g>
<!-- block_123 -->
<g id="node124" class="node">
<title>block_123</title>
<ellipse fill="none" stroke="#000000" cx="14970.5" cy="-2437.0039" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="14970.5" y="-2432.8039" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 267&#45;272</text>
</g>
<!-- section_85&#45;&gt;block_123 -->
<g id="edge123" class="edge">
<title>section_85&#45;&gt;block_123</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12900.7401,-3908.5994C12886.9629,-3836.5831 12847.0918,-3568.495 12988.5,-3447.0055 13057.1195,-3388.0516 14542.9844,-3463.7279 14616.5,-3411.0055 14946.0712,-3174.6502 14969.716,-2599.3677 14970.6614,-2465.2721"/>
<polygon fill="#000000" stroke="#000000" points="14974.162,-2465.0372 14970.6936,-2455.0262 14967.1621,-2465.0151 14974.162,-2465.0372"/>
</g>
<!-- leaf_135 -->
<g id="node136" class="node">
<title>leaf_135</title>
<polygon fill="none" stroke="#c0c0c0" points="15623,-2698.2047 15054,-2698.2047 15054,-2175.8031 15623,-2175.8031 15623,-2698.2047"/>
<text text-anchor="middle" x="15338.5" y="-2682.9043" font-family="Inconsolata" font-size="14.00" fill="#000000">*** Other fields</text>
<text text-anchor="middle" x="15338.5" y="-2651.5042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The way the Grammar class will work: each =V&quot;patt&quot;= can have a metatable.</text>
<text text-anchor="middle" x="15338.5" y="-2636.1042" font-family="Inconsolata" font-size="14.00" fill="#000000">These are passed in as the second parameter during construction, with the key</text>
<text text-anchor="middle" x="15338.5" y="-2620.7042" font-family="Inconsolata" font-size="14.00" fill="#000000">the same name as the rule. </text>
<text text-anchor="middle" x="15338.5" y="-2589.3041" font-family="Inconsolata" font-size="14.00" fill="#000000">If a pattern doesn&#39;t have a metatable, it&#39;s given a Node class and consists of</text>
<text text-anchor="middle" x="15338.5" y="-2573.9041" font-family="Inconsolata" font-size="14.00" fill="#000000">only the above fields, plus an array representing any subrules. </text>
<text text-anchor="middle" x="15338.5" y="-2542.5041" font-family="Inconsolata" font-size="14.00" fill="#000000">If it does, the metatable will have a =__call= method, which expects two</text>
<text text-anchor="middle" x="15338.5" y="-2527.104" font-family="Inconsolata" font-size="14.00" fill="#000000">parameters, itself, and the node, which will include the span. </text>
<text text-anchor="middle" x="15338.5" y="-2495.704" font-family="Inconsolata" font-size="14.00" fill="#000000">This will require reattunement of basically every class in the =/grym= folder,</text>
<text text-anchor="middle" x="15338.5" y="-2480.304" font-family="Inconsolata" font-size="14.00" fill="#000000">but let&#39;s build the Prose parse first. &#160;I do want the whole shebang in a single</text>
<text text-anchor="middle" x="15338.5" y="-2464.9039" font-family="Inconsolata" font-size="14.00" fill="#000000">grammar eventually.</text>
<text text-anchor="middle" x="15338.5" y="-2433.5039" font-family="Inconsolata" font-size="14.00" fill="#000000">The intention is to allow multiple grammars to coexist peacefully. Currently</text>
<text text-anchor="middle" x="15338.5" y="-2418.1039" font-family="Inconsolata" font-size="14.00" fill="#000000">the parser is handrolled and we have special case values for everything.</text>
<text text-anchor="middle" x="15338.5" y="-2402.7039" font-family="Inconsolata" font-size="14.00" fill="#000000">The idea is to stabilize this, so that multi&#45;pass parsing works but in a</text>
<text text-anchor="middle" x="15338.5" y="-2387.3038" font-family="Inconsolata" font-size="14.00" fill="#000000">standard way where the Node constructor is a consistent interface. </text>
<text text-anchor="middle" x="15338.5" y="-2355.9038" font-family="Inconsolata" font-size="14.00" fill="#000000">In the meantime we have things like</text>
<text text-anchor="middle" x="15338.5" y="-2324.5038" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; lines : &#160;If this exists, there&#39;s a collection of lines which need to be</text>
<text text-anchor="middle" x="15338.5" y="-2309.1037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;joined with =\n= to reconstruct the actual span.</text>
<text text-anchor="middle" x="15338.5" y="-2277.7037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;We want to do this the other way, and use the span itself for the</text>
<text text-anchor="middle" x="15338.5" y="-2262.3037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;inner parse. </text>
<text text-anchor="middle" x="15338.5" y="-2230.9036" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="15338.5" y="-2215.5036" font-family="Inconsolata" font-size="14.00" fill="#000000">return N</text>
<text text-anchor="middle" x="15338.5" y="-2200.1036" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_85&#45;&gt;leaf_135 -->
<g id="edge135" class="edge">
<title>section_85&#45;&gt;leaf_135</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12900.724,-3908.5806C12886.8853,-3836.4926 12846.8122,-3568.1688 12988.5,-3447.0055 13075.3652,-3372.7233 14954.3762,-3479.9972 15045.5,-3411.0055 15259.4777,-3248.9984 15322.6538,-2936.0321 15338.668,-2708.4661"/>
<polygon fill="#000000" stroke="#000000" points="15342.1676,-2708.588 15339.3512,-2698.3744 15335.1836,-2708.115 15342.1676,-2708.588"/>
</g>
<!-- leaf_98 -->
<g id="node99" class="node">
<title>leaf_98</title>
<polygon fill="none" stroke="#c0c0c0" points="7308,-1163.5029 6795,-1163.5029 6795,-1078.3008 7308,-1078.3008 7308,-1163.5029"/>
<text text-anchor="middle" x="7051.5" y="-1132.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;There are invariant fields a Node is also expected to have, they are:</text>
<text text-anchor="middle" x="7051.5" y="-1117.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="7051.5" y="-1101.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;Index into =str= which begins the span.</text>
<text text-anchor="middle" x="7051.5" y="-1086.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Index into =str= which ends the span.</text>
</g>
<!-- block_92&#45;&gt;leaf_98 -->
<g id="edge98" class="edge">
<title>block_92&#45;&gt;leaf_98</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8554.182,-2418.9241C8565.0648,-2297.3573 8620.6841,-1599.7671 8477.5,-1463.0023 8430.8356,-1418.4301 7374.7708,-1454.7289 7316.5,-1427.0023 7202.8285,-1372.9148 7118.5086,-1244.6978 7078.1041,-1172.5395"/>
<polygon fill="#000000" stroke="#000000" points="7081.0629,-1170.6574 7073.1619,-1163.5987 7074.9366,-1174.0439 7081.0629,-1170.6574"/>
</g>
<!-- leaf_99 -->
<g id="node100" class="node">
<title>leaf_99</title>
<polygon fill="none" stroke="#c0c0c0" points="7811,-1140.2024 7326,-1140.2024 7326,-1101.6013 7811,-1101.6013 7811,-1140.2024"/>
<text text-anchor="middle" x="7568.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">In principle, we want the Node to be localized. We could include a </text>
<text text-anchor="middle" x="7568.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">reference to the whole =str= and derive substrings lazily.</text>
</g>
<!-- block_93&#45;&gt;leaf_99 -->
<g id="edge99" class="edge">
<title>block_93&#45;&gt;leaf_99</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8703.1803,-2418.948C8714.0547,-2297.5385 8769.6706,-1600.7981 8627.5,-1463.0023 8563.0492,-1400.5347 7900.7937,-1467.115 7820.5,-1427.0023 7697.2077,-1365.4087 7612.6234,-1212.9185 7581.6174,-1149.3922"/>
<polygon fill="#000000" stroke="#000000" points="7584.7525,-1147.8353 7577.2679,-1140.3365 7578.4425,-1150.866 7584.7525,-1147.8353"/>
</g>
<!-- leaf_100 -->
<g id="node101" class="node">
<title>leaf_100</title>
<polygon fill="none" stroke="#c0c0c0" points="8349.5,-1148.1023 7829.5,-1148.1023 7829.5,-1093.7014 8349.5,-1093.7014 8349.5,-1148.1023"/>
<text text-anchor="middle" x="8089.5" y="-1132.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">If we included the full span as a substring on each Node, we&#39;d end up</text>
<text text-anchor="middle" x="8089.5" y="-1117.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">with a lot of spans, and wouldn&#39;t use most of them. Even slicing a piece</text>
<text text-anchor="middle" x="8089.5" y="-1102.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">out is costly if we&#39;re not going to use it. </text>
</g>
<!-- block_94&#45;&gt;leaf_100 -->
<g id="edge100" class="edge">
<title>block_94&#45;&gt;leaf_100</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8852.1266,-2418.6238C8862.5049,-2296.5555 8914.7117,-1603.5102 8775.5,-1463.0023 8710.0365,-1396.9293 8441.5114,-1468.9574 8358.5,-1427.0023 8237.2883,-1365.7403 8146.6001,-1224.2283 8108.8179,-1157.2723"/>
<polygon fill="#000000" stroke="#000000" points="8111.7639,-1155.3686 8103.8401,-1148.3354 8105.6485,-1158.7748 8111.7639,-1155.3686"/>
</g>
<!-- leaf_101 -->
<g id="node102" class="node">
<title>leaf_101</title>
<polygon fill="none" stroke="#c0c0c0" points="8881,-1155.5031 8368,-1155.5031 8368,-1086.3006 8881,-1086.3006 8881,-1155.5031"/>
<text text-anchor="middle" x="8624.5" y="-1140.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">So our constructor for a Node class takes (Constructor, node, str) as </text>
<text text-anchor="middle" x="8624.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">the standard interface. &#160;If a module needs a non&#45;standard constructor,</text>
<text text-anchor="middle" x="8624.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">as our Section and Block modules currently take an array of lines, that</text>
<text text-anchor="middle" x="8624.5" y="-1094.3018" font-family="Inconsolata" font-size="14.00" fill="#000000">will need to be provided as the second return from the module. </text>
</g>
<!-- block_95&#45;&gt;leaf_101 -->
<g id="edge101" class="edge">
<title>block_95&#45;&gt;leaf_101</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9002.5607,-2418.8942C9018.7582,-2317.918 9087.7851,-1816.2843 8925.5,-1463.0023 8916.0547,-1442.4406 8904.9151,-1443.5666 8889.5,-1427.0023 8804.2595,-1335.4069 8709.4338,-1223.1918 8659.5668,-1163.319"/>
<polygon fill="#000000" stroke="#000000" points="8662.2129,-1161.027 8653.1268,-1155.5777 8656.8315,-1165.5037 8662.2129,-1161.027"/>
</g>
<!-- leaf_102 -->
<g id="node103" class="node">
<title>leaf_102</title>
<polygon fill="none" stroke="#c0c0c0" points="9398,-1148.2023 8899,-1148.2023 8899,-1093.6014 9398,-1093.6014 9398,-1148.2023"/>
<text text-anchor="middle" x="9148.5" y="-1133.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">This will allow for the kind of multi&#45;pass recursive&#45;descent that I&#39;m</text>
<text text-anchor="middle" x="9148.5" y="-1117.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">aiming for. </text>
</g>
<!-- block_96&#45;&gt;leaf_102 -->
<g id="edge102" class="edge">
<title>block_96&#45;&gt;leaf_102</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9148.5,-2418.8999C9148.5,-2278.005 9148.5,-1357.0874 9148.5,-1158.5731"/>
<polygon fill="#000000" stroke="#000000" points="9152.0001,-1158.3588 9148.5,-1148.3588 9145.0001,-1158.3589 9152.0001,-1158.3588"/>
</g>
<!-- header_103 -->
<g id="node104" class="node">
<title>header_103</title>
<ellipse fill="none" stroke="#000000" cx="9524.5" cy="-1120.9018" rx="108.8185" ry="18"/>
<text text-anchor="middle" x="9524.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">4 : line tracking (optional)</text>
</g>
<!-- section_97&#45;&gt;header_103 -->
<g id="edge103" class="edge">
<title>section_97&#45;&gt;header_103</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9787.8272,-2418.8999C9758.7634,-2275.6378 9566.093,-1325.9229 9530.2381,-1149.1864"/>
<polygon fill="#000000" stroke="#000000" points="9533.6582,-1148.4407 9528.2398,-1139.3362 9526.798,-1149.8325 9533.6582,-1148.4407"/>
</g>
<!-- block_104 -->
<g id="node105" class="node">
<title>block_104</title>
<ellipse fill="none" stroke="#000000" cx="9717.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9717.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 225&#45;228</text>
</g>
<!-- section_97&#45;&gt;block_104 -->
<g id="edge104" class="edge">
<title>section_97&#45;&gt;block_104</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9790.4821,-2418.8999C9782.4309,-2275.7092 9729.0808,-1326.8691 9719.1052,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="9722.5925,-1149.1239 9718.5365,-1139.3362 9715.6035,-1149.517 9722.5925,-1149.1239"/>
</g>
<!-- block_105 -->
<g id="node106" class="node">
<title>block_105</title>
<ellipse fill="none" stroke="#000000" cx="9866.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="9866.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 229&#45;231</text>
</g>
<!-- section_97&#45;&gt;block_105 -->
<g id="edge105" class="edge">
<title>section_97&#45;&gt;block_105</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9792.5317,-2418.8999C9800.6916,-2275.7092 9854.7627,-1326.8691 9864.8731,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="9868.3748,-1149.5192 9865.4495,-1139.3362 9861.3861,-1149.1208 9868.3748,-1149.5192"/>
</g>
<!-- block_106 -->
<g id="node107" class="node">
<title>block_106</title>
<ellipse fill="none" stroke="#000000" cx="10015.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="10015.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 232&#45;234</text>
</g>
<!-- section_97&#45;&gt;block_106 -->
<g id="edge106" class="edge">
<title>section_97&#45;&gt;block_106</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9787.3161,-2419.017C9764.325,-2315.5874 9661.9808,-1789.7999 9875.5,-1463.0023 9893.776,-1435.0304 9921.1639,-1453.5144 9941.5,-1427.0023 10006.6786,-1342.0293 10015.4382,-1207.8854 10015.9575,-1149.5625"/>
<polygon fill="#000000" stroke="#000000" points="10019.4578,-1149.2678 10015.9682,-1139.2642 10012.4578,-1149.2605 10019.4578,-1149.2678"/>
</g>
<!-- block_107 -->
<g id="node108" class="node">
<title>block_107</title>
<ellipse fill="none" stroke="#000000" cx="10164.5" cy="-1120.9018" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="10164.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 235&#45;237</text>
</g>
<!-- section_97&#45;&gt;block_107 -->
<g id="edge107" class="edge">
<title>section_97&#45;&gt;block_107</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9786.0372,-2418.8452C9754.8487,-2311.1091 9609.8457,-1750.7702 9875.5,-1463.0023 9941.2187,-1391.8131 10019.5932,-1493.0257 10090.5,-1427.0023 10169.957,-1353.0176 10170.6714,-1209.6315 10166.994,-1149.0287"/>
<polygon fill="#000000" stroke="#000000" points="10170.4849,-1148.7743 10166.3002,-1139.0409 10163.5017,-1149.2594 10170.4849,-1148.7743"/>
</g>
<!-- leaf_112 -->
<g id="node113" class="node">
<title>leaf_112</title>
<polygon fill="none" stroke="#c0c0c0" points="10803,-1234.6022 10248,-1234.6022 10248,-1007.2015 10803,-1007.2015 10803,-1234.6022"/>
<text text-anchor="middle" x="10525.5" y="-1219.302" font-family="Inconsolata" font-size="14.00" fill="#000000">**** line tracking (optional)</text>
<text text-anchor="middle" x="10525.5" y="-1187.9019" font-family="Inconsolata" font-size="14.00" fill="#000000">It may be wise to always track lines, in which case we will include:</text>
<text text-anchor="middle" x="10525.5" y="-1156.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_first : &#160;The line at which the match begins</text>
<text text-anchor="middle" x="10525.5" y="-1141.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_last &#160;: &#160;The line at which the match ends</text>
<text text-anchor="middle" x="10525.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">This is, at least, a frequent enough pattern that the metatable should return</text>
<text text-anchor="middle" x="10525.5" y="-1094.3018" font-family="Inconsolata" font-size="14.00" fill="#000000">a negative number if these aren&#39;t assigned. </text>
<text text-anchor="middle" x="10525.5" y="-1062.9018" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; [ ] #todo decide if line tracking is in fact optional</text>
<text text-anchor="middle" x="10525.5" y="-1015.5017" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_97&#45;&gt;leaf_112 -->
<g id="edge112" class="edge">
<title>section_97&#45;&gt;leaf_112</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9785.8651,-2418.933C9753.2992,-2310.5436 9600.0133,-1741.9686 9875.5,-1463.0023 9932.6143,-1405.1666 10166.6281,-1463.012 10239.5,-1427.0023 10323.1454,-1385.669 10394.778,-1308.8946 10445.4327,-1242.5786"/>
<polygon fill="#000000" stroke="#000000" points="10448.2666,-1244.6338 10451.5055,-1234.5462 10442.6828,-1240.4122 10448.2666,-1244.6338"/>
</g>
<!-- leaf_108 -->
<g id="node109" class="node">
<title>leaf_108</title>
<polygon fill="none" stroke="#c0c0c0" points="9489.5,-647.5031 8997.5,-647.5031 8997.5,-607.699 9489.5,-607.699 9489.5,-647.5031"/>
<text text-anchor="middle" x="9243.5" y="-616.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">It may be wise to always track lines, in which case we will include:</text>
</g>
<!-- block_104&#45;&gt;leaf_108 -->
<g id="edge108" class="edge">
<title>block_104&#45;&gt;leaf_108</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9718.9568,-1102.6921C9722.0979,-1050.0467 9723.5557,-896.2385 9642.5,-814.8013 9595.962,-768.0443 9559.5136,-803.8881 9498.5,-778.8013 9415.3731,-744.6222 9326.9971,-686.7156 9279.2149,-653.3576"/>
<polygon fill="#000000" stroke="#000000" points="9280.9697,-650.3129 9270.7757,-647.4259 9276.9443,-656.0398 9280.9697,-650.3129"/>
</g>
<!-- leaf_109 -->
<g id="node110" class="node">
<title>leaf_109</title>
<polygon fill="none" stroke="#c0c0c0" points="9887.5,-646.9016 9507.5,-646.9016 9507.5,-608.3005 9887.5,-608.3005 9887.5,-646.9016"/>
<text text-anchor="middle" x="9697.5" y="-631.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_first : &#160;The line at which the match begins</text>
<text text-anchor="middle" x="9697.5" y="-616.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; line_last &#160;: &#160;The line at which the match ends</text>
</g>
<!-- block_105&#45;&gt;leaf_109 -->
<g id="edge109" class="edge">
<title>block_105&#45;&gt;leaf_109</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9863.6525,-1102.875C9855.7603,-1054.9339 9831.5743,-920.7244 9792.5,-814.8013 9770.8475,-756.1053 9735.5178,-691.9546 9714.5891,-656.0562"/>
<polygon fill="#000000" stroke="#000000" points="9717.4287,-653.9802 9709.3434,-647.1333 9711.3942,-657.5278 9717.4287,-653.9802"/>
</g>
<!-- leaf_110 -->
<g id="node111" class="node">
<title>leaf_110</title>
<polygon fill="none" stroke="#c0c0c0" points="10461,-646.9016 9906,-646.9016 9906,-608.3005 10461,-608.3005 10461,-646.9016"/>
<text text-anchor="middle" x="10183.5" y="-631.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">This is, at least, a frequent enough pattern that the metatable should return</text>
<text text-anchor="middle" x="10183.5" y="-616.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">a negative number if these aren&#39;t assigned. </text>
</g>
<!-- block_106&#45;&gt;leaf_110 -->
<g id="edge110" class="edge">
<title>block_106&#45;&gt;leaf_110</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10018.3728,-1102.8843C10026.327,-1054.966 10050.6513,-920.8073 10089.5,-814.8013 10110.9813,-756.1855 10145.9198,-692.0075 10166.6093,-656.0823"/>
<polygon fill="#000000" stroke="#000000" points="10169.7999,-657.5577 10171.7947,-647.1523 10163.7464,-654.0426 10169.7999,-657.5577"/>
</g>
<!-- leaf_111 -->
<g id="node112" class="node">
<title>leaf_111</title>
<polygon fill="none" stroke="#c0c0c0" points="10880,-647.5031 10479,-647.5031 10479,-607.699 10880,-607.699 10880,-647.5031"/>
<text text-anchor="middle" x="10679.5" y="-632.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; [ ] #todo decide if line tracking is in fact optional</text>
</g>
<!-- block_107&#45;&gt;leaf_111 -->
<g id="edge111" class="edge">
<title>block_107&#45;&gt;leaf_111</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M10162.6579,-1102.7175C10158.3697,-1049.4709 10153.8304,-892.751 10238.5,-814.8013 10314.9435,-744.4249 10373.3693,-818.239 10469.5,-778.8013 10542.2564,-748.9529 10613.7012,-689.2289 10651.6101,-654.4422"/>
<polygon fill="#000000" stroke="#000000" points="10654.2303,-656.7855 10659.1789,-647.4173 10649.4683,-651.6548 10654.2303,-656.7855"/>
</g>
<!-- leaf_124 -->
<g id="node125" class="node">
<title>leaf_124</title>
<polygon fill="none" stroke="#c0c0c0" points="11376,-1156.1022 10821,-1156.1022 10821,-1085.7014 11376,-1085.7014 11376,-1156.1022"/>
<text text-anchor="middle" x="11098.5" y="-1124.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The way the Grammar class will work: each =V&quot;patt&quot;= can have a metatable.</text>
<text text-anchor="middle" x="11098.5" y="-1109.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">These are passed in as the second parameter during construction, with the key</text>
<text text-anchor="middle" x="11098.5" y="-1094.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">the same name as the rule. </text>
</g>
<!-- block_115&#45;&gt;leaf_124 -->
<g id="edge124" class="edge">
<title>block_115&#45;&gt;leaf_124</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12459.1939,-2418.9339C12470.1577,-2297.4318 12526.2565,-1600.191 12383.5,-1463.0023 12303.494,-1386.1168 11486.5062,-1472.9382 11385.5,-1427.0023 11262.2898,-1370.9685 11166.7451,-1235.0261 11123.6113,-1164.6867"/>
<polygon fill="#000000" stroke="#000000" points="11126.5427,-1162.7707 11118.3663,-1156.0329 11120.5564,-1166.3989 11126.5427,-1162.7707"/>
</g>
<!-- leaf_125 -->
<g id="node126" class="node">
<title>leaf_125</title>
<polygon fill="none" stroke="#c0c0c0" points="11956.5,-1140.2024 11394.5,-1140.2024 11394.5,-1101.6013 11956.5,-1101.6013 11956.5,-1140.2024"/>
<text text-anchor="middle" x="11675.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">If a pattern doesn&#39;t have a metatable, it&#39;s given a Node class and consists of</text>
<text text-anchor="middle" x="11675.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">only the above fields, plus an array representing any subrules. </text>
</g>
<!-- block_116&#45;&gt;leaf_125 -->
<g id="edge125" class="edge">
<title>block_116&#45;&gt;leaf_125</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12608.1501,-2418.9789C12618.8256,-2297.7727 12673.3672,-1602.1303 12532.5,-1463.0023 12487.5862,-1418.643 12022.6704,-1453.7708 11965.5,-1427.0023 11832.4855,-1364.7219 11729.8399,-1212.0495 11691.6619,-1148.9233"/>
<polygon fill="#000000" stroke="#000000" points="11694.633,-1147.072 11686.5009,-1140.2808 11688.623,-1150.6609 11694.633,-1147.072"/>
</g>
<!-- leaf_126 -->
<g id="node127" class="node">
<title>leaf_126</title>
<polygon fill="none" stroke="#c0c0c0" points="12494.5,-1140.2024 11974.5,-1140.2024 11974.5,-1101.6013 12494.5,-1101.6013 12494.5,-1140.2024"/>
<text text-anchor="middle" x="12234.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">If it does, the metatable will have a =__call= method, which expects two</text>
<text text-anchor="middle" x="12234.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">parameters, itself, and the node, which will include the span. </text>
</g>
<!-- block_117&#45;&gt;leaf_126 -->
<g id="edge126" class="edge">
<title>block_117&#45;&gt;leaf_126</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12756.9528,-2418.8067C12766.204,-2297.9278 12812.4368,-1611.2312 12681.5,-1463.0023 12628.065,-1402.5105 12573.3554,-1467.4349 12503.5,-1427.0023 12381.7776,-1356.549 12286.8885,-1210.9314 12250.5591,-1149.3708"/>
<polygon fill="#000000" stroke="#000000" points="12253.492,-1147.4522 12245.4315,-1140.5762 12247.4448,-1150.978 12253.492,-1147.4522"/>
</g>
<!-- leaf_127 -->
<g id="node128" class="node">
<title>leaf_127</title>
<polygon fill="none" stroke="#c0c0c0" points="13082,-1148.1023 12513,-1148.1023 12513,-1093.7014 13082,-1093.7014 13082,-1148.1023"/>
<text text-anchor="middle" x="12797.5" y="-1132.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">This will require reattunement of basically every class in the =/grym= folder,</text>
<text text-anchor="middle" x="12797.5" y="-1117.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">but let&#39;s build the Prose parse first. &#160;I do want the whole shebang in a single</text>
<text text-anchor="middle" x="12797.5" y="-1102.0018" font-family="Inconsolata" font-size="14.00" fill="#000000">grammar eventually.</text>
</g>
<!-- block_118&#45;&gt;leaf_127 -->
<g id="edge127" class="edge">
<title>block_118&#45;&gt;leaf_127</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M12903.2519,-2418.7452C12896.5343,-2320.8952 12863.7467,-1848.6493 12830.5,-1463.0023 12820.9559,-1352.2951 12807.8345,-1221.6225 12801.391,-1158.6162"/>
<polygon fill="#000000" stroke="#000000" points="12804.843,-1157.9686 12800.3417,-1148.3775 12797.8795,-1158.6823 12804.843,-1157.9686"/>
</g>
<!-- leaf_128 -->
<g id="node129" class="node">
<title>leaf_128</title>
<polygon fill="none" stroke="#c0c0c0" points="13648.5,-1155.5031 13100.5,-1155.5031 13100.5,-1086.3006 13648.5,-1086.3006 13648.5,-1155.5031"/>
<text text-anchor="middle" x="13374.5" y="-1140.5019" font-family="Inconsolata" font-size="14.00" fill="#000000">The intention is to allow multiple grammars to coexist peacefully. Currently</text>
<text text-anchor="middle" x="13374.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">the parser is handrolled and we have special case values for everything.</text>
<text text-anchor="middle" x="13374.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000">The idea is to stabilize this, so that multi&#45;pass parsing works but in a</text>
<text text-anchor="middle" x="13374.5" y="-1094.3018" font-family="Inconsolata" font-size="14.00" fill="#000000">standard way where the Node constructor is a consistent interface. </text>
</g>
<!-- block_119&#45;&gt;leaf_128 -->
<g id="edge128" class="edge">
<title>block_119&#45;&gt;leaf_128</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13268.9719,-2418.8999C13280.2957,-2279.6165 13353.5935,-1378.0516 13370.8606,-1165.666"/>
<polygon fill="#000000" stroke="#000000" points="13374.3647,-1165.7566 13371.6867,-1155.5058 13367.3878,-1165.1893 13374.3647,-1165.7566"/>
</g>
<!-- leaf_129 -->
<g id="node130" class="node">
<title>leaf_129</title>
<polygon fill="none" stroke="#c0c0c0" points="13928,-1138.9018 13667,-1138.9018 13667,-1102.9018 13928,-1102.9018 13928,-1138.9018"/>
<text text-anchor="middle" x="13797.5" y="-1117.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">In the meantime we have things like</text>
</g>
<!-- block_120&#45;&gt;leaf_129 -->
<g id="edge129" class="edge">
<title>block_120&#45;&gt;leaf_129</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M13662.3845,-2418.8999C13677.29,-2275.7092 13776.0598,-1326.8691 13794.5282,-1149.4511"/>
<polygon fill="#000000" stroke="#000000" points="13798.0268,-1149.6449 13795.5811,-1139.3362 13791.0644,-1148.9201 13798.0268,-1149.6449"/>
</g>
<!-- leaf_130 -->
<g id="node131" class="node">
<title>leaf_130</title>
<polygon fill="none" stroke="#c0c0c0" points="14473,-1140.2024 13946,-1140.2024 13946,-1101.6013 14473,-1101.6013 14473,-1140.2024"/>
<text text-anchor="middle" x="14209.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; lines : &#160;If this exists, there&#39;s a collection of lines which need to be</text>
<text text-anchor="middle" x="14209.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;joined with =\n= to reconstruct the actual span.</text>
</g>
<!-- block_121&#45;&gt;leaf_130 -->
<g id="edge130" class="edge">
<title>block_121&#45;&gt;leaf_130</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14064.5221,-2418.8999C14080.4897,-2275.9404 14186.1528,-1329.9308 14206.2146,-1150.3165"/>
<polygon fill="#000000" stroke="#000000" points="14209.7037,-1150.6084 14207.3354,-1140.2816 14202.7469,-1149.8313 14209.7037,-1150.6084"/>
</g>
<!-- leaf_131 -->
<g id="node132" class="node">
<title>leaf_131</title>
<polygon fill="none" stroke="#c0c0c0" points="15039.5,-1140.2024 14491.5,-1140.2024 14491.5,-1101.6013 15039.5,-1101.6013 15039.5,-1140.2024"/>
<text text-anchor="middle" x="14765.5" y="-1125.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;We want to do this the other way, and use the span itself for the</text>
<text text-anchor="middle" x="14765.5" y="-1109.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;inner parse. </text>
</g>
<!-- block_122&#45;&gt;leaf_131 -->
<g id="edge131" class="edge">
<title>block_122&#45;&gt;leaf_131</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14544.5813,-2418.8999C14568.9129,-2275.9404 14729.9234,-1329.9308 14760.4936,-1150.3165"/>
<polygon fill="#000000" stroke="#000000" points="14763.974,-1150.7271 14762.2016,-1140.2816 14757.0732,-1149.5526 14763.974,-1150.7271"/>
</g>
<!-- codeblock_132 -->
<g id="node133" class="node">
<title>codeblock_132</title>
<ellipse fill="none" stroke="#000000" cx="15144.5" cy="-1120.9018" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="15144.5" y="-1116.7018" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 267&#45;269</text>
</g>
<!-- block_123&#45;&gt;codeblock_132 -->
<g id="edge132" class="edge">
<title>block_123&#45;&gt;codeblock_132</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14970.4752,-2418.8979C14970.631,-2320.8908 14975.0842,-1844.2355 15044.5,-1463.0023 15066.2501,-1343.5504 15113.4073,-1206.2325 15134.2455,-1148.6133"/>
<polygon fill="#000000" stroke="#000000" points="15137.5703,-1149.7118 15137.7032,-1139.1177 15130.9928,-1147.3166 15137.5703,-1149.7118"/>
</g>
<!-- leaf_134 -->
<g id="node135" class="node">
<title>leaf_134</title>
<polygon fill="none" stroke="#c0c0c0" points="15303.5,-1140.9018 15249.5,-1140.9018 15249.5,-1100.9018 15303.5,-1100.9018 15303.5,-1140.9018"/>
</g>
<!-- block_123&#45;&gt;leaf_134 -->
<g id="edge134" class="edge">
<title>block_123&#45;&gt;leaf_134</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M14964.8804,-2418.938C14932.7568,-2311.7366 14782.8177,-1753.9514 15044.5,-1463.0023 15103.7276,-1397.1507 15179.9272,-1491.6188 15240.5,-1427.0023 15312.134,-1350.5863 15295.2681,-1212.0636 15283.3607,-1151.0905"/>
<polygon fill="#000000" stroke="#000000" points="15286.7247,-1150.0713 15281.2897,-1140.9767 15279.8669,-1151.4756 15286.7247,-1150.0713"/>
</g>
<!-- leaf_133 -->
<g id="node134" class="node">
<title>leaf_133</title>
<polygon fill="none" stroke="#c0c0c0" points="15180.5,-645.6011 15108.5,-645.6011 15108.5,-609.6011 15180.5,-609.6011 15180.5,-645.6011"/>
<text text-anchor="middle" x="15144.5" y="-624.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">return N</text>
</g>
<!-- codeblock_132&#45;&gt;leaf_133 -->
<g id="edge133" class="edge">
<title>codeblock_132&#45;&gt;leaf_133</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M15144.5,-1102.76C15144.5,-1028.3462 15144.5,-746.1828 15144.5,-655.7039"/>
<polygon fill="#000000" stroke="#000000" points="15148.0001,-655.6469 15144.5,-645.6469 15141.0001,-655.647 15148.0001,-655.6469"/>
</g>
</g>
</svg>