<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="8412pt" height="1139pt"
 viewBox="0.00 0.00 8412.00 1139.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1135.0011)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1135.0011 8408,-1135.0011 8408,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="470" cy="-1113.0011" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="470" y="-1108.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 182</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="470" cy="-1041.0011" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="470" y="-1036.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;15</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M470,-1094.8325C470,-1087.132 470,-1077.9754 470,-1069.4177"/>
<polygon fill="#000000" stroke="#000000" points="473.5001,-1069.4143 470,-1059.4144 466.5001,-1069.4144 473.5001,-1069.4143"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="268" cy="-969.0011" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="268" y="-964.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M431.0524,-1027.1188C400.0334,-1016.0625 356.2653,-1000.462 321.8845,-988.2075"/>
<polygon fill="#000000" stroke="#000000" points="323.0494,-984.907 312.4547,-984.8463 320.6991,-991.5007 323.0494,-984.907"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="409" cy="-969.0011" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="409" y="-964.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M454.9213,-1023.2033C447.3139,-1014.224 437.9694,-1003.1945 429.7003,-993.4342"/>
<polygon fill="#000000" stroke="#000000" points="432.2035,-990.9743 423.0688,-985.6069 426.8626,-995.4993 432.2035,-990.9743"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="532" cy="-969.0011" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="532" y="-964.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;13</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M485.3258,-1023.2033C492.7779,-1014.5494 501.8698,-1003.9911 510.0427,-994.4999"/>
<polygon fill="#000000" stroke="#000000" points="512.7625,-996.7052 516.6356,-986.8436 507.4581,-992.1375 512.7625,-996.7052"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="864" cy="-969.0011" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="864" y="-964.8011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;82</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M521.9138,-1031.5143C593.2074,-1018.486 721.3883,-995.0621 798.9826,-980.8824"/>
<polygon fill="#000000" stroke="#000000" points="799.9106,-984.2709 809.1185,-979.0302 798.6522,-977.3849 799.9106,-984.2709"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="401,-869.101 347,-869.101 347,-829.101 401,-829.101 401,-869.101"/>
</g>
<!-- prose_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>prose_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M403.7601,-951.0508C398.2036,-932.0158 389.3332,-901.6281 382.7202,-878.9739"/>
<polygon fill="#000000" stroke="#000000" points="386.0227,-877.7966 379.8607,-869.178 379.3031,-879.7582 386.0227,-877.7966"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="645,-914.9014 419,-914.9014 419,-783.3006 645,-783.3006 645,-914.9014"/>
<text text-anchor="middle" x="532" y="-899.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;node/elpeg&quot;</text>
<text text-anchor="middle" x="532" y="-868.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="532" y="-853.001" font-family="Inconsolata" font-size="14.00" fill="#000000">local setfenv </text>
<text text-anchor="middle" x="532" y="-837.601" font-family="Inconsolata" font-size="14.00" fill="#000000">if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="532" y="-822.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setfenv = setfenv</text>
<text text-anchor="middle" x="532" y="-806.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( setfenv )</text>
<text text-anchor="middle" x="532" y="-791.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>codeblock_4&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M532,-950.7908C532,-943.4976 532,-934.5682 532,-925.059"/>
<polygon fill="#000000" stroke="#000000" points="535.5001,-924.9838 532,-914.9838 528.5001,-924.9838 535.5001,-924.9838"/>
</g>
<!-- header_8 -->
<g id="node9" class="node">
<title>header_8</title>
<ellipse fill="none" stroke="#000000" cx="709" cy="-849.101" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="709" y="-844.901" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : define</text>
</g>
<!-- section_5&#45;&gt;header_8 -->
<g id="edge8" class="edge">
<title>section_5&#45;&gt;header_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M828.6132,-953.637C808.8039,-944.1038 784.2884,-930.6913 765,-915.0011 750.7642,-903.4209 737.3565,-887.8762 727.2314,-874.7925"/>
<polygon fill="#000000" stroke="#000000" points="729.8868,-872.5004 721.076,-866.6165 724.2944,-876.7106 729.8868,-872.5004"/>
</g>
<!-- prose_9 -->
<g id="node10" class="node">
<title>prose_9</title>
<ellipse fill="none" stroke="#000000" cx="806" cy="-849.101" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="806" y="-844.901" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;prose_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M855.3168,-951.0508C845.6941,-931.1584 830.0738,-898.8674 818.9933,-875.9614"/>
<polygon fill="#000000" stroke="#000000" points="822.0586,-874.2605 814.5532,-866.7826 815.7572,-877.3088 822.0586,-874.2605"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="922" cy="-849.101" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="922" y="-844.901" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 22&#45;33</text>
</g>
<!-- section_5&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M872.6832,-951.0508C882.2506,-931.2727 897.7468,-899.2382 908.8152,-876.3572"/>
<polygon fill="#000000" stroke="#000000" points="912.0535,-877.7002 913.2575,-867.174 905.752,-874.6519 912.0535,-877.7002"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="1999" cy="-849.101" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1999" y="-844.901" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 34&#45;82</text>
</g>
<!-- section_5&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.425,-962.5122C1119.565,-942.0035 1719.3575,-878.6421 1927.2079,-856.685"/>
<polygon fill="#000000" stroke="#000000" points="1927.8187,-860.1401 1937.3957,-855.6088 1927.0833,-853.1788 1927.8187,-860.1401"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="6057" cy="-849.101" rx="70.655" ry="18"/>
<text text-anchor="middle" x="6057" y="-844.901" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 83&#45;182</text>
</g>
<!-- section_5&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M929.6587,-967.4851C1483.3465,-954.7011 5366.932,-865.0338 5976.5584,-850.9583"/>
<polygon fill="#000000" stroke="#000000" points="5976.655,-854.4571 5986.5716,-850.7271 5976.4934,-847.4589 5976.655,-854.4571"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="654,-747.1011 134,-747.1011 134,-660.5006 654,-660.5006 654,-747.1011"/>
<text text-anchor="middle" x="394" y="-700.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is going to be a chopped&#45;and&#45;screwed version of epnf. &#160;Now that I</text>
<text text-anchor="middle" x="394" y="-684.6008" font-family="Inconsolata" font-size="14.00" fill="#000000">actually understand what it does.</text>
</g>
<!-- prose_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M799.3518,-831.4348C792.718,-816.2729 781.0449,-795.0477 764,-783.2009 751.582,-774.5699 700.2338,-761.8764 639.5655,-749.1591"/>
<polygon fill="#000000" stroke="#000000" points="640.2563,-745.7279 629.7532,-747.1184 638.831,-752.5813 640.2563,-745.7279"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="731" cy="-703.8008" rx="58.5359" ry="18"/>
<text text-anchor="middle" x="731" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : problems</text>
</g>
<!-- section_10&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_10&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M903.4265,-831.6559C888.5671,-817.979 866.983,-798.728 847,-783.2009 820.5136,-762.6204 789.0313,-741.2522 765.552,-725.8741"/>
<polygon fill="#000000" stroke="#000000" points="767.2623,-722.8112 756.9723,-720.2877 763.4427,-728.6773 767.2623,-722.8112"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="840" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="840" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_10&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M911.9452,-831.2843C897.6669,-805.9839 871.4178,-759.4717 854.8812,-730.1696"/>
<polygon fill="#000000" stroke="#000000" points="857.8439,-728.298 849.8809,-721.3094 851.7477,-731.7385 857.8439,-728.298"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="922" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="922" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_10&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M922,-830.9924C922,-806.1944 922,-761.4171 922,-732.152"/>
<polygon fill="#000000" stroke="#000000" points="925.5001,-732.1376 922,-722.1376 918.5001,-732.1377 925.5001,-732.1376"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="1004" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1004" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>section_10&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M932.0548,-831.2843C946.3331,-805.9839 972.5822,-759.4717 989.1188,-730.1696"/>
<polygon fill="#000000" stroke="#000000" points="992.2523,-731.7385 994.1191,-721.3094 986.1561,-728.298 992.2523,-731.7385"/>
</g>
<!-- header_21 -->
<g id="node22" class="node">
<title>header_21</title>
<ellipse fill="none" stroke="#000000" cx="1707" cy="-703.8008" rx="77.8797" ry="18"/>
<text text-anchor="middle" x="1707" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : makeAstNode</text>
</g>
<!-- section_11&#45;&gt;header_21 -->
<g id="edge21" class="edge">
<title>section_11&#45;&gt;header_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1967.0353,-833.2297C1926.6986,-813.1975 1855.1936,-777.673 1794,-747.2009 1779.3744,-739.9179 1763.3708,-731.9376 1749.1222,-724.8286"/>
<polygon fill="#000000" stroke="#000000" points="1750.555,-721.6321 1740.0444,-720.2989 1747.4295,-727.8956 1750.555,-721.6321"/>
</g>
<!-- prose_22 -->
<g id="node23" class="node">
<title>prose_22</title>
<ellipse fill="none" stroke="#000000" cx="1835" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1835" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_22 -->
<g id="edge22" class="edge">
<title>section_11&#45;&gt;prose_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1976.5377,-831.8429C1951.3374,-812.1764 1909.5921,-778.6738 1876,-747.2009 1869.3673,-740.9866 1862.468,-733.9375 1856.2629,-727.3545"/>
<polygon fill="#000000" stroke="#000000" points="1858.7256,-724.8631 1849.3552,-719.9189 1853.5972,-729.6274 1858.7256,-724.8631"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="1917" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1917" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_11&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1988.9452,-831.2843C1974.6669,-805.9839 1948.4178,-759.4717 1931.8812,-730.1696"/>
<polygon fill="#000000" stroke="#000000" points="1934.8439,-728.298 1926.8809,-721.3094 1928.7477,-731.7385 1934.8439,-728.298"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="1999" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1999" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_11&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1999,-830.9924C1999,-806.1944 1999,-761.4171 1999,-732.152"/>
<polygon fill="#000000" stroke="#000000" points="2002.5001,-732.1376 1999,-722.1376 1995.5001,-732.1377 2002.5001,-732.1376"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2144" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2144" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_11&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2016.4904,-831.5744C2042.627,-805.3837 2091.9026,-756.006 2120.9491,-726.8994"/>
<polygon fill="#000000" stroke="#000000" points="2123.6342,-729.1637 2128.2205,-719.613 2118.6793,-724.2191 2123.6342,-729.1637"/>
</g>
<!-- prose_26 -->
<g id="node27" class="node">
<title>prose_26</title>
<ellipse fill="none" stroke="#000000" cx="2522" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2522" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_26 -->
<g id="edge26" class="edge">
<title>section_11&#45;&gt;prose_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2045.4128,-836.2066C2147.3226,-807.8939 2389.0677,-740.7322 2483.3771,-714.5311"/>
<polygon fill="#000000" stroke="#000000" points="2484.3869,-717.8832 2493.085,-711.834 2482.5131,-711.1386 2484.3869,-717.8832"/>
</g>
<!-- prose_27 -->
<g id="node28" class="node">
<title>prose_27</title>
<ellipse fill="none" stroke="#000000" cx="2963" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2963" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_27 -->
<g id="edge27" class="edge">
<title>section_11&#45;&gt;prose_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2056.7731,-840.3931C2234.2671,-813.6401 2768.8563,-733.0634 2921.7452,-710.019"/>
<polygon fill="#000000" stroke="#000000" points="2922.3039,-713.4744 2931.6705,-708.523 2921.2605,-706.5526 2922.3039,-713.4744"/>
</g>
<!-- codeblock_28 -->
<g id="node29" class="node">
<title>codeblock_28</title>
<ellipse fill="none" stroke="#000000" cx="3439" cy="-703.8008" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3439" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 58&#45;80</text>
</g>
<!-- section_11&#45;&gt;codeblock_28 -->
<g id="edge28" class="edge">
<title>section_11&#45;&gt;codeblock_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2060.875,-842.8576C2291.0317,-819.6341 3097.7554,-738.2334 3357.6535,-712.0089"/>
<polygon fill="#000000" stroke="#000000" points="3358.1765,-715.474 3367.7745,-710.9877 3357.4737,-708.5094 3358.1765,-715.474"/>
</g>
<!-- header_36 -->
<g id="node37" class="node">
<title>header_36</title>
<ellipse fill="none" stroke="#000000" cx="5385" cy="-703.8008" rx="76.9365" ry="18"/>
<text text-anchor="middle" x="5385" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : define, proper</text>
</g>
<!-- section_12&#45;&gt;header_36 -->
<g id="edge36" class="edge">
<title>section_12&#45;&gt;header_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5989.0759,-843.8324C5878.2308,-833.7975 5652.5975,-807.3331 5471,-747.2009 5454.3026,-741.6719 5436.8097,-733.3608 5421.9931,-725.4867"/>
<polygon fill="#000000" stroke="#000000" points="5423.6008,-722.3769 5413.1445,-720.6692 5420.2537,-728.5249 5423.6008,-722.3769"/>
</g>
<!-- prose_37 -->
<g id="node38" class="node">
<title>prose_37</title>
<ellipse fill="none" stroke="#000000" cx="5512" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5512" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_37 -->
<g id="edge37" class="edge">
<title>section_12&#45;&gt;prose_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5993.394,-841.0031C5875.7324,-825.2467 5629.2263,-788.3788 5554,-747.2009 5545.3544,-742.4684 5537.3952,-735.3598 5530.7839,-728.2582"/>
<polygon fill="#000000" stroke="#000000" points="5533.3785,-725.9081 5524.1704,-720.6677 5528.1007,-730.5065 5533.3785,-725.9081"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="5640" cy="-703.8008" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="5640" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 93&#45;95</text>
</g>
<!-- section_12&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>section_12&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6006.9255,-836.3785C5941.4939,-819.1368 5823.8462,-786.0076 5727,-747.2009 5711.1911,-740.8662 5694.3291,-732.7831 5679.6999,-725.3138"/>
<polygon fill="#000000" stroke="#000000" points="5680.9317,-722.0102 5670.4424,-720.5186 5677.7121,-728.2259 5680.9317,-722.0102"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="5768" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5768" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_12&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6008.314,-835.8245C5956.0074,-820.0854 5871.9261,-790.4213 5809,-747.2009 5801.3851,-741.9706 5794.103,-735.1219 5787.8449,-728.4155"/>
<polygon fill="#000000" stroke="#000000" points="5790.2656,-725.8702 5781.0103,-720.7137 5785.0299,-730.5164 5790.2656,-725.8702"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="5850" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5850" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_12&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6025.6826,-832.828C5991.3158,-814.2898 5935.2829,-782.0247 5892,-747.2009 5884.8365,-741.4374 5877.6527,-734.5302 5871.303,-727.9391"/>
<polygon fill="#000000" stroke="#000000" points="5873.6705,-725.3467 5864.2833,-720.4344 5868.5583,-730.1285 5873.6705,-725.3467"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="5988" cy="-703.8008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5988" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 103&#45;128</text>
</g>
<!-- section_12&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>section_12&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6048.4006,-830.9924C6036.5213,-805.9769 6014.987,-760.63 6001.0993,-731.3854"/>
<polygon fill="#000000" stroke="#000000" points="6004.1591,-729.6694 5996.7078,-722.1376 5997.8359,-732.6722 6004.1591,-729.6694"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="6126" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6126" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_12&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6065.5994,-830.9924C6077.6086,-805.7035 6099.4848,-759.6364 6113.3532,-730.4324"/>
<polygon fill="#000000" stroke="#000000" points="6116.5955,-731.7639 6117.7236,-721.2293 6110.2722,-728.7611 6116.5955,-731.7639"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="6343" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6343" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_12&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6088.6998,-832.9962C6143.2806,-805.2668 6254.4751,-748.7753 6309.9645,-720.5843"/>
<polygon fill="#000000" stroke="#000000" points="6311.6838,-723.6367 6319.0139,-715.9868 6308.5132,-717.3959 6311.6838,-723.6367"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="6670" cy="-703.8008" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6670" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_12&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6108.7357,-836.838C6228.6947,-808.404 6523.7095,-738.4763 6630.5551,-713.1505"/>
<polygon fill="#000000" stroke="#000000" points="6631.3723,-716.5539 6640.2954,-710.8418 6629.7578,-709.7426 6631.3723,-716.5539"/>
</g>
<!-- block_45 -->
<g id="node46" class="node">
<title>block_45</title>
<ellipse fill="none" stroke="#000000" cx="6982" cy="-703.8008" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6982" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 137&#45;137</text>
</g>
<!-- section_12&#45;&gt;block_45 -->
<g id="edge45" class="edge">
<title>section_12&#45;&gt;block_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6117.424,-839.7737C6232.8124,-821.9425 6492.5048,-781.7184 6711,-747.2009 6780.6724,-736.1941 6860.3866,-723.4044 6915.231,-714.5744"/>
<polygon fill="#000000" stroke="#000000" points="6915.858,-718.0186 6925.1742,-712.973 6914.7449,-711.1077 6915.858,-718.0186"/>
</g>
<!-- codeblock_46 -->
<g id="node47" class="node">
<title>codeblock_46</title>
<ellipse fill="none" stroke="#000000" cx="7324" cy="-703.8008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7324" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 138&#45;165</text>
</g>
<!-- section_12&#45;&gt;codeblock_46 -->
<g id="edge46" class="edge">
<title>section_12&#45;&gt;codeblock_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6124.4637,-843.6241C6285.9048,-830.2135 6707.0932,-793.425 7057,-747.2009 7121.6245,-738.6637 7194.6637,-726.6253 7247.994,-717.3923"/>
<polygon fill="#000000" stroke="#000000" points="7248.7994,-720.8049 7258.0522,-715.6438 7247.6004,-713.9083 7248.7994,-720.8049"/>
</g>
<!-- codeblock_47 -->
<g id="node48" class="node">
<title>codeblock_47</title>
<ellipse fill="none" stroke="#000000" cx="7775" cy="-703.8008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7775" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 167&#45;178</text>
</g>
<!-- section_12&#45;&gt;codeblock_47 -->
<g id="edge47" class="edge">
<title>section_12&#45;&gt;codeblock_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6125.8867,-845.1C6326.0274,-833.2282 6924.6741,-795.967 7420,-747.2009 7513.2022,-738.0249 7619.8127,-724.5957 7691.677,-715.1105"/>
<polygon fill="#000000" stroke="#000000" points="7692.5681,-718.5231 7702.0221,-713.7406 7691.6492,-711.5837 7692.5681,-718.5231"/>
</g>
<!-- codeblock_48 -->
<g id="node49" class="node">
<title>codeblock_48</title>
<ellipse fill="none" stroke="#000000" cx="8164" cy="-703.8008" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8164" y="-699.6008" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 180&#45;182</text>
</g>
<!-- section_12&#45;&gt;codeblock_48 -->
<g id="edge48" class="edge">
<title>section_12&#45;&gt;codeblock_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6127.6399,-847.4434C6370.6378,-841.2494 7194.3667,-816.1737 7871,-747.2009 7944.7494,-739.6832 8028.3518,-726.8697 8087.3236,-717.1088"/>
<polygon fill="#000000" stroke="#000000" points="8088.015,-720.5419 8097.3044,-715.447 8086.8653,-713.637 8088.015,-720.5419"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="226,-448.1019 0,-448.1019 0,-392.2989 226,-392.2989 226,-448.1019"/>
<text text-anchor="middle" x="113" y="-400.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; We&#39;re gathering stuff twice.</text>
</g>
<!-- prose_15&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>prose_15&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M828.8455,-686.7697C821.5806,-677.2277 811.1984,-666.1255 799,-660.4008 685.3088,-607.0458 342.1984,-689.8298 235,-624.4008 173.4605,-586.8399 139.1174,-505.5415 123.4972,-457.6286"/>
<polygon fill="#000000" stroke="#000000" points="126.7878,-456.4255 120.4452,-447.939 120.1112,-458.5286 126.7878,-456.4255"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="715.5,-455.4008 244.5,-455.4008 244.5,-385 715.5,-385 715.5,-455.4008"/>
<text text-anchor="middle" x="480" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;The pattern of passing the string around is a good one.</text>
<text text-anchor="middle" x="480" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;doing a match&#45;time capture is therefore not necessary, we </text>
<text text-anchor="middle" x="480" y="-393.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;should slice the value off the string. </text>
</g>
<!-- prose_16&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_16&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M910.1373,-687.0418C902.7664,-677.8388 892.5164,-666.9888 881,-660.4008 818.8603,-624.8538 788.1117,-656.2541 724,-624.4008 641.8254,-583.5731 563.5587,-509.7524 518.7276,-462.9459"/>
<polygon fill="#000000" stroke="#000000" points="521.2477,-460.517 511.8241,-455.6749 516.1713,-465.3368 521.2477,-460.517"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1274.5,-455.4008 733.5,-455.4008 733.5,-385 1274.5,-385 1274.5,-455.4008"/>
<text text-anchor="middle" x="1004" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; &#160;This means we need to pass in an optional offset, in case we&#39;re</text>
<text text-anchor="middle" x="1004" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;working on a substring. &#160;I need the Grammar class to be sufficiently</text>
<text text-anchor="middle" x="1004" y="-393.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;general for my own purposes, and the Prose class needs the offset.</text>
</g>
<!-- prose_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1004,-685.6289C1004,-641.8542 1004,-529.4891 1004,-465.8804"/>
<polygon fill="#000000" stroke="#000000" points="1007.5001,-465.7307 1004,-455.7307 1000.5001,-465.7307 1007.5001,-465.7307"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1491,-448.1019 1293,-448.1019 1293,-392.2989 1491,-392.2989 1491,-448.1019"/>
<text text-anchor="middle" x="1392" y="-400.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes a bunch of params:</text>
</g>
<!-- prose_22&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>prose_22&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1823.3814,-686.5881C1816.0919,-677.2339 1805.8419,-666.3839 1794,-660.4008 1676.5028,-601.036 1608.4204,-699.0653 1500,-624.4008 1442.7641,-584.9849 1413.5294,-505.3679 1400.6129,-458.0335"/>
<polygon fill="#000000" stroke="#000000" points="1403.9476,-456.9513 1398.0286,-448.164 1397.1759,-458.7245 1403.9476,-456.9513"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="1868.5,-486.6012 1509.5,-486.6012 1509.5,-353.7996 1868.5,-353.7996 1868.5,-486.6012"/>
<text text-anchor="middle" x="1689" y="-455.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; id : &#160;Name of the rule</text>
<text text-anchor="middle" x="1689" y="-439.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;First position</text>
<text text-anchor="middle" x="1689" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; t &#160;&#160;&#160;&#160;: &#160;Table, which may contain other Nodes</text>
<text text-anchor="middle" x="1689" y="-409.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Last position</text>
<text text-anchor="middle" x="1689" y="-393.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; metatables : &#160;The metatable collection</text>
<text text-anchor="middle" x="1689" y="-378.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; str &#160;&#160;: &#160;The string we&#39;re parsing</text>
</g>
<!-- prose_23&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>prose_23&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1903.7563,-687.3275C1874.2116,-650.578 1801.3762,-559.9809 1748.7097,-494.471"/>
<polygon fill="#000000" stroke="#000000" points="1751.3847,-492.2123 1742.3912,-486.6117 1745.9291,-496.5983 1751.3847,-492.2123"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1987,-440.1025 1887,-440.1025 1887,-400.2983 1987,-400.2983 1987,-440.1025"/>
<text text-anchor="middle" x="1937" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #Todo</text>
</g>
<!-- prose_24&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>prose_24&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1995.0273,-685.6289C1984.5892,-637.8829 1956.3118,-508.5367 1943.4841,-449.8599"/>
<polygon fill="#000000" stroke="#000000" points="1946.9028,-449.1097 1941.3478,-440.088 1940.0643,-450.6048 1946.9028,-449.1097"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2532.5,-455.4008 2005.5,-455.4008 2005.5,-385 2532.5,-385 2532.5,-455.4008"/>
<text text-anchor="middle" x="2269" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; [ ] &#160;Impose an intermediate Root metatable. &#160;Where should this be </text>
<text text-anchor="middle" x="2269" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;done? &#160;Ideally these are added directly to the Node subclasses,</text>
<text text-anchor="middle" x="2269" y="-393.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;before the parse, then removed when the parse completes.</text>
</g>
<!-- prose_25&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>prose_25&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2151.8193,-686.0604C2171.0871,-642.3455 2221.3139,-528.3908 2249.3519,-464.778"/>
<polygon fill="#000000" stroke="#000000" points="2252.6567,-465.9579 2253.4873,-455.3957 2246.2513,-463.1346 2252.6567,-465.9579"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3085,-455.4008 2551,-455.4008 2551,-385 3085,-385 3085,-455.4008"/>
<text text-anchor="middle" x="2818" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#45; &#160;The easier way is to pass in a new Root and stick it on during</text>
<text text-anchor="middle" x="2818" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;makeAstNode. &#160;This is unacceptably wasteful in a systems tool, but</text>
<text text-anchor="middle" x="2818" y="-393.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;is also an optimization, so let&#39;s start with the clearer approach.</text>
</g>
<!-- prose_26&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>prose_26&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2538.3359,-688.1493C2582.7402,-645.6051 2706.8,-526.7422 2773.7768,-462.5711"/>
<polygon fill="#000000" stroke="#000000" points="2776.459,-464.8484 2781.2583,-455.4029 2771.6162,-459.7939 2776.459,-464.8484"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3539,-440.1025 3103,-440.1025 3103,-400.2983 3539,-400.2983 3539,-440.1025"/>
<text text-anchor="middle" x="3321" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; [ ] &#160;Handle string captures as well as table captures. </text>
</g>
<!-- prose_27&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prose_27&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2986.5618,-691.2843C3013.46,-676.6002 3058.3432,-650.8788 3094,-624.4008 3171.3245,-566.9812 3253.234,-488.2069 3294.2704,-447.3135"/>
<polygon fill="#000000" stroke="#000000" points="3296.8537,-449.6799 3301.4468,-440.1324 3291.9023,-444.7317 3296.8537,-449.6799"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="4014.5,-586.201 3557.5,-586.201 3557.5,-254.1998 4014.5,-254.1998 4014.5,-586.201"/>
<text text-anchor="middle" x="3786" y="-571.0007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makeAstNode(id, first, t, last, metatables, str)</text>
<text text-anchor="middle" x="3786" y="-555.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.first = first</text>
<text text-anchor="middle" x="3786" y="-540.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.last &#160;= last</text>
<text text-anchor="middle" x="3786" y="-524.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;t.str &#160;&#160;= str &#45;&#45; This belongs on the Root metatable</text>
<text text-anchor="middle" x="3786" y="-509.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if metatables[id] then</text>
<text text-anchor="middle" x="3786" y="-494.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t = metatables[id](t)</text>
<text text-anchor="middle" x="3786" y="-478.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="3786" y="-463.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, Node)</text>
<text text-anchor="middle" x="3786" y="-447.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.id = id</text>
<text text-anchor="middle" x="3786" y="-432.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3786" y="-417.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if t[1] and #t == 1 and type(t[1]) == &#39;string&#39; then</text>
<text text-anchor="middle" x="3786" y="-401.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; here we&#39;re just checking that C(patt) does</text>
<text text-anchor="middle" x="3786" y="-386.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; the expected thing</text>
<text text-anchor="middle" x="3786" y="-370.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3786" y="-355.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return t </text>
<text text-anchor="middle" x="3786" y="-340.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3786" y="-324.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3786" y="-293.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function anonNode (t) </text>
<text text-anchor="middle" x="3786" y="-277.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return unpack(t)</text>
<text text-anchor="middle" x="3786" y="-262.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_28&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>codeblock_28&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3463.6567,-686.6847C3486.0236,-670.9604 3519.7248,-646.7714 3548,-624.4008 3560.9382,-614.1644 3574.1482,-603.4903 3587.3842,-592.6254"/>
<polygon fill="#000000" stroke="#000000" points="3589.6831,-595.2664 3595.1786,-586.2082 3585.2338,-589.8623 3589.6831,-595.2664"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4559.5,-463.4007 4032.5,-463.4007 4032.5,-377.0001 4559.5,-377.0001 4559.5,-463.4007"/>
<text text-anchor="middle" x="4296" y="-416.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;I&#39;m going to slice this into pieces in the Orb document, because a) it </text>
<text text-anchor="middle" x="4296" y="-400.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">needs documentation and b) we&#39;re going to be customizing it, finally, to</text>
<text text-anchor="middle" x="4296" y="-385.3004" font-family="Inconsolata" font-size="14.00" fill="#000000">suit our own needs. </text>
</g>
<!-- prose_37&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>prose_37&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5500.8946,-686.6635C5493.647,-677.0839 5483.2659,-665.9793 5471,-660.4008 5288.192,-577.2602 4757.2015,-691.7351 4568,-624.4008 4478.3911,-592.5102 4393.8614,-519.9071 4343.4959,-470.4507"/>
<polygon fill="#000000" stroke="#000000" points="4345.8809,-467.8867 4336.3163,-463.3295 4340.9514,-472.8566 4345.8809,-467.8867"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4852.5,-438.2004 4577.5,-438.2004 4577.5,-402.2004 4852.5,-402.2004 4852.5,-438.2004"/>
<text text-anchor="middle" x="4715" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, metas, g)</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_38&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5613.3236,-686.8895C5596.6637,-677.2622 5574.3834,-666.0295 5553,-660.4008 5404.3015,-621.2591 4996.9809,-698.0451 4862,-624.4008 4790.0146,-585.1263 4744.5566,-493.6466 4725.4297,-447.6455"/>
<polygon fill="#000000" stroke="#000000" points="4728.6405,-446.2492 4721.6446,-438.2926 4722.1517,-448.8753 4728.6405,-446.2492"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="5111,-440.1025 4871,-440.1025 4871,-400.2983 5111,-400.2983 5111,-440.1025"/>
<text text-anchor="middle" x="4991" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">First step is set up our =_ENV=.</text>
</g>
<!-- prose_39&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>prose_39&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5756.4942,-686.744C5749.0239,-677.1929 5738.3868,-666.0901 5726,-660.4008 5603.4085,-604.0942 5236.1669,-692.9893 5120,-624.4008 5053.3637,-585.0567 5015.7643,-496.3229 4999.9659,-449.8519"/>
<polygon fill="#000000" stroke="#000000" points="5003.1994,-448.4805 4996.7524,-440.073 4996.5493,-450.6659 5003.1994,-448.4805"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="5628.5,-447.5008 5129.5,-447.5008 5129.5,-392.9 5628.5,-392.9 5628.5,-447.5008"/>
<text text-anchor="middle" x="5379" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">In a way this is an elaborate workaround for Lua&#39;s global&#45;by&#45;default </text>
<text text-anchor="middle" x="5379" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">antipattern, which we aim to eliminate with Lun.</text>
</g>
<!-- prose_40&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>prose_40&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5838.184,-686.9592C5830.8287,-677.7286 5820.5787,-666.8786 5809,-660.4008 5740.8407,-622.2686 5707.7309,-657.5202 5637,-624.4008 5545.8508,-581.7207 5457.9573,-501.0629 5412.0141,-454.9205"/>
<polygon fill="#000000" stroke="#000000" points="5414.2533,-452.2067 5404.7378,-447.5476 5409.271,-457.1237 5414.2533,-452.2067"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="5991.5,-608.8014 5646.5,-608.8014 5646.5,-231.5994 5991.5,-231.5994 5991.5,-608.8014"/>
<text text-anchor="middle" x="5819" y="-593.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="5819" y="-578.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="5819" y="-563.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="5819" y="-547.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local node_mts = metas or {}</text>
<text text-anchor="middle" x="5819" y="-532.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="5819" y="-516.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function( name ) g[ 1 ] = name end,</text>
<text text-anchor="middle" x="5819" y="-501.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function( ... )</text>
<text text-anchor="middle" x="5819" y="-486.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="5819" y="-470.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select( &#39;#&#39;, ... ) do</text>
<text text-anchor="middle" x="5819" y="-455.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[ select( i, ... ) ] = true</text>
<text text-anchor="middle" x="5819" y="-439.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5819" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="5819" y="-409.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;E = E,</text>
<text text-anchor="middle" x="5819" y="-393.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;EOF = EOF,</text>
<text text-anchor="middle" x="5819" y="-378.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;ID = ID,</text>
<text text-anchor="middle" x="5819" y="-362.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;W = W,</text>
<text text-anchor="middle" x="5819" y="-347.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="5819" y="-332.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="5819" y="-316.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; copy lpeg shortcuts</text>
<text text-anchor="middle" x="5819" y="-301.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for k,v in pairs( L ) do</text>
<text text-anchor="middle" x="5819" y="-285.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if string.match( k, &quot;^%u%w*$&quot; ) then</text>
<text text-anchor="middle" x="5819" y="-270.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;env_index[ k ] = v</text>
<text text-anchor="middle" x="5819" y="-255.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5819" y="-239.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>codeblock_41&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5977.1712,-685.6289C5967.8291,-669.9519 5953.2447,-645.4776 5936.6299,-617.5962"/>
<polygon fill="#000000" stroke="#000000" points="5939.5377,-615.6387 5931.412,-608.8399 5933.5245,-619.2221 5939.5377,-615.6387"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="6242.5,-440.1025 6009.5,-440.1025 6009.5,-400.2983 6242.5,-400.2983 6242.5,-440.1025"/>
<text text-anchor="middle" x="6126" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">Here&#39;s where the magic happens.</text>
</g>
<!-- prose_42&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>prose_42&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6126,-685.6289C6126,-637.9817 6126,-509.0719 6126,-450.2252"/>
<polygon fill="#000000" stroke="#000000" points="6129.5001,-450.088 6126,-440.088 6122.5001,-450.088 6129.5001,-450.088"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="6697,-447.5008 6261,-447.5008 6261,-392.9 6697,-392.9 6697,-447.5008"/>
<text text-anchor="middle" x="6479" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">The __newindex method takes any new assignment in global, so</text>
<text text-anchor="middle" x="6479" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">any grammar rules, and applies a consistent capture to them.</text>
</g>
<!-- prose_43&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>prose_43&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6351.5074,-686.0604C6373.3661,-640.4784 6431.8468,-518.5289 6461.3949,-456.9123"/>
<polygon fill="#000000" stroke="#000000" points="6464.7105,-458.0924 6465.8787,-447.5622 6458.3988,-455.0656 6464.7105,-458.0924"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="7116.5,-440.1025 6715.5,-440.1025 6715.5,-400.2983 7116.5,-400.2983 7116.5,-440.1025"/>
<text text-anchor="middle" x="6916" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">Now we get to figure out what that capture wants to be!</text>
</g>
<!-- prose_44&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>prose_44&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6684.2893,-687.3275C6724.9333,-640.4711 6841.5103,-506.0756 6892.0981,-447.7557"/>
<polygon fill="#000000" stroke="#000000" points="6894.8749,-449.8959 6898.7835,-440.0484 6889.587,-445.3091 6894.8749,-449.8959"/>
</g>
<!-- structure_57 -->
<g id="node58" class="node">
<title>structure_57</title>
<ellipse fill="none" stroke="#000000" cx="7179" cy="-420.2004" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="7179" y="-416.0004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_45&#45;&gt;structure_57 -->
<g id="edge57" class="edge">
<title>block_45&#45;&gt;structure_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7025.4111,-690.165C7057.4893,-677.9085 7099.802,-656.7856 7125,-624.4008 7165.913,-571.8188 7175.9525,-491.0202 7178.3335,-448.5406"/>
<polygon fill="#000000" stroke="#000000" points="7181.8384,-448.5109 7178.7965,-438.3622 7174.8456,-448.1928 7181.8384,-448.5109"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="7748,-624.6014 7242,-624.6014 7242,-215.7994 7748,-215.7994 7748,-624.6014"/>
<text text-anchor="middle" x="7495" y="-609.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env_index, { __index = _G } )</text>
<text text-anchor="middle" x="7495" y="-593.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env, {</text>
<text text-anchor="middle" x="7495" y="-578.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="7495" y="-563.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="7495" y="-547.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="7495" y="-532.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = L.Ct( val ) / anonNode</text>
<text text-anchor="middle" x="7495" y="-516.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="7495" y="-501.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7495" y="-486.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = (L.Cc( name ) </text>
<text text-anchor="middle" x="7495" y="-470.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="7495" y="-455.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Ct( val ) </text>
<text text-anchor="middle" x="7495" y="-439.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="7495" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Cc(node_mts)</text>
<text text-anchor="middle" x="7495" y="-409.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Carg(1)) / makeAstNode</text>
<text text-anchor="middle" x="7495" y="-393.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="7495" y="-378.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7495" y="-362.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7495" y="-347.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;} )</text>
<text text-anchor="middle" x="7495" y="-332.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="7495" y="-316.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="7495" y="-301.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="7495" y="-285.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7495" y="-270.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="7495" y="-255.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="7495" y="-239.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="7495" y="-224.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_46&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>codeblock_46&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7334.9569,-685.6289C7342.6033,-672.9476 7353.7206,-654.5098 7366.5884,-633.1687"/>
<polygon fill="#000000" stroke="#000000" points="7369.635,-634.8942 7371.8013,-624.5232 7363.6404,-631.2797 7369.635,-634.8942"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="8300,-501.2007 7766,-501.2007 7766,-339.2001 8300,-339.2001 8300,-501.2007"/>
<text text-anchor="middle" x="8033" y="-486.0006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="8033" y="-470.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="8033" y="-455.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, &#160;metas)</text>
<text text-anchor="middle" x="8033" y="-439.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return function(str)</text>
<text text-anchor="middle" x="8033" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return L.match(L.P(grammar), str, 1, &#39;grammar&#39;, str) &#45;&#45; other </text>
<text text-anchor="middle" x="8033" y="-409.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8033" y="-393.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="8033" y="-378.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="8033" y="-362.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8033" y="-347.4003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_47&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>codeblock_47&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7791.1391,-686.0604C7822.7825,-651.2771 7894.8815,-572.024 7952.1752,-509.0452"/>
<polygon fill="#000000" stroke="#000000" points="7954.9447,-511.202 7959.0851,-501.4496 7949.7668,-506.4914 7954.9447,-511.202"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="8404,-438.2004 8318,-438.2004 8318,-402.2004 8404,-402.2004 8404,-438.2004"/>
<text text-anchor="middle" x="8361" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_48&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>codeblock_48&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8212.5514,-688.6936C8244.4903,-676.3277 8284.7295,-655.7002 8309,-624.4008 8349.729,-571.8765 8358.8383,-491.0538 8360.6947,-448.5552"/>
<polygon fill="#000000" stroke="#000000" points="8364.199,-448.482 8361.0308,-438.372 8357.2028,-448.2511 8364.199,-448.482"/>
</g>
<!-- handleline_58 -->
<g id="node59" class="node">
<title>handleline_58</title>
<ellipse fill="none" stroke="#000000" cx="7179" cy="-162" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="7179" y="-157.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_57&#45;&gt;handleline_58 -->
<g id="edge58" class="edge">
<title>structure_57&#45;&gt;handleline_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7179,-402.0443C7179,-357.692 7179,-243.5762 7179,-190.2494"/>
<polygon fill="#000000" stroke="#000000" points="7182.5001,-190.1361 7179,-180.1361 7175.5001,-190.1361 7182.5001,-190.1361"/>
</g>
<!-- handle_59 -->
<g id="node60" class="node">
<title>handle_59</title>
<ellipse fill="none" stroke="#000000" cx="7179" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="7179" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_58&#45;&gt;handle_59 -->
<g id="edge59" class="edge">
<title>handleline_58&#45;&gt;handle_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7179,-143.8314C7179,-136.131 7179,-126.9743 7179,-118.4166"/>
<polygon fill="#000000" stroke="#000000" points="7182.5001,-118.4132 7179,-108.4133 7175.5001,-118.4133 7182.5001,-118.4132"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="7232.5,-36 7125.5,-36 7125.5,0 7232.5,0 7232.5,-36"/>
<text text-anchor="middle" x="7179" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">grammar&#45;magic</text>
</g>
<!-- handle_59&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>handle_59&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7179,-71.8314C7179,-64.131 7179,-54.9743 7179,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="7182.5001,-46.4132 7179,-36.4133 7175.5001,-46.4133 7182.5001,-46.4132"/>
</g>
</g>
</svg>