<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2952pt" height="1303pt"
 viewBox="0.00 0.00 2951.88 1302.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1298.6022)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1298.6022 2947.8797,-1298.6022 2947.8797,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="91.1964" cy="-1276.6022" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="91.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 213</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="91.1964" cy="-647.3011" rx="55.6456" ry="18"/>
<text text-anchor="middle" x="91.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;6</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M91.1964,-1258.4471C91.1964,-1169.9928 91.1964,-784.0525 91.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="94.6965,-675.5298 91.1964,-665.5298 87.6965,-675.5299 94.6965,-675.5298"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="91.1964" cy="-18" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="91.1964" y="-13.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M91.1964,-629.146C91.1964,-540.6917 91.1964,-154.7514 91.1964,-46.388"/>
<polygon fill="#000000" stroke="#000000" points="94.6965,-46.2287 91.1964,-36.2288 87.6965,-46.2288 94.6965,-46.2287"/>
</g>
<!-- section_3 -->
<g id="node4" class="node">
<title>section_3</title>
<ellipse fill="none" stroke="#000000" cx="233.1964" cy="-1276.6022" rx="47.9272" ry="18"/>
<text text-anchor="middle" x="233.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section_3</text>
</g>
<!-- header_4 -->
<g id="node5" class="node">
<title>header_4</title>
<ellipse fill="none" stroke="#000000" cx="233.1964" cy="-647.3011" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="233.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parameters</text>
</g>
<!-- section_3&#45;&gt;header_4 -->
<g id="edge3" class="edge">
<title>section_3&#45;&gt;header_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M233.1964,-1258.4471C233.1964,-1169.9928 233.1964,-784.0525 233.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="236.6965,-675.5298 233.1964,-665.5298 229.6965,-675.5299 236.6965,-675.5298"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="416.1964" cy="-1276.6022" rx="47.9272" ry="18"/>
<text text-anchor="middle" x="416.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section_5</text>
</g>
<!-- header_9 -->
<g id="node7" class="node">
<title>header_9</title>
<ellipse fill="none" stroke="#000000" cx="416.1964" cy="-647.3011" rx="96.7227" ry="18"/>
<text text-anchor="middle" x="416.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : grammar_template</text>
</g>
<!-- section_5&#45;&gt;header_9 -->
<g id="edge4" class="edge">
<title>section_5&#45;&gt;header_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M416.1964,-1258.4471C416.1964,-1169.9928 416.1964,-784.0525 416.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="419.6965,-675.5298 416.1964,-665.5298 412.6965,-675.5299 419.6965,-675.5298"/>
</g>
<!-- section_6 -->
<g id="node8" class="node">
<title>section_6</title>
<ellipse fill="none" stroke="#000000" cx="577.1964" cy="-1276.6022" rx="47.9272" ry="18"/>
<text text-anchor="middle" x="577.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section_6</text>
</g>
<!-- header_10 -->
<g id="node9" class="node">
<title>header_10</title>
<ellipse fill="none" stroke="#000000" cx="577.1964" cy="-647.3011" rx="46.4563" ry="18"/>
<text text-anchor="middle" x="577.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : metas</text>
</g>
<!-- section_6&#45;&gt;header_10 -->
<g id="edge5" class="edge">
<title>section_6&#45;&gt;header_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M577.1964,-1258.4471C577.1964,-1169.9928 577.1964,-784.0525 577.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="580.6965,-675.5298 577.1964,-665.5298 573.6965,-675.5299 580.6965,-675.5298"/>
</g>
<!-- section_7 -->
<g id="node10" class="node">
<title>section_7</title>
<ellipse fill="none" stroke="#000000" cx="696.1964" cy="-1276.6022" rx="47.9272" ry="18"/>
<text text-anchor="middle" x="696.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section_7</text>
</g>
<!-- header_11 -->
<g id="node11" class="node">
<title>header_11</title>
<ellipse fill="none" stroke="#000000" cx="696.1964" cy="-647.3011" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="696.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_7&#45;&gt;header_11 -->
<g id="edge6" class="edge">
<title>section_7&#45;&gt;header_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M696.1964,-1258.4471C696.1964,-1169.9928 696.1964,-784.0525 696.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="699.6965,-675.5298 696.1964,-665.5298 692.6965,-675.5299 699.6965,-675.5298"/>
</g>
<!-- codeblock_12 -->
<g id="node12" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="889.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="889.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_12</text>
</g>
<!-- leaf_14 -->
<g id="node13" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1009.1964,-682.5015 769.1964,-682.5015 769.1964,-612.1007 1009.1964,-612.1007 1009.1964,-682.5015"/>
<text text-anchor="middle" x="889.1964" y="-667.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="889.1964" y="-635.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot; </text>
<text text-anchor="middle" x="889.1964" y="-620.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_14 -->
<g id="edge7" class="edge">
<title>codeblock_12&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M889.1964,-1258.4471C889.1964,-1174.1611 889.1964,-819.7654 889.1964,-692.7973"/>
<polygon fill="#000000" stroke="#000000" points="892.6965,-692.6394 889.1964,-682.6395 885.6965,-692.6395 892.6965,-692.6394"/>
</g>
<!-- codeblock_13 -->
<g id="node14" class="node">
<title>codeblock_13</title>
<ellipse fill="none" stroke="#000000" cx="1207.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="1207.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_13</text>
</g>
<!-- leaf_15 -->
<g id="node15" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1386.6964,-774.7019 1027.6964,-774.7019 1027.6964,-519.9003 1386.6964,-519.9003 1386.6964,-774.7019"/>
<text text-anchor="middle" x="1207.1964" y="-759.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">local assert = assert</text>
<text text-anchor="middle" x="1207.1964" y="-743.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local string, io = assert( string ), assert( io )</text>
<text text-anchor="middle" x="1207.1964" y="-728.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = string.sub( assert( _VERSION ), &#45;4 )</text>
<text text-anchor="middle" x="1207.1964" y="-713.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local _G = assert( _G )</text>
<text text-anchor="middle" x="1207.1964" y="-697.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local error = assert( error )</text>
<text text-anchor="middle" x="1207.1964" y="-682.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local pairs = assert( pairs )</text>
<text text-anchor="middle" x="1207.1964" y="-666.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local next = assert( next )</text>
<text text-anchor="middle" x="1207.1964" y="-651.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">local type = assert( type )</text>
<text text-anchor="middle" x="1207.1964" y="-636.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local tostring = assert( tostring )</text>
<text text-anchor="middle" x="1207.1964" y="-620.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local setmetatable = assert( setmetatable )</text>
<text text-anchor="middle" x="1207.1964" y="-605.301" font-family="Inconsolata" font-size="14.00" fill="#000000">local setfenv </text>
<text text-anchor="middle" x="1207.1964" y="-589.901" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfenv </text>
<text text-anchor="middle" x="1207.1964" y="-574.501" font-family="Inconsolata" font-size="14.00" fill="#000000">if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="1207.1964" y="-559.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local setfenv = assert( setfenv )</text>
<text text-anchor="middle" x="1207.1964" y="-543.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local getfenv = assert( getfenv )</text>
<text text-anchor="middle" x="1207.1964" y="-528.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_13&#45;&gt;leaf_15 -->
<g id="edge8" class="edge">
<title>codeblock_13&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1207.1964,-1258.4471C1207.1964,-1189.9712 1207.1964,-943.2145 1207.1964,-784.9687"/>
<polygon fill="#000000" stroke="#000000" points="1210.6965,-784.6761 1207.1964,-774.6762 1203.6965,-784.6762 1210.6965,-784.6761"/>
</g>
<!-- section_8 -->
<g id="node16" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="1451.1964" cy="-1276.6022" rx="47.9272" ry="18"/>
<text text-anchor="middle" x="1451.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section_8</text>
</g>
<!-- header_16 -->
<g id="node17" class="node">
<title>header_16</title>
<ellipse fill="none" stroke="#000000" cx="1451.1964" cy="-647.3011" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="1451.1964" y="-643.1011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : define</text>
</g>
<!-- section_8&#45;&gt;header_16 -->
<g id="edge9" class="edge">
<title>section_8&#45;&gt;header_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1451.1964,-1258.4471C1451.1964,-1169.9928 1451.1964,-784.0525 1451.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="1454.6965,-675.5298 1451.1964,-665.5298 1447.6965,-675.5299 1454.6965,-675.5298"/>
</g>
<!-- codeblock_17 -->
<g id="node18" class="node">
<title>codeblock_17</title>
<ellipse fill="none" stroke="#000000" cx="1768.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="1768.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_17</text>
</g>
<!-- leaf_21 -->
<g id="node19" class="node">
<title>leaf_21</title>
<polygon fill="none" stroke="#c0c0c0" points="2021.1964,-1222.4033 1515.1964,-1222.4033 1515.1964,-72.1989 2021.1964,-72.1989 2021.1964,-1222.4033"/>
<text text-anchor="middle" x="1768.1964" y="-1207.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_ast_node(id, first, t, last, str, metas, offset)</text>
<text text-anchor="middle" x="1768.1964" y="-1192.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="1768.1964" y="-1176.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.first = first + offset</text>
<text text-anchor="middle" x="1768.1964" y="-1161.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.last &#160;= last + offset &#45; 1</text>
<text text-anchor="middle" x="1768.1964" y="-1145.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.str &#160;&#160;= str</text>
<text text-anchor="middle" x="1768.1964" y="-1130.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if metas[id] then</text>
<text text-anchor="middle" x="1768.1964" y="-1115.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;t = metas[id](t, str)</text>
<text text-anchor="middle" x="1768.1964" y="-1099.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;assert(t.id == id)</text>
<text text-anchor="middle" x="1768.1964" y="-1084.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="1768.1964" y="-1068.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.id = id</text>
<text text-anchor="middle" x="1768.1964" y="-1053.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, {__index = Node,</text>
<text text-anchor="middle" x="1768.1964" y="-1038.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__tostring = Node.toString})</text>
<text text-anchor="middle" x="1768.1964" y="-1022.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-1007.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.isNode, &quot;failed isNode: &quot; .. t.id)</text>
<text text-anchor="middle" x="1768.1964" y="-991.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.str)</text>
<text text-anchor="middle" x="1768.1964" y="-976.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return t</text>
<text text-anchor="middle" x="1768.1964" y="-961.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1768.1964" y="-913.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; some useful/common lpeg patterns</text>
<text text-anchor="middle" x="1768.1964" y="-898.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cp = L.Cp</text>
<text text-anchor="middle" x="1768.1964" y="-882.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cc = L.Cc</text>
<text text-anchor="middle" x="1768.1964" y="-867.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = L.Ct</text>
<text text-anchor="middle" x="1768.1964" y="-852.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg1_str = L.Carg(1)</text>
<text text-anchor="middle" x="1768.1964" y="-836.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg2_metas = L.Carg(2)</text>
<text text-anchor="middle" x="1768.1964" y="-821.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg3_offset = L.Carg(3)</text>
<text text-anchor="middle" x="1768.1964" y="-773.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; setup an environment where you can easily define lpeg grammars</text>
<text text-anchor="middle" x="1768.1964" y="-758.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; with lots of syntax sugar</text>
<text text-anchor="middle" x="1768.1964" y="-743.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, g, e)</text>
<text text-anchor="middle" x="1768.1964" y="-727.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="1768.1964" y="-712.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if e == nil then</text>
<text text-anchor="middle" x="1768.1964" y="-696.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;e = V == &quot; 5.1&quot; and getfenv(func) or _G</text>
<text text-anchor="middle" x="1768.1964" y="-681.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-666.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="1768.1964" y="-650.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="1768.1964" y="-635.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="1768.1964" y="-619.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function(name) g[1] = name end,</text>
<text text-anchor="middle" x="1768.1964" y="-604.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function(...)</text>
<text text-anchor="middle" x="1768.1964" y="-589.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="1768.1964" y="-573.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select(&#39;#&#39;, ...) do</text>
<text text-anchor="middle" x="1768.1964" y="-558.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[select(i, ... )] = true</text>
<text text-anchor="middle" x="1768.1964" y="-542.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-527.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="1768.1964" y="-512.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;V = L.V,</text>
<text text-anchor="middle" x="1768.1964" y="-496.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;P = L.P,</text>
<text text-anchor="middle" x="1768.1964" y="-481.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="1768.1964" y="-449.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env_index, { __index = e })</text>
<text text-anchor="middle" x="1768.1964" y="-434.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env, {</text>
<text text-anchor="middle" x="1768.1964" y="-419.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="1768.1964" y="-403.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="1768.1964" y="-388.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="1768.1964" y="-372.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = val</text>
<text text-anchor="middle" x="1768.1964" y="-357.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1768.1964" y="-342.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = (Cc(name) </text>
<text text-anchor="middle" x="1768.1964" y="-326.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp() </text>
<text text-anchor="middle" x="1768.1964" y="-311.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Ct(val)</text>
<text text-anchor="middle" x="1768.1964" y="-295.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp()</text>
<text text-anchor="middle" x="1768.1964" y="-280.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg1_str</text>
<text text-anchor="middle" x="1768.1964" y="-265.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg2_metas)</text>
<text text-anchor="middle" x="1768.1964" y="-249.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg3_offset / make_ast_node</text>
<text text-anchor="middle" x="1768.1964" y="-234.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-218.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-203.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;})</text>
<text text-anchor="middle" x="1768.1964" y="-188.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="1768.1964" y="-172.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="1768.1964" y="-157.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="1768.1964" y="-141.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="1768.1964" y="-126.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="1768.1964" y="-111.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="1768.1964" y="-95.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="1768.1964" y="-80.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_17&#45;&gt;leaf_21 -->
<g id="edge10" class="edge">
<title>codeblock_17&#45;&gt;leaf_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1768.1964,-1258.4471C1768.1964,-1251.5748 1768.1964,-1242.9068 1768.1964,-1232.7128"/>
<polygon fill="#000000" stroke="#000000" points="1771.6965,-1232.4803 1768.1964,-1222.4804 1764.6965,-1232.4804 1771.6965,-1232.4803"/>
</g>
<!-- codeblock_18 -->
<g id="node20" class="node">
<title>codeblock_18</title>
<ellipse fill="none" stroke="#000000" cx="2177.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="2177.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_18</text>
</g>
<!-- leaf_22 -->
<g id="node21" class="node">
<title>leaf_22</title>
<polygon fill="none" stroke="#c0c0c0" points="2314.6964,-713.0015 2039.6964,-713.0015 2039.6964,-581.6007 2314.6964,-581.6007 2314.6964,-713.0015"/>
<text text-anchor="middle" x="2177.1964" y="-697.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function refineMetas(metas)</text>
<text text-anchor="middle" x="2177.1964" y="-682.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for _,v in pairs(metas) do</text>
<text text-anchor="middle" x="2177.1964" y="-666.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not v[&quot;__tostring&quot;] then</text>
<text text-anchor="middle" x="2177.1964" y="-651.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;v[&quot;__tostring&quot;] = Node.toString</text>
<text text-anchor="middle" x="2177.1964" y="-636.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2177.1964" y="-620.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2177.1964" y="-605.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return metas</text>
<text text-anchor="middle" x="2177.1964" y="-589.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_18&#45;&gt;leaf_22 -->
<g id="edge11" class="edge">
<title>codeblock_18&#45;&gt;leaf_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2177.1964,-1258.4471C2177.1964,-1180.1694 2177.1964,-868.9191 2177.1964,-723.237"/>
<polygon fill="#000000" stroke="#000000" points="2180.6965,-723.0395 2177.1964,-713.0395 2173.6965,-723.0395 2180.6965,-723.0395"/>
</g>
<!-- codeblock_19 -->
<g id="node22" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2575.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="2575.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_19</text>
</g>
<!-- leaf_23 -->
<g id="node23" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="2817.6964,-751.5016 2332.6964,-751.5016 2332.6964,-543.1006 2817.6964,-543.1006 2817.6964,-751.5016"/>
<text text-anchor="middle" x="2575.1964" y="-736.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="2575.1964" y="-720.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(grammar_template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="2575.1964" y="-705.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local metas = metas or {}</text>
<text text-anchor="middle" x="2575.1964" y="-690.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, nil, metas)</text>
<text text-anchor="middle" x="2575.1964" y="-674.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parse = function(str, offset)</text>
<text text-anchor="middle" x="2575.1964" y="-659.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="2575.1964" y="-643.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return L.match(grammar, str, 1, str, metas, offset) &#45;&#45; other </text>
<text text-anchor="middle" x="2575.1964" y="-628.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2575.1964" y="-613.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return parse</text>
<text text-anchor="middle" x="2575.1964" y="-597.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="2575.1964" y="-582.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="2575.1964" y="-566.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2575.1964" y="-551.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_23 -->
<g id="edge12" class="edge">
<title>codeblock_19&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2575.1964,-1258.4471C2575.1964,-1186.5203 2575.1964,-917.8906 2575.1964,-761.7524"/>
<polygon fill="#000000" stroke="#000000" points="2578.6965,-761.6338 2575.1964,-751.6338 2571.6965,-761.6339 2578.6965,-761.6338"/>
</g>
<!-- codeblock_20 -->
<g id="node24" class="node">
<title>codeblock_20</title>
<ellipse fill="none" stroke="#000000" cx="2879.1964" cy="-1276.6022" rx="64.8671" ry="18"/>
<text text-anchor="middle" x="2879.1964" y="-1272.4022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">codeblock_20</text>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="2922.1964,-665.3011 2836.1964,-665.3011 2836.1964,-629.3011 2922.1964,-629.3011 2922.1964,-665.3011"/>
<text text-anchor="middle" x="2879.1964" y="-643.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_20&#45;&gt;leaf_24 -->
<g id="edge13" class="edge">
<title>codeblock_20&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2879.1964,-1258.4471C2879.1964,-1169.9928 2879.1964,-784.0525 2879.1964,-675.6891"/>
<polygon fill="#000000" stroke="#000000" points="2882.6965,-675.5298 2879.1964,-665.5298 2875.6965,-675.5299 2882.6965,-675.5298"/>
</g>
</g>
</svg>