<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="3255pt" height="1586pt"
 viewBox="0.00 0.00 3255.00 1586.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1582.4024)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1582.4024 3251,-1582.4024 3251,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="295" cy="-1560.4024" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="295" y="-1556.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 132</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="295" cy="-1488.4024" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="295" y="-1484.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;15</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M295,-1542.2337C295,-1534.5333 295,-1525.3767 295,-1516.819"/>
<polygon fill="#000000" stroke="#000000" points="298.5001,-1516.8156 295,-1506.8156 291.5001,-1516.8157 298.5001,-1516.8156"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="93" cy="-1416.4024" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="93" y="-1412.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M256.0524,-1474.52C225.0334,-1463.4638 181.2653,-1447.8633 146.8845,-1435.6087"/>
<polygon fill="#000000" stroke="#000000" points="148.0494,-1432.3083 137.4547,-1432.2476 145.6991,-1438.902 148.0494,-1432.3083"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="234" cy="-1416.4024" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="234" y="-1412.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M279.9213,-1470.6046C272.3139,-1461.6253 262.9694,-1450.5958 254.7003,-1440.8355"/>
<polygon fill="#000000" stroke="#000000" points="257.2035,-1438.3756 248.0688,-1433.0082 251.8626,-1442.9005 257.2035,-1438.3756"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="357" cy="-1416.4024" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="357" y="-1412.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;13</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M310.3258,-1470.6046C317.7779,-1461.9507 326.8698,-1451.3923 335.0427,-1441.9012"/>
<polygon fill="#000000" stroke="#000000" points="337.7625,-1444.1065 341.6356,-1434.2449 332.4581,-1439.5388 337.7625,-1444.1065"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="631" cy="-1416.4024" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="631" y="-1412.2024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;33</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M344.578,-1477.7785C404.1852,-1465.0055 504.26,-1443.5609 568.9412,-1429.7007"/>
<polygon fill="#000000" stroke="#000000" points="569.962,-1433.0615 579.0067,-1427.5438 568.4953,-1426.2169 569.962,-1433.0615"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="226,-1316.5023 172,-1316.5023 172,-1276.5023 226,-1276.5023 226,-1316.5023"/>
</g>
<!-- prose_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>prose_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M228.7601,-1398.4521C223.2036,-1379.4171 214.3332,-1349.0294 207.7202,-1326.3752"/>
<polygon fill="#000000" stroke="#000000" points="211.0227,-1325.1979 204.8607,-1316.5793 204.3031,-1327.1594 211.0227,-1325.1979"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="470,-1362.3026 244,-1362.3026 244,-1230.7019 470,-1230.7019 470,-1362.3026"/>
<text text-anchor="middle" x="357" y="-1347.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;node/elpeg&quot;</text>
<text text-anchor="middle" x="357" y="-1315.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="357" y="-1300.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local setfenv </text>
<text text-anchor="middle" x="357" y="-1285.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="357" y="-1269.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setfenv = setfenv</text>
<text text-anchor="middle" x="357" y="-1254.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( setfenv )</text>
<text text-anchor="middle" x="357" y="-1238.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>codeblock_4&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M357,-1398.1921C357,-1390.8989 357,-1381.9695 357,-1372.4603"/>
<polygon fill="#000000" stroke="#000000" points="360.5001,-1372.385 357,-1362.3851 353.5001,-1372.3851 360.5001,-1372.385"/>
</g>
<!-- header_8 -->
<g id="node9" class="node">
<title>header_8</title>
<ellipse fill="none" stroke="#000000" cx="534" cy="-1296.5023" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="534" y="-1292.3023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : define</text>
</g>
<!-- section_5&#45;&gt;header_8 -->
<g id="edge8" class="edge">
<title>section_5&#45;&gt;header_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M616.6873,-1398.7107C600.2599,-1378.405 573.1857,-1344.9391 554.518,-1321.8642"/>
<polygon fill="#000000" stroke="#000000" points="557.0667,-1319.4498 548.056,-1313.8767 551.6246,-1323.8525 557.0667,-1319.4498"/>
</g>
<!-- prose_9 -->
<g id="node10" class="node">
<title>prose_9</title>
<ellipse fill="none" stroke="#000000" cx="631" cy="-1296.5023" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="631" y="-1292.3023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;prose_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M631,-1398.1921C631,-1378.7374 631,-1347.6403 631,-1324.9514"/>
<polygon fill="#000000" stroke="#000000" points="634.5001,-1324.8838 631,-1314.8839 627.5001,-1324.8839 634.5001,-1324.8838"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="747" cy="-1296.5023" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="747" y="-1292.3023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 22&#45;33</text>
</g>
<!-- section_5&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M647.8674,-1398.9679C667.6266,-1378.5444 700.5077,-1344.5577 722.9396,-1321.3716"/>
<polygon fill="#000000" stroke="#000000" points="725.6745,-1323.5785 730.1122,-1313.9578 720.6435,-1318.7112 725.6745,-1323.5785"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="1967" cy="-1296.5023" rx="70.655" ry="18"/>
<text text-anchor="middle" x="1967" y="-1292.3023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 34&#45;132</text>
</g>
<!-- section_5&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M693.6461,-1410.7802C913.4791,-1391.0511 1649.4327,-1325.0025 1890.1118,-1303.4026"/>
<polygon fill="#000000" stroke="#000000" points="1890.5262,-1306.8796 1900.1733,-1302.4997 1889.9004,-1299.9076 1890.5262,-1306.8796"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="520,-1194.5024 0,-1194.5024 0,-1107.9018 520,-1107.9018 520,-1194.5024"/>
<text text-anchor="middle" x="260" y="-1147.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is going to be a chopped&#45;and&#45;screwed version of epnf. &#160;Now that I</text>
<text text-anchor="middle" x="260" y="-1132.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">actually understand what it does.</text>
</g>
<!-- prose_9&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>prose_9&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M624.1464,-1278.6441C617.4425,-1263.5712 605.7826,-1242.5858 589,-1230.6022 572.2486,-1218.6408 540.0236,-1207.2794 502.0495,-1197.0856"/>
<polygon fill="#000000" stroke="#000000" points="502.8382,-1193.6741 492.2771,-1194.5194 501.0602,-1200.4445 502.8382,-1193.6741"/>
</g>
<!-- header_13 -->
<g id="node14" class="node">
<title>header_13</title>
<ellipse fill="none" stroke="#000000" cx="597" cy="-1151.2021" rx="58.5359" ry="18"/>
<text text-anchor="middle" x="597" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : problems</text>
</g>
<!-- section_10&#45;&gt;header_13 -->
<g id="edge13" class="edge">
<title>section_10&#45;&gt;header_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M728.9065,-1278.9757C702.3282,-1253.2302 652.6199,-1205.0793 622.396,-1175.8024"/>
<polygon fill="#000000" stroke="#000000" points="624.7756,-1173.2346 615.1577,-1168.7909 619.9052,-1178.2625 624.7756,-1173.2346"/>
</g>
<!-- prose_14 -->
<g id="node15" class="node">
<title>prose_14</title>
<ellipse fill="none" stroke="#000000" cx="706" cy="-1151.2021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="706" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_14 -->
<g id="edge14" class="edge">
<title>section_10&#45;&gt;prose_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M741.8902,-1278.3937C734.8546,-1253.4602 722.1196,-1208.3285 713.865,-1179.0749"/>
<polygon fill="#000000" stroke="#000000" points="717.1296,-1177.7561 711.0454,-1169.0825 710.3927,-1179.6572 717.1296,-1177.7561"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="788" cy="-1151.2021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="788" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_10&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M752.1098,-1278.3937C759.1454,-1253.4602 771.8804,-1208.3285 780.135,-1179.0749"/>
<polygon fill="#000000" stroke="#000000" points="783.6073,-1179.6572 782.9546,-1169.0825 776.8704,-1177.7561 783.6073,-1179.6572"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="981" cy="-1151.2021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="981" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_10&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M773.8428,-1279.8345C817.7351,-1252.58 904.5803,-1198.6543 950.6489,-1170.0483"/>
<polygon fill="#000000" stroke="#000000" points="952.6451,-1172.9288 959.2942,-1164.6801 948.9524,-1166.9819 952.6451,-1172.9288"/>
</g>
<!-- header_20 -->
<g id="node21" class="node">
<title>header_20</title>
<ellipse fill="none" stroke="#000000" cx="1757" cy="-1151.2021" rx="77.8797" ry="18"/>
<text text-anchor="middle" x="1757" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : makeAstNode</text>
</g>
<!-- section_11&#45;&gt;header_20 -->
<g id="edge20" class="edge">
<title>section_11&#45;&gt;header_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1942.4993,-1279.5501C1904.845,-1253.4969 1832.6729,-1203.5606 1790.3064,-1174.247"/>
<polygon fill="#000000" stroke="#000000" points="1792.2105,-1171.3084 1781.9955,-1168.4967 1788.2276,-1177.0648 1792.2105,-1171.3084"/>
</g>
<!-- prose_21 -->
<g id="node22" class="node">
<title>prose_21</title>
<ellipse fill="none" stroke="#000000" cx="1885" cy="-1151.2021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1885" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_21 -->
<g id="edge21" class="edge">
<title>section_11&#45;&gt;prose_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1956.9452,-1278.6856C1942.6669,-1253.3852 1916.4178,-1206.873 1899.8812,-1177.5709"/>
<polygon fill="#000000" stroke="#000000" points="1902.8439,-1175.6993 1894.8809,-1168.7106 1896.7477,-1179.1397 1902.8439,-1175.6993"/>
</g>
<!-- prose_22 -->
<g id="node23" class="node">
<title>prose_22</title>
<ellipse fill="none" stroke="#000000" cx="1967" cy="-1151.2021" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1967" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_22 -->
<g id="edge22" class="edge">
<title>section_11&#45;&gt;prose_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1967,-1278.3937C1967,-1253.5957 1967,-1208.8184 1967,-1179.5532"/>
<polygon fill="#000000" stroke="#000000" points="1970.5001,-1179.5389 1967,-1169.5389 1963.5001,-1179.5389 1970.5001,-1179.5389"/>
</g>
<!-- codeblock_23 -->
<g id="node24" class="node">
<title>codeblock_23</title>
<ellipse fill="none" stroke="#000000" cx="2258" cy="-1151.2021" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="2258" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 45&#45;115</text>
</g>
<!-- section_11&#45;&gt;codeblock_23 -->
<g id="edge23" class="edge">
<title>section_11&#45;&gt;codeblock_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1999.2539,-1280.3974C2052.0687,-1254.0263 2156.9819,-1201.6418 2215.6958,-1172.3252"/>
<polygon fill="#000000" stroke="#000000" points="2217.324,-1175.4243 2224.7072,-1167.8256 2214.197,-1169.1616 2217.324,-1175.4243"/>
</g>
<!-- codeblock_24 -->
<g id="node25" class="node">
<title>codeblock_24</title>
<ellipse fill="none" stroke="#000000" cx="2700" cy="-1151.2021" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="2700" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 117&#45;128</text>
</g>
<!-- section_11&#45;&gt;codeblock_24 -->
<g id="edge24" class="edge">
<title>section_11&#45;&gt;codeblock_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2022.9976,-1285.402C2154.0535,-1259.4233 2480.6741,-1194.6784 2627.0388,-1165.665"/>
<polygon fill="#000000" stroke="#000000" points="2628.1319,-1169.0165 2637.2604,-1163.6388 2626.7707,-1162.1501 2628.1319,-1169.0165"/>
</g>
<!-- codeblock_25 -->
<g id="node26" class="node">
<title>codeblock_25</title>
<ellipse fill="none" stroke="#000000" cx="3088" cy="-1151.2021" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3088" y="-1147.0021" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 130&#45;132</text>
</g>
<!-- section_11&#45;&gt;codeblock_25 -->
<g id="edge25" class="edge">
<title>section_11&#45;&gt;codeblock_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2031.566,-1289.1281C2171.1717,-1273.06 2511.4961,-1233.2243 2796,-1194.6022 2867.8922,-1184.8426 2949.5627,-1172.6058 3008.2142,-1163.6157"/>
<polygon fill="#000000" stroke="#000000" points="3008.803,-1167.0664 3018.1559,-1162.0892 3007.7406,-1160.1475 3008.803,-1167.0664"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="424,-563.8025 170,-563.8025 170,-507.9996 424,-507.9996 424,-563.8025"/>
<text text-anchor="middle" x="297" y="-516.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; [ ] We&#39;re gathering stuff twice.</text>
</g>
<!-- prose_14&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>prose_14&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M694.3083,-1134.1314C686.9944,-1124.8245 676.7444,-1113.9745 665,-1107.8021 572.6344,-1059.2584 510.1888,-1142.0146 433,-1071.8021 286.731,-938.7529 287.799,-672.8357 293.7973,-574.0262"/>
<polygon fill="#000000" stroke="#000000" points="297.299,-574.1142 294.4657,-563.9053 290.3142,-573.6529 297.299,-574.1142"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="913.5,-571.1014 442.5,-571.1014 442.5,-500.7007 913.5,-500.7007 913.5,-571.1014"/>
<text text-anchor="middle" x="678" y="-539.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;The pattern of passing the string around is a good one.</text>
<text text-anchor="middle" x="678" y="-524.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;doing a match&#45;time capture is therefore not necessary, we </text>
<text text-anchor="middle" x="678" y="-509.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;should slice the value off the string. </text>
</g>
<!-- prose_15&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>prose_15&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M784.7675,-1133.1206C769.9597,-1050.2911 708.3739,-705.802 686.0916,-581.1625"/>
<polygon fill="#000000" stroke="#000000" points="689.5127,-580.4106 684.3074,-571.1826 682.622,-581.6426 689.5127,-580.4106"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1472.5,-571.1014 931.5,-571.1014 931.5,-500.7007 1472.5,-500.7007 1472.5,-571.1014"/>
<text text-anchor="middle" x="1202" y="-539.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; &#160;This means we need to pass in an optional offset, in case we&#39;re</text>
<text text-anchor="middle" x="1202" y="-524.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;working on a substring. &#160;I need the Grammar class to be sufficiently</text>
<text text-anchor="middle" x="1202" y="-509.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;general for my own purposes, and the Prose class needs the offset.</text>
</g>
<!-- prose_16&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_16&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M987.3758,-1133.4509C1016.9364,-1051.1491 1141.1041,-705.4456 1185.845,-580.8794"/>
<polygon fill="#000000" stroke="#000000" points="1189.2153,-581.8498 1189.3017,-571.2553 1182.6273,-579.4836 1189.2153,-581.8498"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1689,-563.8025 1491,-563.8025 1491,-507.9996 1689,-507.9996 1689,-563.8025"/>
<text text-anchor="middle" x="1590" y="-516.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes a bunch of params:</text>
</g>
<!-- prose_21&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>prose_21&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1872.7484,-1134.082C1865.3915,-1124.9959 1855.283,-1114.3796 1844,-1107.8021 1786.262,-1074.1436 1744.2335,-1120.0621 1698,-1071.8021 1563.0685,-930.9561 1575.1764,-670.8822 1585.2005,-573.777"/>
<polygon fill="#000000" stroke="#000000" points="1588.6811,-574.1444 1586.2807,-563.8251 1581.722,-573.389 1588.6811,-574.1444"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="2066.5,-594.3019 1707.5,-594.3019 1707.5,-477.5002 2066.5,-477.5002 2066.5,-594.3019"/>
<text text-anchor="middle" x="1887" y="-562.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; id : &#160;Name of the rule</text>
<text text-anchor="middle" x="1887" y="-547.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;First position</text>
<text text-anchor="middle" x="1887" y="-532.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; t &#160;&#160;&#160;&#160;: &#160;Table, which may contain other Nodes</text>
<text text-anchor="middle" x="1887" y="-516.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Last position</text>
<text text-anchor="middle" x="1887" y="-501.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; metatables : &#160;The metatable collection</text>
<text text-anchor="middle" x="1887" y="-485.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; str &#160;&#160;: &#160;The string we&#39;re parsing</text>
</g>
<!-- prose_22&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>prose_22&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1964.6491,-1133.1206C1954.4894,-1054.9799 1914.052,-743.9649 1895.9003,-604.3552"/>
<polygon fill="#000000" stroke="#000000" points="1899.3404,-603.6676 1894.5802,-594.2024 1892.3988,-604.5702 1899.3404,-603.6676"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2591,-1071.7032 2085,-1071.7032 2085,-.0989 2591,-.0989 2591,-1071.7032"/>
<text text-anchor="middle" x="2338" y="-1056.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makeAstNode(id, first, t, last, metatables, str)</text>
<text text-anchor="middle" x="2338" y="-1041.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.first = first</text>
<text text-anchor="middle" x="2338" y="-1025.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.last = last</text>
<text text-anchor="middle" x="2338" y="-1010.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.span = string.sub(str, first, last)</text>
<text text-anchor="middle" x="2338" y="-995.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;t.id = id</text>
<text text-anchor="middle" x="2338" y="-979.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if metatables[id] then</text>
<text text-anchor="middle" x="2338" y="-964.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t = metatables[id](t)</text>
<text text-anchor="middle" x="2338" y="-948.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="2338" y="-933.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, Node)</text>
<text text-anchor="middle" x="2338" y="-918.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2338" y="-902.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return t </text>
<text text-anchor="middle" x="2338" y="-887.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2338" y="-871.8017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2338" y="-840.4017" font-family="Inconsolata" font-size="14.00" fill="#000000">local function anonNode (t) </text>
<text text-anchor="middle" x="2338" y="-825.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return unpack(t)</text>
<text text-anchor="middle" x="2338" y="-809.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="2338" y="-778.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, metas, g)</text>
<text text-anchor="middle" x="2338" y="-762.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="2338" y="-747.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="2338" y="-732.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="2338" y="-716.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local node_mts = metas or {}</text>
<text text-anchor="middle" x="2338" y="-701.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="2338" y="-685.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function( name ) g[ 1 ] = name end,</text>
<text text-anchor="middle" x="2338" y="-670.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function( ... )</text>
<text text-anchor="middle" x="2338" y="-655.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="2338" y="-639.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select( &#39;#&#39;, ... ) do</text>
<text text-anchor="middle" x="2338" y="-624.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[ select( i, ... ) ] = true</text>
<text text-anchor="middle" x="2338" y="-608.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2338" y="-593.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="2338" y="-578.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;E = E,</text>
<text text-anchor="middle" x="2338" y="-562.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;EOF = EOF,</text>
<text text-anchor="middle" x="2338" y="-547.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;ID = ID,</text>
<text text-anchor="middle" x="2338" y="-531.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;W = W,</text>
<text text-anchor="middle" x="2338" y="-516.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="2338" y="-501.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="2338" y="-485.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; copy lpeg shortcuts</text>
<text text-anchor="middle" x="2338" y="-470.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for k,v in pairs( L ) do</text>
<text text-anchor="middle" x="2338" y="-454.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if string.match( k, &quot;^%u%w*$&quot; ) then</text>
<text text-anchor="middle" x="2338" y="-439.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;env_index[ k ] = v</text>
<text text-anchor="middle" x="2338" y="-424.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2338" y="-408.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2338" y="-393.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env_index, { __index = _G } )</text>
<text text-anchor="middle" x="2338" y="-377.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env, {</text>
<text text-anchor="middle" x="2338" y="-362.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="2338" y="-347.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="2338" y="-331.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="2338" y="-316.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = L.Ct( val ) / anonNode</text>
<text text-anchor="middle" x="2338" y="-300.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="2338" y="-285.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2338" y="-270.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = (L.Cc( name ) </text>
<text text-anchor="middle" x="2338" y="-254.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="2338" y="-239.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Ct( val ) </text>
<text text-anchor="middle" x="2338" y="-223.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="2338" y="-208.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Cc(node_mts)</text>
<text text-anchor="middle" x="2338" y="-193.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Carg(1)) / makeAstNode</text>
<text text-anchor="middle" x="2338" y="-177.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="2338" y="-162.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2338" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2338" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;} )</text>
<text text-anchor="middle" x="2338" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="2338" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="2338" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="2338" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2338" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="2338" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="2338" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="2338" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_23&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>codeblock_23&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2260.3509,-1133.1206C2261.912,-1121.1138 2264.188,-1103.6089 2266.9881,-1082.0725"/>
<polygon fill="#000000" stroke="#000000" points="2270.4922,-1082.2668 2268.3108,-1071.8989 2263.5506,-1081.3642 2270.4922,-1082.2668"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="3143,-616.9014 2609,-616.9014 2609,-454.9007 3143,-454.9007 3143,-616.9014"/>
<text text-anchor="middle" x="2876" y="-601.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="2876" y="-586.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="2876" y="-570.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, &#160;metas)</text>
<text text-anchor="middle" x="2876" y="-555.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return function(str)</text>
<text text-anchor="middle" x="2876" y="-540.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return L.match(L.P(grammar), str, 1, &#39;grammar&#39;, str) &#45;&#45; other </text>
<text text-anchor="middle" x="2876" y="-524.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2876" y="-509.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="2876" y="-493.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="2876" y="-478.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="2876" y="-463.1009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_24&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>codeblock_24&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2705.172,-1133.1206C2726.3886,-1058.9469 2807.6245,-774.9437 2849.9735,-626.8906"/>
<polygon fill="#000000" stroke="#000000" points="2853.4447,-627.4816 2852.8298,-616.9046 2846.7146,-625.5565 2853.4447,-627.4816"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="3247,-553.901 3161,-553.901 3161,-517.901 3247,-517.901 3247,-553.901"/>
<text text-anchor="middle" x="3204" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_25&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>codeblock_25&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3107.5775,-1133.3819C3122.521,-1118.5019 3142.1634,-1095.8984 3152,-1071.8021 3226.0446,-890.4185 3213.7019,-646.8288 3206.7932,-564.4696"/>
<polygon fill="#000000" stroke="#000000" points="3210.2678,-564.0259 3205.9038,-554.3716 3203.2948,-564.6401 3210.2678,-564.0259"/>
</g>
</g>
</svg>