<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="9037pt" height="1724pt"
 viewBox="0.00 0.00 9037.00 1724.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1720.0025)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1720.0025 9033,-1720.0025 9033,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1807" cy="-1698.0025" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1807" y="-1693.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 213</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1807" cy="-1626.0025" rx="55.6456" ry="18"/>
<text text-anchor="middle" x="1807" y="-1621.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;6</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1807,-1679.8339C1807,-1672.1335 1807,-1662.9768 1807,-1654.4191"/>
<polygon fill="#000000" stroke="#000000" points="1810.5001,-1654.4157 1807,-1644.4158 1803.5001,-1654.4158 1810.5001,-1654.4157"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1652" cy="-1554.0025" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="1652" y="-1549.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1774.8839,-1611.0841C1752.3963,-1600.6382 1722.0376,-1586.5361 1697.1222,-1574.9625"/>
<polygon fill="#000000" stroke="#000000" points="1698.4112,-1571.7021 1687.8674,-1570.6635 1695.4622,-1578.0506 1698.4112,-1571.7021"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1807" cy="-1554.0025" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1807" y="-1549.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1807,-1607.8339C1807,-1600.1335 1807,-1590.9768 1807,-1582.4191"/>
<polygon fill="#000000" stroke="#000000" points="1810.5001,-1582.4157 1807,-1572.4158 1803.5001,-1582.4158 1810.5001,-1582.4157"/>
</g>
<!-- section_4 -->
<g id="node5" class="node">
<title>section_4</title>
<ellipse fill="none" stroke="#000000" cx="2218" cy="-1554.0025" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2218" y="-1549.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 7&#45;103</text>
</g>
<!-- section_1&#45;&gt;section_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;section_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1856.168,-1617.3891C1930.1093,-1604.4359 2070.0409,-1579.9223 2152.5402,-1565.4699"/>
<polygon fill="#000000" stroke="#000000" points="2153.3084,-1568.8887 2162.5544,-1563.7156 2152.1005,-1561.9937 2153.3084,-1568.8887"/>
</g>
<!-- leaf_5 -->
<g id="node6" class="node">
<title>leaf_5</title>
<polygon fill="none" stroke="#c0c0c0" points="1737,-1499.9028 1315,-1499.9028 1315,-1429.3021 1737,-1429.3021 1737,-1499.9028"/>
<text text-anchor="middle" x="1526" y="-1452.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The grammar module returns one function, which generates</text>
<text text-anchor="middle" x="1526" y="-1437.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">a grammar. </text>
</g>
<!-- block_3&#45;&gt;leaf_5 -->
<g id="edge5" class="edge">
<title>block_3&#45;&gt;leaf_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1771.5139,-1542.3296C1765.026,-1540.2123 1758.3126,-1538.0326 1752,-1536.0025 1718.4866,-1525.2249 1682.1319,-1513.6764 1648.578,-1503.0761"/>
<polygon fill="#000000" stroke="#000000" points="1649.3186,-1499.6397 1638.7288,-1499.9663 1647.2109,-1506.3148 1649.3186,-1499.6397"/>
</g>
<!-- header_6 -->
<g id="node7" class="node">
<title>header_6</title>
<ellipse fill="none" stroke="#000000" cx="1823" cy="-1464.6025" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="1823" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parameters</text>
</g>
<!-- section_4&#45;&gt;header_6 -->
<g id="edge6" class="edge">
<title>section_4&#45;&gt;header_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2155.6201,-1548.3031C2090.6756,-1541.2422 1986.5439,-1526.7325 1900,-1500.0025 1887.4654,-1496.1311 1874.3214,-1490.662 1862.5131,-1485.1779"/>
<polygon fill="#000000" stroke="#000000" points="1863.8984,-1481.9609 1853.3666,-1480.8068 1860.88,-1488.2767 1863.8984,-1481.9609"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1960" cy="-1464.6025" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1960" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_4&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_4&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2164.6062,-1543.502C2124.0052,-1534.5564 2067.2648,-1519.9659 2020,-1500.0025 2010.7386,-1496.0907 2001.1656,-1490.9869 1992.4599,-1485.8777"/>
<polygon fill="#000000" stroke="#000000" points="1994.1172,-1482.7896 1983.7509,-1480.601 1990.4899,-1488.7764 1994.1172,-1482.7896"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="2084" cy="-1464.6025" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="2084" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;13</text>
</g>
<!-- section_4&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_4&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2192.7956,-1537.187C2171.418,-1522.9246 2140.5884,-1502.3563 2117.202,-1486.7537"/>
<polygon fill="#000000" stroke="#000000" points="2118.8997,-1483.6789 2108.6386,-1481.0405 2115.0148,-1489.5019 2118.8997,-1483.6789"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="2218" cy="-1464.6025" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="2218" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;103</text>
</g>
<!-- section_4&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_4&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2218,-1535.9111C2218,-1523.5511 2218,-1506.9237 2218,-1492.8341"/>
<polygon fill="#000000" stroke="#000000" points="2221.5001,-1492.667 2218,-1482.667 2214.5001,-1492.667 2221.5001,-1492.667"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="2362" cy="-1464.6025" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2362" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 17&#45;46</text>
</g>
<!-- section_4&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_4&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2244.7478,-1537.3966C2267.8846,-1523.0325 2301.5055,-1502.1595 2326.819,-1486.444"/>
<polygon fill="#000000" stroke="#000000" points="2328.7457,-1489.3676 2335.3954,-1481.1195 2325.0535,-1483.4205 2328.7457,-1489.3676"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="4531" cy="-1464.6025" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4531" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 47&#45;70</text>
</g>
<!-- section_4&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_4&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2283.1916,-1551.4828C2613.7153,-1538.7077 4102.402,-1481.1683 4455.6469,-1467.5149"/>
<polygon fill="#000000" stroke="#000000" points="4455.9071,-1471.0076 4465.7645,-1467.1239 4455.6367,-1464.0128 4455.9071,-1471.0076"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="6677" cy="-1464.6025" rx="70.655" ry="18"/>
<text text-anchor="middle" x="6677" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 71&#45;103</text>
</g>
<!-- section_4&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_4&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2283.6203,-1552.6869C2787.6189,-1542.582 6039.3959,-1477.386 6596.001,-1466.2264"/>
<polygon fill="#000000" stroke="#000000" points="6596.409,-1469.7191 6606.3368,-1466.0192 6596.2686,-1462.7205 6596.409,-1469.7191"/>
</g>
<!-- section_13 -->
<g id="node14" class="node">
<title>section_13</title>
<ellipse fill="none" stroke="#000000" cx="8111" cy="-1464.6025" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="8111" y="-1460.4025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 104&#45;213</text>
</g>
<!-- section_4&#45;&gt;section_13 -->
<g id="edge13" class="edge">
<title>section_4&#45;&gt;section_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2283.6454,-1553.5734C2692.4583,-1550.8278 4931.4552,-1534.7241 6757,-1500.0025 7236.6976,-1490.8787 7811.8373,-1473.8116 8025.5705,-1467.2585"/>
<polygon fill="#000000" stroke="#000000" points="8025.8909,-1470.7504 8035.7787,-1466.9451 8025.676,-1463.7537 8025.8909,-1470.7504"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="864.5,-1393.4045 547.5,-1393.4045 547.5,-1353.6003 864.5,-1353.6003 864.5,-1393.4045"/>
<text text-anchor="middle" x="706" y="-1362.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">This function takes two parameters, namely:</text>
</g>
<!-- block_7&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_7&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1938.1563,-1448.1339C1927.2836,-1440.9032 1913.5836,-1433.1681 1900,-1429.2024 1684.103,-1366.1716 1117.8233,-1409.2427 874.9558,-1393.1895"/>
<polygon fill="#000000" stroke="#000000" points="874.9155,-1389.6779 864.6926,-1392.4606 874.4195,-1396.6603 874.9155,-1389.6779"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1459,-1392.803 883,-1392.803 883,-1354.2018 1459,-1354.2018 1459,-1392.803"/>
<text text-anchor="middle" x="1171" y="-1377.7024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; grammar_template : &#160;A function with one parameter, which must be =_ENV=.</text>
<text text-anchor="middle" x="1171" y="-1362.3024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; metas : &#160;A map with keys of string and values of Node subclass constructors.</text>
</g>
<!-- block_8&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_8&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2060.1947,-1448.1386C2048.6,-1441.0031 2034.1343,-1433.3462 2020,-1429.2024 1905.0329,-1395.4971 1606.3496,-1400.9592 1469.4236,-1393.2447"/>
<polygon fill="#000000" stroke="#000000" points="1469.2516,-1389.7278 1459.0575,-1392.614 1468.8264,-1396.7149 1469.2516,-1389.7278"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="1752.5,-1393.4045 1477.5,-1393.4045 1477.5,-1353.6003 1752.5,-1353.6003 1752.5,-1393.4045"/>
<text text-anchor="middle" x="1615" y="-1378.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">Both of these are reasonably complex.</text>
</g>
<!-- block_9&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_9&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2191.7123,-1448.3442C2178.9757,-1441.2538 2163.18,-1433.5755 2148,-1429.2024 1985.1688,-1382.2945 1934.5551,-1411.59 1762.6819,-1393.3389"/>
<polygon fill="#000000" stroke="#000000" points="1762.8566,-1389.8371 1752.5335,-1392.2214 1762.0903,-1396.795 1762.8566,-1389.8371"/>
</g>
<!-- header_17 -->
<g id="node18" class="node">
<title>header_17</title>
<ellipse fill="none" stroke="#000000" cx="1867" cy="-1373.5024" rx="96.7227" ry="18"/>
<text text-anchor="middle" x="1867" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : grammar_template</text>
</g>
<!-- section_10&#45;&gt;header_17 -->
<g id="edge17" class="edge">
<title>section_10&#45;&gt;header_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2333.7081,-1448.3317C2320.2725,-1441.3287 2303.7408,-1433.7257 2288,-1429.2024 2152.1449,-1390.1635 2111.7773,-1414.2489 1972,-1393.2024 1962.6757,-1391.7985 1952.9138,-1390.1752 1943.2558,-1388.4751"/>
<polygon fill="#000000" stroke="#000000" points="1943.7122,-1385.0011 1933.2515,-1386.6815 1942.4769,-1391.8913 1943.7122,-1385.0011"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2037" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2037" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 17&#45;22</text>
</g>
<!-- section_10&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_10&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2332.4768,-1448.3449C2319.2049,-1441.6007 2303.1474,-1434.2002 2288,-1429.2024 2208.0391,-1402.8202 2183.7325,-1413.4405 2102,-1393.2024 2096.9781,-1391.9589 2091.7683,-1390.563 2086.5825,-1389.1035"/>
<polygon fill="#000000" stroke="#000000" points="2087.2741,-1385.6601 2076.6953,-1386.2415 2085.3278,-1392.384 2087.2741,-1385.6601"/>
</g>
<!-- block_19 -->
<g id="node20" class="node">
<title>block_19</title>
<ellipse fill="none" stroke="#000000" cx="2167" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2167" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 23&#45;25</text>
</g>
<!-- section_10&#45;&gt;block_19 -->
<g id="edge19" class="edge">
<title>section_10&#45;&gt;block_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2329.2638,-1448.8142C2316.4182,-1442.6525 2301.5369,-1435.5556 2288,-1429.2024 2261.6883,-1416.8537 2232.0471,-1403.2047 2208.6876,-1392.5086"/>
<polygon fill="#000000" stroke="#000000" points="2209.9649,-1389.2441 2199.4153,-1388.2668 2207.0529,-1395.6097 2209.9649,-1389.2441"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="2297" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2297" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 26&#45;30</text>
</g>
<!-- section_10&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_10&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2349.1581,-1446.604C2339.5704,-1433.1665 2326.3266,-1414.6048 2315.5837,-1399.5483"/>
<polygon fill="#000000" stroke="#000000" points="2318.2514,-1397.261 2309.5941,-1391.1535 2312.5531,-1401.3267 2318.2514,-1397.261"/>
</g>
<!-- block_21 -->
<g id="node22" class="node">
<title>block_21</title>
<ellipse fill="none" stroke="#000000" cx="2427" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2427" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 31&#45;35</text>
</g>
<!-- section_10&#45;&gt;block_21 -->
<g id="edge21" class="edge">
<title>section_10&#45;&gt;block_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2374.8419,-1446.604C2384.4296,-1433.1665 2397.6734,-1414.6048 2408.4163,-1399.5483"/>
<polygon fill="#000000" stroke="#000000" points="2411.4469,-1401.3267 2414.4059,-1391.1535 2405.7486,-1397.261 2411.4469,-1401.3267"/>
</g>
<!-- block_22 -->
<g id="node23" class="node">
<title>block_22</title>
<ellipse fill="none" stroke="#000000" cx="2557" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2557" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 36&#45;37</text>
</g>
<!-- section_10&#45;&gt;block_22 -->
<g id="edge22" class="edge">
<title>section_10&#45;&gt;block_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2395.5217,-1448.9418C2428.9086,-1433.3441 2480.2152,-1409.3747 2516.0072,-1392.6534"/>
<polygon fill="#000000" stroke="#000000" points="2517.6284,-1395.7592 2525.207,-1388.3555 2514.6655,-1389.4172 2517.6284,-1395.7592"/>
</g>
<!-- block_23 -->
<g id="node24" class="node">
<title>block_23</title>
<ellipse fill="none" stroke="#000000" cx="2791" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2791" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 38&#45;39</text>
</g>
<!-- section_10&#45;&gt;block_23 -->
<g id="edge23" class="edge">
<title>section_10&#45;&gt;block_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2414.1749,-1453.5229C2495.1776,-1436.3216 2650.5566,-1403.3262 2734.2586,-1385.5517"/>
<polygon fill="#000000" stroke="#000000" points="2735.0462,-1388.9626 2744.101,-1383.4616 2733.5921,-1382.1153 2735.0462,-1388.9626"/>
</g>
<!-- block_24 -->
<g id="node25" class="node">
<title>block_24</title>
<ellipse fill="none" stroke="#000000" cx="3073" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3073" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 40&#45;46</text>
</g>
<!-- section_10&#45;&gt;block_24 -->
<g id="edge24" class="edge">
<title>section_10&#45;&gt;block_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2421.7013,-1456.953C2554.7846,-1439.9011 2874.7074,-1398.9095 3010.4302,-1381.5194"/>
<polygon fill="#000000" stroke="#000000" points="3011.1821,-1384.9518 3020.6562,-1380.2092 3010.2925,-1378.0086 3011.1821,-1384.9518"/>
</g>
<!-- header_32 -->
<g id="node33" class="node">
<title>header_32</title>
<ellipse fill="none" stroke="#000000" cx="4281" cy="-1373.5024" rx="46.4563" ry="18"/>
<text text-anchor="middle" x="4281" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : metas</text>
</g>
<!-- section_11&#45;&gt;header_32 -->
<g id="edge32" class="edge">
<title>section_11&#45;&gt;header_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4491.3868,-1450.1674C4446.0124,-1433.633 4371.8849,-1406.6209 4324.8183,-1389.4698"/>
<polygon fill="#000000" stroke="#000000" points="4325.7996,-1386.1023 4315.2056,-1385.9669 4323.4029,-1392.6792 4325.7996,-1386.1023"/>
</g>
<!-- block_33 -->
<g id="node34" class="node">
<title>block_33</title>
<ellipse fill="none" stroke="#000000" cx="4401" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4401" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 47&#45;51</text>
</g>
<!-- section_11&#45;&gt;block_33 -->
<g id="edge33" class="edge">
<title>section_11&#45;&gt;block_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4506.8527,-1447.6807C4486.0175,-1433.0801 4455.7648,-1411.8799 4432.9321,-1395.8795"/>
<polygon fill="#000000" stroke="#000000" points="4434.7777,-1392.899 4424.5797,-1390.0264 4430.7605,-1398.6315 4434.7777,-1392.899"/>
</g>
<!-- block_34 -->
<g id="node35" class="node">
<title>block_34</title>
<ellipse fill="none" stroke="#000000" cx="4531" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4531" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 52&#45;60</text>
</g>
<!-- section_11&#45;&gt;block_34 -->
<g id="edge34" class="edge">
<title>section_11&#45;&gt;block_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4531,-1446.167C4531,-1433.4892 4531,-1416.4053 4531,-1401.9878"/>
<polygon fill="#000000" stroke="#000000" points="4534.5001,-1401.5995 4531,-1391.5996 4527.5001,-1401.5996 4534.5001,-1401.5995"/>
</g>
<!-- block_35 -->
<g id="node36" class="node">
<title>block_35</title>
<ellipse fill="none" stroke="#000000" cx="4889" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4889" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 61&#45;62</text>
</g>
<!-- section_11&#45;&gt;block_35 -->
<g id="edge35" class="edge">
<title>section_11&#45;&gt;block_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4579.2815,-1452.3163C4645.9516,-1435.3508 4765.8182,-1404.8484 4835.2589,-1387.1779"/>
<polygon fill="#000000" stroke="#000000" points="4836.298,-1390.5251 4845.126,-1384.667 4834.5717,-1383.7413 4836.298,-1390.5251"/>
</g>
<!-- block_36 -->
<g id="node37" class="node">
<title>block_36</title>
<ellipse fill="none" stroke="#000000" cx="5307" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="5307" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 63&#45;66</text>
</g>
<!-- section_11&#45;&gt;block_36 -->
<g id="edge36" class="edge">
<title>section_11&#45;&gt;block_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4591.5682,-1457.4919C4735.6937,-1440.572 5097.8996,-1398.0502 5244.2241,-1380.8721"/>
<polygon fill="#000000" stroke="#000000" points="5244.8567,-1384.322 5254.3804,-1379.6798 5244.0405,-1377.3697 5244.8567,-1384.322"/>
</g>
<!-- block_37 -->
<g id="node38" class="node">
<title>block_37</title>
<ellipse fill="none" stroke="#000000" cx="5801" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="5801" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 67&#45;70</text>
</g>
<!-- section_11&#45;&gt;block_37 -->
<g id="edge37" class="edge">
<title>section_11&#45;&gt;block_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4594.8498,-1460.0224C4811.7201,-1444.4658 5518.6609,-1393.7553 5736.503,-1378.1289"/>
<polygon fill="#000000" stroke="#000000" points="5736.7789,-1381.6182 5746.5028,-1377.4116 5736.278,-1374.6362 5736.7789,-1381.6182"/>
</g>
<!-- header_43 -->
<g id="node44" class="node">
<title>header_43</title>
<ellipse fill="none" stroke="#000000" cx="6483" cy="-1373.5024" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="6483" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_12&#45;&gt;header_43 -->
<g id="edge43" class="edge">
<title>section_12&#45;&gt;header_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6643.2078,-1448.734C6609.9234,-1433.1041 6559.0521,-1409.2156 6523.5929,-1392.5643"/>
<polygon fill="#000000" stroke="#000000" points="6525.019,-1389.3674 6514.4796,-1388.2848 6522.0435,-1395.7035 6525.019,-1389.3674"/>
</g>
<!-- block_44 -->
<g id="node45" class="node">
<title>block_44</title>
<ellipse fill="none" stroke="#000000" cx="6612" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="6612" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;72</text>
</g>
<!-- section_12&#45;&gt;block_44 -->
<g id="edge44" class="edge">
<title>section_12&#45;&gt;block_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6664.1581,-1446.604C6654.5704,-1433.1665 6641.3266,-1414.6048 6630.5837,-1399.5483"/>
<polygon fill="#000000" stroke="#000000" points="6633.2514,-1397.261 6624.5941,-1391.1535 6627.5531,-1401.3267 6633.2514,-1397.261"/>
</g>
<!-- block_45 -->
<g id="node46" class="node">
<title>block_45</title>
<ellipse fill="none" stroke="#000000" cx="6742" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="6742" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 73&#45;81</text>
</g>
<!-- section_12&#45;&gt;block_45 -->
<g id="edge45" class="edge">
<title>section_12&#45;&gt;block_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6689.8419,-1446.604C6699.4296,-1433.1665 6712.6734,-1414.6048 6723.4163,-1399.5483"/>
<polygon fill="#000000" stroke="#000000" points="6726.4469,-1401.3267 6729.4059,-1391.1535 6720.7486,-1397.261 6726.4469,-1401.3267"/>
</g>
<!-- block_46 -->
<g id="node47" class="node">
<title>block_46</title>
<ellipse fill="none" stroke="#000000" cx="7063" cy="-1373.5024" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="7063" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 82&#45;83</text>
</g>
<!-- section_12&#45;&gt;block_46 -->
<g id="edge46" class="edge">
<title>section_12&#45;&gt;block_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6729.0577,-1452.3163C6801.7775,-1435.1537 6933.1948,-1404.1378 7007.6431,-1386.5672"/>
<polygon fill="#000000" stroke="#000000" points="7008.8294,-1389.8835 7017.758,-1384.18 7007.2214,-1383.0707 7008.8294,-1389.8835"/>
</g>
<!-- block_47 -->
<g id="node48" class="node">
<title>block_47</title>
<ellipse fill="none" stroke="#000000" cx="7520" cy="-1373.5024" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="7520" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 84&#45;103</text>
</g>
<!-- section_12&#45;&gt;block_47 -->
<g id="edge47" class="edge">
<title>section_12&#45;&gt;block_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6742.0978,-1457.5676C6898.4542,-1440.6707 7293.9383,-1397.9321 7452.6067,-1380.7854"/>
<polygon fill="#000000" stroke="#000000" points="7453.1444,-1384.2477 7462.7104,-1379.6935 7452.3922,-1377.2883 7453.1444,-1384.2477"/>
</g>
<!-- header_56 -->
<g id="node57" class="node">
<title>header_56</title>
<ellipse fill="none" stroke="#000000" cx="7832" cy="-1373.5024" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="7832" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : define</text>
</g>
<!-- section_13&#45;&gt;header_56 -->
<g id="edge56" class="edge">
<title>section_13&#45;&gt;header_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8064.5107,-1450.3103C8019.097,-1436.225 7948.0884,-1413.8716 7887,-1393.2024 7883.2695,-1391.9402 7879.4055,-1390.6077 7875.5341,-1389.2553"/>
<polygon fill="#000000" stroke="#000000" points="7876.5627,-1385.9068 7865.9679,-1385.8811 7874.2342,-1392.5082 7876.5627,-1385.9068"/>
</g>
<!-- block_57 -->
<g id="node58" class="node">
<title>block_57</title>
<ellipse fill="none" stroke="#000000" cx="7962" cy="-1373.5024" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7962" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 104&#45;105</text>
</g>
<!-- section_13&#45;&gt;block_57 -->
<g id="edge57" class="edge">
<title>section_13&#45;&gt;block_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8083.3234,-1447.6807C8059.1276,-1432.8872 8023.8505,-1411.3184 7997.5661,-1395.2479"/>
<polygon fill="#000000" stroke="#000000" points="7999.3834,-1392.2567 7989.026,-1390.0264 7995.7319,-1398.2288 7999.3834,-1392.2567"/>
</g>
<!-- block_58 -->
<g id="node59" class="node">
<title>block_58</title>
<ellipse fill="none" stroke="#000000" cx="8111" cy="-1373.5024" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8111" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 106&#45;182</text>
</g>
<!-- section_13&#45;&gt;block_58 -->
<g id="edge58" class="edge">
<title>section_13&#45;&gt;block_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8111,-1446.167C8111,-1433.4892 8111,-1416.4053 8111,-1401.9878"/>
<polygon fill="#000000" stroke="#000000" points="8114.5001,-1401.5995 8111,-1391.5996 8107.5001,-1401.5996 8114.5001,-1401.5995"/>
</g>
<!-- block_59 -->
<g id="node60" class="node">
<title>block_59</title>
<ellipse fill="none" stroke="#000000" cx="8260" cy="-1373.5024" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8260" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 183&#45;194</text>
</g>
<!-- section_13&#45;&gt;block_59 -->
<g id="edge59" class="edge">
<title>section_13&#45;&gt;block_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8138.6766,-1447.6807C8162.8724,-1432.8872 8198.1495,-1411.3184 8224.4339,-1395.2479"/>
<polygon fill="#000000" stroke="#000000" points="8226.2681,-1398.2288 8232.974,-1390.0264 8222.6166,-1392.2567 8226.2681,-1398.2288"/>
</g>
<!-- block_60 -->
<g id="node61" class="node">
<title>block_60</title>
<ellipse fill="none" stroke="#000000" cx="8586" cy="-1373.5024" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="8586" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 195&#45;210</text>
</g>
<!-- section_13&#45;&gt;block_60 -->
<g id="edge60" class="edge">
<title>section_13&#45;&gt;block_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8170.1987,-1453.2488C8259.85,-1436.0546 8429.3805,-1403.5404 8521.8662,-1385.8026"/>
<polygon fill="#000000" stroke="#000000" points="8522.7725,-1389.1927 8531.9342,-1383.8717 8521.454,-1382.318 8522.7725,-1389.1927"/>
</g>
<!-- block_61 -->
<g id="node62" class="node">
<title>block_61</title>
<ellipse fill="none" stroke="#000000" cx="8870" cy="-1373.5024" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="8870" y="-1369.3024" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 211&#45;213</text>
</g>
<!-- section_13&#45;&gt;block_61 -->
<g id="edge61" class="edge">
<title>section_13&#45;&gt;block_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8178.6898,-1456.4779C8322.0365,-1439.2725 8654.9498,-1399.3141 8800.1656,-1381.8844"/>
<polygon fill="#000000" stroke="#000000" points="8800.78,-1385.3359 8810.2916,-1380.669 8799.9458,-1378.3857 8800.78,-1385.3359"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="562,-1287.4027 0,-1287.4027 0,-1217.0019 562,-1217.0019 562,-1287.4027"/>
<text text-anchor="middle" x="281" y="-1256.1023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The internal function @define creates a custom environment variable, neatly</text>
<text text-anchor="middle" x="281" y="-1240.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">sidestepping lua&#39;s pedantic insistance on prepending =local= to all values of </text>
<text text-anchor="middle" x="281" y="-1225.3023" font-family="Inconsolata" font-size="14.00" fill="#000000">significance. </text>
</g>
<!-- block_18&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_18&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1999.5052,-1360.0957C1990.9025,-1357.5444 1981.7196,-1355.2287 1973,-1353.8024 1665.4295,-1303.4911 880.2627,-1356.37 571,-1317.8024 521.6248,-1311.6449 468.3165,-1300.8237 421.0375,-1289.7238"/>
<polygon fill="#000000" stroke="#000000" points="421.5817,-1286.2558 411.0437,-1287.3526 419.9656,-1293.0667 421.5817,-1286.2558"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1121.5,-1271.5029 580.5,-1271.5029 580.5,-1232.9017 1121.5,-1232.9017 1121.5,-1271.5029"/>
<text text-anchor="middle" x="851" y="-1256.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">More relevantly, it constructs a full grammar, which will return a table of</text>
<text text-anchor="middle" x="851" y="-1241.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">type Node. </text>
</g>
<!-- block_19&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_19&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2128.8944,-1360.1719C2120.1585,-1357.6167 2110.839,-1355.2801 2102,-1353.8024 1675.6213,-1282.5201 1558.4222,-1375.5465 1130,-1317.8024 1060.3372,-1308.413 982.5986,-1289.4101 926.9105,-1274.2629"/>
<polygon fill="#000000" stroke="#000000" points="927.6944,-1270.8487 917.1248,-1271.5791 925.8429,-1277.5994 927.6944,-1270.8487"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="1680.5,-1286.8035 1139.5,-1286.8035 1139.5,-1217.601 1680.5,-1217.601 1680.5,-1286.8035"/>
<text text-anchor="middle" x="1410" y="-1271.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">If you stick to =lpeg= patterns, as you should, all array values will be of</text>
<text text-anchor="middle" x="1410" y="-1256.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">Node, as is intended. &#160;Captures will interpolate various other sorts of Lua</text>
<text text-anchor="middle" x="1410" y="-1241.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">values, which will induce halting in some places and silently corrupt</text>
<text text-anchor="middle" x="1410" y="-1225.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">execution in others. </text>
</g>
<!-- block_20&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>block_20&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2258.5159,-1360.2618C2249.882,-1357.7351 2240.7005,-1355.3878 2232,-1353.8024 1994.0549,-1310.4448 1928.1988,-1353.6031 1689,-1317.8024 1642.466,-1310.8377 1592.2422,-1300.0676 1547.4036,-1289.2537"/>
<polygon fill="#000000" stroke="#000000" points="1548.168,-1285.8377 1537.624,-1286.8741 1546.513,-1292.6392 1548.168,-1285.8377"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="2253.5,-1286.8035 1698.5,-1286.8035 1698.5,-1217.601 2253.5,-1217.601 2253.5,-1286.8035"/>
<text text-anchor="middle" x="1976" y="-1271.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">Though as yet poorly thought through, the [[elpatt module][./elpatt]] is</text>
<text text-anchor="middle" x="1976" y="-1256.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">intended to provide only those patterns which are allowed in Grammars, while</text>
<text text-anchor="middle" x="1976" y="-1241.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">expanding the scope of some favorites to properly respect utf&#45;8 and otherwise</text>
<text text-anchor="middle" x="1976" y="-1225.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">behave. </text>
</g>
<!-- block_21&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_21&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2386.4998,-1360.9757C2378.4008,-1358.5419 2369.9421,-1356.0504 2362,-1353.8024 2283.1938,-1331.497 2194.8781,-1308.1315 2122.6314,-1289.4391"/>
<polygon fill="#000000" stroke="#000000" points="2123.104,-1285.9463 2112.5464,-1286.8331 2121.3527,-1292.7237 2123.104,-1285.9463"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2736,-1270.2023 2272,-1270.2023 2272,-1234.2023 2736,-1234.2023 2736,-1270.2023"/>
<text text-anchor="middle" x="2504" y="-1248.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">There are examples of the format in the [[spec module][./spec]].</text>
</g>
<!-- block_22&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_22&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2549.1797,-1355.6042C2540.4621,-1335.6524 2526.2572,-1303.1419 2516.1024,-1279.9009"/>
<polygon fill="#000000" stroke="#000000" points="2519.2373,-1278.3337 2512.0262,-1270.5716 2512.8228,-1281.1365 2519.2373,-1278.3337"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2931.5,-1270.2023 2754.5,-1270.2023 2754.5,-1234.2023 2931.5,-1234.2023 2931.5,-1270.2023"/>
<text text-anchor="middle" x="2843" y="-1248.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">Special fields include:</text>
</g>
<!-- block_23&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>block_23&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2798.6728,-1355.6042C2807.2259,-1335.6524 2821.1628,-1303.1419 2831.1259,-1279.9009"/>
<polygon fill="#000000" stroke="#000000" points="2834.402,-1281.1417 2835.1253,-1270.5716 2827.9682,-1278.3836 2834.402,-1281.1417"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="3498,-1302.7024 2950,-1302.7024 2950,-1201.7021 3498,-1201.7021 3498,-1302.7024"/>
<text text-anchor="middle" x="3224" y="-1287.5024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;START : &#160;a string which must be the same as the starting rule.</text>
<text text-anchor="middle" x="3224" y="-1272.1023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;SUPPRESS : &#160;either a string or an array of strings. These rules will be</text>
<text text-anchor="middle" x="3224" y="-1256.7023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;removed from the Node. </text>
<text text-anchor="middle" x="3224" y="-1241.3023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;P : &#160;The lpeg P function. &#160;Recognizes a certain pattern.</text>
<text text-anchor="middle" x="3224" y="-1225.9022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;V : &#160;The lpeg V function. &#160;Used for non&#45;terminal rvalues in a grammar. </text>
</g>
<!-- block_24&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_24&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3093.9959,-1356.6362C3109.5131,-1344.171 3131.6074,-1326.4223 3153.1889,-1309.0857"/>
<polygon fill="#000000" stroke="#000000" points="3155.4995,-1311.7191 3161.1036,-1302.7277 3151.1156,-1306.2618 3155.4995,-1311.7191"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="4113.5,-1279.5027 3516.5,-1279.5027 3516.5,-1224.9019 4113.5,-1224.9019 4113.5,-1279.5027"/>
<text text-anchor="middle" x="3815" y="-1248.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;By default a node will inherit from the Node class. &#160;If you want custom behavior,</text>
<text text-anchor="middle" x="3815" y="-1233.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">you must pass in a table of metatable constructors.</text>
</g>
<!-- block_33&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_33&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4361.6889,-1360.7089C4353.2666,-1358.2156 4344.3803,-1355.7688 4336,-1353.8024 4242.1027,-1331.7703 4216.7375,-1335.8838 4122,-1317.8024 4064.4195,-1306.8127 4001.032,-1293.4779 3946.8808,-1281.7084"/>
<polygon fill="#000000" stroke="#000000" points="3947.3965,-1278.2387 3936.8806,-1279.5299 3945.9064,-1285.0783 3947.3965,-1278.2387"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="4700.5,-1317.9027 4131.5,-1317.9027 4131.5,-1186.5019 4700.5,-1186.5019 4700.5,-1317.9027"/>
<text text-anchor="middle" x="4416" y="-1302.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">That&#39;s a fairly specific beast. &#160;Any rule defined above will have an =id=</text>
<text text-anchor="middle" x="4416" y="-1287.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">corresonding to the name of the rule. &#160;Unless =SUPPRESS=ed, this will become</text>
<text text-anchor="middle" x="4416" y="-1271.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node. &#160;If the =metas= parameter has a key corresponding to =id=, then it</text>
<text text-anchor="middle" x="4416" y="-1256.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">must return a function taking two parameters:</text>
<text text-anchor="middle" x="4416" y="-1241.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;</text>
<text text-anchor="middle" x="4416" y="-1225.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; node : &#160;The node under construction, which under normal circumstances will</text>
<text text-anchor="middle" x="4416" y="-1210.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;already have the =first= and =last= fields.</text>
<text text-anchor="middle" x="4416" y="-1194.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; str &#160;: &#160;The entire str the grammar is parsing.</text>
</g>
<!-- block_34&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>block_34&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4514.5233,-1356.1231C4506.5247,-1347.6862 4496.3161,-1336.9184 4485.5156,-1325.5262"/>
<polygon fill="#000000" stroke="#000000" points="4487.7699,-1322.8169 4478.3499,-1317.9679 4482.69,-1327.633 4487.7699,-1322.8169"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="5287.5,-1270.2023 4718.5,-1270.2023 4718.5,-1234.2023 5287.5,-1234.2023 5287.5,-1270.2023"/>
<text text-anchor="middle" x="5003" y="-1248.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">Which must return that same node, decorated in whatever fashion is appropriate.</text>
</g>
<!-- block_35&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>block_35&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4905.3334,-1356.1231C4924.5826,-1335.6413 4956.7425,-1301.4219 4978.8671,-1277.8806"/>
<polygon fill="#000000" stroke="#000000" points="4981.6543,-1280.0256 4985.9523,-1270.3416 4976.5534,-1275.2317 4981.6543,-1280.0256"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="5882,-1279.4027 5306,-1279.4027 5306,-1225.0018 5882,-1225.0018 5882,-1279.4027"/>
<text text-anchor="middle" x="5594" y="-1264.1023" font-family="Inconsolata" font-size="14.00" fill="#000000">The node will not have a metatable at this point, and the function must attach a</text>
<text text-anchor="middle" x="5594" y="-1248.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">metatable with =__index= equal to some table which itself has the =__index=</text>
<text text-anchor="middle" x="5594" y="-1233.3023" font-family="Inconsolata" font-size="14.00" fill="#000000">Node as some recursive backstop.</text>
</g>
<!-- block_36&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>block_36&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5341.0497,-1359.1114C5385.0037,-1340.5343 5462.6873,-1307.7014 5520.4052,-1283.307"/>
<polygon fill="#000000" stroke="#000000" points="5522.0013,-1286.4323 5529.8498,-1279.3153 5519.2761,-1279.9845 5522.0013,-1286.4323"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="6427.5,-1279.5027 5900.5,-1279.5027 5900.5,-1224.9019 6427.5,-1224.9019 6427.5,-1279.5027"/>
<text text-anchor="middle" x="6164" y="-1264.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">You might say the return value must /inherit/ from Node, if we were using</text>
<text text-anchor="middle" x="6164" y="-1249.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">a language that did that sort of thing. </text>
</g>
<!-- block_37&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>block_37&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5839.8474,-1360.5212C5894.8973,-1342.1257 5997.2455,-1307.925 6072.2576,-1282.8589"/>
<polygon fill="#000000" stroke="#000000" points="6073.8141,-1286.0291 6082.1893,-1279.5402 6071.5955,-1279.39 6073.8141,-1286.0291"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="6500,-1270.2023 6446,-1270.2023 6446,-1234.2023 6500,-1234.2023 6500,-1270.2023"/>
</g>
<!-- block_44&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>block_44&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6575.3297,-1359.8441C6554.013,-1350.5045 6527.7449,-1336.432 6509,-1317.8024 6498.2062,-1307.075 6489.7527,-1292.4295 6483.7579,-1279.6978"/>
<polygon fill="#000000" stroke="#000000" points="6486.9039,-1278.158 6479.6548,-1270.4313 6480.5033,-1280.9922 6486.9039,-1278.158"/>
</g>
<!-- codeblock_49 -->
<g id="node50" class="node">
<title>codeblock_49</title>
<ellipse fill="none" stroke="#000000" cx="6595" cy="-1252.2023" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="6595" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 73&#45;78</text>
</g>
<!-- block_45&#45;&gt;codeblock_49 -->
<g id="edge49" class="edge">
<title>block_45&#45;&gt;codeblock_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6721.5603,-1356.6362C6696.286,-1335.7805 6653.088,-1300.1348 6624.2932,-1276.3742"/>
<polygon fill="#000000" stroke="#000000" points="6626.1588,-1273.3759 6616.2181,-1269.7108 6621.7035,-1278.7751 6626.1588,-1273.3759"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="7070,-1272.1044 6690,-1272.1044 6690,-1232.3002 7070,-1232.3002 7070,-1272.1044"/>
<text text-anchor="middle" x="6880" y="-1240.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">I like the dedication shown in this style of import.</text>
</g>
<!-- block_45&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>block_45&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6761.4793,-1356.3803C6784.4706,-1336.1713 6822.9656,-1302.3347 6849.8247,-1278.726"/>
<polygon fill="#000000" stroke="#000000" points="6852.2122,-1281.2873 6857.4124,-1272.0564 6847.5908,-1276.0296 6852.2122,-1281.2873"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="7419.5,-1270.2023 7088.5,-1270.2023 7088.5,-1234.2023 7419.5,-1234.2023 7419.5,-1270.2023"/>
<text text-anchor="middle" x="7254" y="-1248.7023" font-family="Inconsolata" font-size="14.00" fill="#000000">It&#39;s the kind of thing I&#39;d like to automate. </text>
</g>
<!-- block_46&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>block_46&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7088.3633,-1357.3947C7121.2439,-1336.5129 7178.8461,-1299.931 7216.7103,-1275.8842"/>
<polygon fill="#000000" stroke="#000000" points="7218.8483,-1278.6726 7225.4134,-1270.357 7215.0955,-1272.7636 7218.8483,-1278.6726"/>
</g>
<!-- codeblock_53 -->
<g id="node54" class="node">
<title>codeblock_53</title>
<ellipse fill="none" stroke="#000000" cx="7520" cy="-1252.2023" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="7520" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 84&#45;101</text>
</g>
<!-- block_47&#45;&gt;codeblock_53 -->
<g id="edge53" class="edge">
<title>block_47&#45;&gt;codeblock_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7520,-1355.3426C7520,-1335.6014 7520,-1303.7908 7520,-1280.7118"/>
<polygon fill="#000000" stroke="#000000" points="7523.5001,-1280.4862 7520,-1270.4863 7516.5001,-1280.4863 7523.5001,-1280.4862"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="7674,-1270.2023 7620,-1270.2023 7620,-1234.2023 7674,-1234.2023 7674,-1270.2023"/>
</g>
<!-- block_47&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>block_47&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7553.6653,-1358.2939C7572.2414,-1348.6671 7594.7642,-1334.8258 7611,-1317.8024 7621.5029,-1306.79 7629.9316,-1292.1203 7635.9853,-1279.4462"/>
<polygon fill="#000000" stroke="#000000" points="7639.2184,-1280.7909 7640.1466,-1270.2368 7632.8394,-1277.9085 7639.2184,-1280.7909"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="6715,-610.5015 6475,-610.5015 6475,-540.1007 6715,-540.1007 6715,-610.5015"/>
<text text-anchor="middle" x="6595" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="6595" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot; </text>
<text text-anchor="middle" x="6595" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
</g>
<!-- codeblock_49&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_49&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6595,-1234.0968C6595,-1145.358 6595,-755.2316 6595,-620.9219"/>
<polygon fill="#000000" stroke="#000000" points="6598.5001,-620.584 6595,-610.584 6591.5001,-620.5841 6598.5001,-620.584"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="7574.5,-702.7019 7215.5,-702.7019 7215.5,-447.9003 7574.5,-447.9003 7574.5,-702.7019"/>
<text text-anchor="middle" x="7395" y="-687.3013" font-family="Inconsolata" font-size="14.00" fill="#000000">local assert = assert</text>
<text text-anchor="middle" x="7395" y="-671.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local string, io = assert( string ), assert( io )</text>
<text text-anchor="middle" x="7395" y="-656.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = string.sub( assert( _VERSION ), &#45;4 )</text>
<text text-anchor="middle" x="7395" y="-641.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local _G = assert( _G )</text>
<text text-anchor="middle" x="7395" y="-625.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local error = assert( error )</text>
<text text-anchor="middle" x="7395" y="-610.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local pairs = assert( pairs )</text>
<text text-anchor="middle" x="7395" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local next = assert( next )</text>
<text text-anchor="middle" x="7395" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">local type = assert( type )</text>
<text text-anchor="middle" x="7395" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local tostring = assert( tostring )</text>
<text text-anchor="middle" x="7395" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local setmetatable = assert( setmetatable )</text>
<text text-anchor="middle" x="7395" y="-533.301" font-family="Inconsolata" font-size="14.00" fill="#000000">local setfenv </text>
<text text-anchor="middle" x="7395" y="-517.901" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfenv </text>
<text text-anchor="middle" x="7395" y="-502.501" font-family="Inconsolata" font-size="14.00" fill="#000000">if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="7395" y="-487.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local setfenv = assert( setfenv )</text>
<text text-anchor="middle" x="7395" y="-471.7009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local getfenv = assert( getfenv )</text>
<text text-anchor="middle" x="7395" y="-456.3009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_53&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>codeblock_53&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7516.6566,-1234.0968C7503.1618,-1161.02 7451.9237,-883.5547 7420.4061,-712.8805"/>
<polygon fill="#000000" stroke="#000000" points="7423.8044,-712.0086 7418.5465,-702.8105 7416.9208,-713.2798 7423.8044,-712.0086"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="7878,-1270.2023 7824,-1270.2023 7824,-1234.2023 7878,-1234.2023 7878,-1270.2023"/>
</g>
<!-- block_57&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>block_57&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7934.3709,-1357.154C7919.0987,-1347.159 7900.5348,-1333.3294 7887,-1317.8024 7877.0685,-1306.409 7868.7286,-1291.8224 7862.5849,-1279.2981"/>
<polygon fill="#000000" stroke="#000000" points="7865.7383,-1277.779 7858.3249,-1270.2098 7859.4,-1280.75 7865.7383,-1277.779"/>
</g>
<!-- codeblock_63 -->
<g id="node64" class="node">
<title>codeblock_63</title>
<ellipse fill="none" stroke="#000000" cx="7983" cy="-1252.2023" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7983" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 106&#45;181</text>
</g>
<!-- block_58&#45;&gt;codeblock_63 -->
<g id="edge63" class="edge">
<title>block_58&#45;&gt;codeblock_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8092.6607,-1356.1231C8070.7344,-1335.3445 8033.8886,-1300.4272 8009.0237,-1276.8639"/>
<polygon fill="#000000" stroke="#000000" points="8011.3875,-1274.282 8001.7215,-1269.9438 8006.5725,-1279.3629 8011.3875,-1274.282"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="8142,-1270.2023 8088,-1270.2023 8088,-1234.2023 8142,-1234.2023 8142,-1270.2023"/>
</g>
<!-- block_58&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>block_58&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8111.5988,-1355.3426C8112.2498,-1335.6014 8113.2988,-1303.7908 8114.0599,-1280.7118"/>
<polygon fill="#000000" stroke="#000000" points="8117.5655,-1280.5962 8114.3971,-1270.4863 8110.5693,-1280.3655 8117.5655,-1280.5962"/>
</g>
<!-- codeblock_66 -->
<g id="node67" class="node">
<title>codeblock_66</title>
<ellipse fill="none" stroke="#000000" cx="8255" cy="-1252.2023" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8255" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 183&#45;192</text>
</g>
<!-- block_59&#45;&gt;codeblock_66 -->
<g id="edge66" class="edge">
<title>block_59&#45;&gt;codeblock_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8259.2514,-1355.3426C8258.4377,-1335.6014 8257.1265,-1303.7908 8256.1752,-1280.7118"/>
<polygon fill="#000000" stroke="#000000" points="8259.6626,-1280.3336 8255.7537,-1270.4863 8252.6686,-1280.622 8259.6626,-1280.3336"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="8414,-1270.2023 8360,-1270.2023 8360,-1234.2023 8414,-1234.2023 8414,-1270.2023"/>
</g>
<!-- block_59&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>block_59&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8294.1049,-1358.0657C8312.5957,-1348.4489 8334.892,-1334.6918 8351,-1317.8024 8361.5029,-1306.79 8369.9316,-1292.1203 8375.9853,-1279.4462"/>
<polygon fill="#000000" stroke="#000000" points="8379.2184,-1280.7909 8380.1466,-1270.2368 8372.8394,-1277.9085 8379.2184,-1280.7909"/>
</g>
<!-- codeblock_69 -->
<g id="node70" class="node">
<title>codeblock_69</title>
<ellipse fill="none" stroke="#000000" cx="8586" cy="-1252.2023" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8586" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 195&#45;209</text>
</g>
<!-- block_60&#45;&gt;codeblock_69 -->
<g id="edge69" class="edge">
<title>block_60&#45;&gt;codeblock_69</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8586,-1355.3426C8586,-1335.6014 8586,-1303.7908 8586,-1280.7118"/>
<polygon fill="#000000" stroke="#000000" points="8589.5001,-1280.4862 8586,-1270.4863 8582.5001,-1280.4863 8589.5001,-1280.4862"/>
</g>
<!-- leaf_71 -->
<g id="node72" class="node">
<title>leaf_71</title>
<polygon fill="none" stroke="#c0c0c0" points="8745,-1270.2023 8691,-1270.2023 8691,-1234.2023 8745,-1234.2023 8745,-1270.2023"/>
</g>
<!-- block_60&#45;&gt;leaf_71 -->
<g id="edge71" class="edge">
<title>block_60&#45;&gt;leaf_71</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8622.0028,-1358.4383C8641.5172,-1348.9381 8665.0381,-1335.1735 8682,-1317.8024 8692.6317,-1306.9143 8701.0713,-1292.2552 8707.099,-1279.5559"/>
<polygon fill="#000000" stroke="#000000" points="8710.3414,-1280.8788 8711.2345,-1270.3217 8703.9529,-1278.0176 8710.3414,-1280.8788"/>
</g>
<!-- codeblock_72 -->
<g id="node73" class="node">
<title>codeblock_72</title>
<ellipse fill="none" stroke="#000000" cx="8870" cy="-1252.2023" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="8870" y="-1248.0023" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 211&#45;213</text>
</g>
<!-- block_61&#45;&gt;codeblock_72 -->
<g id="edge72" class="edge">
<title>block_61&#45;&gt;codeblock_72</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8870,-1355.3426C8870,-1335.6014 8870,-1303.7908 8870,-1280.7118"/>
<polygon fill="#000000" stroke="#000000" points="8873.5001,-1280.4862 8870,-1270.4863 8866.5001,-1280.4863 8873.5001,-1280.4862"/>
</g>
<!-- leaf_74 -->
<g id="node75" class="node">
<title>leaf_74</title>
<polygon fill="none" stroke="#c0c0c0" points="9029,-1270.2023 8975,-1270.2023 8975,-1234.2023 9029,-1234.2023 9029,-1270.2023"/>
</g>
<!-- block_61&#45;&gt;leaf_74 -->
<g id="edge74" class="edge">
<title>block_61&#45;&gt;leaf_74</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8906.0028,-1358.4383C8925.5172,-1348.9381 8949.0381,-1335.1735 8966,-1317.8024 8976.6317,-1306.9143 8985.0713,-1292.2552 8991.099,-1279.5559"/>
<polygon fill="#000000" stroke="#000000" points="8994.3414,-1280.8788 8995.2345,-1270.3217 8987.9529,-1278.0176 8994.3414,-1280.8788"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="8099,-1150.4033 7593,-1150.4033 7593,-.1989 8099,-.1989 8099,-1150.4033"/>
<text text-anchor="middle" x="7846" y="-1135.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_ast_node(id, first, t, last, str, metas, offset)</text>
<text text-anchor="middle" x="7846" y="-1120.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="7846" y="-1104.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.first = first + offset</text>
<text text-anchor="middle" x="7846" y="-1089.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.last &#160;= last + offset &#45; 1</text>
<text text-anchor="middle" x="7846" y="-1073.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.str &#160;&#160;= str</text>
<text text-anchor="middle" x="7846" y="-1058.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if metas[id] then</text>
<text text-anchor="middle" x="7846" y="-1043.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;t = metas[id](t, str)</text>
<text text-anchor="middle" x="7846" y="-1027.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;assert(t.id == id)</text>
<text text-anchor="middle" x="7846" y="-1012.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="7846" y="-996.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.id = id</text>
<text text-anchor="middle" x="7846" y="-981.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, {__index = Node,</text>
<text text-anchor="middle" x="7846" y="-966.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__tostring = Node.toString})</text>
<text text-anchor="middle" x="7846" y="-950.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="7846" y="-935.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.isNode, &quot;failed isNode: &quot; .. t.id)</text>
<text text-anchor="middle" x="7846" y="-919.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.str)</text>
<text text-anchor="middle" x="7846" y="-904.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return t</text>
<text text-anchor="middle" x="7846" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7846" y="-841.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; some useful/common lpeg patterns</text>
<text text-anchor="middle" x="7846" y="-826.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cp = L.Cp</text>
<text text-anchor="middle" x="7846" y="-810.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cc = L.Cc</text>
<text text-anchor="middle" x="7846" y="-795.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = L.Ct</text>
<text text-anchor="middle" x="7846" y="-780.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg1_str = L.Carg(1)</text>
<text text-anchor="middle" x="7846" y="-764.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg2_metas = L.Carg(2)</text>
<text text-anchor="middle" x="7846" y="-749.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg3_offset = L.Carg(3)</text>
<text text-anchor="middle" x="7846" y="-701.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; setup an environment where you can easily define lpeg grammars</text>
<text text-anchor="middle" x="7846" y="-686.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; with lots of syntax sugar</text>
<text text-anchor="middle" x="7846" y="-671.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, g, e)</text>
<text text-anchor="middle" x="7846" y="-655.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="7846" y="-640.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if e == nil then</text>
<text text-anchor="middle" x="7846" y="-624.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;e = V == &quot; 5.1&quot; and getfenv(func) or _G</text>
<text text-anchor="middle" x="7846" y="-609.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7846" y="-594.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="7846" y="-578.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="7846" y="-563.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="7846" y="-547.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function(name) g[1] = name end,</text>
<text text-anchor="middle" x="7846" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function(...)</text>
<text text-anchor="middle" x="7846" y="-517.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="7846" y="-501.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select(&#39;#&#39;, ...) do</text>
<text text-anchor="middle" x="7846" y="-486.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[select(i, ... )] = true</text>
<text text-anchor="middle" x="7846" y="-470.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7846" y="-455.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="7846" y="-440.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;V = L.V,</text>
<text text-anchor="middle" x="7846" y="-424.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;P = L.P,</text>
<text text-anchor="middle" x="7846" y="-409.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="7846" y="-377.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env_index, { __index = e })</text>
<text text-anchor="middle" x="7846" y="-362.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env, {</text>
<text text-anchor="middle" x="7846" y="-347.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="7846" y="-331.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="7846" y="-316.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="7846" y="-300.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = val</text>
<text text-anchor="middle" x="7846" y="-285.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7846" y="-270.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = (Cc(name) </text>
<text text-anchor="middle" x="7846" y="-254.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp() </text>
<text text-anchor="middle" x="7846" y="-239.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Ct(val)</text>
<text text-anchor="middle" x="7846" y="-223.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp()</text>
<text text-anchor="middle" x="7846" y="-208.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg1_str</text>
<text text-anchor="middle" x="7846" y="-193.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg2_metas)</text>
<text text-anchor="middle" x="7846" y="-177.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg3_offset / make_ast_node</text>
<text text-anchor="middle" x="7846" y="-162.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7846" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7846" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;})</text>
<text text-anchor="middle" x="7846" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="7846" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="7846" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="7846" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7846" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="7846" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="7846" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="7846" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_63&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>codeblock_63&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7979.3356,-1234.0968C7976.1252,-1218.2347 7970.9658,-1192.7426 7964.5015,-1160.8032"/>
<polygon fill="#000000" stroke="#000000" points="7967.8683,-1159.7944 7962.4541,-1150.6874 7961.0075,-1161.183 7967.8683,-1159.7944"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="8392.5,-641.0015 8117.5,-641.0015 8117.5,-509.6007 8392.5,-509.6007 8392.5,-641.0015"/>
<text text-anchor="middle" x="8255" y="-625.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function refineMetas(metas)</text>
<text text-anchor="middle" x="8255" y="-610.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for _,v in pairs(metas) do</text>
<text text-anchor="middle" x="8255" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not v[&quot;__tostring&quot;] then</text>
<text text-anchor="middle" x="8255" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;v[&quot;__tostring&quot;] = Node.toString</text>
<text text-anchor="middle" x="8255" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8255" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8255" y="-533.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return metas</text>
<text text-anchor="middle" x="8255" y="-517.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_66&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>codeblock_66&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8255,-1234.0968C8255,-1151.3218 8255,-806.3086 8255,-651.2988"/>
<polygon fill="#000000" stroke="#000000" points="8258.5001,-650.9202 8255,-640.9202 8251.5001,-650.9202 8258.5001,-650.9202"/>
</g>
<!-- leaf_70 -->
<g id="node71" class="node">
<title>leaf_70</title>
<polygon fill="none" stroke="#c0c0c0" points="8895.5,-679.5016 8410.5,-679.5016 8410.5,-471.1006 8895.5,-471.1006 8895.5,-679.5016"/>
<text text-anchor="middle" x="8653" y="-664.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="8653" y="-648.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(grammar_template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="8653" y="-633.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local metas = metas or {}</text>
<text text-anchor="middle" x="8653" y="-618.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, nil, metas)</text>
<text text-anchor="middle" x="8653" y="-602.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parse = function(str, offset)</text>
<text text-anchor="middle" x="8653" y="-587.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="8653" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return L.match(grammar, str, 1, str, metas, offset) &#45;&#45; other </text>
<text text-anchor="middle" x="8653" y="-556.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8653" y="-541.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return parse</text>
<text text-anchor="middle" x="8653" y="-525.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="8653" y="-510.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="8653" y="-494.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8653" y="-479.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_69&#45;&gt;leaf_70 -->
<g id="edge70" class="edge">
<title>codeblock_69&#45;&gt;leaf_70</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8587.7921,-1234.0968C8595.3633,-1157.6053 8625.0997,-857.1775 8641.6781,-689.686"/>
<polygon fill="#000000" stroke="#000000" points="8645.1753,-689.8868 8642.6774,-679.5907 8638.2093,-689.1973 8645.1753,-689.8868"/>
</g>
<!-- leaf_73 -->
<g id="node74" class="node">
<title>leaf_73</title>
<polygon fill="none" stroke="#c0c0c0" points="9000,-593.3011 8914,-593.3011 8914,-557.3011 9000,-557.3011 9000,-593.3011"/>
<text text-anchor="middle" x="8957" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_72&#45;&gt;leaf_73 -->
<g id="edge73" class="edge">
<title>codeblock_72&#45;&gt;leaf_73</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8877.6801,-1234.2256C8885.8779,-1214.2084 8898.5545,-1180.7025 8905,-1150.6022 8949.2571,-943.9234 8955.8873,-687.6161 8956.8485,-603.4849"/>
<polygon fill="#000000" stroke="#000000" points="8960.3488,-603.466 8956.9449,-593.4328 8953.3491,-603.3988 8960.3488,-603.466"/>
</g>
</g>
</svg>