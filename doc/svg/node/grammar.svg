<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1248pt" height="417pt"
 viewBox="0.00 0.00 1248.20 416.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 412.8004)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-412.8004 1244.1964,-412.8004 1244.1964,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="439.1964" cy="-390.8004" rx="42.1216" ry="18"/>
<text text-anchor="middle" x="439.1964" y="-386.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 41</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="439.1964" cy="-318.8004" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="439.1964" y="-314.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;41</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M439.1964,-372.6317C439.1964,-364.9313 439.1964,-355.7747 439.1964,-347.217"/>
<polygon fill="#000000" stroke="#000000" points="442.6965,-347.2136 439.1964,-337.2136 435.6965,-347.2137 442.6965,-347.2136"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="91.1964" cy="-246.8004" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="91.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M389.3365,-308.4845C330.4341,-296.2978 231.9292,-275.9175 164.3767,-261.9411"/>
<polygon fill="#000000" stroke="#000000" points="164.7294,-258.44 154.2276,-259.8413 163.3111,-265.2949 164.7294,-258.44"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="232.1964" cy="-246.8004" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="232.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M396.1427,-306.0798C362.3909,-295.7998 314.4009,-280.5029 273.1964,-264.8004 270.9899,-263.9595 268.7298,-263.0648 266.4599,-262.1408"/>
<polygon fill="#000000" stroke="#000000" points="267.7602,-258.8908 257.1853,-258.2408 265.0468,-265.3435 267.7602,-258.8908"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="355.1964" cy="-246.8004" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="355.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;10</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M419.2896,-301.7374C408.5676,-292.5472 395.1603,-281.0552 383.3835,-270.9607"/>
<polygon fill="#000000" stroke="#000000" points="385.4142,-268.0916 375.5438,-264.241 380.8587,-273.4064 385.4142,-268.0916"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="523.1964" cy="-246.8004" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="523.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 12&#45;21</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M459.1032,-301.7374C469.8251,-292.5472 483.2325,-281.0552 495.0093,-270.9607"/>
<polygon fill="#000000" stroke="#000000" points="497.5341,-273.4064 502.8489,-264.241 492.9786,-268.0916 497.5341,-273.4064"/>
</g>
<!-- codeblock_6 -->
<g id="node7" class="node">
<title>codeblock_6</title>
<ellipse fill="none" stroke="#000000" cx="801.1964" cy="-246.8004" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="801.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 24&#45;37</text>
</g>
<!-- section_1&#45;&gt;codeblock_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;codeblock_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M489.9121,-308.7133C553.0625,-296.153 661.2247,-274.6401 731.9629,-260.5706"/>
<polygon fill="#000000" stroke="#000000" points="732.9932,-263.9343 742.1183,-258.5507 731.6276,-257.0688 732.9932,-263.9343"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1085.1964" cy="-246.8004" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1085.1964" y="-242.6004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 39&#45;41</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M496.2412,-312.4424C611.5613,-299.5894 872.6711,-270.4874 1005.0423,-255.734"/>
<polygon fill="#000000" stroke="#000000" points="1005.5702,-259.1969 1015.121,-254.6106 1004.7948,-252.24 1005.5702,-259.1969"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="81.1964,-116.4002 27.1964,-116.4002 27.1964,-76.4002 81.1964,-76.4002 81.1964,-116.4002"/>
</g>
<!-- prose_3&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>prose_3&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M206.7258,-235.2827C201.611,-233.0649 196.2538,-230.8089 191.1964,-228.8004 146.9062,-211.2108 124.1456,-226.2438 90.1964,-192.8004 72.232,-175.1036 63.1333,-147.6148 58.5851,-126.5123"/>
<polygon fill="#000000" stroke="#000000" points="61.974,-125.6006 56.6487,-116.4413 55.0999,-126.9224 61.974,-125.6006"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="367.1964,-139.0012 99.1964,-139.0012 99.1964,-53.7991 367.1964,-53.7991 367.1964,-139.0012"/>
<text text-anchor="middle" x="233.1964" y="-124.0002" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="233.1964" y="-92.6002" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot; </text>
<text text-anchor="middle" x="233.1964" y="-77.2002" font-family="Inconsolata" font-size="14.00" fill="#000000">local define = require &quot;node/define&quot;</text>
<text text-anchor="middle" x="233.1964" y="-61.8002" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>codeblock_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M340.7223,-228.9569C324.3949,-208.8287 297.1186,-175.2028 274.1247,-146.8561"/>
<polygon fill="#000000" stroke="#000000" points="276.7834,-144.5778 267.7655,-139.0165 271.347,-148.9876 276.7834,-144.5778"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="660.6964,-162.1006 385.6964,-162.1006 385.6964,-30.6998 660.6964,-30.6998 660.6964,-162.1006"/>
<text text-anchor="middle" x="523.1964" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000">local function refineMetas(metas)</text>
<text text-anchor="middle" x="523.1964" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for _,v in pairs(metas) do</text>
<text text-anchor="middle" x="523.1964" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not v[&quot;__tostring&quot;] then</text>
<text text-anchor="middle" x="523.1964" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;v[&quot;__tostring&quot;] = Node.toString</text>
<text text-anchor="middle" x="523.1964" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="523.1964" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="523.1964" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return metas</text>
<text text-anchor="middle" x="523.1964" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>codeblock_5&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M523.1964,-228.6586C523.1964,-214.2924 523.1964,-193.1863 523.1964,-172.0345"/>
<polygon fill="#000000" stroke="#000000" points="526.6965,-172.0081 523.1964,-162.0081 519.6965,-172.0082 526.6965,-172.0081"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="1135.6964,-192.7007 678.6964,-192.7007 678.6964,-.0997 1135.6964,-.0997 1135.6964,-192.7007"/>
<text text-anchor="middle" x="907.1964" y="-177.6004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="907.1964" y="-162.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(grammar_template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="907.1964" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local metas = metas or {}</text>
<text text-anchor="middle" x="907.1964" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define.define(grammar_template, nil, metas)</text>
<text text-anchor="middle" x="907.1964" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parse = function(str)</text>
<text text-anchor="middle" x="907.1964" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return L.match(grammar, str, 1, str, metas) &#45;&#45; other </text>
<text text-anchor="middle" x="907.1964" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="907.1964" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return parse</text>
<text text-anchor="middle" x="907.1964" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="907.1964" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="907.1964" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="907.1964" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_6&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>codeblock_6&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M813.7722,-228.9569C819.1912,-221.2681 825.9982,-211.6099 833.4556,-201.0287"/>
<polygon fill="#000000" stroke="#000000" points="836.3729,-202.9649 839.273,-192.7747 830.6512,-198.9323 836.3729,-202.9649"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1240.1964,-114.4002 1154.1964,-114.4002 1154.1964,-78.4002 1240.1964,-78.4002 1240.1964,-114.4002"/>
<text text-anchor="middle" x="1197.1964" y="-92.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>codeblock_7&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1108.0349,-229.4308C1120.0424,-219.5571 1134.4552,-206.4608 1145.1964,-192.8004 1161.9639,-171.4759 1176.1915,-143.9825 1185.5031,-123.8174"/>
<polygon fill="#000000" stroke="#000000" points="1188.7544,-125.1213 1189.6689,-114.566 1182.3716,-122.2472 1188.7544,-125.1213"/>
</g>
</g>
</svg>