<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="8482pt" height="1154pt"
 viewBox="0.00 0.00 8482.00 1154.40" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1150.4011)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1150.4011 8478,-1150.4011 8478,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="470" cy="-1128.4011" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="470" y="-1124.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 184</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="470" cy="-1056.4011" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="470" y="-1052.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;15</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M470,-1110.2325C470,-1102.5321 470,-1093.3755 470,-1084.8178"/>
<polygon fill="#000000" stroke="#000000" points="473.5001,-1084.8144 470,-1074.8144 466.5001,-1084.8144 473.5001,-1084.8144"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="268" cy="-984.4011" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="268" y="-980.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M431.0524,-1042.5188C400.0334,-1031.4625 356.2653,-1015.862 321.8845,-1003.6075"/>
<polygon fill="#000000" stroke="#000000" points="323.0494,-1000.3071 312.4547,-1000.2464 320.6991,-1006.9007 323.0494,-1000.3071"/>
</g>
<!-- prose_3 -->
<g id="node4" class="node">
<title>prose_3</title>
<ellipse fill="none" stroke="#000000" cx="409" cy="-984.4011" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="409" y="-980.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_1&#45;&gt;prose_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;prose_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M454.9213,-1038.6034C447.3139,-1029.6241 437.9694,-1018.5945 429.7003,-1008.8342"/>
<polygon fill="#000000" stroke="#000000" points="432.2035,-1006.3743 423.0688,-1001.007 426.8626,-1010.8993 432.2035,-1006.3743"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="532" cy="-984.4011" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="532" y="-980.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;13</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M485.3258,-1038.6034C492.7779,-1029.9494 501.8698,-1019.3911 510.0427,-1009.9"/>
<polygon fill="#000000" stroke="#000000" points="512.7625,-1012.1052 516.6356,-1002.2437 507.4581,-1007.5375 512.7625,-1012.1052"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="864" cy="-984.4011" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="864" y="-980.2011" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 16&#45;83</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M521.9138,-1046.9143C593.2074,-1033.8861 721.3883,-1010.4621 798.9826,-996.2825"/>
<polygon fill="#000000" stroke="#000000" points="799.9106,-999.6709 809.1185,-994.4302 798.6522,-992.785 799.9106,-999.6709"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="401,-884.501 347,-884.501 347,-844.501 401,-844.501 401,-884.501"/>
</g>
<!-- prose_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>prose_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M403.7601,-966.4509C398.2036,-947.4158 389.3332,-917.0281 382.7202,-894.374"/>
<polygon fill="#000000" stroke="#000000" points="386.0227,-893.1966 379.8607,-884.578 379.3031,-895.1582 386.0227,-893.1966"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="645,-930.3014 419,-930.3014 419,-798.7006 645,-798.7006 645,-930.3014"/>
<text text-anchor="middle" x="532" y="-915.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;node/elpeg&quot;</text>
<text text-anchor="middle" x="532" y="-883.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="532" y="-868.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local setfenv </text>
<text text-anchor="middle" x="532" y="-853.001" font-family="Inconsolata" font-size="14.00" fill="#000000">if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="532" y="-837.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setfenv = setfenv</text>
<text text-anchor="middle" x="532" y="-822.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( setfenv )</text>
<text text-anchor="middle" x="532" y="-806.8009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>codeblock_4&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M532,-966.1909C532,-958.8976 532,-949.9683 532,-940.459"/>
<polygon fill="#000000" stroke="#000000" points="535.5001,-940.3838 532,-930.3838 528.5001,-940.3839 535.5001,-940.3838"/>
</g>
<!-- header_8 -->
<g id="node9" class="node">
<title>header_8</title>
<ellipse fill="none" stroke="#000000" cx="709" cy="-864.501" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="709" y="-860.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : define</text>
</g>
<!-- section_5&#45;&gt;header_8 -->
<g id="edge8" class="edge">
<title>section_5&#45;&gt;header_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M828.6132,-969.037C808.8039,-959.5038 784.2884,-946.0914 765,-930.4011 750.7642,-918.8209 737.3565,-903.2763 727.2314,-890.1926"/>
<polygon fill="#000000" stroke="#000000" points="729.8868,-887.9005 721.076,-882.0165 724.2944,-892.1107 729.8868,-887.9005"/>
</g>
<!-- prose_9 -->
<g id="node10" class="node">
<title>prose_9</title>
<ellipse fill="none" stroke="#000000" cx="806" cy="-864.501" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="806" y="-860.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_5&#45;&gt;prose_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;prose_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M855.3168,-966.4509C845.6941,-946.5584 830.0738,-914.2674 818.9933,-891.3614"/>
<polygon fill="#000000" stroke="#000000" points="822.0586,-889.6606 814.5532,-882.1826 815.7572,-892.7088 822.0586,-889.6606"/>
</g>
<!-- section_10 -->
<g id="node11" class="node">
<title>section_10</title>
<ellipse fill="none" stroke="#000000" cx="922" cy="-864.501" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="922" y="-860.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 22&#45;33</text>
</g>
<!-- section_5&#45;&gt;section_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;section_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M872.6832,-966.4509C882.2506,-946.6727 897.7468,-914.6382 908.8152,-891.7573"/>
<polygon fill="#000000" stroke="#000000" points="912.0535,-893.1002 913.2575,-882.574 905.752,-890.0519 912.0535,-893.1002"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="1999" cy="-864.501" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1999" y="-860.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 34&#45;83</text>
</g>
<!-- section_5&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M925.425,-977.9123C1119.565,-957.4035 1719.3575,-894.0421 1927.2079,-872.085"/>
<polygon fill="#000000" stroke="#000000" points="1927.8187,-875.5401 1937.3957,-871.0088 1927.0833,-868.5788 1927.8187,-875.5401"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="6099" cy="-864.501" rx="70.655" ry="18"/>
<text text-anchor="middle" x="6099" y="-860.301" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 84&#45;184</text>
</g>
<!-- section_5&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M929.7151,-982.896C1486.2666,-970.149 5405.0659,-880.3946 6018.3519,-866.3481"/>
<polygon fill="#000000" stroke="#000000" points="6018.5069,-869.8456 6028.4241,-866.1175 6018.3466,-862.8474 6018.5069,-869.8456"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="654,-762.5012 134,-762.5012 134,-675.9006 654,-675.9006 654,-762.5012"/>
<text text-anchor="middle" x="394" y="-715.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;This is going to be a chopped&#45;and&#45;screwed version of epnf. &#160;Now that I</text>
<text text-anchor="middle" x="394" y="-700.0009" font-family="Inconsolata" font-size="14.00" fill="#000000">actually understand what it does.</text>
</g>
<!-- prose_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>prose_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M799.3518,-846.8348C792.718,-831.6729 781.0449,-810.4477 764,-798.6009 751.582,-789.97 700.2338,-777.2764 639.5655,-764.5591"/>
<polygon fill="#000000" stroke="#000000" points="640.2563,-761.128 629.7532,-762.5185 638.831,-767.9813 640.2563,-761.128"/>
</g>
<!-- header_14 -->
<g id="node15" class="node">
<title>header_14</title>
<ellipse fill="none" stroke="#000000" cx="731" cy="-719.2009" rx="58.5359" ry="18"/>
<text text-anchor="middle" x="731" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : problems</text>
</g>
<!-- section_10&#45;&gt;header_14 -->
<g id="edge14" class="edge">
<title>section_10&#45;&gt;header_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M903.4265,-847.056C888.5671,-833.379 866.983,-814.1281 847,-798.6009 820.5136,-778.0205 789.0313,-756.6522 765.552,-741.2741"/>
<polygon fill="#000000" stroke="#000000" points="767.2623,-738.2112 756.9723,-735.6878 763.4427,-744.0773 767.2623,-738.2112"/>
</g>
<!-- prose_15 -->
<g id="node16" class="node">
<title>prose_15</title>
<ellipse fill="none" stroke="#000000" cx="840" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="840" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_15 -->
<g id="edge15" class="edge">
<title>section_10&#45;&gt;prose_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M911.9452,-846.6844C897.6669,-821.3839 871.4178,-774.8718 854.8812,-745.5696"/>
<polygon fill="#000000" stroke="#000000" points="857.8439,-743.6981 849.8809,-736.7094 851.7477,-747.1385 857.8439,-743.6981"/>
</g>
<!-- prose_16 -->
<g id="node17" class="node">
<title>prose_16</title>
<ellipse fill="none" stroke="#000000" cx="922" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="922" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_16 -->
<g id="edge16" class="edge">
<title>section_10&#45;&gt;prose_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M922,-846.3924C922,-821.5945 922,-776.8172 922,-747.552"/>
<polygon fill="#000000" stroke="#000000" points="925.5001,-747.5376 922,-737.5377 918.5001,-747.5377 925.5001,-747.5376"/>
</g>
<!-- prose_17 -->
<g id="node18" class="node">
<title>prose_17</title>
<ellipse fill="none" stroke="#000000" cx="1004" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1004" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_10&#45;&gt;prose_17 -->
<g id="edge17" class="edge">
<title>section_10&#45;&gt;prose_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M932.0548,-846.6844C946.3331,-821.3839 972.5822,-774.8718 989.1188,-745.5696"/>
<polygon fill="#000000" stroke="#000000" points="992.2523,-747.1385 994.1191,-736.7094 986.1561,-743.6981 992.2523,-747.1385"/>
</g>
<!-- header_21 -->
<g id="node22" class="node">
<title>header_21</title>
<ellipse fill="none" stroke="#000000" cx="1707" cy="-719.2009" rx="77.8797" ry="18"/>
<text text-anchor="middle" x="1707" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : makeAstNode</text>
</g>
<!-- section_11&#45;&gt;header_21 -->
<g id="edge21" class="edge">
<title>section_11&#45;&gt;header_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1967.0353,-848.6297C1926.6986,-828.5976 1855.1936,-793.073 1794,-762.6009 1779.3744,-755.3179 1763.3708,-747.3377 1749.1222,-740.2286"/>
<polygon fill="#000000" stroke="#000000" points="1750.555,-737.0321 1740.0444,-735.6989 1747.4295,-743.2956 1750.555,-737.0321"/>
</g>
<!-- prose_22 -->
<g id="node23" class="node">
<title>prose_22</title>
<ellipse fill="none" stroke="#000000" cx="1835" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1835" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_22 -->
<g id="edge22" class="edge">
<title>section_11&#45;&gt;prose_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1976.5377,-847.2429C1951.3374,-827.5764 1909.5921,-794.0739 1876,-762.6009 1869.3673,-756.3866 1862.468,-749.3375 1856.2629,-742.7546"/>
<polygon fill="#000000" stroke="#000000" points="1858.7256,-740.2631 1849.3552,-735.3189 1853.5972,-745.0275 1858.7256,-740.2631"/>
</g>
<!-- prose_23 -->
<g id="node24" class="node">
<title>prose_23</title>
<ellipse fill="none" stroke="#000000" cx="1917" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1917" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_23 -->
<g id="edge23" class="edge">
<title>section_11&#45;&gt;prose_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1988.9452,-846.6844C1974.6669,-821.3839 1948.4178,-774.8718 1931.8812,-745.5696"/>
<polygon fill="#000000" stroke="#000000" points="1934.8439,-743.6981 1926.8809,-736.7094 1928.7477,-747.1385 1934.8439,-743.6981"/>
</g>
<!-- prose_24 -->
<g id="node25" class="node">
<title>prose_24</title>
<ellipse fill="none" stroke="#000000" cx="1999" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="1999" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_24 -->
<g id="edge24" class="edge">
<title>section_11&#45;&gt;prose_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1999,-846.3924C1999,-821.5945 1999,-776.8172 1999,-747.552"/>
<polygon fill="#000000" stroke="#000000" points="2002.5001,-747.5376 1999,-737.5377 1995.5001,-747.5377 2002.5001,-747.5376"/>
</g>
<!-- prose_25 -->
<g id="node26" class="node">
<title>prose_25</title>
<ellipse fill="none" stroke="#000000" cx="2144" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2144" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_25 -->
<g id="edge25" class="edge">
<title>section_11&#45;&gt;prose_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2016.4904,-846.9744C2042.627,-820.7837 2091.9026,-771.4061 2120.9491,-742.2995"/>
<polygon fill="#000000" stroke="#000000" points="2123.6342,-744.5638 2128.2205,-735.013 2118.6793,-739.6191 2123.6342,-744.5638"/>
</g>
<!-- prose_26 -->
<g id="node27" class="node">
<title>prose_26</title>
<ellipse fill="none" stroke="#000000" cx="2522" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2522" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_26 -->
<g id="edge26" class="edge">
<title>section_11&#45;&gt;prose_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2045.4128,-851.6066C2147.3226,-823.294 2389.0677,-756.1322 2483.3771,-729.9311"/>
<polygon fill="#000000" stroke="#000000" points="2484.3869,-733.2832 2493.085,-727.234 2482.5131,-726.5387 2484.3869,-733.2832"/>
</g>
<!-- prose_27 -->
<g id="node28" class="node">
<title>prose_27</title>
<ellipse fill="none" stroke="#000000" cx="2963" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="2963" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_11&#45;&gt;prose_27 -->
<g id="edge27" class="edge">
<title>section_11&#45;&gt;prose_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2056.7731,-855.7931C2234.2671,-829.0401 2768.8563,-748.4634 2921.7452,-725.4191"/>
<polygon fill="#000000" stroke="#000000" points="2922.3039,-728.8745 2931.6705,-723.9231 2921.2605,-721.9527 2922.3039,-728.8745"/>
</g>
<!-- codeblock_28 -->
<g id="node29" class="node">
<title>codeblock_28</title>
<ellipse fill="none" stroke="#000000" cx="3449" cy="-719.2009" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="3449" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 58&#45;81</text>
</g>
<!-- section_11&#45;&gt;codeblock_28 -->
<g id="edge28" class="edge">
<title>section_11&#45;&gt;codeblock_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2060.8408,-858.3041C2292.0816,-835.1322 3105.9701,-753.5749 3367.455,-727.3723"/>
<polygon fill="#000000" stroke="#000000" points="3368.0354,-730.8317 3377.6366,-726.352 3367.3374,-723.8666 3368.0354,-730.8317"/>
</g>
<!-- header_36 -->
<g id="node37" class="node">
<title>header_36</title>
<ellipse fill="none" stroke="#000000" cx="5427" cy="-719.2009" rx="76.9365" ry="18"/>
<text text-anchor="middle" x="5427" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : define, proper</text>
</g>
<!-- section_12&#45;&gt;header_36 -->
<g id="edge36" class="edge">
<title>section_12&#45;&gt;header_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6031.0759,-859.2324C5920.2308,-849.1975 5694.5975,-822.7332 5513,-762.6009 5496.3026,-757.0719 5478.8097,-748.7608 5463.9931,-740.8867"/>
<polygon fill="#000000" stroke="#000000" points="5465.6008,-737.777 5455.1445,-736.0692 5462.2537,-743.9249 5465.6008,-737.777"/>
</g>
<!-- prose_37 -->
<g id="node38" class="node">
<title>prose_37</title>
<ellipse fill="none" stroke="#000000" cx="5554" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5554" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_37 -->
<g id="edge37" class="edge">
<title>section_12&#45;&gt;prose_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6035.394,-856.4031C5917.7324,-840.6468 5671.2263,-803.7788 5596,-762.6009 5587.3544,-757.8684 5579.3952,-750.7598 5572.7839,-743.6582"/>
<polygon fill="#000000" stroke="#000000" points="5575.3785,-741.3081 5566.1704,-736.0677 5570.1007,-745.9066 5575.3785,-741.3081"/>
</g>
<!-- codeblock_38 -->
<g id="node39" class="node">
<title>codeblock_38</title>
<ellipse fill="none" stroke="#000000" cx="5682" cy="-719.2009" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="5682" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 94&#45;96</text>
</g>
<!-- section_12&#45;&gt;codeblock_38 -->
<g id="edge38" class="edge">
<title>section_12&#45;&gt;codeblock_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6048.9255,-851.7786C5983.4939,-834.5368 5865.8462,-801.4076 5769,-762.6009 5753.1911,-756.2662 5736.3291,-748.1831 5721.6999,-740.7138"/>
<polygon fill="#000000" stroke="#000000" points="5722.9317,-737.4103 5712.4424,-735.9187 5719.7121,-743.6259 5722.9317,-737.4103"/>
</g>
<!-- prose_39 -->
<g id="node40" class="node">
<title>prose_39</title>
<ellipse fill="none" stroke="#000000" cx="5810" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5810" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_39 -->
<g id="edge39" class="edge">
<title>section_12&#45;&gt;prose_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6050.314,-851.2246C5998.0074,-835.4854 5913.9261,-805.8213 5851,-762.6009 5843.3851,-757.3707 5836.103,-750.5219 5829.8449,-743.8155"/>
<polygon fill="#000000" stroke="#000000" points="5832.2656,-741.2702 5823.0103,-736.1137 5827.0299,-745.9164 5832.2656,-741.2702"/>
</g>
<!-- prose_40 -->
<g id="node41" class="node">
<title>prose_40</title>
<ellipse fill="none" stroke="#000000" cx="5892" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="5892" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_40 -->
<g id="edge40" class="edge">
<title>section_12&#45;&gt;prose_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6067.6826,-848.2281C6033.3158,-829.6898 5977.2829,-797.4247 5934,-762.6009 5926.8365,-756.8374 5919.6527,-749.9303 5913.303,-743.3392"/>
<polygon fill="#000000" stroke="#000000" points="5915.6705,-740.7467 5906.2833,-735.8344 5910.5583,-745.5285 5915.6705,-740.7467"/>
</g>
<!-- codeblock_41 -->
<g id="node42" class="node">
<title>codeblock_41</title>
<ellipse fill="none" stroke="#000000" cx="6030" cy="-719.2009" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="6030" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 104&#45;129</text>
</g>
<!-- section_12&#45;&gt;codeblock_41 -->
<g id="edge41" class="edge">
<title>section_12&#45;&gt;codeblock_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6090.4006,-846.3924C6078.5213,-821.3769 6056.987,-776.0301 6043.0993,-746.7855"/>
<polygon fill="#000000" stroke="#000000" points="6046.1591,-745.0695 6038.7078,-737.5377 6039.8359,-748.0723 6046.1591,-745.0695"/>
</g>
<!-- prose_42 -->
<g id="node43" class="node">
<title>prose_42</title>
<ellipse fill="none" stroke="#000000" cx="6168" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6168" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_42 -->
<g id="edge42" class="edge">
<title>section_12&#45;&gt;prose_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6107.5994,-846.3924C6119.6086,-821.1035 6141.4848,-775.0365 6155.3532,-745.8324"/>
<polygon fill="#000000" stroke="#000000" points="6158.5955,-747.1639 6159.7236,-736.6293 6152.2722,-744.1611 6158.5955,-747.1639"/>
</g>
<!-- prose_43 -->
<g id="node44" class="node">
<title>prose_43</title>
<ellipse fill="none" stroke="#000000" cx="6385" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6385" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_43 -->
<g id="edge43" class="edge">
<title>section_12&#45;&gt;prose_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6130.6998,-848.3962C6185.2806,-820.6668 6296.4751,-764.1753 6351.9645,-735.9843"/>
<polygon fill="#000000" stroke="#000000" points="6353.6838,-739.0367 6361.0139,-731.3868 6350.5132,-732.7959 6353.6838,-739.0367"/>
</g>
<!-- prose_44 -->
<g id="node45" class="node">
<title>prose_44</title>
<ellipse fill="none" stroke="#000000" cx="6712" cy="-719.2009" rx="32.4585" ry="18"/>
<text text-anchor="middle" x="6712" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">prose</text>
</g>
<!-- section_12&#45;&gt;prose_44 -->
<g id="edge44" class="edge">
<title>section_12&#45;&gt;prose_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6150.7357,-852.238C6270.6947,-823.804 6565.7095,-753.8763 6672.5551,-728.5505"/>
<polygon fill="#000000" stroke="#000000" points="6673.3723,-731.9539 6682.2954,-726.2418 6671.7578,-725.1426 6673.3723,-731.9539"/>
</g>
<!-- block_45 -->
<g id="node46" class="node">
<title>block_45</title>
<ellipse fill="none" stroke="#000000" cx="7024" cy="-719.2009" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7024" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 138&#45;138</text>
</g>
<!-- section_12&#45;&gt;block_45 -->
<g id="edge45" class="edge">
<title>section_12&#45;&gt;block_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6159.424,-855.1737C6274.8124,-837.3426 6534.5048,-797.1184 6753,-762.6009 6822.6724,-751.5942 6902.3866,-738.8045 6957.231,-729.9744"/>
<polygon fill="#000000" stroke="#000000" points="6957.858,-733.4186 6967.1742,-728.3731 6956.7449,-726.5077 6957.858,-733.4186"/>
</g>
<!-- codeblock_46 -->
<g id="node47" class="node">
<title>codeblock_46</title>
<ellipse fill="none" stroke="#000000" cx="7366" cy="-719.2009" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7366" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 139&#45;167</text>
</g>
<!-- section_12&#45;&gt;codeblock_46 -->
<g id="edge46" class="edge">
<title>section_12&#45;&gt;codeblock_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6166.4637,-859.0242C6327.9048,-845.6136 6749.0932,-808.825 7099,-762.6009 7163.6245,-754.0637 7236.6637,-742.0254 7289.994,-732.7923"/>
<polygon fill="#000000" stroke="#000000" points="7290.7994,-736.2049 7300.0522,-731.0438 7289.6004,-729.3084 7290.7994,-736.2049"/>
</g>
<!-- codeblock_47 -->
<g id="node48" class="node">
<title>codeblock_47</title>
<ellipse fill="none" stroke="#000000" cx="7824" cy="-719.2009" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7824" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 169&#45;180</text>
</g>
<!-- section_12&#45;&gt;codeblock_47 -->
<g id="edge47" class="edge">
<title>section_12&#45;&gt;codeblock_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6167.8812,-860.4435C6368.007,-848.4197 6966.6177,-810.79 7462,-762.6009 7557.67,-753.2945 7667.2183,-739.7575 7740.5157,-730.2838"/>
<polygon fill="#000000" stroke="#000000" points="7741.1454,-733.7316 7750.6125,-728.9749 7740.2454,-726.7897 7741.1454,-733.7316"/>
</g>
<!-- codeblock_48 -->
<g id="node49" class="node">
<title>codeblock_48</title>
<ellipse fill="none" stroke="#000000" cx="8224" cy="-719.2009" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8224" y="-715.0009" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 182&#45;184</text>
</g>
<!-- section_12&#45;&gt;codeblock_48 -->
<g id="edge48" class="edge">
<title>section_12&#45;&gt;codeblock_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6169.4756,-862.7362C6412.8332,-856.1781 7240.1834,-830.0223 7920,-762.6009 7997.267,-754.9379 8085.0111,-741.9471 8146.3027,-732.1708"/>
<polygon fill="#000000" stroke="#000000" points="8146.9672,-735.609 8156.2867,-730.5694 8145.8585,-728.6974 8146.9672,-735.609"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="226,-455.8019 0,-455.8019 0,-399.9989 226,-399.9989 226,-455.8019"/>
<text text-anchor="middle" x="113" y="-408.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45; We&#39;re gathering stuff twice.</text>
</g>
<!-- prose_15&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>prose_15&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M828.8455,-702.1698C821.5806,-692.6278 811.1984,-681.5255 799,-675.8008 685.3088,-622.4459 341.6665,-706.0934 235,-639.8008 171.587,-600.3901 137.7215,-515.1103 122.7354,-465.5924"/>
<polygon fill="#000000" stroke="#000000" points="126.0662,-464.5119 119.9034,-455.8939 119.3468,-466.4741 126.0662,-464.5119"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="715.5,-463.1008 244.5,-463.1008 244.5,-392.7 715.5,-392.7 715.5,-463.1008"/>
<text text-anchor="middle" x="480" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;The pattern of passing the string around is a good one.</text>
<text text-anchor="middle" x="480" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;doing a match&#45;time capture is therefore not necessary, we </text>
<text text-anchor="middle" x="480" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;should slice the value off the string. </text>
</g>
<!-- prose_16&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>prose_16&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M910.1373,-702.4418C902.7664,-693.2388 892.5164,-682.3888 881,-675.8008 818.8603,-640.2538 787.818,-672.2386 724,-639.8008 639.968,-597.0886 561.139,-519.1695 516.8782,-470.6529"/>
<polygon fill="#000000" stroke="#000000" points="519.3785,-468.1995 510.0759,-463.1286 514.1859,-472.8938 519.3785,-468.1995"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1274.5,-463.1008 733.5,-463.1008 733.5,-392.7 1274.5,-392.7 1274.5,-463.1008"/>
<text text-anchor="middle" x="1004" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45; &#160;This means we need to pass in an optional offset, in case we&#39;re</text>
<text text-anchor="middle" x="1004" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;working on a substring. &#160;I need the Grammar class to be sufficiently</text>
<text text-anchor="middle" x="1004" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;general for my own purposes, and the Prose class needs the offset.</text>
</g>
<!-- prose_17&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>prose_17&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1004,-700.9787C1004,-656.0254 1004,-538.7594 1004,-473.4634"/>
<polygon fill="#000000" stroke="#000000" points="1007.5001,-473.0629 1004,-463.063 1000.5001,-473.063 1007.5001,-473.0629"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1491,-455.8019 1293,-455.8019 1293,-399.9989 1491,-399.9989 1491,-455.8019"/>
<text text-anchor="middle" x="1392" y="-408.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;Takes a bunch of params:</text>
</g>
<!-- prose_22&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>prose_22&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1823.3814,-701.9882C1816.0919,-692.6339 1805.8419,-681.7839 1794,-675.8008 1676.5028,-616.436 1607.8522,-715.2838 1500,-639.8008 1440.783,-598.3564 1412.0527,-514.5137 1399.804,-465.6331"/>
<polygon fill="#000000" stroke="#000000" points="1403.172,-464.6684 1397.4354,-455.761 1396.3652,-466.3016 1403.172,-464.6684"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="1868.5,-494.3012 1509.5,-494.3012 1509.5,-361.4996 1868.5,-361.4996 1868.5,-494.3012"/>
<text text-anchor="middle" x="1689" y="-462.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; id : &#160;Name of the rule</text>
<text text-anchor="middle" x="1689" y="-447.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; first : &#160;First position</text>
<text text-anchor="middle" x="1689" y="-432.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; t &#160;&#160;&#160;&#160;: &#160;Table, which may contain other Nodes</text>
<text text-anchor="middle" x="1689" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; last &#160;: &#160;Last position</text>
<text text-anchor="middle" x="1689" y="-401.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; metatables : &#160;The metatable collection</text>
<text text-anchor="middle" x="1689" y="-385.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; str &#160;&#160;: &#160;The string we&#39;re parsing</text>
</g>
<!-- prose_23&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>prose_23&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1904.0885,-702.7047C1874.4874,-664.8853 1800.2055,-569.9803 1747.2357,-502.3042"/>
<polygon fill="#000000" stroke="#000000" points="1749.8057,-499.9092 1740.886,-494.1917 1744.2934,-504.2237 1749.8057,-499.9092"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="1987,-447.8025 1887,-447.8025 1887,-407.9983 1987,-407.9983 1987,-447.8025"/>
<text text-anchor="middle" x="1937" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [ ] #Todo</text>
</g>
<!-- prose_24&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>prose_24&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1995.1216,-700.9787C1984.718,-652.0982 1956.1168,-517.7185 1943.3262,-457.6232"/>
<polygon fill="#000000" stroke="#000000" points="1946.7058,-456.6889 1941.2006,-447.6366 1939.8591,-458.1462 1946.7058,-456.6889"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2532.5,-463.1008 2005.5,-463.1008 2005.5,-392.7 2532.5,-392.7 2532.5,-463.1008"/>
<text text-anchor="middle" x="2269" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; [ ] &#160;Impose an intermediate Root metatable. &#160;Where should this be </text>
<text text-anchor="middle" x="2269" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;done? &#160;Ideally these are added directly to the Node subclasses,</text>
<text text-anchor="middle" x="2269" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;before the parse, then removed when the parse completes.</text>
</g>
<!-- prose_25&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>prose_25&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2151.6311,-701.4172C2170.88,-656.5597 2221.8662,-537.7412 2249.8867,-472.4422"/>
<polygon fill="#000000" stroke="#000000" points="2253.1206,-473.7813 2253.8477,-463.2114 2246.6879,-471.0209 2253.1206,-473.7813"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3085,-463.1008 2551,-463.1008 2551,-392.7 3085,-392.7 3085,-463.1008"/>
<text text-anchor="middle" x="2818" y="-431.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#45; &#160;The easier way is to pass in a new Root and stick it on during</text>
<text text-anchor="middle" x="2818" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;makeAstNode. &#160;This is unacceptably wasteful in a systems tool, but</text>
<text text-anchor="middle" x="2818" y="-401.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;is also an optimization, so let&#39;s start with the clearer approach.</text>
</g>
<!-- prose_26&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>prose_26&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2537.9142,-703.5393C2582.1413,-660.0144 2707.6724,-536.4764 2774.6501,-470.5621"/>
<polygon fill="#000000" stroke="#000000" points="2777.4526,-472.7147 2782.1251,-463.2058 2772.5426,-467.7255 2777.4526,-472.7147"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3539,-447.8025 3103,-447.8025 3103,-407.9983 3539,-407.9983 3539,-447.8025"/>
<text text-anchor="middle" x="3321" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; [ ] &#160;Handle string captures as well as table captures. </text>
</g>
<!-- prose_27&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>prose_27&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2986.6509,-706.8031C3013.6308,-692.228 3058.5888,-666.6064 3094,-639.8008 3172.7073,-580.221 3254.9527,-497.4659 3295.4099,-455.1675"/>
<polygon fill="#000000" stroke="#000000" points="3298.1068,-457.4108 3302.4676,-447.755 3293.0372,-452.5839 3298.1068,-457.4108"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="4056.5,-601.901 3557.5,-601.901 3557.5,-253.8998 4056.5,-253.8998 4056.5,-601.901"/>
<text text-anchor="middle" x="3807" y="-586.7007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function makeAstNode(id, first, t, last, metatables, str, root)</text>
<text text-anchor="middle" x="3807" y="-571.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.first = first</text>
<text text-anchor="middle" x="3807" y="-555.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.last &#160;= last</text>
<text text-anchor="middle" x="3807" y="-540.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;t.str &#160;&#160;= str &#45;&#45; This belongs on the Root metatable</text>
<text text-anchor="middle" x="3807" y="-525.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;t.root &#160;= root &#45;&#45; Also wrong, good enough for now. &#160;&#160;</text>
<text text-anchor="middle" x="3807" y="-509.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if metatables[id] then</text>
<text text-anchor="middle" x="3807" y="-494.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t = metatables[id](t)</text>
<text text-anchor="middle" x="3807" y="-462.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="3807" y="-447.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, Node)</text>
<text text-anchor="middle" x="3807" y="-432.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.id = id</text>
<text text-anchor="middle" x="3807" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3807" y="-401.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if t[1] and #t == 1 and type(t[1]) == &#39;string&#39; then</text>
<text text-anchor="middle" x="3807" y="-385.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; here we&#39;re just checking that C(patt) does</text>
<text text-anchor="middle" x="3807" y="-370.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; the expected thing</text>
<text text-anchor="middle" x="3807" y="-355.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="3807" y="-339.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return t </text>
<text text-anchor="middle" x="3807" y="-324.3002" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3807" y="-292.9002" font-family="Inconsolata" font-size="14.00" fill="#000000">local function anonNode (t) </text>
<text text-anchor="middle" x="3807" y="-277.5002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return unpack(t)</text>
<text text-anchor="middle" x="3807" y="-262.1001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_28&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>codeblock_28&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3470.6787,-701.9137C3490.7686,-685.8698 3521.4637,-661.2966 3548,-639.8008 3560.5239,-629.6558 3573.375,-619.2211 3586.3353,-608.6787"/>
<polygon fill="#000000" stroke="#000000" points="3588.8698,-611.1287 3594.4171,-602.1022 3584.4516,-605.6992 3588.8698,-611.1287"/>
</g>
<!-- leaf_49 -->
<g id="node50" class="node">
<title>leaf_49</title>
<polygon fill="none" stroke="#c0c0c0" points="4601.5,-471.1007 4074.5,-471.1007 4074.5,-384.7001 4601.5,-384.7001 4601.5,-471.1007"/>
<text text-anchor="middle" x="4338" y="-423.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;I&#39;m going to slice this into pieces in the Orb document, because a) it </text>
<text text-anchor="middle" x="4338" y="-408.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">needs documentation and b) we&#39;re going to be customizing it, finally, to</text>
<text text-anchor="middle" x="4338" y="-393.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">suit our own needs. </text>
</g>
<!-- prose_37&#45;&gt;leaf_49 -->
<g id="edge49" class="edge">
<title>prose_37&#45;&gt;leaf_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5542.8946,-702.0636C5535.647,-692.4839 5525.2659,-681.3793 5513,-675.8008 5330.192,-592.6602 4798.5927,-708.822 4610,-639.8008 4518.6473,-606.3676 4433.6685,-529.9922 4383.7834,-478.6662"/>
<polygon fill="#000000" stroke="#000000" points="4386.1364,-476.0637 4376.6813,-471.2834 4381.0917,-480.9166 4386.1364,-476.0637"/>
</g>
<!-- leaf_50 -->
<g id="node51" class="node">
<title>leaf_50</title>
<polygon fill="none" stroke="#c0c0c0" points="4894.5,-445.9004 4619.5,-445.9004 4619.5,-409.9004 4894.5,-409.9004 4894.5,-445.9004"/>
<text text-anchor="middle" x="4757" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, metas, g)</text>
</g>
<!-- codeblock_38&#45;&gt;leaf_50 -->
<g id="edge50" class="edge">
<title>codeblock_38&#45;&gt;leaf_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5655.3236,-702.2896C5638.6637,-692.6622 5616.3834,-681.4296 5595,-675.8008 5446.3015,-636.6592 5038.3334,-714.6196 4904,-639.8008 4830.205,-598.6997 4785.342,-503.0972 4766.8454,-455.6434"/>
<polygon fill="#000000" stroke="#000000" points="4770.014,-454.1277 4763.1987,-446.0158 4763.4679,-456.6073 4770.014,-454.1277"/>
</g>
<!-- leaf_51 -->
<g id="node52" class="node">
<title>leaf_51</title>
<polygon fill="none" stroke="#c0c0c0" points="5153,-447.8025 4913,-447.8025 4913,-407.9983 5153,-407.9983 5153,-447.8025"/>
<text text-anchor="middle" x="5033" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">First step is set up our =_ENV=.</text>
</g>
<!-- prose_39&#45;&gt;leaf_51 -->
<g id="edge51" class="edge">
<title>prose_39&#45;&gt;leaf_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5798.4942,-702.1441C5791.0239,-692.5929 5780.3868,-681.4901 5768,-675.8008 5645.4085,-619.4942 5277.5943,-709.3498 5162,-639.8008 5093.4087,-598.5319 5056.4179,-505.4923 5041.2974,-457.6089"/>
<polygon fill="#000000" stroke="#000000" points="5044.5822,-456.3811 5038.3184,-447.8362 5037.8864,-458.4222 5044.5822,-456.3811"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="5670.5,-455.2008 5171.5,-455.2008 5171.5,-400.6 5670.5,-400.6 5670.5,-455.2008"/>
<text text-anchor="middle" x="5421" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">In a way this is an elaborate workaround for Lua&#39;s global&#45;by&#45;default </text>
<text text-anchor="middle" x="5421" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">antipattern, which we aim to eliminate with Lun.</text>
</g>
<!-- prose_40&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>prose_40&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5880.184,-702.3592C5872.8287,-693.1286 5862.5787,-682.2786 5851,-675.8008 5782.8407,-637.6686 5749.4285,-673.5585 5679,-639.8008 5585.9731,-595.2115 5497.5937,-510.2012 5452.3635,-462.5255"/>
<polygon fill="#000000" stroke="#000000" points="5454.881,-460.0935 5445.4807,-455.2063 5449.7816,-464.8889 5454.881,-460.0935"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="6033.5,-616.5014 5688.5,-616.5014 5688.5,-239.2995 6033.5,-239.2995 6033.5,-616.5014"/>
<text text-anchor="middle" x="5861" y="-601.5008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="5861" y="-586.1008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="5861" y="-570.7007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="5861" y="-555.3007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local node_mts = metas or {}</text>
<text text-anchor="middle" x="5861" y="-539.9007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="5861" y="-524.5006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function( name ) g[ 1 ] = name end,</text>
<text text-anchor="middle" x="5861" y="-509.1006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function( ... )</text>
<text text-anchor="middle" x="5861" y="-493.7006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="5861" y="-478.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select( &#39;#&#39;, ... ) do</text>
<text text-anchor="middle" x="5861" y="-462.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[ select( i, ... ) ] = true</text>
<text text-anchor="middle" x="5861" y="-447.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5861" y="-432.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="5861" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;E = E,</text>
<text text-anchor="middle" x="5861" y="-401.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;EOF = EOF,</text>
<text text-anchor="middle" x="5861" y="-385.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;ID = ID,</text>
<text text-anchor="middle" x="5861" y="-370.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;W = W,</text>
<text text-anchor="middle" x="5861" y="-355.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;WS = WS,</text>
<text text-anchor="middle" x="5861" y="-339.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="5861" y="-324.3002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; copy lpeg shortcuts</text>
<text text-anchor="middle" x="5861" y="-308.9002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for k,v in pairs( L ) do</text>
<text text-anchor="middle" x="5861" y="-293.5002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if string.match( k, &quot;^%u%w*$&quot; ) then</text>
<text text-anchor="middle" x="5861" y="-278.1001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;env_index[ k ] = v</text>
<text text-anchor="middle" x="5861" y="-262.7001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5861" y="-247.3001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
</g>
<!-- codeblock_41&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>codeblock_41&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6019.4283,-700.9787C6009.5535,-683.9578 5993.6642,-656.5699 5975.6743,-625.5613"/>
<polygon fill="#000000" stroke="#000000" points="5978.5935,-623.6182 5970.5478,-616.7249 5972.5387,-627.131 5978.5935,-623.6182"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="6284.5,-447.8025 6051.5,-447.8025 6051.5,-407.9983 6284.5,-407.9983 6284.5,-447.8025"/>
<text text-anchor="middle" x="6168" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Here&#39;s where the magic happens.</text>
</g>
<!-- prose_42&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>prose_42&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6168,-700.9787C6168,-652.1994 6168,-518.2746 6168,-457.9975"/>
<polygon fill="#000000" stroke="#000000" points="6171.5001,-457.6366 6168,-447.6366 6164.5001,-457.6366 6171.5001,-457.6366"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="6739,-455.2008 6303,-455.2008 6303,-400.6 6739,-400.6 6739,-455.2008"/>
<text text-anchor="middle" x="6521" y="-424.1005" font-family="Inconsolata" font-size="14.00" fill="#000000">The __newindex method takes any new assignment in global, so</text>
<text text-anchor="middle" x="6521" y="-408.7004" font-family="Inconsolata" font-size="14.00" fill="#000000">any grammar rules, and applies a consistent capture to them.</text>
</g>
<!-- prose_43&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>prose_43&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6393.3027,-701.4172C6415.135,-654.6542 6474.4936,-527.5132 6503.9499,-464.4202"/>
<polygon fill="#000000" stroke="#000000" points="6507.1818,-465.7713 6508.2408,-455.2295 6500.839,-462.81 6507.1818,-465.7713"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="7158.5,-447.8025 6757.5,-447.8025 6757.5,-407.9983 7158.5,-407.9983 7158.5,-447.8025"/>
<text text-anchor="middle" x="6958" y="-416.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">Now we get to figure out what that capture wants to be!</text>
</g>
<!-- prose_44&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>prose_44&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6725.9309,-702.7047C6766.3138,-654.8853 6883.7691,-515.8008 6934.3627,-455.8905"/>
<polygon fill="#000000" stroke="#000000" points="6937.2649,-457.8785 6941.0429,-447.9801 6931.9168,-453.3621 6937.2649,-457.8785"/>
</g>
<!-- structure_57 -->
<g id="node58" class="node">
<title>structure_57</title>
<ellipse fill="none" stroke="#000000" cx="7221" cy="-427.9004" rx="44.5182" ry="18"/>
<text text-anchor="middle" x="7221" y="-423.7004" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">structure</text>
</g>
<!-- block_45&#45;&gt;structure_57 -->
<g id="edge57" class="edge">
<title>block_45&#45;&gt;structure_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7067.4942,-705.6294C7099.6165,-693.407 7141.948,-672.2988 7167,-639.8008 7209.4143,-584.7802 7218.7837,-500.1463 7220.6782,-456.3483"/>
<polygon fill="#000000" stroke="#000000" points="7224.1834,-456.2457 7221.0143,-446.1359 7217.1871,-456.0153 7224.1834,-456.2457"/>
</g>
<!-- leaf_61 -->
<g id="node62" class="node">
<title>leaf_61</title>
<polygon fill="none" stroke="#c0c0c0" points="7790,-639.7013 7284,-639.7013 7284,-216.0995 7790,-216.0995 7790,-639.7013"/>
<text text-anchor="middle" x="7537" y="-624.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env_index, { __index = _G } )</text>
<text text-anchor="middle" x="7537" y="-609.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable( env, {</text>
<text text-anchor="middle" x="7537" y="-593.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="7537" y="-578.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="7537" y="-563.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="7537" y="-547.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = L.Ct( val ) / anonNode</text>
<text text-anchor="middle" x="7537" y="-532.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="7537" y="-516.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7537" y="-501.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local v = (L.Cc( name ) </text>
<text text-anchor="middle" x="7537" y="-486.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="7537" y="-470.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Ct( val ) </text>
<text text-anchor="middle" x="7537" y="-455.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L_Cp </text>
<text text-anchor="middle" x="7537" y="-439.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Cc(node_mts)</text>
<text text-anchor="middle" x="7537" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Carg(1)</text>
<text text-anchor="middle" x="7537" y="-409.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* L.Carg(2)) / makeAstNode</text>
<text text-anchor="middle" x="7537" y="-393.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;g[name] = v</text>
<text text-anchor="middle" x="7537" y="-378.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7537" y="-362.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7537" y="-347.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;} )</text>
<text text-anchor="middle" x="7537" y="-332.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="7537" y="-316.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if _VERSION == &quot;Lua 5.1&quot; then</text>
<text text-anchor="middle" x="7537" y="-301.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="7537" y="-285.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="7537" y="-270.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="7537" y="-255.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="7537" y="-239.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="7537" y="-224.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_46&#45;&gt;leaf_61 -->
<g id="edge61" class="edge">
<title>codeblock_46&#45;&gt;leaf_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7376.6968,-700.9787C7384.1199,-688.3334 7394.902,-669.9659 7407.4192,-648.6428"/>
<polygon fill="#000000" stroke="#000000" points="7410.4477,-650.3973 7412.4918,-640.0015 7404.411,-646.8536 7410.4477,-650.3973"/>
</g>
<!-- leaf_62 -->
<g id="node63" class="node">
<title>leaf_62</title>
<polygon fill="none" stroke="#c0c0c0" points="8370,-508.9007 7808,-508.9007 7808,-346.9001 8370,-346.9001 8370,-508.9007"/>
<text text-anchor="middle" x="8089" y="-493.7006" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="8089" y="-478.3005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="8089" y="-462.9005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, &#160;metas)</text>
<text text-anchor="middle" x="8089" y="-447.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return function(str)</text>
<text text-anchor="middle" x="8089" y="-432.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;return L.match(L.P(grammar), str, 1, &#39;grammar&#39;, str, {}) &#45;&#45; other </text>
<text text-anchor="middle" x="8089" y="-416.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8089" y="-401.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="8089" y="-385.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="8089" y="-370.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8089" y="-355.1003" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_47&#45;&gt;leaf_62 -->
<g id="edge62" class="edge">
<title>codeblock_47&#45;&gt;leaf_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7840.178,-701.4172C7872.9097,-665.4371 7948.9288,-581.8733 8008.3899,-516.5108"/>
<polygon fill="#000000" stroke="#000000" points="8011.0473,-518.7909 8015.1875,-509.0385 8005.8693,-514.0804 8011.0473,-518.7909"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="8474,-445.9004 8388,-445.9004 8388,-409.9004 8474,-409.9004 8474,-445.9004"/>
<text text-anchor="middle" x="8431" y="-424.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_48&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>codeblock_48&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8276.6861,-704.7441C8310.7251,-692.7484 8353.3095,-672.2935 8379,-639.8008 8422.0997,-585.2894 8430.1316,-500.0869 8431.2226,-456.1742"/>
<polygon fill="#000000" stroke="#000000" points="8434.7254,-455.992 8431.3675,-445.9433 8427.7261,-455.8927 8434.7254,-455.992"/>
</g>
<!-- handleline_58 -->
<g id="node59" class="node">
<title>handleline_58</title>
<ellipse fill="none" stroke="#000000" cx="7221" cy="-162" rx="50.3585" ry="18"/>
<text text-anchor="middle" x="7221" y="-157.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handleline</text>
</g>
<!-- structure_57&#45;&gt;handleline_58 -->
<g id="edge58" class="edge">
<title>structure_57&#45;&gt;handleline_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7221,-409.624C7221,-363.9742 7221,-244.7165 7221,-190.0779"/>
<polygon fill="#000000" stroke="#000000" points="7224.5001,-190.0527 7221,-180.0527 7217.5001,-190.0527 7224.5001,-190.0527"/>
</g>
<!-- handle_59 -->
<g id="node60" class="node">
<title>handle_59</title>
<ellipse fill="none" stroke="#000000" cx="7221" cy="-90" rx="36.827" ry="18"/>
<text text-anchor="middle" x="7221" y="-85.8" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">handle</text>
</g>
<!-- handleline_58&#45;&gt;handle_59 -->
<g id="edge59" class="edge">
<title>handleline_58&#45;&gt;handle_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7221,-143.8314C7221,-136.131 7221,-126.9743 7221,-118.4166"/>
<polygon fill="#000000" stroke="#000000" points="7224.5001,-118.4132 7221,-108.4133 7217.5001,-118.4133 7224.5001,-118.4132"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="7274.5,-36 7167.5,-36 7167.5,0 7274.5,0 7274.5,-36"/>
<text text-anchor="middle" x="7221" y="-14.5" font-family="Inconsolata" font-size="14.00" fill="#000000">grammar&#45;magic</text>
</g>
<!-- handle_59&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>handle_59&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7221,-71.8314C7221,-64.131 7221,-54.9743 7221,-46.4166"/>
<polygon fill="#000000" stroke="#000000" points="7224.5001,-46.4132 7221,-36.4133 7217.5001,-46.4133 7224.5001,-46.4132"/>
</g>
</g>
</svg>