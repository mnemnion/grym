<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="9278pt" height="1557pt"
 viewBox="0.00 0.00 9278.00 1556.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1552.8022)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1552.8022 9274,-1552.8022 9274,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1211" cy="-1530.8022" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="1211" y="-1526.6022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 211</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1211" cy="-1458.8022" rx="55.6456" ry="18"/>
<text text-anchor="middle" x="1211" y="-1454.6022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;6</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1211,-1512.6336C1211,-1504.9332 1211,-1495.7766 1211,-1487.2189"/>
<polygon fill="#000000" stroke="#000000" points="1214.5001,-1487.2155 1211,-1477.2155 1207.5001,-1487.2155 1214.5001,-1487.2155"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="1006" cy="-1386.8022" rx="91.3932" ry="18"/>
<text text-anchor="middle" x="1006" y="-1382.6022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Grammar Module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1172.9215,-1445.4283C1141.3814,-1434.3508 1096.1557,-1418.4667 1060.7333,-1406.0256"/>
<polygon fill="#000000" stroke="#000000" points="1061.6166,-1402.6264 1051.0218,-1402.6148 1059.297,-1409.2308 1061.6166,-1402.6264"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="1211" cy="-1386.8022" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1211" y="-1382.6022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;6</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1211,-1440.6336C1211,-1432.9332 1211,-1423.7766 1211,-1415.2189"/>
<polygon fill="#000000" stroke="#000000" points="1214.5001,-1415.2155 1211,-1405.2155 1207.5001,-1415.2155 1214.5001,-1415.2155"/>
</g>
<!-- section_4 -->
<g id="node5" class="node">
<title>section_4</title>
<ellipse fill="none" stroke="#000000" cx="1903" cy="-1386.8022" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1903" y="-1382.6022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 7&#45;101</text>
</g>
<!-- section_1&#45;&gt;section_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;section_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1264.151,-1453.2721C1387.2685,-1440.4622 1692.0978,-1408.7458 1831.4373,-1394.2481"/>
<polygon fill="#000000" stroke="#000000" points="1831.9978,-1397.7087 1841.5819,-1393.1926 1831.2734,-1390.7463 1831.9978,-1397.7087"/>
</g>
<!-- leaf_5 -->
<g id="node6" class="node">
<title>leaf_5</title>
<polygon fill="none" stroke="#c0c0c0" points="982,-1315.4022 928,-1315.4022 928,-1279.4022 982,-1279.4022 982,-1315.4022"/>
</g>
<!-- header_2&#45;&gt;leaf_5 -->
<g id="edge5" class="edge">
<title>header_2&#45;&gt;leaf_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M995.6794,-1368.7108C988.421,-1355.9874 978.5829,-1338.7417 970.3999,-1324.3974"/>
<polygon fill="#000000" stroke="#000000" points="973.3005,-1322.4185 965.3053,-1315.4667 967.2203,-1325.8871 973.3005,-1322.4185"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="1422,-1332.7026 1000,-1332.7026 1000,-1262.1019 1422,-1262.1019 1422,-1332.7026"/>
<text text-anchor="middle" x="1211" y="-1285.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The grammar module returns one function, which generates</text>
<text text-anchor="middle" x="1211" y="-1270.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">a grammar. </text>
</g>
<!-- block_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>block_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1211,-1368.7108C1211,-1361.2226 1211,-1352.1681 1211,-1343.0605"/>
<polygon fill="#000000" stroke="#000000" points="1214.5001,-1342.8357 1211,-1332.8358 1207.5001,-1342.8358 1214.5001,-1342.8357"/>
</g>
<!-- header_7 -->
<g id="node8" class="node">
<title>header_7</title>
<ellipse fill="none" stroke="#000000" cx="1508" cy="-1297.4022" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="1508" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Parameters</text>
</g>
<!-- section_4&#45;&gt;header_7 -->
<g id="edge7" class="edge">
<title>section_4&#45;&gt;header_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1840.6201,-1381.1028C1775.6756,-1374.042 1671.5439,-1359.5322 1585,-1332.8022 1572.4654,-1328.9308 1559.3214,-1323.4618 1547.5131,-1317.9777"/>
<polygon fill="#000000" stroke="#000000" points="1548.8984,-1314.7606 1538.3666,-1313.6066 1545.88,-1321.0764 1548.8984,-1314.7606"/>
</g>
<!-- block_8 -->
<g id="node9" class="node">
<title>block_8</title>
<ellipse fill="none" stroke="#000000" cx="1645" cy="-1297.4022" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1645" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 7&#45;10</text>
</g>
<!-- section_4&#45;&gt;block_8 -->
<g id="edge8" class="edge">
<title>section_4&#45;&gt;block_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1849.6062,-1376.3017C1809.0052,-1367.3561 1752.2648,-1352.7656 1705,-1332.8022 1695.7386,-1328.8905 1686.1656,-1323.7867 1677.4599,-1318.6774"/>
<polygon fill="#000000" stroke="#000000" points="1679.1172,-1315.5893 1668.7509,-1313.4008 1675.4899,-1321.5762 1679.1172,-1315.5893"/>
</g>
<!-- block_9 -->
<g id="node10" class="node">
<title>block_9</title>
<ellipse fill="none" stroke="#000000" cx="1769" cy="-1297.4022" rx="55.3502" ry="18"/>
<text text-anchor="middle" x="1769" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 11&#45;13</text>
</g>
<!-- section_4&#45;&gt;block_9 -->
<g id="edge9" class="edge">
<title>section_4&#45;&gt;block_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1877.7956,-1369.9868C1856.418,-1355.7244 1825.5884,-1335.156 1802.202,-1319.5534"/>
<polygon fill="#000000" stroke="#000000" points="1803.8997,-1316.4786 1793.6386,-1313.8402 1800.0148,-1322.3017 1803.8997,-1316.4786"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="1903" cy="-1297.4022" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="1903" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 14&#45;101</text>
</g>
<!-- section_4&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_4&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1903,-1368.7108C1903,-1356.3509 1903,-1339.7235 1903,-1325.6338"/>
<polygon fill="#000000" stroke="#000000" points="1906.5001,-1325.4667 1903,-1315.4667 1899.5001,-1325.4668 1906.5001,-1325.4667"/>
</g>
<!-- section_11 -->
<g id="node12" class="node">
<title>section_11</title>
<ellipse fill="none" stroke="#000000" cx="2316" cy="-1297.4022" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="2316" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 17&#45;46</text>
</g>
<!-- section_4&#45;&gt;section_11 -->
<g id="edge11" class="edge">
<title>section_4&#45;&gt;section_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1954.8886,-1375.5702C2031.033,-1359.0876 2172.803,-1328.3994 2254.2184,-1310.7758"/>
<polygon fill="#000000" stroke="#000000" points="2255.2906,-1314.1248 2264.3237,-1308.5883 2253.8096,-1307.2833 2255.2906,-1314.1248"/>
</g>
<!-- section_12 -->
<g id="node13" class="node">
<title>section_12</title>
<ellipse fill="none" stroke="#000000" cx="4560" cy="-1297.4022" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="4560" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 47&#45;70</text>
</g>
<!-- section_4&#45;&gt;section_12 -->
<g id="edge12" class="edge">
<title>section_4&#45;&gt;section_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1968.3487,-1384.6035C2331.2836,-1372.3918 4096.6525,-1312.9925 4484.5408,-1299.9412"/>
<polygon fill="#000000" stroke="#000000" points="4484.9262,-1303.4303 4494.8028,-1299.5959 4484.6907,-1296.4343 4484.9262,-1303.4303"/>
</g>
<!-- section_13 -->
<g id="node14" class="node">
<title>section_13</title>
<ellipse fill="none" stroke="#000000" cx="6800" cy="-1297.4022" rx="70.655" ry="18"/>
<text text-anchor="middle" x="6800" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 71&#45;101</text>
</g>
<!-- section_4&#45;&gt;section_13 -->
<g id="edge13" class="edge">
<title>section_4&#45;&gt;section_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1968.5225,-1385.6061C2502.2186,-1375.8629 6130.8904,-1309.6175 6719.4279,-1298.8731"/>
<polygon fill="#000000" stroke="#000000" points="6719.5818,-1302.371 6729.5162,-1298.689 6719.454,-1295.3722 6719.5818,-1302.371"/>
</g>
<!-- section_14 -->
<g id="node15" class="node">
<title>section_14</title>
<ellipse fill="none" stroke="#000000" cx="8116" cy="-1297.4022" rx="74.6878" ry="18"/>
<text text-anchor="middle" x="8116" y="-1293.2022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 102&#45;211</text>
</g>
<!-- section_4&#45;&gt;section_14 -->
<g id="edge14" class="edge">
<title>section_4&#45;&gt;section_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1968.9411,-1386.5293C2400.7247,-1384.6505 4869.1681,-1372.5037 6880,-1332.8022 7313.2622,-1324.248 7831.7698,-1307.1731 8031.6871,-1300.3341"/>
<polygon fill="#000000" stroke="#000000" points="8031.9497,-1303.8273 8041.8239,-1299.9868 8031.7099,-1296.8314 8031.9497,-1303.8273"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="548,-1224.3022 494,-1224.3022 494,-1188.3022 548,-1188.3022 548,-1224.3022"/>
</g>
<!-- header_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>header_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1479.3523,-1280.9867C1465.2589,-1273.7682 1447.737,-1266.0279 1431,-1262.0022 1245.0487,-1217.2754 760.255,-1276.0733 558.0704,-1225.4811"/>
<polygon fill="#000000" stroke="#000000" points="558.9299,-1222.0882 548.3668,-1222.9065 557.1347,-1228.8541 558.9299,-1222.0882"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="883.5,-1226.2043 566.5,-1226.2043 566.5,-1186.4001 883.5,-1186.4001 883.5,-1226.2043"/>
<text text-anchor="middle" x="725" y="-1194.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">This function takes two parameters, namely:</text>
</g>
<!-- block_8&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>block_8&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1623.1262,-1281.035C1612.2466,-1273.8275 1598.5496,-1266.0825 1585,-1262.0022 1440.5067,-1218.489 1062.0005,-1238.1464 893.7431,-1225.9753"/>
<polygon fill="#000000" stroke="#000000" points="893.9411,-1222.4802 883.6984,-1225.1887 893.3946,-1229.4588 893.9411,-1222.4802"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1478,-1225.6027 902,-1225.6027 902,-1187.0016 1478,-1187.0016 1478,-1225.6027"/>
<text text-anchor="middle" x="1190" y="-1210.5022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; grammar_template : &#160;A function with one parameter, which must be =_ENV=.</text>
<text text-anchor="middle" x="1190" y="-1195.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; metas : &#160;A map with keys of string and values of Node subclass constructors.</text>
</g>
<!-- block_9&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>block_9&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1744.8116,-1281.0245C1733.2507,-1273.9989 1718.9217,-1266.4078 1705,-1262.0022 1659.7195,-1247.6727 1564.1354,-1235.6858 1467.4652,-1226.5478"/>
<polygon fill="#000000" stroke="#000000" points="1467.7858,-1223.0626 1457.5034,-1225.6164 1467.1341,-1230.0322 1467.7858,-1223.0626"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1771.5,-1226.2043 1496.5,-1226.2043 1496.5,-1186.4001 1771.5,-1186.4001 1771.5,-1226.2043"/>
<text text-anchor="middle" x="1634" y="-1210.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">Both of these are reasonably complex.</text>
</g>
<!-- block_10&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_10&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1874.6296,-1281.4655C1862.122,-1274.8588 1847.0904,-1267.4764 1833,-1262.0022 1799.5195,-1248.9947 1761.7901,-1237.6421 1728.2559,-1228.6395"/>
<polygon fill="#000000" stroke="#000000" points="1729.0188,-1225.2209 1718.4559,-1226.0429 1727.2258,-1231.9874 1729.0188,-1225.2209"/>
</g>
<!-- header_19 -->
<g id="node20" class="node">
<title>header_19</title>
<ellipse fill="none" stroke="#000000" cx="1886" cy="-1206.3022" rx="96.7227" ry="18"/>
<text text-anchor="middle" x="1886" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : grammar_template</text>
</g>
<!-- section_11&#45;&gt;header_19 -->
<g id="edge19" class="edge">
<title>section_11&#45;&gt;header_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2263.7035,-1286.3226C2187.8118,-1270.2442 2046.7855,-1240.3663 1960.1808,-1222.0182"/>
<polygon fill="#000000" stroke="#000000" points="1960.6654,-1218.5432 1950.1571,-1219.8945 1959.2145,-1225.3912 1960.6654,-1218.5432"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="2056" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2056" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 17&#45;22</text>
</g>
<!-- section_11&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_11&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2275.375,-1283.1678C2228.7792,-1266.8414 2152.4923,-1240.1116 2103.2725,-1222.8657"/>
<polygon fill="#000000" stroke="#000000" points="2104.4011,-1219.5526 2093.8062,-1219.5489 2102.0863,-1226.1588 2104.4011,-1219.5526"/>
</g>
<!-- block_21 -->
<g id="node22" class="node">
<title>block_21</title>
<ellipse fill="none" stroke="#000000" cx="2186" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2186" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 23&#45;25</text>
</g>
<!-- section_11&#45;&gt;block_21 -->
<g id="edge21" class="edge">
<title>section_11&#45;&gt;block_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2291.8527,-1280.4805C2271.0175,-1265.8799 2240.7648,-1244.6797 2217.9321,-1228.6792"/>
<polygon fill="#000000" stroke="#000000" points="2219.7777,-1225.6987 2209.5797,-1222.8261 2215.7605,-1231.4313 2219.7777,-1225.6987"/>
</g>
<!-- block_22 -->
<g id="node23" class="node">
<title>block_22</title>
<ellipse fill="none" stroke="#000000" cx="2316" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2316" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 26&#45;30</text>
</g>
<!-- section_11&#45;&gt;block_22 -->
<g id="edge22" class="edge">
<title>section_11&#45;&gt;block_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2316,-1278.9668C2316,-1266.2889 2316,-1249.2051 2316,-1234.7876"/>
<polygon fill="#000000" stroke="#000000" points="2319.5001,-1234.3993 2316,-1224.3993 2312.5001,-1234.3993 2319.5001,-1234.3993"/>
</g>
<!-- block_23 -->
<g id="node24" class="node">
<title>block_23</title>
<ellipse fill="none" stroke="#000000" cx="2446" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2446" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 31&#45;35</text>
</g>
<!-- section_11&#45;&gt;block_23 -->
<g id="edge23" class="edge">
<title>section_11&#45;&gt;block_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2340.1473,-1280.4805C2360.9825,-1265.8799 2391.2352,-1244.6797 2414.0679,-1228.6792"/>
<polygon fill="#000000" stroke="#000000" points="2416.2395,-1231.4313 2422.4203,-1222.8261 2412.2223,-1225.6987 2416.2395,-1231.4313"/>
</g>
<!-- block_24 -->
<g id="node25" class="node">
<title>block_24</title>
<ellipse fill="none" stroke="#000000" cx="2576" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2576" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 36&#45;37</text>
</g>
<!-- section_11&#45;&gt;block_24 -->
<g id="edge24" class="edge">
<title>section_11&#45;&gt;block_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2356.625,-1283.1678C2403.2208,-1266.8414 2479.5077,-1240.1116 2528.7275,-1222.8657"/>
<polygon fill="#000000" stroke="#000000" points="2529.9137,-1226.1588 2538.1938,-1219.5489 2527.5989,-1219.5526 2529.9137,-1226.1588"/>
</g>
<!-- block_25 -->
<g id="node26" class="node">
<title>block_25</title>
<ellipse fill="none" stroke="#000000" cx="2811" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2811" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 38&#45;39</text>
</g>
<!-- section_11&#45;&gt;block_25 -->
<g id="edge25" class="edge">
<title>section_11&#45;&gt;block_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2370.865,-1287.3048C2464.8284,-1270.0118 2655.7358,-1234.8771 2752.28,-1217.109"/>
<polygon fill="#000000" stroke="#000000" points="2752.9655,-1220.5417 2762.1668,-1215.2894 2751.6985,-1213.6573 2752.9655,-1220.5417"/>
</g>
<!-- block_26 -->
<g id="node27" class="node">
<title>block_26</title>
<ellipse fill="none" stroke="#000000" cx="3119" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="3119" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 40&#45;46</text>
</g>
<!-- section_11&#45;&gt;block_26 -->
<g id="edge26" class="edge">
<title>section_11&#45;&gt;block_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2376.6847,-1290.5176C2525.1758,-1273.6713 2905.6453,-1230.5072 3056.2561,-1213.4204"/>
<polygon fill="#000000" stroke="#000000" points="3056.7266,-1216.8896 3066.2682,-1212.2846 3055.9374,-1209.9342 3056.7266,-1216.8896"/>
</g>
<!-- header_35 -->
<g id="node36" class="node">
<title>header_35</title>
<ellipse fill="none" stroke="#000000" cx="3789" cy="-1206.3022" rx="46.4563" ry="18"/>
<text text-anchor="middle" x="3789" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : metas</text>
</g>
<!-- section_12&#45;&gt;header_35 -->
<g id="edge35" class="edge">
<title>section_12&#45;&gt;header_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4499.5009,-1290.2537C4353.5247,-1273.0054 3983.7271,-1229.3108 3843.7898,-1212.776"/>
<polygon fill="#000000" stroke="#000000" points="3844.0646,-1209.2842 3833.723,-1211.5866 3843.2432,-1216.2359 3844.0646,-1209.2842"/>
</g>
<!-- block_36 -->
<g id="node37" class="node">
<title>block_36</title>
<ellipse fill="none" stroke="#000000" cx="4256" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4256" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 47&#45;51</text>
</g>
<!-- section_12&#45;&gt;block_36 -->
<g id="edge36" class="edge">
<title>section_12&#45;&gt;block_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4515.4702,-1284.0579C4459.9696,-1267.426 4365.3306,-1239.0654 4306.9813,-1221.5798"/>
<polygon fill="#000000" stroke="#000000" points="4307.8174,-1218.1766 4297.2335,-1218.6587 4305.8079,-1224.882 4307.8174,-1218.1766"/>
</g>
<!-- block_37 -->
<g id="node38" class="node">
<title>block_37</title>
<ellipse fill="none" stroke="#000000" cx="4560" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4560" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 52&#45;60</text>
</g>
<!-- section_12&#45;&gt;block_37 -->
<g id="edge37" class="edge">
<title>section_12&#45;&gt;block_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4560,-1278.9668C4560,-1266.2889 4560,-1249.2051 4560,-1234.7876"/>
<polygon fill="#000000" stroke="#000000" points="4563.5001,-1234.3993 4560,-1224.3993 4556.5001,-1234.3993 4563.5001,-1234.3993"/>
</g>
<!-- block_38 -->
<g id="node39" class="node">
<title>block_38</title>
<ellipse fill="none" stroke="#000000" cx="4919" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="4919" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 61&#45;62</text>
</g>
<!-- section_12&#45;&gt;block_38 -->
<g id="edge38" class="edge">
<title>section_12&#45;&gt;block_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4608.4163,-1285.1161C4675.2727,-1268.1505 4795.4741,-1237.6482 4865.1087,-1219.9776"/>
<polygon fill="#000000" stroke="#000000" points="4866.1715,-1223.319 4875.0034,-1217.4668 4864.4497,-1216.534 4866.1715,-1223.319"/>
</g>
<!-- block_39 -->
<g id="node40" class="node">
<title>block_39</title>
<ellipse fill="none" stroke="#000000" cx="5394" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="5394" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 63&#45;66</text>
</g>
<!-- section_12&#45;&gt;block_39 -->
<g id="edge39" class="edge">
<title>section_12&#45;&gt;block_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4621.326,-1290.7034C4774.9438,-1273.9233 5175.0515,-1230.2185 5330.7282,-1213.2135"/>
<polygon fill="#000000" stroke="#000000" points="5331.5053,-1216.6495 5341.0661,-1212.0843 5330.7451,-1209.6909 5331.5053,-1216.6495"/>
</g>
<!-- block_40 -->
<g id="node41" class="node">
<title>block_40</title>
<ellipse fill="none" stroke="#000000" cx="5916" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="5916" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 67&#45;70</text>
</g>
<!-- section_12&#45;&gt;block_40 -->
<g id="edge40" class="edge">
<title>section_12&#45;&gt;block_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4624.0365,-1293.1001C4851.7852,-1277.7992 5621.1636,-1226.1101 5850.7792,-1210.6839"/>
<polygon fill="#000000" stroke="#000000" points="5851.237,-1214.1611 5860.9799,-1209.9986 5850.7677,-1207.1769 5851.237,-1214.1611"/>
</g>
<!-- header_47 -->
<g id="node48" class="node">
<title>header_47</title>
<ellipse fill="none" stroke="#000000" cx="6596" cy="-1206.3022" rx="54.6851" ry="18"/>
<text text-anchor="middle" x="6596" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : includes</text>
</g>
<!-- section_13&#45;&gt;header_47 -->
<g id="edge47" class="edge">
<title>section_13&#45;&gt;header_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6764.9311,-1281.7416C6729.6447,-1265.9837 6675.2244,-1241.6813 6637.7364,-1224.9404"/>
<polygon fill="#000000" stroke="#000000" points="6639.1504,-1221.7387 6628.5923,-1220.8569 6636.2961,-1228.1303 6639.1504,-1221.7387"/>
</g>
<!-- block_48 -->
<g id="node49" class="node">
<title>block_48</title>
<ellipse fill="none" stroke="#000000" cx="6725" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="6725" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 71&#45;72</text>
</g>
<!-- section_13&#45;&gt;block_48 -->
<g id="edge48" class="edge">
<title>section_13&#45;&gt;block_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6785.1824,-1279.4038C6774.0163,-1265.8407 6758.5524,-1247.0571 6746.096,-1231.9268"/>
<polygon fill="#000000" stroke="#000000" points="6748.5896,-1229.449 6739.5316,-1223.9532 6743.1854,-1233.8981 6748.5896,-1229.449"/>
</g>
<!-- codeblock_49 -->
<g id="node50" class="node">
<title>codeblock_49</title>
<ellipse fill="none" stroke="#000000" cx="6876" cy="-1206.3022" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="6876" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 73&#45;78</text>
</g>
<!-- section_13&#45;&gt;codeblock_49 -->
<g id="edge49" class="edge">
<title>section_13&#45;&gt;codeblock_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6815.0152,-1279.4038C6826.2571,-1265.9282 6841.7982,-1247.2993 6854.378,-1232.2201"/>
<polygon fill="#000000" stroke="#000000" points="6857.2976,-1234.1841 6861.016,-1224.2632 6851.9224,-1229.6999 6857.2976,-1234.1841"/>
</g>
<!-- block_50 -->
<g id="node51" class="node">
<title>block_50</title>
<ellipse fill="none" stroke="#000000" cx="7093" cy="-1206.3022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="7093" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 82&#45;83</text>
</g>
<!-- section_13&#45;&gt;block_50 -->
<g id="edge50" class="edge">
<title>section_13&#45;&gt;block_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6844.8193,-1283.4669C6898.2031,-1266.8688 6987.1311,-1239.2191 7042.7847,-1221.9152"/>
<polygon fill="#000000" stroke="#000000" points="7043.9246,-1225.2261 7052.4346,-1218.9148 7041.8463,-1218.5418 7043.9246,-1225.2261"/>
</g>
<!-- codeblock_51 -->
<g id="node52" class="node">
<title>codeblock_51</title>
<ellipse fill="none" stroke="#000000" cx="7383" cy="-1206.3022" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="7383" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 84&#45;99</text>
</g>
<!-- section_13&#45;&gt;codeblock_51 -->
<g id="edge51" class="edge">
<title>section_13&#45;&gt;codeblock_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6860.1954,-1287.996C6967.6174,-1271.2102 7192.003,-1236.1475 7308.7828,-1217.8994"/>
<polygon fill="#000000" stroke="#000000" points="7309.3742,-1221.3496 7318.7139,-1216.3476 7308.2934,-1214.4335 7309.3742,-1221.3496"/>
</g>
<!-- header_57 -->
<g id="node58" class="node">
<title>header_57</title>
<ellipse fill="none" stroke="#000000" cx="7763" cy="-1206.3022" rx="46.4822" ry="18"/>
<text text-anchor="middle" x="7763" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : define</text>
</g>
<!-- section_14&#45;&gt;header_57 -->
<g id="edge57" class="edge">
<title>section_14&#45;&gt;header_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8064.0808,-1284.3924C8007.8274,-1270.243 7915.4576,-1246.8533 7836,-1226.0022 7827.9661,-1223.8939 7819.4441,-1221.6244 7811.166,-1219.4021"/>
<polygon fill="#000000" stroke="#000000" points="7811.8048,-1215.9495 7801.2387,-1216.7288 7809.9846,-1222.7087 7811.8048,-1215.9495"/>
</g>
<!-- block_58 -->
<g id="node59" class="node">
<title>block_58</title>
<ellipse fill="none" stroke="#000000" cx="7911" cy="-1206.3022" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="7911" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 102&#45;103</text>
</g>
<!-- section_14&#45;&gt;block_58 -->
<g id="edge58" class="edge">
<title>section_14&#45;&gt;block_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8080.2917,-1281.5338C8045.3934,-1266.0253 7992.1988,-1242.3861 7954.7711,-1225.7536"/>
<polygon fill="#000000" stroke="#000000" points="7956.1757,-1222.5478 7945.616,-1221.6852 7953.333,-1228.9446 7956.1757,-1222.5478"/>
</g>
<!-- codeblock_59 -->
<g id="node60" class="node">
<title>codeblock_59</title>
<ellipse fill="none" stroke="#000000" cx="8116" cy="-1206.3022" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8116" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 104&#45;179</text>
</g>
<!-- section_14&#45;&gt;codeblock_59 -->
<g id="edge59" class="edge">
<title>section_14&#45;&gt;codeblock_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116,-1278.9668C8116,-1266.2889 8116,-1249.2051 8116,-1234.7876"/>
<polygon fill="#000000" stroke="#000000" points="8119.5001,-1234.3993 8116,-1224.3993 8112.5001,-1234.3993 8119.5001,-1234.3993"/>
</g>
<!-- codeblock_60 -->
<g id="node61" class="node">
<title>codeblock_60</title>
<ellipse fill="none" stroke="#000000" cx="8417" cy="-1206.3022" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8417" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 181&#45;190</text>
</g>
<!-- section_14&#45;&gt;codeblock_60 -->
<g id="edge60" class="edge">
<title>section_14&#45;&gt;codeblock_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8162.701,-1283.2678C8215.3057,-1267.3465 8300.8982,-1241.4413 8358.0625,-1224.1401"/>
<polygon fill="#000000" stroke="#000000" points="8359.1289,-1227.4742 8367.6863,-1221.2274 8357.1011,-1220.7743 8359.1289,-1227.4742"/>
</g>
<!-- codeblock_61 -->
<g id="node62" class="node">
<title>codeblock_61</title>
<ellipse fill="none" stroke="#000000" cx="8767" cy="-1206.3022" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="8767" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 193&#45;207</text>
</g>
<!-- section_14&#45;&gt;codeblock_61 -->
<g id="edge61" class="edge">
<title>section_14&#45;&gt;codeblock_61</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8180.8004,-1288.3341C8299.9081,-1271.6664 8553.4186,-1236.1905 8684.5732,-1217.8369"/>
<polygon fill="#000000" stroke="#000000" points="8685.1517,-1221.2901 8694.5701,-1216.4379 8684.1815,-1214.3577 8685.1517,-1221.2901"/>
</g>
<!-- codeblock_62 -->
<g id="node63" class="node">
<title>codeblock_62</title>
<ellipse fill="none" stroke="#000000" cx="9171" cy="-1206.3022" rx="86.7905" ry="18"/>
<text text-anchor="middle" x="9171" y="-1202.1022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 209&#45;211</text>
</g>
<!-- section_14&#45;&gt;codeblock_62 -->
<g id="edge62" class="edge">
<title>section_14&#45;&gt;codeblock_62</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8186.4486,-1291.3189C8372.0245,-1275.2943 8874.1817,-1231.9327 9080.5634,-1214.1114"/>
<polygon fill="#000000" stroke="#000000" points="9081.098,-1217.5784 9090.7598,-1213.231 9080.4958,-1210.6043 9081.098,-1217.5784"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-593.3011 0,-593.3011 0,-557.3011 54,-557.3011 54,-593.3011"/>
</g>
<!-- header_19&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>header_19&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1822.3433,-1192.7348C1808.4487,-1190.2606 1793.7787,-1188.0175 1780,-1186.6022 1732.5448,-1181.7277 97.4256,-1183.6269 63,-1150.6022 -15.9904,-1074.826 13.73,-708.4631 24.0489,-603.4732"/>
<polygon fill="#000000" stroke="#000000" points="27.5504,-603.6325 25.0659,-593.3331 20.5853,-602.9339 27.5504,-603.6325"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="634,-610.5015 72,-610.5015 72,-540.1007 634,-540.1007 634,-610.5015"/>
<text text-anchor="middle" x="353" y="-579.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;The internal function @define creates a custom environment variable, neatly</text>
<text text-anchor="middle" x="353" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">sidestepping lua&#39;s pedantic insistance on prepending =local= to all values of </text>
<text text-anchor="middle" x="353" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">significance. </text>
</g>
<!-- block_20&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_20&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2018.5041,-1192.902C2009.9015,-1190.3503 2000.7188,-1188.0329 1992,-1186.6022 1918.0183,-1174.4622 706.3084,-1190.7608 643,-1150.6022 449.7419,-1028.0119 380.1534,-733.8682 360.0031,-620.719"/>
<polygon fill="#000000" stroke="#000000" points="363.4162,-619.9163 358.2582,-610.6619 356.5192,-621.113 363.4162,-619.9163"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="1193.5,-594.6017 652.5,-594.6017 652.5,-556.0005 1193.5,-556.0005 1193.5,-594.6017"/>
<text text-anchor="middle" x="923" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">More relevantly, it constructs a full grammar, which will return a table of</text>
<text text-anchor="middle" x="923" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">type Node. </text>
</g>
<!-- block_21&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>block_21&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2147.892,-1192.9857C2139.1563,-1190.4297 2129.8374,-1188.0893 2121,-1186.6022 2020.2274,-1169.6444 1287.5223,-1206.5361 1202,-1150.6022 1002.3198,-1020.0057 941.2663,-703.1477 926.8189,-604.8707"/>
<polygon fill="#000000" stroke="#000000" points="930.2547,-604.1709 925.3857,-594.7612 923.324,-605.1534 930.2547,-604.1709"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="1752.5,-609.9023 1211.5,-609.9023 1211.5,-540.6998 1752.5,-540.6998 1752.5,-609.9023"/>
<text text-anchor="middle" x="1482" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">If you stick to =lpeg= patterns, as you should, all array values will be of</text>
<text text-anchor="middle" x="1482" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">Node, as is intended. &#160;Captures will interpolate various other sorts of Lua</text>
<text text-anchor="middle" x="1482" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">values, which will induce halting in some places and silently corrupt</text>
<text text-anchor="middle" x="1482" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000">execution in others. </text>
</g>
<!-- block_22&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>block_22&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2277.5074,-1193.1081C2268.8739,-1190.5787 2259.6947,-1188.2186 2251,-1186.6022 2143.6568,-1166.6464 1851.34,-1211.9168 1761,-1150.6022 1573.0689,-1023.0515 1507.3191,-731.8767 1488.4953,-620.1194"/>
<polygon fill="#000000" stroke="#000000" points="1491.9389,-619.4898 1486.8672,-610.1877 1485.0311,-620.6222 1491.9389,-619.4898"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2325.5,-609.9023 1770.5,-609.9023 1770.5,-540.6998 2325.5,-540.6998 2325.5,-609.9023"/>
<text text-anchor="middle" x="2048" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">Though as yet poorly thought through, the [[elpatt module][./elpatt]] is</text>
<text text-anchor="middle" x="2048" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">intended to provide only those patterns which are allowed in Grammars, while</text>
<text text-anchor="middle" x="2048" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">expanding the scope of some favorites to properly respect utf&#45;8 and otherwise</text>
<text text-anchor="middle" x="2048" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000">behave. </text>
</g>
<!-- block_23&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_23&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2406.1877,-1193.5256C2383.1111,-1184.4986 2354.7964,-1170.4451 2335,-1150.6022 2175.74,-990.9682 2089.1084,-725.0106 2059.6564,-619.9538"/>
<polygon fill="#000000" stroke="#000000" points="2062.9434,-618.7086 2056.9038,-610.0039 2056.1968,-620.5751 2062.9434,-618.7086"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="2808,-593.3011 2344,-593.3011 2344,-557.3011 2808,-557.3011 2808,-593.3011"/>
<text text-anchor="middle" x="2576" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">There are examples of the format in the [[spec module][./spec]].</text>
</g>
<!-- block_24&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>block_24&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2576,-1188.098C2576,-1099.4048 2576,-712.4219 2576,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="2579.5001,-603.579 2576,-593.5791 2572.5001,-603.5791 2579.5001,-603.579"/>
</g>
<!-- leaf_33 -->
<g id="node34" class="node">
<title>leaf_33</title>
<polygon fill="none" stroke="#c0c0c0" points="3003.5,-593.3011 2826.5,-593.3011 2826.5,-557.3011 3003.5,-557.3011 3003.5,-593.3011"/>
<text text-anchor="middle" x="2915" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">Special fields include:</text>
</g>
<!-- block_25&#45;&gt;leaf_33 -->
<g id="edge33" class="edge">
<title>block_25&#45;&gt;leaf_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2814.0004,-1188.098C2828.6185,-1099.4048 2892.4001,-712.4219 2910.3085,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="2913.8146,-604.0152 2911.9875,-593.5791 2906.9077,-602.8767 2913.8146,-604.0152"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3570,-625.8012 3022,-625.8012 3022,-524.8009 3570,-524.8009 3570,-625.8012"/>
<text text-anchor="middle" x="3296" y="-610.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;START : &#160;a string which must be the same as the starting rule.</text>
<text text-anchor="middle" x="3296" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;SUPPRESS : &#160;either a string or an array of strings. These rules will be</text>
<text text-anchor="middle" x="3296" y="-579.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;removed from the Node. </text>
<text text-anchor="middle" x="3296" y="-564.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;P : &#160;The lpeg P function. &#160;Recognizes a certain pattern.</text>
<text text-anchor="middle" x="3296" y="-549.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45; &#160;V : &#160;The lpeg V function. &#160;Used for non&#45;terminal rvalues in a grammar. </text>
</g>
<!-- block_26&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>block_26&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3124.1064,-1188.098C3146.9444,-1106.6811 3240.2891,-773.9093 3279.0271,-635.809"/>
<polygon fill="#000000" stroke="#000000" points="3282.4999,-636.3875 3281.8308,-625.8138 3275.76,-634.4969 3282.4999,-636.3875"/>
</g>
<!-- leaf_41 -->
<g id="node42" class="node">
<title>leaf_41</title>
<polygon fill="none" stroke="#c0c0c0" points="3642,-593.3011 3588,-593.3011 3588,-557.3011 3642,-557.3011 3642,-593.3011"/>
</g>
<!-- header_35&#45;&gt;leaf_41 -->
<g id="edge41" class="edge">
<title>header_35&#45;&gt;leaf_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3744.7059,-1200.8406C3713.139,-1194.4359 3672.6119,-1180.5675 3651,-1150.6022 3587.176,-1062.1089 3605.9607,-706.9746 3612.9316,-603.6401"/>
<polygon fill="#000000" stroke="#000000" points="3616.4434,-603.5902 3613.642,-593.3724 3609.4601,-603.1069 3616.4434,-603.5902"/>
</g>
<!-- leaf_42 -->
<g id="node43" class="node">
<title>leaf_42</title>
<polygon fill="none" stroke="#c0c0c0" points="4257.5,-602.6015 3660.5,-602.6015 3660.5,-548.0007 4257.5,-548.0007 4257.5,-602.6015"/>
<text text-anchor="middle" x="3959" y="-571.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;By default a node will inherit from the Node class. &#160;If you want custom behavior,</text>
<text text-anchor="middle" x="3959" y="-556.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">you must pass in a table of metatable constructors.</text>
</g>
<!-- block_36&#45;&gt;leaf_42 -->
<g id="edge42" class="edge">
<title>block_36&#45;&gt;leaf_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4247.5898,-1188.434C4207.1029,-1102.4163 4031.9459,-730.2806 3976.1451,-611.7272"/>
<polygon fill="#000000" stroke="#000000" points="3979.3047,-610.2214 3971.8792,-602.6641 3972.9712,-613.2025 3979.3047,-610.2214"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="4844.5,-641.0015 4275.5,-641.0015 4275.5,-509.6007 4844.5,-509.6007 4844.5,-641.0015"/>
<text text-anchor="middle" x="4560" y="-625.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">That&#39;s a fairly specific beast. &#160;Any rule defined above will have an =id=</text>
<text text-anchor="middle" x="4560" y="-610.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">corresonding to the name of the rule. &#160;Unless =SUPPRESS=ed, this will become</text>
<text text-anchor="middle" x="4560" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">a Node. &#160;If the =metas= parameter has a key corresponding to =id=, then it</text>
<text text-anchor="middle" x="4560" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">must return a function taking two parameters:</text>
<text text-anchor="middle" x="4560" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;</text>
<text text-anchor="middle" x="4560" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; node : &#160;The node under construction, which under normal circumstances will</text>
<text text-anchor="middle" x="4560" y="-533.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;already have the =first= and =last= fields.</text>
<text text-anchor="middle" x="4560" y="-517.901" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#45; str &#160;: &#160;The entire str the grammar is parsing.</text>
</g>
<!-- block_37&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>block_37&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4560,-1188.098C4560,-1109.5596 4560,-797.1253 4560,-651.1669"/>
<polygon fill="#000000" stroke="#000000" points="4563.5001,-650.951 4560,-640.9511 4556.5001,-650.9511 4563.5001,-650.951"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="5431.5,-593.3011 4862.5,-593.3011 4862.5,-557.3011 5431.5,-557.3011 5431.5,-593.3011"/>
<text text-anchor="middle" x="5147" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">Which must return that same node, decorated in whatever fashion is appropriate.</text>
</g>
<!-- block_38&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>block_38&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4925.5777,-1188.098C4957.69,-1099.2257 5098.0195,-710.8571 5136.9516,-603.1106"/>
<polygon fill="#000000" stroke="#000000" points="5140.289,-604.1734 5140.3956,-593.5791 5133.7056,-601.7945 5140.289,-604.1734"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="6026,-602.5015 5450,-602.5015 5450,-548.1006 6026,-548.1006 6026,-602.5015"/>
<text text-anchor="middle" x="5738" y="-587.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">The node will not have a metatable at this point, and the function must attach a</text>
<text text-anchor="middle" x="5738" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">metatable with =__index= equal to some table which itself has the =__index=</text>
<text text-anchor="middle" x="5738" y="-556.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">Node as some recursive backstop.</text>
</g>
<!-- block_39&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>block_39&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5409.9267,-1188.9891C5419.2872,-1178.3539 5431.0089,-1164.2029 5440,-1150.6022 5567.1596,-958.2493 5681.7538,-705.0591 5722.3689,-611.805"/>
<polygon fill="#000000" stroke="#000000" points="5725.6301,-613.0819 5726.4003,-602.5151 5719.2087,-610.2953 5725.6301,-613.0819"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="6571.5,-602.6015 6044.5,-602.6015 6044.5,-548.0007 6571.5,-548.0007 6571.5,-602.6015"/>
<text text-anchor="middle" x="6308" y="-587.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">You might say the return value must /inherit/ from Node, if we were using</text>
<text text-anchor="middle" x="6308" y="-572.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">a language that did that sort of thing. </text>
</g>
<!-- block_40&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>block_40&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5958.2553,-1194.5044C5983.1499,-1185.7676 6013.8142,-1171.6761 6035,-1150.6022 6197.189,-989.2691 6275.5485,-712.8695 6299.6305,-612.831"/>
<polygon fill="#000000" stroke="#000000" points="6303.087,-613.4229 6301.9846,-602.8856 6296.2752,-611.8105 6303.087,-613.4229"/>
</g>
<!-- leaf_52 -->
<g id="node53" class="node">
<title>leaf_52</title>
<polygon fill="none" stroke="#c0c0c0" points="6644,-593.3011 6590,-593.3011 6590,-557.3011 6644,-557.3011 6644,-593.3011"/>
</g>
<!-- header_47&#45;&gt;leaf_52 -->
<g id="edge52" class="edge">
<title>header_47&#45;&gt;leaf_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6596.6058,-1188.098C6599.5576,-1099.4048 6612.4366,-712.4219 6616.0527,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="6619.557,-603.69 6616.3917,-593.5791 6612.5609,-603.4571 6619.557,-603.69"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="6716,-593.3011 6662,-593.3011 6662,-557.3011 6716,-557.3011 6716,-593.3011"/>
</g>
<!-- block_48&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>block_48&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6723.9614,-1188.098C6718.9013,-1099.4048 6696.823,-712.4219 6690.624,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="6694.1068,-603.3634 6690.0428,-593.5791 6687.1182,-603.7622 6694.1068,-603.3634"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="6974,-610.5015 6734,-610.5015 6734,-540.1007 6974,-540.1007 6974,-610.5015"/>
<text text-anchor="middle" x="6854" y="-595.2011" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="6854" y="-563.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot; </text>
<text text-anchor="middle" x="6854" y="-548.4011" font-family="Inconsolata" font-size="14.00" fill="#000000">local Node = require &quot;node/node&quot;</text>
</g>
<!-- codeblock_49&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>codeblock_49&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6875.3653,-1188.098C6872.4187,-1103.5843 6860.0293,-748.2313 6855.5905,-620.9203"/>
<polygon fill="#000000" stroke="#000000" points="6859.0818,-620.6069 6855.2354,-610.7349 6852.0861,-620.8508 6859.0818,-620.6069"/>
</g>
<!-- leaf_55 -->
<g id="node56" class="node">
<title>leaf_55</title>
<polygon fill="none" stroke="#c0c0c0" points="7323.5,-593.3011 6992.5,-593.3011 6992.5,-557.3011 7323.5,-557.3011 7323.5,-593.3011"/>
<text text-anchor="middle" x="7158" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">It&#39;s the kind of thing I&#39;d like to automate. </text>
</g>
<!-- block_50&#45;&gt;leaf_55 -->
<g id="edge55" class="edge">
<title>block_50&#45;&gt;leaf_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7094.8752,-1188.098C7104.0116,-1099.4048 7143.8751,-712.4219 7155.0678,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="7158.574,-603.8851 7156.1172,-593.5791 7151.6108,-603.1678 7158.574,-603.8851"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="7700.5,-686.9019 7341.5,-686.9019 7341.5,-463.7003 7700.5,-463.7003 7700.5,-686.9019"/>
<text text-anchor="middle" x="7521" y="-671.9013" font-family="Inconsolata" font-size="14.00" fill="#000000">local assert = assert</text>
<text text-anchor="middle" x="7521" y="-656.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">local string, io = assert( string ), assert( io )</text>
<text text-anchor="middle" x="7521" y="-641.1012" font-family="Inconsolata" font-size="14.00" fill="#000000">local V = string.sub( assert( _VERSION ), &#45;4 )</text>
<text text-anchor="middle" x="7521" y="-625.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local _G = assert( _G )</text>
<text text-anchor="middle" x="7521" y="-610.3012" font-family="Inconsolata" font-size="14.00" fill="#000000">local error = assert( error )</text>
<text text-anchor="middle" x="7521" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000">local pairs = assert( pairs )</text>
<text text-anchor="middle" x="7521" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000">local next = assert( next )</text>
<text text-anchor="middle" x="7521" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000">local type = assert( type )</text>
<text text-anchor="middle" x="7521" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000">local tostring = assert( tostring )</text>
<text text-anchor="middle" x="7521" y="-533.301" font-family="Inconsolata" font-size="14.00" fill="#000000">local setmetatable = assert( setmetatable )</text>
<text text-anchor="middle" x="7521" y="-517.901" font-family="Inconsolata" font-size="14.00" fill="#000000">if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="7521" y="-502.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local setfenv = assert( setfenv )</text>
<text text-anchor="middle" x="7521" y="-487.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local getfenv = assert( getfenv )</text>
<text text-anchor="middle" x="7521" y="-471.7009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_51&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_51&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7386.9812,-1188.098C7402.5163,-1117.0644 7459.8955,-854.6999 7494.3364,-697.2197"/>
<polygon fill="#000000" stroke="#000000" points="7497.8537,-697.5185 7496.5711,-687.0016 7491.0153,-696.0229 7497.8537,-697.5185"/>
</g>
<!-- leaf_63 -->
<g id="node64" class="node">
<title>leaf_63</title>
<polygon fill="none" stroke="#c0c0c0" points="7773,-593.3011 7719,-593.3011 7719,-557.3011 7773,-557.3011 7773,-593.3011"/>
</g>
<!-- header_57&#45;&gt;leaf_63 -->
<g id="edge63" class="edge">
<title>header_57&#45;&gt;leaf_63</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7762.5096,-1188.098C7760.12,-1099.4048 7749.6942,-712.4219 7746.7669,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="7750.2606,-603.4812 7746.4924,-593.5791 7743.2631,-603.6697 7750.2606,-603.4812"/>
</g>
<!-- leaf_64 -->
<g id="node65" class="node">
<title>leaf_64</title>
<polygon fill="none" stroke="#c0c0c0" points="7845,-593.3011 7791,-593.3011 7791,-557.3011 7845,-557.3011 7845,-593.3011"/>
</g>
<!-- block_58&#45;&gt;leaf_64 -->
<g id="edge64" class="edge">
<title>block_58&#45;&gt;leaf_64</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7886.572,-1189.3488C7874.5255,-1179.5361 7861.0901,-1166.0734 7854,-1150.6022 7765.6401,-957.7921 7798.9083,-689.9302 7812.9789,-603.4302"/>
<polygon fill="#000000" stroke="#000000" points="7816.4677,-603.7876 7814.6679,-593.3468 7809.5639,-602.6312 7816.4677,-603.7876"/>
</g>
<!-- leaf_65 -->
<g id="node66" class="node">
<title>leaf_65</title>
<polygon fill="none" stroke="#c0c0c0" points="8369,-1150.4033 7863,-1150.4033 7863,-.1989 8369,-.1989 8369,-1150.4033"/>
<text text-anchor="middle" x="8116" y="-1135.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local function make_ast_node(id, first, t, last, str, metas, offset)</text>
<text text-anchor="middle" x="8116" y="-1120.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="8116" y="-1104.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.first = first + offset</text>
<text text-anchor="middle" x="8116" y="-1089.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.last &#160;= last + offset &#45; 1</text>
<text text-anchor="middle" x="8116" y="-1073.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;t.str &#160;&#160;= str</text>
<text text-anchor="middle" x="8116" y="-1058.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;if metas[id] then</text>
<text text-anchor="middle" x="8116" y="-1043.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;t = metas[id](t, str)</text>
<text text-anchor="middle" x="8116" y="-1027.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;assert(t.id == id)</text>
<text text-anchor="middle" x="8116" y="-1012.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;else</text>
<text text-anchor="middle" x="8116" y="-996.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;t.id = id</text>
<text text-anchor="middle" x="8116" y="-981.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setmetatable(t, {__index = Node,</text>
<text text-anchor="middle" x="8116" y="-966.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;__tostring = Node.toString})</text>
<text text-anchor="middle" x="8116" y="-950.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;end</text>
<text text-anchor="middle" x="8116" y="-935.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.isNode, &quot;failed isNode: &quot; .. id)</text>
<text text-anchor="middle" x="8116" y="-919.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;assert(t.str)</text>
<text text-anchor="middle" x="8116" y="-904.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;return t</text>
<text text-anchor="middle" x="8116" y="-889.0017" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="8116" y="-841.6016" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; some useful/common lpeg patterns</text>
<text text-anchor="middle" x="8116" y="-826.2016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cp = L.Cp</text>
<text text-anchor="middle" x="8116" y="-810.8016" font-family="Inconsolata" font-size="14.00" fill="#000000">local Cc = L.Cc</text>
<text text-anchor="middle" x="8116" y="-795.4015" font-family="Inconsolata" font-size="14.00" fill="#000000">local Ct = L.Ct</text>
<text text-anchor="middle" x="8116" y="-780.0015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg1_str = L.Carg(1)</text>
<text text-anchor="middle" x="8116" y="-764.6015" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg2_metas = L.Carg(2)</text>
<text text-anchor="middle" x="8116" y="-749.2014" font-family="Inconsolata" font-size="14.00" fill="#000000">local arg3_offset = L.Carg(3)</text>
<text text-anchor="middle" x="8116" y="-701.8014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; setup an environment where you can easily define lpeg grammars</text>
<text text-anchor="middle" x="8116" y="-686.4014" font-family="Inconsolata" font-size="14.00" fill="#000000">&#45;&#45; with lots of syntax sugar</text>
<text text-anchor="middle" x="8116" y="-671.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function define(func, g, e)</text>
<text text-anchor="middle" x="8116" y="-655.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;g = g or {}</text>
<text text-anchor="middle" x="8116" y="-640.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if e == nil then</text>
<text text-anchor="middle" x="8116" y="-624.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;e = V == &quot; 5.1&quot; and getfenv(func) or _G</text>
<text text-anchor="middle" x="8116" y="-609.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8116" y="-594.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local suppressed = {}</text>
<text text-anchor="middle" x="8116" y="-578.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env = {}</text>
<text text-anchor="middle" x="8116" y="-563.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;local env_index = {</text>
<text text-anchor="middle" x="8116" y="-547.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;START = function(name) g[1] = name end,</text>
<text text-anchor="middle" x="8116" y="-532.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;SUPPRESS = function(...)</text>
<text text-anchor="middle" x="8116" y="-517.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;suppressed = {}</text>
<text text-anchor="middle" x="8116" y="-501.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;for i = 1, select(&#39;#&#39;, ...) do</text>
<text text-anchor="middle" x="8116" y="-486.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;suppressed[select(i, ... )] = true</text>
<text text-anchor="middle" x="8116" y="-470.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8116" y="-455.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end,</text>
<text text-anchor="middle" x="8116" y="-440.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;V = L.V,</text>
<text text-anchor="middle" x="8116" y="-424.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;P = L.P,</text>
<text text-anchor="middle" x="8116" y="-409.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;}</text>
<text text-anchor="middle" x="8116" y="-377.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env_index, { __index = e })</text>
<text text-anchor="middle" x="8116" y="-362.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;setmetatable(env, {</text>
<text text-anchor="middle" x="8116" y="-347.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__index = env_index,</text>
<text text-anchor="middle" x="8116" y="-331.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;__newindex = function( _, name, val )</text>
<text text-anchor="middle" x="8116" y="-316.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;if suppressed[ name ] then</text>
<text text-anchor="middle" x="8116" y="-300.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = val</text>
<text text-anchor="middle" x="8116" y="-285.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="8116" y="-270.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;g[ name ] = (Cc(name) </text>
<text text-anchor="middle" x="8116" y="-254.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp() </text>
<text text-anchor="middle" x="8116" y="-239.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Ct(val)</text>
<text text-anchor="middle" x="8116" y="-223.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* Cp()</text>
<text text-anchor="middle" x="8116" y="-208.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg1_str</text>
<text text-anchor="middle" x="8116" y="-193.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg2_metas)</text>
<text text-anchor="middle" x="8116" y="-177.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;* arg3_offset / make_ast_node</text>
<text text-anchor="middle" x="8116" y="-162.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8116" y="-146.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8116" y="-131.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;})</text>
<text text-anchor="middle" x="8116" y="-116.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#45;&#45; call passed function with custom environment (5.1&#45; and 5.2&#45;style)</text>
<text text-anchor="middle" x="8116" y="-100.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if V == &quot; 5.1&quot; then</text>
<text text-anchor="middle" x="8116" y="-85.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;setfenv( func, env )</text>
<text text-anchor="middle" x="8116" y="-69.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8116" y="-54.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;func( env )</text>
<text text-anchor="middle" x="8116" y="-39.0001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;assert( g[ 1 ] and g[ g[ 1 ] ], &quot;no start rule defined&quot; )</text>
<text text-anchor="middle" x="8116" y="-23.6001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return g</text>
<text text-anchor="middle" x="8116" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_59&#45;&gt;leaf_65 -->
<g id="edge65" class="edge">
<title>codeblock_59&#45;&gt;leaf_65</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8116,-1188.098C8116,-1180.8307 8116,-1171.5606 8116,-1160.6051"/>
<polygon fill="#000000" stroke="#000000" points="8119.5001,-1160.5516 8116,-1150.5516 8112.5001,-1160.5516 8119.5001,-1160.5516"/>
</g>
<!-- leaf_66 -->
<g id="node67" class="node">
<title>leaf_66</title>
<polygon fill="none" stroke="#c0c0c0" points="8662.5,-641.0015 8387.5,-641.0015 8387.5,-509.6007 8662.5,-509.6007 8662.5,-641.0015"/>
<text text-anchor="middle" x="8525" y="-625.7012" font-family="Inconsolata" font-size="14.00" fill="#000000">local function refineMetas(metas)</text>
<text text-anchor="middle" x="8525" y="-610.3012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;for _,v in pairs(metas) do</text>
<text text-anchor="middle" x="8525" y="-594.9011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not v[&quot;__tostring&quot;] then</text>
<text text-anchor="middle" x="8525" y="-579.5011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;v[&quot;__tostring&quot;] = Node.toString</text>
<text text-anchor="middle" x="8525" y="-564.1011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8525" y="-548.701" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8525" y="-533.301" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;return metas</text>
<text text-anchor="middle" x="8525" y="-517.901" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_60&#45;&gt;leaf_66 -->
<g id="edge66" class="edge">
<title>codeblock_60&#45;&gt;leaf_66</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8420.1158,-1188.098C8433.5581,-1109.5596 8487.0333,-797.1253 8512.0151,-651.1669"/>
<polygon fill="#000000" stroke="#000000" points="8515.5263,-651.3982 8513.7636,-640.9511 8508.6266,-650.2173 8515.5263,-651.3982"/>
</g>
<!-- leaf_67 -->
<g id="node68" class="node">
<title>leaf_67</title>
<polygon fill="none" stroke="#c0c0c0" points="9165.5,-679.5016 8680.5,-679.5016 8680.5,-471.1006 9165.5,-471.1006 9165.5,-679.5016"/>
<text text-anchor="middle" x="8923" y="-664.2013" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(grammar_template, metas)</text>
<text text-anchor="middle" x="8923" y="-648.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;if type(grammar_template) == &#39;function&#39; then</text>
<text text-anchor="middle" x="8923" y="-633.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local metas = metas or {}</text>
<text text-anchor="middle" x="8923" y="-618.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grammar = define(grammar_template, nil, metas)</text>
<text text-anchor="middle" x="8923" y="-602.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local parse = function(str, offset)</text>
<text text-anchor="middle" x="8923" y="-587.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;local offset = offset or 0</text>
<text text-anchor="middle" x="8923" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;return L.match(grammar, str, 1, str, metas, offset) &#45;&#45; other </text>
<text text-anchor="middle" x="8923" y="-556.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="8923" y="-541.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return parse</text>
<text text-anchor="middle" x="8923" y="-525.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;else</text>
<text text-anchor="middle" x="8923" y="-510.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;s:halt(&quot;no way to build grammar out of &quot; .. type(template))</text>
<text text-anchor="middle" x="8923" y="-494.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;end</text>
<text text-anchor="middle" x="8923" y="-479.4009" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_61&#45;&gt;leaf_67 -->
<g id="edge67" class="edge">
<title>codeblock_61&#45;&gt;leaf_67</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M8771.5005,-1188.098C8789.343,-1115.9275 8856.0138,-846.2523 8894.7077,-689.7398"/>
<polygon fill="#000000" stroke="#000000" points="8898.2128,-690.1453 8897.2152,-679.5976 8891.4174,-688.4653 8898.2128,-690.1453"/>
</g>
<!-- leaf_68 -->
<g id="node69" class="node">
<title>leaf_68</title>
<polygon fill="none" stroke="#c0c0c0" points="9270,-593.3011 9184,-593.3011 9184,-557.3011 9270,-557.3011 9270,-593.3011"/>
<text text-anchor="middle" x="9227" y="-571.8011" font-family="Inconsolata" font-size="14.00" fill="#000000">return new</text>
</g>
<!-- codeblock_62&#45;&gt;leaf_68 -->
<g id="edge68" class="edge">
<title>codeblock_62&#45;&gt;leaf_68</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M9172.6156,-1188.098C9180.4869,-1099.4048 9214.8308,-712.4219 9224.4738,-603.7658"/>
<polygon fill="#000000" stroke="#000000" points="9227.9801,-603.8494 9225.3779,-593.5791 9221.0075,-603.2305 9227.9801,-603.8494"/>
</g>
</g>
</svg>