<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1690pt" height="2037pt"
 viewBox="0.00 0.00 1690.10 2036.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2032.8029)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2032.8029 1686.0964,-2032.8029 1686.0964,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="259.0964" cy="-2010.8029" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="259.0964" y="-2006.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 128</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="259.0964" cy="-1938.8029" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="259.0964" y="-1934.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;38</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M259.0964,-1992.6342C259.0964,-1984.9338 259.0964,-1975.7772 259.0964,-1967.2195"/>
<polygon fill="#000000" stroke="#000000" points="262.5965,-1967.2161 259.0964,-1957.2161 255.5965,-1967.2162 262.5965,-1967.2161"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="69.0964" cy="-1866.8029" rx="69.1929" ry="18"/>
<text text-anchor="middle" x="69.0964" y="-1862.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Knit module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M221.5585,-1924.578C191.9597,-1913.3616 150.4403,-1897.6279 118.2021,-1885.4114"/>
<polygon fill="#000000" stroke="#000000" points="119.1099,-1882.0126 108.5185,-1881.7418 116.6294,-1888.5583 119.1099,-1882.0126"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="202.0964" cy="-1866.8029" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="202.0964" y="-1862.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M245.0065,-1921.0051C238.1219,-1912.3089 229.715,-1901.6896 222.1729,-1892.1626"/>
<polygon fill="#000000" stroke="#000000" points="224.7787,-1889.8155 215.8275,-1884.1475 219.2904,-1894.1604 224.7787,-1889.8155"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="317.0964" cy="-1866.8029" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="317.0964" y="-1862.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 4&#45;38</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M273.4334,-1921.0051C280.4388,-1912.3089 288.9932,-1901.6896 296.6677,-1892.1626"/>
<polygon fill="#000000" stroke="#000000" points="299.5767,-1894.1307 303.1243,-1884.1475 294.1254,-1889.7393 299.5767,-1894.1307"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="780.0964" cy="-1866.8029" rx="70.655" ry="18"/>
<text text-anchor="middle" x="780.0964" y="-1862.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 39&#45;128</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M314.3592,-1931.1658C409.117,-1918.0707 602.5428,-1891.34 707.8563,-1876.7861"/>
<polygon fill="#000000" stroke="#000000" points="708.3399,-1880.2527 717.7666,-1875.4166 707.3815,-1873.3186 708.3399,-1880.2527"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="167.0964,-1812.8029 113.0964,-1812.8029 113.0964,-1776.8029 167.0964,-1776.8029 167.0964,-1812.8029"/>
<text text-anchor="middle" x="140.0964" y="-1791.3029" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>block_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M187.4032,-1849.7399C179.9617,-1841.0981 170.7675,-1830.421 162.4694,-1820.7844"/>
<polygon fill="#000000" stroke="#000000" points="164.9453,-1818.2959 155.7679,-1813.002 159.6409,-1822.8636 164.9453,-1818.2959"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="258.0964" cy="-1794.8029" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="258.0964" y="-1790.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;36</text>
</g>
<!-- block_4&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>block_4&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M302.8141,-1849.3737C295.6736,-1840.6598 286.895,-1829.947 279.0122,-1820.3273"/>
<polygon fill="#000000" stroke="#000000" points="281.7024,-1818.0882 272.657,-1812.5718 276.2881,-1822.5249 281.7024,-1818.0882"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="403.0964,-1812.8029 349.0964,-1812.8029 349.0964,-1776.8029 403.0964,-1776.8029 403.0964,-1812.8029"/>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M331.3786,-1849.3737C338.395,-1840.8114 346.9929,-1830.319 354.7685,-1820.8301"/>
<polygon fill="#000000" stroke="#000000" points="357.6984,-1822.7767 361.3295,-1812.8235 352.284,-1818.3399 357.6984,-1822.7767"/>
</g>
<!-- header_10 -->
<g id="node11" class="node">
<title>header_10</title>
<ellipse fill="none" stroke="#000000" cx="578.0964" cy="-1794.8029" rx="128.6478" ry="18"/>
<text text-anchor="middle" x="578.0964" y="-1790.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : knit_dir(knitter, pwd, depth)</text>
</g>
<!-- section_5&#45;&gt;header_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;header_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M738.7312,-1852.0589C708.7905,-1841.3869 667.9568,-1826.8323 634.9524,-1815.0684"/>
<polygon fill="#000000" stroke="#000000" points="636.0202,-1811.7333 625.4255,-1811.6727 633.6699,-1818.327 636.0202,-1811.7333"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="780.0964" cy="-1794.8029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="780.0964" y="-1790.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 39&#45;43</text>
</g>
<!-- section_5&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M780.0964,-1848.6342C780.0964,-1840.9338 780.0964,-1831.7772 780.0964,-1823.2195"/>
<polygon fill="#000000" stroke="#000000" points="783.5965,-1823.2161 780.0964,-1813.2161 776.5965,-1823.2162 783.5965,-1823.2161"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="965.0964" cy="-1794.8029" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="965.0964" y="-1790.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 44&#45;46</text>
</g>
<!-- section_5&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M818.8784,-1851.7093C848.2295,-1840.2862 888.6233,-1824.5654 919.5181,-1812.5414"/>
<polygon fill="#000000" stroke="#000000" points="921.1395,-1815.6662 929.1891,-1808.7776 918.6006,-1809.1428 921.1395,-1815.6662"/>
</g>
<!-- block_13 -->
<g id="node14" class="node">
<title>block_13</title>
<ellipse fill="none" stroke="#000000" cx="1408.0964" cy="-1794.8029" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="1408.0964" y="-1790.6029" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 47&#45;128</text>
</g>
<!-- section_5&#45;&gt;block_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;block_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M844.6448,-1859.4024C964.3214,-1845.6815 1219.4851,-1816.4271 1341.0325,-1802.4917"/>
<polygon fill="#000000" stroke="#000000" points="1341.7768,-1805.9294 1351.313,-1801.3131 1340.9794,-1798.975 1341.7768,-1805.9294"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="392.0964,-1740.6034 68.0964,-1740.6034 68.0964,-1267.4016 392.0964,-1267.4016 392.0964,-1740.6034"/>
<text text-anchor="middle" x="230.0964" y="-1725.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1694.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1678.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;ansi&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1663.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = true</text>
<text text-anchor="middle" x="230.0964" y="-1632.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_file = require &quot;pl.file&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1616.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_dir = require &quot;pl.dir&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1601.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_path = require &quot;pl.path&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1585.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfiles = pl_dir.getfiles</text>
<text text-anchor="middle" x="230.0964" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local getdirectories = pl_dir.getdirectories</text>
<text text-anchor="middle" x="230.0964" y="-1555.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local makepath = pl_dir.makepath</text>
<text text-anchor="middle" x="230.0964" y="-1539.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local extension = pl_path.extension</text>
<text text-anchor="middle" x="230.0964" y="-1524.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">local dirname = pl_path.dirname</text>
<text text-anchor="middle" x="230.0964" y="-1508.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local basename = pl_path.basename</text>
<text text-anchor="middle" x="230.0964" y="-1493.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local read = pl_file.read</text>
<text text-anchor="middle" x="230.0964" y="-1478.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local write = pl_file.write</text>
<text text-anchor="middle" x="230.0964" y="-1462.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local delete = pl_file.delete</text>
<text text-anchor="middle" x="230.0964" y="-1447.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local isdir = pl_path.isdir</text>
<text text-anchor="middle" x="230.0964" y="-1415.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local knitter = require &quot;knit/knitter&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1353.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local walk = require &quot;walk&quot;</text>
<text text-anchor="middle" x="230.0964" y="-1337.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local strHas = walk.strHas</text>
<text text-anchor="middle" x="230.0964" y="-1322.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local endsWith = walk.endsWith</text>
<text text-anchor="middle" x="230.0964" y="-1306.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local subLastFor = walk.subLastFor</text>
<text text-anchor="middle" x="230.0964" y="-1275.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local Doc = require &quot;grym/doc&quot;</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_7&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M256.3448,-1776.612C255.6689,-1769.592 254.8229,-1760.8055 253.8525,-1750.7275"/>
<polygon fill="#000000" stroke="#000000" points="257.328,-1750.3032 252.8856,-1740.6848 250.3602,-1750.9742 257.328,-1750.3032"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="825.5964,-1531.3029 410.5964,-1531.3029 410.5964,-1476.7021 825.5964,-1476.7021 825.5964,-1531.3029"/>
<text text-anchor="middle" x="618.0964" y="-1500.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> Walks a given directory, kniting the contents of =/org/=</text>
<text text-anchor="middle" x="618.0964" y="-1484.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> into =/src/=. </text>
</g>
<!-- block_11&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_11&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M770.2064,-1777.0498C744.2123,-1730.3887 673.5594,-1603.5621 638.4549,-1540.5474"/>
<polygon fill="#000000" stroke="#000000" points="641.4673,-1538.7629 633.5431,-1531.7303 635.3522,-1542.1695 641.4673,-1538.7629"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1308.0964,-1523.3031 844.0964,-1523.3031 844.0964,-1484.7019 1308.0964,-1484.7019 1308.0964,-1523.3031"/>
<text text-anchor="middle" x="1076.0964" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [X] TODO fix up the orb/notes directory so it doesn&#39;t explode</text>
<text text-anchor="middle" x="1076.0964" y="-1492.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;the knit.</text>
</g>
<!-- block_12&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_12&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M972.0399,-1776.612C990.7493,-1727.5968 1042.3306,-1592.4629 1065.0765,-1532.8726"/>
<polygon fill="#000000" stroke="#000000" points="1068.4264,-1533.911 1068.7227,-1523.3203 1061.8866,-1531.4147 1068.4264,-1533.911"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="1408.0964" cy="-1504.0025" rx="82.2579" ry="18"/>
<text text-anchor="middle" x="1408.0964" y="-1499.8025" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 47&#45;127</text>
</g>
<!-- block_13&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_13&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1408.0964,-1776.612C1408.0964,-1727.4482 1408.0964,-1591.6426 1408.0964,-1532.3326"/>
<polygon fill="#000000" stroke="#000000" points="1411.5965,-1532.1865 1408.0964,-1522.1865 1404.5965,-1532.1865 1411.5965,-1532.1865"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1562.0964,-1522.0025 1508.0964,-1522.0025 1508.0964,-1486.0025 1562.0964,-1486.0025 1562.0964,-1522.0025"/>
</g>
<!-- block_13&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_13&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1446.9604,-1780.9683C1465.6636,-1772.3076 1486.6728,-1759.2357 1499.0964,-1740.8029 1542.5426,-1676.3416 1541.7339,-1579.7533 1538.1357,-1532.3311"/>
<polygon fill="#000000" stroke="#000000" points="1541.607,-1531.8462 1537.2637,-1522.1826 1534.6327,-1532.4456 1541.607,-1531.8462"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1682.0964,-1231.3032 1134.0964,-1231.3032 1134.0964,.1011 1682.0964,.1011 1682.0964,-1231.3032"/>
<text text-anchor="middle" x="1408.0964" y="-1216.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_dir(knitter, orb_dir, pwd)</text>
<text text-anchor="middle" x="1408.0964" y="-1200.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local knits = {}</text>
<text text-anchor="middle" x="1408.0964" y="-1185.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(orb_dir, false, false) do</text>
<text text-anchor="middle" x="1408.0964" y="-1169.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir)</text>
<text text-anchor="middle" x="1408.0964" y="-1154.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and not strHas(&quot;src/lib&quot;, dir) then</text>
<text text-anchor="middle" x="1408.0964" y="-1123.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local files = getfiles(dir)</text>
<text text-anchor="middle" x="1408.0964" y="-1107.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot; &#160;* &quot; .. dir)</text>
<text text-anchor="middle" x="1408.0964" y="-1092.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local subdirs = getdirectories(dir)</text>
<text text-anchor="middle" x="1408.0964" y="-1076.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, f in ipairs(files) do</text>
<text text-anchor="middle" x="1408.0964" y="-1061.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if extension(f) == &quot;.orb&quot; then</text>
<text text-anchor="middle" x="1408.0964" y="-1046.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; read and knit</text>
<text text-anchor="middle" x="1408.0964" y="-1030.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:verb(&quot; &#160;&#160;&#160;&#45; &quot; .. f)</text>
<text text-anchor="middle" x="1408.0964" y="-1015.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local orb_f = read(f)</text>
<text text-anchor="middle" x="1408.0964" y="-999.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local knitted = knitter:knit(Doc(orb_f))</text>
<text text-anchor="middle" x="1408.0964" y="-984.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local src_dir = subLastFor(&quot;/orb&quot;, &quot;/src&quot;, dirname(f))</text>
<text text-anchor="middle" x="1408.0964" y="-969.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(src_dir)</text>
<text text-anchor="middle" x="1408.0964" y="-953.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local bare_name = basename(f):sub(1, &#45;5) &#45;&#45; 4 == #&quot;.orb&quot;</text>
<text text-anchor="middle" x="1408.0964" y="-938.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_name = src_dir .. &quot;/&quot; .. bare_name .. &quot;.lua&quot;</text>
<text text-anchor="middle" x="1408.0964" y="-922.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local current_src = read(out_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1408.0964" y="-891.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if knitted ~= &quot;&quot; then &#160;&#160;&#160;</text>
<text text-anchor="middle" x="1408.0964" y="-876.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if knitted ~= current_src then</text>
<text text-anchor="middle" x="1408.0964" y="-860.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot; &#160;&#160;&#160;&#45; &quot; .. out_name))</text>
<text text-anchor="middle" x="1408.0964" y="-845.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;write(out_name, knitted)</text>
<text text-anchor="middle" x="1408.0964" y="-829.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; make a copy of current_src just in case</text>
<text text-anchor="middle" x="1408.0964" y="-814.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_dir = &quot;../tmp&quot; .. src_dir</text>
<text text-anchor="middle" x="1408.0964" y="-799.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(tmp_dir)</text>
<text text-anchor="middle" x="1408.0964" y="-783.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_out = &quot;../tmp&quot; .. out_name</text>
<text text-anchor="middle" x="1408.0964" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;write(tmp_out, current_src)</text>
<text text-anchor="middle" x="1408.0964" y="-736.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;knits[#knits + 1] = out_name</text>
<text text-anchor="middle" x="1408.0964" y="-721.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="1408.0964" y="-706.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:verb(&quot; &#160;&#160;&#160;&#45; &quot; .. out_name)</text>
<text text-anchor="middle" x="1408.0964" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif current_src ~= &quot;&quot; then</text>
<text text-anchor="middle" x="1408.0964" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.red(&quot; &#160;&#160;&#160;&#45; &quot; .. out_name))</text>
<text text-anchor="middle" x="1408.0964" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;delete(out_name)</text>
<text text-anchor="middle" x="1408.0964" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-504.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; collect changed files if any</text>
<text text-anchor="middle" x="1408.0964" y="-488.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grymbacks = &quot;&quot;</text>
<text text-anchor="middle" x="1408.0964" y="-473.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(knits) do</text>
<text text-anchor="middle" x="1408.0964" y="-457.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;grymbacks = grymbacks .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1408.0964" y="-442.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-427.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if grymbacks ~= &quot;&quot; then</text>
<text text-anchor="middle" x="1408.0964" y="-411.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;grymbacks: \n&quot; .. grymbacks)</text>
<text text-anchor="middle" x="1408.0964" y="-396.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-380.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; if nothing changes, no rollback is needed, empty file</text>
<text text-anchor="middle" x="1408.0964" y="-365.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;write(pwd .. &quot;/.grymback&quot;, grymbacks)</text>
<text text-anchor="middle" x="1408.0964" y="-350.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="1408.0964" y="-334.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1408.0964" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_all(knitter, pwd)</text>
<text text-anchor="middle" x="1408.0964" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local did_knit = false</text>
<text text-anchor="middle" x="1408.0964" y="-272.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1408.0964" y="-257.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir) </text>
<text text-anchor="middle" x="1408.0964" y="-241.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and endsWith(&quot;orb&quot;, dir) then</text>
<text text-anchor="middle" x="1408.0964" y="-210.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot;Knit: &quot; .. dir))</text>
<text text-anchor="middle" x="1408.0964" y="-194.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;did_knit = knit_dir(knitter, dir, pwd)</text>
<text text-anchor="middle" x="1408.0964" y="-179.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-164.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-148.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not did_knit then</text>
<text text-anchor="middle" x="1408.0964" y="-133.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;No orb directory to knit. No action taken.&quot;)</text>
<text text-anchor="middle" x="1408.0964" y="-117.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1408.0964" y="-102.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return did_knit</text>
<text text-anchor="middle" x="1408.0964" y="-87.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1408.0964" y="-55.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">knitter.knit_all = knit_all</text>
<text text-anchor="middle" x="1408.0964" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return knitter</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1408.0964,-1485.8538C1408.0964,-1447.8713 1408.0964,-1354.1318 1408.0964,-1241.5753"/>
<polygon fill="#000000" stroke="#000000" points="1411.5965,-1241.3336 1408.0964,-1231.3337 1404.5965,-1241.3337 1411.5965,-1241.3336"/>
</g>
</g>
</svg>