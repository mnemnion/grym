<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="2095pt" height="1810pt"
 viewBox="0.00 0.00 2095.10 1809.60" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 1805.6026)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-1805.6026 2091.0964,-1805.6026 2091.0964,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="272.0964" cy="-1783.6026" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="272.0964" y="-1779.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 118</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="272.0964" cy="-1711.6026" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="272.0964" y="-1707.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;39</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M272.0964,-1765.434C272.0964,-1757.7336 272.0964,-1748.577 272.0964,-1740.0193"/>
<polygon fill="#000000" stroke="#000000" points="275.5965,-1740.0159 272.0964,-1730.0159 268.5965,-1740.0159 275.5965,-1740.0159"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="69.0964" cy="-1639.6026" rx="69.1929" ry="18"/>
<text text-anchor="middle" x="69.0964" y="-1635.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Knit module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M232.9559,-1697.7203C200.7303,-1686.2905 154.8121,-1670.0043 119.779,-1657.5787"/>
<polygon fill="#000000" stroke="#000000" points="120.8018,-1654.2279 110.207,-1654.1837 118.4618,-1660.8252 120.8018,-1654.2279"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="204.0964" cy="-1639.6026" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="204.0964" y="-1635.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M255.6355,-1694.1734C247.1994,-1685.2411 236.7795,-1674.2083 227.5213,-1664.4055"/>
<polygon fill="#000000" stroke="#000000" points="229.8165,-1661.7383 220.4057,-1656.8713 224.7274,-1666.5447 229.8165,-1661.7383"/>
</g>
<!-- codeblock_4 -->
<g id="node5" class="node">
<title>codeblock_4</title>
<ellipse fill="none" stroke="#000000" cx="342.0964" cy="-1639.6026" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="342.0964" y="-1635.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;37</text>
</g>
<!-- section_1&#45;&gt;codeblock_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;codeblock_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M289.0414,-1694.1734C297.7471,-1685.219 308.5051,-1674.1536 318.0532,-1664.3328"/>
<polygon fill="#000000" stroke="#000000" points="320.6034,-1666.7306 325.0647,-1657.1209 315.5844,-1661.8511 320.6034,-1666.7306"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="857.0964" cy="-1639.6026" rx="69.851" ry="18"/>
<text text-anchor="middle" x="857.0964" y="-1635.4026" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 40&#45;118</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M328.4541,-1704.6663C434.8854,-1691.567 665.3649,-1663.2003 783.7122,-1648.6345"/>
<polygon fill="#000000" stroke="#000000" points="784.271,-1652.0922 793.7685,-1647.3968 783.4159,-1645.1447 784.271,-1652.0922"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="94.0964,-1359.1022 40.0964,-1359.1022 40.0964,-1323.1022 94.0964,-1323.1022 94.0964,-1359.1022"/>
</g>
<!-- header_2&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>header_2&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M68.9743,-1621.3794C68.6374,-1571.1077 67.6932,-1430.1845 67.2866,-1369.4934"/>
<polygon fill="#000000" stroke="#000000" points="70.7864,-1369.4425 67.2194,-1359.4662 63.7866,-1369.4895 70.7864,-1369.4425"/>
</g>
<!-- leaf_7 -->
<g id="node8" class="node">
<title>leaf_7</title>
<polygon fill="none" stroke="#c0c0c0" points="166.0964,-1359.1022 112.0964,-1359.1022 112.0964,-1323.1022 166.0964,-1323.1022 166.0964,-1359.1022"/>
<text text-anchor="middle" x="139.0964" y="-1337.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_3&#45;&gt;leaf_7 -->
<g id="edge7" class="edge">
<title>block_3&#45;&gt;leaf_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M192.5147,-1621.8177C186.3989,-1611.6125 179.3079,-1598.3322 175.0964,-1585.6026 150.1432,-1510.1808 142.4535,-1415.9575 140.1084,-1369.5838"/>
<polygon fill="#000000" stroke="#000000" points="143.5954,-1369.217 139.6414,-1359.3876 136.6027,-1369.5374 143.5954,-1369.217"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="508.0964,-1585.603 184.0964,-1585.603 184.0964,-1096.6015 508.0964,-1096.6015 508.0964,-1585.603"/>
<text text-anchor="middle" x="346.0964" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1539.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1523.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;ansi&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = true</text>
<text text-anchor="middle" x="346.0964" y="-1476.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_file = require &quot;pl.file&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1461.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_dir = require &quot;pl.dir&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1446.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_path = require &quot;pl.path&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1430.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfiles = pl_dir.getfiles</text>
<text text-anchor="middle" x="346.0964" y="-1415.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local getdirectories = pl_dir.getdirectories</text>
<text text-anchor="middle" x="346.0964" y="-1399.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local makepath = pl_dir.makepath</text>
<text text-anchor="middle" x="346.0964" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local extension = pl_path.extension</text>
<text text-anchor="middle" x="346.0964" y="-1369.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local dirname = pl_path.dirname</text>
<text text-anchor="middle" x="346.0964" y="-1353.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local basename = pl_path.basename</text>
<text text-anchor="middle" x="346.0964" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local read = pl_file.read</text>
<text text-anchor="middle" x="346.0964" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local write = pl_file.write</text>
<text text-anchor="middle" x="346.0964" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local delete = pl_file.delete</text>
<text text-anchor="middle" x="346.0964" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local isdir = pl_path.isdir</text>
<text text-anchor="middle" x="346.0964" y="-1260.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1229.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local knitter = require &quot;knit/knitter&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local walk = require &quot;walk&quot;</text>
<text text-anchor="middle" x="346.0964" y="-1182.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local strHas = walk.strHas</text>
<text text-anchor="middle" x="346.0964" y="-1167.002" font-family="Inconsolata" font-size="14.00" fill="#000000">local endsWith = walk.endsWith</text>
<text text-anchor="middle" x="346.0964" y="-1151.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local subLastFor = walk.subLastFor</text>
<text text-anchor="middle" x="346.0964" y="-1136.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local writeOnChange = walk.writeOnChange</text>
<text text-anchor="middle" x="346.0964" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local Doc = require &quot;grym/doc&quot;</text>
</g>
<!-- codeblock_4&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_4&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M342.3406,-1621.3794C342.4328,-1614.4967 342.5478,-1605.9146 342.6797,-1596.0719"/>
<polygon fill="#000000" stroke="#000000" points="346.1826,-1595.8713 342.817,-1585.8252 339.1832,-1595.7774 346.1826,-1595.8713"/>
</g>
<!-- header_9 -->
<g id="node10" class="node">
<title>header_9</title>
<ellipse fill="none" stroke="#000000" cx="655.0964" cy="-1341.1022" rx="128.6478" ry="18"/>
<text text-anchor="middle" x="655.0964" y="-1336.9022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : knit_dir(knitter, pwd, depth)</text>
</g>
<!-- section_5&#45;&gt;header_9 -->
<g id="edge9" class="edge">
<title>section_5&#45;&gt;header_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M832.6702,-1622.7261C819.6004,-1612.9026 803.8283,-1599.6976 792.0964,-1585.6026 733.5388,-1515.2501 687.0635,-1416.2655 666.5339,-1368.7185"/>
<polygon fill="#000000" stroke="#000000" points="669.6945,-1367.2073 662.5519,-1359.382 663.2556,-1369.9535 669.6945,-1367.2073"/>
</g>
<!-- block_10 -->
<g id="node11" class="node">
<title>block_10</title>
<ellipse fill="none" stroke="#000000" cx="857.0964" cy="-1341.1022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="857.0964" y="-1336.9022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 40&#45;44</text>
</g>
<!-- section_5&#45;&gt;block_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;block_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M857.0964,-1621.3794C857.0964,-1571.1077 857.0964,-1430.1845 857.0964,-1369.4934"/>
<polygon fill="#000000" stroke="#000000" points="860.5965,-1369.4662 857.0964,-1359.4662 853.5965,-1369.4662 860.5965,-1369.4662"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="1151.0964" cy="-1341.1022" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1151.0964" y="-1336.9022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 45&#45;47</text>
</g>
<!-- section_5&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M879.0457,-1622.5015C891.9249,-1612.1917 908.3222,-1598.5813 922.0964,-1585.6026 1002.5575,-1509.7883 1089.7878,-1411.7579 1129.3728,-1366.3035"/>
<polygon fill="#000000" stroke="#000000" points="1132.061,-1368.5459 1135.9759,-1358.7009 1126.776,-1363.9557 1132.061,-1368.5459"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="1587.0964" cy="-1341.1022" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1587.0964" y="-1336.9022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 48&#45;117</text>
</g>
<!-- section_5&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M922.5553,-1633.1702C1011.0457,-1623.8914 1163.7907,-1605.6496 1216.0964,-1585.6026 1358.1565,-1531.1558 1501.5263,-1415.4844 1559.8717,-1365.2393"/>
<polygon fill="#000000" stroke="#000000" points="1562.2694,-1367.7928 1567.5312,-1358.5969 1557.6833,-1362.5044 1562.2694,-1367.7928"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="549.0964,-548.3009 495.0964,-548.3009 495.0964,-512.3009 549.0964,-512.3009 549.0964,-548.3009"/>
</g>
<!-- header_9&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>header_9&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M646.8787,-1322.8684C627.4696,-1278.8523 578.863,-1162.8577 558.0964,-1060.6018 519.7707,-871.8842 520.0069,-638.4524 521.4034,-558.6106"/>
<polygon fill="#000000" stroke="#000000" points="524.9071,-558.4514 521.6043,-548.3846 517.9085,-558.3139 524.9071,-558.4514"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="982.5964,-557.6013 567.5964,-557.6013 567.5964,-503.0005 982.5964,-503.0005 982.5964,-557.6013"/>
<text text-anchor="middle" x="775.0964" y="-526.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> Walks a given directory, kniting the contents of =/org/=</text>
<text text-anchor="middle" x="775.0964" y="-511.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> into =/src/=. </text>
</g>
<!-- block_10&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_10&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M855.2687,-1323.0307C844.8945,-1220.452 793.3668,-710.956 778.887,-567.7817"/>
<polygon fill="#000000" stroke="#000000" points="782.3593,-567.3303 777.8707,-557.7332 775.3948,-568.0347 782.3593,-567.3303"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1465.0964,-549.6015 1001.0964,-549.6015 1001.0964,-511.0003 1465.0964,-511.0003 1465.0964,-549.6015"/>
<text text-anchor="middle" x="1233.0964" y="-534.501" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [X] TODO fix up the orb/notes directory so it doesn&#39;t explode</text>
<text text-anchor="middle" x="1233.0964" y="-519.1009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;the knit.</text>
</g>
<!-- block_11&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_11&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1152.924,-1323.0307C1163.497,-1218.4873 1216.8148,-691.2905 1230.0964,-559.9638"/>
<polygon fill="#000000" stroke="#000000" points="1233.5957,-560.1463 1231.1198,-549.8448 1226.6313,-559.4419 1233.5957,-560.1463"/>
</g>
<!-- leaf_16 -->
<g id="node17" class="node">
<title>leaf_16</title>
<polygon fill="none" stroke="#c0c0c0" points="2087.0964,-1060.4028 1483.0964,-1060.4028 1483.0964,-.199 2087.0964,-.199 2087.0964,-1060.4028"/>
<text text-anchor="middle" x="1785.0964" y="-1045.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_dir(knitter, orb_dir, pwd)</text>
<text text-anchor="middle" x="1785.0964" y="-1030.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local knits = {}</text>
<text text-anchor="middle" x="1785.0964" y="-1014.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(orb_dir, false, false) do</text>
<text text-anchor="middle" x="1785.0964" y="-999.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir)</text>
<text text-anchor="middle" x="1785.0964" y="-983.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and not strHas(&quot;src/lib&quot;, dir) then</text>
<text text-anchor="middle" x="1785.0964" y="-952.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local files = getfiles(dir)</text>
<text text-anchor="middle" x="1785.0964" y="-937.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot; &#160;* &quot; .. dir)</text>
<text text-anchor="middle" x="1785.0964" y="-921.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local subdirs = getdirectories(dir)</text>
<text text-anchor="middle" x="1785.0964" y="-906.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, f in ipairs(files) do</text>
<text text-anchor="middle" x="1785.0964" y="-890.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if extension(f) == &quot;.orb&quot; then</text>
<text text-anchor="middle" x="1785.0964" y="-875.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; read and knit</text>
<text text-anchor="middle" x="1785.0964" y="-860.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:verb(&quot; &#160;&#160;&#160;&#45; &quot; .. f)</text>
<text text-anchor="middle" x="1785.0964" y="-844.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local orb_f = read(f)</text>
<text text-anchor="middle" x="1785.0964" y="-829.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local knitted = knitter:knit(Doc(orb_f))</text>
<text text-anchor="middle" x="1785.0964" y="-813.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local src_dir = subLastFor(&quot;/orb&quot;, &quot;/src&quot;, dirname(f))</text>
<text text-anchor="middle" x="1785.0964" y="-798.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(src_dir)</text>
<text text-anchor="middle" x="1785.0964" y="-783.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local bare_name = basename(f):sub(1, &#45;5) &#45;&#45; 4 == #&quot;.orb&quot;</text>
<text text-anchor="middle" x="1785.0964" y="-767.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_name = src_dir .. &quot;/&quot; .. bare_name .. &quot;.lua&quot;</text>
<text text-anchor="middle" x="1785.0964" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local current_src = read(out_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1785.0964" y="-736.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local changed = writeOnChange(knitted, current_src, out_name, 0)</text>
<text text-anchor="middle" x="1785.0964" y="-721.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if changed then</text>
<text text-anchor="middle" x="1785.0964" y="-706.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_dir = &quot;../tmp&quot; .. src_dir</text>
<text text-anchor="middle" x="1785.0964" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(tmp_dir)</text>
<text text-anchor="middle" x="1785.0964" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_out = &quot;../tmp&quot; .. out_name</text>
<text text-anchor="middle" x="1785.0964" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;write(tmp_out, current_src)</text>
<text text-anchor="middle" x="1785.0964" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;knits[#knits + 1] = out_name</text>
<text text-anchor="middle" x="1785.0964" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="1785.0964" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-504.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; collect changed files if any</text>
<text text-anchor="middle" x="1785.0964" y="-488.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grymbacks = &quot;&quot;</text>
<text text-anchor="middle" x="1785.0964" y="-473.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(knits) do</text>
<text text-anchor="middle" x="1785.0964" y="-457.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;grymbacks = grymbacks .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1785.0964" y="-442.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-427.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if grymbacks ~= &quot;&quot; then</text>
<text text-anchor="middle" x="1785.0964" y="-411.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;grymbacks: \n&quot; .. grymbacks)</text>
<text text-anchor="middle" x="1785.0964" y="-396.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-380.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; if nothing changes, no rollback is needed, empty file</text>
<text text-anchor="middle" x="1785.0964" y="-365.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;write(pwd .. &quot;/.grymback&quot;, grymbacks)</text>
<text text-anchor="middle" x="1785.0964" y="-350.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="1785.0964" y="-334.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1785.0964" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_all(knitter, pwd)</text>
<text text-anchor="middle" x="1785.0964" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local did_knit = false</text>
<text text-anchor="middle" x="1785.0964" y="-272.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1785.0964" y="-257.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir) </text>
<text text-anchor="middle" x="1785.0964" y="-241.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and endsWith(&quot;orb&quot;, dir) then</text>
<text text-anchor="middle" x="1785.0964" y="-210.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot;Knit: &quot; .. dir))</text>
<text text-anchor="middle" x="1785.0964" y="-194.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;did_knit = knit_dir(knitter, dir, pwd)</text>
<text text-anchor="middle" x="1785.0964" y="-179.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-164.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-148.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not did_knit then</text>
<text text-anchor="middle" x="1785.0964" y="-133.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;No orb directory to knit. No action taken.&quot;)</text>
<text text-anchor="middle" x="1785.0964" y="-117.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1785.0964" y="-102.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return did_knit</text>
<text text-anchor="middle" x="1785.0964" y="-87.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1785.0964" y="-55.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">knitter.knit_all = knit_all</text>
<text text-anchor="middle" x="1785.0964" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return knitter</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_16 -->
<g id="edge16" class="edge">
<title>codeblock_12&#45;&gt;leaf_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1591.5095,-1323.0307C1601.0832,-1283.8269 1625.1712,-1185.1875 1653.2327,-1070.2768"/>
<polygon fill="#000000" stroke="#000000" points="1656.6362,-1071.0928 1655.6085,-1060.5479 1649.8361,-1069.4321 1656.6362,-1071.0928"/>
</g>
</g>
</svg>