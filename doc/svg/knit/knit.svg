<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="1931pt" height="3656pt"
 viewBox="0.00 0.00 1931.00 3656.01" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 3652.0056)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-3652.0056 1927,-3652.0056 1927,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="502" cy="-3630.0056" rx="46.1547" ry="18"/>
<text text-anchor="middle" x="502" y="-3625.8056" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 118</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="502" cy="-3558.0056" rx="60.9826" ry="18"/>
<text text-anchor="middle" x="502" y="-3553.8056" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;39</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M502,-3611.837C502,-3604.1366 502,-3594.98 502,-3586.4223"/>
<polygon fill="#000000" stroke="#000000" points="505.5001,-3586.4188 502,-3576.4189 498.5001,-3586.4189 505.5001,-3586.4188"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="254" cy="-3189.0051" rx="69.1929" ry="18"/>
<text text-anchor="middle" x="254" y="-3184.8051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Knit module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M451.5834,-3547.6954C407.6504,-3537.723 348.4642,-3521.5734 332,-3504.0056 255.4966,-3422.3744 250.7469,-3277.8494 252.4653,-3217.1203"/>
<polygon fill="#000000" stroke="#000000" points="255.9631,-3217.2407 252.8307,-3207.1196 248.9678,-3216.9851 255.9631,-3217.2407"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="387" cy="-3189.0051" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="387" y="-3184.8051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;3</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M476.6964,-3541.4048C464.2928,-3531.9305 450.2781,-3518.9653 442,-3504.0056 389.3505,-3408.8609 385.0703,-3274.9005 385.964,-3217.2248"/>
<polygon fill="#000000" stroke="#000000" points="389.4668,-3217.13 386.1896,-3207.0548 382.4685,-3216.9746 389.4668,-3217.13"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="502" cy="-3189.0051" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="502" y="-3184.8051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 4&#45;39</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M502,-3539.9582C502,-3480.3643 502,-3289.5536 502,-3217.1917"/>
<polygon fill="#000000" stroke="#000000" points="505.5001,-3217.0178 502,-3207.0179 498.5001,-3217.0179 505.5001,-3217.0178"/>
</g>
<!-- section_5 -->
<g id="node6" class="node">
<title>section_5</title>
<ellipse fill="none" stroke="#000000" cx="878" cy="-3189.0051" rx="69.851" ry="18"/>
<text text-anchor="middle" x="878" y="-3184.8051" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 40&#45;118</text>
</g>
<!-- section_1&#45;&gt;section_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;section_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M521.6846,-3540.7436C533.5077,-3530.2638 548.7735,-3516.5344 562,-3504.0056 673.2231,-3398.6497 801.1954,-3268.0757 853.6556,-3214.1285"/>
<polygon fill="#000000" stroke="#000000" points="856.3786,-3216.3485 860.8367,-3206.7372 851.358,-3211.4706 856.3786,-3216.3485"/>
</g>
<!-- leaf_20 -->
<g id="node21" class="node">
<title>leaf_20</title>
<polygon fill="none" stroke="#c0c0c0" points="1290,-3504.0061 966,-3504.0061 966,-2874.0042 1290,-2874.0042 1290,-3504.0061"/>
<text text-anchor="middle" x="1128" y="-3488.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Knit module</text>
<text text-anchor="middle" x="1128" y="-3473.4056" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1128" y="-3442.0056" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="1128" y="-3426.6055" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1128" y="-3395.2055" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="1128" y="-3379.8055" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;ansi&quot;</text>
<text text-anchor="middle" x="1128" y="-3364.4054" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = true</text>
<text text-anchor="middle" x="1128" y="-3333.0054" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_file = require &quot;pl.file&quot;</text>
<text text-anchor="middle" x="1128" y="-3317.6054" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_dir = require &quot;pl.dir&quot;</text>
<text text-anchor="middle" x="1128" y="-3302.2053" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_path = require &quot;pl.path&quot;</text>
<text text-anchor="middle" x="1128" y="-3286.8053" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfiles = pl_dir.getfiles</text>
<text text-anchor="middle" x="1128" y="-3271.4053" font-family="Inconsolata" font-size="14.00" fill="#000000">local getdirectories = pl_dir.getdirectories</text>
<text text-anchor="middle" x="1128" y="-3256.0052" font-family="Inconsolata" font-size="14.00" fill="#000000">local makepath = pl_dir.makepath</text>
<text text-anchor="middle" x="1128" y="-3240.6052" font-family="Inconsolata" font-size="14.00" fill="#000000">local extension = pl_path.extension</text>
<text text-anchor="middle" x="1128" y="-3225.2052" font-family="Inconsolata" font-size="14.00" fill="#000000">local dirname = pl_path.dirname</text>
<text text-anchor="middle" x="1128" y="-3209.8051" font-family="Inconsolata" font-size="14.00" fill="#000000">local basename = pl_path.basename</text>
<text text-anchor="middle" x="1128" y="-3194.4051" font-family="Inconsolata" font-size="14.00" fill="#000000">local read = pl_file.read</text>
<text text-anchor="middle" x="1128" y="-3179.0051" font-family="Inconsolata" font-size="14.00" fill="#000000">local write = pl_file.write</text>
<text text-anchor="middle" x="1128" y="-3163.6051" font-family="Inconsolata" font-size="14.00" fill="#000000">local delete = pl_file.delete</text>
<text text-anchor="middle" x="1128" y="-3148.205" font-family="Inconsolata" font-size="14.00" fill="#000000">local isdir = pl_path.isdir</text>
<text text-anchor="middle" x="1128" y="-3116.805" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1128" y="-3085.405" font-family="Inconsolata" font-size="14.00" fill="#000000">local knitter = require &quot;knit/knitter&quot;</text>
<text text-anchor="middle" x="1128" y="-3054.0049" font-family="Inconsolata" font-size="14.00" fill="#000000">local walk = require &quot;walk&quot;</text>
<text text-anchor="middle" x="1128" y="-3038.6049" font-family="Inconsolata" font-size="14.00" fill="#000000">local strHas = walk.strHas</text>
<text text-anchor="middle" x="1128" y="-3023.2049" font-family="Inconsolata" font-size="14.00" fill="#000000">local endsWith = walk.endsWith</text>
<text text-anchor="middle" x="1128" y="-3007.8048" font-family="Inconsolata" font-size="14.00" fill="#000000">local subLastFor = walk.subLastFor</text>
<text text-anchor="middle" x="1128" y="-2992.4048" font-family="Inconsolata" font-size="14.00" fill="#000000">local writeOnChange = walk.writeOnChange</text>
<text text-anchor="middle" x="1128" y="-2961.0048" font-family="Inconsolata" font-size="14.00" fill="#000000">local Doc = require &quot;grym/doc&quot;</text>
<text text-anchor="middle" x="1128" y="-2929.6047" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="1128" y="-2882.2047" font-family="Inconsolata" font-size="14.00" fill="#000000">*</text>
</g>
<!-- section_1&#45;&gt;leaf_20 -->
<g id="edge20" class="edge">
<title>section_1&#45;&gt;leaf_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M561.2776,-3554.0072C677.0711,-3545.7591 924.861,-3525.7951 957,-3504.0056 957.1851,-3503.8801 957.37,-3503.7544 957.5547,-3503.6283"/>
<polygon fill="#000000" stroke="#000000" points="959.6406,-3506.4396 965.7449,-3497.78 955.5727,-3500.7429 959.6406,-3506.4396"/>
</g>
<!-- leaf_6 -->
<g id="node7" class="node">
<title>leaf_6</title>
<polygon fill="none" stroke="#c0c0c0" points="293,-2247.8037 239,-2247.8037 239,-2211.8037 293,-2211.8037 293,-2247.8037"/>
<text text-anchor="middle" x="266" y="-2226.3037" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- block_3&#45;&gt;leaf_6 -->
<g id="edge6" class="edge">
<title>block_3&#45;&gt;leaf_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M387.0432,-3170.9858C386.5092,-3121.2451 380.5349,-2978.7803 332,-2874.0047 323.2458,-2855.1065 309.6659,-2857.3699 302,-2838.0047 219.1239,-2628.6463 249.1837,-2346.9284 261.6643,-2257.9478"/>
<polygon fill="#000000" stroke="#000000" points="265.1588,-2258.2368 263.1248,-2247.839 258.2308,-2257.2358 265.1588,-2258.2368"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="384" cy="-2229.8037" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="384" y="-2225.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 4&#45;37</text>
</g>
<!-- block_4&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>block_4&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M499.7482,-3170.7003C485.2618,-3052.9432 405.2309,-2402.3863 387.4855,-2258.1369"/>
<polygon fill="#000000" stroke="#000000" points="390.9226,-2257.41 386.2277,-2247.9122 383.975,-2258.2648 390.9226,-2257.41"/>
</g>
<!-- leaf_9 -->
<g id="node10" class="node">
<title>leaf_9</title>
<polygon fill="none" stroke="#c0c0c0" points="529,-2247.8037 475,-2247.8037 475,-2211.8037 529,-2211.8037 529,-2247.8037"/>
</g>
<!-- block_4&#45;&gt;leaf_9 -->
<g id="edge9" class="edge">
<title>block_4&#45;&gt;leaf_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M502,-3170.7003C502,-3052.9432 502,-2402.3863 502,-2258.1369"/>
<polygon fill="#000000" stroke="#000000" points="505.5001,-2257.9122 502,-2247.9122 498.5001,-2257.9123 505.5001,-2257.9122"/>
</g>
<!-- header_10 -->
<g id="node11" class="node">
<title>header_10</title>
<ellipse fill="none" stroke="#000000" cx="676" cy="-2229.8037" rx="128.6478" ry="18"/>
<text text-anchor="middle" x="676" y="-2225.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : knit_dir(knitter, pwd, depth)</text>
</g>
<!-- section_5&#45;&gt;header_10 -->
<g id="edge10" class="edge">
<title>section_5&#45;&gt;header_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M874.1452,-3170.7003C849.3216,-3052.8252 712.0698,-2401.0821 681.8758,-2257.7049"/>
<polygon fill="#000000" stroke="#000000" points="685.2992,-2256.9763 679.8135,-2247.9122 678.4494,-2258.4189 685.2992,-2256.9763"/>
</g>
<!-- block_11 -->
<g id="node12" class="node">
<title>block_11</title>
<ellipse fill="none" stroke="#000000" cx="878" cy="-2229.8037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="878" y="-2225.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 40&#45;44</text>
</g>
<!-- section_5&#45;&gt;block_11 -->
<g id="edge11" class="edge">
<title>section_5&#45;&gt;block_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M878,-3170.7003C878,-3052.9432 878,-2402.3863 878,-2258.1369"/>
<polygon fill="#000000" stroke="#000000" points="881.5001,-2257.9122 878,-2247.9122 874.5001,-2257.9123 881.5001,-2257.9122"/>
</g>
<!-- block_12 -->
<g id="node13" class="node">
<title>block_12</title>
<ellipse fill="none" stroke="#000000" cx="1008" cy="-2229.8037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1008" y="-2225.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 45&#45;47</text>
</g>
<!-- section_5&#45;&gt;block_12 -->
<g id="edge12" class="edge">
<title>section_5&#45;&gt;block_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M881.8785,-3170.8167C892.8141,-3119.0155 924.3116,-2966.1743 943,-2838.0047 975.4356,-2615.5535 998.6754,-2345.1057 1005.7478,-2258.1592"/>
<polygon fill="#000000" stroke="#000000" points="1009.2496,-2258.2776 1006.566,-2248.0283 1002.2723,-2257.714 1009.2496,-2258.2776"/>
</g>
<!-- block_13 -->
<g id="node14" class="node">
<title>block_13</title>
<ellipse fill="none" stroke="#000000" cx="1241" cy="-2229.8037" rx="60.1864" ry="18"/>
<text text-anchor="middle" x="1241" y="-2225.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 48&#45;118</text>
</g>
<!-- section_5&#45;&gt;block_13 -->
<g id="edge13" class="edge">
<title>section_5&#45;&gt;block_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M876.869,-3170.8597C874.5896,-3117.6262 875.4265,-2960.2096 957,-2874.0047 994.1027,-2834.7954 1035.4338,-2876.77 1073,-2838.0047 1237.2427,-2668.5193 1244.0254,-2353.5362 1242.0528,-2257.9957"/>
<polygon fill="#000000" stroke="#000000" points="1245.5504,-2257.8548 1241.7942,-2247.9481 1238.5527,-2258.0349 1245.5504,-2257.8548"/>
</g>
<!-- leaf_19 -->
<g id="node20" class="node">
<title>leaf_19</title>
<polygon fill="none" stroke="#c0c0c0" points="1923,-2838.2058 1319,-2838.2058 1319,-1621.4015 1923,-1621.4015 1923,-2838.2058"/>
<text text-anchor="middle" x="1621" y="-2822.8047" font-family="Inconsolata" font-size="14.00" fill="#000000">*** knit_dir(knitter, pwd, depth)</text>
<text text-anchor="middle" x="1621" y="-2791.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> Walks a given directory, kniting the contents of =/org/=</text>
<text text-anchor="middle" x="1621" y="-2776.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> into =/src/=. </text>
<text text-anchor="middle" x="1621" y="-2744.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [X] TODO fix up the orb/notes directory so it doesn&#39;t explode</text>
<text text-anchor="middle" x="1621" y="-2729.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;the knit.</text>
<text text-anchor="middle" x="1621" y="-2697.8045" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="1621" y="-2682.4045" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_dir(knitter, orb_dir, pwd)</text>
<text text-anchor="middle" x="1621" y="-2667.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local knits = {}</text>
<text text-anchor="middle" x="1621" y="-2651.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(orb_dir, false, false) do</text>
<text text-anchor="middle" x="1621" y="-2636.2044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir)</text>
<text text-anchor="middle" x="1621" y="-2620.8044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and not strHas(&quot;src/lib&quot;, dir) then</text>
<text text-anchor="middle" x="1621" y="-2589.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local files = getfiles(dir)</text>
<text text-anchor="middle" x="1621" y="-2574.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot; &#160;* &quot; .. dir)</text>
<text text-anchor="middle" x="1621" y="-2558.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local subdirs = getdirectories(dir)</text>
<text text-anchor="middle" x="1621" y="-2543.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, f in ipairs(files) do</text>
<text text-anchor="middle" x="1621" y="-2527.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if extension(f) == &quot;.orb&quot; then</text>
<text text-anchor="middle" x="1621" y="-2512.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; read and knit</text>
<text text-anchor="middle" x="1621" y="-2497.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:verb(&quot; &#160;&#160;&#160;&#45; &quot; .. f)</text>
<text text-anchor="middle" x="1621" y="-2481.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local orb_f = read(f)</text>
<text text-anchor="middle" x="1621" y="-2466.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local knitted = knitter:knit(Doc(orb_f))</text>
<text text-anchor="middle" x="1621" y="-2450.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local src_dir = subLastFor(&quot;/orb&quot;, &quot;/src&quot;, dirname(f))</text>
<text text-anchor="middle" x="1621" y="-2435.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(src_dir)</text>
<text text-anchor="middle" x="1621" y="-2420.004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local bare_name = basename(f):sub(1, &#45;5) &#45;&#45; 4 == #&quot;.orb&quot;</text>
<text text-anchor="middle" x="1621" y="-2404.604" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_name = src_dir .. &quot;/&quot; .. bare_name .. &quot;.lua&quot;</text>
<text text-anchor="middle" x="1621" y="-2389.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local current_src = read(out_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1621" y="-2373.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local changed = writeOnChange(knitted, current_src, out_name, 0)</text>
<text text-anchor="middle" x="1621" y="-2358.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if changed then</text>
<text text-anchor="middle" x="1621" y="-2343.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_dir = &quot;../tmp&quot; .. src_dir</text>
<text text-anchor="middle" x="1621" y="-2327.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(tmp_dir)</text>
<text text-anchor="middle" x="1621" y="-2312.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_out = &quot;../tmp&quot; .. out_name</text>
<text text-anchor="middle" x="1621" y="-2296.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;write(tmp_out, current_src)</text>
<text text-anchor="middle" x="1621" y="-2281.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;knits[#knits + 1] = out_name</text>
<text text-anchor="middle" x="1621" y="-2266.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="1621" y="-2250.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2235.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2219.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2204.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2141.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; collect changed files if any</text>
<text text-anchor="middle" x="1621" y="-2125.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grymbacks = &quot;&quot;</text>
<text text-anchor="middle" x="1621" y="-2110.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(knits) do</text>
<text text-anchor="middle" x="1621" y="-2094.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;grymbacks = grymbacks .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1621" y="-2079.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2064.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if grymbacks ~= &quot;&quot; then</text>
<text text-anchor="middle" x="1621" y="-2048.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;grymbacks: \n&quot; .. grymbacks)</text>
<text text-anchor="middle" x="1621" y="-2033.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-2017.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; if nothing changes, no rollback is needed, empty file</text>
<text text-anchor="middle" x="1621" y="-2002.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;write(pwd .. &quot;/.grymback&quot;, grymbacks)</text>
<text text-anchor="middle" x="1621" y="-1987.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="1621" y="-1971.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1621" y="-1940.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_all(knitter, pwd)</text>
<text text-anchor="middle" x="1621" y="-1924.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local did_knit = false</text>
<text text-anchor="middle" x="1621" y="-1909.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1621" y="-1894.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir) </text>
<text text-anchor="middle" x="1621" y="-1878.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and endsWith(&quot;orb&quot;, dir) then</text>
<text text-anchor="middle" x="1621" y="-1847.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot;Knit: &quot; .. dir))</text>
<text text-anchor="middle" x="1621" y="-1831.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;did_knit = knit_dir(knitter, dir, pwd)</text>
<text text-anchor="middle" x="1621" y="-1816.4029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-1801.0029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-1785.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not did_knit then</text>
<text text-anchor="middle" x="1621" y="-1770.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;No orb directory to knit. No action taken.&quot;)</text>
<text text-anchor="middle" x="1621" y="-1754.8028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1621" y="-1739.4028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return did_knit</text>
<text text-anchor="middle" x="1621" y="-1724.0027" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1621" y="-1692.6027" font-family="Inconsolata" font-size="14.00" fill="#000000">knitter.knit_all = knit_all</text>
<text text-anchor="middle" x="1621" y="-1645.2027" font-family="Inconsolata" font-size="14.00" fill="#000000">return knitter</text>
<text text-anchor="middle" x="1621" y="-1629.8027" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_5&#45;&gt;leaf_19 -->
<g id="edge19" class="edge">
<title>section_5&#45;&gt;leaf_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M876.1575,-3170.8333C871.7293,-3116.1395 866.8292,-2952.0361 957,-2874.0047 1016.6252,-2822.4066 1244.9155,-2882.5192 1310,-2838.0047 1310.1835,-2837.8791 1310.367,-2837.7535 1310.5503,-2837.6277"/>
<polygon fill="#000000" stroke="#000000" points="1312.5676,-2840.4879 1318.7318,-2831.8709 1308.5394,-2834.763 1312.5676,-2840.4879"/>
</g>
<!-- leaf_8 -->
<g id="node9" class="node">
<title>leaf_8</title>
<polygon fill="none" stroke="#c0c0c0" points="324,-1585.603 0,-1585.603 0,-1096.6015 324,-1096.6015 324,-1585.603"/>
<text text-anchor="middle" x="162" y="-1570.4026" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="162" y="-1539.0026" font-family="Inconsolata" font-size="14.00" fill="#000000">local s = require &quot;status&quot;</text>
<text text-anchor="middle" x="162" y="-1523.6026" font-family="Inconsolata" font-size="14.00" fill="#000000">local a = require &quot;ansi&quot;</text>
<text text-anchor="middle" x="162" y="-1508.2025" font-family="Inconsolata" font-size="14.00" fill="#000000">s.chatty = true</text>
<text text-anchor="middle" x="162" y="-1476.8025" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_file = require &quot;pl.file&quot;</text>
<text text-anchor="middle" x="162" y="-1461.4025" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_dir = require &quot;pl.dir&quot;</text>
<text text-anchor="middle" x="162" y="-1446.0024" font-family="Inconsolata" font-size="14.00" fill="#000000">local pl_path = require &quot;pl.path&quot;</text>
<text text-anchor="middle" x="162" y="-1430.6024" font-family="Inconsolata" font-size="14.00" fill="#000000">local getfiles = pl_dir.getfiles</text>
<text text-anchor="middle" x="162" y="-1415.2024" font-family="Inconsolata" font-size="14.00" fill="#000000">local getdirectories = pl_dir.getdirectories</text>
<text text-anchor="middle" x="162" y="-1399.8023" font-family="Inconsolata" font-size="14.00" fill="#000000">local makepath = pl_dir.makepath</text>
<text text-anchor="middle" x="162" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000">local extension = pl_path.extension</text>
<text text-anchor="middle" x="162" y="-1369.0023" font-family="Inconsolata" font-size="14.00" fill="#000000">local dirname = pl_path.dirname</text>
<text text-anchor="middle" x="162" y="-1353.6022" font-family="Inconsolata" font-size="14.00" fill="#000000">local basename = pl_path.basename</text>
<text text-anchor="middle" x="162" y="-1338.2022" font-family="Inconsolata" font-size="14.00" fill="#000000">local read = pl_file.read</text>
<text text-anchor="middle" x="162" y="-1322.8022" font-family="Inconsolata" font-size="14.00" fill="#000000">local write = pl_file.write</text>
<text text-anchor="middle" x="162" y="-1307.4022" font-family="Inconsolata" font-size="14.00" fill="#000000">local delete = pl_file.delete</text>
<text text-anchor="middle" x="162" y="-1292.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local isdir = pl_path.isdir</text>
<text text-anchor="middle" x="162" y="-1260.6021" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="162" y="-1229.2021" font-family="Inconsolata" font-size="14.00" fill="#000000">local knitter = require &quot;knit/knitter&quot;</text>
<text text-anchor="middle" x="162" y="-1197.802" font-family="Inconsolata" font-size="14.00" fill="#000000">local walk = require &quot;walk&quot;</text>
<text text-anchor="middle" x="162" y="-1182.402" font-family="Inconsolata" font-size="14.00" fill="#000000">local strHas = walk.strHas</text>
<text text-anchor="middle" x="162" y="-1167.002" font-family="Inconsolata" font-size="14.00" fill="#000000">local endsWith = walk.endsWith</text>
<text text-anchor="middle" x="162" y="-1151.6019" font-family="Inconsolata" font-size="14.00" fill="#000000">local subLastFor = walk.subLastFor</text>
<text text-anchor="middle" x="162" y="-1136.2019" font-family="Inconsolata" font-size="14.00" fill="#000000">local writeOnChange = walk.writeOnChange</text>
<text text-anchor="middle" x="162" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000">local Doc = require &quot;grym/doc&quot;</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_8 -->
<g id="edge8" class="edge">
<title>codeblock_7&#45;&gt;leaf_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M383.7093,-2211.6807C382.0686,-2137.0614 371.3202,-1846.9126 302,-1621.6026 299.3261,-1612.9116 296.4049,-1604.1603 293.2801,-1595.3935"/>
<polygon fill="#000000" stroke="#000000" points="296.5243,-1594.0736 289.8115,-1585.8768 289.9475,-1596.4707 296.5243,-1594.0736"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="757.5,-1368.4027 342.5,-1368.4027 342.5,-1313.8018 757.5,-1313.8018 757.5,-1368.4027"/>
<text text-anchor="middle" x="550" y="-1337.3023" font-family="Inconsolata" font-size="14.00" fill="#000000"> Walks a given directory, kniting the contents of =/org/=</text>
<text text-anchor="middle" x="550" y="-1321.9022" font-family="Inconsolata" font-size="14.00" fill="#000000"> into =/src/=. </text>
</g>
<!-- block_11&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_11&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M880.9735,-2211.6102C892.6655,-2134.2798 929.4016,-1827.4291 814,-1621.6026 801.1319,-1598.6514 786.2655,-1603.5243 767,-1585.6026 693.1932,-1516.9442 617.3462,-1425.8642 577.8174,-1376.5239"/>
<polygon fill="#000000" stroke="#000000" points="580.5331,-1374.3159 571.5599,-1368.6827 575.0618,-1378.6821 580.5331,-1374.3159"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1240,-1360.4028 776,-1360.4028 776,-1321.8017 1240,-1321.8017 1240,-1360.4028"/>
<text text-anchor="middle" x="1008" y="-1345.3023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; [X] TODO fix up the orb/notes directory so it doesn&#39;t explode</text>
<text text-anchor="middle" x="1008" y="-1329.9022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;the knit.</text>
</g>
<!-- block_12&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_12&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1008,-2211.6488C1008,-2100.4445 1008,-1511.4602 1008,-1371.1323"/>
<polygon fill="#000000" stroke="#000000" points="1011.5001,-1370.737 1008,-1360.7371 1004.5001,-1370.7371 1011.5001,-1370.737"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="1340" cy="-1341.1022" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="1340" y="-1336.9022" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 48&#45;117</text>
</g>
<!-- block_13&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_13&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1243.0224,-2211.6488C1255.464,-2099.9637 1321.5908,-1506.3573 1336.8547,-1369.3371"/>
<polygon fill="#000000" stroke="#000000" points="1340.352,-1369.5543 1337.9808,-1359.2282 1333.3951,-1368.7792 1340.352,-1369.5543"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1494,-1359.1022 1440,-1359.1022 1440,-1323.1022 1494,-1323.1022 1494,-1359.1022"/>
</g>
<!-- block_13&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_13&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1236.6796,-2211.6886C1218.6831,-2131.4088 1157.4855,-1803.673 1310,-1621.6026 1346.029,-1578.5915 1394.2615,-1628.0094 1431,-1585.6026 1484.2633,-1524.1216 1478.3796,-1419.6051 1471.7424,-1369.5156"/>
<polygon fill="#000000" stroke="#000000" points="1475.1769,-1368.8088 1470.2922,-1359.4072 1468.2478,-1369.8029 1475.1769,-1368.8088"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1642,-1060.4028 1038,-1060.4028 1038,-.199 1642,-.199 1642,-1060.4028"/>
<text text-anchor="middle" x="1340" y="-1045.4018" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_dir(knitter, orb_dir, pwd)</text>
<text text-anchor="middle" x="1340" y="-1030.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local knits = {}</text>
<text text-anchor="middle" x="1340" y="-1014.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(orb_dir, false, false) do</text>
<text text-anchor="middle" x="1340" y="-999.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir)</text>
<text text-anchor="middle" x="1340" y="-983.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and not strHas(&quot;src/lib&quot;, dir) then</text>
<text text-anchor="middle" x="1340" y="-952.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local files = getfiles(dir)</text>
<text text-anchor="middle" x="1340" y="-937.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot; &#160;* &quot; .. dir)</text>
<text text-anchor="middle" x="1340" y="-921.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local subdirs = getdirectories(dir)</text>
<text text-anchor="middle" x="1340" y="-906.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;for _, f in ipairs(files) do</text>
<text text-anchor="middle" x="1340" y="-890.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if extension(f) == &quot;.orb&quot; then</text>
<text text-anchor="middle" x="1340" y="-875.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; read and knit</text>
<text text-anchor="middle" x="1340" y="-860.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:verb(&quot; &#160;&#160;&#160;&#45; &quot; .. f)</text>
<text text-anchor="middle" x="1340" y="-844.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local orb_f = read(f)</text>
<text text-anchor="middle" x="1340" y="-829.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local knitted = knitter:knit(Doc(orb_f))</text>
<text text-anchor="middle" x="1340" y="-813.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local src_dir = subLastFor(&quot;/orb&quot;, &quot;/src&quot;, dirname(f))</text>
<text text-anchor="middle" x="1340" y="-798.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(src_dir)</text>
<text text-anchor="middle" x="1340" y="-783.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local bare_name = basename(f):sub(1, &#45;5) &#45;&#45; 4 == #&quot;.orb&quot;</text>
<text text-anchor="middle" x="1340" y="-767.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local out_name = src_dir .. &quot;/&quot; .. bare_name .. &quot;.lua&quot;</text>
<text text-anchor="middle" x="1340" y="-752.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local current_src = read(out_name) or &quot;&quot;</text>
<text text-anchor="middle" x="1340" y="-736.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local changed = writeOnChange(knitted, current_src, out_name, 0)</text>
<text text-anchor="middle" x="1340" y="-721.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if changed then</text>
<text text-anchor="middle" x="1340" y="-706.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_dir = &quot;../tmp&quot; .. src_dir</text>
<text text-anchor="middle" x="1340" y="-690.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;makepath(tmp_dir)</text>
<text text-anchor="middle" x="1340" y="-675.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local tmp_out = &quot;../tmp&quot; .. out_name</text>
<text text-anchor="middle" x="1340" y="-659.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;write(tmp_out, current_src)</text>
<text text-anchor="middle" x="1340" y="-644.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;knits[#knits + 1] = out_name</text>
<text text-anchor="middle" x="1340" y="-629.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end &#160;&#160;&#160;&#160;</text>
<text text-anchor="middle" x="1340" y="-613.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-598.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-582.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-567.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-504.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; collect changed files if any</text>
<text text-anchor="middle" x="1340" y="-488.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local grymbacks = &quot;&quot;</text>
<text text-anchor="middle" x="1340" y="-473.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(knits) do</text>
<text text-anchor="middle" x="1340" y="-457.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;grymbacks = grymbacks .. v .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1340" y="-442.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-427.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if grymbacks ~= &quot;&quot; then</text>
<text text-anchor="middle" x="1340" y="-411.6007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;grymbacks: \n&quot; .. grymbacks)</text>
<text text-anchor="middle" x="1340" y="-396.2007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-380.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; if nothing changes, no rollback is needed, empty file</text>
<text text-anchor="middle" x="1340" y="-365.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;write(pwd .. &quot;/.grymback&quot;, grymbacks)</text>
<text text-anchor="middle" x="1340" y="-350.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return true</text>
<text text-anchor="middle" x="1340" y="-334.6005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1340" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000">local function knit_all(knitter, pwd)</text>
<text text-anchor="middle" x="1340" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local did_knit = false</text>
<text text-anchor="middle" x="1340" y="-272.4004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for dir in pl_dir.walk(pwd, false, false) do</text>
<text text-anchor="middle" x="1340" y="-257.0004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not strHas(&quot;.git&quot;, dir) and isdir(dir) </text>
<text text-anchor="middle" x="1340" y="-241.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and endsWith(&quot;orb&quot;, dir) then</text>
<text text-anchor="middle" x="1340" y="-210.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(a.green(&quot;Knit: &quot; .. dir))</text>
<text text-anchor="middle" x="1340" y="-194.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;did_knit = knit_dir(knitter, dir, pwd)</text>
<text text-anchor="middle" x="1340" y="-179.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-164.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-148.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if not did_knit then</text>
<text text-anchor="middle" x="1340" y="-133.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;s:chat(&quot;No orb directory to knit. No action taken.&quot;)</text>
<text text-anchor="middle" x="1340" y="-117.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1340" y="-102.4001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return did_knit</text>
<text text-anchor="middle" x="1340" y="-87.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1340" y="-55.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">knitter.knit_all = knit_all</text>
<text text-anchor="middle" x="1340" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return knitter</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1340,-1323.0307C1340,-1283.8663 1340,-1185.3855 1340,-1070.6229"/>
<polygon fill="#000000" stroke="#000000" points="1343.5001,-1070.5479 1340,-1060.5479 1336.5001,-1070.5479 1343.5001,-1070.5479"/>
</g>
</g>
</svg>