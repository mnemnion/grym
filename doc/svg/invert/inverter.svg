<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="6436pt" height="7979pt"
 viewBox="0.00 0.00 6436.00 7979.21" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 7975.2127)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-7975.2127 6432,-7975.2127 6432,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1303" cy="-7953.2127" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1303" y="-7949.0127" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 290</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1303" cy="-7881.2127" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1303" y="-7877.0127" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;205</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1303,-7935.0441C1303,-7927.3437 1303,-7918.1871 1303,-7909.6294"/>
<polygon fill="#000000" stroke="#000000" points="1306.5001,-7909.626 1303,-7899.626 1299.5001,-7909.626 1306.5001,-7909.626"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="790" cy="-6224.7102" rx="83.677" ry="18"/>
<text text-anchor="middle" x="790" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Inverter module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1238.3942,-7877.3885C1126.6332,-7870.1274 906.8146,-7852.753 883,-7827.2127 442.5284,-7354.8234 723.3787,-6424.3166 780.5003,-6252.3745"/>
<polygon fill="#000000" stroke="#000000" points="783.851,-6253.3909 783.7129,-6242.797 777.2144,-6251.1648 783.851,-6253.3909"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="938" cy="-6224.7102" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="938" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;4</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1237.5633,-7879.1745C1156.2046,-7875.1238 1024.2075,-7863.0596 993,-7827.2127 885.6465,-7703.9 929.0085,-6457.3684 936.8745,-6252.9898"/>
<polygon fill="#000000" stroke="#000000" points="940.3802,-6252.9092 937.2714,-6242.7807 933.3854,-6252.6371 940.3802,-6252.9092"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1048" cy="-6224.7102" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1048" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 5&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1244.2757,-7873.1546C1191.7948,-7864.6293 1120.5477,-7849.3301 1103,-7827.2127 1001.3824,-7699.1321 1039.9528,-6456.5834 1046.9911,-6252.8929"/>
<polygon fill="#000000" stroke="#000000" points="1050.4951,-6252.8345 1047.3465,-6242.7183 1043.4994,-6252.59 1050.4951,-6252.8345"/>
</g>
<!-- block_5 -->
<g id="node6" class="node">
<title>block_5</title>
<ellipse fill="none" stroke="#000000" cx="1163" cy="-6224.7102" rx="50.8172" ry="18"/>
<text text-anchor="middle" x="1163" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 9&#45;26</text>
</g>
<!-- section_1&#45;&gt;block_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;block_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1274.1035,-7865.0268C1260.6228,-7855.8209 1245.85,-7842.9708 1238,-7827.2127 1093.0301,-7536.199 1150.102,-6443.1611 1161.2716,-6253.0048"/>
<polygon fill="#000000" stroke="#000000" points="1164.7688,-6253.1537 1161.8684,-6242.9637 1157.7811,-6252.7384 1164.7688,-6253.1537"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1303" cy="-6224.7102" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1303" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 27&#45;28</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1303,-7863.174C1303,-7698.5183 1303,-6457.5223 1303,-6253.1582"/>
<polygon fill="#000000" stroke="#000000" points="1306.5001,-6252.9439 1303,-6242.944 1299.5001,-6252.944 1306.5001,-6252.9439"/>
</g>
<!-- block_7 -->
<g id="node8" class="node">
<title>block_7</title>
<ellipse fill="none" stroke="#000000" cx="1508" cy="-6224.7102" rx="60.9913" ry="18"/>
<text text-anchor="middle" x="1508" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 29&#45;205</text>
</g>
<!-- section_1&#45;&gt;block_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;block_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1331.6285,-7864.8899C1345.0409,-7855.6492 1359.8335,-7842.8091 1368,-7827.2127 1666.2276,-7257.6535 1541.3006,-6416.5653 1513.1036,-6252.8823"/>
<polygon fill="#000000" stroke="#000000" points="1516.4905,-6251.9311 1511.3195,-6242.6839 1509.5952,-6253.1375 1516.4905,-6251.9311"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2177" cy="-6224.7102" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2177" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 66&#45;205</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1365.8319,-7875.9566C1436.8434,-7868.8229 1546.6475,-7853.8083 1578,-7827.2127 2103.2381,-7381.6665 2168.4199,-6428.3823 2176.0382,-6252.8082"/>
<polygon fill="#000000" stroke="#000000" points="2179.5353,-6252.9487 2176.4447,-6242.8147 2172.541,-6252.6641 2179.5353,-6252.9487"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="4477" cy="-6224.7102" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="4477" y="-6220.5102" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 206&#45;245</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1368.7235,-7879.6264C1570.73,-7874.4544 2173.8932,-7856.694 2257,-7827.2127 3304.8653,-7455.493 4291.2068,-6425.2269 4453.6604,-6250.1545"/>
<polygon fill="#000000" stroke="#000000" points="4456.3412,-6252.4106 4460.5642,-6242.6937 4451.2034,-6247.6563 4456.3412,-6252.4106"/>
</g>
<!-- leaf_60 -->
<g id="node61" class="node">
<title>leaf_60</title>
<polygon fill="none" stroke="#c0c0c0" points="5139.5,-7827.2153 4570.5,-7827.2153 4570.5,-4622.205 5139.5,-4622.205 5139.5,-7827.2153"/>
<text text-anchor="middle" x="4855" y="-7812.0127" font-family="Inconsolata" font-size="14.00" fill="#000000"> * Inverter module</text>
<text text-anchor="middle" x="4855" y="-7796.6127" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A work in progress, which also works well enough to invert,</text>
<text text-anchor="middle" x="4855" y="-7781.2127" font-family="Inconsolata" font-size="14.00" fill="#000000"> I may hope, the whole of grym including this file.</text>
<text text-anchor="middle" x="4855" y="-7749.8126" font-family="Inconsolata" font-size="14.00" fill="#000000"> Hence I&#39;m eager to use it and then document it from the grimoire</text>
<text text-anchor="middle" x="4855" y="-7734.4126" font-family="Inconsolata" font-size="14.00" fill="#000000"> side.</text>
<text text-anchor="middle" x="4855" y="-7687.0126" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4855" y="-7671.6125" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="4855" y="-7640.2125" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="4855" y="-7608.8125" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="4855" y="-7577.4125" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="4855" y="-7546.0124" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isBlank(line)</text>
<text text-anchor="middle" x="4855" y="-7530.6124" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local all_blanks = L.match((m.__TAB__ + m._)^0, line)</text>
<text text-anchor="middle" x="4855" y="-7515.2124" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (all_blanks == (#line + 1) or line == &quot;&quot;)</text>
<text text-anchor="middle" x="4855" y="-7499.8123" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-7468.4123" font-family="Inconsolata" font-size="14.00" fill="#000000">local Inv, inv = u.inherit()</text>
<text text-anchor="middle" x="4855" y="-7453.0123" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4855" y="-7405.6122" font-family="Inconsolata" font-size="14.00" fill="#000000"> The default language is Lua.</text>
<text text-anchor="middle" x="4855" y="-7374.2122" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4855" y="-7358.8122" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.lang = &quot;lua&quot;</text>
<text text-anchor="middle" x="4855" y="-7343.4121" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.extension = &quot;.lua&quot;</text>
<text text-anchor="middle" x="4855" y="-7328.0121" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment = L.P&quot;&#45;&#45;&quot;</text>
<text text-anchor="middle" x="4855" y="-7312.6121" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment_len = 3</text>
<text text-anchor="middle" x="4855" y="-7297.212" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.tab_to_space = &quot; &#160;&#160;&quot;</text>
<text text-anchor="middle" x="4855" y="-7265.812" font-family="Inconsolata" font-size="14.00" fill="#000000">local lang_config = { lua = { lang = &quot;lua&quot;, </text>
<text text-anchor="middle" x="4855" y="-7250.412" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;extension = &quot;.lua&quot;,</text>
<text text-anchor="middle" x="4855" y="-7235.012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = L.P&quot;&#45;&#45;&quot;,</text>
<text text-anchor="middle" x="4855" y="-7219.6119" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment_len = 3,</text>
<text text-anchor="middle" x="4855" y="-7204.2119" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tab_to_space = &quot; &#160;&#160;&quot;}}</text>
<text text-anchor="middle" x="4855" y="-7172.8119" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_header(inverter)</text>
<text text-anchor="middle" x="4855" y="-7157.4118" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#!&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4855" y="-7142.0118" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-7110.6118" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_footer(inverter)</text>
<text text-anchor="middle" x="4855" y="-7095.2117" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#/&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4855" y="-7079.8117" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-7048.4117" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.filter(inverter, line)</text>
<text text-anchor="middle" x="4855" y="-7033.0116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if isBlank(line) then</text>
<text text-anchor="middle" x="4855" y="-7017.6116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="4855" y="-7002.2116" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="4855" y="-6986.8115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return line:gsub(&quot;\t&quot;, inverter.tab_to_space):gsub(&quot;\r&quot;, &quot;&quot;)</text>
<text text-anchor="middle" x="4855" y="-6971.4115" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-6956.0115" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-6924.6115" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cat_lines() end &#45;&#45;stub out</text>
<text text-anchor="middle" x="4855" y="-6893.2114" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.matchComment(inverter, line)</text>
<text text-anchor="middle" x="4855" y="-6877.8114" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (L.match(inverter.comment * m._, line) </text>
<text text-anchor="middle" x="4855" y="-6862.4114" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or (L.match(inverter.comment, line) and #line == 2))</text>
<text text-anchor="middle" x="4855" y="-6847.0113" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-6831.6113" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4855" y="-6800.2113" font-family="Inconsolata" font-size="14.00" fill="#000000"> *** matchLineType</text>
<text text-anchor="middle" x="4855" y="-6768.8112" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Matches a line by type (comment, code, or blank) and either</text>
<text text-anchor="middle" x="4855" y="-6753.4112" font-family="Inconsolata" font-size="14.00" fill="#000000"> concatenates to an existing block of this type or starts a new</text>
<text text-anchor="middle" x="4855" y="-6738.0112" font-family="Inconsolata" font-size="14.00" fill="#000000"> one if the latest is different.</text>
<text text-anchor="middle" x="4855" y="-6722.6111" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="4855" y="-6707.2111" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: the latest block.</text>
<text text-anchor="middle" x="4855" y="-6691.8111" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line: line to be matched and added.</text>
<text text-anchor="middle" x="4855" y="-6660.411" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return : the latest block, which may be created here.</text>
<text text-anchor="middle" x="4855" y="-6613.011" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4855" y="-6597.611" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.sortLine(inverter, latest, line)</text>
<text text-anchor="middle" x="4855" y="-6582.211" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = latest or {}</text>
<text text-anchor="middle" x="4855" y="-6550.8109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter:matchComment(line) then</text>
<text text-anchor="middle" x="4855" y="-6535.4109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose</text>
<text text-anchor="middle" x="4855" y="-6520.0109" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;prose&quot; then</text>
<text text-anchor="middle" x="4855" y="-6504.6108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new prose block</text>
<text text-anchor="middle" x="4855" y="-6489.2108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;prose&quot;}</text>
<text text-anchor="middle" x="4855" y="-6473.8108" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="4855" y="-6458.4107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-6443.0107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="4855" y="-6427.6107" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-6412.2106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif isBlank(line) then</text>
<text text-anchor="middle" x="4855" y="-6396.8106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank line</text>
<text text-anchor="middle" x="4855" y="-6381.4106" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;blank&quot; then</text>
<text text-anchor="middle" x="4855" y="-6366.0105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;blank&quot;}</text>
<text text-anchor="middle" x="4855" y="-6350.6105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="4855" y="-6335.2105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-6319.8105" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="4855" y="-6304.4104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-6289.0104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-6273.6104" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code line</text>
<text text-anchor="middle" x="4855" y="-6258.2103" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;code&quot; then</text>
<text text-anchor="middle" x="4855" y="-6242.8103" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new code block</text>
<text text-anchor="middle" x="4855" y="-6227.4103" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;code&quot; }</text>
<text text-anchor="middle" x="4855" y="-6212.0102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="4855" y="-6196.6102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-6181.2102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="4855" y="-6165.8101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-6150.4101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-6119.0101" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="4855" y="-6103.61" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-6088.21" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4855" y="-6056.81" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes blocks and concatenates them into a single string.</text>
<text text-anchor="middle" x="4855" y="-6025.41" font-family="Inconsolata" font-size="14.00" fill="#000000"> Also writes headers and footers, while doing its best to get the </text>
<text text-anchor="middle" x="4855" y="-6010.0099" font-family="Inconsolata" font-size="14.00" fill="#000000"> spacing right.</text>
<text text-anchor="middle" x="4855" y="-5978.6099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; inverter : the Inverter for this language.</text>
<text text-anchor="middle" x="4855" y="-5963.2099" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; blocks: blocks of single lines of types blank, prose, or code.</text>
<text text-anchor="middle" x="4855" y="-5931.8098" font-family="Inconsolata" font-size="14.00" fill="#000000"> #return: a Grimoire document in string form.</text>
<text text-anchor="middle" x="4855" y="-5884.4098" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="4855" y="-5869.0098" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.catBlocks(inverter, blocks)</text>
<text text-anchor="middle" x="4855" y="-5853.6097" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="4855" y="-5838.2097" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function toLines(block) </text>
<text text-anchor="middle" x="4855" y="-5822.8097" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4855" y="-5807.4096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for j = 1, #block do</text>
<text text-anchor="middle" x="4855" y="-5792.0096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="4855" y="-5776.6096" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. block[j] .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4855" y="-5761.2095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-5745.8095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4855" y="-5730.4095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-5715.0095" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4855" y="-5699.6094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[1].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4855" y="-5684.2094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_header()</text>
<text text-anchor="middle" x="4855" y="-5668.8094" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-5653.4093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;phrase = phrase .. toLines(blocks[1]) </text>
<text text-anchor="middle" x="4855" y="-5638.0093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #blocks do</text>
<text text-anchor="middle" x="4855" y="-5622.6093" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4855" y="-5591.2092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="4855" y="-5575.8092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write blanks and code</text>
<text text-anchor="middle" x="4855" y="-5560.4092" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4855" y="-5545.0091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4855" y="-5529.6091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-5498.2091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is </text>
<text text-anchor="middle" x="4855" y="-5482.8091" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose or nothing, write blanks, header, and code</text>
<text text-anchor="middle" x="4855" y="-5467.409" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4855" y="-5452.009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4855" y="-5436.609" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1])</text>
<text text-anchor="middle" x="4855" y="-5421.2089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. inverter:write_header()</text>
<text text-anchor="middle" x="4855" y="-5405.8089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-5374.4089" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is prose, write a blank line, </text>
<text text-anchor="middle" x="4855" y="-5359.0088" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; header, and code. </text>
<text text-anchor="middle" x="4855" y="-5343.6088" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="4855" y="-5328.2088" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. &quot;\n&quot; .. inverter:write_header() </text>
<text text-anchor="middle" x="4855" y="-5312.8087" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-5297.4087" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-5282.0087" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on code in catLines&quot;)</text>
<text text-anchor="middle" x="4855" y="-5266.6086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-5251.2086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="4855" y="-5219.8086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="4855" y="-5204.4086" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write footer, blanks, and prose</text>
<text text-anchor="middle" x="4855" y="-5189.0085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4855" y="-5173.6085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4855" y="-5158.2085" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer() </text>
<text text-anchor="middle" x="4855" y="-5142.8084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-5111.4084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is code, write a footer, newline,</text>
<text text-anchor="middle" x="4855" y="-5096.0084" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; and prose</text>
<text text-anchor="middle" x="4855" y="-5080.6083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif (blocks[i &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="4855" y="-5065.2083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="4855" y="-5049.8083" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot; .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-5018.4082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding line is blank and before that is </text>
<text text-anchor="middle" x="4855" y="-5003.0082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; nothing or more prose, write blanks, then prose.</text>
<text text-anchor="middle" x="4855" y="-4987.6082" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4855" y="-4972.2081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4855" y="-4956.8081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4855" y="-4925.4081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4855" y="-4910.0081" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on prose in catLines&quot;)</text>
<text text-anchor="middle" x="4855" y="-4894.608" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-4879.208" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="4855" y="-4847.808" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-4832.4079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[#blocks].id == &quot;code&quot; or</text>
<text text-anchor="middle" x="4855" y="-4817.0079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[#blocks].id == &quot;blank&quot; </text>
<text text-anchor="middle" x="4855" y="-4801.6079" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and blocks[#blocks &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="4855" y="-4786.2078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="4855" y="-4770.8078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4855" y="-4739.4078" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Note that there may be a final block of blank lines which we are</text>
<text text-anchor="middle" x="4855" y="-4724.0077" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; happy to simply drop. </text>
<text text-anchor="middle" x="4855" y="-4708.6077" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase, linum</text>
<text text-anchor="middle" x="4855" y="-4693.2077" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="4855" y="-4677.8076" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="4855" y="-4630.4076" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_1&#45;&gt;leaf_60 -->
<g id="edge60" class="edge">
<title>section_1&#45;&gt;leaf_60</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1368.872,-7880.6893C1827.7196,-7876.9758 4529.4061,-7853.9843 4561,-7827.2127 4561.4847,-7826.802 4561.9688,-7826.3908 4562.4522,-7825.979"/>
<polygon fill="#000000" stroke="#000000" points="4564.9478,-7828.4485 4570.2298,-7819.2642 4560.3733,-7823.15 4564.9478,-7828.4485"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="450,-3508.9063 0,-3508.9063 0,-3470.3052 450,-3470.3052 450,-3508.9063"/>
<text text-anchor="middle" x="225" y="-3493.8058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A work in progress, which also works well enough to invert,</text>
<text text-anchor="middle" x="225" y="-3478.4057" font-family="Inconsolata" font-size="14.00" fill="#000000"> I may hope, the whole of grym including this file.</text>
</g>
<!-- block_3&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>block_3&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M938.798,-6206.5765C946.052,-6037.6582 997.7322,-4742.8724 883,-4622.2076 817.841,-4553.6793 529.9273,-4648.7468 459,-4586.2076 129.2035,-4295.414 199.2049,-3664.1177 220.2546,-3519.5247"/>
<polygon fill="#000000" stroke="#000000" points="223.7766,-3519.6368 221.7921,-3509.2294 216.8534,-3518.6027 223.7766,-3519.6368"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="939.5,-3516.9062 468.5,-3516.9062 468.5,-3462.3053 939.5,-3462.3053 939.5,-3516.9062"/>
<text text-anchor="middle" x="704" y="-3501.8058" font-family="Inconsolata" font-size="14.00" fill="#000000"> Hence I&#39;m eager to use it and then document it from the grimoire</text>
<text text-anchor="middle" x="704" y="-3486.4057" font-family="Inconsolata" font-size="14.00" fill="#000000"> side.</text>
</g>
<!-- block_4&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_4&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1049.4265,-6206.4478C1061.4346,-6048.9152 1141.6017,-4918.2747 993,-4622.2076 981.5106,-4599.3167 961.5506,-4607.9419 948,-4586.2076 721.2444,-4222.5073 703.9913,-3675.1745 703.6518,-3527.4635"/>
<polygon fill="#000000" stroke="#000000" points="707.1518,-3527.1352 703.6551,-3517.134 700.1518,-3527.1329 707.1518,-3527.1352"/>
</g>
<!-- codeblock_12 -->
<g id="node13" class="node">
<title>codeblock_12</title>
<ellipse fill="none" stroke="#000000" cx="1030" cy="-3489.6057" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1030" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 9&#45;24</text>
</g>
<!-- block_5&#45;&gt;codeblock_12 -->
<g id="edge12" class="edge">
<title>block_5&#45;&gt;codeblock_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1162.5043,-6206.4964C1158.9238,-6076.3618 1136.2127,-5274.2271 1103,-4622.2076 1080.5737,-4181.9417 1041.5904,-3646.1566 1032.1185,-3518.073"/>
<polygon fill="#000000" stroke="#000000" points="1035.596,-3517.6392 1031.3666,-3507.9252 1028.6152,-3518.1565 1035.596,-3517.6392"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1175,-3507.6057 1121,-3507.6057 1121,-3471.6057 1175,-3471.6057 1175,-3507.6057"/>
</g>
<!-- block_5&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_5&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1162.9002,-6206.5212C1161.6812,-5984.231 1149.6718,-3794.4332 1148.1568,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="1151.6548,-3517.8013 1148.0999,-3507.8207 1144.6549,-3517.8398 1151.6548,-3517.8013"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="1412.5,-3507.6057 1193.5,-3507.6057 1193.5,-3471.6057 1412.5,-3471.6057 1412.5,-3507.6057"/>
<text text-anchor="middle" x="1303" y="-3486.1058" font-family="Inconsolata" font-size="14.00" fill="#000000"> The default language is Lua.</text>
</g>
<!-- block_6&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>block_6&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1303,-6206.5212C1303,-5984.231 1303,-3794.4332 1303,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="1306.5001,-3517.8207 1303,-3507.8207 1299.5001,-3517.8207 1306.5001,-3517.8207"/>
</g>
<!-- codeblock_16 -->
<g id="node17" class="node">
<title>codeblock_16</title>
<ellipse fill="none" stroke="#000000" cx="1508" cy="-3489.6057" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1508" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 29&#45;64</text>
</g>
<!-- block_7&#45;&gt;codeblock_16 -->
<g id="edge16" class="edge">
<title>block_7&#45;&gt;codeblock_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1508,-6206.5212C1508,-5984.231 1508,-3794.4332 1508,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="1511.5001,-3517.8207 1508,-3507.8207 1504.5001,-3517.8207 1511.5001,-3517.8207"/>
</g>
<!-- leaf_18 -->
<g id="node19" class="node">
<title>leaf_18</title>
<polygon fill="none" stroke="#c0c0c0" points="1657,-3507.6057 1603,-3507.6057 1603,-3471.6057 1657,-3471.6057 1657,-3507.6057"/>
</g>
<!-- block_7&#45;&gt;leaf_18 -->
<g id="edge18" class="edge">
<title>block_7&#45;&gt;leaf_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.0903,-6206.5251C1516.9539,-6074.8958 1565.5036,-5254.2944 1594,-4586.2076 1612.1233,-4161.3142 1626.0165,-3643.473 1629.2735,-3517.9747"/>
<polygon fill="#000000" stroke="#000000" points="1632.7795,-3517.7843 1629.5392,-3507.6972 1625.7818,-3517.6034 1632.7795,-3517.7843"/>
</g>
<!-- header_19 -->
<g id="node20" class="node">
<title>header_19</title>
<ellipse fill="none" stroke="#000000" cx="1757" cy="-3489.6057" rx="82.2492" ry="18"/>
<text text-anchor="middle" x="1757" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : matchLineType</text>
</g>
<!-- section_8&#45;&gt;header_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;header_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2172.5469,-6206.6555C2140.4797,-6075.9429 1943.3643,-5260.6021 1848,-4586.2076 1788.2822,-4163.8972 1763.5127,-3644.1337 1758.1542,-3518.1014"/>
<polygon fill="#000000" stroke="#000000" points="1761.6373,-3517.6242 1757.7216,-3507.7795 1754.6435,-3517.9173 1761.6373,-3517.6242"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="1913" cy="-3489.6057" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1913" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 66&#45;74</text>
</g>
<!-- section_8&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_8&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2174.3643,-6206.5638C2155.3749,-6075.2063 2038.4815,-5256.1653 1978,-4586.2076 1939.7162,-4162.1354 1918.7701,-3643.683 1914.0389,-3518.015"/>
<polygon fill="#000000" stroke="#000000" points="1917.5254,-3517.5858 1913.6548,-3507.7234 1910.5303,-3517.847 1917.5254,-3517.5858"/>
</g>
<!-- block_21 -->
<g id="node22" class="node">
<title>block_21</title>
<ellipse fill="none" stroke="#000000" cx="2043" cy="-3489.6057" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2043" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 75&#45;77</text>
</g>
<!-- section_8&#45;&gt;block_21 -->
<g id="edge21" class="edge">
<title>section_8&#45;&gt;block_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2176.1089,-6206.5212C2165.2183,-5984.231 2057.9343,-3794.4332 2044.4006,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="2047.8776,-3517.6374 2043.8924,-3507.8207 2040.886,-3517.98 2047.8776,-3517.6374"/>
</g>
<!-- block_22 -->
<g id="node23" class="node">
<title>block_22</title>
<ellipse fill="none" stroke="#000000" cx="2177" cy="-3489.6057" rx="60.1864" ry="18"/>
<text text-anchor="middle" x="2177" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 78&#45;113</text>
</g>
<!-- section_8&#45;&gt;block_22 -->
<g id="edge22" class="edge">
<title>section_8&#45;&gt;block_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2177,-6206.5212C2177,-5984.231 2177,-3794.4332 2177,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="2180.5001,-3517.8207 2177,-3507.8207 2173.5001,-3517.8207 2180.5001,-3517.8207"/>
</g>
<!-- block_23 -->
<g id="node24" class="node">
<title>block_23</title>
<ellipse fill="none" stroke="#000000" cx="2374" cy="-3489.6057" rx="64.2191" ry="18"/>
<text text-anchor="middle" x="2374" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 114&#45;115</text>
</g>
<!-- section_8&#45;&gt;block_23 -->
<g id="edge23" class="edge">
<title>section_8&#45;&gt;block_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2178.3101,-6206.5212C2194.3209,-5984.231 2352.0443,-3794.4332 2371.9409,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="2375.4605,-3518.0463 2372.688,-3507.8207 2368.4786,-3517.5434 2375.4605,-3518.0463"/>
</g>
<!-- block_24 -->
<g id="node25" class="node">
<title>block_24</title>
<ellipse fill="none" stroke="#000000" cx="2680" cy="-3489.6057" rx="64.2191" ry="18"/>
<text text-anchor="middle" x="2680" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 116&#45;118</text>
</g>
<!-- section_8&#45;&gt;block_24 -->
<g id="edge24" class="edge">
<title>section_8&#45;&gt;block_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2180.345,-6206.5212C2221.2456,-5984.1209 2624.3395,-3792.2646 2674.8176,-3517.7857"/>
<polygon fill="#000000" stroke="#000000" points="2678.2836,-3518.2889 2676.6502,-3507.8207 2671.3991,-3517.0227 2678.2836,-3518.2889"/>
</g>
<!-- block_25 -->
<g id="node26" class="node">
<title>block_25</title>
<ellipse fill="none" stroke="#000000" cx="3019" cy="-3489.6057" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="3019" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 119&#45;205</text>
</g>
<!-- section_8&#45;&gt;block_25 -->
<g id="edge25" class="edge">
<title>section_8&#45;&gt;block_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2184.0915,-6206.7441C2235.2777,-6076.6545 2551.9438,-5264.8884 2753,-4586.2076 2877.3591,-4166.4239 2987.3121,-3643.8375 3013.2356,-3517.8651"/>
<polygon fill="#000000" stroke="#000000" points="3016.7043,-3518.3731 3015.2864,-3507.8735 3009.8472,-3516.9656 3016.7043,-3518.3731"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="3671.5,-4586.3094 3102.5,-4586.3094 3102.5,-2392.9021 3671.5,-2392.9021 3671.5,-4586.3094"/>
<text text-anchor="middle" x="3387" y="-4571.0076" font-family="Inconsolata" font-size="14.00" fill="#000000"> *** matchLineType</text>
<text text-anchor="middle" x="3387" y="-4539.6076" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Matches a line by type (comment, code, or blank) and either</text>
<text text-anchor="middle" x="3387" y="-4524.2075" font-family="Inconsolata" font-size="14.00" fill="#000000"> concatenates to an existing block of this type or starts a new</text>
<text text-anchor="middle" x="3387" y="-4508.8075" font-family="Inconsolata" font-size="14.00" fill="#000000"> one if the latest is different.</text>
<text text-anchor="middle" x="3387" y="-4493.4075" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="3387" y="-4478.0074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: the latest block.</text>
<text text-anchor="middle" x="3387" y="-4462.6074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line: line to be matched and added.</text>
<text text-anchor="middle" x="3387" y="-4431.2074" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return : the latest block, which may be created here.</text>
<text text-anchor="middle" x="3387" y="-4383.8073" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3387" y="-4368.4073" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.sortLine(inverter, latest, line)</text>
<text text-anchor="middle" x="3387" y="-4353.0073" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = latest or {}</text>
<text text-anchor="middle" x="3387" y="-4321.6072" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter:matchComment(line) then</text>
<text text-anchor="middle" x="3387" y="-4306.2072" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose</text>
<text text-anchor="middle" x="3387" y="-4290.8072" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;prose&quot; then</text>
<text text-anchor="middle" x="3387" y="-4275.4071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new prose block</text>
<text text-anchor="middle" x="3387" y="-4260.0071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;prose&quot;}</text>
<text text-anchor="middle" x="3387" y="-4244.6071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="3387" y="-4229.2071" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-4213.807" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="3387" y="-4198.407" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-4183.007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif isBlank(line) then</text>
<text text-anchor="middle" x="3387" y="-4167.6069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank line</text>
<text text-anchor="middle" x="3387" y="-4152.2069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;blank&quot; then</text>
<text text-anchor="middle" x="3387" y="-4136.8069" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;blank&quot;}</text>
<text text-anchor="middle" x="3387" y="-4121.4068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="3387" y="-4106.0068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-4090.6068" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="3387" y="-4075.2067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-4059.8067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-4044.4067" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code line</text>
<text text-anchor="middle" x="3387" y="-4029.0066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;code&quot; then</text>
<text text-anchor="middle" x="3387" y="-4013.6066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new code block</text>
<text text-anchor="middle" x="3387" y="-3998.2066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;code&quot; }</text>
<text text-anchor="middle" x="3387" y="-3982.8066" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="3387" y="-3967.4065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-3952.0065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="3387" y="-3936.6065" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3921.2064" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3889.8064" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="3387" y="-3874.4064" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3387" y="-3859.0063" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3387" y="-3827.6063" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes blocks and concatenates them into a single string.</text>
<text text-anchor="middle" x="3387" y="-3796.2063" font-family="Inconsolata" font-size="14.00" fill="#000000"> Also writes headers and footers, while doing its best to get the </text>
<text text-anchor="middle" x="3387" y="-3780.8062" font-family="Inconsolata" font-size="14.00" fill="#000000"> spacing right.</text>
<text text-anchor="middle" x="3387" y="-3749.4062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; inverter : the Inverter for this language.</text>
<text text-anchor="middle" x="3387" y="-3734.0062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; blocks: blocks of single lines of types blank, prose, or code.</text>
<text text-anchor="middle" x="3387" y="-3702.6061" font-family="Inconsolata" font-size="14.00" fill="#000000"> #return: a Grimoire document in string form.</text>
<text text-anchor="middle" x="3387" y="-3655.2061" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="3387" y="-3639.8061" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.catBlocks(inverter, blocks)</text>
<text text-anchor="middle" x="3387" y="-3624.4061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="3387" y="-3609.006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function toLines(block) </text>
<text text-anchor="middle" x="3387" y="-3593.606" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3387" y="-3578.206" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for j = 1, #block do</text>
<text text-anchor="middle" x="3387" y="-3562.8059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="3387" y="-3547.4059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. block[j] .. &quot;\n&quot;</text>
<text text-anchor="middle" x="3387" y="-3532.0059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3516.6058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3387" y="-3501.2058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3485.8058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3387" y="-3470.4057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[1].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3387" y="-3455.0057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_header()</text>
<text text-anchor="middle" x="3387" y="-3439.6057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3424.2056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;phrase = phrase .. toLines(blocks[1]) </text>
<text text-anchor="middle" x="3387" y="-3408.8056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #blocks do</text>
<text text-anchor="middle" x="3387" y="-3393.4056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3387" y="-3362.0056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="3387" y="-3346.6055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write blanks and code</text>
<text text-anchor="middle" x="3387" y="-3331.2055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3387" y="-3315.8055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3387" y="-3300.4054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-3269.0054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is </text>
<text text-anchor="middle" x="3387" y="-3253.6054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose or nothing, write blanks, header, and code</text>
<text text-anchor="middle" x="3387" y="-3238.2053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3387" y="-3222.8053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="3387" y="-3207.4053" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1])</text>
<text text-anchor="middle" x="3387" y="-3192.0052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. inverter:write_header()</text>
<text text-anchor="middle" x="3387" y="-3176.6052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-3145.2052" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is prose, write a blank line, </text>
<text text-anchor="middle" x="3387" y="-3129.8051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; header, and code. </text>
<text text-anchor="middle" x="3387" y="-3114.4051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="3387" y="-3099.0051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. &quot;\n&quot; .. inverter:write_header() </text>
<text text-anchor="middle" x="3387" y="-3083.6051" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-3068.205" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-3052.805" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on code in catLines&quot;)</text>
<text text-anchor="middle" x="3387" y="-3037.405" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-3022.0049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="3387" y="-2990.6049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="3387" y="-2975.2049" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write footer, blanks, and prose</text>
<text text-anchor="middle" x="3387" y="-2959.8048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3387" y="-2944.4048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3387" y="-2929.0048" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer() </text>
<text text-anchor="middle" x="3387" y="-2913.6047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-2882.2047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is code, write a footer, newline,</text>
<text text-anchor="middle" x="3387" y="-2866.8047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; and prose</text>
<text text-anchor="middle" x="3387" y="-2851.4047" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif (blocks[i &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="3387" y="-2836.0046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="3387" y="-2820.6046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot; .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-2789.2046" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding line is blank and before that is </text>
<text text-anchor="middle" x="3387" y="-2773.8045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; nothing or more prose, write blanks, then prose.</text>
<text text-anchor="middle" x="3387" y="-2758.4045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3387" y="-2743.0045" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="3387" y="-2727.6044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3387" y="-2696.2044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3387" y="-2680.8044" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on prose in catLines&quot;)</text>
<text text-anchor="middle" x="3387" y="-2665.4043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-2650.0043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="3387" y="-2618.6043" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-2603.2042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[#blocks].id == &quot;code&quot; or</text>
<text text-anchor="middle" x="3387" y="-2587.8042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[#blocks].id == &quot;blank&quot; </text>
<text text-anchor="middle" x="3387" y="-2572.4042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and blocks[#blocks &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="3387" y="-2557.0042" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="3387" y="-2541.6041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3387" y="-2510.2041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Note that there may be a final block of blank lines which we are</text>
<text text-anchor="middle" x="3387" y="-2494.8041" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; happy to simply drop. </text>
<text text-anchor="middle" x="3387" y="-2479.404" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase, linum</text>
<text text-anchor="middle" x="3387" y="-2464.004" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="3387" y="-2448.604" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="3387" y="-2401.2039" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_8&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>section_8&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2189.2115,-6206.9627C2276.088,-6079.9785 2805.3842,-5294.2478 3093,-4586.2076 3094.8719,-4581.5994 3096.7355,-4576.9756 3098.5907,-4572.3368"/>
<polygon fill="#000000" stroke="#000000" points="3101.9425,-4573.3798 3102.387,-4562.7943 3095.4383,-4570.7922 3101.9425,-4573.3798"/>
</g>
<!-- header_37 -->
<g id="node38" class="node">
<title>header_37</title>
<ellipse fill="none" stroke="#000000" cx="4161" cy="-3489.6057" rx="83.6081" ry="18"/>
<text text-anchor="middle" x="4161" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Grym:invert(str)</text>
</g>
<!-- section_9&#45;&gt;header_37 -->
<g id="edge37" class="edge">
<title>section_9&#45;&gt;header_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4474.1524,-6206.5632C4453.6152,-6075.2016 4326.8442,-5256.1366 4253,-4586.2076 4206.2664,-4162.2315 4171.0731,-3643.7076 4162.8361,-3518.0197"/>
<polygon fill="#000000" stroke="#000000" points="4166.3082,-3517.4773 4162.1644,-3507.7264 4159.3231,-3517.9332 4166.3082,-3517.4773"/>
</g>
<!-- block_38 -->
<g id="node39" class="node">
<title>block_38</title>
<ellipse fill="none" stroke="#000000" cx="4328" cy="-3489.6057" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4328" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 206&#45;209</text>
</g>
<!-- section_9&#45;&gt;block_38 -->
<g id="edge38" class="edge">
<title>section_9&#45;&gt;block_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4476.0091,-6206.5212C4463.8994,-5984.231 4344.6061,-3794.4332 4329.5574,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="4333.0312,-3517.6155 4328.9923,-3507.8207 4326.0415,-3517.9963 4333.0312,-3517.6155"/>
</g>
<!-- block_39 -->
<g id="node40" class="node">
<title>block_39</title>
<ellipse fill="none" stroke="#000000" cx="4477" cy="-3489.6057" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="4477" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 210&#45;211</text>
</g>
<!-- section_9&#45;&gt;block_39 -->
<g id="edge39" class="edge">
<title>section_9&#45;&gt;block_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4477,-6206.5212C4477,-5984.231 4477,-3794.4332 4477,-3518.1945"/>
<polygon fill="#000000" stroke="#000000" points="4480.5001,-3517.8207 4477,-3507.8207 4473.5001,-3517.8207 4480.5001,-3517.8207"/>
</g>
<!-- block_40 -->
<g id="node41" class="node">
<title>block_40</title>
<ellipse fill="none" stroke="#000000" cx="4721" cy="-3489.6057" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4721" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 212&#45;214</text>
</g>
<!-- section_9&#45;&gt;block_40 -->
<g id="edge40" class="edge">
<title>section_9&#45;&gt;block_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4477.348,-6206.4594C4479.9598,-6076.0684 4498.1486,-5272.4806 4561,-4622.2076 4603.7433,-4179.9766 4693.9803,-3645.6611 4716.0512,-3517.9793"/>
<polygon fill="#000000" stroke="#000000" points="4719.5452,-3518.3147 4717.8044,-3507.8638 4712.648,-3517.1192 4719.5452,-3518.3147"/>
</g>
<!-- block_41 -->
<g id="node42" class="node">
<title>block_41</title>
<ellipse fill="none" stroke="#000000" cx="5039" cy="-3489.6057" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5039" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 215&#45;245</text>
</g>
<!-- section_9&#45;&gt;block_41 -->
<g id="edge41" class="edge">
<title>section_9&#45;&gt;block_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4470.6922,-6206.7361C4421.9559,-6064.2996 4118.8841,-5110.7259 4561,-4622.2076 4631.9015,-4543.8646 4718.8584,-4658.4144 4796,-4586.2076 5118.5933,-4284.2507 5060.4893,-3657.6799 5042.8864,-3517.7316"/>
<polygon fill="#000000" stroke="#000000" points="5046.3555,-3517.2668 5041.6005,-3507.799 5039.4134,-3518.1656 5046.3555,-3517.2668"/>
</g>
<!-- section_42 -->
<g id="node43" class="node">
<title>section_42</title>
<ellipse fill="none" stroke="#000000" cx="5436" cy="-3489.6057" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5436" y="-3485.4057" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 246&#45;290</text>
</g>
<!-- section_9&#45;&gt;section_42 -->
<g id="edge42" class="edge">
<title>section_9&#45;&gt;section_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4470.3297,-6206.3934C4418.7832,-6061.3002 4098.058,-5091.0374 4561,-4622.2076 4647.5275,-4534.5796 5017.8643,-4663.1726 5114,-4586.2076 5465.3659,-4304.9086 5446.8676,-3661.1121 5438.0947,-3518.0986"/>
<polygon fill="#000000" stroke="#000000" points="5441.5768,-3517.708 5437.4356,-3507.9561 5434.5916,-3518.1621 5441.5768,-3517.708"/>
</g>
<!-- leaf_59 -->
<g id="node60" class="node">
<title>leaf_59</title>
<polygon fill="none" stroke="#c0c0c0" points="6000.5,-3811.8068 5529.5,-3811.8068 5529.5,-3167.4047 6000.5,-3167.4047 6000.5,-3811.8068"/>
<text text-anchor="middle" x="5765" y="-3796.5063" font-family="Inconsolata" font-size="14.00" fill="#000000"> ** Grym:invert(str)</text>
<text text-anchor="middle" x="5765" y="-3765.1062" font-family="Inconsolata" font-size="14.00" fill="#000000"> This takes a source file and inverts it into Grimoire format.</text>
<text text-anchor="middle" x="5765" y="-3733.7062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; str: The source file as a single string</text>
<text text-anchor="middle" x="5765" y="-3702.3062" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: The Grimoire document as a string</text>
<text text-anchor="middle" x="5765" y="-3654.9061" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="5765" y="-3639.5061" font-family="Inconsolata" font-size="14.00" fill="#000000">local function invert(inverter, str)</text>
<text text-anchor="middle" x="5765" y="-3624.1061" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = {}</text>
<text text-anchor="middle" x="5765" y="-3608.706" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="5765" y="-3593.306" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = nil</text>
<text text-anchor="middle" x="5765" y="-3577.906" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="5765" y="-3562.5059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="5765" y="-3547.1059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;line = inverter:filter(line)</text>
<text text-anchor="middle" x="5765" y="-3531.7059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; each line is either comment, blank or code.</text>
<text text-anchor="middle" x="5765" y="-3516.3059" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local this_block = inverter:sortLine(latest, line)</text>
<text text-anchor="middle" x="5765" y="-3500.9058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if this_block ~= latest then</text>
<text text-anchor="middle" x="5765" y="-3485.5058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blocks[#blocks + 1] = this_block</text>
<text text-anchor="middle" x="5765" y="-3470.1058" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = this_block</text>
<text text-anchor="middle" x="5765" y="-3454.7057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5765" y="-3439.3057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5765" y="-3423.9057" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local new_linum = 0</text>
<text text-anchor="middle" x="5765" y="-3408.5056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;&#45;[[ This entire check should be wrapped in a utility assert</text>
<text text-anchor="middle" x="5765" y="-3393.1056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="5765" y="-3377.7056" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for __, line in ipairs(v) do</text>
<text text-anchor="middle" x="5765" y="-3362.3055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;new_linum = new_linum + 1</text>
<text text-anchor="middle" x="5765" y="-3346.9055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5765" y="-3331.5055" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5765" y="-3316.1054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="5765" y="-3300.7054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(linum == new_linum)</text>
<text text-anchor="middle" x="5765" y="-3269.3054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase, cat_linum = inverter:catBlocks(blocks)</text>
<text text-anchor="middle" x="5765" y="-3253.9054" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5765" y="-3238.5053" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5765" y="-3223.1053" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
<text text-anchor="middle" x="5765" y="-3175.7053" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
</g>
<!-- section_9&#45;&gt;leaf_59 -->
<g id="edge59" class="edge">
<title>section_9&#45;&gt;leaf_59</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4470.3836,-6206.742C4418.4987,-6062.3875 4091.1626,-5085.1198 4561,-4622.2076 4636.9569,-4547.3702 5438.0511,-4654.4312 5520,-4586.2076 5738.959,-4403.9209 5787.8255,-4072.7092 5789.4107,-3821.8264"/>
<polygon fill="#000000" stroke="#000000" points="5792.9106,-3821.8282 5789.4492,-3811.8148 5785.9106,-3821.8013 5792.9106,-3821.8282"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="503.5,-2124.904 88.5,-2124.904 88.5,-1898.7027 503.5,-1898.7027 503.5,-2124.904"/>
<text text-anchor="middle" x="296" y="-2109.9035" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="296" y="-2078.5034" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="296" y="-2047.1034" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="296" y="-2015.7034" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="296" y="-1984.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isBlank(line)</text>
<text text-anchor="middle" x="296" y="-1968.9033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local all_blanks = L.match((m.__TAB__ + m._)^0, line)</text>
<text text-anchor="middle" x="296" y="-1953.5033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (all_blanks == (#line + 1) or line == &quot;&quot;)</text>
<text text-anchor="middle" x="296" y="-1938.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="296" y="-1906.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">local Inv, inv = u.inherit()</text>
</g>
<!-- codeblock_12&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_12&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1031.6611,-3471.4807C1043.1527,-3341.5183 1105.8223,-2552.0832 948,-2393.0039 879.6853,-2324.1451 595.8903,-2407.3789 513,-2357.0039 430.4552,-2306.8389 374.2545,-2212.0767 339.7659,-2134.5122"/>
<polygon fill="#000000" stroke="#000000" points="342.8816,-2132.9016 335.6673,-2125.1425 336.4684,-2135.707 342.8816,-2132.9016"/>
</g>
<!-- leaf_17 -->
<g id="node18" class="node">
<title>leaf_17</title>
<polygon fill="none" stroke="#c0c0c0" points="1014,-2279.5043 522,-2279.5043 522,-1744.1024 1014,-1744.1024 1014,-2279.5043"/>
<text text-anchor="middle" x="768" y="-2264.2038" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.lang = &quot;lua&quot;</text>
<text text-anchor="middle" x="768" y="-2248.8037" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.extension = &quot;.lua&quot;</text>
<text text-anchor="middle" x="768" y="-2233.4037" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment = L.P&quot;&#45;&#45;&quot;</text>
<text text-anchor="middle" x="768" y="-2218.0037" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment_len = 3</text>
<text text-anchor="middle" x="768" y="-2202.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.tab_to_space = &quot; &#160;&#160;&quot;</text>
<text text-anchor="middle" x="768" y="-2171.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">local lang_config = { lua = { lang = &quot;lua&quot;, </text>
<text text-anchor="middle" x="768" y="-2155.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;extension = &quot;.lua&quot;,</text>
<text text-anchor="middle" x="768" y="-2140.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = L.P&quot;&#45;&#45;&quot;,</text>
<text text-anchor="middle" x="768" y="-2125.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment_len = 3,</text>
<text text-anchor="middle" x="768" y="-2109.6035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tab_to_space = &quot; &#160;&#160;&quot;}}</text>
<text text-anchor="middle" x="768" y="-2078.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_header(inverter)</text>
<text text-anchor="middle" x="768" y="-2062.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#!&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="768" y="-2047.4034" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="768" y="-2016.0034" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_footer(inverter)</text>
<text text-anchor="middle" x="768" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#/&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="768" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="768" y="-1953.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.filter(inverter, line)</text>
<text text-anchor="middle" x="768" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if isBlank(line) then</text>
<text text-anchor="middle" x="768" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="768" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="768" y="-1892.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return line:gsub(&quot;\t&quot;, inverter.tab_to_space):gsub(&quot;\r&quot;, &quot;&quot;)</text>
<text text-anchor="middle" x="768" y="-1876.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="768" y="-1861.4031" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="768" y="-1830.0031" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cat_lines() end &#45;&#45;stub out</text>
<text text-anchor="middle" x="768" y="-1798.603" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.matchComment(inverter, line)</text>
<text text-anchor="middle" x="768" y="-1783.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (L.match(inverter.comment * m._, line) </text>
<text text-anchor="middle" x="768" y="-1767.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or (L.match(inverter.comment, line) and #line == 2))</text>
<text text-anchor="middle" x="768" y="-1752.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_16&#45;&gt;leaf_17 -->
<g id="edge17" class="edge">
<title>codeblock_16&#45;&gt;leaf_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1509.5595,-3471.4869C1520.3252,-3341.5681 1578.6303,-2552.3836 1421,-2393.0039 1358.5525,-2329.8634 1100.4009,-2400.5416 1023,-2357.0039 990.5108,-2338.7289 960.9813,-2314.4129 934.4954,-2287.1151"/>
<polygon fill="#000000" stroke="#000000" points="936.8962,-2284.5607 927.4679,-2279.7277 931.8244,-2289.3854 936.8962,-2284.5607"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="1489.5,-2070.2042 1032.5,-2070.2042 1032.5,-1953.4025 1489.5,-1953.4025 1489.5,-2070.2042"/>
<text text-anchor="middle" x="1261" y="-2038.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Matches a line by type (comment, code, or blank) and either</text>
<text text-anchor="middle" x="1261" y="-2023.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> concatenates to an existing block of this type or starts a new</text>
<text text-anchor="middle" x="1261" y="-2008.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> one if the latest is different.</text>
<text text-anchor="middle" x="1261" y="-1992.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1261" y="-1977.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: the latest block.</text>
<text text-anchor="middle" x="1261" y="-1961.8033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line: line to be matched and added.</text>
</g>
<!-- block_20&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>block_20&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1914.9311,-3471.5344C1928.3602,-3341.9496 2002.8251,-2554.6811 1848,-2393.0039 1793.9223,-2336.5328 1565.23,-2396.9228 1498,-2357.0039 1391.0832,-2293.5204 1321.2366,-2160.7633 1286.6536,-2079.6439"/>
<polygon fill="#000000" stroke="#000000" points="1289.7093,-2077.8807 1282.6109,-2070.0154 1283.2552,-2080.5907 1289.7093,-2077.8807"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="1922.5,-2031.7054 1507.5,-2031.7054 1507.5,-1991.9013 1922.5,-1991.9013 1922.5,-2031.7054"/>
<text text-anchor="middle" x="1715" y="-2016.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return : the latest block, which may be created here.</text>
</g>
<!-- block_21&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>block_21&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2047.1731,-3471.4063C2071.2819,-3361.8783 2184.6298,-2782.0962 1978,-2393.0039 1965.6589,-2369.7651 1948.706,-2376.4678 1931,-2357.0039 1836.8487,-2253.505 1759.1753,-2103.7173 1728.7737,-2041.0706"/>
<polygon fill="#000000" stroke="#000000" points="1731.7953,-2039.278 1724.3051,-2031.7849 1725.4877,-2042.3135 1731.7953,-2039.278"/>
</g>
<!-- codeblock_28 -->
<g id="node29" class="node">
<title>codeblock_28</title>
<ellipse fill="none" stroke="#000000" cx="2022" cy="-2011.8033" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="2022" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;112</text>
</g>
<!-- block_22&#45;&gt;codeblock_28 -->
<g id="edge28" class="edge">
<title>block_22&#45;&gt;codeblock_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2176.9357,-3471.4088C2176.3407,-3366.3884 2170.2506,-2827.3105 2108,-2393.0039 2088.8001,-2259.0507 2047.3115,-2102.4214 2029.9221,-2039.7703"/>
<polygon fill="#000000" stroke="#000000" points="2033.2161,-2038.553 2027.155,-2029.8632 2026.4741,-2040.4361 2033.2161,-2038.553"/>
</g>
<!-- leaf_30 -->
<g id="node31" class="node">
<title>leaf_30</title>
<polygon fill="none" stroke="#c0c0c0" points="2176,-2029.8033 2122,-2029.8033 2122,-1993.8033 2176,-1993.8033 2176,-2029.8033"/>
</g>
<!-- block_22&#45;&gt;leaf_30 -->
<g id="edge30" class="edge">
<title>block_22&#45;&gt;leaf_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2176.6561,-3471.454C2173.7375,-3317.4145 2153.1404,-2230.3262 2149.5372,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="2153.0357,-2040.0403 2149.3468,-2030.1084 2146.037,-2040.173 2153.0357,-2040.0403"/>
</g>
<!-- leaf_31 -->
<g id="node32" class="node">
<title>leaf_31</title>
<polygon fill="none" stroke="#c0c0c0" points="2609.5,-2029.8033 2194.5,-2029.8033 2194.5,-1993.8033 2609.5,-1993.8033 2609.5,-2029.8033"/>
<text text-anchor="middle" x="2402" y="-2008.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes blocks and concatenates them into a single string.</text>
</g>
<!-- block_23&#45;&gt;leaf_31 -->
<g id="edge31" class="edge">
<title>block_23&#45;&gt;leaf_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2374.3439,-3471.454C2377.2625,-3317.4145 2397.8596,-2230.3262 2401.4628,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="2404.963,-2040.173 2401.6532,-2030.1084 2397.9643,-2040.0403 2404.963,-2040.173"/>
</g>
<!-- leaf_32 -->
<g id="node33" class="node">
<title>leaf_32</title>
<polygon fill="none" stroke="#c0c0c0" points="3106,-2031.1039 2628,-2031.1039 2628,-1992.5028 3106,-1992.5028 3106,-2031.1039"/>
<text text-anchor="middle" x="2867" y="-2016.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> Also writes headers and footers, while doing its best to get the </text>
<text text-anchor="middle" x="2867" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> spacing right.</text>
</g>
<!-- block_24&#45;&gt;leaf_32 -->
<g id="edge32" class="edge">
<title>block_24&#45;&gt;leaf_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2682.2969,-3471.454C2701.7577,-3317.6616 2838.9073,-2233.8115 2863.2956,-2041.0782"/>
<polygon fill="#000000" stroke="#000000" points="2866.7732,-2041.4752 2864.5563,-2031.1149 2859.8286,-2040.5964 2866.7732,-2041.4752"/>
</g>
<!-- codeblock_33 -->
<g id="node34" class="node">
<title>codeblock_33</title>
<ellipse fill="none" stroke="#000000" cx="3211" cy="-2011.8033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3211" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 125&#45;203</text>
</g>
<!-- block_25&#45;&gt;codeblock_33 -->
<g id="edge33" class="edge">
<title>block_25&#45;&gt;codeblock_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3017.088,-3471.6079C3006.448,-3365.5224 2959.6793,-2812.1402 3093,-2393.0039 3098.6838,-2375.135 3107.5274,-2374.2017 3115,-2357.0039 3163.9927,-2244.2498 3194.5555,-2099.8519 3205.945,-2039.8695"/>
<polygon fill="#000000" stroke="#000000" points="3209.3922,-2040.4761 3207.789,-2030.0033 3202.5113,-2039.19 3209.3922,-2040.4761"/>
</g>
<!-- leaf_35 -->
<g id="node36" class="node">
<title>leaf_35</title>
<polygon fill="none" stroke="#c0c0c0" points="3787.5,-2063.1036 3316.5,-2063.1036 3316.5,-1960.5031 3787.5,-1960.5031 3787.5,-2063.1036"/>
<text text-anchor="middle" x="3552" y="-2048.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; inverter : the Inverter for this language.</text>
<text text-anchor="middle" x="3552" y="-2032.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; blocks: blocks of single lines of types blank, prose, or code.</text>
</g>
<!-- block_25&#45;&gt;leaf_35 -->
<g id="edge35" class="edge">
<title>block_25&#45;&gt;leaf_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3013.1127,-3471.5249C2976.9061,-3356.531 2795.5686,-2721.5352 3093,-2393.0039 3157.7305,-2321.5051 3225.2903,-2408.245 3307,-2357.0039 3416.1875,-2288.5312 3490.7534,-2151.8748 3526.8922,-2072.5854"/>
<polygon fill="#000000" stroke="#000000" points="3530.1995,-2073.7646 3531.1086,-2063.2088 3523.8153,-2070.8937 3530.1995,-2073.7646"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="2247,-1289.9028 1797,-1289.9028 1797,-772.1006 2247,-772.1006 2247,-1289.9028"/>
<text text-anchor="middle" x="2022" y="-1274.5022" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.sortLine(inverter, latest, line)</text>
<text text-anchor="middle" x="2022" y="-1259.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = latest or {}</text>
<text text-anchor="middle" x="2022" y="-1227.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter:matchComment(line) then</text>
<text text-anchor="middle" x="2022" y="-1212.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose</text>
<text text-anchor="middle" x="2022" y="-1196.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;prose&quot; then</text>
<text text-anchor="middle" x="2022" y="-1181.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new prose block</text>
<text text-anchor="middle" x="2022" y="-1166.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;prose&quot;}</text>
<text text-anchor="middle" x="2022" y="-1150.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="2022" y="-1135.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2022" y="-1119.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="2022" y="-1104.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2022" y="-1089.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif isBlank(line) then</text>
<text text-anchor="middle" x="2022" y="-1073.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank line</text>
<text text-anchor="middle" x="2022" y="-1058.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;blank&quot; then</text>
<text text-anchor="middle" x="2022" y="-1042.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;blank&quot;}</text>
<text text-anchor="middle" x="2022" y="-1027.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2022" y="-1012.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2022" y="-996.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2022" y="-981.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2022" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2022" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code line</text>
<text text-anchor="middle" x="2022" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;code&quot; then</text>
<text text-anchor="middle" x="2022" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new code block</text>
<text text-anchor="middle" x="2022" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;code&quot; }</text>
<text text-anchor="middle" x="2022" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2022" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2022" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2022" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2022" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2022" y="-795.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="2022" y="-780.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_28&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>codeblock_28&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2022,-1993.5167C2022,-1909.5741 2022,-1554.378 2022,-1299.91"/>
<polygon fill="#000000" stroke="#000000" points="2025.5001,-1299.7659 2022,-1289.7659 2018.5001,-1299.766 2025.5001,-1299.7659"/>
</g>
<!-- leaf_34 -->
<g id="node35" class="node">
<title>leaf_34</title>
<polygon fill="none" stroke="#c0c0c0" points="3495.5,-1630.7039 2926.5,-1630.7039 2926.5,-431.2996 3495.5,-431.2996 3495.5,-1630.7039"/>
<text text-anchor="middle" x="3211" y="-1615.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.catBlocks(inverter, blocks)</text>
<text text-anchor="middle" x="3211" y="-1600.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="3211" y="-1584.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function toLines(block) </text>
<text text-anchor="middle" x="3211" y="-1569.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3211" y="-1553.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for j = 1, #block do</text>
<text text-anchor="middle" x="3211" y="-1538.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="3211" y="-1523.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. block[j] .. &quot;\n&quot;</text>
<text text-anchor="middle" x="3211" y="-1507.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-1492.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="3211" y="-1476.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-1461.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="3211" y="-1446.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[1].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3211" y="-1430.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_header()</text>
<text text-anchor="middle" x="3211" y="-1415.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-1399.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;phrase = phrase .. toLines(blocks[1]) </text>
<text text-anchor="middle" x="3211" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #blocks do</text>
<text text-anchor="middle" x="3211" y="-1369.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3211" y="-1337.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="3211" y="-1322.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write blanks and code</text>
<text text-anchor="middle" x="3211" y="-1306.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3211" y="-1291.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3211" y="-1276.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-1244.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is </text>
<text text-anchor="middle" x="3211" y="-1229.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose or nothing, write blanks, header, and code</text>
<text text-anchor="middle" x="3211" y="-1213.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3211" y="-1198.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="3211" y="-1183.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1])</text>
<text text-anchor="middle" x="3211" y="-1167.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. inverter:write_header()</text>
<text text-anchor="middle" x="3211" y="-1152.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-1120.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is prose, write a blank line, </text>
<text text-anchor="middle" x="3211" y="-1105.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; header, and code. </text>
<text text-anchor="middle" x="3211" y="-1090.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="3211" y="-1074.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. &quot;\n&quot; .. inverter:write_header() </text>
<text text-anchor="middle" x="3211" y="-1059.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-1043.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3211" y="-1028.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on code in catLines&quot;)</text>
<text text-anchor="middle" x="3211" y="-1013.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-997.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="3211" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="3211" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write footer, blanks, and prose</text>
<text text-anchor="middle" x="3211" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3211" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="3211" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer() </text>
<text text-anchor="middle" x="3211" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is code, write a footer, newline,</text>
<text text-anchor="middle" x="3211" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; and prose</text>
<text text-anchor="middle" x="3211" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif (blocks[i &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="3211" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="3211" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot; .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-764.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding line is blank and before that is </text>
<text text-anchor="middle" x="3211" y="-749.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; nothing or more prose, write blanks, then prose.</text>
<text text-anchor="middle" x="3211" y="-734.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="3211" y="-718.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="3211" y="-703.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="3211" y="-671.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="3211" y="-656.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on prose in catLines&quot;)</text>
<text text-anchor="middle" x="3211" y="-641.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-625.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="3211" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[#blocks].id == &quot;code&quot; or</text>
<text text-anchor="middle" x="3211" y="-563.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[#blocks].id == &quot;blank&quot; </text>
<text text-anchor="middle" x="3211" y="-548.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and blocks[#blocks &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="3211" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="3211" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="3211" y="-485.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Note that there may be a final block of blank lines which we are</text>
<text text-anchor="middle" x="3211" y="-470.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; happy to simply drop. </text>
<text text-anchor="middle" x="3211" y="-455.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase, linum</text>
<text text-anchor="middle" x="3211" y="-439.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_33&#45;&gt;leaf_34 -->
<g id="edge34" class="edge">
<title>codeblock_33&#45;&gt;leaf_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3211,-1993.5167C3211,-1944.2635 3211,-1801.6245 3211,-1640.7411"/>
<polygon fill="#000000" stroke="#000000" points="3214.5001,-1640.6124 3211,-1630.6125 3207.5001,-1640.6125 3214.5001,-1640.6124"/>
</g>
<!-- leaf_43 -->
<g id="node44" class="node">
<title>leaf_43</title>
<polygon fill="none" stroke="#c0c0c0" points="4256,-2031.7054 3806,-2031.7054 3806,-1991.9013 4256,-1991.9013 4256,-2031.7054"/>
<text text-anchor="middle" x="4031" y="-2000.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> This takes a source file and inverts it into Grimoire format.</text>
</g>
<!-- block_38&#45;&gt;leaf_43 -->
<g id="edge43" class="edge">
<title>block_38&#45;&gt;leaf_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4329.8243,-3471.2994C4339.8419,-3364.576 4383.1429,-2812.9472 4254,-2393.0039 4209.4436,-2248.1168 4100.7089,-2099.6652 4053.4953,-2039.5654"/>
<polygon fill="#000000" stroke="#000000" points="4056.2054,-2037.3499 4047.2547,-2031.681 4050.7167,-2041.6943 4056.2054,-2037.3499"/>
</g>
<!-- leaf_44 -->
<g id="node45" class="node">
<title>leaf_44</title>
<polygon fill="none" stroke="#c0c0c0" points="4584,-2029.8033 4274,-2029.8033 4274,-1993.8033 4584,-1993.8033 4584,-2029.8033"/>
<text text-anchor="middle" x="4429" y="-2008.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; str: The source file as a single string</text>
</g>
<!-- block_39&#45;&gt;leaf_44 -->
<g id="edge44" class="edge">
<title>block_39&#45;&gt;leaf_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4476.4104,-3471.454C4471.4071,-3317.4145 4436.0978,-2230.3262 4429.9209,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="4433.4174,-2039.9895 4429.5946,-2030.1084 4426.4211,-2040.2168 4433.4174,-2039.9895"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="4933.5,-2031.7054 4602.5,-2031.7054 4602.5,-1991.9013 4933.5,-1991.9013 4933.5,-2031.7054"/>
<text text-anchor="middle" x="4768" y="-2016.3034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: The Grimoire document as a string</text>
</g>
<!-- block_40&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>block_40&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4721.5773,-3471.454C4726.4634,-3317.8235 4760.8667,-2236.0922 4767.0495,-2041.6898"/>
<polygon fill="#000000" stroke="#000000" points="4770.5498,-2041.734 4767.3695,-2031.6277 4763.5533,-2041.5114 4770.5498,-2041.734"/>
</g>
<!-- codeblock_46 -->
<g id="node47" class="node">
<title>codeblock_46</title>
<ellipse fill="none" stroke="#000000" cx="5039" cy="-2011.8033" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5039" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 215&#45;243</text>
</g>
<!-- block_41&#45;&gt;codeblock_46 -->
<g id="edge46" class="edge">
<title>block_41&#45;&gt;codeblock_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5039,-3471.454C5039,-3317.4145 5039,-2230.3262 5039,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="5042.5001,-2040.1084 5039,-2030.1084 5035.5001,-2040.1085 5042.5001,-2040.1084"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="5198,-2029.8033 5144,-2029.8033 5144,-1993.8033 5198,-1993.8033 5198,-2029.8033"/>
</g>
<!-- block_41&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>block_41&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5040.6213,-3471.454C5054.3804,-3317.4145 5151.4811,-2230.3262 5168.4675,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="5171.9613,-2040.3802 5169.365,-2030.1084 5164.9891,-2039.7574 5171.9613,-2040.3802"/>
</g>
<!-- header_49 -->
<g id="node50" class="node">
<title>header_49</title>
<ellipse fill="none" stroke="#000000" cx="5284" cy="-2011.8033" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="5284" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Constructor</text>
</g>
<!-- section_42&#45;&gt;header_49 -->
<g id="edge49" class="edge">
<title>section_42&#45;&gt;header_49</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5434.133,-3471.454C5418.2892,-3317.4145 5306.4763,-2230.3262 5286.9162,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="5290.3877,-2039.6978 5285.8828,-2030.1084 5283.4244,-2040.4141 5290.3877,-2039.6978"/>
</g>
<!-- block_50 -->
<g id="node51" class="node">
<title>block_50</title>
<ellipse fill="none" stroke="#000000" cx="5436" cy="-2011.8033" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5436" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 246&#45;250</text>
</g>
<!-- section_42&#45;&gt;block_50 -->
<g id="edge50" class="edge">
<title>section_42&#45;&gt;block_50</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5436,-3471.454C5436,-3317.4145 5436,-2230.3262 5436,-2040.1561"/>
<polygon fill="#000000" stroke="#000000" points="5439.5001,-2040.1084 5436,-2030.1084 5432.5001,-2040.1085 5439.5001,-2040.1084"/>
</g>
<!-- block_51 -->
<g id="node52" class="node">
<title>block_51</title>
<ellipse fill="none" stroke="#000000" cx="5585" cy="-2011.8033" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5585" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 251&#45;262</text>
</g>
<!-- section_42&#45;&gt;block_51 -->
<g id="edge51" class="edge">
<title>section_42&#45;&gt;block_51</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5436.7605,-3471.4569C5441.2807,-3366.7043 5466.2629,-2828.8658 5520,-2393.0039 5536.3856,-2260.1004 5566.697,-2102.8851 5579.2866,-2039.9239"/>
<polygon fill="#000000" stroke="#000000" points="5582.7489,-2040.4597 5581.2875,-2029.9661 5575.886,-2039.0806 5582.7489,-2040.4597"/>
</g>
<!-- block_52 -->
<g id="node53" class="node">
<title>block_52</title>
<ellipse fill="none" stroke="#000000" cx="5838" cy="-2011.8033" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5838" y="-2007.6033" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 263&#45;290</text>
</g>
<!-- section_42&#45;&gt;block_52 -->
<g id="edge52" class="edge">
<title>section_42&#45;&gt;block_52</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5430.5717,-3471.4487C5397.645,-3357.2766 5235.3773,-2732.4474 5520,-2393.0039 5561.2794,-2343.7737 5609.7702,-2397.0611 5660,-2357.0039 5766.3677,-2272.1779 5815.6384,-2106.6296 5831.7404,-2040.2951"/>
<polygon fill="#000000" stroke="#000000" points="5835.2393,-2040.7062 5834.1253,-2030.1701 5828.4257,-2039.1012 5835.2393,-2040.7062"/>
</g>
<!-- leaf_58 -->
<g id="node59" class="node">
<title>leaf_58</title>
<polygon fill="none" stroke="#c0c0c0" points="6428,-2357.2046 5922,-2357.2046 5922,-1666.4021 6428,-1666.4021 6428,-2357.2046"/>
<text text-anchor="middle" x="6175" y="-2341.8039" font-family="Inconsolata" font-size="14.00" fill="#000000"> *** Constructor</text>
<text text-anchor="middle" x="6175" y="-2326.4039" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6175" y="-2311.0038" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Currently minimum&#45;viable. </text>
<text text-anchor="middle" x="6175" y="-2263.6038" font-family="Inconsolata" font-size="14.00" fill="#000000"> Long term, lang can be other than nil, which gets you lua.</text>
<text text-anchor="middle" x="6175" y="-2248.2038" font-family="Inconsolata" font-size="14.00" fill="#000000"> A string will return an inverter.lang of that string if such</text>
<text text-anchor="middle" x="6175" y="-2232.8037" font-family="Inconsolata" font-size="14.00" fill="#000000"> exists.</text>
<text text-anchor="middle" x="6175" y="-2217.4037" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6175" y="-2202.0037" font-family="Inconsolata" font-size="14.00" fill="#000000"> A table will configure a lang, memoize it if it&#39;s new, and return</text>
<text text-anchor="middle" x="6175" y="-2186.6037" font-family="Inconsolata" font-size="14.00" fill="#000000"> same. If one of that name already exists, memoization isn&#39;t repeated,</text>
<text text-anchor="middle" x="6175" y="-2171.2036" font-family="Inconsolata" font-size="14.00" fill="#000000"> so for a default like lua or python, making a custom python inverter</text>
<text text-anchor="middle" x="6175" y="-2155.8036" font-family="Inconsolata" font-size="14.00" fill="#000000"> wont affect the result of subsequent `invert(&quot;python&quot;)` calls. </text>
<text text-anchor="middle" x="6175" y="-2140.4036" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6175" y="-2125.0035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: an Inverter</text>
<text text-anchor="middle" x="6175" y="-2077.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">#!lua</text>
<text text-anchor="middle" x="6175" y="-2062.2035" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Inverter, lang)</text>
<text text-anchor="middle" x="6175" y="-2046.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local inverter = setmetatable({}, Inv)</text>
<text text-anchor="middle" x="6175" y="-2031.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lang and lang ~= &quot;lua&quot; then</text>
<text text-anchor="middle" x="6175" y="-2016.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;configs not yet implemented&quot;)</text>
<text text-anchor="middle" x="6175" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6175" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return inverter</text>
<text text-anchor="middle" x="6175" y="-1969.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6175" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">local inv_lua = new()</text>
<text text-anchor="middle" x="6175" y="-1907.0032" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.getLang(inverter, key)</text>
<text text-anchor="middle" x="6175" y="-1891.6032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if key == &quot;lua&quot; then</text>
<text text-anchor="middle" x="6175" y="-1876.2032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inv_lua</text>
<text text-anchor="middle" x="6175" y="-1860.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6175" y="-1845.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter.langs[key] then </text>
<text text-anchor="middle" x="6175" y="-1830.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inverter.langs[key]</text>
<text text-anchor="middle" x="6175" y="-1814.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="6175" y="-1799.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;No inverter found for language &quot; .. tostring(key))</text>
<text text-anchor="middle" x="6175" y="-1783.803" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="6175" y="-1768.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="6175" y="-1737.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.__call = invert</text>
<text text-anchor="middle" x="6175" y="-1721.6029" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.invert = invert</text>
<text text-anchor="middle" x="6175" y="-1690.2028" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(inv, new)</text>
<text text-anchor="middle" x="6175" y="-1674.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">#/lua</text>
</g>
<!-- section_42&#45;&gt;leaf_58 -->
<g id="edge58" class="edge">
<title>section_42&#45;&gt;leaf_58</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5430.1173,-3471.5747C5393.513,-3355.5767 5208.4371,-2709.2431 5520,-2393.0039 5581.5489,-2330.5312 5836.3102,-2399.5454 5913,-2357.0039 5913.0925,-2356.9526 5913.185,-2356.9012 5913.2775,-2356.8498"/>
<polygon fill="#000000" stroke="#000000" points="5914.895,-2359.9572 5921.8125,-2351.9323 5911.4005,-2353.8919 5914.895,-2359.9572"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="5076.5,-1243.4027 4605.5,-1243.4027 4605.5,-818.6007 5076.5,-818.6007 5076.5,-1243.4027"/>
<text text-anchor="middle" x="4841" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function invert(inverter, str)</text>
<text text-anchor="middle" x="4841" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = {}</text>
<text text-anchor="middle" x="4841" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="4841" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = nil</text>
<text text-anchor="middle" x="4841" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="4841" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="4841" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;line = inverter:filter(line)</text>
<text text-anchor="middle" x="4841" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; each line is either comment, blank or code.</text>
<text text-anchor="middle" x="4841" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local this_block = inverter:sortLine(latest, line)</text>
<text text-anchor="middle" x="4841" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if this_block ~= latest then</text>
<text text-anchor="middle" x="4841" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blocks[#blocks + 1] = this_block</text>
<text text-anchor="middle" x="4841" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = this_block</text>
<text text-anchor="middle" x="4841" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4841" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4841" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local new_linum = 0</text>
<text text-anchor="middle" x="4841" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;&#45;[[ This entire check should be wrapped in a utility assert</text>
<text text-anchor="middle" x="4841" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="4841" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for __, line in ipairs(v) do</text>
<text text-anchor="middle" x="4841" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;new_linum = new_linum + 1</text>
<text text-anchor="middle" x="4841" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4841" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4841" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="4841" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(linum == new_linum)</text>
<text text-anchor="middle" x="4841" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase, cat_linum = inverter:catBlocks(blocks)</text>
<text text-anchor="middle" x="4841" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4841" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_46&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>codeblock_46&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5035.3084,-1993.5167C5017.3045,-1904.3338 4937.4907,-1508.9727 4885.9211,-1253.5206"/>
<polygon fill="#000000" stroke="#000000" points="4889.2793,-1252.4679 4883.8696,-1243.3582 4882.4177,-1253.8531 4889.2793,-1252.4679"/>
</g>
<!-- leaf_53 -->
<g id="node54" class="node">
<title>leaf_53</title>
<polygon fill="none" stroke="#c0c0c0" points="5313.5,-1058.3021 5094.5,-1058.3021 5094.5,-1003.7013 5313.5,-1003.7013 5313.5,-1058.3021"/>
<text text-anchor="middle" x="5204" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="5204" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Currently minimum&#45;viable. </text>
</g>
<!-- block_50&#45;&gt;leaf_53 -->
<g id="edge53" class="edge">
<title>block_50&#45;&gt;leaf_53</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5435.741,-1993.6239C5434.2387,-1939.9789 5424.3802,-1779.0707 5361,-1666.6028 5349.5783,-1646.3351 5334.2386,-1650.9726 5323,-1630.6028 5217.2669,-1438.9629 5204.6611,-1166.9533 5203.7557,-1068.4415"/>
<polygon fill="#000000" stroke="#000000" points="5207.2554,-1068.3566 5203.6994,-1058.3763 5200.2555,-1068.3958 5207.2554,-1068.3566"/>
</g>
<!-- leaf_54 -->
<g id="node55" class="node">
<title>leaf_54</title>
<polygon fill="none" stroke="#c0c0c0" points="5838,-1120.002 5332,-1120.002 5332,-942.0014 5838,-942.0014 5838,-1120.002"/>
<text text-anchor="middle" x="5585" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> Long term, lang can be other than nil, which gets you lua.</text>
<text text-anchor="middle" x="5585" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> A string will return an inverter.lang of that string if such</text>
<text text-anchor="middle" x="5585" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> exists.</text>
<text text-anchor="middle" x="5585" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="5585" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> A table will configure a lang, memoize it if it&#39;s new, and return</text>
<text text-anchor="middle" x="5585" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> same. If one of that name already exists, memoization isn&#39;t repeated,</text>
<text text-anchor="middle" x="5585" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> so for a default like lua or python, making a custom python inverter</text>
<text text-anchor="middle" x="5585" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> wont affect the result of subsequent `invert(&quot;python&quot;)` calls. </text>
<text text-anchor="middle" x="5585" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="5585" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: an Inverter</text>
</g>
<!-- block_51&#45;&gt;leaf_54 -->
<g id="edge54" class="edge">
<title>block_51&#45;&gt;leaf_54</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5585,-1993.5167C5585,-1888.0778 5585,-1354.6701 5585,-1130.4788"/>
<polygon fill="#000000" stroke="#000000" points="5588.5001,-1130.3635 5585,-1120.3635 5581.5001,-1130.3636 5588.5001,-1130.3635"/>
</g>
<!-- codeblock_55 -->
<g id="node56" class="node">
<title>codeblock_55</title>
<ellipse fill="none" stroke="#000000" cx="5943" cy="-1031.0017" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5943" y="-1026.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 263&#45;289</text>
</g>
<!-- block_52&#45;&gt;codeblock_55 -->
<g id="edge55" class="edge">
<title>block_52&#45;&gt;codeblock_55</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5839.9577,-1993.5167C5852.7482,-1874.0406 5924.3663,-1205.0581 5939.9899,-1059.1192"/>
<polygon fill="#000000" stroke="#000000" points="5943.4714,-1059.4781 5941.0558,-1049.1623 5936.5111,-1058.7329 5943.4714,-1059.4781"/>
</g>
<!-- leaf_57 -->
<g id="node58" class="node">
<title>leaf_57</title>
<polygon fill="none" stroke="#c0c0c0" points="6102,-1049.0017 6048,-1049.0017 6048,-1013.0017 6102,-1013.0017 6102,-1049.0017"/>
</g>
<!-- block_52&#45;&gt;leaf_57 -->
<g id="edge57" class="edge">
<title>block_52&#45;&gt;leaf_57</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5836.0392,-1993.5242C5831.029,-1936.7652 5823.8598,-1761.6728 5913,-1666.6028 5952.8362,-1624.1166 6002.5494,-1676.027 6039,-1630.6028 6179.3027,-1455.7595 6109.3627,-1151.7662 6083.3362,-1058.8033"/>
<polygon fill="#000000" stroke="#000000" points="6086.6517,-1057.6673 6080.5373,-1049.0149 6079.9215,-1059.5918 6086.6517,-1057.6673"/>
</g>
<!-- leaf_56 -->
<g id="node57" class="node">
<title>leaf_56</title>
<polygon fill="none" stroke="#c0c0c0" points="6189,-395.6012 5697,-395.6012 5697,.2005 6189,.2005 6189,-395.6012"/>
<text text-anchor="middle" x="5943" y="-380.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Inverter, lang)</text>
<text text-anchor="middle" x="5943" y="-364.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local inverter = setmetatable({}, Inv)</text>
<text text-anchor="middle" x="5943" y="-349.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lang and lang ~= &quot;lua&quot; then</text>
<text text-anchor="middle" x="5943" y="-334.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;configs not yet implemented&quot;)</text>
<text text-anchor="middle" x="5943" y="-318.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5943" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return inverter</text>
<text text-anchor="middle" x="5943" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5943" y="-256.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local inv_lua = new()</text>
<text text-anchor="middle" x="5943" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.getLang(inverter, key)</text>
<text text-anchor="middle" x="5943" y="-209.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if key == &quot;lua&quot; then</text>
<text text-anchor="middle" x="5943" y="-194.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inv_lua</text>
<text text-anchor="middle" x="5943" y="-178.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5943" y="-163.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter.langs[key] then </text>
<text text-anchor="middle" x="5943" y="-148.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inverter.langs[key]</text>
<text text-anchor="middle" x="5943" y="-132.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="5943" y="-117.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;No inverter found for language &quot; .. tostring(key))</text>
<text text-anchor="middle" x="5943" y="-101.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5943" y="-86.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="5943" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.__call = invert</text>
<text text-anchor="middle" x="5943" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.invert = invert</text>
<text text-anchor="middle" x="5943" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(inv, new)</text>
</g>
<!-- codeblock_55&#45;&gt;leaf_56 -->
<g id="edge56" class="edge">
<title>codeblock_55&#45;&gt;leaf_56</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5943,-1012.8221C5943,-934.5097 5943,-620.2242 5943,-405.5942"/>
<polygon fill="#000000" stroke="#000000" points="5946.5001,-405.4503 5943,-395.4504 5939.5001,-405.4504 5946.5001,-405.4503"/>
</g>
</g>
</svg>