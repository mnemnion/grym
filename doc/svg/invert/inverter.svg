<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: hierarchy Pages: 1 -->
<svg width="7444pt" height="2426pt"
 viewBox="0.00 0.00 7444.00 2425.80" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 2421.8037)">
<title>hierarchy</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-2421.8037 7440,-2421.8037 7440,4 -4,4"/>
<!-- doc_0 -->
<g id="node1" class="node">
<title>doc_0</title>
<ellipse fill="none" stroke="#000000" cx="1446" cy="-2399.8037" rx="46.9581" ry="18"/>
<text text-anchor="middle" x="1446" y="-2395.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">doc &#45; 290</text>
</g>
<!-- section_1 -->
<g id="node2" class="node">
<title>section_1</title>
<ellipse fill="none" stroke="#000000" cx="1446" cy="-2327.8037" rx="65.8187" ry="18"/>
<text text-anchor="middle" x="1446" y="-2323.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 1&#45;205</text>
</g>
<!-- doc_0&#45;&gt;section_1 -->
<g id="edge1" class="edge">
<title>doc_0&#45;&gt;section_1</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1446,-2381.635C1446,-2373.9346 1446,-2364.778 1446,-2356.2203"/>
<polygon fill="#000000" stroke="#000000" points="1449.5001,-2356.2169 1446,-2346.2169 1442.5001,-2356.217 1449.5001,-2356.2169"/>
</g>
<!-- header_2 -->
<g id="node3" class="node">
<title>header_2</title>
<ellipse fill="none" stroke="#000000" cx="171" cy="-2255.8037" rx="83.677" ry="18"/>
<text text-anchor="middle" x="171" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">1 : Inverter module</text>
</g>
<!-- section_1&#45;&gt;header_2 -->
<g id="edge2" class="edge">
<title>section_1&#45;&gt;header_2</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1381.4599,-2324.159C1171.4834,-2312.3015 507.269,-2274.793 262.6236,-2260.9777"/>
<polygon fill="#000000" stroke="#000000" points="262.5254,-2257.4667 252.3439,-2260.3972 262.1307,-2264.4555 262.5254,-2257.4667"/>
</g>
<!-- block_3 -->
<g id="node4" class="node">
<title>block_3</title>
<ellipse fill="none" stroke="#000000" cx="726" cy="-2255.8037" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="726" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 1&#45;4</text>
</g>
<!-- section_1&#45;&gt;block_3 -->
<g id="edge3" class="edge">
<title>section_1&#45;&gt;block_3</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1384.302,-2321.6338C1246.0212,-2307.8058 913.0979,-2274.5134 781.1796,-2261.3216"/>
<polygon fill="#000000" stroke="#000000" points="781.2108,-2257.8074 770.9121,-2260.2949 780.5142,-2264.7726 781.2108,-2257.8074"/>
</g>
<!-- block_4 -->
<g id="node5" class="node">
<title>block_4</title>
<ellipse fill="none" stroke="#000000" cx="1040" cy="-2255.8037" rx="45.9804" ry="18"/>
<text text-anchor="middle" x="1040" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 5&#45;8</text>
</g>
<!-- section_1&#45;&gt;block_4 -->
<g id="edge4" class="edge">
<title>section_1&#45;&gt;block_4</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1390.8225,-2318.0185C1312.1814,-2304.0723 1168.8963,-2278.6621 1092.0258,-2265.0299"/>
<polygon fill="#000000" stroke="#000000" points="1092.5429,-2261.5671 1082.0854,-2263.2671 1091.3206,-2268.4595 1092.5429,-2261.5671"/>
</g>
<!-- codeblock_5 -->
<g id="node6" class="node">
<title>codeblock_5</title>
<ellipse fill="none" stroke="#000000" cx="1279" cy="-2255.8037" rx="72.5844" ry="18"/>
<text text-anchor="middle" x="1279" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 9&#45;24</text>
</g>
<!-- section_1&#45;&gt;codeblock_5 -->
<g id="edge5" class="edge">
<title>section_1&#45;&gt;codeblock_5</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1410.5836,-2312.5343C1385.4891,-2301.7151 1351.6052,-2287.1065 1324.5066,-2275.4233"/>
<polygon fill="#000000" stroke="#000000" points="1325.7987,-2272.1689 1315.2301,-2271.4238 1323.0273,-2278.597 1325.7987,-2272.1689"/>
</g>
<!-- block_6 -->
<g id="node7" class="node">
<title>block_6</title>
<ellipse fill="none" stroke="#000000" cx="1488" cy="-2255.8037" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="1488" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 27&#45;28</text>
</g>
<!-- section_1&#45;&gt;block_6 -->
<g id="edge6" class="edge">
<title>section_1&#45;&gt;block_6</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1456.382,-2310.0059C1461.2282,-2301.6981 1467.0982,-2291.6352 1472.4584,-2282.4464"/>
<polygon fill="#000000" stroke="#000000" points="1475.5763,-2284.0476 1477.5918,-2273.6462 1469.5299,-2280.5204 1475.5763,-2284.0476"/>
</g>
<!-- codeblock_7 -->
<g id="node8" class="node">
<title>codeblock_7</title>
<ellipse fill="none" stroke="#000000" cx="1793" cy="-2255.8037" rx="77.4211" ry="18"/>
<text text-anchor="middle" x="1793" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 29&#45;64</text>
</g>
<!-- section_1&#45;&gt;codeblock_7 -->
<g id="edge7" class="edge">
<title>section_1&#45;&gt;codeblock_7</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1498.7018,-2316.8684C1559.2949,-2304.2958 1658.9113,-2283.6261 1725.2247,-2269.8665"/>
<polygon fill="#000000" stroke="#000000" points="1726.0838,-2273.2629 1735.1642,-2267.8042 1724.6616,-2266.4089 1726.0838,-2273.2629"/>
</g>
<!-- section_8 -->
<g id="node9" class="node">
<title>section_8</title>
<ellipse fill="none" stroke="#000000" cx="2656" cy="-2255.8037" rx="70.655" ry="18"/>
<text text-anchor="middle" x="2656" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 66&#45;205</text>
</g>
<!-- section_1&#45;&gt;section_8 -->
<g id="edge8" class="edge">
<title>section_1&#45;&gt;section_8</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1510.2005,-2323.9835C1715.0638,-2311.7932 2352.8543,-2273.8421 2577.0756,-2260.5"/>
<polygon fill="#000000" stroke="#000000" points="2577.3435,-2263.9903 2587.1179,-2259.9024 2576.9276,-2257.0027 2577.3435,-2263.9903"/>
</g>
<!-- section_9 -->
<g id="node10" class="node">
<title>section_9</title>
<ellipse fill="none" stroke="#000000" cx="5118" cy="-2255.8037" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="5118" y="-2251.6037" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 206&#45;245</text>
</g>
<!-- section_1&#45;&gt;section_9 -->
<g id="edge9" class="edge">
<title>section_1&#45;&gt;section_9</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1511.6853,-2326.5157C1956.8317,-2317.7873 4528.9335,-2267.354 5032.4953,-2257.4802"/>
<polygon fill="#000000" stroke="#000000" points="5032.6685,-2260.9776 5042.5979,-2257.2821 5032.5312,-2253.9789 5032.6685,-2260.9776"/>
</g>
<!-- leaf_10 -->
<g id="node11" class="node">
<title>leaf_10</title>
<polygon fill="none" stroke="#c0c0c0" points="54,-1952.2032 0,-1952.2032 0,-1916.2032 54,-1916.2032 54,-1952.2032"/>
</g>
<!-- header_2&#45;&gt;leaf_10 -->
<g id="edge10" class="edge">
<title>header_2&#45;&gt;leaf_10</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M119.0461,-2241.5656C98.4306,-2233.2883 76.4675,-2220.6507 63,-2201.8037 10.7307,-2128.6557 16.5733,-2014.9164 22.7929,-1962.4598"/>
<polygon fill="#000000" stroke="#000000" points="26.2666,-1962.8874 24.0649,-1952.5239 19.3233,-1961.9985 26.2666,-1962.8874"/>
</g>
<!-- leaf_11 -->
<g id="node12" class="node">
<title>leaf_11</title>
<polygon fill="none" stroke="#c0c0c0" points="522,-1953.5038 72,-1953.5038 72,-1914.9026 522,-1914.9026 522,-1953.5038"/>
<text text-anchor="middle" x="297" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;A work in progress, which also works well enough to invert,</text>
<text text-anchor="middle" x="297" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> I may hope, the whole of grym including this file.</text>
</g>
<!-- block_3&#45;&gt;leaf_11 -->
<g id="edge11" class="edge">
<title>block_3&#45;&gt;leaf_11</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M681.6185,-2250.9324C640.0556,-2244.729 577.5428,-2231.0628 531,-2201.8037 429.748,-2138.1517 347.6998,-2017.5238 313.8019,-1962.6548"/>
<polygon fill="#000000" stroke="#000000" points="316.6048,-1960.5289 308.4078,-1953.8161 310.6296,-1964.1754 316.6048,-1960.5289"/>
</g>
<!-- leaf_12 -->
<g id="node13" class="node">
<title>leaf_12</title>
<polygon fill="none" stroke="#c0c0c0" points="1011.5,-1961.5036 540.5,-1961.5036 540.5,-1906.9028 1011.5,-1906.9028 1011.5,-1961.5036"/>
<text text-anchor="middle" x="776" y="-1946.4032" font-family="Inconsolata" font-size="14.00" fill="#000000"> Hence I&#39;m eager to use it and then document it from the grimoire</text>
<text text-anchor="middle" x="776" y="-1931.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> side.</text>
</g>
<!-- block_4&#45;&gt;leaf_12 -->
<g id="edge12" class="edge">
<title>block_4&#45;&gt;leaf_12</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1025.8062,-2238.513C984.1248,-2187.7374 861.4765,-2038.3293 805.0325,-1969.5701"/>
<polygon fill="#000000" stroke="#000000" points="807.5373,-1967.1052 798.4871,-1961.5967 802.1268,-1971.5467 807.5373,-1967.1052"/>
</g>
<!-- leaf_13 -->
<g id="node14" class="node">
<title>leaf_13</title>
<polygon fill="none" stroke="#c0c0c0" points="1444.5,-2047.3038 1029.5,-2047.3038 1029.5,-1821.1026 1444.5,-1821.1026 1444.5,-2047.3038"/>
<text text-anchor="middle" x="1237" y="-2032.3034" font-family="Inconsolata" font-size="14.00" fill="#000000">local L = require &quot;lpeg&quot;</text>
<text text-anchor="middle" x="1237" y="-2000.9033" font-family="Inconsolata" font-size="14.00" fill="#000000">local epeg = require &quot;peg/epeg&quot;</text>
<text text-anchor="middle" x="1237" y="-1969.5033" font-family="Inconsolata" font-size="14.00" fill="#000000">local m = require &quot;grym/morphemes&quot;</text>
<text text-anchor="middle" x="1237" y="-1938.1033" font-family="Inconsolata" font-size="14.00" fill="#000000">local u = require &quot;lib/util&quot;</text>
<text text-anchor="middle" x="1237" y="-1906.7032" font-family="Inconsolata" font-size="14.00" fill="#000000">local function isBlank(line)</text>
<text text-anchor="middle" x="1237" y="-1891.3032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local all_blanks = L.match((m.__TAB__ + m._)^0, line)</text>
<text text-anchor="middle" x="1237" y="-1875.9032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (all_blanks == (#line + 1) or line == &quot;&quot;)</text>
<text text-anchor="middle" x="1237" y="-1860.5031" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1237" y="-1829.1031" font-family="Inconsolata" font-size="14.00" fill="#000000">local Inv, inv = u.inherit()</text>
</g>
<!-- codeblock_5&#45;&gt;leaf_13 -->
<g id="edge13" class="edge">
<title>codeblock_5&#45;&gt;leaf_13</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1276.6216,-2237.5916C1272.1145,-2203.0801 1261.9842,-2125.5112 1253.0956,-2057.4498"/>
<polygon fill="#000000" stroke="#000000" points="1256.5596,-2056.9458 1251.794,-2047.4832 1249.6185,-2057.8523 1256.5596,-2056.9458"/>
</g>
<!-- leaf_14 -->
<g id="node15" class="node">
<title>leaf_14</title>
<polygon fill="none" stroke="#c0c0c0" points="1681.5,-1952.2032 1462.5,-1952.2032 1462.5,-1916.2032 1681.5,-1916.2032 1681.5,-1952.2032"/>
<text text-anchor="middle" x="1572" y="-1930.7032" font-family="Inconsolata" font-size="14.00" fill="#000000"> The default language is Lua.</text>
</g>
<!-- block_6&#45;&gt;leaf_14 -->
<g id="edge14" class="edge">
<title>block_6&#45;&gt;leaf_14</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1492.7569,-2237.5916C1506.7621,-2183.9714 1547.9156,-2026.4121 1564.7234,-1962.0621"/>
<polygon fill="#000000" stroke="#000000" points="1568.1545,-1962.7755 1567.2953,-1952.2156 1561.3817,-1961.0064 1568.1545,-1962.7755"/>
</g>
<!-- leaf_15 -->
<g id="node16" class="node">
<title>leaf_15</title>
<polygon fill="none" stroke="#c0c0c0" points="2192,-2201.9041 1700,-2201.9041 1700,-1666.5023 2192,-1666.5023 2192,-2201.9041"/>
<text text-anchor="middle" x="1946" y="-2186.6037" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.lang = &quot;lua&quot;</text>
<text text-anchor="middle" x="1946" y="-2171.2036" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.extension = &quot;.lua&quot;</text>
<text text-anchor="middle" x="1946" y="-2155.8036" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment = L.P&quot;&#45;&#45;&quot;</text>
<text text-anchor="middle" x="1946" y="-2140.4036" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.comment_len = 3</text>
<text text-anchor="middle" x="1946" y="-2125.0035" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.tab_to_space = &quot; &#160;&#160;&quot;</text>
<text text-anchor="middle" x="1946" y="-2093.6035" font-family="Inconsolata" font-size="14.00" fill="#000000">local lang_config = { lua = { lang = &quot;lua&quot;, </text>
<text text-anchor="middle" x="1946" y="-2078.2035" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;extension = &quot;.lua&quot;,</text>
<text text-anchor="middle" x="1946" y="-2062.8034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment = L.P&quot;&#45;&#45;&quot;,</text>
<text text-anchor="middle" x="1946" y="-2047.4034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;comment_len = 3,</text>
<text text-anchor="middle" x="1946" y="-2032.0034" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tab_to_space = &quot; &#160;&#160;&quot;}}</text>
<text text-anchor="middle" x="1946" y="-2000.6033" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_header(inverter)</text>
<text text-anchor="middle" x="1946" y="-1985.2033" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#!&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1946" y="-1969.8033" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1946" y="-1938.4032" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.write_footer(inverter)</text>
<text text-anchor="middle" x="1946" y="-1923.0032" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return &quot;#/&quot; .. inverter.lang .. &quot;\n&quot;</text>
<text text-anchor="middle" x="1946" y="-1907.6032" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1946" y="-1876.2032" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.filter(inverter, line)</text>
<text text-anchor="middle" x="1946" y="-1860.8031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if isBlank(line) then</text>
<text text-anchor="middle" x="1946" y="-1845.4031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return &quot;&quot;</text>
<text text-anchor="middle" x="1946" y="-1830.0031" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else </text>
<text text-anchor="middle" x="1946" y="-1814.603" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return line:gsub(&quot;\t&quot;, inverter.tab_to_space):gsub(&quot;\r&quot;, &quot;&quot;)</text>
<text text-anchor="middle" x="1946" y="-1799.203" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="1946" y="-1783.803" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="1946" y="-1752.4029" font-family="Inconsolata" font-size="14.00" fill="#000000">local function cat_lines() end &#45;&#45;stub out</text>
<text text-anchor="middle" x="1946" y="-1721.0029" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.matchComment(inverter, line)</text>
<text text-anchor="middle" x="1946" y="-1705.6029" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return (L.match(inverter.comment * m._, line) </text>
<text text-anchor="middle" x="1946" y="-1690.2028" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;or (L.match(inverter.comment, line) and #line == 2))</text>
<text text-anchor="middle" x="1946" y="-1674.8028" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_7&#45;&gt;leaf_15 -->
<g id="edge15" class="edge">
<title>codeblock_7&#45;&gt;leaf_15</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M1801.6643,-2237.5916C1805.072,-2230.4287 1809.3621,-2221.4111 1814.311,-2211.0086"/>
<polygon fill="#000000" stroke="#000000" points="1817.4826,-2212.489 1818.6182,-2201.9552 1811.1615,-2209.4817 1817.4826,-2212.489"/>
</g>
<!-- header_16 -->
<g id="node17" class="node">
<title>header_16</title>
<ellipse fill="none" stroke="#000000" cx="2292" cy="-1934.2032" rx="82.2492" ry="18"/>
<text text-anchor="middle" x="2292" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : matchLineType</text>
</g>
<!-- section_8&#45;&gt;header_16 -->
<g id="edge16" class="edge">
<title>section_8&#45;&gt;header_16</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2588.7261,-2250.1707C2518.0476,-2242.9483 2413.0343,-2228.1003 2383,-2201.8037 2311.3527,-2139.0727 2296.0377,-2017.6724 2292.8209,-1962.6005"/>
<polygon fill="#000000" stroke="#000000" points="2296.3117,-1962.324 2292.3258,-1952.5075 2289.3201,-1962.667 2296.3117,-1962.324"/>
</g>
<!-- block_17 -->
<g id="node18" class="node">
<title>block_17</title>
<ellipse fill="none" stroke="#000000" cx="2448" cy="-1934.2032" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2448" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 66&#45;74</text>
</g>
<!-- section_8&#45;&gt;block_17 -->
<g id="edge17" class="edge">
<title>section_8&#45;&gt;block_17</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2595.3048,-2246.3814C2566.5605,-2238.9054 2534.006,-2225.5612 2513,-2201.8037 2451.9677,-2132.7767 2445.9902,-2016.0194 2446.764,-1962.5173"/>
<polygon fill="#000000" stroke="#000000" points="2450.2659,-1962.4767 2447.0043,-1952.3964 2443.2678,-1962.3104 2450.2659,-1962.4767"/>
</g>
<!-- block_18 -->
<g id="node19" class="node">
<title>block_18</title>
<ellipse fill="none" stroke="#000000" cx="2578" cy="-1934.2032" rx="55.6542" ry="18"/>
<text text-anchor="middle" x="2578" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 75&#45;77</text>
</g>
<!-- section_8&#45;&gt;block_18 -->
<g id="edge18" class="edge">
<title>section_8&#45;&gt;block_18</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2651.5829,-2237.5916C2638.578,-2183.9714 2600.3641,-2026.4121 2584.7568,-1962.0621"/>
<polygon fill="#000000" stroke="#000000" points="2588.1272,-1961.1088 2582.3687,-1952.2156 2581.3244,-1962.7588 2588.1272,-1961.1088"/>
</g>
<!-- codeblock_19 -->
<g id="node20" class="node">
<title>codeblock_19</title>
<ellipse fill="none" stroke="#000000" cx="2734" cy="-1934.2032" rx="81.9542" ry="18"/>
<text text-anchor="middle" x="2734" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 78&#45;112</text>
</g>
<!-- section_8&#45;&gt;codeblock_19 -->
<g id="edge19" class="edge">
<title>section_8&#45;&gt;codeblock_19</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2660.4171,-2237.5916C2673.422,-2183.9714 2711.6359,-2026.4121 2727.2432,-1962.0621"/>
<polygon fill="#000000" stroke="#000000" points="2730.6756,-1962.7588 2729.6313,-1952.2156 2723.8728,-1961.1088 2730.6756,-1962.7588"/>
</g>
<!-- block_20 -->
<g id="node21" class="node">
<title>block_20</title>
<ellipse fill="none" stroke="#000000" cx="3041" cy="-1934.2032" rx="64.2191" ry="18"/>
<text text-anchor="middle" x="3041" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 114&#45;115</text>
</g>
<!-- section_8&#45;&gt;block_20 -->
<g id="edge20" class="edge">
<title>section_8&#45;&gt;block_20</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2714.9072,-2245.7883C2749.2294,-2237.8963 2792.0898,-2224.3422 2825,-2201.8037 2921.1925,-2135.9263 2996.3156,-2014.8459 3026.5424,-1961.1108"/>
<polygon fill="#000000" stroke="#000000" points="3029.7029,-1962.6286 3031.4962,-1952.1866 3023.5826,-1959.2311 3029.7029,-1962.6286"/>
</g>
<!-- block_21 -->
<g id="node22" class="node">
<title>block_21</title>
<ellipse fill="none" stroke="#000000" cx="3383" cy="-1934.2032" rx="64.2191" ry="18"/>
<text text-anchor="middle" x="3383" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 116&#45;118</text>
</g>
<!-- section_8&#45;&gt;block_21 -->
<g id="edge21" class="edge">
<title>section_8&#45;&gt;block_21</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2725.8599,-2253.1234C2836.6953,-2247.9501 3047.1353,-2234.1093 3114,-2201.8037 3231.1481,-2145.2037 3327.6494,-2016.6574 3365.6334,-1960.8677"/>
<polygon fill="#000000" stroke="#000000" points="3368.7513,-1962.5032 3371.4266,-1952.2517 3362.9423,-1958.5974 3368.7513,-1962.5032"/>
</g>
<!-- codeblock_22 -->
<g id="node23" class="node">
<title>codeblock_22</title>
<ellipse fill="none" stroke="#000000" cx="3837" cy="-1934.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="3837" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 125&#45;203</text>
</g>
<!-- section_8&#45;&gt;codeblock_22 -->
<g id="edge22" class="edge">
<title>section_8&#45;&gt;codeblock_22</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2725.9022,-2253.24C2908.1026,-2246.2535 3388.1638,-2225.7887 3456,-2201.8037 3608.4832,-2147.8897 3755.3562,-2014.7782 3812.2377,-1959.206"/>
<polygon fill="#000000" stroke="#000000" points="3814.9908,-1961.407 3819.6579,-1951.8955 3810.078,-1956.4205 3814.9908,-1961.407"/>
</g>
<!-- header_30 -->
<g id="node31" class="node">
<title>header_30</title>
<ellipse fill="none" stroke="#000000" cx="4538" cy="-1934.2032" rx="83.6081" ry="18"/>
<text text-anchor="middle" x="4538" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">2 : Grym:invert(str)</text>
</g>
<!-- section_9&#45;&gt;header_30 -->
<g id="edge30" class="edge">
<title>section_9&#45;&gt;header_30</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5048.3308,-2248.697C4969.642,-2239.8117 4847.1836,-2223.1405 4806,-2201.8037 4690.971,-2142.2081 4594.2527,-2015.8309 4555.7987,-1960.7719"/>
<polygon fill="#000000" stroke="#000000" points="4558.4865,-1958.5046 4549.9251,-1952.2634 4552.7258,-1962.4813 4558.4865,-1958.5046"/>
</g>
<!-- block_31 -->
<g id="node32" class="node">
<title>block_31</title>
<ellipse fill="none" stroke="#000000" cx="4881" cy="-1934.2032" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="4881" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 206&#45;209</text>
</g>
<!-- section_9&#45;&gt;block_31 -->
<g id="edge31" class="edge">
<title>section_9&#45;&gt;block_31</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5089.5577,-2238.8798C5074.8448,-2229.2284 5057.2445,-2216.2001 5044,-2201.8037 4973.242,-2124.8913 4916.8859,-2012.7079 4893.166,-1961.509"/>
<polygon fill="#000000" stroke="#000000" points="4896.3381,-1960.0295 4888.9914,-1952.3956 4889.974,-1962.9448 4896.3381,-1960.0295"/>
</g>
<!-- block_32 -->
<g id="node33" class="node">
<title>block_32</title>
<ellipse fill="none" stroke="#000000" cx="5118" cy="-1934.2032" rx="65.0229" ry="18"/>
<text text-anchor="middle" x="5118" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 210&#45;211</text>
</g>
<!-- section_9&#45;&gt;block_32 -->
<g id="edge32" class="edge">
<title>section_9&#45;&gt;block_32</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5118,-2237.5916C5118,-2184.082 5118,-2027.0614 5118,-1962.4613"/>
<polygon fill="#000000" stroke="#000000" points="5121.5001,-1962.2155 5118,-1952.2156 5114.5001,-1962.2156 5121.5001,-1962.2155"/>
</g>
<!-- block_33 -->
<g id="node34" class="node">
<title>block_33</title>
<ellipse fill="none" stroke="#000000" cx="5362" cy="-1934.2032" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="5362" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 212&#45;214</text>
</g>
<!-- section_9&#45;&gt;block_33 -->
<g id="edge33" class="edge">
<title>section_9&#45;&gt;block_33</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5145.9753,-2239.0136C5160.7282,-2229.3097 5178.5116,-2216.1906 5192,-2201.8037 5264.3236,-2124.6621 5323.8378,-2012.5935 5349.0364,-1961.4662"/>
<polygon fill="#000000" stroke="#000000" points="5352.2369,-1962.8882 5353.4751,-1952.366 5345.9454,-1959.8195 5352.2369,-1962.8882"/>
</g>
<!-- codeblock_34 -->
<g id="node35" class="node">
<title>codeblock_34</title>
<ellipse fill="none" stroke="#000000" cx="5705" cy="-1934.2032" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="5705" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 215&#45;243</text>
</g>
<!-- section_9&#45;&gt;codeblock_34 -->
<g id="edge34" class="edge">
<title>section_9&#45;&gt;codeblock_34</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5188.1576,-2248.9482C5268.5628,-2240.2226 5394.6917,-2223.6243 5437,-2201.8037 5552.1388,-2142.4204 5648.7978,-2015.9287 5687.2188,-1960.8057"/>
<polygon fill="#000000" stroke="#000000" points="5690.2964,-1962.5077 5693.0872,-1952.287 5684.5318,-1958.5366 5690.2964,-1962.5077"/>
</g>
<!-- section_35 -->
<g id="node36" class="node">
<title>section_35</title>
<ellipse fill="none" stroke="#000000" cx="6350" cy="-1934.2032" rx="75.4916" ry="18"/>
<text text-anchor="middle" x="6350" y="-1930.0032" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">section: 246&#45;290</text>
</g>
<!-- section_9&#45;&gt;section_35 -->
<g id="edge35" class="edge">
<title>section_9&#45;&gt;section_35</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5192.9726,-2253.4015C5345.7472,-2247.9306 5688.1803,-2232.5689 5801,-2201.8037 6008.5181,-2145.2147 6231.8845,-2010.2774 6315.677,-1956.6941"/>
<polygon fill="#000000" stroke="#000000" points="6317.7536,-1959.52 6324.2731,-1951.1685 6313.9685,-1953.6316 6317.7536,-1959.52"/>
</g>
<!-- leaf_23 -->
<g id="node24" class="node">
<title>leaf_23</title>
<polygon fill="none" stroke="#c0c0c0" points="1510,-1049.0017 1456,-1049.0017 1456,-1013.0017 1510,-1013.0017 1510,-1049.0017"/>
</g>
<!-- header_16&#45;&gt;leaf_23 -->
<g id="edge23" class="edge">
<title>header_16&#45;&gt;leaf_23</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2292.1857,-1916.0042C2291.594,-1866.3598 2282.386,-1728.1998 2201,-1666.6028 2140.4929,-1620.808 1572.8512,-1684.066 1519,-1630.6028 1359.215,-1471.969 1443.3435,-1154.4196 1473.6146,-1058.8439"/>
<polygon fill="#000000" stroke="#000000" points="1477.0345,-1059.6428 1476.7762,-1049.0511 1470.373,-1057.4921 1477.0345,-1059.6428"/>
</g>
<!-- leaf_24 -->
<g id="node25" class="node">
<title>leaf_24</title>
<polygon fill="none" stroke="#c0c0c0" points="1985.5,-1089.4026 1528.5,-1089.4026 1528.5,-972.6008 1985.5,-972.6008 1985.5,-1089.4026"/>
<text text-anchor="middle" x="1757" y="-1058.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Matches a line by type (comment, code, or blank) and either</text>
<text text-anchor="middle" x="1757" y="-1042.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> concatenates to an existing block of this type or starts a new</text>
<text text-anchor="middle" x="1757" y="-1027.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> one if the latest is different.</text>
<text text-anchor="middle" x="1757" y="-1011.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="1757" y="-996.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; latest: the latest block.</text>
<text text-anchor="middle" x="1757" y="-981.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; line: line to be matched and added.</text>
</g>
<!-- block_17&#45;&gt;leaf_24 -->
<g id="edge24" class="edge">
<title>block_17&#45;&gt;leaf_24</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2449.9691,-1916.0103C2454.1515,-1866.9827 2458.0775,-1731.4476 2383,-1666.6028 2317.2995,-1609.8569 2063.4599,-1682.6793 1994,-1630.6028 1821.5673,-1501.324 1774.4479,-1227.3437 1761.6827,-1099.4458"/>
<polygon fill="#000000" stroke="#000000" points="1765.1564,-1099.003 1760.7194,-1089.382 1758.1883,-1099.6701 1765.1564,-1099.003"/>
</g>
<!-- leaf_25 -->
<g id="node26" class="node">
<title>leaf_25</title>
<polygon fill="none" stroke="#c0c0c0" points="2418.5,-1050.9038 2003.5,-1050.9038 2003.5,-1011.0996 2418.5,-1011.0996 2418.5,-1050.9038"/>
<text text-anchor="middle" x="2211" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return : the latest block, which may be created here.</text>
</g>
<!-- block_18&#45;&gt;leaf_25 -->
<g id="edge25" class="edge">
<title>block_18&#45;&gt;leaf_25</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2578.8273,-1916.1561C2579.9972,-1869.1995 2576.7651,-1741.661 2513,-1666.6028 2486.4377,-1635.3361 2456.2255,-1660.3767 2428,-1630.6028 2265.3756,-1459.057 2223.0706,-1156.5498 2213.5087,-1060.881"/>
<polygon fill="#000000" stroke="#000000" points="2216.9772,-1060.3836 2212.544,-1050.7608 2210.0088,-1061.0479 2216.9772,-1060.3836"/>
</g>
<!-- leaf_26 -->
<g id="node27" class="node">
<title>leaf_26</title>
<polygon fill="none" stroke="#c0c0c0" points="2887,-1289.9028 2437,-1289.9028 2437,-772.1006 2887,-772.1006 2887,-1289.9028"/>
<text text-anchor="middle" x="2662" y="-1274.5022" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.sortLine(inverter, latest, line)</text>
<text text-anchor="middle" x="2662" y="-1259.1022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local block = latest or {}</text>
<text text-anchor="middle" x="2662" y="-1227.7021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter:matchComment(line) then</text>
<text text-anchor="middle" x="2662" y="-1212.3021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose</text>
<text text-anchor="middle" x="2662" y="-1196.9021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;prose&quot; then</text>
<text text-anchor="middle" x="2662" y="-1181.502" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new prose block</text>
<text text-anchor="middle" x="2662" y="-1166.102" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;prose&quot;}</text>
<text text-anchor="middle" x="2662" y="-1150.702" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="2662" y="-1135.302" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2662" y="-1119.9019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line:sub(inverter.comment_len)</text>
<text text-anchor="middle" x="2662" y="-1104.5019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2662" y="-1089.1019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;elseif isBlank(line) then</text>
<text text-anchor="middle" x="2662" y="-1073.7018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; blank line</text>
<text text-anchor="middle" x="2662" y="-1058.3018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;blank&quot; then</text>
<text text-anchor="middle" x="2662" y="-1042.9018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;blank&quot;}</text>
<text text-anchor="middle" x="2662" y="-1027.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2662" y="-1012.1017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2662" y="-996.7017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2662" y="-981.3016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2662" y="-965.9016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2662" y="-950.5016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code line</text>
<text text-anchor="middle" x="2662" y="-935.1015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if not block.id or block.id ~= &quot;code&quot; then</text>
<text text-anchor="middle" x="2662" y="-919.7015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; new code block</text>
<text text-anchor="middle" x="2662" y="-904.3015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block = { id = &quot;code&quot; }</text>
<text text-anchor="middle" x="2662" y="-888.9015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2662" y="-873.5014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="2662" y="-858.1014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;block[#block + 1] = line</text>
<text text-anchor="middle" x="2662" y="-842.7014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2662" y="-827.3013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="2662" y="-795.9013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return block</text>
<text text-anchor="middle" x="2662" y="-780.5013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_19&#45;&gt;leaf_26 -->
<g id="edge26" class="edge">
<title>codeblock_19&#45;&gt;leaf_26</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M2732.5618,-1916.1614C2726.4222,-1839.1441 2701.8827,-1531.3095 2683.4553,-1300.1474"/>
<polygon fill="#000000" stroke="#000000" points="2686.9213,-1299.58 2682.6376,-1289.8898 2679.9434,-1300.1363 2686.9213,-1299.58"/>
</g>
<!-- leaf_27 -->
<g id="node28" class="node">
<title>leaf_27</title>
<polygon fill="none" stroke="#c0c0c0" points="3320.5,-1049.0017 2905.5,-1049.0017 2905.5,-1013.0017 3320.5,-1013.0017 3320.5,-1049.0017"/>
<text text-anchor="middle" x="3113" y="-1027.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Takes blocks and concatenates them into a single string.</text>
</g>
<!-- block_20&#45;&gt;leaf_27 -->
<g id="edge27" class="edge">
<title>block_20&#45;&gt;leaf_27</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3042.4382,-1916.1614C3051.4114,-1803.598 3099.6883,-1197.9898 3110.7436,-1059.3072"/>
<polygon fill="#000000" stroke="#000000" points="3114.2525,-1059.333 3111.5583,-1049.0865 3107.2747,-1058.7767 3114.2525,-1059.333"/>
</g>
<!-- leaf_28 -->
<g id="node29" class="node">
<title>leaf_28</title>
<polygon fill="none" stroke="#c0c0c0" points="3817,-1050.3023 3339,-1050.3023 3339,-1011.7011 3817,-1011.7011 3817,-1050.3023"/>
<text text-anchor="middle" x="3578" y="-1035.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> Also writes headers and footers, while doing its best to get the </text>
<text text-anchor="middle" x="3578" y="-1019.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> spacing right.</text>
</g>
<!-- block_21&#45;&gt;leaf_28 -->
<g id="edge28" class="edge">
<title>block_21&#45;&gt;leaf_28</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3386.8952,-1916.1614C3411.1172,-1803.9698 3541.0851,-1201.9843 3571.589,-1060.6964"/>
<polygon fill="#000000" stroke="#000000" points="3575.0776,-1061.1221 3573.7669,-1050.6087 3568.2353,-1059.6448 3575.0776,-1061.1221"/>
</g>
<!-- leaf_29 -->
<g id="node30" class="node">
<title>leaf_29</title>
<polygon fill="none" stroke="#c0c0c0" points="4404.5,-1630.7039 3835.5,-1630.7039 3835.5,-431.2996 4404.5,-431.2996 4404.5,-1630.7039"/>
<text text-anchor="middle" x="4120" y="-1615.4028" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.catBlocks(inverter, blocks)</text>
<text text-anchor="middle" x="4120" y="-1600.0027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="4120" y="-1584.6027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local function toLines(block) </text>
<text text-anchor="middle" x="4120" y="-1569.2027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4120" y="-1553.8027" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for j = 1, #block do</text>
<text text-anchor="middle" x="4120" y="-1538.4026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="4120" y="-1523.0026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. block[j] .. &quot;\n&quot;</text>
<text text-anchor="middle" x="4120" y="-1507.6026" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-1492.2025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="4120" y="-1476.8025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-1461.4025" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase = &quot;&quot;</text>
<text text-anchor="middle" x="4120" y="-1446.0024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[1].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4120" y="-1430.6024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_header()</text>
<text text-anchor="middle" x="4120" y="-1415.2024" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-1399.8023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;phrase = phrase .. toLines(blocks[1]) </text>
<text text-anchor="middle" x="4120" y="-1384.4023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for i = 2, #blocks do</text>
<text text-anchor="middle" x="4120" y="-1369.0023" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4120" y="-1337.6022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="4120" y="-1322.2022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write blanks and code</text>
<text text-anchor="middle" x="4120" y="-1306.8022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4120" y="-1291.4022" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4120" y="-1276.0021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-1244.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is </text>
<text text-anchor="middle" x="4120" y="-1229.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; prose or nothing, write blanks, header, and code</text>
<text text-anchor="middle" x="4120" y="-1213.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4120" y="-1198.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4120" y="-1183.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1])</text>
<text text-anchor="middle" x="4120" y="-1167.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. inverter:write_header()</text>
<text text-anchor="middle" x="4120" y="-1152.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-1120.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is prose, write a blank line, </text>
<text text-anchor="middle" x="4120" y="-1105.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; header, and code. </text>
<text text-anchor="middle" x="4120" y="-1090.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="4120" y="-1074.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. &quot;\n&quot; .. inverter:write_header() </text>
<text text-anchor="middle" x="4120" y="-1059.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-1043.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4120" y="-1028.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on code in catLines&quot;)</text>
<text text-anchor="middle" x="4120" y="-1013.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-997.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i].id == &quot;prose&quot; then</text>
<text text-anchor="middle" x="4120" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is blank and before that is</text>
<text text-anchor="middle" x="4120" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; code, write footer, blanks, and prose</text>
<text text-anchor="middle" x="4120" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4120" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;i &gt; 2 and blocks[i &#45; 2].id == &quot;code&quot; then</text>
<text text-anchor="middle" x="4120" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer() </text>
<text text-anchor="middle" x="4120" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding block is code, write a footer, newline,</text>
<text text-anchor="middle" x="4120" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; and prose</text>
<text text-anchor="middle" x="4120" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif (blocks[i &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="4120" y="-811.6013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="4120" y="-796.2013" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;.. &quot;\n&quot; .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-764.8012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; if preceding line is blank and before that is </text>
<text text-anchor="middle" x="4120" y="-749.4012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; nothing or more prose, write blanks, then prose.</text>
<text text-anchor="middle" x="4120" y="-734.0012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif blocks[i &#45; 1].id == &quot;blank&quot; and </text>
<text text-anchor="middle" x="4120" y="-718.6012" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[i &#45; 2] == nil or blocks[i &#45; 2].id == &quot;prose&quot;) then</text>
<text text-anchor="middle" x="4120" y="-703.2011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. toLines(blocks[i &#45; 1]) .. toLines(blocks[i])</text>
<text text-anchor="middle" x="4120" y="-671.8011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else</text>
<text text-anchor="middle" x="4120" y="-656.4011" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;Reached a bad state on prose in catLines&quot;)</text>
<text text-anchor="middle" x="4120" y="-641.001" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-625.601" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end </text>
<text text-anchor="middle" x="4120" y="-594.201" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-578.8009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if blocks[#blocks].id == &quot;code&quot; or</text>
<text text-anchor="middle" x="4120" y="-563.4009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;(blocks[#blocks].id == &quot;blank&quot; </text>
<text text-anchor="middle" x="4120" y="-548.0009" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;and blocks[#blocks &#45; 1].id == &quot;code&quot;) then</text>
<text text-anchor="middle" x="4120" y="-532.6008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;phrase = phrase .. inverter:write_footer()</text>
<text text-anchor="middle" x="4120" y="-517.2008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="4120" y="-485.8008" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; Note that there may be a final block of blank lines which we are</text>
<text text-anchor="middle" x="4120" y="-470.4007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45; happy to simply drop. </text>
<text text-anchor="middle" x="4120" y="-455.0007" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase, linum</text>
<text text-anchor="middle" x="4120" y="-439.6007" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_22&#45;&gt;leaf_29 -->
<g id="edge29" class="edge">
<title>codeblock_22&#45;&gt;leaf_29</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M3842.653,-1916.1614C3855.6016,-1874.8357 3889.3728,-1767.0542 3929.0822,-1640.3206"/>
<polygon fill="#000000" stroke="#000000" points="3932.4242,-1641.3602 3932.0743,-1630.7712 3925.7444,-1639.2672 3932.4242,-1641.3602"/>
</g>
<!-- leaf_36 -->
<g id="node37" class="node">
<title>leaf_36</title>
<polygon fill="none" stroke="#c0c0c0" points="4477,-1049.0017 4423,-1049.0017 4423,-1013.0017 4477,-1013.0017 4477,-1049.0017"/>
</g>
<!-- header_30&#45;&gt;leaf_36 -->
<g id="edge36" class="edge">
<title>header_30&#45;&gt;leaf_36</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4534.1973,-1916.1662C4524.4743,-1869.3084 4498.588,-1739.7725 4486,-1630.6028 4460.7403,-1411.5376 4452.6477,-1145.2746 4450.5962,-1059.2475"/>
<polygon fill="#000000" stroke="#000000" points="4454.0946,-1059.1331 4450.3653,-1049.2163 4447.0965,-1059.2943 4454.0946,-1059.1331"/>
</g>
<!-- leaf_37 -->
<g id="node38" class="node">
<title>leaf_37</title>
<polygon fill="none" stroke="#c0c0c0" points="4945,-1050.9038 4495,-1050.9038 4495,-1011.0996 4945,-1011.0996 4945,-1050.9038"/>
<text text-anchor="middle" x="4720" y="-1019.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> This takes a source file and inverts it into Grimoire format.</text>
</g>
<!-- block_31&#45;&gt;leaf_37 -->
<g id="edge37" class="edge">
<title>block_31&#45;&gt;leaf_37</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M4877.784,-1916.1614C4857.8069,-1804.0909 4750.7101,-1203.2839 4725.3751,-1061.1557"/>
<polygon fill="#000000" stroke="#000000" points="4728.7651,-1060.2288 4723.5645,-1050.9982 4721.8737,-1061.4572 4728.7651,-1060.2288"/>
</g>
<!-- leaf_38 -->
<g id="node39" class="node">
<title>leaf_38</title>
<polygon fill="none" stroke="#c0c0c0" points="5273,-1049.0017 4963,-1049.0017 4963,-1013.0017 5273,-1013.0017 5273,-1049.0017"/>
<text text-anchor="middle" x="5118" y="-1027.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; str: The source file as a single string</text>
</g>
<!-- block_32&#45;&gt;leaf_38 -->
<g id="edge38" class="edge">
<title>block_32&#45;&gt;leaf_38</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5118,-1916.1614C5118,-1803.598 5118,-1197.9898 5118,-1059.3072"/>
<polygon fill="#000000" stroke="#000000" points="5121.5001,-1059.0864 5118,-1049.0865 5114.5001,-1059.0865 5121.5001,-1059.0864"/>
</g>
<!-- leaf_39 -->
<g id="node40" class="node">
<title>leaf_39</title>
<polygon fill="none" stroke="#c0c0c0" points="5622.5,-1050.9038 5291.5,-1050.9038 5291.5,-1011.0996 5622.5,-1011.0996 5622.5,-1050.9038"/>
<text text-anchor="middle" x="5457" y="-1035.5017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: The Grimoire document as a string</text>
</g>
<!-- block_33&#45;&gt;leaf_39 -->
<g id="edge39" class="edge">
<title>block_33&#45;&gt;leaf_39</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5363.8977,-1916.1614C5375.6854,-1804.0909 5438.8791,-1203.2839 5453.8284,-1061.1557"/>
<polygon fill="#000000" stroke="#000000" points="5457.3314,-1061.3095 5454.8967,-1050.9982 5450.3698,-1060.5772 5457.3314,-1061.3095"/>
</g>
<!-- leaf_40 -->
<g id="node41" class="node">
<title>leaf_40</title>
<polygon fill="none" stroke="#c0c0c0" points="6111.5,-1243.4027 5640.5,-1243.4027 5640.5,-818.6007 6111.5,-818.6007 6111.5,-1243.4027"/>
<text text-anchor="middle" x="5876" y="-1228.0021" font-family="Inconsolata" font-size="14.00" fill="#000000">local function invert(inverter, str)</text>
<text text-anchor="middle" x="5876" y="-1212.6021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local blocks = {}</text>
<text text-anchor="middle" x="5876" y="-1197.2021" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local linum = 0</text>
<text text-anchor="middle" x="5876" y="-1181.802" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local latest = nil</text>
<text text-anchor="middle" x="5876" y="-1166.402" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, line in ipairs(epeg.split(str, &quot;\n&quot;)) do</text>
<text text-anchor="middle" x="5876" y="-1151.002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;linum = linum + 1</text>
<text text-anchor="middle" x="5876" y="-1135.6019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;line = inverter:filter(line)</text>
<text text-anchor="middle" x="5876" y="-1120.2019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#45;&#45; each line is either comment, blank or code.</text>
<text text-anchor="middle" x="5876" y="-1104.8019" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;local this_block = inverter:sortLine(latest, line)</text>
<text text-anchor="middle" x="5876" y="-1089.4018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;if this_block ~= latest then</text>
<text text-anchor="middle" x="5876" y="-1074.0018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;blocks[#blocks + 1] = this_block</text>
<text text-anchor="middle" x="5876" y="-1058.6018" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;latest = this_block</text>
<text text-anchor="middle" x="5876" y="-1043.2017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5876" y="-1027.8017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5876" y="-1012.4017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local new_linum = 0</text>
<text text-anchor="middle" x="5876" y="-997.0017" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;&#45;[[ This entire check should be wrapped in a utility assert</text>
<text text-anchor="middle" x="5876" y="-981.6016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;for _, v in ipairs(blocks) do</text>
<text text-anchor="middle" x="5876" y="-966.2016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;for __, line in ipairs(v) do</text>
<text text-anchor="middle" x="5876" y="-950.8016" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;new_linum = new_linum + 1</text>
<text text-anchor="middle" x="5876" y="-935.4015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5876" y="-920.0015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="5876" y="-904.6015" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#45;&#45;]]</text>
<text text-anchor="middle" x="5876" y="-889.2014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;assert(linum == new_linum)</text>
<text text-anchor="middle" x="5876" y="-857.8014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local phrase, cat_linum = inverter:catBlocks(blocks)</text>
<text text-anchor="middle" x="5876" y="-842.4014" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return phrase</text>
<text text-anchor="middle" x="5876" y="-827.0013" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
</g>
<!-- codeblock_34&#45;&gt;leaf_40 -->
<g id="edge40" class="edge">
<title>codeblock_34&#45;&gt;leaf_40</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M5708.4158,-1916.1614C5724.0079,-1833.8055 5789.5682,-1487.5241 5833.9159,-1253.2847"/>
<polygon fill="#000000" stroke="#000000" points="5837.3922,-1253.7382 5835.8136,-1243.2616 5830.5144,-1252.436 5837.3922,-1253.7382"/>
</g>
<!-- header_41 -->
<g id="node42" class="node">
<title>header_41</title>
<ellipse fill="none" stroke="#000000" cx="6198" cy="-1031.0017" rx="68.2066" ry="18"/>
<text text-anchor="middle" x="6198" y="-1026.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">3 : Constructor</text>
</g>
<!-- section_35&#45;&gt;header_41 -->
<g id="edge41" class="edge">
<title>section_35&#45;&gt;header_41</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6344.7912,-1916.2245C6331.4237,-1869.5054 6295.5181,-1740.2718 6275,-1630.6028 6234.1874,-1412.4599 6208.2619,-1145.5955 6200.4755,-1059.3313"/>
<polygon fill="#000000" stroke="#000000" points="6203.9529,-1058.9204 6199.5763,-1049.2718 6196.9807,-1059.5438 6203.9529,-1058.9204"/>
</g>
<!-- block_42 -->
<g id="node43" class="node">
<title>block_42</title>
<ellipse fill="none" stroke="#000000" cx="6350" cy="-1031.0017" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6350" y="-1026.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 246&#45;250</text>
</g>
<!-- section_35&#45;&gt;block_42 -->
<g id="edge42" class="edge">
<title>section_35&#45;&gt;block_42</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6350,-1916.1614C6350,-1803.598 6350,-1197.9898 6350,-1059.3072"/>
<polygon fill="#000000" stroke="#000000" points="6353.5001,-1059.0864 6350,-1049.0865 6346.5001,-1059.0865 6353.5001,-1059.0864"/>
</g>
<!-- block_43 -->
<g id="node44" class="node">
<title>block_43</title>
<ellipse fill="none" stroke="#000000" cx="6615" cy="-1031.0017" rx="65.8274" ry="18"/>
<text text-anchor="middle" x="6615" y="-1026.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">block 251&#45;262</text>
</g>
<!-- section_35&#45;&gt;block_43 -->
<g id="edge43" class="edge">
<title>section_35&#45;&gt;block_43</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6355.2935,-1916.1614C6388.3528,-1803.4851 6566.3622,-1196.7745 6606.8172,-1058.8913"/>
<polygon fill="#000000" stroke="#000000" points="6610.2369,-1059.6674 6609.6939,-1049.0865 6603.5201,-1057.6966 6610.2369,-1059.6674"/>
</g>
<!-- codeblock_44 -->
<g id="node45" class="node">
<title>codeblock_44</title>
<ellipse fill="none" stroke="#000000" cx="7017" cy="-1031.0017" rx="87.0948" ry="18"/>
<text text-anchor="middle" x="7017" y="-1026.8017" font-family="Helvetica,sans-Serif" font-size="14.00" fill="#000000">code block 263&#45;289</text>
</g>
<!-- section_35&#45;&gt;codeblock_44 -->
<g id="edge44" class="edge">
<title>section_35&#45;&gt;codeblock_44</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6374.4062,-1917.0536C6434.1061,-1874.1971 6589.9219,-1756.7718 6690,-1630.6028 6847.5116,-1432.0271 6969.9729,-1147.0119 7006.0957,-1058.3665"/>
<polygon fill="#000000" stroke="#000000" points="7009.3757,-1059.5912 7009.8845,-1049.0086 7002.8874,-1056.9642 7009.3757,-1059.5912"/>
</g>
<!-- leaf_45 -->
<g id="node46" class="node">
<title>leaf_45</title>
<polygon fill="none" stroke="#c0c0c0" points="6164,-215.7003 6110,-215.7003 6110,-179.7003 6164,-179.7003 6164,-215.7003"/>
</g>
<!-- header_41&#45;&gt;leaf_45 -->
<g id="edge45" class="edge">
<title>header_41&#45;&gt;leaf_45</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6196.6692,-1012.8221C6188.8313,-905.7516 6148.7035,-357.5774 6139.0775,-226.0803"/>
<polygon fill="#000000" stroke="#000000" points="6142.5602,-225.7149 6138.3394,-215.9971 6135.5789,-226.226 6142.5602,-225.7149"/>
</g>
<!-- leaf_46 -->
<g id="node47" class="node">
<title>leaf_46</title>
<polygon fill="none" stroke="#c0c0c0" points="6401.5,-225.0008 6182.5,-225.0008 6182.5,-170.3999 6401.5,-170.3999 6401.5,-225.0008"/>
<text text-anchor="middle" x="6292" y="-209.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6292" y="-194.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;Currently minimum&#45;viable. </text>
</g>
<!-- block_42&#45;&gt;leaf_46 -->
<g id="edge46" class="edge">
<title>block_42&#45;&gt;leaf_46</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6348.7346,-1012.8221C6341.4457,-908.0994 6304.7864,-381.4057 6294.6186,-235.3226"/>
<polygon fill="#000000" stroke="#000000" points="6298.0919,-234.8158 6293.9059,-225.083 6291.1088,-235.3019 6298.0919,-234.8158"/>
</g>
<!-- leaf_47 -->
<g id="node48" class="node">
<title>leaf_47</title>
<polygon fill="none" stroke="#c0c0c0" points="6926,-286.7006 6420,-286.7006 6420,-108.7 6926,-108.7 6926,-286.7006"/>
<text text-anchor="middle" x="6673" y="-271.5005" font-family="Inconsolata" font-size="14.00" fill="#000000"> Long term, lang can be other than nil, which gets you lua.</text>
<text text-anchor="middle" x="6673" y="-256.1005" font-family="Inconsolata" font-size="14.00" fill="#000000"> A string will return an inverter.lang of that string if such</text>
<text text-anchor="middle" x="6673" y="-240.7004" font-family="Inconsolata" font-size="14.00" fill="#000000"> exists.</text>
<text text-anchor="middle" x="6673" y="-225.3004" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6673" y="-209.9004" font-family="Inconsolata" font-size="14.00" fill="#000000"> A table will configure a lang, memoize it if it&#39;s new, and return</text>
<text text-anchor="middle" x="6673" y="-194.5003" font-family="Inconsolata" font-size="14.00" fill="#000000"> same. If one of that name already exists, memoization isn&#39;t repeated,</text>
<text text-anchor="middle" x="6673" y="-179.1003" font-family="Inconsolata" font-size="14.00" fill="#000000"> so for a default like lua or python, making a custom python inverter</text>
<text text-anchor="middle" x="6673" y="-163.7003" font-family="Inconsolata" font-size="14.00" fill="#000000"> wont affect the result of subsequent `invert(&quot;python&quot;)` calls. </text>
<text text-anchor="middle" x="6673" y="-148.3002" font-family="Inconsolata" font-size="14.00" fill="#000000"> </text>
<text text-anchor="middle" x="6673" y="-132.9002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#45; #return: an Inverter</text>
</g>
<!-- block_43&#45;&gt;leaf_47 -->
<g id="edge47" class="edge">
<title>block_43&#45;&gt;leaf_47</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M6616.2654,-1012.8221C6622.746,-919.7123 6652.4444,-493.0284 6666.0977,-296.8672"/>
<polygon fill="#000000" stroke="#000000" points="6669.5922,-297.0662 6666.7951,-286.8473 6662.6091,-296.5801 6669.5922,-297.0662"/>
</g>
<!-- leaf_48 -->
<g id="node49" class="node">
<title>leaf_48</title>
<polygon fill="none" stroke="#c0c0c0" points="7436,-395.6012 6944,-395.6012 6944,.2005 7436,.2005 7436,-395.6012"/>
<text text-anchor="middle" x="7190" y="-380.2007" font-family="Inconsolata" font-size="14.00" fill="#000000">local function new(Inverter, lang)</text>
<text text-anchor="middle" x="7190" y="-364.8006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;local inverter = setmetatable({}, Inv)</text>
<text text-anchor="middle" x="7190" y="-349.4006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if lang and lang ~= &quot;lua&quot; then</text>
<text text-anchor="middle" x="7190" y="-334.0006" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;configs not yet implemented&quot;)</text>
<text text-anchor="middle" x="7190" y="-318.6005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7190" y="-303.2005" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;return inverter</text>
<text text-anchor="middle" x="7190" y="-287.8005" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7190" y="-256.4004" font-family="Inconsolata" font-size="14.00" fill="#000000">local inv_lua = new()</text>
<text text-anchor="middle" x="7190" y="-225.0004" font-family="Inconsolata" font-size="14.00" fill="#000000">function Inv.getLang(inverter, key)</text>
<text text-anchor="middle" x="7190" y="-209.6004" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if key == &quot;lua&quot; then</text>
<text text-anchor="middle" x="7190" y="-194.2003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inv_lua</text>
<text text-anchor="middle" x="7190" y="-178.8003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7190" y="-163.4003" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;if inverter.langs[key] then </text>
<text text-anchor="middle" x="7190" y="-148.0002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;return inverter.langs[key]</text>
<text text-anchor="middle" x="7190" y="-132.6002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;else</text>
<text text-anchor="middle" x="7190" y="-117.2002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;&#160;&#160;&#160;&#160;u.freeze(&quot;No inverter found for language &quot; .. tostring(key))</text>
<text text-anchor="middle" x="7190" y="-101.8002" font-family="Inconsolata" font-size="14.00" fill="#000000"> &#160;&#160;&#160;end</text>
<text text-anchor="middle" x="7190" y="-86.4001" font-family="Inconsolata" font-size="14.00" fill="#000000">end</text>
<text text-anchor="middle" x="7190" y="-55.0001" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.__call = invert</text>
<text text-anchor="middle" x="7190" y="-39.6001" font-family="Inconsolata" font-size="14.00" fill="#000000">Inv.invert = invert</text>
<text text-anchor="middle" x="7190" y="-8.2" font-family="Inconsolata" font-size="14.00" fill="#000000">return u.export(inv, new)</text>
</g>
<!-- codeblock_44&#45;&gt;leaf_48 -->
<g id="edge48" class="edge">
<title>codeblock_44&#45;&gt;leaf_48</title>
<path fill="none" stroke="#000000" stroke-dasharray="5,2" d="M7020.7742,-1012.8221C7037.0406,-934.4708 7102.3454,-619.9123 7146.9059,-405.2749"/>
<polygon fill="#000000" stroke="#000000" points="7150.3396,-405.9531 7148.9455,-395.4504 7143.4858,-404.5301 7150.3396,-405.9531"/>
</g>
</g>
</svg>